TC.control=TC.control||{},TC.Control=function(){var t=this;t.$events=$(t),t.map=null,t.isActive=!1,t.isDisabled=!1,t._firstRender=$.Deferred();var e=arguments.length;t.options=$.extend({},e>1?arguments[1]:arguments[0]),t.div=TC.Util.getDiv(t.options.div?t.options.div:arguments[0]),t._$div=$(t.div),t._$div.addClass(TC.Control.prototype.CLASS).addClass(t.CLASS),t.template=t.options.template||t.template},TC.Control.prototype.on=function(t,e){var o=this;return o.$events.on(t,e),o},TC.Control.prototype.one=function(t,e){var o=this;return o.$events.one(t,e),o},TC.Control.prototype.off=function(t,e){var o=this;return o.$events.off(t,e),o},TC.Control.prototype.CLASS="tc-ctl",TC.Control.prototype.template="",TC.Control.prototype.show=function(){this._$div.show()},TC.Control.prototype.hide=function(){this._$div.hide()},TC.Control.prototype.render=function(t){var e=this;e.renderData(null,t)},TC.Control.prototype.renderData=function(t,e){var o=this;if(o.map){var n=$.Event(TC.Consts.event.BEFORECONTROLRENDER,{dataObject:t});o.$events.trigger(n)}o._$div.toggleClass(TC.Consts.classes.DISABLED,o.isDisabled),TC.loadJSInOrder(!window.dust,TC.url.templating,function(){var n,r=function(t){var e=$.Deferred(),o=[];for(var n in t){var r=t[n];if("string"==typeof r){var i=$.ajax({url:r,type:"get",dataType:"html"});i.templateKey=n,o.push(i)}else $.isFunction(r)&&r()}return 0==o.length?e.resolve():$.when.apply($,o).then(function(){if(3!=arguments.length||$.isArray(arguments[0]))for(var t=0;t<arguments.length;t++){var o=arguments[t],n=o[0],r=o[2].templateKey,i=dust.compile(n,r);dust.loadSource(i)}else{var n=arguments[0],r=arguments[2].templateKey,i=dust.compile(n,r);dust.loadSource(i)}e.resolve()},function(t,e,o){console.error("Deferred fallido")}),e};if("object"==typeof o.template)n=r(o.template);else{var i={};o.template&&(i[o.CLASS]=o.template),n=r(i)}n.then(function(){dust.cache[o.CLASS]&&dust.render(o.CLASS,t,function(t,e){o._$div.html(e),t&&TC.error(t)}),o._firstRender.resolve(),o.$events.trigger($.Event(TC.Consts.event.CONTROLRENDER)),$.isFunction(e)&&e()})})},TC.Control.prototype.getRenderedHtml=function(t,e,o){var n=this,r=$.Deferred(),i=function(){dust.cache[t]&&dust.render(t,e,function(t,e){t?(TC.error(t),r.reject()):($.isFunction(o)&&o(e),r.resolve(e))})};return TC.loadJSInOrder(!window.dust,TC.url.templating,function(){if(dust.cache[t])i();else{var e=n.template[t];"string"==typeof e?$.ajax({url:e,type:"get",dataType:"html"}).done(function(){var e=arguments[0],o=dust.compile(e,t);dust.loadSource(o),i()}):$.isFunction(e)&&(e(),i())}}),r},TC.Control.prototype.register=function(t){var e=this;e.map=t,e.render(),e.options.active&&e.activate()},TC.Control.prototype.activate=function(){var t=this;t.map&&t.map.activeControl&&t.map.activeControl!=t&&(t.map.previousActiveControl=t.map.activeControl,t.map.activeControl.deactivate()),t.isActive=!0,t.map&&(t.map.activeControl=t,t.map.$events.trigger($.Event(TC.Consts.event.CONTROLACTIVATE,{control:t})),t.$events.trigger($.Event(TC.Consts.event.CONTROLACTIVATE,{control:t})))},TC.Control.prototype.deactivate=function(t){0==arguments.length&&(t=!1);var e=this;if(e.isActive=!1,e.map){if(e.map.activeControl=null,!t){var o=e.map.getDefaultControl();o==e?o=null:e.map.previousActiveControl==e?o=null:o||(o=e.map.previousActiveControl),o&&o.activate()}e.map.$events.trigger($.Event(TC.Consts.event.CONTROLDEACTIVATE,{control:e})),e.$events.trigger($.Event(TC.Consts.event.CONTROLDEACTIVATE,{control:e}))}},TC.Control.prototype.enable=function(){var t=this;t.isDisabled=!1,t._$div&&t._$div.removeClass(TC.Consts.classes.DISABLED)},TC.Control.prototype.disable=function(){var t=this;t.isDisabled=!0,t._$div&&t._$div.addClass(TC.Consts.classes.DISABLED)},TC.Control.prototype.renderPromise=function(){return this._firstRender},TC.Control.prototype.isExclusive=function(){return!1},TC.Control.prototype.getLocaleString=function(t,e){var o=this,n=o.map?o.map.options.locale:TC.Cfg.locale;return TC.Util.getLocaleString(n,t,e)};
var TC=TC||{};!function(){Number.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e};var e=Number.prototype.toLocaleString;Number.prototype.toLocaleString=function(t,r){if("eu-ES"!=t||TC.Util.detectIE())return e.apply(this,arguments);var n=e.apply(this,arguments);return n=n.replace(/\,/g,"."),Math.floor(this)==this&&Number.isInteger(Math.floor(this))||(n=n.replace(/.([^.]*)$/,",$1")),n};var t={},r={},n=["Capability","Request","GetMap","DCPType","0","HTTP","Get","OnlineResource"],o=["OperationsMetadata","GetTile","DCP","HTTP","Get","0","href"],a=function(e,t,r){return r<t.length-1?e.hasOwnProperty(t[r])?a(e[t[r]],t,++r):null:e[t[r]]};TC.Util=TC.Util||{getMapLocale:function(e){return e.options&&e.options.locale&&e.options.locale.replace("_","-")||"es-ES"},regex:{PROTOCOL:/(^https?:)/i},isOnCapabilities:function(e){var t=2==arguments.length?arguments[1]:!0,r=t?e:e.replace(TC.Util.regex.PROTOCOL,"");if(t){if(TC.capabilities[r])return e}else for(var i in TC.capabilities)if(i.replace(TC.Util.regex.PROTOCOL,"")==r)return i;for(i in TC.capabilities){var s=a(TC.capabilities[i],n,0)||a(TC.capabilities[i],o,0);if(s&&t&&e==s)return s;if(s&&e.replace(TC.Util.regex.PROTOCOL,"")==s.replace(TC.Util.regex.PROTOCOL,""))return s}return e},reqGetMapOnCapabilities:function(e){var t=2==arguments.length?arguments[1]:!0,r=(t?e:e.replace(TC.Util.regex.PROTOCOL,""),function(e){var r=a(e,n,0)||a(e,o,0);return r?t?r.split("?")[0]:r.split("?")[0].replace(TC.Util.regex.PROTOCOL,""):null});return TC.capabilities[e]?r(TC.capabilities[e]):null},getFNFromString:function(e){var t=window,r=e.split(".");for(i=0;i<r.length-1;i++)if(t=t[r[i]],void 0==t)return;return t[r[r.length-1]]},isURL:function(e){return/^(http|https|ftp|mailto)\:\/\//i.test(e)},isSameOrigin:function(e){var t=0!==e.indexOf("http")&&0!==e.indexOf("//"),r=!t&&e.match(TC.Consts.url.SPLIT_REGEX);if(r){var n=window.location,o=r[1];t=(o==n.protocol||void 0==o)&&r[3]==n.hostname;var i=r[4],a=n.port;(80!=i&&""!==i||"80"!=a&&""!==a)&&(t=t&&i==a)}return t},addProtocol:function(e){var t=e;return e&&0===e.indexOf("//")&&(t=location.protocol+e),t},getDiv:function(e){var t;return t="string"==typeof e?document.getElementById(e):1==$(e).length?e:document.createElement("div")},getBackgroundUrlFromCss:function(e){var r="";if(void 0!==t[e])r=t[e];else{var n=$('<div style="display:none">').addClass(e).appendTo("body"),o=/^url\(['"]?(.*?)['"]?\)$/gi.exec(n.css("background-image"));o&&o.length>1&&(r=o[o.length-1]),n.remove(),t[e]=r}return r},getPointIconUrl:function s(e){var t=null;if(e.url)t=e.url;else{var n;if("string"==typeof e.cssClass)n=e.cssClass;else{var o=e.classes||TC.Cfg.styles.marker.classes;if(n=o[0],e.group){if(void 0===r[e.group]){var i=0;for(var a in r)i++;i%=o.length,r[e.group]=o[i]}n=r[e.group]}}t=TC.Util.getBackgroundUrlFromCss(n)}return t||e===TC.Cfg.styles.point||""===e.cssClass||(t=s(TC.Cfg.styles.point)),t},addArrayToTree:function l(e,t,r){var n=null,o=!1;r=r||0;var i=e[r];if(i){for(var a,s=0,c=t.children.length;c>s;s++)if(a=t.children[s],a.name===i){o=!0;var u=l(e,a,r+1);u&&(n=u);break}o||(a={name:i,title:i,uid:"/"+e.slice(0,r+1).join("/"),children:[]},t.children.push(a),n=a)}return n},parseCoords:function(e){var t=null,r=function(e){var t=e,r={};r.type=TC.Consts.GEOGRAPHIC;var n=t.indexOf("Â°");if(r.value=parseFloat(t.substr(0,n)),t=t.substr(n+1),n=t.indexOf("'"),n>=0){var o=parseFloat(t.substr(0,n))/60;r.value>=0?r.value+=o:r.value-=o,t=t.substr(n+1),n=t.indexOf("'"),n>=0&&(o=parseFloat(t.substr(0,n).replace(",","."))/3600,r.value>=0?r.value+=o:r.value-=o)}return r},n=function(e){var t=$.trim(e);if(t.match(/^1?\d{0,2}\s*\u00B0(\s*\d{1,2}\s*'(\s*\d{1,2}([.,]\d+)?\s*'')?)?\s*[NnSsWwOoEe]$/g)){switch(t[t.length-1]){case"S":case"s":case"W":case"w":case"O":case"o":t="-"+t}return t=t.substr(0,t.length-1),r(t)}if(t.match(/^[+-]?1?\d{0,2}\s*\u00B0(\s*\d{1,2}\s*'(\s*\d{1,2}([.,]\d+)?\s*'')?)?$/g))return r(t);if(t.match(/^1?\d{0,2}([.,]\d+)?\s*\u00B0?\s*[NnSsWwOoEe]$/g)){var n={type:TC.Consts.GEOGRAPHIC,value:parseFloat(t.substr(0,t.length-1).replace(",","."))};return t.match(/[SsWwOo]$/)&&(n.value=-n.value),n}return t.match(/^[+-]?1?\d{0,2}([.,]\d+)?\s*\u00B0?$/g)?{type:TC.Consts.GEOGRAPHIC,value:parseFloat(t.replace(",","."))}:t.match(/^\d{6,7}([.,]\d+)?$/g)?{type:TC.Consts.UTM,value:parseFloat(t.replace(",","."))}:null};e=$.trim(e).toUpperCase();var o=e.split(",");if(4===o.length?o=[o.slice(0,1).join("."),o.slice(2,3).join(".")]:(1===o.length||3===o.length)&&(o=e.split(" ")),2===o.length){var i=n(o[0]),a=n(o[1]);null!==i&&null!==a&&(t=[i,a])}return t},reproject:function(e,t,r){var n,o=!0;(TC.isLegacy?window[TC.Consts.PROJ4JSOBJ_LEGACY]:window[TC.Consts.PROJ4JSOBJ])||TC.syncLoadJS(TC.url.proj4js),$.isArray(e)&&$.isArray(e[0])||(o=!1,e=[e]),TC.loadProjDef(t,!0),TC.loadProjDef(r,!0);var i=new Proj4js.Proj(t),a=new Proj4js.Proj(r);n=new Array(e.length);for(var s=0,l=e.length;l>s;s++){var c=Proj4js.transform(i,a,{x:e[s][0],y:e[s][1]});n[s]=[c.x,c.y]}return o||(n=n[0]),n},getMetersPerDegree:function(e){var t=void 0,r=6370997;if($.isArray(e)&&e.length>=4){var n=this.degToRad(e[3]-e[1]),o=Math.sin(n/2),i=o*o,a=2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i));t=r*a/(e[3]-e[1])}return t},radToDeg:function(e){return 180*e/Math.PI},degToRad:function(e){return e*Math.PI/180},mod:function(e){return(e%(2*Math.PI)+2*Math.PI)%(2*Math.PI)},getLocaleString:function(e,t,r){var n=t;if(TC.i18n&&TC.i18n[e]){var o=TC.i18n[e][t];if(o&&(n=o,r))for(var i in r)n=n.replace("{"+i+"}",r[i])}return n},getSimpleMimeType:function(e){var t="";if(e){var r=e.indexOf(";");r>0&&(e=e.substring(0,r)),t=e}return t},getQueryStringParams:function(e){var t;if(e){var r=e.indexOf("?");if(r>=0){t=e.substr(r);var n=t.indexOf("#");n>=0&&(t=t.substr(0,n))}else t="?"}else t=location.search;var o=$.map(t.replace(/(^\?)/,"").split("&"),function(e){return e=e.split("="),this[e[0]]=e[1],this}.bind({}))[0];return delete o[""],o},fastUnshift:function(e,t){for(var r=e.length;r;)e[r]=e[r-1],r--;e[0]=t},storage:{getCookie:function(e){return $.cookie(e)},setCookie:function(e,t,r){return $.cookie(e,t,r)},getLocalValue:function(e){var t=null;return t=localStorage&&localStorage instanceof Storage?localStorage.getItem(e):TC.Util.storage.getCookie(e)},setLocalValue:function(e,t){if(localStorage&&localStorage instanceof Storage)void 0===t?localStorage.removeItem(e):localStorage.setItem(e,t);else if(void 0===t){var r=new Date;r.setDate(r.getDate()-1),TC.Util.storage.setCookie(e,"",{expires:r})}else TC.Util.storage.setCookie(e,t);return e},getSessionLocalValue:function(e){var t=null;return t=sessionStorage&&sessionStorage instanceof Storage?sessionStorage.getItem(e):TC.Util.storage.getCookie(e)},setSessionLocalValue:function(e,t){if(sessionStorage&&sessionStorage instanceof Storage)void 0===t?sessionStorage.removeItem(e):sessionStorage.setItem(e,t);else if(void 0===t){var r=new Date;r.setDate(r.getDate()-1),TC.Util.storage.setCookie(e,"",{expires:r})}else TC.Util.storage.setCookie(e,t);return e}},detectFirefox:function(){return/Firefox[\/\s](\d+\.\d+)/.test(navigator.userAgent)?new Number(RegExp.$1):!1},detectIE:function(){var e=window.navigator.userAgent,t=e.indexOf("MSIE ");if(t>0)return parseInt(e.substring(t+5,e.indexOf(".",t)),10);var r=e.indexOf("Trident/");if(r>0){var n=e.indexOf("rv:");return parseInt(e.substring(n+3,e.indexOf(".",n)),10)}var o=e.indexOf("Edge/");return o>0?parseInt(e.substring(o+5,e.indexOf(".",o)),10):!1},detectChrome:function(){return window.chrome},detectSafari:function(){return!!navigator.userAgent.match(/Version\/[\d\.]+.*Safari/)},detectMouse:function(){if(Modernizr.mq("(pointer:coarse)")&&Modernizr.mq("(pointer:fine)"))return!0;if(Modernizr.mq("(pointer:coarse)")&&!Modernizr.mq("(pointer:fine)")){var e=function(){var e,t="(hover: hover)",r=!Modernizr.touch;return"matchMedia"in window?(e=window.matchMedia(t),e.media===t&&(r=e.matches)):console.log("no dispone de matchMedia"),r};return e()?!0:!1}return!Modernizr.mq("(pointer:coarse)")&&Modernizr.mq("(pointer:fine)")?!0:Modernizr.mq("(pointer:none)")?!1:Modernizr.touch?void 0:!0},detectAndroid:function(){return navigator.userAgent.match(/Android/i)},detectBlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},detectIOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},detectMobileWindows:function(){return navigator.userAgent.match(/IEMobile/i)},detectMobile:function(){return TC.Util.detectAndroid()||TC.Util.detectIOS()||TC.Util.detectMobileWindows()||TC.Util.detectBlackBerry()},getElementByNodeName:function(e,t){for(var r=t.indexOf(":"),n=t.substr(r+1),o=e.getElementsByTagNameNS("*",n),i=0;i<o.length;i++)if(o[i].nodeName==t)return o;return void 0},removeURLParameter:function(e,t){var r=e.toLowerCase().split("?");if(r.length>=2){for(var n=encodeURIComponent(t.toLowerCase())+"=",o=r[1].split(/[&;]/g),i=o.length;i-->0;)-1!==o[i].lastIndexOf(n,0)&&o.splice(i,1);return e=r[0]+"?"+o.join("&")}return e},showModal:function(e,t){var r=$(e),t=t||{};r.off("click").removeAttr("hidden"),r.fadeIn(250,function(){r.on("click",".tc-modal-close",function(e){return e.stopPropagation(),TC.Util.closeModal(t.closeCallback)}),$.isFunction(t.openCallback)&&t.openCallback()})},closeModal:function(e){$(".tc-modal").hide().find(".tc-modal-window").removeAttr("style").off(),e&&e()},closeAlert:function(e){$(e).parents(".tc-alert").hide()},getParameterByName:function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)","i"),r=t.exec(location.search);return null===r?"":decodeURIComponent(r[1].replace(/\+/g," "))},downloadFile:function(e,t,r){var n=new Blob([r],{type:t});if(navigator.msSaveBlob)navigator.msSaveBlob(n,e);else{var o=document.createElement("a");if(void 0!==o.download){var i=URL.createObjectURL(n);o.setAttribute("href",i),o.setAttribute("download",e),o.style.visibility="hidden",document.body.appendChild(o),o.click(),document.body.removeChild(o)}}},shortenUrl:function(e){var t;return $.ajax({url:"https://api-ssl.bitly.com/v3/shorten",data:{access_token:"6c466047309f44bd8173d83e81491648b243ee3d",longUrl:e},async:!1}).done(function(e){t=e.data.url}),t},utf8ToBase64:function(e){return window.btoa(unescape(encodeURIComponent(e)))},base64ToUtf8:function(e){var t;try{t=decodeURIComponent(escape(window.atob(e)))}catch(r){t=null}return t},operation:function(e,t,r,n){for(var o=[],i=0;i<e.length;i++){for(var a=e[i],s=!1,l=0;l<t.length;l++)if(r(a,t[l])){s=!0;break}s===n&&o.push(a)}return o},inBoth:function(e,t,r){return this.operation(e,t,r,!0)},inFirstOnly:function(e,t,r){return this.operation(e,t,r,!1)},inSecondOnly:function(e,t,r){return this.inFirstOnly(t,e,r)},toDataUrl:function(e,t){var r={type:"image/png",encoderOptions:.92},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:r,o=n.type,i=n.encoderOptions,a=e.getContext("2d");if(!a)return"";var s=e.width,l=e.height,c=a.getImageData(0,0,s,l),u=a.globalCompositeOperation;t&&(a.globalCompositeOperation="destination-over",a.fillStyle=t,a.fillRect(0,0,s,l));var d=e.toDataURL(o,i);return t&&(a.clearRect(0,0,s,l),a.putImageData(c,0,0),a.globalCompositeOperation=u),d},imgToDataUrl:function(e,t){var r=$.Deferred(),n=new Image;return n.crossOrigin="anonymous",n.onload=function(){var e,n=document.createElement("CANVAS"),o=n.getContext("2d");n.height=this.height,n.width=this.width,o.drawImage(this,0,0),e=TC.Util.toDataUrl(n,"#ffffff",{type:t||"image/jpeg",encoderOptions:1}),r.resolve(e,n)},e=e.replace(/^https?\:/i,""),n.src=e,(n.complete||void 0===n.complete)&&(n.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==",n.src=e),r.promise()},addToCanvas:function(e,t,r){var n=function(e){var t=document.createElement("canvas"),r=t.getContext("2d");return t.width=e.width,t.height=e.height,r.drawImage(e,0,0),t},o=n(e),i=$.Deferred(),a=o.getContext("2d"),s=new Image;return s.src=t,s.onload=function(){a.drawImage(s,r.x||0,r.y||0),i.resolve(o)},i.promise()},calculateAspectRatioFit:function(e,t,r,n){var o=Math.min(r/e,n/t);return{width:e*o,height:t*o}},getFormattedDate:function(e){function t(e){return 10>e?"0"+e:e}var r=new Date(e);return[r.getFullYear(),t(r.getMonth()+1),t(r.getDate())].join("")}}}();
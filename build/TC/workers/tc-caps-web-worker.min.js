function tXml(t,e){"use strict";function r(){for(var e=[];t[u];){if(t.charCodeAt(u)==s){if(t.charCodeAt(u+1)===d)return u=t.indexOf(c,u),e;if(t.charCodeAt(u+1)===m){var r=t.charCodeAt(u+2);if(r!=x){if(r==g){for(;-1!==u&&(t.charCodeAt(u)!==h||t.charCodeAt(u-1)!=g||t.charCodeAt(u-2)!=g||-1==u);)u=t.indexOf(c,u+1);-1===u&&(u=t.length)}else for(u+=2;t.charCodeAt(u)!==h;)u++;u++;continue}}var a=i();e.push(a)}else{var o=n();o.trim().length>0&&e.push(o)}u++}return e}function n(){var e=u;return u=t.indexOf(f,u)-1,-2===u&&(u=t.length),t.slice(e,u+1)}function a(){for(var e=u;-1===y.indexOf(t[u]);)u++;return t.slice(e,u)}function i(){var e={};if(u++,t.charCodeAt(u)===m&&t.charCodeAt(u+1)===x){for(var n=u+8;t.charCodeAt(u)!==h||t.charCodeAt(u-1)!==C||t.charCodeAt(u-2)!==C;)u++;return t.slice(n,u-2)}e.tagName=a();for(var i=!1;t.charCodeAt(u)!==h;){var l=t.charCodeAt(u);if(l>64&&91>l||l>96&&123>l){for(var f=a(),s=t.charCodeAt(u);s!==p&&s!==v&&!(s>64&&91>s||s>96&&123>s)&&s!==h;)u++,s=t.charCodeAt(u);if(i||(e.attributes={},i=!0),s===p||s===v)var c=o();else c=null,u--;e.attributes[f]=c}u++}if(t.charCodeAt(u-1)!==d)if("script"==e.tagName){var n=u+1;u=t.indexOf("</script>",u),e.children=[t.slice(n,u-1)],u+=8}else if("style"==e.tagName){var n=u+1;u=t.indexOf("</style>",u),e.children=[t.slice(n,u-1)],u+=7}else-1==S.indexOf(e.tagName)&&(u++,e.children=r(f));return e}function o(){var e=t[u],r=++u;return u=t.indexOf(e,r),t.slice(r,u)}function l(){var r=new RegExp("\\s"+e.attrName+"\\s*=['\"]"+e.attrValue+"['\"]").exec(t);return r?r.index:-1}e=e||{};var u=0,f="<",s="<".charCodeAt(0),c=">",h=">".charCodeAt(0),g="-".charCodeAt(0),d="/".charCodeAt(0),m="!".charCodeAt(0),p="'".charCodeAt(0),v='"'.charCodeAt(0),x="[".charCodeAt(0),C="]".charCodeAt(0),y="\n	>/= ",S=["img","br","input","meta","link"],A=null;if(void 0!==e.attrValue){e.attrName=e.attrName||"id";for(var A=[];-1!==(u=l());)u=t.lastIndexOf("<",u),-1!==u&&A.push(i()),t=t.substr(u),u=0}else A=r();return e.filter&&(A=tXml.filter(A,e.filter)),e.simplify&&(A=tXml.simplify(A)),A}tXml.simplify=function(t){var e={};if(!t||!t.length)return"";if(1===t.length&&"string"==typeof t[0])return t[0];t.forEach(function(t){if("object"==typeof t){e[t.tagName]||(e[t.tagName]=[]);var r=tXml.simplify(t.children);e[t.tagName].push(r),t.attributes&&(r._attributes=t.attributes)}});for(var r in e)1==e[r].length&&(e[r]=e[r][0]);return e},tXml.filter=function(t,e){var r=[];return t.forEach(function(t){if("object"==typeof t&&e(t)&&r.push(t),t.children){var n=tXml.filter(t.children,e);r=r.concat(n)}}),r},tXml.stringify=function(t){function e(t){if(t)for(var e=0;e<t.length;e++)"string"==typeof t[e]?n+=t[e].trim():r(t[e])}function r(t){n+="<"+t.tagName;for(var r in t.attributes)n+=null===t.attributes[r]?" "+r:-1===t.attributes[r].indexOf('"')?" "+r+'="'+t.attributes[r].trim()+'"':" "+r+"='"+t.attributes[r].trim()+"'";n+=">",e(t.children),n+="</"+t.tagName+">"}var n="";return e(t),n},tXml.toContentString=function(t){if(Array.isArray(t)){var e="";return t.forEach(function(t){e+=" "+tXml.toContentString(t),e=e.trim()}),e}return"object"==typeof t?tXml.toContentString(t.children):" "+t},tXml.getElementById=function(t,e,r){var n=tXml(t,{attrValue:e,simplify:r});return r?n:n[0]},tXml.getElementsByClassName=function(t,e,r){return tXml(t,{attrName:"class",attrValue:"[a-zA-Z0-9-s ]*"+e+"[a-zA-Z0-9-s ]*",simplify:r})},"object"==typeof module&&(module.exports=tXml),function(){var t=function d(t,e){var r={};if(!(t&&t.length||e))return"";if(t=t||[],1===t.length&&"string"==typeof t[0])return t[0];t.forEach(function(t){if("object"==typeof t){var e=t.tagName.indexOf("ows:"),n=0>e?t.tagName:t.tagName.substr(e+4);r[n]||(r[n]=[]);var a=d(t.children,t.attributes);if(r[n].push(a),t.attributes)for(var i in t.attributes)a[i]=t.attributes[i]}});for(var n in r)1==r[n].length&&(r[n]=r[n][0]);return r},e=function(t){return t["xlink:href"]},r=function(t,r){if(t.hasOwnProperty(r)){for(var n=t[r],a=n.length?n:[n],i=0,o=a.length;o>i;i++){var l=a[i];l.OnlineResource=e(l.OnlineResource)}t[r]=a}},n=function(t){if(t){for(var r=t.DCPType.length?t.DCPType:[t.DCPType],n=0,a=r.length;a>n;n++){var i=r[n];for(var o in i){var l=i[o];for(var u in l){var f=l[u];f.OnlineResource=e(f.OnlineResource)}}}t.DCPType=r}},a=[!1,!0],i=function m(t,n){t.hasOwnProperty("queryable")&&(t.queryable=a[t.queryable]);var i;if(t.hasOwnProperty("EX_GeographicBoundingBox")&&(i=t.EX_GeographicBoundingBox,t.EX_GeographicBoundingBox=[parseFloat(i.westBoundLongitude),parseFloat(i.southBoundLatitude),parseFloat(i.eastBoundLongitude),parseFloat(i.northBoundLatitude)]),t.hasOwnProperty("BoundingBox")&&(i=t.BoundingBox,i=t.BoundingBox.length?t.BoundingBox:[t.BoundingBox],t.BoundingBox=i.map(function(t){return{crs:t.CRS,extent:[parseFloat(t.minx),parseFloat(t.miny),parseFloat(t.maxx),parseFloat(t.maxy)],res:new Array(2)}})),t.hasOwnProperty("Attribution")&&(t.Attribution.OnlineResource=e(t.Attribution.OnlineResource)),r(t,"AuthorityURL"),r(t,"MetadataURL"),t.Style){t.Style.length||(t.Style=[t.Style]);for(var o=0,l=t.Style.length;l>o;o++)r(t.Style[o],"LegendURL")}var u="string"==typeof t.CRS?[t.CRS]:t.CRS;if(n&&t.CRS&&(t.CRS=u.concat(n)),t.Layer){var f=t.Layer[1]?t.Layer:[t.Layer];t.Layer=f;for(var o=0,l=f.length;l>o;o++)m(f[o],u)}},o=" ",l=function(t){return t.split(o).map(function(t){return parseFloat(t)})},u=function(t){t.Layer.length||(t.Layer=[t.Layer]);for(var e=t.Layer,r=0,n=e.length;n>r;r++){var a=e[r];"string"==typeof a.Format&&(a.Format=[a.Format]),a.ResourceURL&&!a.ResourceURL.length&&(a.ResourceURL=[a.ResourceURL]),a.Style.length||(a.Style=[a.Style]),a.TileMatrixSetLink.length||(a.TileMatrixSetLink=[a.TileMatrixSetLink]);for(var i=0,o=a.TileMatrixSetLink.length;o>i;i++){var u=a.TileMatrixSetLink[i];if(u.TileMatrixSetLimits){u.TileMatrixSetLimits=u.TileMatrixSetLimits.TileMatrixLimits;for(var f=0,s=u.TileMatrixSetLimits.length;s>f;f++){var c=u.TileMatrixSetLimits[f];c.MaxTileCol=parseInt(c.MaxTileCol),c.MaxTileRow=parseInt(c.MaxTileRow),c.MinTileCol=parseInt(c.MinTileCol),c.MinTileRow=parseInt(c.MinTileRow)}}else u.TileMatrixSetLimits=[]}if(a.WGS84BoundingBox){var h=l(a.WGS84BoundingBox.LowerCorner),g=l(a.WGS84BoundingBox.UpperCorner);a.WGS84BoundingBox=[h[0],h[1],g[0],g[1]]}}},f=function(t){t.TileMatrixSet.length||(t.TileMatrixSet=[t.TileMatrixSet]);for(var e=t.TileMatrixSet,r=0,n=e.length;n>r;r++)for(var a=e[r],i=0,o=a.TileMatrix.length;o>i;i++){var u=a.TileMatrix[i];u.MatrixHeight=parseInt(u.MatrixHeight),u.MatrixWidth=parseInt(u.MatrixWidth),u.TileHeight=parseInt(u.TileHeight),u.TileWidth=parseInt(u.TileWidth),u.ScaleDenominator=parseFloat(u.ScaleDenominator),u.TopLeftCorner=l(u.TopLeftCorner)}},s=function(t){for(var e=t.length?t:[t],r=new Array(e.length),n=0,a=e.length;a>n;n++){var i=e[n];if(!i.Constraint.length){i.Constraint=[i.Constraint];for(var o=0,l=i.Constraint.length;l>o;o++){var u=i.Constraint[o].AllowedValues;"string"==typeof u.Value&&(u.Value=[u.Value])}}r[n]={Constraint:i.Constraint,href:i["xlink:href"]}}return r},c=function(t){for(var e=t.Operation.length?t.Operation:[t.Operation],r=0,n=e.length;n>r;r++){var a=e[r];for(var i in a.DCP){var o=a.DCP[i];for(var l in o)o[l]=s(o[l])}t[a.name]={DCP:a.DCP}}delete t.Operation},h=function(t){var e=t["?xml"]&&t["?xml"].WMS_Capabilities;if(e){i(e.Capability.Layer);var r=e.Capability.Request;n(r.GetMap),r.GetFeatureInfo&&(r.GetFeatureInfo.Format="string"==typeof r.GetFeatureInfo.Format?[r.GetFeatureInfo.Format]:r.GetFeatureInfo.Format)}return e},g=function(t){var e=t["?xml"]&&t["?xml"].Capabilities;return e&&(u(e.Contents),f(e.Contents),c(e.OperationsMetadata)),e};onmessage=function(e){var r=t(tXml(e.data.text)),n="WMTS"===e.data.type?g(r):h(r);postMessage({state:n?"success":"error",capabilities:n})}}();
function xml2json(e){var t={toObj:function(e){var r={};if(1==e.nodeType){if(e.attributes.length)for(var n=0;n<e.attributes.length;n++)"name"!==e.attributes[n].nodeName&&(r[e.attributes[n].nodeName]=(e.attributes[n].nodeValue||"").toString());if(e.firstChild){for(var a=0,i=0,s=!1,o=e.firstChild;o;o=o.nextSibling)1==o.nodeType?s=!0:3==o.nodeType&&o.nodeValue.match(/[^ \f\n\r\t\v]/)?a++:4==o.nodeType&&i++;if(s)if(2>a&&2>i){t.removeWhite(e);for(var o=e.firstChild;o;o=o.nextSibling){var l=t.removePrefix(o.nodeName);if(3==o.nodeType)r["#text"]=t.escape(o.nodeValue);else if(4==o.nodeType)r["#cdata"]=t.escape(o.nodeValue);else if(r[l])r[l]instanceof Array?r[l][r[l].length]=t.toObj(o):r[l]=[r[l],t.toObj(o)];else{var u=null;o.attributes.getNamedItem("name")&&(u=o.attributes.getNamedItem("name").nodeValue),r[u?u:l]=t.toObj(o)}}}else e.attributes.length?r["#text"]=t.escape(t.innerXml(e)):r=t.escape(t.innerXml(e));else if(a)e.attributes.length?r["#text"]=t.escape(t.innerXml(e)):r=t.escape(t.innerXml(e));else if(i)if(i>1)r=t.escape(t.innerXml(e));else for(var o=e.firstChild;o;o=o.nextSibling)r["#cdata"]=t.escape(o.nodeValue)}e.attributes.length||e.firstChild||(r=null)}else 9==e.nodeType?r=t.toObj(e.documentElement):8==e.nodeType?console.log(e.textContent):alert("unhandled node type: "+e.nodeType);return r},toJson:function(e,r,n){var a=r?'"'+r+'"':"";if(e instanceof Array){for(var i=0,s=e.length;s>i;i++)e[i]=t.toJson(e[i],"",n+"	");a+=(r?":[":"[")+(e.length>1?"\n"+n+"	"+e.join(",\n"+n+"	")+"\n"+n:e.join(""))+"]"}else if(null==e)a+=(r&&":")+"null";else if("object"==typeof e){var o=[];for(var l in e)o[o.length]=t.toJson(e[l],l,n+"	");a+=(r?":{":"{")+(o.length>1?"\n"+n+"	"+o.join(",\n"+n+"	")+"\n"+n:o.join(""))+"}"}else a+="string"==typeof e?(r&&":")+'"'+e.toString()+'"':(r&&":")+e.toString();return a},innerXml:function(e){var t="";if("innerHTML"in e)t=e.innerHTML;else for(var r=function(e){var t="";if(1==e.nodeType){t+="<"+e.nodeName;for(var n=0;n<e.attributes.length;n++)t+=" "+e.attributes[n].nodeName+'="'+(e.attributes[n].nodeValue||"").toString()+'"';if(e.firstChild){t+=">";for(var a=e.firstChild;a;a=a.nextSibling)t+=r(a);t+="</"+e.nodeName+">"}else t+="/>"}else 3==e.nodeType?t+=e.nodeValue:4==e.nodeType&&(t+="<![CDATA["+e.nodeValue+"]]>");return t},n=e.firstChild;n;n=n.nextSibling)t+=r(n);return t},escape:function(e){return e.replace(/[\\]/g,"\\\\").replace(/[\"]/g,'\\"').replace(/[\n]/g,"\\n").replace(/[\r]/g,"\\r")},removeWhite:function(e){e.normalize();for(var r=e.firstChild;r;)if(3==r.nodeType)if(r.nodeValue.match(/[^ \f\n\r\t\v]/))r=r.nextSibling;else{var n=r.nextSibling;e.removeChild(r),r=n}else 1==r.nodeType?(t.removeWhite(r),r=r.nextSibling):r=r.nextSibling;return e},removePrefix:function(e){return e.substring(e.indexOf(":")+1)}};return 9==e.nodeType&&(e=e.documentElement),t.toObj(t.removeWhite(e))}var WFSCapabilities=function(){var e={V1_0_0:"1.0.0",V1_1_0:"1.1.0",V2_0_0:"2.0.0"},t=function(){var t,s=[],o=[],l=[],u=xml2json(arguments[0]);switch(u.version){case e.V1_0_0:t=e.V1_0_0;break;case e.V1_1_0:t=e.V1_1_0;break;case e.V2_0_0:t=e.V2_0_0}s=r(u,t),o=n(u,t),l=a(u,t);var f=i(u,t),p={Operations:s,FeatureTypes:o,Filters:l};return $.extend(p,f),p},r=function(t,r){switch(r){case e.V1_0_0:var n=t.Capability.Request;if(n.GetFeature){var a=[];for(var i in n.GetFeature.ResultFormat)a.push(i.toLowerCase());n.GetFeature.outputFormat=a,delete n.GetFeature.ResultFormat,n.GetFeature.Operations=t.FeatureTypeList.Operations}return n;case e.V1_1_0:return{};case e.V2_0_0:var s={};for(var i in t.OperationsMetadata){var o={};o[i]=t.OperationsMetadata[i];for(var l in o[i])o[i][l]&&o[i][l].hasOwnProperty("AllowedValues")&&(o[i][l]=o[i][l].AllowedValues.Value);$.extend(s,o)}return s}return null},n=function(t,r){switch(r){case e.V1_0_0:for(var n={},a=0;a<t.FeatureTypeList.FeatureType.length;a++){var i=t.FeatureTypeList.FeatureType[a].Name;n[i.substring(i.indexOf(":")+1)]=t.FeatureTypeList.FeatureType[a]}return n;case e.V1_1_0:return{};case e.V2_0_0:for(var n={},a=0;a<t.FeatureTypeList.FeatureType.length;a++){var i=t.FeatureTypeList.FeatureType[a].Name;n[i.substring(i.indexOf(":")+1)]=t.FeatureTypeList.FeatureType[a]}return n}return null},a=function(t,r){switch(r){case e.V1_0_0:return t.Filter_Capabilities;case e.V1_1_0:return{};case e.V2_0_0:var n=t.Filter_Capabilities;return n}return null},i=function(t,r){switch(r){case e.V1_0_0:var n={};for(var a in t)"string"==typeof t[a]&&(n[a]=t[a]);return n;case e.V1_1_0:return{};case e.V2_0_0:var n={};for(var a in t)"string"==typeof t[a]&&(n[a]=t[a]);return n}return{}},s=function(e){var e=e,t=$.Deferred(),r=e.substring(e.indexOf("://")<0?0:e.indexOf("://")+3);if(TC.capabilities[r])return t.resolve(TC.capabilities[r]),t;var n={};return n.SERVICE="WFS",n.VERSION="2.0.0",n.REQUEST="GetCapabilities",$.ajax({url:TC.proxify(e)+"?"+$.param(n),type:"GET"}).then(function(){var e=WFSCapabilities.Parse(arguments[0]),n=e.Operations.GetCapabilities.DCP&&e.Operations.GetCapabilities.DCP.HTTP.Get["xlink:href"]||e.Operations.GetCapabilities.DCPType[0].HTTP.Get.onlineResource;TC.capabilities[n]=e,TC.capabilities[r]=e,t.resolve(WFSCapabilities.Parse(arguments[0]))}),t};return{Promises:s,Parse:t}}();
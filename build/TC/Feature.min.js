TC.feature=TC.feature||{},TC.Feature=function(t,e){var r=this;r.wrap=new TC.wrap.Feature,r.wrap.parent=r,$.isArray(t)?r.geometry=t:r.wrap.isNative(t)&&(r.wrap.feature=t,r.id=r.wrap.getId(),r.geometry=r.wrap.getGeometry(),r.folders=t._folders,r.data=r.wrap.getData());var a=r.options=$.extend(!0,{},e);r.id=r.id||a.id||TC.getUID(),r.data=a.data||r.data||null,r._visibilityState=TC.Consts.visibility.VISIBLE,r.showsPopup=void 0===a.showsPopup?!0:a.showsPopup,r.layer=a.layer||null,r._selected=!1,a.selected&&r.select()},TC.Feature.prototype.STYLETYPE=TC.Consts.geom.POLYGON,TC.Feature.prototype.CLASSNAME="TC.Feature",TC.Feature.prototype.getPath=function(){var t=[],e=this;return e.folders?t=e.folders:e.options.group&&(t=[e.options.group]),t},TC.Feature.prototype.setVisibility=function(t){var e=this;(t&&e._visibilityState===TC.Consts.visibility.NOT_VISIBLE||!t&&e._visibilityState===TC.Consts.visibility.VISIBLE)&&(e._visibilityState=t?TC.Consts.visibility.VISIBLE:TC.Consts.visibility.NOT_VISIBLE,e.layer.wrap.setFeatureVisibility(e,t))},TC.Feature.prototype.setId=function(t){var e=this;e.id=t,e.wrap.setId(t)},TC.Feature.prototype.getBounds=function(){return this.wrap.getBounds()},TC.Feature.prototype.setStyle=function(t){var e=this;$.extend(!0,e.options,t),this.wrap.setStyle(e.options)},TC.Feature.prototype.getLegend=function(){var t=this;return t._legend||(t._legend=t.wrap.getLegend()),t._legend},TC.Feature.prototype.getData=function(){var t=null,e=this;return t=e.data?e.data:e.wrap.getData()},TC.Feature.prototype.setData=function(t){var e=this;e.data=$.extend(e.data,t),e.wrap.setData(t)},TC.Feature.prototype.getInfo=function(){var t=null,e=this,r=e.getData();if("object"==typeof r){var a=e.wrap.getTemplate();if(a)t=a.replace(/\$\[?(?:\w+\/)*(\w+)\]/g,function(t,e){return r[e]});else{var o=[];for(var n in r){var i=r[n];if("string"==typeof i||"number"==typeof i||"undefined"==typeof i){o[o.length]="<tr><th>",o[o.length]=n,o[o.length]="</th><td>";var s=TC.Util.isURL(i);s&&(o[o.length]='<a href="',o[o.length]=i,o[o.length]='" target="_blank">'),o[o.length]=void 0!==i?i:"&mdash;",s&&(o[o.length]="</a>"),o[o.length]="</td></tr>"}}o.length>0&&(o.unshift("<table>"),o[o.length]="</table>",t=o.join(""))}}else"string"==typeof r&&(t=r);return t||(t=e.title,e.group&&(t+=" "+e.group)),t||(t=TC.Util.getLocaleString(TC.Cfg.locale,"noData")),t},TC.Feature.prototype.clone=function(){var t=this,e=t.wrap.cloneFeature();return e._wrap=t.wrap,new t.constructor(e,t.options)},TC.Feature.prototype.getStyle=function(){return this.wrap.getStyle()},TC.Feature.prototype.showPopup=function(t){var e=this;if(e.showsPopup&&e.layer&&e.layer.map){var r,a=t||e.popup;if(!a)for(var o=e.layer.map.getControlsByClass("TC.control.Popup"),n=0,i=o.length;i>n;n++){var s=o[n];if(!s.caller){a=s;break}}a?(r=$.Deferred(),r.resolve(a)):TC.loadJS(!TC.control||!TC.control.Popup,[TC.apiLocation+"TC/control/Popup.js"],function(){r=e.layer.map.addControl(new TC.control.Popup)}),r.then(function(t){t.currentFeature=e;for(var r=e.layer.map.getControlsByClass(TC.control.Popup),a=0,o=r.length;o>a;a++){var n=r[a];n!==t&&n.hide()}e.wrap.showPopup(t),e.layer.map.$events.trigger($.Event(TC.Consts.event.POPUP,{control:t})),t.fitToView(!0)})}},TC.Feature.prototype.select=function(){var t=this;t._selected=!0,t.layer&&t.layer.selectedFeatures.push(t);var e=t.options.selection||{};t.setStyle($.extend({},TC.Cfg.styles.selection[t.STYLETYPE],e[t.STYLETYPE]))},TC.Feature.prototype.unselect=function(){var t=this;if(t._selected=!1,t.setStyle(),t.layer){var e=$.inArray(t,t.layer.selectedFeatures);e>=0&&t.layer.selectedFeatures.splice(e,1)}},TC.Feature.prototype.isSelected=function(){return this._selected};
function JL(e){if(!e)return JL.__;Array.prototype.reduce||(Array.prototype.reduce=function(e,t){for(var n=t,r=0;r<this.length;r++)n=e(n,this[r],r,this);return n});var t="";return("."+e).split(".").reduce(function(e,n,r,i){t=t?t+("."+n):n;n=e["__"+t];void 0===n&&(JL.Logger.prototype=e,n=new JL.Logger(t),e["__"+t]=n);return n},JL.__)}function phi4z(e,t,n,r,i,a,s,o,l){var c,u,h,p,d,f,m,y,g,v;l=a;for(v=1;15>=v;v++){c=Math.sin(l);h=Math.tan(l);o=h*Math.sqrt(1-e*c*c);u=Math.sin(2*l);p=t*l-n*u+r*Math.sin(4*l)-i*Math.sin(6*l);d=t-2*n*Math.cos(2*l)+4*r*Math.cos(4*l)-6*i*Math.cos(6*l);f=2*p+o*(p*p+s)-2*a*(o*p+1);m=e*u*(p*p+s-2*a*p)/(2*o);y=2*(a-p)*(o*d-2/u)-2*d;g=f/(m+y);l+=g;if(Math.abs(g)<=1e-10)return l}Proj4js.reportError("phi4z: No convergence");return null}function e4fn(e){var t,n;t=1+e;n=1-e;return Math.sqrt(Math.pow(t,t)*Math.pow(n,n))}function xml2json(e){var t={toObj:function(e){var n={};if(1==e.nodeType){if(e.attributes.length)for(var r=0;r<e.attributes.length;r++)"name"!==e.attributes[r].nodeName&&(n[e.attributes[r].nodeName]=(e.attributes[r].nodeValue||"").toString());if(e.firstChild){for(var i=0,a=0,s=!1,o=e.firstChild;o;o=o.nextSibling)1==o.nodeType?s=!0:3==o.nodeType&&o.nodeValue.match(/[^ \f\n\r\t\v]/)?i++:4==o.nodeType&&a++;if(s)if(2>i&&2>a){t.removeWhite(e);for(var o=e.firstChild;o;o=o.nextSibling){var l=t.removePrefix(o.nodeName);if(3==o.nodeType)n["#text"]=t.escape(o.nodeValue);else if(4==o.nodeType)n["#cdata"]=t.escape(o.nodeValue);else if(n[l])n[l]instanceof Array?n[l][n[l].length]=t.toObj(o):n[l]=[n[l],t.toObj(o)];else{var c=null;o.attributes.getNamedItem("name")&&(c=o.attributes.getNamedItem("name").nodeValue),n[c?c:l]=t.toObj(o)}}}else e.attributes.length?n["#text"]=t.escape(t.innerXml(e)):n=t.escape(t.innerXml(e));else if(i)e.attributes.length?n["#text"]=t.escape(t.innerXml(e)):n=t.escape(t.innerXml(e));else if(a)if(a>1)n=t.escape(t.innerXml(e));else for(var o=e.firstChild;o;o=o.nextSibling)n["#cdata"]=t.escape(o.nodeValue)}e.attributes.length||e.firstChild||(n=null)}else 9==e.nodeType?n=t.toObj(e.documentElement):8==e.nodeType?console.log(e.textContent):alert("unhandled node type: "+e.nodeType);return n},toJson:function(e,n,r){var i=n?'"'+n+'"':"";if(e instanceof Array){for(var a=0,s=e.length;s>a;a++)e[a]=t.toJson(e[a],"",r+"	");i+=(n?":[":"[")+(e.length>1?"\n"+r+"	"+e.join(",\n"+r+"	")+"\n"+r:e.join(""))+"]"}else if(null==e)i+=(n&&":")+"null";else if("object"==typeof e){var o=[];for(var l in e)o[o.length]=t.toJson(e[l],l,r+"	");i+=(n?":{":"{")+(o.length>1?"\n"+r+"	"+o.join(",\n"+r+"	")+"\n"+r:o.join(""))+"}"}else i+="string"==typeof e?(n&&":")+'"'+e.toString()+'"':(n&&":")+e.toString();return i},innerXml:function(e){var t="";if("innerHTML"in e)t=e.innerHTML;else for(var n=function(e){var t="";if(1==e.nodeType){t+="<"+e.nodeName;for(var r=0;r<e.attributes.length;r++)t+=" "+e.attributes[r].nodeName+'="'+(e.attributes[r].nodeValue||"").toString()+'"';if(e.firstChild){t+=">";for(var i=e.firstChild;i;i=i.nextSibling)t+=n(i);t+="</"+e.nodeName+">"}else t+="/>"}else 3==e.nodeType?t+=e.nodeValue:4==e.nodeType&&(t+="<![CDATA["+e.nodeValue+"]]>");return t},r=e.firstChild;r;r=r.nextSibling)t+=n(r);return t},escape:function(e){return e.replace(/[\\]/g,"\\\\").replace(/[\"]/g,'\\"').replace(/[\n]/g,"\\n").replace(/[\r]/g,"\\r")},removeWhite:function(e){e.normalize();for(var n=e.firstChild;n;)if(3==n.nodeType)if(n.nodeValue.match(/[^ \f\n\r\t\v]/))n=n.nextSibling;else{var r=n.nextSibling;e.removeChild(n),n=r}else 1==n.nodeType?(t.removeWhite(n),n=n.nextSibling):n=n.nextSibling;return e},removePrefix:function(e){return e.substring(e.indexOf(":")+1)}};return 9==e.nodeType&&(e=e.documentElement),t.toObj(t.removeWhite(e))}window.Modernizr=function(e,t,n){function r(e){d.cssText=e}function i(e,t){return typeof e===t}var a,s,o,l="2.7.1",c={},u=t.documentElement,h="modernizr",p=t.createElement(h),d=p.style,f=({}.toString," -webkit- -moz- -o- -ms- ".split(" ")),m={},y=[],g=y.slice,v=function(e,n,r,i){var a,s,o,l,c=t.createElement("div"),p=t.body,d=p||t.createElement("body");if(parseInt(r,10))for(;r--;)o=t.createElement("div"),o.id=i?i[r]:h+(r+1),c.appendChild(o);return a=["&#173;",'<style id="s',h,'">',e,"</style>"].join(""),c.id=h,(p?c:d).innerHTML+=a,d.appendChild(c),p||(d.style.background="",d.style.overflow="hidden",l=u.style.overflow,u.style.overflow="hidden",u.appendChild(d)),s=n(c,e),p?c.parentNode.removeChild(c):(d.parentNode.removeChild(d),u.style.overflow=l),!!s},C=function(t){var n=e.matchMedia||e.msMatchMedia;if(n)return n(t).matches;var r;return v("@media "+t+" { #"+h+" { position: absolute; } }",function(t){r="absolute"==(e.getComputedStyle?getComputedStyle(t,null):t.currentStyle).position}),r},L={}.hasOwnProperty;o=i(L,"undefined")||i(L.call,"undefined")?function(e,t){return t in e&&i(e.constructor.prototype[t],"undefined")}:function(e,t){return L.call(e,t)},Function.prototype.bind||(Function.prototype.bind=function(e){var t=this;if("function"!=typeof t)throw new TypeError;var n=g.call(arguments,1),r=function(){if(this instanceof r){var i=function(){};i.prototype=t.prototype;var a=new i,s=t.apply(a,n.concat(g.call(arguments)));return Object(s)===s?s:a}return t.apply(e,n.concat(g.call(arguments)))};return r}),m.canvas=function(){var e=t.createElement("canvas");return!!e.getContext&&!!e.getContext("2d")},m.touch=function(){var n;return"ontouchstart"in e||e.DocumentTouch&&t instanceof DocumentTouch?n=!0:v(["@media (",f.join("touch-enabled),("),h,")","{#modernizr{top:9px;position:absolute}}"].join(""),function(e){n=9===e.offsetTop}),n};for(var T in m)o(m,T)&&(s=T.toLowerCase(),c[s]=m[T](),y.push((c[s]?"":"no-")+s));return c.addTest=function(e,t){if("object"==typeof e)for(var r in e)o(e,r)&&c.addTest(r,e[r]);else{e=e.toLowerCase();if(c[e]!==n)return c;t="function"==typeof t?t():t,"undefined"!=typeof enableClasses&&enableClasses&&(u.className+=" "+(t?"":"no-")+e),c[e]=t}return c},r(""),p=a=null,function(e,t){function n(e,t){var n=e.createElement("p"),r=e.getElementsByTagName("head")[0]||e.documentElement;return n.innerHTML="x<style>"+t+"</style>",r.insertBefore(n.lastChild,r.firstChild)}function r(){var e=v.elements;return"string"==typeof e?e.split(" "):e}function i(e){var t=g[e[m]];return t||(t={},y++,e[m]=y,g[y]=t),t}function a(e,n,r){n||(n=t);if(u)return n.createElement(e);r||(r=i(n));var a;return a=r.cache[e]?r.cache[e].cloneNode():f.test(e)?(r.cache[e]=r.createElem(e)).cloneNode():r.createElem(e),!a.canHaveChildren||d.test(e)||a.tagUrn?a:r.frag.appendChild(a)}function s(e,n){e||(e=t);if(u)return e.createDocumentFragment();n=n||i(e);for(var a=n.frag.cloneNode(),s=0,o=r(),l=o.length;l>s;s++)a.createElement(o[s]);return a}function o(e,t){t.cache||(t.cache={},t.createElem=e.createElement,t.createFrag=e.createDocumentFragment,t.frag=t.createFrag()),e.createElement=function(n){return v.shivMethods?a(n,e,t):t.createElem(n)},e.createDocumentFragment=Function("h,f","return function(){var n=f.cloneNode(),c=n.createElement;h.shivMethods&&("+r().join().replace(/[\w\-]+/g,function(e){return t.createElem(e),t.frag.createElement(e),'c("'+e+'")'})+");return n}")(v,t.frag)}function l(e){e||(e=t);var r=i(e);return v.shivCSS&&!c&&!r.hasCSS&&(r.hasCSS=!!n(e,"article,aside,dialog,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}mark{background:#FF0;color:#000}template{display:none}")),u||o(e,r),e}var c,u,h="3.7.0",p=e.html5||{},d=/^<|^(?:button|map|select|textarea|object|iframe|option|optgroup)$/i,f=/^(?:a|b|code|div|fieldset|h1|h2|h3|h4|h5|h6|i|label|li|ol|p|q|span|strong|style|table|tbody|td|th|tr|ul)$/i,m="_html5shiv",y=0,g={};!function(){try{var e=t.createElement("a");e.innerHTML="<xyz></xyz>",c="hidden"in e,u=1==e.childNodes.length||function(){t.createElement("a");var e=t.createDocumentFragment();return"undefined"==typeof e.cloneNode||"undefined"==typeof e.createDocumentFragment||"undefined"==typeof e.createElement}()}catch(n){c=!0,u=!0}}();var v={elements:p.elements||"abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output progress section summary template time video",version:h,shivCSS:p.shivCSS!==!1,supportsUnknownElements:u,shivMethods:p.shivMethods!==!1,type:"default",shivDocument:l,createElement:a,createDocumentFragment:s};e.html5=v,l(t)}(this,t),c._version=l,c._prefixes=f,c.mq=C,c.testStyles=v,c}(this,this.document),function(e,t,n){function r(e){return"[object Function]"==y.call(e)}function i(e){return"string"==typeof e}function a(){}function s(e){return!e||"loaded"==e||"complete"==e||"uninitialized"==e}function o(){var e=g.shift();v=1,e?e.t?f(function(){("c"==e.t?p.injectCss:p.injectJs)(e.s,0,e.a,e.x,e.e,1)},0):(e(),o()):v=0}function l(e,n,r,i,a,l,c){function u(t){if(!d&&s(h.readyState)&&(C.r=d=1,!v&&o(),h.onload=h.onreadystatechange=null,t)){"img"!=e&&f(function(){T.removeChild(h)},50);for(var r in O[n])O[n].hasOwnProperty(r)&&O[n][r].onload()}}var c=c||p.errorTimeout,h=t.createElement(e),d=0,y=0,C={t:r,s:n,e:a,a:l,x:c};1===O[n]&&(y=1,O[n]=[]),"object"==e?h.data=n:(h.src=n,h.type=e),h.width=h.height="0",h.onerror=h.onload=h.onreadystatechange=function(){u.call(this,y)},g.splice(i,0,C),"img"!=e&&(y||2===O[n]?(T.insertBefore(h,L?null:m),f(u,c)):O[n].push(h))}function c(e,t,n,r,a){return v=0,t=t||"j",i(e)?l("c"==t?b:w,e,t,this.i++,n,r,a):(g.splice(this.i++,0,e),1==g.length&&o()),this}function u(){var e=p;return e.loader={load:c,i:0},e}var h,p,d=t.documentElement,f=e.setTimeout,m=t.getElementsByTagName("script")[0],y={}.toString,g=[],v=0,C="MozAppearance"in d.style,L=C&&!!t.createRange().compareNode,T=L?d:m.parentNode,d=e.opera&&"[object Opera]"==y.call(e.opera),d=!!t.attachEvent&&!d,w=C?"object":d?"script":"img",b=d?"script":w,S=Array.isArray||function(e){return"[object Array]"==y.call(e)},E=[],O={},A={timeout:function(e,t){return t.length&&(e.timeout=t[0]),e}};p=function(e){function t(e){var t,n,r,e=e.split("!"),i=E.length,a=e.pop(),s=e.length,a={url:a,origUrl:a,prefixes:e};for(n=0;s>n;n++)r=e[n].split("="),(t=A[r.shift()])&&(a=t(a,r));for(n=0;i>n;n++)a=E[n](a);return a}function s(e,i,a,s,o){var l=t(e),c=l.autoCallback;l.url.split(".").pop().split("?").shift(),l.bypass||(i&&(i=r(i)?i:i[e]||i[s]||i[e.split("/").pop().split("?")[0]]),l.instead?l.instead(e,i,a,s,o):(O[l.url]?l.noexec=!0:O[l.url]=1,a.load(l.url,l.forceCSS||!l.forceJS&&"css"==l.url.split(".").pop().split("?").shift()?"c":n,l.noexec,l.attrs,l.timeout),(r(i)||r(c))&&a.load(function(){u(),i&&i(l.origUrl,o,s),c&&c(l.origUrl,o,s),O[l.url]=2})))}function o(e,t){function n(e,n){if(e){if(i(e))n||(h=function(){var e=[].slice.call(arguments);p.apply(this,e),d()}),s(e,h,t,0,c);else if(Object(e)===e)for(l in o=function(){var t,n=0;for(t in e)e.hasOwnProperty(t)&&n++;return n}(),e)e.hasOwnProperty(l)&&(!n&&!--o&&(r(h)?h=function(){var e=[].slice.call(arguments);p.apply(this,e),d()}:h[l]=function(e){return function(){var t=[].slice.call(arguments);e&&e.apply(this,t),d()}}(p[l])),s(e[l],h,t,l,c))}else!n&&d()}var o,l,c=!!e.test,u=e.load||e.both,h=e.callback||a,p=h,d=e.complete||a;n(c?e.yep:e.nope,!!u),u&&n(u)}var l,c,h=this.yepnope.loader;if(i(e))s(e,0,h,0);else if(S(e))for(l=0;l<e.length;l++)c=e[l],i(c)?s(c,0,h,0):S(c)?p(c):Object(c)===c&&o(c,h);else Object(e)===e&&o(e,h)},p.addPrefix=function(e,t){A[e]=t},p.addFilter=function(e){E.push(e)},p.errorTimeout=1e4,null==t.readyState&&t.addEventListener&&(t.readyState="loading",t.addEventListener("DOMContentLoaded",h=function(){t.removeEventListener("DOMContentLoaded",h,0),t.readyState="complete"},0)),e.yepnope=u(),e.yepnope.executeStack=o,e.yepnope.injectJs=function(e,n,r,i,l,c){var u,h,d=t.createElement("script"),i=i||p.errorTimeout;d.src=e;for(h in r)d.setAttribute(h,r[h]);n=c?o:n||a,d.onreadystatechange=d.onload=function(){!u&&s(d.readyState)&&(u=1,n(),d.onload=d.onreadystatechange=null)},f(function(){u||(u=1,n(1))},i),l?d.onload():m.parentNode.insertBefore(d,m)},e.yepnope.injectCss=function(e,n,r,i,s,l){var c,i=t.createElement("link"),n=l?o:n||a;i.href=e,i.rel="stylesheet",i.type="text/css";for(c in r)i.setAttribute(c,r[c]);s||(m.parentNode.insertBefore(i,m),f(n,0))}}(this,document),Modernizr.load=function(){yepnope.apply(window,[].slice.call(arguments,0))};!function(e,t){"function"==typeof define&&define.amd&&define.amd.dust===!0?define("dust.core",[],t):"object"==typeof exports?module.exports=t():e.dust=t()}(this,function(){function c(e,t){return e?"function"==typeof e&&e.template?e.template:n.isTemplateFn(e)?e:t!==!1?n.cache[e]:void 0:void 0}function o(e,t,r){if(!e)return t.setError(new Error("No template or template name provided to render"));var a=c(e,n.config.cache);return a?a(t,i.wrap(r,a.templateName)):n.onLoad?t.map(function(t){function a(e,a){var o;if(e)return t.setError(e);if(o=c(a,!1)||c(s,n.config.cache),!o){if(!n.compile)return t.setError(new Error("Dust compiler not available"));o=n.loadSource(n.compile(a,s))}o(t,i.wrap(r,o.templateName)).end()}var s=e;3===n.onLoad.length?n.onLoad(s,r.options,a):n.onLoad(s,a)}):t.setError(new Error("Template Not Found: "+e))}function i(e,t,n,r,i){void 0===e||e instanceof l||(e=new l(e));this.stack=e;this.global=t;this.options=n;this.blocks=r;this.templateName=i}function k(e,t,n){return function(r){return e.push(r)._get(t,n)}}function l(e,t,n,r){this.tail=t;this.isObject=e&&"object"==typeof e;this.head=e;this.index=n;this.of=r}function a(e){this.head=new t(this);this.callback=e;this.out=""}function e(){this.head=new t(this)}function t(e,t,n){this.root=e;this.next=t;this.data=[];this.flushable=!1;this.taps=n}function s(e,t){this.head=e;this.tail=t}var n={version:"2.7.1"},d="NONE",r="ERROR",u="WARN",v="INFO",f="DEBUG",y=function(){},h;n.config={whitespace:!1,amd:!1,cjs:!1,cache:!0};n._aliases={write:"w",end:"e",map:"m",render:"r",reference:"f",section:"s",exists:"x",notexists:"nx",block:"b",partial:"p",helper:"h"},function(){var e,t,r={DEBUG:0,INFO:1,WARN:2,ERROR:3,NONE:4};"undefined"!=typeof console&&console.log?(e=console.log,t="function"==typeof e?function(){e.apply(console,arguments)}:function(){e(Array.prototype.slice.apply(arguments).join(" "))}):t=y;n.log=function(e,i){i=i||v;r[i]>=r[n.debugLevel]&&t("[DUST:"+i+"]",e)};n.debugLevel=d;"undefined"!=typeof process&&process.env&&/\bdust\b/.test(process.env.DEBUG)&&(n.debugLevel=f)}();n.helpers={};n.cache={};n.register=function(e,t){e&&(t.templateName=e,n.config.cache!==!1&&(n.cache[e]=t))};n.render=function(e,t,n){var r=new a(n).head;try{o(e,r,t).end()}catch(i){r.setError(i)}};n.stream=function(t,r){var i=new e,a=i.head;return n.nextTick(function(){try{o(t,a,r).end()}catch(e){a.setError(e)}}),i};n.loadSource=function(source){return eval(source)};n.isArray=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};n.nextTick=function(){return function(e){setTimeout(e,0)}}();n.isEmpty=function(e){return 0===e?!1:n.isArray(e)&&!e.length?!0:!e};n.isEmptyObject=function(e){var t;if(null===e||void 0===e||e.length>0)return!1;for(t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0};n.isTemplateFn=function(e){return"function"==typeof e&&e.__dustBody};n.isThenable=function(e){return e&&"object"==typeof e&&"function"==typeof e.then};n.isStreamable=function(e){return e&&"function"==typeof e.on};n.filter=function(e,t,r){var i,a,s;if(r)for(i=0,a=r.length;a>i;i++)s=r[i],"s"===s?t=null:"function"==typeof n.filters[s]?e=n.filters[s](e):n.log("Invalid filter `"+s+"`",u);return t&&(e=n.filters[t](e)),e};n.filters={h:function(e){return n.escapeHtml(e)},j:function(e){return n.escapeJs(e)},u:encodeURI,uc:encodeURIComponent,js:function(e){return n.escapeJSON(e)},jp:function(e){return JSON?JSON.parse(e):(n.log("JSON is undefined; could not parse `"+e+"`",u),e)}};n.makeBase=n.context=function(e,t){return new i(void 0,e,t)};i.wrap=function(e,t){return e instanceof i?e:new i(e,{},{},null,t)};i.prototype.get=function(e,t){return"string"==typeof e&&("."===e[0]&&(t=!0,e=e.substr(1)),e=e.split(".")),this._get(t,e)};i.prototype._get=function(e,t){var i,a,s,o,l,c=this.stack||{},u=1;if(a=t[0],s=t.length,e&&0===s)o=c,c=c.head;else{if(e)c&&(c=c.head?c.head[a]:void 0);else{for(;c&&(!c.isObject||(o=c.head,i=c.head[a],void 0===i));)c=c.tail;c=void 0!==i?i:this.global&&this.global[a]}for(;c&&s>u;){if(n.isThenable(c))return c.then(k(this,e,t.slice(u)));o=c;c=c[t[u]];u++}}return"function"==typeof c?(l=function(){try{return c.apply(o,arguments)}catch(e){throw n.log(e,r),e}},l.__dustBody=!!c.__dustBody,l):(void 0===c&&n.log("Cannot find reference `{"+t.join(".")+"}` in template `"+this.getTemplateName()+"`",v),c)};i.prototype.getPath=function(e,t){return this._get(e,t)};i.prototype.push=function(e,t,r){return void 0===e?(n.log("Not pushing an undefined variable onto the context",v),this):this.rebase(new l(e,this.stack,t,r))};i.prototype.pop=function(){var e=this.current();return this.stack=this.stack&&this.stack.tail,e};i.prototype.rebase=function(e){return new i(e,this.global,this.options,this.blocks,this.getTemplateName())};i.prototype.clone=function(){var e=this.rebase();return e.stack=this.stack,e};i.prototype.current=function(){return this.stack&&this.stack.head};i.prototype.getBlock=function(e){var r,i,a;if("function"==typeof e&&(e=e(new t,this).data.join("")),r=this.blocks,!r)return n.log("No blocks for context `"+e+"` in template `"+this.getTemplateName()+"`",f),!1;for(i=r.length;i--;)if(a=r[i][e])return a;return n.log("Malformed template `"+this.getTemplateName()+"` was missing one or more blocks."),!1};i.prototype.shiftBlocks=function(e){var t,n=this.blocks;return e?(t=n?n.concat([e]):[e],new i(this.stack,this.global,this.options,t,this.getTemplateName())):this};i.prototype.resolve=function(e){var n;return"function"!=typeof e?e:(n=(new t).render(e,this),n instanceof t?n.data.join(""):n)};i.prototype.getTemplateName=function(){return this.templateName};a.prototype.flush=function(){for(var e=this.head;e;){if(!e.flushable)return e.error?(this.callback(e.error),n.log("Rendering failed with error `"+e.error+"`",r),void(this.flush=y)):void 0;this.out+=e.data.join("");e=e.next;this.head=e}this.callback(null,this.out)};e.prototype.flush=function(){for(var e=this.head;e;){if(!e.flushable)return e.error?(this.emit("error",e.error),this.emit("end"),n.log("Streaming failed with error `"+e.error+"`",r),void(this.flush=y)):void 0;this.emit("data",e.data.join(""));e=e.next;this.head=e}this.emit("end")};e.prototype.emit=function(e,t){var r,i,a=this.events||{},s=a[e]||[];if(!s.length)return n.log("Stream broadcasting, but no listeners for `"+e+"`",f),!1;for(s=s.slice(0),r=0,i=s.length;i>r;r++)s[r](t);return!0};e.prototype.on=function(e,t){var r=this.events=this.events||{},i=r[e]=r[e]||[];return"function"!=typeof t?n.log("No callback function provided for `"+e+"` event listener",u):i.push(t),this};e.prototype.pipe=function(e){if("function"!=typeof e.write||"function"!=typeof e.end)return n.log("Incompatible stream passed to `pipe`",u),this;var t=!1;return"function"==typeof e.emit&&e.emit("pipe",this),"function"==typeof e.on&&e.on("error",function(){t=!0}),this.on("data",function(i){if(!t)try{e.write(i,"utf8")}catch(a){n.log(a,r)}}).on("end",function(){if(!t)try{e.end();t=!0}catch(i){n.log(i,r)}})};t.prototype.write=function(e){var t=this.taps;return t&&(e=t.go(e)),this.data.push(e),this};t.prototype.end=function(e){return e&&this.write(e),this.flushable=!0,this.root.flush(),this};t.prototype.map=function(e){var i=new t(this.root,this.next,this.taps),a=new t(this.root,i,this.taps);this.next=a;this.flushable=!0;try{e(a)}catch(s){n.log(s,r);a.setError(s)}return i};t.prototype.tap=function(e){var t=this.taps;return this.taps=t?t.push(e):new s(e),this};t.prototype.untap=function(){return this.taps=this.taps.tail,this};t.prototype.render=function(e,t){return e(this,t)};t.prototype.reference=function(e,r,i,a){return"function"==typeof e?(e=e.apply(r.current(),[this,r,null,{auto:i,filters:a}]),e instanceof t?e:this.reference(e,r,i,a)):n.isThenable(e)?this.await(e,r,null,i,a):n.isStreamable(e)?this.stream(e,r,null,i,a):n.isEmpty(e)?this:this.write(n.filter(e,i,a))};t.prototype.section=function(e,i,a,s){var o,l,c,u=a.block,h=a["else"],p=this;if("function"==typeof e&&!n.isTemplateFn(e)){try{e=e.apply(i.current(),[this,i,a,s])}catch(d){return n.log(d,r),this.setError(d)}if(e instanceof t)return e}if(n.isEmptyObject(s)||(i=i.push(s)),n.isArray(e)){if(u){if(l=e.length,l>0){for(c=i.stack&&i.stack.head||{},c.$len=l,o=0;l>o;o++)c.$idx=o,p=u(p,i.push(e[o],o,l));return c.$idx=void 0,c.$len=void 0,p}if(h)return h(this,i)}}else{if(n.isThenable(e))return this.await(e,i,a);if(n.isStreamable(e))return this.stream(e,i,a);if(e===!0){if(u)return u(this,i)}else if(e||0===e){if(u)return u(this,i.push(e))}else if(h)return h(this,i)}return n.log("Section without corresponding key in template `"+i.getTemplateName()+"`",f),this};t.prototype.exists=function(e,t,r){var i=r.block,a=r["else"];if(n.isEmpty(e)){if(a)return a(this,t)}else{if(i)return i(this,t);n.log("No block for exists check in template `"+t.getTemplateName()+"`",f)}return this};t.prototype.notexists=function(e,t,r){var i=r.block,a=r["else"];if(n.isEmpty(e)){if(i)return i(this,t);n.log("No block for not-exists check in template `"+t.getTemplateName()+"`",f)}else if(a)return a(this,t);return this};t.prototype.block=function(e,t,n){var r=e||n.block;return r?r(this,t):this};t.prototype.partial=function(e,t,r,i){var a;return void 0===i&&(i=r,r=t),n.isEmptyObject(i)||(r=r.clone(),a=r.pop(),r=r.push(i).push(a)),n.isTemplateFn(e)?this.capture(e,t,function(e,t){r.templateName=e;o(e,t,r).end()}):(r.templateName=e,o(e,this,r))};t.prototype.helper=function(e,t,i,a){var s,o=this;if(!n.helpers[e])return n.log("Helper `"+e+"` does not exist",u),o;try{return s=n.helpers[e](o,t,i,a),n.isThenable(s)?this.await(s,t,i):s}catch(l){return n.log("Error in helper `"+e+"`: "+l.message,r),o.setError(l)}};t.prototype.await=function(e,t,r,i,a){var s=r&&r.block,o=r&&r.error;return this.map(function(r){e.then(function(e){s?r.render(s,t.push(e)).end():r.reference(e,t,i,a).end()},function(e){o?r.render(o,t.push(e)).end():(n.log("Unhandled promise rejection in `"+t.getTemplateName()+"`"),r.end())})})};t.prototype.stream=function(e,t,r,i,a){var s=r&&r.block,o=r&&r.error;return this.map(function(r){var l=!1;e.on("data",function(e){l||(r=s?r.map(function(n){n.render(s,t.push(e)).end()}):r.reference(e,t,i,a))}).on("error",function(e){l||(o?r.render(o,t.push(e)):n.log("Unhandled stream error in `"+t.getTemplateName()+"`"),l||(l=!0,r.end()))}).on("end",function(){l||(l=!0,r.end())})})};t.prototype.capture=function(e,t,n){return this.map(function(r){var i=new a(function(e,t){e?r.setError(e):n(t,r)});e(i.head,t).end()})};t.prototype.setError=function(e){return this.error=e,this.root.flush(),this};for(h in t.prototype)n._aliases[h]&&(t.prototype[n._aliases[h]]=t.prototype[h]);s.prototype.push=function(e){return new s(e,this)};s.prototype.go=function(e){for(var t=this;t;)e=t.head(e),t=t.tail;return e};var g=/[&<>"']/,nt=/&/g,p=/</g,tt=/>/g,it=/\"/g,rt=/\'/g;n.escapeHtml=function(e){return"string"==typeof e||e&&"function"==typeof e.toString?("string"!=typeof e&&(e=e.toString()),g.test(e)?e.replace(nt,"&amp;").replace(p,"&lt;").replace(tt,"&gt;").replace(it,"&quot;").replace(rt,"&#39;"):e):e};var ut=/\\/g,ft=/\//g,et=/\r/g,w=/\u2028/g,b=/\u2029/g,ot=/\n/g,st=/\f/g,ht=/'/g,ct=/"/g,lt=/\t/g;return n.escapeJs=function(e){return"string"==typeof e?e.replace(ut,"\\\\").replace(ft,"\\/").replace(ct,'\\"').replace(ht,"\\'").replace(et,"\\r").replace(w,"\\u2028").replace(b,"\\u2029").replace(ot,"\\n").replace(st,"\\f").replace(lt,"\\t"):e},n.escapeJSON=function(e){return JSON?JSON.stringify(e).replace(w,"\\u2028").replace(b,"\\u2029").replace(p,"\\u003c"):(n.log("JSON is undefined; could not escape `"+e+"`",u),e)},n}),function(e,t){"function"==typeof define&&define.amd&&define.amd.dust===!0?define("dust.parse",["dust.core"],function(e){return t(e).parse}):"object"==typeof exports?module.exports=t(require("./dust")):t(e.dust)}(this,function(e){var t=function(){function e(e,t){function n(){this.constructor=e}n.prototype=t.prototype;e.prototype=new n}function t(e,t,n,r,i,a){this.message=e;this.expected=t;this.found=n;this.offset=r;this.line=i;this.column=a;this.name="SyntaxError"}function n(e){function n(){return a(bn).line}function r(){return a(bn).column}function i(e){throw o(e,null,bn)}function a(t){function n(t,n,r){for(var i,a=n;r>a;a++)i=e.charAt(a),"\n"===i?(t.seenCR||t.line++,t.column=1,t.seenCR=!1):"\r"===i||"\u2028"===i||"\u2029"===i?(t.line++,t.column=1,t.seenCR=!0):(t.column++,t.seenCR=!1)}return Sn!==t&&(Sn>t&&(Sn=0,En={line:1,column:1,seenCR:!1}),n(En,Sn,t),Sn=t),En}function s(e){On>wn||(wn>On&&(On=wn,An=[]),An.push(e))}function o(n,r,i){function s(e){var t=1;for(e.sort(function(e,t){return e.description<t.description?-1:e.description>t.description?1:0});t<e.length;)e[t-1]===e[t]?e.splice(t,1):t++}function o(e,t){function n(e){function t(e){return e.charCodeAt(0).toString(16).toUpperCase()}return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(e){return"\\x0"+t(e)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(e){return"\\x"+t(e)}).replace(/[\u0180-\u0FFF]/g,function(e){return"\\u0"+t(e)}).replace(/[\u1080-\uFFFF]/g,function(e){return"\\u"+t(e)})}for(var r,i,a=new Array(e.length),s=0;s<e.length;s++)a[s]=e[s].description;return r=e.length>1?a.slice(0,-1).join(", ")+" or "+a[e.length-1]:a[0],i=t?'"'+n(t)+'"':"end of input","Expected "+r+" but "+i+" found."}var l=a(i),c=i<e.length?e.charAt(i):null;return null!==r&&s(r),new t(null!==n?n:o(r,c),r,c,i,l.line,l.column)}function l(){return c()}function c(){var e,t,n;for(e=wn,t=[],n=u();n!==X;)t.push(n),n=u();return t!==X&&(bn=e,t=J(t)),e=t}function u(){var e;return e=D(),e===X&&(e=F(),e===X&&(e=h(),e===X&&(e=v(),e===X&&(e=L(),e===X&&(e=g(),e===X&&(e=k())))))),e}function h(){var t,n,r,i,a,o,l,u;if(xn++,t=wn,n=p(),n!==X){for(r=[],i=H();i!==X;)r.push(i),i=H();r!==X?(i=$(),i!==X?(a=c(),a!==X?(o=y(),o!==X?(l=d(),l===X&&(l=te),l!==X?(bn=wn,u=ne(n,a,o,l),u=u?re:ee,u!==X?(bn=t,n=ie(n,a,o,l),t=n):(wn=t,t=ee)):(wn=t,t=ee)):(wn=t,t=ee)):(wn=t,t=ee)):(wn=t,t=ee)):(wn=t,t=ee)}else wn=t,t=ee;if(t===X)if(t=wn,n=p(),n!==X){for(r=[],i=H();i!==X;)r.push(i),i=H();r!==X?(47===e.charCodeAt(wn)?(i=ae,wn++):(i=X,0===xn&&s(se)),i!==X?(a=$(),a!==X?(bn=t,n=oe(n),t=n):(wn=t,t=ee)):(wn=t,t=ee)):(wn=t,t=ee)}else wn=t,t=ee;return xn--,t===X&&(n=X,0===xn&&s(Z)),t}function p(){var t,n,r,i,a,o,l;if(t=wn,n=B(),n!==X)if(le.test(e.charAt(wn))?(r=e.charAt(wn),wn++):(r=X,0===xn&&s(ce)),r!==X){for(i=[],a=H();a!==X;)i.push(a),a=H();i!==X?(a=T(),a!==X?(o=f(),o!==X?(l=m(),l!==X?(bn=t,n=ue(r,a,o,l),t=n):(wn=t,t=ee)):(wn=t,t=ee)):(wn=t,t=ee)):(wn=t,t=ee)}else wn=t,t=ee;else wn=t,t=ee;return t}function d(){var t,n,r,i,a,o,l;if(xn++,t=wn,n=B(),n!==X)if(47===e.charCodeAt(wn)?(r=ae,wn++):(r=X,0===xn&&s(se)),r!==X){for(i=[],a=H();a!==X;)i.push(a),a=H();if(i!==X)if(a=T(),a!==X){for(o=[],l=H();l!==X;)o.push(l),l=H();o!==X?(l=$(),l!==X?(bn=t,n=pe(a),t=n):(wn=t,t=ee)):(wn=t,t=ee)}else wn=t,t=ee;else wn=t,t=ee}else wn=t,t=ee;else wn=t,t=ee;return xn--,t===X&&(n=X,0===xn&&s(he)),t}function f(){var t,n,r,i;return t=wn,n=wn,58===e.charCodeAt(wn)?(r=de,wn++):(r=X,0===xn&&s(fe)),r!==X?(i=T(),i!==X?(bn=n,r=me(i),n=r):(wn=n,n=ee)):(wn=n,n=ee),n===X&&(n=te),n!==X&&(bn=t,n=ye(n)),t=n}function m(){var t,n,r,i,a,o,l;if(xn++,t=wn,n=[],r=wn,i=[],a=H(),a!==X)for(;a!==X;)i.push(a),a=H();else i=ee;for(i!==X?(a=x(),a!==X?(61===e.charCodeAt(wn)?(o=ve,wn++):(o=X,0===xn&&s(Ce)),o!==X?(l=w(),l===X&&(l=T(),l===X&&(l=N())),l!==X?(bn=r,i=Le(a,l),r=i):(wn=r,r=ee)):(wn=r,r=ee)):(wn=r,r=ee)):(wn=r,r=ee);r!==X;){if(n.push(r),r=wn,i=[],a=H(),a!==X)for(;a!==X;)i.push(a),a=H();else i=ee;i!==X?(a=x(),a!==X?(61===e.charCodeAt(wn)?(o=ve,wn++):(o=X,0===xn&&s(Ce)),o!==X?(l=w(),l===X&&(l=T(),l===X&&(l=N())),l!==X?(bn=r,i=Le(a,l),r=i):(wn=r,r=ee)):(wn=r,r=ee)):(wn=r,r=ee)):(wn=r,r=ee)}return n!==X&&(bn=t,n=Te(n)),t=n,xn--,t===X&&(n=X,0===xn&&s(ge)),t}function y(){var t,n,r,i,a,o,l,u;for(xn++,t=wn,n=[],r=wn,i=B(),i!==X?(58===e.charCodeAt(wn)?(a=de,wn++):(a=X,0===xn&&s(fe)),a!==X?(o=x(),o!==X?(l=$(),l!==X?(u=c(),u!==X?(bn=r,i=Le(o,u),r=i):(wn=r,r=ee)):(wn=r,r=ee)):(wn=r,r=ee)):(wn=r,r=ee)):(wn=r,r=ee);r!==X;)n.push(r),r=wn,i=B(),i!==X?(58===e.charCodeAt(wn)?(a=de,wn++):(a=X,0===xn&&s(fe)),a!==X?(o=x(),o!==X?(l=$(),l!==X?(u=c(),u!==X?(bn=r,i=Le(o,u),r=i):(wn=r,r=ee)):(wn=r,r=ee)):(wn=r,r=ee)):(wn=r,r=ee)):(wn=r,r=ee);return n!==X&&(bn=t,n=be(n)),t=n,xn--,t===X&&(n=X,0===xn&&s(we)),t}function g(){var e,t,n,r,i;return xn++,e=wn,t=B(),t!==X?(n=T(),n!==X?(r=C(),r!==X?(i=$(),i!==X?(bn=e,t=Ee(n,r),e=t):(wn=e,e=ee)):(wn=e,e=ee)):(wn=e,e=ee)):(wn=e,e=ee),xn--,e===X&&(t=X,0===xn&&s(Se)),e}function v(){var t,n,r,i,a,o,l,c,u,h;if(xn++,t=wn,n=B(),n!==X)if(62===e.charCodeAt(wn)?(r=Ae,wn++):(r=X,0===xn&&s(xe)),r===X&&(43===e.charCodeAt(wn)?(r=Pe,wn++):(r=X,0===xn&&s(_e))),r!==X){for(i=[],a=H();a!==X;)i.push(a),a=H();if(i!==X)if(a=wn,o=x(),o!==X&&(bn=a,o=Ne(o)),a=o,a===X&&(a=N()),a!==X)if(o=f(),o!==X)if(l=m(),l!==X){for(c=[],u=H();u!==X;)c.push(u),u=H();c!==X?(47===e.charCodeAt(wn)?(u=ae,wn++):(u=X,0===xn&&s(se)),u!==X?(h=$(),h!==X?(bn=t,n=Me(r,a,o,l),t=n):(wn=t,t=ee)):(wn=t,t=ee)):(wn=t,t=ee)}else wn=t,t=ee;else wn=t,t=ee;else wn=t,t=ee;else wn=t,t=ee}else wn=t,t=ee;else wn=t,t=ee;return xn--,t===X&&(n=X,0===xn&&s(Oe)),t}function C(){var t,n,r,i,a;for(xn++,t=wn,n=[],r=wn,124===e.charCodeAt(wn)?(i=Ie,wn++):(i=X,0===xn&&s(Re)),i!==X?(a=x(),a!==X?(bn=r,i=me(a),r=i):(wn=r,r=ee)):(wn=r,r=ee);r!==X;)n.push(r),r=wn,124===e.charCodeAt(wn)?(i=Ie,wn++):(i=X,0===xn&&s(Re)),i!==X?(a=x(),a!==X?(bn=r,i=me(a),r=i):(wn=r,r=ee)):(wn=r,r=ee);return n!==X&&(bn=t,n=De(n)),t=n,xn--,t===X&&(n=X,0===xn&&s(ke)),t}function L(){var t,n,r,i,a;return xn++,t=wn,n=B(),n!==X?(126===e.charCodeAt(wn)?(r=je,wn++):(r=X,0===xn&&s(Be)),r!==X?(i=x(),i!==X?(a=$(),a!==X?(bn=t,n=$e(i),t=n):(wn=t,t=ee)):(wn=t,t=ee)):(wn=t,t=ee)):(wn=t,t=ee),xn--,t===X&&(n=X,0===xn&&s(Fe)),t}function T(){var e,t;return xn++,e=wn,t=A(),t!==X&&(bn=e,t=Ge(t)),e=t,e===X&&(e=wn,t=x(),t!==X&&(bn=e,t=ze(t)),e=t),xn--,e===X&&(t=X,0===xn&&s(Ue)),e}function w(){var e,t;return xn++,e=wn,t=b(),t===X&&(t=O()),t!==X&&(bn=e,t=We(t)),e=t,xn--,e===X&&(t=X,0===xn&&s(He)),e}function b(){var t,n,r,i;return xn++,t=wn,n=O(),n!==X?(46===e.charCodeAt(wn)?(r=qe,wn++):(r=X,0===xn&&s(Ye)),r!==X?(i=S(),i!==X?(bn=t,n=Xe(n,i),t=n):(wn=t,t=ee)):(wn=t,t=ee)):(wn=t,t=ee),xn--,t===X&&(n=X,0===xn&&s(Ve)),t}function S(){var t,n,r;if(xn++,t=wn,n=[],Qe.test(e.charAt(wn))?(r=e.charAt(wn),wn++):(r=X,0===xn&&s(Je)),r!==X)for(;r!==X;)n.push(r),Qe.test(e.charAt(wn))?(r=e.charAt(wn),wn++):(r=X,0===xn&&s(Je));else n=ee;return n!==X&&(bn=t,n=Ze(n)),t=n,xn--,t===X&&(n=X,0===xn&&s(Ke)),t}function E(){var t,n,r;return xn++,t=wn,45===e.charCodeAt(wn)?(n=tt,wn++):(n=X,0===xn&&s(nt)),n!==X?(r=S(),r!==X?(bn=t,n=rt(n,r),t=n):(wn=t,t=ee)):(wn=t,t=ee),xn--,t===X&&(n=X,0===xn&&s(et)),t}function O(){var e,t;return xn++,e=E(),e===X&&(e=S()),xn--,e===X&&(t=X,0===xn&&s(it)),e}function A(){var t,n,r,i;if(xn++,t=wn,n=x(),n===X&&(n=te),n!==X){if(r=[],i=_(),i===X&&(i=P()),i!==X)for(;i!==X;)r.push(i),i=_(),i===X&&(i=P());else r=ee;r!==X?(bn=t,n=st(n,r),t=n):(wn=t,t=ee)}else wn=t,t=ee;if(t===X)if(t=wn,46===e.charCodeAt(wn)?(n=qe,wn++):(n=X,0===xn&&s(Ye)),n!==X){for(r=[],i=_(),i===X&&(i=P());i!==X;)r.push(i),i=_(),i===X&&(i=P());r!==X?(bn=t,n=ot(r),t=n):(wn=t,t=ee)}else wn=t,t=ee;return xn--,t===X&&(n=X,0===xn&&s(at)),t}function x(){var t,n,r,i;if(xn++,t=wn,ct.test(e.charAt(wn))?(n=e.charAt(wn),wn++):(n=X,0===xn&&s(ut)),n!==X){for(r=[],ht.test(e.charAt(wn))?(i=e.charAt(wn),wn++):(i=X,0===xn&&s(pt));i!==X;)r.push(i),ht.test(e.charAt(wn))?(i=e.charAt(wn),wn++):(i=X,0===xn&&s(pt));r!==X?(bn=t,n=dt(n,r),t=n):(wn=t,t=ee)}else wn=t,t=ee;return xn--,t===X&&(n=X,0===xn&&s(lt)),t}function P(){var t,n,r,i,a,o;if(xn++,t=wn,n=wn,r=U(),r!==X){if(i=wn,a=[],Qe.test(e.charAt(wn))?(o=e.charAt(wn),
wn++):(o=X,0===xn&&s(Je)),o!==X)for(;o!==X;)a.push(o),Qe.test(e.charAt(wn))?(o=e.charAt(wn),wn++):(o=X,0===xn&&s(Je));else a=ee;a!==X&&(bn=i,a=mt(a));i=a;i===X&&(i=T());i!==X?(a=G(),a!==X?(bn=n,r=yt(i),n=r):(wn=n,n=ee)):(wn=n,n=ee)}else wn=n,n=ee;return n!==X?(r=_(),r===X&&(r=te),r!==X?(bn=t,n=gt(n,r),t=n):(wn=t,t=ee)):(wn=t,t=ee),xn--,t===X&&(n=X,0===xn&&s(ft)),t}function _(){var t,n,r,i,a;if(xn++,t=wn,n=[],r=wn,46===e.charCodeAt(wn)?(i=qe,wn++):(i=X,0===xn&&s(Ye)),i!==X?(a=x(),a!==X?(bn=r,i=Ct(a),r=i):(wn=r,r=ee)):(wn=r,r=ee),r!==X)for(;r!==X;)n.push(r),r=wn,46===e.charCodeAt(wn)?(i=qe,wn++):(i=X,0===xn&&s(Ye)),i!==X?(a=x(),a!==X?(bn=r,i=Ct(a),r=i):(wn=r,r=ee)):(wn=r,r=ee);else n=ee;return n!==X?(r=P(),r===X&&(r=te),r!==X?(bn=t,n=Lt(n,r),t=n):(wn=t,t=ee)):(wn=t,t=ee),xn--,t===X&&(n=X,0===xn&&s(vt)),t}function N(){var t,n,r,i;if(xn++,t=wn,34===e.charCodeAt(wn)?(n=wt,wn++):(n=X,0===xn&&s(bt)),n!==X?(34===e.charCodeAt(wn)?(r=wt,wn++):(r=X,0===xn&&s(bt)),r!==X?(bn=t,n=St(),t=n):(wn=t,t=ee)):(wn=t,t=ee),t===X&&(t=wn,34===e.charCodeAt(wn)?(n=wt,wn++):(n=X,0===xn&&s(bt)),n!==X?(r=I(),r!==X?(34===e.charCodeAt(wn)?(i=wt,wn++):(i=X,0===xn&&s(bt)),i!==X?(bn=t,n=Et(r),t=n):(wn=t,t=ee)):(wn=t,t=ee)):(wn=t,t=ee),t===X))if(t=wn,34===e.charCodeAt(wn)?(n=wt,wn++):(n=X,0===xn&&s(bt)),n!==X){if(r=[],i=M(),i!==X)for(;i!==X;)r.push(i),i=M();else r=ee;r!==X?(34===e.charCodeAt(wn)?(i=wt,wn++):(i=X,0===xn&&s(bt)),i!==X?(bn=t,n=Ot(r),t=n):(wn=t,t=ee)):(wn=t,t=ee)}else wn=t,t=ee;return xn--,t===X&&(n=X,0===xn&&s(Tt)),t}function M(){var e,t;return e=L(),e===X&&(e=g(),e===X&&(e=wn,t=I(),t!==X&&(bn=e,t=At(t)),e=t)),e}function k(){var t,n,r,i,a,o,l,c;if(xn++,t=wn,n=z(),n!==X){for(r=[],i=H();i!==X;)r.push(i),i=H();r!==X?(bn=t,n=Pt(n,r),t=n):(wn=t,t=ee)}else wn=t,t=ee;if(t===X){if(t=wn,n=[],r=wn,i=wn,xn++,a=j(),xn--,a===X?i=re:(wn=i,i=ee),i!==X?(a=wn,xn++,o=D(),xn--,o===X?a=re:(wn=a,a=ee),a!==X?(o=wn,xn++,l=F(),xn--,l===X?o=re:(wn=o,o=ee),o!==X?(l=wn,xn++,c=z(),xn--,c===X?l=re:(wn=l,l=ee),l!==X?(e.length>wn?(c=e.charAt(wn),wn++):(c=X,0===xn&&s(_t)),c!==X?(bn=r,i=Nt(c),r=i):(wn=r,r=ee)):(wn=r,r=ee)):(wn=r,r=ee)):(wn=r,r=ee)):(wn=r,r=ee),r!==X)for(;r!==X;)n.push(r),r=wn,i=wn,xn++,a=j(),xn--,a===X?i=re:(wn=i,i=ee),i!==X?(a=wn,xn++,o=D(),xn--,o===X?a=re:(wn=a,a=ee),a!==X?(o=wn,xn++,l=F(),xn--,l===X?o=re:(wn=o,o=ee),o!==X?(l=wn,xn++,c=z(),xn--,c===X?l=re:(wn=l,l=ee),l!==X?(e.length>wn?(c=e.charAt(wn),wn++):(c=X,0===xn&&s(_t)),c!==X?(bn=r,i=Nt(c),r=i):(wn=r,r=ee)):(wn=r,r=ee)):(wn=r,r=ee)):(wn=r,r=ee)):(wn=r,r=ee);else n=ee;n!==X&&(bn=t,n=Mt(n));t=n}return xn--,t===X&&(n=X,0===xn&&s(xt)),t}function I(){var t,n,r,i,a;if(xn++,t=wn,n=[],r=wn,i=wn,xn++,a=j(),xn--,a===X?i=re:(wn=i,i=ee),i!==X?(a=R(),a===X&&(It.test(e.charAt(wn))?(a=e.charAt(wn),wn++):(a=X,0===xn&&s(Rt))),a!==X?(bn=r,i=Nt(a),r=i):(wn=r,r=ee)):(wn=r,r=ee),r!==X)for(;r!==X;)n.push(r),r=wn,i=wn,xn++,a=j(),xn--,a===X?i=re:(wn=i,i=ee),i!==X?(a=R(),a===X&&(It.test(e.charAt(wn))?(a=e.charAt(wn),wn++):(a=X,0===xn&&s(Rt))),a!==X?(bn=r,i=Nt(a),r=i):(wn=r,r=ee)):(wn=r,r=ee);else n=ee;return n!==X&&(bn=t,n=Dt(n)),t=n,xn--,t===X&&(n=X,0===xn&&s(kt)),t}function R(){var t,n;return t=wn,e.substr(wn,2)===Ft?(n=Ft,wn+=2):(n=X,0===xn&&s(jt)),n!==X&&(bn=t,n=Bt()),t=n}function D(){var t,n,r,i,a,o;if(xn++,t=wn,e.substr(wn,2)===Ut?(n=Ut,wn+=2):(n=X,0===xn&&s(Gt)),n!==X){for(r=[],i=wn,a=wn,xn++,e.substr(wn,2)===zt?(o=zt,wn+=2):(o=X,0===xn&&s(Ht)),xn--,o===X?a=re:(wn=a,a=ee),a!==X?(e.length>wn?(o=e.charAt(wn),wn++):(o=X,0===xn&&s(_t)),o!==X?(bn=i,a=Wt(o),i=a):(wn=i,i=ee)):(wn=i,i=ee);i!==X;)r.push(i),i=wn,a=wn,xn++,e.substr(wn,2)===zt?(o=zt,wn+=2):(o=X,0===xn&&s(Ht)),xn--,o===X?a=re:(wn=a,a=ee),a!==X?(e.length>wn?(o=e.charAt(wn),wn++):(o=X,0===xn&&s(_t)),o!==X?(bn=i,a=Wt(o),i=a):(wn=i,i=ee)):(wn=i,i=ee);r!==X?(e.substr(wn,2)===zt?(i=zt,wn+=2):(i=X,0===xn&&s(Ht)),i!==X?(bn=t,n=Vt(r),t=n):(wn=t,t=ee)):(wn=t,t=ee)}else wn=t,t=ee;return xn--,t===X&&(n=X,0===xn&&s($t)),t}function F(){var t,n,r,i,a,o;if(xn++,t=wn,e.substr(wn,2)===Yt?(n=Yt,wn+=2):(n=X,0===xn&&s(Xt)),n!==X){for(r=[],i=wn,a=wn,xn++,e.substr(wn,2)===Kt?(o=Kt,wn+=2):(o=X,0===xn&&s(Qt)),xn--,o===X?a=re:(wn=a,a=ee),a!==X?(e.length>wn?(o=e.charAt(wn),wn++):(o=X,0===xn&&s(_t)),o!==X?(bn=i,a=Nt(o),i=a):(wn=i,i=ee)):(wn=i,i=ee);i!==X;)r.push(i),i=wn,a=wn,xn++,e.substr(wn,2)===Kt?(o=Kt,wn+=2):(o=X,0===xn&&s(Qt)),xn--,o===X?a=re:(wn=a,a=ee),a!==X?(e.length>wn?(o=e.charAt(wn),wn++):(o=X,0===xn&&s(_t)),o!==X?(bn=i,a=Nt(o),i=a):(wn=i,i=ee)):(wn=i,i=ee);r!==X?(e.substr(wn,2)===Kt?(i=Kt,wn+=2):(i=X,0===xn&&s(Qt)),i!==X?(bn=t,n=Jt(r),t=n):(wn=t,t=ee)):(wn=t,t=ee)}else wn=t,t=ee;return xn--,t===X&&(n=X,0===xn&&s(qt)),t}function j(){var t,n,r,i,a,o,l,c,u,h;if(t=wn,n=B(),n!==X){for(r=[],i=H();i!==X;)r.push(i),i=H();if(r!==X)if(Zt.test(e.charAt(wn))?(i=e.charAt(wn),wn++):(i=X,0===xn&&s(en)),i!==X){for(a=[],o=H();o!==X;)a.push(o),o=H();if(a!==X){if(o=[],l=wn,c=wn,xn++,u=$(),xn--,u===X?c=re:(wn=c,c=ee),c!==X?(u=wn,xn++,h=z(),xn--,h===X?u=re:(wn=u,u=ee),u!==X?(e.length>wn?(h=e.charAt(wn),wn++):(h=X,0===xn&&s(_t)),h!==X?(c=[c,u,h],l=c):(wn=l,l=ee)):(wn=l,l=ee)):(wn=l,l=ee),l!==X)for(;l!==X;)o.push(l),l=wn,c=wn,xn++,u=$(),xn--,u===X?c=re:(wn=c,c=ee),c!==X?(u=wn,xn++,h=z(),xn--,h===X?u=re:(wn=u,u=ee),u!==X?(e.length>wn?(h=e.charAt(wn),wn++):(h=X,0===xn&&s(_t)),h!==X?(c=[c,u,h],l=c):(wn=l,l=ee)):(wn=l,l=ee)):(wn=l,l=ee);else o=ee;if(o!==X){for(l=[],c=H();c!==X;)l.push(c),c=H();l!==X?(c=$(),c!==X?(n=[n,r,i,a,o,l,c],t=n):(wn=t,t=ee)):(wn=t,t=ee)}else wn=t,t=ee}else wn=t,t=ee}else wn=t,t=ee;else wn=t,t=ee}else wn=t,t=ee;return t===X&&(t=g()),t}function B(){var t;return 123===e.charCodeAt(wn)?(t=tn,wn++):(t=X,0===xn&&s(nn)),t}function $(){var t;return 125===e.charCodeAt(wn)?(t=rn,wn++):(t=X,0===xn&&s(an)),t}function U(){var t;return 91===e.charCodeAt(wn)?(t=sn,wn++):(t=X,0===xn&&s(on)),t}function G(){var t;return 93===e.charCodeAt(wn)?(t=ln,wn++):(t=X,0===xn&&s(cn)),t}function z(){var t;return 10===e.charCodeAt(wn)?(t=un,wn++):(t=X,0===xn&&s(hn)),t===X&&(e.substr(wn,2)===pn?(t=pn,wn+=2):(t=X,0===xn&&s(dn)),t===X&&(13===e.charCodeAt(wn)?(t=fn,wn++):(t=X,0===xn&&s(mn)),t===X&&(8232===e.charCodeAt(wn)?(t=yn,wn++):(t=X,0===xn&&s(gn)),t===X&&(8233===e.charCodeAt(wn)?(t=vn,wn++):(t=X,0===xn&&s(Cn)))))),t}function H(){var t;return Ln.test(e.charAt(wn))?(t=e.charAt(wn),wn++):(t=X,0===xn&&s(Tn)),t===X&&(t=z()),t}function W(e){return parseInt(e.join(""),10)}function V(e){return e.concat([["line",n()],["col",r()]])}var q,Y=arguments.length>1?arguments[1]:{},X={},K={start:l},Q=l,J=function(e){var t=["body"].concat(e);return V(t)},Z={type:"other",description:"section"},ee=X,te=null,ne=function(e,t,n,r){return r&&e[1].text===r.text||i("Expected end tag for "+e[1].text+" but it was not found."),!0},re=void 0,ie=function(e,t,n){return n.push(["param",["literal","block"],t]),e.push(n),V(e)},ae="/",se={type:"literal",value:"/",description:'"/"'},oe=function(e){return e.push(["bodies"]),V(e)},le=/^[#?\^<+@%]/,ce={type:"class",value:"[#?\\^<+@%]",description:"[#?\\^<+@%]"},ue=function(e,t,n,r){return[e,t,n,r]},he={type:"other",description:"end tag"},pe=function(e){return e},de=":",fe={type:"literal",value:":",description:'":"'},me=function(e){return e},ye=function(e){return e?["context",e]:["context"]},ge={type:"other",description:"params"},ve="=",Ce={type:"literal",value:"=",description:'"="'},Le=function(e,t){return["param",["literal",e],t]},Te=function(e){return["params"].concat(e)},we={type:"other",description:"bodies"},be=function(e){return["bodies"].concat(e)},Se={type:"other",description:"reference"},Ee=function(e,t){return V(["reference",e,t])},Oe={type:"other",description:"partial"},Ae=">",xe={type:"literal",value:">",description:'">"'},Pe="+",_e={type:"literal",value:"+",description:'"+"'},Ne=function(e){return["literal",e]},Me=function(e,t,n,r){var i=">"===e?"partial":e;return V([i,t,n,r])},ke={type:"other",description:"filters"},Ie="|",Re={type:"literal",value:"|",description:'"|"'},De=function(e){return["filters"].concat(e)},Fe={type:"other",description:"special"},je="~",Be={type:"literal",value:"~",description:'"~"'},$e=function(e){return V(["special",e])},Ue={type:"other",description:"identifier"},Ge=function(e){var t=["path"].concat(e);return t.text=e[1].join(".").replace(/,line,\d+,col,\d+/g,""),t},ze=function(e){var t=["key",e];return t.text=e,t},He={type:"other",description:"number"},We=function(e){return["literal",e]},Ve={type:"other",description:"float"},qe=".",Ye={type:"literal",value:".",description:'"."'},Xe=function(e,t){return parseFloat(e+"."+t)},Ke={type:"other",description:"unsigned_integer"},Qe=/^[0-9]/,Je={type:"class",value:"[0-9]",description:"[0-9]"},Ze=function(e){return W(e)},et={type:"other",description:"signed_integer"},tt="-",nt={type:"literal",value:"-",description:'"-"'},rt=function(e,t){return-1*t},it={type:"other",description:"integer"},at={type:"other",description:"path"},st=function(e,t){return t=t[0],e&&t?(t.unshift(e),V([!1,t])):V([!0,t])},ot=function(e){return V(e.length>0?[!0,e[0]]:[!0,[]])},lt={type:"other",description:"key"},ct=/^[a-zA-Z_$]/,ut={type:"class",value:"[a-zA-Z_$]",description:"[a-zA-Z_$]"},ht=/^[0-9a-zA-Z_$\-]/,pt={type:"class",value:"[0-9a-zA-Z_$\\-]",description:"[0-9a-zA-Z_$\\-]"},dt=function(e,t){return e+t.join("")},ft={type:"other",description:"array"},mt=function(e){return e.join("")},yt=function(e){return e},gt=function(e,t){return t?t.unshift(e):t=[e],t},vt={type:"other",description:"array_part"},Ct=function(e){return e},Lt=function(e,t){return t?e.concat(t):e},Tt={type:"other",description:"inline"},wt='"',bt={type:"literal",value:'"',description:'"\\""'},St=function(){return V(["literal",""])},Et=function(e){return V(["literal",e])},Ot=function(e){return V(["body"].concat(e))},At=function(e){return["buffer",e]},xt={type:"other",description:"buffer"},Pt=function(e,t){return V(["format",e,t.join("")])},_t={type:"any",description:"any character"},Nt=function(e){return e},Mt=function(e){return V(["buffer",e.join("")])},kt={type:"other",description:"literal"},It=/^[^"]/,Rt={type:"class",value:'[^"]',description:'[^"]'},Dt=function(e){return e.join("")},Ft='\\"',jt={type:"literal",value:'\\"',description:'"\\\\\\""'},Bt=function(){return'"'},$t={type:"other",description:"raw"},Ut="{`",Gt={type:"literal",value:"{`",description:'"{`"'},zt="`}",Ht={type:"literal",value:"`}",description:'"`}"'},Wt=function(e){return e},Vt=function(e){return V(["raw",e.join("")])},qt={type:"other",description:"comment"},Yt="{!",Xt={type:"literal",value:"{!",description:'"{!"'},Kt="!}",Qt={type:"literal",value:"!}",description:'"!}"'},Jt=function(e){return V(["comment",e.join("")])},Zt=/^[#?\^><+%:@\/~%]/,en={type:"class",value:"[#?\\^><+%:@\\/~%]",description:"[#?\\^><+%:@\\/~%]"},tn="{",nn={type:"literal",value:"{",description:'"{"'},rn="}",an={type:"literal",value:"}",description:'"}"'},sn="[",on={type:"literal",value:"[",description:'"["'},ln="]",cn={type:"literal",value:"]",description:'"]"'},un="\n",hn={type:"literal",value:"\n",description:'"\\n"'},pn="\r\n",dn={type:"literal",value:"\r\n",description:'"\\r\\n"'},fn="\r",mn={type:"literal",value:"\r",description:'"\\r"'},yn="\u2028",gn={type:"literal",value:"\u2028",description:'"\\u2028"'},vn="\u2029",Cn={type:"literal",value:"\u2029",description:'"\\u2029"'},Ln=/^[\t\x0B\f \xA0\uFEFF]/,Tn={type:"class",value:"[\\t\\x0B\\f \\xA0\\uFEFF]",description:"[\\t\\x0B\\f \\xA0\\uFEFF]"},wn=0,bn=0,Sn=0,En={line:1,column:1,seenCR:!1},On=0,An=[],xn=0;if("startRule"in Y){if(!(Y.startRule in K))throw new Error("Can't start parsing from rule \""+Y.startRule+'".');Q=K[Y.startRule]}if(q=Q(),q!==X&&wn===e.length)return q;throw q!==X&&wn<e.length&&s({type:"end",description:"end of input"}),o(null,An,On)}return e(t,Error),{SyntaxError:t,parse:n}}();return e.parse=t.parse,t}),function(e,t){"function"==typeof define&&define.amd&&define.amd.dust===!0?define("dust.compile",["dust.core","dust.parse"],function(e,n){return t(n,e).compile}):"object"==typeof exports?module.exports=t(require("./parser").parse,require("./dust")):t(e.dust.parse,e.dust)}(this,function(e,t){function n(e){return C.filterNode({},e)}function r(e,t){for(var n,r=[t[0]],i=1,a=t.length;a>i;i++)n=C.filterNode(e,t[i]),n&&r.push(n);return r}function i(e,t){for(var n,r,i=[t[0]],a=1,s=t.length;s>a;a++)r=C.filterNode(e,t[a]),r&&("buffer"===r[0]||"format"===r[0]?n?(n[0]="buffer"===r[0]?"buffer":n[0],n[1]+=r.slice(1,-2).join("")):(n=r,i.push(r)):(n=null,i.push(r)));return i}function a(e,t){return["buffer",v[t[1]],t[2],t[3]]}function s(e,t){return t}function o(){}function l(e,n){return t.config.whitespace?(n.splice(1,2,n.slice(1,-2).join("")),n):null}function c(e,n){var r,i={name:n,bodies:[],blocks:{},index:0,auto:"h"},a=t.escapeJs(n),s=n?'"'+a+'",':"",o="function(dust){",l=C.compileNode(i,e);return n&&(o+='dust.register("'+a+'",'+l+");"),o+=u(i)+h(i)+"return "+l+"}",r="("+o+"(dust));",t.config.amd?"define("+s+'["dust.core"],'+o+");":t.config.cjs?"module.exports=function(dust){var tmpl="+r+"var f="+g().toString()+";f.template=tmpl;return f}":r}function u(e){var t,n=[],r=e.blocks;for(t in r)n.push('"'+t+'":'+r[t]);return n.length?(e.blocks="ctx=ctx.shiftBlocks(blocks);","var blocks={"+n.join(",")+"};"):(e.blocks="",e.blocks)}function h(e){for(var t=[],n=e.bodies,r=e.blocks,i=0,a=n.length;a>i;i++)t[i]="function body_"+i+"(chk,ctx){"+r+"return chk"+n[i]+";}body_"+i+".__dustBody=!0;";return t.join("")}function p(e,t){for(var n="",r=1,i=t.length;i>r;r++)n+=C.compileNode(e,t[r]);return n}function d(e,n,r){return"."+(t._aliases[r]||r)+"("+C.compileNode(e,n[1])+","+C.compileNode(e,n[2])+","+C.compileNode(e,n[4])+","+C.compileNode(e,n[3])+")"}function f(e){return e.replace(T,"\\\\").replace(w,'\\"').replace(b,"\\f").replace(S,"\\n").replace(E,"\\r").replace(O,"\\t")}function m(e,n,r){var i=t.loadSource(t.compile(e));return g(i)(n,r)}function y(e,n){var r=t.loadSource(t.compile(e,n));return g(r)}function g(e){return function(n,r){var i=r?"render":"stream";return t[i](e,n,r)}}var v,C={},L=t.isArray;C.compile=function(t,r){try{var i=n(e(t));return c(i,r)}catch(a){if(!a.line||!a.column)throw a;throw new SyntaxError(a.message+" At line : "+a.line+", column : "+a.column)}};C.filterNode=function(e,t){return C.optimizers[t[0]](e,t)};C.optimizers={body:i,buffer:s,special:a,format:l,reference:r,"#":r,"?":r,"^":r,"<":r,"+":r,"@":r,"%":r,partial:r,context:r,params:r,bodies:r,param:r,filters:s,key:s,path:s,literal:s,raw:s,comment:o,line:o,col:o};C.pragmas={esc:function(e,t,n){var r,i=e.auto;return t||(t="h"),e.auto="s"===t?"":t,r=p(e,n.block),e.auto=i,r}};v={s:" ",n:"\n",r:"\r",lb:"{",rb:"}"};C.compileNode=function(e,t){return C.nodes[t[0]](e,t)};C.nodes={body:function(e,t){var n=e.index++,r="body_"+n;return e.bodies[n]=p(e,t),r},buffer:function(e,t){return".w("+A(t[1])+")"},format:function(e,t){return".w("+A(t[1])+")"},reference:function(e,t){return".f("+C.compileNode(e,t[1])+",ctx,"+C.compileNode(e,t[2])+")"},"#":function(e,t){return d(e,t,"section")},"?":function(e,t){return d(e,t,"exists")},"^":function(e,t){return d(e,t,"notexists")},"<":function(e,t){for(var n,r,i=t[4],a=1,s=i.length;s>a;a++)if(n=i[a],r=n[1][1],"block"===r)return e.blocks[t[1].text]=C.compileNode(e,n[2]),"";return""},"+":function(e,t){return"undefined"==typeof t[1].text&&"undefined"==typeof t[4]?".b(ctx.getBlock("+C.compileNode(e,t[1])+",chk, ctx),"+C.compileNode(e,t[2])+", {},"+C.compileNode(e,t[3])+")":".b(ctx.getBlock("+A(t[1].text)+"),"+C.compileNode(e,t[2])+","+C.compileNode(e,t[4])+","+C.compileNode(e,t[3])+")"},"@":function(e,t){return".h("+A(t[1].text)+","+C.compileNode(e,t[2])+","+C.compileNode(e,t[4])+","+C.compileNode(e,t[3])+")"},"%":function(e,t){var n,r,i,a,s,o,l,c,u,h=t[1][1];if(!C.pragmas[h])return"";for(n=t[4],r={},c=1,u=n.length;u>c;c++)o=n[c],r[o[1][1]]=o[2];for(i=t[3],a={},c=1,u=i.length;u>c;c++)l=i[c],a[l[1][1]]=l[2][1];return s=t[2][1]?t[2][1].text:null,C.pragmas[h](e,s,r,a)},partial:function(e,t){return".p("+C.compileNode(e,t[1])+",ctx,"+C.compileNode(e,t[2])+","+C.compileNode(e,t[3])+")"},context:function(e,t){return t[1]?"ctx.rebase("+C.compileNode(e,t[1])+")":"ctx"},params:function(e,t){for(var n=[],r=1,i=t.length;i>r;r++)n.push(C.compileNode(e,t[r]));return n.length?"{"+n.join(",")+"}":"{}"},bodies:function(e,t){for(var n=[],r=1,i=t.length;i>r;r++)n.push(C.compileNode(e,t[r]));return"{"+n.join(",")+"}"},param:function(e,t){return C.compileNode(e,t[1])+":"+C.compileNode(e,t[2])},filters:function(e,t){for(var n,r=[],i=1,a=t.length;a>i;i++)n=t[i],r.push('"'+n+'"');return'"'+e.auto+'"'+(r.length?",["+r.join(",")+"]":"")},key:function(e,t){return'ctx.get(["'+t[1]+'"], false)'},path:function(e,t){for(var n=t[1],r=t[2],i=[],a=0,s=r.length;s>a;a++)i.push(L(r[a])?C.compileNode(e,r[a]):'"'+r[a]+'"');return"ctx.getPath("+n+", ["+i.join(",")+"])"},literal:function(e,t){return A(t[1])},raw:function(e,t){return".w("+A(t[1])+")"}};var T=/\\/g,w=/"/g,b=/\f/g,S=/\n/g,E=/\r/g,O=/\t/g,A="undefined"==typeof JSON?function(e){return'"'+f(e)+'"'}:JSON.stringify;return t.compiler=C,t.compile=t.compiler.compile,t.renderSource=m,t.compileFn=y,t.filterNode=C.filterNode,t.optimizers=C.optimizers,t.pragmas=C.pragmas,t.compileNode=C.compileNode,t.nodes=C.nodes,C});"function"==typeof define&&define.amd&&define.amd.dust===!0&&define(["require","dust.core","dust.compile"],function(e,t){return t.onLoad=function(t,n){e([t],function(){n()})},t});!function(e,t){"function"==typeof define&&define.amd&&define.amd.dust===!0?define(["dust.core"],t):"object"==typeof exports?module.exports=t(require("dustjs-linkedin")):t(e.dust)}(this,function(e){function t(t,n,r){r=r||"INFO";t=t?"{@"+t+"}: ":"";e.log(t+n,r)}function n(e){h[e]||(t(e,"Deprecation warning: "+e+" is deprecated and will be removed in a future version of dustjs-helpers","WARN"),t(null,"For help and a deprecation timeline, see https://github.com/linkedin/dustjs-helpers/wiki/Deprecated-Features#"+e.replace(/\W+/g,""),"WARN"),h[e]=!0)}function r(e){return e.stack.tail&&e.stack.tail.head&&"undefined"!=typeof e.stack.tail.head.__select__}function i(e){return r(e)&&e.get("__select__")}function a(e,t){var n,r,i=e.stack.head,a=e.rebase();e.stack&&e.stack.tail&&(a.stack=e.stack.tail);r={isPending:!1,isResolved:!1,isDeferredComplete:!1,deferreds:[]};for(n in t)r[n]=t[n];return a.push({__select__:r}).push(i,e.stack.index,e.stack.of)}function s(e){var t,n;if(e.isDeferredPending=!0,e.deferreds.length)for(e.isDeferredComplete=!0,t=0,n=e.deferreds.length;n>t;t++)e.deferreds[t]();e.isDeferredPending=!1}function o(e,t){return"function"==typeof t?t.toString().replace(/(^\s+|\s+$)/gm,"").replace(/\n/gm,"").replace(/,\s*/gm,", ").replace(/\)\{/gm,") {"):t}function l(e,t){return function(n,r,i,a){return c(n,r,i,a,e,t)}}function c(e,n,r,a,s,o){var l,c,h,p,d=r.block,f=r["else"],m=i(n)||{};if(m.isResolved&&!m.isDeferredPending)return e;if(a.hasOwnProperty("key"))c=a.key;else{if(!m.hasOwnProperty("key"))return t(s,"No key specified","WARN"),e;c=m.key}return p=a.type||m.type,c=u(n.resolve(c),p),h=u(n.resolve(a.value),p),o(c,h)?(m.isPending||(l=!0,m.isPending=!0),d&&(e=e.render(d,n)),l&&(m.isResolved=!0)):f&&(e=e.render(f,n)),e}function u(e,t){t&&(t=t.toLowerCase());switch(t){case"number":return+e;case"string":return String(e);case"boolean":return e="false"===e?!1:e,Boolean(e);case"date":return new Date(e)}return e}var h={},p={tap:function(e,t,r){return n("tap"),r.resolve(e)},sep:function(e,t,n){var r=n.block;return t.stack.index===t.stack.of-1?e:r?r(e,t):e},first:function(e,t,n){return 0===t.stack.index?n.block(e,t):e},last:function(e,t,n){return t.stack.index===t.stack.of-1?n.block(e,t):e},contextDump:function(e,n,r,i){var a,s,l=n.resolve(i.to),c=n.resolve(i.key);switch(c){case"full":a=n.stack;break;default:a=n.stack.head}s=JSON.stringify(a,o,2);switch(l){case"console":t("contextDump",s);break;default:s=s.replace(/</g,"\\u003c");e=e.write(s)}return e},math:function(e,n,r,o){var l,c=o.key,u=o.method,h=o.operand,p=o.round;if(!o.hasOwnProperty("key")||!o.method)return t("math","`key` or `method` was not provided","ERROR"),e;c=parseFloat(n.resolve(c));h=parseFloat(n.resolve(h));switch(u){case"mod":0===h&&t("math","Division by 0","ERROR");l=c%h;break;case"add":l=c+h;break;case"subtract":l=c-h;break;case"multiply":l=c*h;break;case"divide":0===h&&t("math","Division by 0","ERROR");l=c/h;break;case"ceil":case"floor":case"round":case"abs":l=Math[u](c);break;case"toint":l=parseInt(c,10);break;default:t("math","Method `"+u+"` is not supported","ERROR")}return"undefined"!=typeof l&&(p&&(l=Math.round(l)),r&&r.block?(n=a(n,{key:l}),e=e.render(r.block,n),s(i(n))):e=e.write(l)),e},select:function(e,n,r,o){var l=r.block,c={};return o.hasOwnProperty("key")&&(c.key=n.resolve(o.key)),o.hasOwnProperty("type")&&(c.type=o.type),l?(n=a(n,c),e=e.render(l,n),s(i(n))):t("select","Missing body block","WARN"),e},eq:l("eq",function(e,t){return e===t}),ne:l("ne",function(e,t){return e!==t}),lt:l("lt",function(e,t){return t>e}),lte:l("lte",function(e,t){return t>=e}),gt:l("gt",function(e,t){return e>t}),gte:l("gte",function(e,t){return e>=t}),any:function(e,n,r){var a=i(n);return a?a.isDeferredComplete?t("any","Must not be nested inside {@any} or {@none} block","ERROR"):e=e.map(function(e){a.deferreds.push(function(){a.isResolved&&(e=e.render(r.block,n));e.end()})}):t("any","Must be used inside a {@select} block","ERROR"),e},none:function(e,n,r){var a=i(n);return a?a.isDeferredComplete?t("none","Must not be nested inside {@any} or {@none} block","ERROR"):e=e.map(function(e){a.deferreds.push(function(){a.isResolved||(e=e.render(r.block,n));e.end()})}):t("none","Must be used inside a {@select} block","ERROR"),e},size:function(t,n,r,i){var a,s,o=i.key;if(o=n.resolve(i.key),o&&o!==!0)if(e.isArray(o))a=o.length;else if(!isNaN(parseFloat(o))&&isFinite(o))a=o;else if("object"==typeof o){a=0;for(s in o)o.hasOwnProperty(s)&&a++}else a=(o+"").length;else a=0;return t.write(a)}};for(var d in p)e.helpers[d]=p[d];return e});!function(e,t){"function"==typeof define&&define.amd?define(["dustjs-linkedin"],function(n){return t(n,e)}):"object"==typeof module&&module.exports?module.exports=t(require("dustjs-linkedin"),this):e.dust=t(e.dust,e)}(this,function(e,t,n){"use strict";var r=Object.prototype.toString,i=typeof console!==n?console:{log:function(){}},a={isArray:Array.isArray||function(e){return"[object Array]"===r.call(e)},isAvailable:function(e){return o[e]!==n},log:i.log},s={selected:n,languages:{},filters:{}},o=s.languages;return typeof String.prototype.trim===n&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),e.i18n={resetContext:function(){s.selected=n,Object.keys(o).forEach(function(e){delete o[e]})},setLanguage:function(e){if(!a.isAvailable(e))throw new Error("language '"+e+"' not available!");s.selected=e},setLanguages:function(e){a.isArray(e)&&e.forEach(function(e){a.isAvailable(e)||(o[e]={}),s.selected===n&&(s.selected=e)})},add:function(e,t){if(a.isAvailable(e)){var n=o[e];Object.keys(t).forEach(function(e){n[e]=t[e]})}},addFilter:function(e,t){e in s.filters||(s.filters[e]=t)}},e.helpers.i18n=function(t,r,i,l){if(l&&l.$key!==n){var c,u,h,p,d,f=s.selected,m=o[f],y=/\{(\s*[\w]+\s*)\}/g;p=e.helpers.tap(l.$key,t,r).split("|");var g=e.helpers.tap(p.shift(),t,r);for(d=m!==n&&m[g]!==n?m[g]:null;null!==(c=y.exec(d));)h=c[1].trim(),"$key"===h?(u="",a.log("$key can't be used as a parameter")):u=e.helpers.tap(l[c[1].trim()],t,r),d=d.replace(c[0],u);p.forEach(function(e){e in s.filters&&(d=s.filters[e](d))}),t.write(d)}else a.log("No key given in the i18n helper");return t},e});!function(){var e,t,n,r;!function(){var i={},a={};e=function(e,t,n){i[e]={deps:t,callback:n}},r=n=t=function(e){function n(t){if("."!==t.charAt(0))return t;for(var n=t.split("/"),r=e.split("/").slice(0,-1),i=0,a=n.length;a>i;i++){var s=n[i];if(".."===s)r.pop();else{if("."===s)continue;r.push(s)}}return r.join("/")}if(r._eak_seen=i,a[e])return a[e];if(a[e]={},!i[e])throw new Error("Could not find module "+e);for(var s,o=i[e],l=o.deps,c=o.callback,u=[],h=0,p=l.length;p>h;h++)u.push("exports"===l[h]?s={}:t(n(l[h])));var d=c.apply(this,u);return a[e]=s||d}}(),e("promise/all",["./utils","exports"],function(e,t){"use strict";function n(e){var t=this;if(!r(e))throw new TypeError("You must pass an array to all.");return new t(function(t,n){function r(e){return function(t){a(e,t)}}function a(e,n){o[e]=n,0===--l&&t(o)}var s,o=[],l=e.length;0===l&&t([]);for(var c=0;c<e.length;c++)s=e[c],s&&i(s.then)?s.then(r(c),n):a(c,s)})}var r=e.isArray,i=e.isFunction;t.all=n}),e("promise/asap",["exports"],function(e){"use strict";function t(){return function(){process.nextTick(i)}}function n(){var e=0,t=new l(i),n=document.createTextNode("");return t.observe(n,{characterData:!0}),function(){n.data=e=++e%2}}function r(){return function(){c.setTimeout(i,1)}}function i(){for(var e=0;e<u.length;e++){var t=u[e],n=t[0],r=t[1];n(r)}u=[]}function a(e,t){var n=u.push([e,t]);1===n&&s()}var s,o="undefined"!=typeof window?window:{},l=o.MutationObserver||o.WebKitMutationObserver,c="undefined"!=typeof global?global:void 0===this?window:this,u=[];s="undefined"!=typeof process&&"[object process]"==={}.toString.call(process)?t():l?n():r(),e.asap=a}),e("promise/config",["exports"],function(e){"use strict";function t(e,t){return 2!==arguments.length?n[e]:void(n[e]=t)}var n={instrument:!1};e.config=n,e.configure=t}),e("promise/polyfill",["./promise","./utils","exports"],function(e,t,n){"use strict";function r(){var e;e="undefined"!=typeof global?global:"undefined"!=typeof window&&window.document?window:self;var t="Promise"in e&&"resolve"in e.Promise&&"reject"in e.Promise&&"all"in e.Promise&&"race"in e.Promise&&function(){var t;return new e.Promise(function(e){t=e}),a(t)}();t||(e.Promise=i)}var i=e.Promise,a=t.isFunction;n.polyfill=r}),e("promise/promise",["./config","./utils","./all","./race","./resolve","./reject","./asap","exports"],function(e,t,n,r,i,a,s,o){"use strict";function l(e){if(!T(e))throw new TypeError("You must pass a resolver function as the first argument to the promise constructor");if(!(this instanceof l))throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");this._subscribers=[],c(e,this)}function c(e,t){function n(e){f(t,e)}function r(e){y(t,e)}try{e(n,r)}catch(i){r(i)}}function u(e,t,n,r){var i,a,s,o,l=T(n);if(l)try{i=n(r),s=!0}catch(c){o=!0,a=c}else i=r,s=!0;d(t,i)||(l&&s?f(t,i):o?y(t,a):e===P?f(t,i):e===_&&y(t,i))}function h(e,t,n,r){var i=e._subscribers,a=i.length;i[a]=t,i[a+P]=n,i[a+_]=r}function p(e,t){for(var n,r,i=e._subscribers,a=e._detail,s=0;s<i.length;s+=3)n=i[s],r=i[s+t],u(t,n,r,a);e._subscribers=null}function d(e,t){var n,r=null;try{if(e===t)throw new TypeError("A promises callback cannot return that same promise.");if(L(t)&&(r=t.then,T(r)))return r.call(t,function(r){return n?!0:(n=!0,void(t!==r?f(e,r):m(e,r)))},function(t){return n?!0:(n=!0,void y(e,t))}),!0}catch(i){return n?!0:(y(e,i),!0)}return!1}function f(e,t){e===t?m(e,t):d(e,t)||m(e,t)}function m(e,t){e._state===A&&(e._state=x,e._detail=t,C.async(g,e))}function y(e,t){e._state===A&&(e._state=x,e._detail=t,C.async(v,e))}function g(e){p(e,e._state=P)}function v(e){p(e,e._state=_)}var C=e.config,L=(e.configure,t.objectOrFunction),T=t.isFunction,w=(t.now,n.all),b=r.race,S=i.resolve,E=a.reject,O=s.asap;C.async=O;var A=void 0,x=0,P=1,_=2;l.prototype={constructor:l,_state:void 0,_detail:void 0,_subscribers:void 0,then:function(e,t){var n=this,r=new this.constructor(function(){});if(this._state){var i=arguments;C.async(function(){u(n._state,r,i[n._state-1],n._detail)})}else h(this,r,e,t);return r},"catch":function(e){return this.then(null,e)}},l.all=w,l.race=b,l.resolve=S,l.reject=E,o.Promise=l}),e("promise/race",["./utils","exports"],function(e,t){"use strict";function n(e){var t=this;if(!r(e))throw new TypeError("You must pass an array to race.");return new t(function(t,n){for(var r,i=0;i<e.length;i++)r=e[i],r&&"function"==typeof r.then?r.then(t,n):t(r)})}var r=e.isArray;t.race=n}),e("promise/reject",["exports"],function(e){"use strict";function t(e){var t=this;return new t(function(t,n){n(e)})}e.reject=t}),e("promise/resolve",["exports"],function(e){"use strict";function t(e){if(e&&"object"==typeof e&&e.constructor===this)return e;var t=this;return new t(function(t){t(e)})}e.resolve=t}),e("promise/utils",["exports"],function(e){"use strict";function t(e){return n(e)||"object"==typeof e&&null!==e}function n(e){return"function"==typeof e}function r(e){return"[object Array]"===Object.prototype.toString.call(e)}var i=Date.now||function(){return(new Date).getTime()};e.objectOrFunction=t,e.isFunction=n,e.isArray=r,e.now=i}),t("promise/polyfill").polyfill()}(),function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.localforage=t():e.localforage=t()}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}t.__esModule=!0;var i=function(e){function t(e,t){e[t]=function(){var n=arguments;return e.ready().then(function(){return e[t].apply(e,n)})}}function i(){for(var e=1;e<arguments.length;e++){var t=arguments[e];if(t)for(var n in t)t.hasOwnProperty(n)&&(arguments[0][n]=p(t[n])?t[n].slice():t[n])}return arguments[0]}function a(e){for(var t in o)if(o.hasOwnProperty(t)&&o[t]===e)return!0;return!1}var s={},o={INDEXEDDB:"asyncStorage",LOCALSTORAGE:"localStorageWrapper",WEBSQL:"webSQLStorage"},l=[o.INDEXEDDB,o.WEBSQL,o.LOCALSTORAGE],c=["clear","getItem","iterate","key","keys","length","removeItem","setItem"],u={description:"",driver:l.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1},h=function(e){var t={};return t[o.INDEXEDDB]=!!function(){try{var t=t||e.indexedDB||e.webkitIndexedDB||e.mozIndexedDB||e.OIndexedDB||e.msIndexedDB;return"undefined"!=typeof e.openDatabase&&e.navigator&&e.navigator.userAgent&&/Safari/.test(e.navigator.userAgent)&&!/Chrome/.test(e.navigator.userAgent)?!1:t&&"function"==typeof t.open&&"undefined"!=typeof e.IDBKeyRange}catch(n){return!1}}(),t[o.WEBSQL]=!!function(){try{return e.openDatabase}catch(t){return!1}}(),t[o.LOCALSTORAGE]=!!function(){try{return e.localStorage&&"setItem"in e.localStorage&&e.localStorage.setItem}catch(t){return!1}}(),t}(e),p=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},d=function(){function e(t){r(this,e),this.INDEXEDDB=o.INDEXEDDB,this.LOCALSTORAGE=o.LOCALSTORAGE,this.WEBSQL=o.WEBSQL,this._defaultConfig=i({},u),this._config=i({},this._defaultConfig,t),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver)}return e.prototype.config=function(e){if("object"==typeof e){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var t in e)"storeName"===t&&(e[t]=e[t].replace(/\W/g,"_")),this._config[t]=e[t];return"driver"in e&&e.driver&&this.setDriver(this._config.driver),!0}return"string"==typeof e?this._config[e]:this._config},e.prototype.defineDriver=function(e,t,n){var r=new Promise(function(t,n){try{var r=e._driver,i=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver"),o=new Error("Custom driver name already in use: "+e._driver);if(!e._driver)return void n(i);if(a(e._driver))return void n(o);for(var l=c.concat("_initStorage"),u=0;u<l.length;u++){var p=l[u];if(!p||!e[p]||"function"!=typeof e[p])return void n(i)}var d=Promise.resolve(!0);"_support"in e&&(d=e._support&&"function"==typeof e._support?e._support():Promise.resolve(!!e._support)),d.then(function(n){h[r]=n,s[r]=e,t()},n)}catch(f){n(f)}});return r.then(t,n),r},e.prototype.driver=function(){
return this._driver||null},e.prototype.getDriver=function(e,t,r){var i=this,o=function(){if(a(e))switch(e){case i.INDEXEDDB:return new Promise(function(e,t){e(n(1))});case i.LOCALSTORAGE:return new Promise(function(e,t){e(n(2))});case i.WEBSQL:return new Promise(function(e,t){e(n(4))})}else if(s[e])return Promise.resolve(s[e]);return Promise.reject(new Error("Driver not found."))}();return o.then(t,r),o},e.prototype.getSerializer=function(e){var t=new Promise(function(e,t){e(n(3))});return e&&"function"==typeof e&&t.then(function(t){e(t)}),t},e.prototype.ready=function(e){var t=this,n=t._driverSet.then(function(){return null===t._ready&&(t._ready=t._initDriver()),t._ready});return n.then(e,e),n},e.prototype.setDriver=function(e,t,n){function r(){a._config.driver=a.driver()}function i(e){return function(){function t(){for(;n<e.length;){var i=e[n];return n++,a._dbInfo=null,a._ready=null,a.getDriver(i).then(function(e){return a._extend(e),r(),a._ready=a._initStorage(a._config),a._ready})["catch"](t)}r();var s=new Error("No available storage method found.");return a._driverSet=Promise.reject(s),a._driverSet}var n=0;return t()}}var a=this;p(e)||(e=[e]);var s=this._getSupportedDrivers(e),o=null!==this._driverSet?this._driverSet["catch"](function(){return Promise.resolve()}):Promise.resolve();return this._driverSet=o.then(function(){var e=s[0];return a._dbInfo=null,a._ready=null,a.getDriver(e).then(function(e){a._driver=e._driver,r(),a._wrapLibraryMethodsWithReady(),a._initDriver=i(s)})})["catch"](function(){r();var e=new Error("No available storage method found.");return a._driverSet=Promise.reject(e),a._driverSet}),this._driverSet.then(t,n),this._driverSet},e.prototype.supports=function(e){return!!h[e]},e.prototype._extend=function(e){i(this,e)},e.prototype._getSupportedDrivers=function(e){for(var t=[],n=0,r=e.length;r>n;n++){var i=e[n];this.supports(i)&&t.push(i)}return t},e.prototype._wrapLibraryMethodsWithReady=function(){for(var e=0;e<c.length;e++)t(this,c[e])},e.prototype.createInstance=function(t){return new e(t)},e}();return new d}("undefined"!=typeof window?window:self);t["default"]=i,e.exports=t["default"]},function(e,t){"use strict";t.__esModule=!0;var n=function(e){function t(t,n){t=t||[],n=n||{};try{return new Blob(t,n)}catch(r){if("TypeError"!==r.name)throw r;for(var i=e.BlobBuilder||e.MSBlobBuilder||e.MozBlobBuilder||e.WebKitBlobBuilder,a=new i,s=0;s<t.length;s+=1)a.append(t[s]);return a.getBlob(n.type)}}function n(e){for(var t=e.length,n=new ArrayBuffer(t),r=new Uint8Array(n),i=0;t>i;i++)r[i]=e.charCodeAt(i);return n}function r(e){return new Promise(function(t,n){var r=new XMLHttpRequest;r.open("GET",e),r.withCredentials=!0,r.responseType="arraybuffer",r.onreadystatechange=function(){return 4===r.readyState?200===r.status?t({response:r.response,type:r.getResponseHeader("Content-Type")}):void n({status:r.status,response:r.response}):void 0},r.send()})}function i(e){return new Promise(function(n,i){var a=t([""],{type:"image/png"}),s=e.transaction([P],"readwrite");s.objectStore(P).put(a,"key"),s.oncomplete=function(){var t=e.transaction([P],"readwrite"),a=t.objectStore(P).get("key");a.onerror=i,a.onsuccess=function(e){var t=e.target.result,i=URL.createObjectURL(t);r(i).then(function(e){n(!(!e||"image/png"!==e.type))},function(){n(!1)}).then(function(){URL.revokeObjectURL(i)})}},s.onerror=s.onabort=i})["catch"](function(){return!1})}function a(e){return"boolean"==typeof A?Promise.resolve(A):i(e).then(function(e){return A=e})}function s(e){return new Promise(function(t,n){var r=new FileReader;r.onerror=n,r.onloadend=function(n){var r=btoa(n.target.result||"");t({__local_forage_encoded_blob:!0,data:r,type:e.type})},r.readAsBinaryString(e)})}function o(e){var r=n(atob(e.data));return t([r],{type:e.type})}function l(e){return e&&e.__local_forage_encoded_blob}function c(e){var t=this,n=t._initReady().then(function(){var e=x[t._dbInfo.name];return e&&e.dbReady?e.dbReady:void 0});return n.then(e,e),n}function u(e){var t=x[e.name],n={};n.promise=new Promise(function(e){n.resolve=e}),t.deferredOperations.push(n),t.dbReady=t.dbReady?t.dbReady.then(function(){return n.promise}):n.promise}function h(e){var t=x[e.name],n=t.deferredOperations.pop();n&&n.resolve()}function p(e){function t(){return Promise.resolve()}var n=this,r={db:null};if(e)for(var i in e)r[i]=e[i];x||(x={});var a=x[r.name];a||(a={forages:[],db:null,dbReady:null,deferredOperations:[]},x[r.name]=a),a.forages.push(n),n._initReady||(n._initReady=n.ready,n.ready=c);for(var s=[],o=0;o<a.forages.length;o++){var l=a.forages[o];l!==n&&s.push(l._initReady()["catch"](t))}var u=a.forages.slice(0);return Promise.all(s).then(function(){return r.db=a.db,d(r)}).then(function(e){return r.db=e,y(r,n._defaultConfig.version)?f(r):e}).then(function(e){r.db=a.db=e,n._dbInfo=r;for(var t=0;t<u.length;t++){var i=u[t];i!==n&&(i._dbInfo.db=r.db,i._dbInfo.version=r.version)}})}function d(e){return m(e,!1)}function f(e){return m(e,!0)}function m(t,n){return new Promise(function(r,i){if(t.db){if(!n)return r(t.db);u(t),t.db.close()}var a=[t.name];n&&a.push(t.version);var s=O.open.apply(O,a);n&&(s.onupgradeneeded=function(n){var r=s.result;try{r.createObjectStore(t.storeName),n.oldVersion<=1&&r.createObjectStore(P)}catch(i){if("ConstraintError"!==i.name)throw i;e.console.warn('The database "'+t.name+'" has been upgraded from version '+n.oldVersion+" to version "+n.newVersion+', but the storage "'+t.storeName+'" already exists.')}}),s.onerror=function(){i(s.error)},s.onsuccess=function(){r(s.result),h(t)}})}function y(t,n){if(!t.db)return!0;var r=!t.db.objectStoreNames.contains(t.storeName),i=t.version<t.db.version,a=t.version>t.db.version;if(i&&(t.version!==n&&e.console.warn('The database "'+t.name+"\" can't be downgraded from version "+t.db.version+" to version "+t.version+"."),t.version=t.db.version),a||r){if(r){var s=t.db.version+1;s>t.version&&(t.version=s)}return!0}return!1}function g(t,n){var r=this;"string"!=typeof t&&(e.console.warn(t+" used as a key, but it is not a string."),t=String(t));var i=new Promise(function(e,n){r.ready().then(function(){var i=r._dbInfo,a=i.db.transaction(i.storeName,"readonly").objectStore(i.storeName),s=a.get(t);s.onsuccess=function(){var t=s.result;void 0===t&&(t=null),l(t)&&(t=o(t)),e(t)},s.onerror=function(){n(s.error)}})["catch"](n)});return E(i,n),i}function v(e,t){var n=this,r=new Promise(function(t,r){n.ready().then(function(){var i=n._dbInfo,a=i.db.transaction(i.storeName,"readonly").objectStore(i.storeName),s=a.openCursor(),c=1;s.onsuccess=function(){var n=s.result;if(n){var r=n.value;l(r)&&(r=o(r));var i=e(r,n.key,c++);void 0!==i?t(i):n["continue"]()}else t()},s.onerror=function(){r(s.error)}})["catch"](r)});return E(r,t),r}function C(t,n,r){var i=this;"string"!=typeof t&&(e.console.warn(t+" used as a key, but it is not a string."),t=String(t));var o=new Promise(function(e,r){var o;i.ready().then(function(){return o=i._dbInfo,n instanceof Blob?a(o.db).then(function(e){return e?n:s(n)}):n}).then(function(n){var i=o.db.transaction(o.storeName,"readwrite"),a=i.objectStore(o.storeName);null===n&&(n=void 0),i.oncomplete=function(){void 0===n&&(n=null),e(n)},i.onabort=i.onerror=function(){var e=s.error?s.error:s.transaction.error;r(e)};var s=a.put(n,t)})["catch"](r)});return E(o,r),o}function L(t,n){var r=this;"string"!=typeof t&&(e.console.warn(t+" used as a key, but it is not a string."),t=String(t));var i=new Promise(function(e,n){r.ready().then(function(){var i=r._dbInfo,a=i.db.transaction(i.storeName,"readwrite"),s=a.objectStore(i.storeName),o=s["delete"](t);a.oncomplete=function(){e()},a.onerror=function(){n(o.error)},a.onabort=function(){var e=o.error?o.error:o.transaction.error;n(e)}})["catch"](n)});return E(i,n),i}function T(e){var t=this,n=new Promise(function(e,n){t.ready().then(function(){var r=t._dbInfo,i=r.db.transaction(r.storeName,"readwrite"),a=i.objectStore(r.storeName),s=a.clear();i.oncomplete=function(){e()},i.onabort=i.onerror=function(){var e=s.error?s.error:s.transaction.error;n(e)}})["catch"](n)});return E(n,e),n}function w(e){var t=this,n=new Promise(function(e,n){t.ready().then(function(){var r=t._dbInfo,i=r.db.transaction(r.storeName,"readonly").objectStore(r.storeName),a=i.count();a.onsuccess=function(){e(a.result)},a.onerror=function(){n(a.error)}})["catch"](n)});return E(n,e),n}function b(e,t){var n=this,r=new Promise(function(t,r){return 0>e?void t(null):void n.ready().then(function(){var i=n._dbInfo,a=i.db.transaction(i.storeName,"readonly").objectStore(i.storeName),s=!1,o=a.openCursor();o.onsuccess=function(){var n=o.result;return n?void(0===e?t(n.key):s?t(n.key):(s=!0,n.advance(e))):void t(null)},o.onerror=function(){r(o.error)}})["catch"](r)});return E(r,t),r}function S(e){var t=this,n=new Promise(function(e,n){t.ready().then(function(){var r=t._dbInfo,i=r.db.transaction(r.storeName,"readonly").objectStore(r.storeName),a=i.openCursor(),s=[];a.onsuccess=function(){var t=a.result;return t?(s.push(t.key),void t["continue"]()):void e(s)},a.onerror=function(){n(a.error)}})["catch"](n)});return E(n,e),n}function E(e,t){t&&e.then(function(e){t(null,e)},function(e){t(e)})}var O=O||e.indexedDB||e.webkitIndexedDB||e.mozIndexedDB||e.OIndexedDB||e.msIndexedDB;if(O){var A,x,P="local-forage-detect-blob-support",_={_driver:"asyncStorage",_initStorage:p,iterate:v,getItem:g,setItem:C,removeItem:L,clear:T,length:w,key:b,keys:S};return _}}("undefined"!=typeof window?window:self);t["default"]=n,e.exports=t["default"]},function(e,t,n){"use strict";t.__esModule=!0;var r=function(e){function t(e){var t=this,r={};if(e)for(var i in e)r[i]=e[i];return r.keyPrefix=r.name+"/",r.storeName!==t._defaultConfig.storeName&&(r.keyPrefix+=r.storeName+"/"),t._dbInfo=r,new Promise(function(e,t){e(n(3))}).then(function(e){return r.serializer=e,Promise.resolve()})}function r(e){var t=this,n=t.ready().then(function(){for(var e=t._dbInfo.keyPrefix,n=p.length-1;n>=0;n--){var r=p.key(n);0===r.indexOf(e)&&p.removeItem(r)}});return h(n,e),n}function i(t,n){var r=this;"string"!=typeof t&&(e.console.warn(t+" used as a key, but it is not a string."),t=String(t));var i=r.ready().then(function(){var e=r._dbInfo,n=p.getItem(e.keyPrefix+t);return n&&(n=e.serializer.deserialize(n)),n});return h(i,n),i}function a(e,t){var n=this,r=n.ready().then(function(){for(var t=n._dbInfo,r=t.keyPrefix,i=r.length,a=p.length,s=1,o=0;a>o;o++){var l=p.key(o);if(0===l.indexOf(r)){var c=p.getItem(l);if(c&&(c=t.serializer.deserialize(c)),c=e(c,l.substring(i),s++),void 0!==c)return c}}});return h(r,t),r}function s(e,t){var n=this,r=n.ready().then(function(){var t,r=n._dbInfo;try{t=p.key(e)}catch(i){t=null}return t&&(t=t.substring(r.keyPrefix.length)),t});return h(r,t),r}function o(e){var t=this,n=t.ready().then(function(){for(var e=t._dbInfo,n=p.length,r=[],i=0;n>i;i++)0===p.key(i).indexOf(e.keyPrefix)&&r.push(p.key(i).substring(e.keyPrefix.length));return r});return h(n,e),n}function l(e){var t=this,n=t.keys().then(function(e){return e.length});return h(n,e),n}function c(t,n){var r=this;"string"!=typeof t&&(e.console.warn(t+" used as a key, but it is not a string."),t=String(t));var i=r.ready().then(function(){var e=r._dbInfo;p.removeItem(e.keyPrefix+t)});return h(i,n),i}function u(t,n,r){var i=this;"string"!=typeof t&&(e.console.warn(t+" used as a key, but it is not a string."),t=String(t));var a=i.ready().then(function(){void 0===n&&(n=null);var e=n;return new Promise(function(r,a){var s=i._dbInfo;s.serializer.serialize(n,function(n,i){if(i)a(i);else try{p.setItem(s.keyPrefix+t,n),r(e)}catch(o){("QuotaExceededError"===o.name||"NS_ERROR_DOM_QUOTA_REACHED"===o.name)&&a(o),a(o)}})})});return h(a,r),a}function h(e,t){t&&e.then(function(e){t(null,e)},function(e){t(e)})}var p=null;try{if(!(e.localStorage&&"setItem"in e.localStorage))return;p=e.localStorage}catch(d){return}var f={_driver:"localStorageWrapper",_initStorage:t,iterate:a,getItem:i,setItem:u,removeItem:c,clear:r,length:l,key:s,keys:o};return f}("undefined"!=typeof window?window:self);t["default"]=r,e.exports=t["default"]},function(e,t){"use strict";t.__esModule=!0;var n=function(e){function t(t,n){t=t||[],n=n||{};try{return new Blob(t,n)}catch(r){if("TypeError"!==r.name)throw r;for(var i=e.BlobBuilder||e.MSBlobBuilder||e.MozBlobBuilder||e.WebKitBlobBuilder,a=new i,s=0;s<t.length;s+=1)a.append(t[s]);return a.getBlob(n.type)}}function n(e,t){var n="";if(e&&(n=e.toString()),e&&("[object ArrayBuffer]"===e.toString()||e.buffer&&"[object ArrayBuffer]"===e.buffer.toString())){var r,i=c;e instanceof ArrayBuffer?(r=e,i+=h):(r=e.buffer,"[object Int8Array]"===n?i+=d:"[object Uint8Array]"===n?i+=f:"[object Uint8ClampedArray]"===n?i+=m:"[object Int16Array]"===n?i+=y:"[object Uint16Array]"===n?i+=v:"[object Int32Array]"===n?i+=g:"[object Uint32Array]"===n?i+=C:"[object Float32Array]"===n?i+=L:"[object Float64Array]"===n?i+=T:t(new Error("Failed to get type for BinaryArray"))),t(i+a(r))}else if("[object Blob]"===n){var s=new FileReader;s.onload=function(){var n=o+e.type+"~"+a(this.result);t(c+p+n)},s.readAsArrayBuffer(e)}else try{t(JSON.stringify(e))}catch(l){console.error("Couldn't convert value into a JSON string: ",e),t(null,l)}}function r(e){if(e.substring(0,u)!==c)return JSON.parse(e);var n,r=e.substring(w),a=e.substring(u,w);if(a===p&&l.test(r)){var s=r.match(l);n=s[1],r=r.substring(s[0].length)}var o=i(r);switch(a){case h:return o;case p:return t([o],{type:n});case d:return new Int8Array(o);case f:return new Uint8Array(o);case m:return new Uint8ClampedArray(o);case y:return new Int16Array(o);case v:return new Uint16Array(o);case g:return new Int32Array(o);case C:return new Uint32Array(o);case L:return new Float32Array(o);case T:return new Float64Array(o);default:throw new Error("Unkown type: "+a)}}function i(e){var t,n,r,i,a,o=.75*e.length,l=e.length,c=0;"="===e[e.length-1]&&(o--,"="===e[e.length-2]&&o--);var u=new ArrayBuffer(o),h=new Uint8Array(u);for(t=0;l>t;t+=4)n=s.indexOf(e[t]),r=s.indexOf(e[t+1]),i=s.indexOf(e[t+2]),a=s.indexOf(e[t+3]),h[c++]=n<<2|r>>4,h[c++]=(15&r)<<4|i>>2,h[c++]=(3&i)<<6|63&a;return u}function a(e){var t,n=new Uint8Array(e),r="";for(t=0;t<n.length;t+=3)r+=s[n[t]>>2],r+=s[(3&n[t])<<4|n[t+1]>>4],r+=s[(15&n[t+1])<<2|n[t+2]>>6],r+=s[63&n[t+2]];return n.length%3===2?r=r.substring(0,r.length-1)+"=":n.length%3===1&&(r=r.substring(0,r.length-2)+"=="),r}var s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o="~~local_forage_type~",l=/^~~local_forage_type~([^~]+)~/,c="__lfsc__:",u=c.length,h="arbf",p="blob",d="si08",f="ui08",m="uic8",y="si16",g="si32",v="ur16",C="ui32",L="fl32",T="fl64",w=u+h.length,b={serialize:n,deserialize:r,stringToBuffer:i,bufferToString:a};return b}("undefined"!=typeof window?window:self);t["default"]=n,e.exports=t["default"]},function(e,t,n){"use strict";t.__esModule=!0;var r=function(e){function t(e){var t=this,r={db:null};if(e)for(var i in e)r[i]="string"!=typeof e[i]?e[i].toString():e[i];var a=new Promise(function(e,n){try{r.db=p(r.name,String(r.version),r.description,r.size)}catch(i){return n(i)}r.db.transaction(function(i){i.executeSql("CREATE TABLE IF NOT EXISTS "+r.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],function(){t._dbInfo=r,e()},function(e,t){n(t)})})});return new Promise(function(e,t){e(n(3))}).then(function(e){return r.serializer=e,a})}function r(t,n){var r=this;"string"!=typeof t&&(e.console.warn(t+" used as a key, but it is not a string."),t=String(t));var i=new Promise(function(e,n){r.ready().then(function(){var i=r._dbInfo;i.db.transaction(function(r){r.executeSql("SELECT * FROM "+i.storeName+" WHERE key = ? LIMIT 1",[t],function(t,n){var r=n.rows.length?n.rows.item(0).value:null;r&&(r=i.serializer.deserialize(r)),e(r)},function(e,t){n(t)})})})["catch"](n)});return h(i,n),i}function i(e,t){var n=this,r=new Promise(function(t,r){n.ready().then(function(){var i=n._dbInfo;i.db.transaction(function(n){n.executeSql("SELECT * FROM "+i.storeName,[],function(n,r){for(var a=r.rows,s=a.length,o=0;s>o;o++){var l=a.item(o),c=l.value;if(c&&(c=i.serializer.deserialize(c)),c=e(c,l.key,o+1),void 0!==c)return void t(c)}t()},function(e,t){r(t)})})})["catch"](r)});return h(r,t),r}function a(t,n,r){var i=this;"string"!=typeof t&&(e.console.warn(t+" used as a key, but it is not a string."),t=String(t));var a=new Promise(function(e,r){i.ready().then(function(){void 0===n&&(n=null);var a=n,s=i._dbInfo;s.serializer.serialize(n,function(n,i){i?r(i):s.db.transaction(function(i){i.executeSql("INSERT OR REPLACE INTO "+s.storeName+" (key, value) VALUES (?, ?)",[t,n],function(){e(a)},function(e,t){r(t)})},function(e){e.code===e.QUOTA_ERR&&r(e)})})})["catch"](r)});return h(a,r),a}function s(t,n){var r=this;"string"!=typeof t&&(e.console.warn(t+" used as a key, but it is not a string."),t=String(t));var i=new Promise(function(e,n){r.ready().then(function(){var i=r._dbInfo;i.db.transaction(function(r){r.executeSql("DELETE FROM "+i.storeName+" WHERE key = ?",[t],function(){e()},function(e,t){n(t)})})})["catch"](n)});return h(i,n),i}function o(e){var t=this,n=new Promise(function(e,n){t.ready().then(function(){var r=t._dbInfo;r.db.transaction(function(t){t.executeSql("DELETE FROM "+r.storeName,[],function(){e()},function(e,t){n(t)})})})["catch"](n)});return h(n,e),n}function l(e){var t=this,n=new Promise(function(e,n){t.ready().then(function(){var r=t._dbInfo;r.db.transaction(function(t){t.executeSql("SELECT COUNT(key) as c FROM "+r.storeName,[],function(t,n){var r=n.rows.item(0).c;e(r)},function(e,t){n(t)})})})["catch"](n)});return h(n,e),n}function c(e,t){var n=this,r=new Promise(function(t,r){n.ready().then(function(){var i=n._dbInfo;i.db.transaction(function(n){n.executeSql("SELECT key FROM "+i.storeName+" WHERE id = ? LIMIT 1",[e+1],function(e,n){var r=n.rows.length?n.rows.item(0).key:null;t(r)},function(e,t){r(t)})})})["catch"](r)});return h(r,t),r}function u(e){var t=this,n=new Promise(function(e,n){t.ready().then(function(){var r=t._dbInfo;r.db.transaction(function(t){t.executeSql("SELECT key FROM "+r.storeName,[],function(t,n){for(var r=[],i=0;i<n.rows.length;i++)r.push(n.rows.item(i).key);e(r)},function(e,t){n(t)})})})["catch"](n)});return h(n,e),n}function h(e,t){t&&e.then(function(e){t(null,e)},function(e){t(e)})}var p=e.openDatabase;if(p){var d={_driver:"webSQLStorage",_initStorage:t,iterate:i,getItem:r,setItem:a,removeItem:s,clear:o,length:l,key:c,keys:u};return d}}("undefined"!=typeof window?window:self);t["default"]=r,e.exports=t["default"]}])});var __extends=this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);n.prototype=t.prototype;e.prototype=new n};!function(e){function t(e,t,n){void 0!==t[e]&&(null===t[e]?delete n[e]:n[e]=t[e])}function n(t){if(null!=e.enabled&&!e.enabled||null!=e.maxMessages&&1>e.maxMessages)return!1;try{if(t.userAgentRegex&&!RegExp(t.userAgentRegex).test(navigator.userAgent))return!1}catch(n){}try{if(t.ipRegex&&e.clientIP&&!RegExp(t.ipRegex).test(e.clientIP))return!1}catch(r){}return!0}function r(e,t){try{if(e.disallow&&RegExp(e.disallow).test(t))return!1}catch(n){}return!0}function i(e){return"function"==typeof e?e instanceof RegExp?e.toString():e():e}function a(e){e=i(e);switch(typeof e){case"string":return new s(e,null,e);case"number":return e=e.toString(),new s(e,null,e);case"boolean":return e=e.toString(),new s(e,null,e);case"undefined":return new s("undefined",null,"undefined");case"object":return e instanceof RegExp||e instanceof String||e instanceof Number||e instanceof Boolean?(e=e.toString(),new s(e,null,e)):new s(null,e,JSON.stringify(e));default:return new s("unknown",null,"unknown")}}e.enabled;e.maxMessages;e.defaultAjaxUrl;e.clientIP;e.defaultBeforeSend;e.requestId="";var s=function(){return function(e,t,n){this.msg=e;this.meta=t;this.finalString=n}}();e.setOptions=function(e){t("enabled",e,this);t("maxMessages",e,this);t("defaultAjaxUrl",e,this);t("clientIP",e,this);t("requestId",e,this);t("defaultBeforeSend",e,this);return this};e.getAllLevel=function(){return-2147483648};e.getTraceLevel=function(){return 1e3};e.getDebugLevel=function(){return 2e3};e.getInfoLevel=function(){return 3e3};e.getWarnLevel=function(){return 4e3};e.getErrorLevel=function(){return 5e3};e.getFatalLevel=function(){return 6e3};e.getOffLevel=function(){return 2147483647};var o=function(){return function(e,t){this.inner=t;this.name="JL.Exception";this.message=a(e).finalString}}();e.Exception=o;o.prototype=Error();var l=function(){return function(e,t,n,r){this.l=e;this.m=t;this.n=n;this.t=r}}();e.LogItem=l;o=function(){function i(t,n){this.appenderName=t;this.sendLogItems=n;this.level=e.getTraceLevel();this.sendWithBufferLevel=2147483647;this.storeInBufferLevel=-2147483648;this.bufferSize=0;this.batchSize=1;this.buffer=[];this.batchBuffer=[]}i.prototype.setOptions=function(e){t("level",e,this);t("ipRegex",e,this);t("userAgentRegex",e,this);t("disallow",e,this);t("sendWithBufferLevel",e,this);t("storeInBufferLevel",e,this);t("bufferSize",e,this);t("batchSize",e,this);this.bufferSize<this.buffer.length&&(this.buffer.length=this.bufferSize);return this};i.prototype.log=function(e,t,i,a,s,o,c){!n(this)||!r(this,o)||s<this.storeInBufferLevel||(e=new l(s,o,c,(new Date).getTime()),s<this.level?0<this.bufferSize&&(this.buffer.push(e),this.buffer.length>this.bufferSize&&this.buffer.shift()):(s<this.sendWithBufferLevel||!this.buffer.length||(this.batchBuffer=this.batchBuffer.concat(this.buffer),this.buffer.length=0),this.batchBuffer.push(e),this.batchBuffer.length>=this.batchSize&&this.sendBatch()))};i.prototype.sendBatch=function(){0==this.batchBuffer.length||null!=e.maxMessages&&1>e.maxMessages||(null!=e.maxMessages&&(e.maxMessages-=this.batchBuffer.length),this.sendLogItems(this.batchBuffer),this.batchBuffer.length=0)};return i}();e.Appender=o;var c=function(n){function r(e){n.call(this,e,r.prototype.sendLogItemsAjax)}__extends(r,n);r.prototype.setOptions=function(e){t("url",e,this);t("beforeSend",e,this);n.prototype.setOptions.call(this,e);return this};r.prototype.sendLogItemsAjax=function(t){try{var n="/jsnlog.logger";null!=e.defaultAjaxUrl&&(n=e.defaultAjaxUrl);this.url&&(n=this.url);var r=JSON.stringify({r:e.requestId,lg:t}),i=this.getXhr(n);"function"==typeof this.beforeSend?this.beforeSend.call(this,i):"function"==typeof e.defaultBeforeSend&&e.defaultBeforeSend.call(this,i);i.send(r)}catch(a){}};r.prototype.getXhr=function(t){var n=new XMLHttpRequest;if(!("withCredentials"in n)&&"undefined"!=typeof XDomainRequest)return n=new XDomainRequest,n.open("POST",t),n;n.open("POST",t);n.setRequestHeader("Content-Type","application/json");n.setRequestHeader("JSNLog-RequestId",e.requestId);return n};return r}(o);e.AjaxAppender=c;var u=function(t){function n(e){t.call(this,e,n.prototype.sendLogItemsConsole)}__extends(n,t);n.prototype.clog=function(e){console.log(e)};n.prototype.cerror=function(e){console.error?console.error(e):this.clog(e)};n.prototype.cwarn=function(e){console.warn?console.warn(e):this.clog(e)};n.prototype.cinfo=function(e){console.info?console.info(e):this.clog(e)};n.prototype.cdebug=function(e){console.debug?console.debug(e):this.cinfo(e)};n.prototype.sendLogItemsConsole=function(t){try{if(console){var n;for(n=0;n<t.length;++n){var r=t[n],i=r.n+": "+r.m;"undefined"==typeof window&&(i=new Date(r.t)+" | "+i);r.l<=e.getDebugLevel()?this.cdebug(i):r.l<=e.getInfoLevel()?this.cinfo(i):r.l<=e.getWarnLevel()?this.cwarn(i):this.cerror(i)}}}catch(a){}};return n}(o);e.ConsoleAppender=u;o=function(){function e(e){this.loggerName=e;this.seenRegexes=[]}e.prototype.setOptions=function(e){t("level",e,this);t("userAgentRegex",e,this);t("disallow",e,this);t("ipRegex",e,this);t("appenders",e,this);t("onceOnly",e,this);this.seenRegexes=[];return this};e.prototype.buildExceptionObject=function(e){var t={};e.stack?t.stack=e.stack:t.e=e;e.message&&(t.message=e.message);e.name&&(t.name=e.name);e.data&&(t.data=e.data);e.inner&&(t.inner=this.buildExceptionObject(e.inner));return t};e.prototype.log=function(e,t,s){var o=0;if(!this.appenders)return this;if(e>=this.level&&n(this)&&(s?(o=this.buildExceptionObject(s),o.logData=i(t)):o=t,t=a(o),r(this,t.finalString))){if(this.onceOnly)for(o=this.onceOnly.length-1;o>=0;){if(RegExp(this.onceOnly[o]).test(t.finalString)){if(this.seenRegexes[o])return this;this.seenRegexes[o]=!0}o--}t.meta=t.meta||{};t.meta.loggerName=this.loggerName;for(o=this.appenders.length-1;o>=0;)this.appenders[o].log(1e3>=e?"trace":2e3>=e?"debug":3e3>=e?"info":4e3>=e?"warn":5e3>=e?"error":"fatal",t.msg,t.meta,function(){},e,t.finalString,this.loggerName),o--}return this};e.prototype.trace=function(e){return this.log(1e3,e)};e.prototype.debug=function(e){return this.log(2e3,e)};e.prototype.info=function(e){return this.log(3e3,e)};e.prototype.warn=function(e){return this.log(4e3,e)};e.prototype.error=function(e){return this.log(5e3,e)};e.prototype.fatal=function(e){return this.log(6e3,e)};e.prototype.fatalException=function(e,t){return this.log(6e3,e,t)};return e}();e.Logger=o;e.createAjaxAppender=function(e){return new c(e)};e.createConsoleAppender=function(e){return new u(e)};o=new c("");"undefined"==typeof window&&(o=new u(""));e.__=new e.Logger("");e.__.setOptions({level:e.getDebugLevel(),appenders:[o]})}(JL||(JL={}));var exports;"undefined"!=typeof exports&&(exports.JL=JL);var define;"function"==typeof define&&define.amd&&define("jsnlog",[],function(){return JL});"function"==typeof __jsnlog_configure&&__jsnlog_configure(JL);var OpenLayers={VERSION_NUMBER:"Release 2.13.1",singleFile:!0,_getScriptLocation:function(){for(var e,t,n=new RegExp("(^|(.*?\\/))(OpenLayers[^\\/]*?\\.js)(\\?|$)"),r=document.getElementsByTagName("script"),i="",a=0,s=r.length;s>a;a++){e=r[a].getAttribute("src");if(e){t=e.match(n);if(t){i=t[1];break}}}return function(){return i}}(),ImgPath:""};OpenLayers.Class=function(){var e=arguments.length,t=arguments[0],n=arguments[e-1],r="function"==typeof n.initialize?n.initialize:function(){t.prototype.initialize.apply(this,arguments)};if(e>1){var i=[r,t].concat(Array.prototype.slice.call(arguments).slice(1,e-1),n);OpenLayers.inherit.apply(null,i)}else r.prototype=n;return r};OpenLayers.inherit=function(e,t){var n=function(){};n.prototype=t.prototype;e.prototype=new n;var r,i,a;for(r=2,i=arguments.length;i>r;r++){a=arguments[r];"function"==typeof a&&(a=a.prototype);OpenLayers.Util.extend(e.prototype,a)}};OpenLayers.Util=OpenLayers.Util||{};OpenLayers.Util.extend=function(e,t){e=e||{};if(t){for(var n in t){var r=t[n];void 0!==r&&(e[n]=r)}var i="function"==typeof window.Event&&t instanceof window.Event;!i&&t.hasOwnProperty&&t.hasOwnProperty("toString")&&(e.toString=t.toString)}return e};OpenLayers.String={startsWith:function(e,t){return 0==e.indexOf(t)},contains:function(e,t){return-1!=e.indexOf(t)},trim:function(e){return e.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},camelize:function(e){for(var t=e.split("-"),n=t[0],r=1,i=t.length;i>r;r++){var a=t[r];n+=a.charAt(0).toUpperCase()+a.substring(1)}return n},format:function(e,t,n){t||(t=window);var r=function(e,r){for(var i,a=r.split(/\.+/),s=0;s<a.length;s++){0==s&&(i=t);if(void 0===i)break;i=i[a[s]]}"function"==typeof i&&(i=n?i.apply(null,n):i());return"undefined"==typeof i?"undefined":i};return e.replace(OpenLayers.String.tokenRegEx,r)},tokenRegEx:/\$\{([\w.]+?)\}/g,numberRegEx:/^([+-]?)(?=\d|\.\d)\d*(\.\d*)?([Ee]([+-]?\d+))?$/,isNumeric:function(e){return OpenLayers.String.numberRegEx.test(e)},numericIf:function(e,t){var n=e;t===!0&&null!=e&&e.replace&&(e=e.replace(/^\s*|\s*$/g,""));return OpenLayers.String.isNumeric(e)?parseFloat(e):n}};OpenLayers.Number={decimalSeparator:".",thousandsSeparator:",",limitSigDigs:function(e,t){var n=0;t>0&&(n=parseFloat(e.toPrecision(t)));return n},format:function(e,t,n,r){t="undefined"!=typeof t?t:0;n="undefined"!=typeof n?n:OpenLayers.Number.thousandsSeparator;r="undefined"!=typeof r?r:OpenLayers.Number.decimalSeparator;null!=t&&(e=parseFloat(e.toFixed(t)));var i=e.toString().split(".");1==i.length&&null==t&&(t=0);var a=i[0];if(n)for(var s=/(-?[0-9]+)([0-9]{3})/;s.test(a);)a=a.replace(s,"$1"+n+"$2");var o;if(0==t)o=a;else{var l=i.length>1?i[1]:"0";null!=t&&(l+=new Array(t-l.length+1).join("0"));o=a+r+l}return o},zeroPad:function(e,t,n){for(var r=e.toString(n||10);r.length<t;)r="0"+r;return r}};OpenLayers.Function={bind:function(e,t){var n=Array.prototype.slice.apply(arguments,[2]);return function(){var r=n.concat(Array.prototype.slice.apply(arguments,[0]));return e.apply(t,r)}},bindAsEventListener:function(e,t){return function(n){return e.call(t,n||window.event)}},False:function(){return!1},True:function(){return!0},Void:function(){}};OpenLayers.Array={filter:function(e,t,n){var r=[];if(Array.prototype.filter)r=e.filter(t,n);else{var i=e.length;if("function"!=typeof t)throw new TypeError;for(var a=0;i>a;a++)if(a in e){var s=e[a];t.call(n,s,a,e)&&r.push(s)}}return r}};OpenLayers.Bounds=OpenLayers.Class({left:null,bottom:null,right:null,top:null,centerLonLat:null,initialize:function(e,t,n,r){if(OpenLayers.Util.isArray(e)){r=e[3];n=e[2];t=e[1];e=e[0]}null!=e&&(this.left=OpenLayers.Util.toFloat(e));null!=t&&(this.bottom=OpenLayers.Util.toFloat(t));null!=n&&(this.right=OpenLayers.Util.toFloat(n));null!=r&&(this.top=OpenLayers.Util.toFloat(r))},clone:function(){return new OpenLayers.Bounds(this.left,this.bottom,this.right,this.top)},equals:function(e){var t=!1;null!=e&&(t=this.left==e.left&&this.right==e.right&&this.top==e.top&&this.bottom==e.bottom);return t},toString:function(){return[this.left,this.bottom,this.right,this.top].join(",")},toArray:function(e){return e===!0?[this.bottom,this.left,this.top,this.right]:[this.left,this.bottom,this.right,this.top]},toBBOX:function(e,t){null==e&&(e=6);var n=Math.pow(10,e),r=Math.round(this.left*n)/n,i=Math.round(this.bottom*n)/n,a=Math.round(this.right*n)/n,s=Math.round(this.top*n)/n;return t===!0?i+","+r+","+s+","+a:r+","+i+","+a+","+s},toGeometry:function(){return new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(this.left,this.bottom),new OpenLayers.Geometry.Point(this.right,this.bottom),new OpenLayers.Geometry.Point(this.right,this.top),new OpenLayers.Geometry.Point(this.left,this.top)])])},getWidth:function(){return this.right-this.left},getHeight:function(){return this.top-this.bottom},getSize:function(){return new OpenLayers.Size(this.getWidth(),this.getHeight())},getCenterPixel:function(){return new OpenLayers.Pixel((this.left+this.right)/2,(this.bottom+this.top)/2)},getCenterLonLat:function(){this.centerLonLat||(this.centerLonLat=new OpenLayers.LonLat((this.left+this.right)/2,(this.bottom+this.top)/2));return this.centerLonLat},scale:function(e,t){null==t&&(t=this.getCenterLonLat());var n,r;if("OpenLayers.LonLat"==t.CLASS_NAME){n=t.lon;r=t.lat}else{n=t.x;r=t.y}var i=(this.left-n)*e+n,a=(this.bottom-r)*e+r,s=(this.right-n)*e+n,o=(this.top-r)*e+r;return new OpenLayers.Bounds(i,a,s,o)},add:function(e,t){if(null==e||null==t)throw new TypeError("Bounds.add cannot receive null values");return new OpenLayers.Bounds(this.left+e,this.bottom+t,this.right+e,this.top+t)},extend:function(e){if(e)switch(e.CLASS_NAME){case"OpenLayers.LonLat":this.extendXY(e.lon,e.lat);break;case"OpenLayers.Geometry.Point":this.extendXY(e.x,e.y);break;case"OpenLayers.Bounds":this.centerLonLat=null;(null==this.left||e.left<this.left)&&(this.left=e.left);(null==this.bottom||e.bottom<this.bottom)&&(this.bottom=e.bottom);(null==this.right||e.right>this.right)&&(this.right=e.right);(null==this.top||e.top>this.top)&&(this.top=e.top)}},extendXY:function(e,t){this.centerLonLat=null;(null==this.left||e<this.left)&&(this.left=e);(null==this.bottom||t<this.bottom)&&(this.bottom=t);(null==this.right||e>this.right)&&(this.right=e);(null==this.top||t>this.top)&&(this.top=t)},containsLonLat:function(e,t){"boolean"==typeof t&&(t={inclusive:t});t=t||{};var n=this.contains(e.lon,e.lat,t.inclusive),r=t.worldBounds;if(r&&!n){var i=r.getWidth(),a=(r.left+r.right)/2,s=Math.round((e.lon-a)/i);n=this.containsLonLat({lon:e.lon-s*i,
lat:e.lat},{inclusive:t.inclusive})}return n},containsPixel:function(e,t){return this.contains(e.x,e.y,t)},contains:function(e,t,n){null==n&&(n=!0);if(null==e||null==t)return!1;e=OpenLayers.Util.toFloat(e);t=OpenLayers.Util.toFloat(t);var r=!1;r=n?e>=this.left&&e<=this.right&&t>=this.bottom&&t<=this.top:e>this.left&&e<this.right&&t>this.bottom&&t<this.top;return r},intersectsBounds:function(e,t){"boolean"==typeof t&&(t={inclusive:t});t=t||{};if(t.worldBounds){var n=this.wrapDateLine(t.worldBounds);e=e.wrapDateLine(t.worldBounds)}else n=this;null==t.inclusive&&(t.inclusive=!0);var r=!1,i=n.left==e.right||n.right==e.left||n.top==e.bottom||n.bottom==e.top;if(t.inclusive||!i){var a=e.bottom>=n.bottom&&e.bottom<=n.top||n.bottom>=e.bottom&&n.bottom<=e.top,s=e.top>=n.bottom&&e.top<=n.top||n.top>e.bottom&&n.top<e.top,o=e.left>=n.left&&e.left<=n.right||n.left>=e.left&&n.left<=e.right,l=e.right>=n.left&&e.right<=n.right||n.right>=e.left&&n.right<=e.right;r=(a||s)&&(o||l)}if(t.worldBounds&&!r){var c=t.worldBounds,u=c.getWidth(),h=!c.containsBounds(n),p=!c.containsBounds(e);if(h&&!p){e=e.add(-u,0);r=n.intersectsBounds(e,{inclusive:t.inclusive})}else if(p&&!h){n=n.add(-u,0);r=e.intersectsBounds(n,{inclusive:t.inclusive})}}return r},containsBounds:function(e,t,n){null==t&&(t=!1);null==n&&(n=!0);var r=this.contains(e.left,e.bottom,n),i=this.contains(e.right,e.bottom,n),a=this.contains(e.left,e.top,n),s=this.contains(e.right,e.top,n);return t?r||i||a||s:r&&i&&a&&s},determineQuadrant:function(e){var t="",n=this.getCenterLonLat();t+=e.lat<n.lat?"b":"t";t+=e.lon<n.lon?"l":"r";return t},transform:function(e,t){this.centerLonLat=null;var n=OpenLayers.Projection.transform({x:this.left,y:this.bottom},e,t),r=OpenLayers.Projection.transform({x:this.right,y:this.bottom},e,t),i=OpenLayers.Projection.transform({x:this.left,y:this.top},e,t),a=OpenLayers.Projection.transform({x:this.right,y:this.top},e,t);this.left=Math.min(n.x,i.x);this.bottom=Math.min(n.y,r.y);this.right=Math.max(r.x,a.x);this.top=Math.max(i.y,a.y);return this},wrapDateLine:function(e,t){t=t||{};var n=t.leftTolerance||0,r=t.rightTolerance||0,i=this.clone();if(e){for(var a=e.getWidth();i.left<e.left&&i.right-r<=e.left;)i=i.add(a,0);for(;i.left+n>=e.right&&i.right>e.right;)i=i.add(-a,0);var s=i.left+n;s<e.right&&s>e.left&&i.right-r>e.right&&(i=i.add(-a,0))}return i},CLASS_NAME:"OpenLayers.Bounds"});OpenLayers.Bounds.fromString=function(e,t){var n=e.split(",");return OpenLayers.Bounds.fromArray(n,t)};OpenLayers.Bounds.fromArray=function(e,t){return t===!0?new OpenLayers.Bounds(e[1],e[0],e[3],e[2]):new OpenLayers.Bounds(e[0],e[1],e[2],e[3])};OpenLayers.Bounds.fromSize=function(e){return new OpenLayers.Bounds(0,e.h,e.w,0)};OpenLayers.Bounds.oppositeQuadrant=function(e){var t="";t+="t"==e.charAt(0)?"b":"t";t+="l"==e.charAt(1)?"r":"l";return t};OpenLayers.Element={visible:function(e){return"none"!=OpenLayers.Util.getElement(e).style.display},toggle:function(){for(var e=0,t=arguments.length;t>e;e++){var n=OpenLayers.Util.getElement(arguments[e]),r=OpenLayers.Element.visible(n)?"none":"";n.style.display=r}},remove:function(e){e=OpenLayers.Util.getElement(e);e.parentNode.removeChild(e)},getHeight:function(e){e=OpenLayers.Util.getElement(e);return e.offsetHeight},hasClass:function(e,t){var n=e.className;return!!n&&new RegExp("(^|\\s)"+t+"(\\s|$)").test(n)},addClass:function(e,t){OpenLayers.Element.hasClass(e,t)||(e.className+=(e.className?" ":"")+t);return e},removeClass:function(e,t){var n=e.className;n&&(e.className=OpenLayers.String.trim(n.replace(new RegExp("(^|\\s+)"+t+"(\\s+|$)")," ")));return e},toggleClass:function(e,t){OpenLayers.Element.hasClass(e,t)?OpenLayers.Element.removeClass(e,t):OpenLayers.Element.addClass(e,t);return e},getStyle:function(e,t){e=OpenLayers.Util.getElement(e);var n=null;if(e&&e.style){n=e.style[OpenLayers.String.camelize(t)];if(!n)if(document.defaultView&&document.defaultView.getComputedStyle){var r=document.defaultView.getComputedStyle(e,null);n=r?r.getPropertyValue(t):null}else e.currentStyle&&(n=e.currentStyle[OpenLayers.String.camelize(t)]);var i=["left","top","right","bottom"];window.opera&&-1!=OpenLayers.Util.indexOf(i,t)&&"static"==OpenLayers.Element.getStyle(e,"position")&&(n="auto")}return"auto"==n?null:n}};OpenLayers.LonLat=OpenLayers.Class({lon:0,lat:0,initialize:function(e,t){if(OpenLayers.Util.isArray(e)){t=e[1];e=e[0]}this.lon=OpenLayers.Util.toFloat(e);this.lat=OpenLayers.Util.toFloat(t)},toString:function(){return"lon="+this.lon+",lat="+this.lat},toShortString:function(){return this.lon+", "+this.lat},clone:function(){return new OpenLayers.LonLat(this.lon,this.lat)},add:function(e,t){if(null==e||null==t)throw new TypeError("LonLat.add cannot receive null values");return new OpenLayers.LonLat(this.lon+OpenLayers.Util.toFloat(e),this.lat+OpenLayers.Util.toFloat(t))},equals:function(e){var t=!1;null!=e&&(t=this.lon==e.lon&&this.lat==e.lat||isNaN(this.lon)&&isNaN(this.lat)&&isNaN(e.lon)&&isNaN(e.lat));return t},transform:function(e,t){var n=OpenLayers.Projection.transform({x:this.lon,y:this.lat},e,t);this.lon=n.x;this.lat=n.y;return this},wrapDateLine:function(e){var t=this.clone();if(e){for(;t.lon<e.left;)t.lon+=e.getWidth();for(;t.lon>e.right;)t.lon-=e.getWidth()}return t},CLASS_NAME:"OpenLayers.LonLat"});OpenLayers.LonLat.fromString=function(e){var t=e.split(",");return new OpenLayers.LonLat(t[0],t[1])};OpenLayers.LonLat.fromArray=function(e){var t=OpenLayers.Util.isArray(e),n=t&&e[0],r=t&&e[1];return new OpenLayers.LonLat(n,r)};OpenLayers.Pixel=OpenLayers.Class({x:0,y:0,initialize:function(e,t){this.x=parseFloat(e);this.y=parseFloat(t)},toString:function(){return"x="+this.x+",y="+this.y},clone:function(){return new OpenLayers.Pixel(this.x,this.y)},equals:function(e){var t=!1;null!=e&&(t=this.x==e.x&&this.y==e.y||isNaN(this.x)&&isNaN(this.y)&&isNaN(e.x)&&isNaN(e.y));return t},distanceTo:function(e){return Math.sqrt(Math.pow(this.x-e.x,2)+Math.pow(this.y-e.y,2))},add:function(e,t){if(null==e||null==t)throw new TypeError("Pixel.add cannot receive null values");return new OpenLayers.Pixel(this.x+e,this.y+t)},offset:function(e){var t=this.clone();e&&(t=this.add(e.x,e.y));return t},CLASS_NAME:"OpenLayers.Pixel"});OpenLayers.Size=OpenLayers.Class({w:0,h:0,initialize:function(e,t){this.w=parseFloat(e);this.h=parseFloat(t)},toString:function(){return"w="+this.w+",h="+this.h},clone:function(){return new OpenLayers.Size(this.w,this.h)},equals:function(e){var t=!1;null!=e&&(t=this.w==e.w&&this.h==e.h||isNaN(this.w)&&isNaN(this.h)&&isNaN(e.w)&&isNaN(e.h));return t},CLASS_NAME:"OpenLayers.Size"});OpenLayers.Console={log:function(){},debug:function(){},info:function(){},warn:function(){},error:function(){},userError:function(e){alert(e)},assert:function(){},dir:function(){},dirxml:function(){},trace:function(){},group:function(){},groupEnd:function(){},time:function(){},timeEnd:function(){},profile:function(){},profileEnd:function(){},count:function(){},CLASS_NAME:"OpenLayers.Console"};!function(){for(var e=document.getElementsByTagName("script"),t=0,n=e.length;n>t;++t)if(-1!=e[t].src.indexOf("firebug.js")&&console){OpenLayers.Util.extend(OpenLayers.Console,console);break}}();OpenLayers.Lang={code:null,defaultCode:"en",getCode:function(){OpenLayers.Lang.code||OpenLayers.Lang.setCode();return OpenLayers.Lang.code},setCode:function(e){var t;e||(e="msie"==OpenLayers.BROWSER_NAME?navigator.userLanguage:navigator.language);var n=e.split("-");n[0]=n[0].toLowerCase();"object"==typeof OpenLayers.Lang[n[0]]&&(t=n[0]);if(n[1]){var r=n[0]+"-"+n[1].toUpperCase();"object"==typeof OpenLayers.Lang[r]&&(t=r)}if(!t){OpenLayers.Console.warn("Failed to find OpenLayers.Lang."+n.join("-")+" dictionary, falling back to default language");t=OpenLayers.Lang.defaultCode}OpenLayers.Lang.code=t},translate:function(e,t){var n=OpenLayers.Lang[OpenLayers.Lang.getCode()],r=n&&n[e];r||(r=e);t&&(r=OpenLayers.String.format(r,t));return r}};OpenLayers.i18n=OpenLayers.Lang.translate;OpenLayers.Util=OpenLayers.Util||{};OpenLayers.Util.getElement=function(){for(var e=[],t=0,n=arguments.length;n>t;t++){var r=arguments[t];"string"==typeof r&&(r=document.getElementById(r));if(1==arguments.length)return r;e.push(r)}return e};OpenLayers.Util.isElement=function(e){return!(!e||1!==e.nodeType)};OpenLayers.Util.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)};OpenLayers.Util.removeItem=function(e,t){for(var n=e.length-1;n>=0;n--)e[n]==t&&e.splice(n,1);return e};OpenLayers.Util.indexOf=function(e,t){if("function"==typeof e.indexOf)return e.indexOf(t);for(var n=0,r=e.length;r>n;n++)if(e[n]==t)return n;return-1};OpenLayers.Util.dotless=/\./g;OpenLayers.Util.modifyDOMElement=function(e,t,n,r,i,a,s,o){t&&(e.id=t.replace(OpenLayers.Util.dotless,"_"));if(n){e.style.left=n.x+"px";e.style.top=n.y+"px"}if(r){e.style.width=r.w+"px";e.style.height=r.h+"px"}i&&(e.style.position=i);a&&(e.style.border=a);s&&(e.style.overflow=s);if(parseFloat(o)>=0&&parseFloat(o)<1){e.style.filter="alpha(opacity="+100*o+")";e.style.opacity=o}else if(1==parseFloat(o)){e.style.filter="";e.style.opacity=""}};OpenLayers.Util.createDiv=function(e,t,n,r,i,a,s,o){var l=document.createElement("div");r&&(l.style.backgroundImage="url("+r+")");e||(e=OpenLayers.Util.createUniqueID("OpenLayersDiv"));i||(i="absolute");OpenLayers.Util.modifyDOMElement(l,e,t,n,i,a,s,o);return l};OpenLayers.Util.createImage=function(e,t,n,r,i,a,s,o){function l(){c.style.display="";OpenLayers.Event.stopObservingElement(c)}var c=document.createElement("img");e||(e=OpenLayers.Util.createUniqueID("OpenLayersDiv"));i||(i="relative");OpenLayers.Util.modifyDOMElement(c,e,t,n,i,a,null,s);if(o){c.style.display="none";OpenLayers.Event.observe(c,"load",l);OpenLayers.Event.observe(c,"error",l)}c.style.alt=e;c.galleryImg="no";r&&(c.src=r);return c};OpenLayers.IMAGE_RELOAD_ATTEMPTS=0;OpenLayers.Util.alphaHackNeeded=null;OpenLayers.Util.alphaHack=function(){if(null==OpenLayers.Util.alphaHackNeeded){var e=navigator.appVersion.split("MSIE"),t=parseFloat(e[1]),n=!1;try{n=!!document.body.filters}catch(r){}OpenLayers.Util.alphaHackNeeded=n&&t>=5.5&&7>t}return OpenLayers.Util.alphaHackNeeded};OpenLayers.Util.modifyAlphaImageDiv=function(e,t,n,r,i,a,s,o,l){OpenLayers.Util.modifyDOMElement(e,t,n,r,a,null,null,l);var c=e.childNodes[0];i&&(c.src=i);OpenLayers.Util.modifyDOMElement(c,e.id+"_innerImage",null,r,"relative",s);if(OpenLayers.Util.alphaHack()){"none"!=e.style.display&&(e.style.display="inline-block");null==o&&(o="scale");e.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+c.src+"', sizingMethod='"+o+"')";parseFloat(e.style.opacity)>=0&&parseFloat(e.style.opacity)<1&&(e.style.filter+=" alpha(opacity="+100*e.style.opacity+")");c.style.filter="alpha(opacity=0)"}};OpenLayers.Util.createAlphaImageDiv=function(e,t,n,r,i,a,s,o,l){var c=OpenLayers.Util.createDiv(),u=OpenLayers.Util.createImage(null,null,null,null,null,null,null,l);u.className="olAlphaImg";c.appendChild(u);OpenLayers.Util.modifyAlphaImageDiv(c,e,t,n,r,i,a,s,o);return c};OpenLayers.Util.upperCaseObject=function(e){var t={};for(var n in e)t[n.toUpperCase()]=e[n];return t};OpenLayers.Util.applyDefaults=function(e,t){e=e||{};var n="function"==typeof window.Event&&t instanceof window.Event;for(var r in t)(void 0===e[r]||!n&&t.hasOwnProperty&&t.hasOwnProperty(r)&&!e.hasOwnProperty(r))&&(e[r]=t[r]);!n&&t&&t.hasOwnProperty&&t.hasOwnProperty("toString")&&!e.hasOwnProperty("toString")&&(e.toString=t.toString);return e};OpenLayers.Util.getParameterString=function(e){var t=[];for(var n in e){var r=e[n];if(null!=r&&"function"!=typeof r){var i;if("object"==typeof r&&r.constructor==Array){for(var a,s=[],o=0,l=r.length;l>o;o++){a=r[o];s.push(encodeURIComponent(null===a||void 0===a?"":a))}i=s.join(",")}else i=encodeURIComponent(r);t.push(encodeURIComponent(n)+"="+i)}}return t.join("&")};OpenLayers.Util.urlAppend=function(e,t){var n=e;if(t){var r=(e+" ").split(/[?&]/);n+=" "===r.pop()?t:r.length?"&"+t:"?"+t}return n};OpenLayers.Util.getImagesLocation=function(){return OpenLayers.ImgPath||OpenLayers._getScriptLocation()+"img/"};OpenLayers.Util.getImageLocation=function(e){return OpenLayers.Util.getImagesLocation()+e};OpenLayers.Util.Try=function(){for(var e=null,t=0,n=arguments.length;n>t;t++){var r=arguments[t];try{e=r();break}catch(i){}}return e};OpenLayers.Util.getXmlNodeValue=function(e){var t=null;OpenLayers.Util.Try(function(){t=e.text;t||(t=e.textContent);t||(t=e.firstChild.nodeValue)},function(){t=e.textContent});return t};OpenLayers.Util.mouseLeft=function(e,t){for(var n=e.relatedTarget?e.relatedTarget:e.toElement;n!=t&&null!=n;)n=n.parentNode;return n!=t};OpenLayers.Util.DEFAULT_PRECISION=14;OpenLayers.Util.toFloat=function(e,t){null==t&&(t=OpenLayers.Util.DEFAULT_PRECISION);"number"!=typeof e&&(e=parseFloat(e));return 0===t?e:parseFloat(e.toPrecision(t))};OpenLayers.Util.rad=function(e){return e*Math.PI/180};OpenLayers.Util.deg=function(e){return 180*e/Math.PI};OpenLayers.Util.VincentyConstants={a:6378137,b:6356752.3142,f:1/298.257223563};OpenLayers.Util.distVincenty=function(e,t){for(var n=OpenLayers.Util.VincentyConstants,r=n.a,i=n.b,a=n.f,s=OpenLayers.Util.rad(t.lon-e.lon),o=Math.atan((1-a)*Math.tan(OpenLayers.Util.rad(e.lat))),l=Math.atan((1-a)*Math.tan(OpenLayers.Util.rad(t.lat))),c=Math.sin(o),u=Math.cos(o),h=Math.sin(l),p=Math.cos(l),d=s,f=2*Math.PI,m=20;Math.abs(d-f)>1e-12&&--m>0;){var y=Math.sin(d),g=Math.cos(d),v=Math.sqrt(p*y*p*y+(u*h-c*p*g)*(u*h-c*p*g));if(0==v)return 0;var C=c*h+u*p*g,L=Math.atan2(v,C),T=Math.asin(u*p*y/v),w=Math.cos(T)*Math.cos(T),b=C-2*c*h/w,S=a/16*w*(4+a*(4-3*w));f=d;d=s+(1-S)*a*Math.sin(T)*(L+S*v*(b+S*C*(-1+2*b*b)))}if(0==m)return 0/0;var E=w*(r*r-i*i)/(i*i),O=1+E/16384*(4096+E*(-768+E*(320-175*E))),A=E/1024*(256+E*(-128+E*(74-47*E))),x=A*v*(b+A/4*(C*(-1+2*b*b)-A/6*b*(-3+4*v*v)*(-3+4*b*b))),P=i*O*(L-x),_=P.toFixed(3)/1e3;return _};OpenLayers.Util.destinationVincenty=function(e,t,n){for(var r=OpenLayers.Util,i=r.VincentyConstants,a=i.a,s=i.b,o=i.f,l=e.lon,c=e.lat,u=n,h=r.rad(t),p=Math.sin(h),d=Math.cos(h),f=(1-o)*Math.tan(r.rad(c)),m=1/Math.sqrt(1+f*f),y=f*m,g=Math.atan2(f,d),v=m*p,C=1-v*v,L=C*(a*a-s*s)/(s*s),T=1+L/16384*(4096+L*(-768+L*(320-175*L))),w=L/1024*(256+L*(-128+L*(74-47*L))),b=u/(s*T),S=2*Math.PI;Math.abs(b-S)>1e-12;){var E=Math.cos(2*g+b),O=Math.sin(b),A=Math.cos(b),x=w*O*(E+w/4*(A*(-1+2*E*E)-w/6*E*(-3+4*O*O)*(-3+4*E*E)));S=b;b=u/(s*T)+x}{var P=y*O-m*A*d,_=Math.atan2(y*A+m*O*d,(1-o)*Math.sqrt(v*v+P*P)),N=Math.atan2(O*p,m*A-y*O*d),M=o/16*C*(4+o*(4-3*C)),k=N-(1-M)*o*v*(b+M*O*(E+M*A*(-1+2*E*E)));Math.atan2(v,-P)}return new OpenLayers.LonLat(l+r.deg(k),r.deg(_))};OpenLayers.Util.getParameters=function(e,t){t=t||{};e=null===e||void 0===e?window.location.href:e;var n="";if(OpenLayers.String.contains(e,"?")){var r=e.indexOf("?")+1,i=OpenLayers.String.contains(e,"#")?e.indexOf("#"):e.length;n=e.substring(r,i)}for(var a={},s=n.split(/[&;]/),o=0,l=s.length;l>o;++o){var c=s[o].split("=");if(c[0]){var u=c[0];try{u=decodeURIComponent(u)}catch(h){u=unescape(u)}var p=(c[1]||"").replace(/\+/g," ");try{p=decodeURIComponent(p)}catch(h){p=unescape(p)}t.splitArgs!==!1&&(p=p.split(","));1==p.length&&(p=p[0]);a[u]=p}}return a};OpenLayers.Util.lastSeqID=0;OpenLayers.Util.createUniqueID=function(e){e=null==e?"id_":e.replace(OpenLayers.Util.dotless,"_");OpenLayers.Util.lastSeqID+=1;return e+OpenLayers.Util.lastSeqID};OpenLayers.INCHES_PER_UNIT={inches:1,ft:12,mi:63360,m:39.37,km:39370,dd:4374754,yd:36};OpenLayers.INCHES_PER_UNIT["in"]=OpenLayers.INCHES_PER_UNIT.inches;OpenLayers.INCHES_PER_UNIT.degrees=OpenLayers.INCHES_PER_UNIT.dd;OpenLayers.INCHES_PER_UNIT.nmi=1852*OpenLayers.INCHES_PER_UNIT.m;OpenLayers.METERS_PER_INCH=.0254000508001016;OpenLayers.Util.extend(OpenLayers.INCHES_PER_UNIT,{Inch:OpenLayers.INCHES_PER_UNIT.inches,Meter:1/OpenLayers.METERS_PER_INCH,Foot:.3048006096012192/OpenLayers.METERS_PER_INCH,IFoot:.3048/OpenLayers.METERS_PER_INCH,ClarkeFoot:.3047972651151/OpenLayers.METERS_PER_INCH,SearsFoot:.30479947153867626/OpenLayers.METERS_PER_INCH,GoldCoastFoot:.3047997101815088/OpenLayers.METERS_PER_INCH,IInch:.0254/OpenLayers.METERS_PER_INCH,MicroInch:254e-7/OpenLayers.METERS_PER_INCH,Mil:2.54e-8/OpenLayers.METERS_PER_INCH,Centimeter:.01/OpenLayers.METERS_PER_INCH,Kilometer:1e3/OpenLayers.METERS_PER_INCH,Yard:.9144018288036576/OpenLayers.METERS_PER_INCH,SearsYard:.914398414616029/OpenLayers.METERS_PER_INCH,IndianYard:.9143985307444408/OpenLayers.METERS_PER_INCH,IndianYd37:.91439523/OpenLayers.METERS_PER_INCH,IndianYd62:.9143988/OpenLayers.METERS_PER_INCH,IndianYd75:.9143985/OpenLayers.METERS_PER_INCH,IndianFoot:.30479951/OpenLayers.METERS_PER_INCH,IndianFt37:.30479841/OpenLayers.METERS_PER_INCH,IndianFt62:.3047996/OpenLayers.METERS_PER_INCH,IndianFt75:.3047995/OpenLayers.METERS_PER_INCH,Mile:1609.3472186944373/OpenLayers.METERS_PER_INCH,IYard:.9144/OpenLayers.METERS_PER_INCH,IMile:1609.344/OpenLayers.METERS_PER_INCH,NautM:1852/OpenLayers.METERS_PER_INCH,"Lat-66":110943.31648893273/OpenLayers.METERS_PER_INCH,"Lat-83":110946.25736872235/OpenLayers.METERS_PER_INCH,Decimeter:.1/OpenLayers.METERS_PER_INCH,Millimeter:.001/OpenLayers.METERS_PER_INCH,Dekameter:10/OpenLayers.METERS_PER_INCH,Decameter:10/OpenLayers.METERS_PER_INCH,Hectometer:100/OpenLayers.METERS_PER_INCH,GermanMeter:1.0000135965/OpenLayers.METERS_PER_INCH,CaGrid:.999738/OpenLayers.METERS_PER_INCH,ClarkeChain:20.1166194976/OpenLayers.METERS_PER_INCH,GunterChain:20.11684023368047/OpenLayers.METERS_PER_INCH,BenoitChain:20.116782494375872/OpenLayers.METERS_PER_INCH,SearsChain:20.11676512155/OpenLayers.METERS_PER_INCH,ClarkeLink:.201166194976/OpenLayers.METERS_PER_INCH,GunterLink:.2011684023368047/OpenLayers.METERS_PER_INCH,BenoitLink:.20116782494375873/OpenLayers.METERS_PER_INCH,SearsLink:.2011676512155/OpenLayers.METERS_PER_INCH,Rod:5.02921005842012/OpenLayers.METERS_PER_INCH,IntnlChain:20.1168/OpenLayers.METERS_PER_INCH,IntnlLink:.201168/OpenLayers.METERS_PER_INCH,Perch:5.02921005842012/OpenLayers.METERS_PER_INCH,Pole:5.02921005842012/OpenLayers.METERS_PER_INCH,Furlong:201.1684023368046/OpenLayers.METERS_PER_INCH,Rood:3.778266898/OpenLayers.METERS_PER_INCH,CapeFoot:.3047972615/OpenLayers.METERS_PER_INCH,Brealey:375/OpenLayers.METERS_PER_INCH,ModAmFt:.304812252984506/OpenLayers.METERS_PER_INCH,Fathom:1.8288/OpenLayers.METERS_PER_INCH,"NautM-UK":1853.184/OpenLayers.METERS_PER_INCH,"50kilometers":5e4/OpenLayers.METERS_PER_INCH,"150kilometers":15e4/OpenLayers.METERS_PER_INCH});OpenLayers.Util.extend(OpenLayers.INCHES_PER_UNIT,{mm:OpenLayers.INCHES_PER_UNIT.Meter/1e3,cm:OpenLayers.INCHES_PER_UNIT.Meter/100,dm:100*OpenLayers.INCHES_PER_UNIT.Meter,km:1e3*OpenLayers.INCHES_PER_UNIT.Meter,kmi:OpenLayers.INCHES_PER_UNIT.nmi,fath:OpenLayers.INCHES_PER_UNIT.Fathom,ch:OpenLayers.INCHES_PER_UNIT.IntnlChain,link:OpenLayers.INCHES_PER_UNIT.IntnlLink,"us-in":OpenLayers.INCHES_PER_UNIT.inches,"us-ft":OpenLayers.INCHES_PER_UNIT.Foot,"us-yd":OpenLayers.INCHES_PER_UNIT.Yard,"us-ch":OpenLayers.INCHES_PER_UNIT.GunterChain,"us-mi":OpenLayers.INCHES_PER_UNIT.Mile,"ind-yd":OpenLayers.INCHES_PER_UNIT.IndianYd37,"ind-ft":OpenLayers.INCHES_PER_UNIT.IndianFt37,"ind-ch":20.11669506/OpenLayers.METERS_PER_INCH});OpenLayers.DOTS_PER_INCH=72;OpenLayers.Util.normalizeScale=function(e){var t=e>1?1/e:e;return t};OpenLayers.Util.getResolutionFromScale=function(e,t){var n;if(e){null==t&&(t="degrees");var r=OpenLayers.Util.normalizeScale(e);n=1/(r*OpenLayers.INCHES_PER_UNIT[t]*OpenLayers.DOTS_PER_INCH)}return n};OpenLayers.Util.getScaleFromResolution=function(e,t){null==t&&(t="degrees");var n=e*OpenLayers.INCHES_PER_UNIT[t]*OpenLayers.DOTS_PER_INCH;return n};OpenLayers.Util.pagePosition=function(e){var t=[0,0],n=OpenLayers.Util.getViewportElement();if(!e||e==window||e==n)return t;var r,i=OpenLayers.IS_GECKO&&document.getBoxObjectFor&&"absolute"==OpenLayers.Element.getStyle(e,"position")&&(""==e.style.top||""==e.style.left),a=null;if(e.getBoundingClientRect){r=e.getBoundingClientRect();var s=window.pageYOffset||n.scrollTop,o=window.pageXOffset||n.scrollLeft;t[0]=r.left+o;t[1]=r.top+s}else if(document.getBoxObjectFor&&!i){r=document.getBoxObjectFor(e);var l=document.getBoxObjectFor(n);t[0]=r.screenX-l.screenX;t[1]=r.screenY-l.screenY}else{t[0]=e.offsetLeft;t[1]=e.offsetTop;a=e.offsetParent;if(a!=e)for(;a;){t[0]+=a.offsetLeft;t[1]+=a.offsetTop;a=a.offsetParent}var c=OpenLayers.BROWSER_NAME;("opera"==c||"safari"==c&&"absolute"==OpenLayers.Element.getStyle(e,"position"))&&(t[1]-=document.body.offsetTop);a=e.offsetParent;for(;a&&a!=document.body;){t[0]-=a.scrollLeft;("opera"!=c||"TR"!=a.tagName)&&(t[1]-=a.scrollTop);a=a.offsetParent}}return t};OpenLayers.Util.getViewportElement=function(){var e=arguments.callee.viewportElement;if(void 0==e){e="msie"==OpenLayers.BROWSER_NAME&&"CSS1Compat"!=document.compatMode?document.body:document.documentElement;arguments.callee.viewportElement=e}return e};OpenLayers.Util.isEquivalentUrl=function(e,t,n){n=n||{};OpenLayers.Util.applyDefaults(n,{ignoreCase:!0,ignorePort80:!0,ignoreHash:!0,splitArgs:!1});var r=OpenLayers.Util.createUrlObject(e,n),i=OpenLayers.Util.createUrlObject(t,n);for(var a in r)if("args"!==a&&r[a]!=i[a])return!1;for(var a in r.args){if(r.args[a]!=i.args[a])return!1;delete i.args[a]}for(var a in i.args)return!1;return!0};OpenLayers.Util.createUrlObject=function(e,t){t=t||{};if(!/^\w+:\/\//.test(e)){var n=window.location,r=n.port?":"+n.port:"",i=n.protocol+"//"+n.host.split(":").shift()+r;if(0===e.indexOf("/"))e=i+e;else{var a=n.pathname.split("/");a.pop();e=i+a.join("/")+"/"+e}}t.ignoreCase&&(e=e.toLowerCase());var s=document.createElement("a");s.href=e;var o={};o.host=s.host.split(":").shift();o.protocol=s.protocol;o.port=t.ignorePort80?"80"==s.port||"0"==s.port?"":s.port:""==s.port||"0"==s.port?"80":s.port;o.hash=t.ignoreHash||"#"===s.hash?"":s.hash;var l=s.search;if(!l){var c=e.indexOf("?");l=-1!=c?e.substr(c):""}o.args=OpenLayers.Util.getParameters(l,{splitArgs:t.splitArgs});o.pathname="/"==s.pathname.charAt(0)?s.pathname:"/"+s.pathname;return o};OpenLayers.Util.removeTail=function(e){var t=null,n=e.indexOf("?"),r=e.indexOf("#");t=-1==n?-1!=r?e.substr(0,r):e:-1!=r?e.substr(0,Math.min(n,r)):e.substr(0,n);return t};OpenLayers.IS_GECKO=function(){var e=navigator.userAgent.toLowerCase();return-1==e.indexOf("webkit")&&-1!=e.indexOf("gecko")}();OpenLayers.CANVAS_SUPPORTED=function(){var e=document.createElement("canvas");return!(!e.getContext||!e.getContext("2d"))}();OpenLayers.BROWSER_NAME=function(){var e="",t=navigator.userAgent.toLowerCase();-1!=t.indexOf("opera")?e="opera":-1!=t.indexOf("msie")?e="msie":-1!=t.indexOf("safari")?e="safari":-1!=t.indexOf("mozilla")&&(e=-1!=t.indexOf("firefox")?"firefox":"mozilla");return e}();OpenLayers.Util.getBrowserName=function(){return OpenLayers.BROWSER_NAME};OpenLayers.Util.getRenderedDimensions=function(e,t,n){var r,i,a=document.createElement("div");a.style.visibility="hidden";for(var s=n&&n.containerElement?n.containerElement:document.body,o=!1,l=null,c=s;c&&"body"!=c.tagName.toLowerCase();){var u=OpenLayers.Element.getStyle(c,"position");if("absolute"==u){o=!0;break}if(u&&"static"!=u)break;c=c.parentNode}if(o&&(0===s.clientHeight||0===s.clientWidth)){l=document.createElement("div");l.style.visibility="hidden";l.style.position="absolute";l.style.overflow="visible";l.style.width=document.body.clientWidth+"px";l.style.height=document.body.clientHeight+"px";l.appendChild(a)}a.style.position="absolute";if(t)if(t.w){r=t.w;a.style.width=r+"px"}else if(t.h){i=t.h;a.style.height=i+"px"}n&&n.displayClass&&(a.className=n.displayClass);var h=document.createElement("div");h.innerHTML=e;h.style.overflow="visible";if(h.childNodes)for(var p=0,d=h.childNodes.length;d>p;p++)h.childNodes[p].style&&(h.childNodes[p].style.overflow="visible");a.appendChild(h);s.appendChild(l?l:a);if(!r){r=parseInt(h.scrollWidth);a.style.width=r+"px"}i||(i=parseInt(h.scrollHeight));a.removeChild(h);if(l){l.removeChild(a);s.removeChild(l)}else s.removeChild(a);return new OpenLayers.Size(r,i)};OpenLayers.Util.getScrollbarWidth=function(){var e=OpenLayers.Util._scrollbarWidth;if(null==e){var t=null,n=null,r=0,i=0;t=document.createElement("div");t.style.position="absolute";t.style.top="-1000px";t.style.left="-1000px";t.style.width="100px";t.style.height="50px";t.style.overflow="hidden";n=document.createElement("div");n.style.width="100%";n.style.height="200px";t.appendChild(n);document.body.appendChild(t);r=n.offsetWidth;t.style.overflow="scroll";i=n.offsetWidth;document.body.removeChild(document.body.lastChild);OpenLayers.Util._scrollbarWidth=r-i;e=OpenLayers.Util._scrollbarWidth}return e};OpenLayers.Util.getFormattedLonLat=function(e,t,n){n||(n="dms");e=(e+540)%360-180;var r=Math.abs(e),i=Math.floor(r),a=(r-i)/(1/60),s=a;a=Math.floor(a);var o=(s-a)/(1/60);o=Math.round(10*o);o/=10;if(o>=60){o-=60;a+=1;if(a>=60){a-=60;i+=1}}10>i&&(i="0"+i);var l=i+"\xb0";if(n.indexOf("dm")>=0){10>a&&(a="0"+a);l+=a+"'";if(n.indexOf("dms")>=0){10>o&&(o="0"+o);l+=o+'"'}}l+=OpenLayers.i18n("lon"==t?0>e?"W":"E":0>e?"S":"N");return l};OpenLayers.Util=OpenLayers.Util||{};OpenLayers.Util.vendorPrefix=function(){"use strict";function e(e){return e?e.replace(/([A-Z])/g,function(e){return"-"+e.toLowerCase()}).replace(/^ms-/,"-ms-"):null}function t(t){if(void 0===s[t]){var n=t.replace(/(-[\s\S])/g,function(e){return e.charAt(1).toUpperCase()}),i=r(n);s[t]=e(i)}return s[t]}function n(e,t){if(void 0===o[t]){var n,r,a=0,s=i.length,l="undefined"!=typeof e.cssText;o[t]=null;for(;s>a;a++){r=i[a];if(r){l||(r=r.toLowerCase());n=r+t.charAt(0).toUpperCase()+t.slice(1)}else n=t;if(void 0!==e[n]){o[t]=n;break}}}return o[t]}function r(e){return n(a,e)}var i=["","O","ms","Moz","Webkit"],a=document.createElement("div").style,s={},o={};return{css:t,js:n,style:r,cssCache:s,jsCache:o}}();OpenLayers.Event={observers:!1,KEY_SPACE:32,KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,element:function(e){return e.target||e.srcElement},isSingleTouch:function(e){return e.touches&&1==e.touches.length},isMultiTouch:function(e){return e.touches&&e.touches.length>1},isLeftClick:function(e){return e.which&&1==e.which||e.button&&1==e.button},isRightClick:function(e){return e.which&&3==e.which||e.button&&2==e.button},stop:function(e,t){t||OpenLayers.Event.preventDefault(e);e.stopPropagation?e.stopPropagation():e.cancelBubble=!0},preventDefault:function(e){e.preventDefault?e.preventDefault():e.returnValue=!1},findElement:function(e,t){for(var n=OpenLayers.Event.element(e);n.parentNode&&(!n.tagName||n.tagName.toUpperCase()!=t.toUpperCase());)n=n.parentNode;return n},observe:function(e,t,n,r){var i=OpenLayers.Util.getElement(e);r=r||!1;"keypress"==t&&(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||i.attachEvent)&&(t="keydown");this.observers||(this.observers={});if(!i._eventCacheID){var a="eventCacheID_";i.id&&(a=i.id+"_"+a);i._eventCacheID=OpenLayers.Util.createUniqueID(a)}var s=i._eventCacheID;this.observers[s]||(this.observers[s]=[]);this.observers[s].push({element:i,name:t,observer:n,useCapture:r});i.addEventListener?i.addEventListener(t,n,r):i.attachEvent&&i.attachEvent("on"+t,n)},stopObservingElement:function(e){var t=OpenLayers.Util.getElement(e),n=t._eventCacheID;this._removeElementObservers(OpenLayers.Event.observers[n])},_removeElementObservers:function(e){if(e)for(var t=e.length-1;t>=0;t--){var n=e[t];OpenLayers.Event.stopObserving.apply(this,[n.element,n.name,n.observer,n.useCapture])}},stopObserving:function(e,t,n,r){r=r||!1;var i=OpenLayers.Util.getElement(e),a=i._eventCacheID;"keypress"==t&&(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||i.detachEvent)&&(t="keydown");var s=!1,o=OpenLayers.Event.observers[a];if(o)for(var l=0;!s&&l<o.length;){var c=o[l];if(c.name==t&&c.observer==n&&c.useCapture==r){o.splice(l,1);0==o.length&&delete OpenLayers.Event.observers[a];s=!0;break}l++}s&&(i.removeEventListener?i.removeEventListener(t,n,r):i&&i.detachEvent&&i.detachEvent("on"+t,n));return s},unloadCache:function(){if(OpenLayers.Event&&OpenLayers.Event.observers){for(var e in OpenLayers.Event.observers){var t=OpenLayers.Event.observers[e];OpenLayers.Event._removeElementObservers.apply(this,[t])}OpenLayers.Event.observers=!1}},CLASS_NAME:"OpenLayers.Event"};OpenLayers.Event.observe(window,"unload",OpenLayers.Event.unloadCache,!1);OpenLayers.Events=OpenLayers.Class({BROWSER_EVENTS:["mouseover","mouseout","mousedown","mouseup","mousemove","click","dblclick","rightclick","dblrightclick","resize","focus","blur","touchstart","touchmove","touchend","keydown"],listeners:null,object:null,element:null,eventHandler:null,fallThrough:null,includeXY:!1,extensions:null,extensionCount:null,clearMouseListener:null,initialize:function(e,t,n,r,i){OpenLayers.Util.extend(this,i);this.object=e;this.fallThrough=r;this.listeners={};this.extensions={};this.extensionCount={};this._msTouches=[];null!=t&&this.attachToElement(t)},destroy:function(){for(var e in this.extensions)"boolean"!=typeof this.extensions[e]&&this.extensions[e].destroy();this.extensions=null;if(this.element){OpenLayers.Event.stopObservingElement(this.element);this.element.hasScrollEvent&&OpenLayers.Event.stopObserving(window,"scroll",this.clearMouseListener)}this.element=null;this.listeners=null;this.object=null;this.fallThrough=null;this.eventHandler=null},addEventType:function(e){},attachToElement:function(e){if(this.element)OpenLayers.Event.stopObservingElement(this.element);else{this.eventHandler=OpenLayers.Function.bindAsEventListener(this.handleBrowserEvent,this);this.clearMouseListener=OpenLayers.Function.bind(this.clearMouseCache,this)}this.element=e;for(var t,n=!!window.navigator.msMaxTouchPoints,r=0,i=this.BROWSER_EVENTS.length;i>r;r++){t=this.BROWSER_EVENTS[r];OpenLayers.Event.observe(e,t,this.eventHandler);n&&0===t.indexOf("touch")&&this.addMsTouchListener(e,t,this.eventHandler)}OpenLayers.Event.observe(e,"dragstart",OpenLayers.Event.stop)},on:function(e){for(var t in e)"scope"!=t&&e.hasOwnProperty(t)&&this.register(t,e.scope,e[t])},register:function(e,t,n,r){e in OpenLayers.Events&&!this.extensions[e]&&(this.extensions[e]=new OpenLayers.Events[e](this));if(null!=n){null==t&&(t=this.object);var i=this.listeners[e];if(!i){i=[];this.listeners[e]=i;this.extensionCount[e]=0}var a={obj:t,func:n};if(r){i.splice(this.extensionCount[e],0,a);"object"==typeof r&&r.extension&&this.extensionCount[e]++}else i.push(a)}},registerPriority:function(e,t,n){this.register(e,t,n,!0)},un:function(e){for(var t in e)"scope"!=t&&e.hasOwnProperty(t)&&this.unregister(t,e.scope,e[t])},unregister:function(e,t,n){null==t&&(t=this.object);var r=this.listeners[e];if(null!=r)for(var i=0,a=r.length;a>i;i++)if(r[i].obj==t&&r[i].func==n){r.splice(i,1);break}},remove:function(e){null!=this.listeners[e]&&(this.listeners[e]=[])},triggerEvent:function(e,t){var n=this.listeners[e];if(!n||0==n.length)return void 0;null==t&&(t={});t.object=this.object;t.element=this.element;t.type||(t.type=e);n=n.slice();for(var r,i=0,a=n.length;a>i;i++){var s=n[i];r=s.func.apply(s.obj,[t]);if(void 0!=r&&0==r)break}this.fallThrough||OpenLayers.Event.stop(t,!0);return r},handleBrowserEvent:function(e){var t=e.type,n=this.listeners[t];if(n&&0!=n.length){var r=e.touches;if(r&&r[0]){for(var i,a=0,s=0,o=r.length,l=0;o>l;++l){i=this.getTouchClientXY(r[l]);a+=i.clientX;s+=i.clientY}e.clientX=a/o;e.clientY=s/o}this.includeXY&&(e.xy=this.getMousePosition(e));this.triggerEvent(t,e)}},getTouchClientXY:function(e){var t=window.olMockWin||window,n=t.pageXOffset,r=t.pageYOffset,i=e.clientX,a=e.clientY;if(0===e.pageY&&Math.floor(a)>Math.floor(e.pageY)||0===e.pageX&&Math.floor(i)>Math.floor(e.pageX)){i-=n;a-=r}else if(a<e.pageY-r||i<e.pageX-n){i=e.pageX-n;a=e.pageY-r}e.olClientX=i;e.olClientY=a;return{clientX:i,clientY:a}},clearMouseCache:function(){this.element.scrolls=null;this.element.lefttop=null;this.element.offsets=null},getMousePosition:function(e){if(this.includeXY){if(!this.element.hasScrollEvent){OpenLayers.Event.observe(window,"scroll",this.clearMouseListener);

this.element.hasScrollEvent=!0}}else this.clearMouseCache();if(!this.element.scrolls){var t=OpenLayers.Util.getViewportElement();this.element.scrolls=[window.pageXOffset||t.scrollLeft,window.pageYOffset||t.scrollTop]}this.element.lefttop||(this.element.lefttop=[document.documentElement.clientLeft||0,document.documentElement.clientTop||0]);this.element.offsets||(this.element.offsets=OpenLayers.Util.pagePosition(this.element));return new OpenLayers.Pixel(e.clientX+this.element.scrolls[0]-this.element.offsets[0]-this.element.lefttop[0],e.clientY+this.element.scrolls[1]-this.element.offsets[1]-this.element.lefttop[1])},addMsTouchListener:function(e,t,n){function r(e){n(OpenLayers.Util.applyDefaults({stopPropagation:function(){for(var e=i.length-1;e>=0;--e)i[e].stopPropagation()},preventDefault:function(){for(var e=i.length-1;e>=0;--e)i[e].preventDefault()},type:t},e))}var i=(this.eventHandler,this._msTouches);switch(t){case"touchstart":return this.addMsTouchListenerStart(e,t,r);case"touchend":return this.addMsTouchListenerEnd(e,t,r);case"touchmove":return this.addMsTouchListenerMove(e,t,r);default:throw"Unknown touch event type"}},addMsTouchListenerStart:function(e,t,n){var r=this._msTouches,i=function(e){for(var t=!1,i=0,a=r.length;a>i;++i)if(r[i].pointerId==e.pointerId){t=!0;break}t||r.push(e);e.touches=r.slice();n(e)};OpenLayers.Event.observe(e,"MSPointerDown",i);var a=function(e){for(var t=0,n=r.length;n>t;++t)if(r[t].pointerId==e.pointerId){r.splice(t,1);break}};OpenLayers.Event.observe(e,"MSPointerUp",a)},addMsTouchListenerMove:function(e,t,n){var r=this._msTouches,i=function(e){if(!(e.pointerType==e.MSPOINTER_TYPE_MOUSE&&0==e.buttons||1==r.length&&r[0].pageX==e.pageX&&r[0].pageY==e.pageY)){for(var t=0,i=r.length;i>t;++t)if(r[t].pointerId==e.pointerId){r[t]=e;break}e.touches=r.slice();n(e)}};OpenLayers.Event.observe(e,"MSPointerMove",i)},addMsTouchListenerEnd:function(e,t,n){var r=this._msTouches,i=function(e){for(var t=0,i=r.length;i>t;++t)if(r[t].pointerId==e.pointerId){r.splice(t,1);break}e.touches=r.slice();n(e)};OpenLayers.Event.observe(e,"MSPointerUp",i)},CLASS_NAME:"OpenLayers.Events"});OpenLayers.Animation=function(e){function t(e,t,n){t=t>0?t:Number.POSITIVE_INFINITY;var r=++s,i=+new Date;o[r]=function(){if(o[r]&&+new Date-i<=t){e();o[r]&&a(o[r],n)}else delete o[r]};a(o[r],n);return r}function n(e){delete o[e]}var r=OpenLayers.Util.vendorPrefix.js(e,"requestAnimationFrame"),i=!!r,a=function(){var t=e[r]||function(t,n){e.setTimeout(t,16)};return function(n,r){t.apply(e,[n,r])}}(),s=0,o={};return{isNative:i,requestFrame:a,start:t,stop:n}}(window);OpenLayers.Tween=OpenLayers.Class({easing:null,begin:null,finish:null,duration:null,callbacks:null,time:null,minFrameRate:null,startTime:null,animationId:null,playing:!1,initialize:function(e){this.easing=e?e:OpenLayers.Easing.Expo.easeOut},start:function(e,t,n,r){this.playing=!0;this.begin=e;this.finish=t;this.duration=n;this.callbacks=r.callbacks;this.minFrameRate=r.minFrameRate||30;this.time=0;this.startTime=(new Date).getTime();OpenLayers.Animation.stop(this.animationId);this.animationId=null;this.callbacks&&this.callbacks.start&&this.callbacks.start.call(this,this.begin);this.animationId=OpenLayers.Animation.start(OpenLayers.Function.bind(this.play,this))},stop:function(){if(this.playing){this.callbacks&&this.callbacks.done&&this.callbacks.done.call(this,this.finish);OpenLayers.Animation.stop(this.animationId);this.animationId=null;this.playing=!1}},play:function(){var e={};for(var t in this.begin){var n=this.begin[t],r=this.finish[t];if(null==n||null==r||isNaN(n)||isNaN(r))throw new TypeError("invalid value for Tween");var i=r-n;e[t]=this.easing.apply(this,[this.time,n,i,this.duration])}this.time++;this.callbacks&&this.callbacks.eachStep&&((new Date).getTime()-this.startTime)/this.time<=1e3/this.minFrameRate&&this.callbacks.eachStep.call(this,e);this.time>this.duration&&this.stop()},CLASS_NAME:"OpenLayers.Tween"});OpenLayers.Easing={CLASS_NAME:"OpenLayers.Easing"};OpenLayers.Easing.Linear={easeIn:function(e,t,n,r){return n*e/r+t},easeOut:function(e,t,n,r){return n*e/r+t},easeInOut:function(e,t,n,r){return n*e/r+t},CLASS_NAME:"OpenLayers.Easing.Linear"};OpenLayers.Easing.Expo={easeIn:function(e,t,n,r){return 0==e?t:n*Math.pow(2,10*(e/r-1))+t},easeOut:function(e,t,n,r){return e==r?t+n:n*(-Math.pow(2,-10*e/r)+1)+t},easeInOut:function(e,t,n,r){return 0==e?t:e==r?t+n:(e/=r/2)<1?n/2*Math.pow(2,10*(e-1))+t:n/2*(-Math.pow(2,-10*--e)+2)+t},CLASS_NAME:"OpenLayers.Easing.Expo"};OpenLayers.Easing.Quad={easeIn:function(e,t,n,r){return n*(e/=r)*e+t},easeOut:function(e,t,n,r){return-n*(e/=r)*(e-2)+t},easeInOut:function(e,t,n,r){return(e/=r/2)<1?n/2*e*e+t:-n/2*(--e*(e-2)-1)+t},CLASS_NAME:"OpenLayers.Easing.Quad"};OpenLayers.Projection=OpenLayers.Class({proj:null,projCode:null,titleRegEx:/\+title=[^\+]*/,initialize:function(e,t){OpenLayers.Util.extend(this,t);this.projCode=e;"object"==typeof Proj4js&&(this.proj=new Proj4js.Proj(e))},getCode:function(){return this.proj?this.proj.srsCode:this.projCode},getUnits:function(){return this.proj?this.proj.units:null},toString:function(){return this.getCode()},equals:function(e){var t=e,n=!1;if(t){t instanceof OpenLayers.Projection||(t=new OpenLayers.Projection(t));if("object"==typeof Proj4js&&this.proj.defData&&t.proj.defData)n=this.proj.defData.replace(this.titleRegEx,"")==t.proj.defData.replace(this.titleRegEx,"");else if(t.getCode){var r=this.getCode(),i=t.getCode();n=r==i||!!OpenLayers.Projection.transforms[r]&&OpenLayers.Projection.transforms[r][i]===OpenLayers.Projection.nullTransform}}return n},destroy:function(){delete this.proj;delete this.projCode},CLASS_NAME:"OpenLayers.Projection"});OpenLayers.Projection.transforms={};OpenLayers.Projection.defaults={"EPSG:4326":{units:"degrees",maxExtent:[-180,-90,180,90],yx:!0},"CRS:84":{units:"degrees",maxExtent:[-180,-90,180,90]},"EPSG:900913":{units:"m",maxExtent:[-20037508.34,-20037508.34,20037508.34,20037508.34]}};OpenLayers.Projection.addTransform=function(e,t,n){if(n===OpenLayers.Projection.nullTransform){var r=OpenLayers.Projection.defaults[e];r&&!OpenLayers.Projection.defaults[t]&&(OpenLayers.Projection.defaults[t]=r)}OpenLayers.Projection.transforms[e]||(OpenLayers.Projection.transforms[e]={});OpenLayers.Projection.transforms[e][t]=n};OpenLayers.Projection.transform=function(e,t,n){if(t&&n){t instanceof OpenLayers.Projection||(t=new OpenLayers.Projection(t));n instanceof OpenLayers.Projection||(n=new OpenLayers.Projection(n));if(t.proj&&n.proj)e=Proj4js.transform(t.proj,n.proj,e);else{var r=t.getCode(),i=n.getCode(),a=OpenLayers.Projection.transforms;a[r]&&a[r][i]&&a[r][i](e)}}return e};OpenLayers.Projection.nullTransform=function(e){return e};!function(){function e(e){e.x=180*e.x/i;e.y=180/Math.PI*(2*Math.atan(Math.exp(e.y/i*Math.PI))-Math.PI/2);return e}function t(e){e.x=e.x*i/180;var t=Math.log(Math.tan((90+e.y)*Math.PI/360))/Math.PI*i;e.y=Math.max(-20037508.34,Math.min(t,20037508.34));return e}function n(n,r){var i,a,s,o,l,c=OpenLayers.Projection.addTransform,u=OpenLayers.Projection.nullTransform;for(i=0,a=r.length;a>i;++i){s=r[i];c(n,s,t);c(s,n,e);for(l=i+1;a>l;++l){o=r[l];c(s,o,u);c(o,s,u)}}}var r,i=20037508.34,a=["EPSG:900913","EPSG:3857","EPSG:102113","EPSG:102100"],s=["CRS:84","urn:ogc:def:crs:EPSG:6.6:4326","EPSG:4326"];for(r=a.length-1;r>=0;--r)n(a[r],s);for(r=s.length-1;r>=0;--r)n(s[r],a)}();OpenLayers.Map=OpenLayers.Class({Z_INDEX_BASE:{BaseLayer:100,Overlay:325,Feature:725,Popup:750,Control:1e3},id:null,fractionalZoom:!1,events:null,allOverlays:!1,div:null,dragging:!1,size:null,viewPortDiv:null,layerContainerOrigin:null,layerContainerDiv:null,layers:null,controls:null,popups:null,baseLayer:null,center:null,resolution:null,zoom:0,panRatio:1.5,options:null,tileSize:null,projection:"EPSG:4326",units:null,resolutions:null,maxResolution:null,minResolution:null,maxScale:null,minScale:null,maxExtent:null,minExtent:null,restrictedExtent:null,numZoomLevels:16,theme:null,displayProjection:null,fallThrough:!1,autoUpdateSize:!0,eventListeners:null,panTween:null,panMethod:OpenLayers.Easing.Expo.easeOut,panDuration:50,zoomTween:null,zoomMethod:OpenLayers.Easing.Quad.easeOut,zoomDuration:20,paddingForPopups:null,layerContainerOriginPx:null,minPx:null,maxPx:null,initialize:function(e,t){if(1===arguments.length&&"object"==typeof e){t=e;e=t&&t.div}this.tileSize=new OpenLayers.Size(OpenLayers.Map.TILE_WIDTH,OpenLayers.Map.TILE_HEIGHT);this.paddingForPopups=new OpenLayers.Bounds(15,15,15,15);this.theme=OpenLayers._getScriptLocation()+"theme/default/style.css";this.options=OpenLayers.Util.extend({},t);OpenLayers.Util.extend(this,t);var n=this.projection instanceof OpenLayers.Projection?this.projection.projCode:this.projection;OpenLayers.Util.applyDefaults(this,OpenLayers.Projection.defaults[n]);!this.maxExtent||this.maxExtent instanceof OpenLayers.Bounds||(this.maxExtent=new OpenLayers.Bounds(this.maxExtent));!this.minExtent||this.minExtent instanceof OpenLayers.Bounds||(this.minExtent=new OpenLayers.Bounds(this.minExtent));!this.restrictedExtent||this.restrictedExtent instanceof OpenLayers.Bounds||(this.restrictedExtent=new OpenLayers.Bounds(this.restrictedExtent));!this.center||this.center instanceof OpenLayers.LonLat||(this.center=new OpenLayers.LonLat(this.center));this.layers=[];this.id=OpenLayers.Util.createUniqueID("OpenLayers.Map_");this.div=OpenLayers.Util.getElement(e);if(!this.div){this.div=document.createElement("div");this.div.style.height="1px";this.div.style.width="1px"}OpenLayers.Element.addClass(this.div,"olMap");var r=this.id+"_OpenLayers_ViewPort";this.viewPortDiv=OpenLayers.Util.createDiv(r,null,null,null,"relative",null,"hidden");this.viewPortDiv.style.width="100%";this.viewPortDiv.style.height="100%";this.viewPortDiv.className="olMapViewport";this.div.appendChild(this.viewPortDiv);this.events=new OpenLayers.Events(this,this.viewPortDiv,null,this.fallThrough,{includeXY:!0});if(OpenLayers.TileManager&&null!==this.tileManager){this.tileManager instanceof OpenLayers.TileManager||(this.tileManager=new OpenLayers.TileManager(this.tileManager));this.tileManager.addMap(this)}r=this.id+"_OpenLayers_Container";this.layerContainerDiv=OpenLayers.Util.createDiv(r);this.layerContainerDiv.style.zIndex=this.Z_INDEX_BASE.Popup-1;this.layerContainerOriginPx={x:0,y:0};this.applyTransform();this.viewPortDiv.appendChild(this.layerContainerDiv);this.updateSize();this.eventListeners instanceof Object&&this.events.on(this.eventListeners);if(this.autoUpdateSize===!0){this.updateSizeDestroy=OpenLayers.Function.bind(this.updateSize,this);OpenLayers.Event.observe(window,"resize",this.updateSizeDestroy)}if(this.theme){for(var i=!0,a=document.getElementsByTagName("link"),s=0,o=a.length;o>s;++s)if(OpenLayers.Util.isEquivalentUrl(a.item(s).href,this.theme)){i=!1;break}if(i){var l=document.createElement("link");l.setAttribute("rel","stylesheet");l.setAttribute("type","text/css");l.setAttribute("href",this.theme);document.getElementsByTagName("head")[0].appendChild(l)}}if(null==this.controls){this.controls=[];if(null!=OpenLayers.Control){OpenLayers.Control.Navigation?this.controls.push(new OpenLayers.Control.Navigation):OpenLayers.Control.TouchNavigation&&this.controls.push(new OpenLayers.Control.TouchNavigation);OpenLayers.Control.Zoom?this.controls.push(new OpenLayers.Control.Zoom):OpenLayers.Control.PanZoom&&this.controls.push(new OpenLayers.Control.PanZoom);OpenLayers.Control.ArgParser&&this.controls.push(new OpenLayers.Control.ArgParser);OpenLayers.Control.Attribution&&this.controls.push(new OpenLayers.Control.Attribution)}}for(var s=0,o=this.controls.length;o>s;s++)this.addControlToMap(this.controls[s]);this.popups=[];this.unloadDestroy=OpenLayers.Function.bind(this.destroy,this);OpenLayers.Event.observe(window,"unload",this.unloadDestroy);if(t&&t.layers){delete this.center;delete this.zoom;this.addLayers(t.layers);t.center&&!this.getCenter()&&this.setCenter(t.center,t.zoom)}this.panMethod&&(this.panTween=new OpenLayers.Tween(this.panMethod));this.zoomMethod&&this.applyTransform.transform&&(this.zoomTween=new OpenLayers.Tween(this.zoomMethod))},getViewport:function(){return this.viewPortDiv},render:function(e){this.div=OpenLayers.Util.getElement(e);OpenLayers.Element.addClass(this.div,"olMap");this.viewPortDiv.parentNode.removeChild(this.viewPortDiv);this.div.appendChild(this.viewPortDiv);this.updateSize()},unloadDestroy:null,updateSizeDestroy:null,destroy:function(){if(!this.unloadDestroy)return!1;if(this.panTween){this.panTween.stop();this.panTween=null}if(this.zoomTween){this.zoomTween.stop();this.zoomTween=null}OpenLayers.Event.stopObserving(window,"unload",this.unloadDestroy);this.unloadDestroy=null;this.updateSizeDestroy&&OpenLayers.Event.stopObserving(window,"resize",this.updateSizeDestroy);this.paddingForPopups=null;if(null!=this.controls){for(var e=this.controls.length-1;e>=0;--e)this.controls[e].destroy();this.controls=null}if(null!=this.layers){for(var e=this.layers.length-1;e>=0;--e)this.layers[e].destroy(!1);this.layers=null}this.viewPortDiv&&this.viewPortDiv.parentNode&&this.viewPortDiv.parentNode.removeChild(this.viewPortDiv);this.viewPortDiv=null;if(this.tileManager){this.tileManager.removeMap(this);this.tileManager=null}if(this.eventListeners){this.events.un(this.eventListeners);this.eventListeners=null}this.events.destroy();this.events=null;this.options=null},setOptions:function(e){var t=this.minPx&&e.restrictedExtent!=this.restrictedExtent;OpenLayers.Util.extend(this,e);t&&this.moveTo(this.getCachedCenter(),this.zoom,{forceZoomChange:!0})},getTileSize:function(){return this.tileSize},getBy:function(e,t,n){var r="function"==typeof n.test,i=OpenLayers.Array.filter(this[e],function(e){return e[t]==n||r&&n.test(e[t])});return i},getLayersBy:function(e,t){return this.getBy("layers",e,t)},getLayersByName:function(e){return this.getLayersBy("name",e)},getLayersByClass:function(e){return this.getLayersBy("CLASS_NAME",e)},getControlsBy:function(e,t){return this.getBy("controls",e,t)},getControlsByClass:function(e){return this.getControlsBy("CLASS_NAME",e)},getLayer:function(e){for(var t=null,n=0,r=this.layers.length;r>n;n++){var i=this.layers[n];if(i.id==e){t=i;break}}return t},setLayerZIndex:function(e,t){e.setZIndex(this.Z_INDEX_BASE[e.isBaseLayer?"BaseLayer":"Overlay"]+5*t)},resetLayersZIndex:function(){for(var e=0,t=this.layers.length;t>e;e++){var n=this.layers[e];this.setLayerZIndex(n,e)}},addLayer:function(e){for(var t=0,n=this.layers.length;n>t;t++)if(this.layers[t]==e)return!1;if(this.events.triggerEvent("preaddlayer",{layer:e})===!1)return!1;this.allOverlays&&(e.isBaseLayer=!1);e.div.className="olLayerDiv";e.div.style.overflow="";this.setLayerZIndex(e,this.layers.length);e.isFixed?this.viewPortDiv.appendChild(e.div):this.layerContainerDiv.appendChild(e.div);this.layers.push(e);e.setMap(this);e.isBaseLayer||this.allOverlays&&!this.baseLayer?null==this.baseLayer?this.setBaseLayer(e):e.setVisibility(!1):e.redraw();this.events.triggerEvent("addlayer",{layer:e});e.events.triggerEvent("added",{map:this,layer:e});e.afterAdd();return!0},addLayers:function(e){for(var t=0,n=e.length;n>t;t++)this.addLayer(e[t])},removeLayer:function(e,t){if(this.events.triggerEvent("preremovelayer",{layer:e})!==!1){null==t&&(t=!0);e.isFixed?this.viewPortDiv.removeChild(e.div):this.layerContainerDiv.removeChild(e.div);OpenLayers.Util.removeItem(this.layers,e);e.removeMap(this);e.map=null;if(this.baseLayer==e){this.baseLayer=null;if(t)for(var n=0,r=this.layers.length;r>n;n++){var i=this.layers[n];if(i.isBaseLayer||this.allOverlays){this.setBaseLayer(i);break}}}this.resetLayersZIndex();this.events.triggerEvent("removelayer",{layer:e});e.events.triggerEvent("removed",{map:this,layer:e})}},getNumLayers:function(){return this.layers.length},getLayerIndex:function(e){return OpenLayers.Util.indexOf(this.layers,e)},setLayerIndex:function(e,t){var n=this.getLayerIndex(e);0>t?t=0:t>this.layers.length&&(t=this.layers.length);if(n!=t){this.layers.splice(n,1);this.layers.splice(t,0,e);for(var r=0,i=this.layers.length;i>r;r++)this.setLayerZIndex(this.layers[r],r);this.events.triggerEvent("changelayer",{layer:e,property:"order"});this.allOverlays&&(0===t?this.setBaseLayer(e):this.baseLayer!==this.layers[0]&&this.setBaseLayer(this.layers[0]))}},raiseLayer:function(e,t){var n=this.getLayerIndex(e)+t;this.setLayerIndex(e,n)},setBaseLayer:function(e){if(e!=this.baseLayer&&-1!=OpenLayers.Util.indexOf(this.layers,e)){var t=this.getCachedCenter(),n=OpenLayers.Util.getResolutionFromScale(this.getScale(),e.units);null==this.baseLayer||this.allOverlays||this.baseLayer.setVisibility(!1);this.baseLayer=e;if(!this.allOverlays||this.baseLayer.visibility){this.baseLayer.setVisibility(!0);this.baseLayer.inRange===!1&&this.baseLayer.redraw()}if(null!=t){var r=this.getZoomForResolution(n||this.resolution,!0);this.setCenter(t,r,!1,!0)}this.events.triggerEvent("changebaselayer",{layer:this.baseLayer})}},addControl:function(e,t){this.controls.push(e);this.addControlToMap(e,t)},addControls:function(e,t){for(var n=1===arguments.length?[]:t,r=0,i=e.length;i>r;r++){var a=e[r],s=n[r]?n[r]:null;this.addControl(a,s)}},addControlToMap:function(e,t){e.outsideViewport=null!=e.div;this.displayProjection&&!e.displayProjection&&(e.displayProjection=this.displayProjection);e.setMap(this);var n=e.draw(t);if(n&&!e.outsideViewport){n.style.zIndex=this.Z_INDEX_BASE.Control+this.controls.length;this.viewPortDiv.appendChild(n)}e.autoActivate&&e.activate()},getControl:function(e){for(var t=null,n=0,r=this.controls.length;r>n;n++){var i=this.controls[n];if(i.id==e){t=i;break}}return t},removeControl:function(e){if(e&&e==this.getControl(e.id)){e.div&&e.div.parentNode==this.viewPortDiv&&this.viewPortDiv.removeChild(e.div);OpenLayers.Util.removeItem(this.controls,e)}},addPopup:function(e,t){if(t)for(var n=this.popups.length-1;n>=0;--n)this.removePopup(this.popups[n]);e.map=this;this.popups.push(e);var r=e.draw();if(r){r.style.zIndex=this.Z_INDEX_BASE.Popup+this.popups.length;this.layerContainerDiv.appendChild(r)}},removePopup:function(e){OpenLayers.Util.removeItem(this.popups,e);if(e.div)try{this.layerContainerDiv.removeChild(e.div)}catch(t){}e.map=null},getSize:function(){var e=null;null!=this.size&&(e=this.size.clone());return e},updateSize:function(){var e=this.getCurrentSize();if(e&&!isNaN(e.h)&&!isNaN(e.w)){this.events.clearMouseCache();var t=this.getSize();null==t&&(this.size=t=e);if(!e.equals(t)){this.size=e;for(var n=0,r=this.layers.length;r>n;n++)this.layers[n].onMapResize();var i=this.getCachedCenter();if(null!=this.baseLayer&&null!=i){var a=this.getZoom();this.zoom=null;this.setCenter(i,a)}}}this.events.triggerEvent("updatesize")},getCurrentSize:function(){var e=new OpenLayers.Size(this.div.clientWidth,this.div.clientHeight);if(0==e.w&&0==e.h||isNaN(e.w)&&isNaN(e.h)){e.w=this.div.offsetWidth;e.h=this.div.offsetHeight}if(0==e.w&&0==e.h||isNaN(e.w)&&isNaN(e.h)){e.w=parseInt(this.div.style.width);e.h=parseInt(this.div.style.height)}return e},calculateBounds:function(e,t){var n=null;null==e&&(e=this.getCachedCenter());null==t&&(t=this.getResolution());if(null!=e&&null!=t){var r=this.size.w*t/2,i=this.size.h*t/2;n=new OpenLayers.Bounds(e.lon-r,e.lat-i,e.lon+r,e.lat+i)}return n},getCenter:function(){var e=null,t=this.getCachedCenter();t&&(e=t.clone());return e},getCachedCenter:function(){!this.center&&this.size&&(this.center=this.getLonLatFromViewPortPx({x:this.size.w/2,y:this.size.h/2}));return this.center},getZoom:function(){return this.zoom},pan:function(e,t,n){n=OpenLayers.Util.applyDefaults(n,{animate:!0,dragging:!1});if(n.dragging)(0!=e||0!=t)&&this.moveByPx(e,t);else{var r=this.getViewPortPxFromLonLat(this.getCachedCenter()),i=r.add(e,t);if(this.dragging||!i.equals(r)){var a=this.getLonLatFromViewPortPx(i);if(n.animate)this.panTo(a);else{this.moveTo(a);if(this.dragging){this.dragging=!1;this.events.triggerEvent("moveend")}}}}},panTo:function(e){if(this.panTween&&this.getExtent().scale(this.panRatio).containsLonLat(e)){var t=this.getCachedCenter();if(e.equals(t))return;var n=this.getPixelFromLonLat(t),r=this.getPixelFromLonLat(e),i={x:r.x-n.x,y:r.y-n.y},a={x:0,y:0};this.panTween.start({x:0,y:0},i,this.panDuration,{callbacks:{eachStep:OpenLayers.Function.bind(function(e){var t=e.x-a.x,n=e.y-a.y;this.moveByPx(t,n);a.x=Math.round(e.x);a.y=Math.round(e.y)},this),done:OpenLayers.Function.bind(function(t){this.moveTo(e);this.dragging=!1;this.events.triggerEvent("moveend")},this)}})}else this.setCenter(e)},setCenter:function(e,t,n,r){this.panTween&&this.panTween.stop();this.zoomTween&&this.zoomTween.stop();this.moveTo(e,t,{dragging:n,forceZoomChange:r})},moveByPx:function(e,t){var n=this.size.w/2,r=this.size.h/2,i=n+e,a=r+t,s=this.baseLayer.wrapDateLine,o=0,l=0;if(this.restrictedExtent){o=n;l=r;s=!1}e=s||i<=this.maxPx.x-o&&i>=this.minPx.x+o?Math.round(e):0;t=a<=this.maxPx.y-l&&a>=this.minPx.y+l?Math.round(t):0;if(e||t){if(!this.dragging){this.dragging=!0;this.events.triggerEvent("movestart")}this.center=null;if(e){this.layerContainerOriginPx.x-=e;this.minPx.x-=e;this.maxPx.x-=e}if(t){this.layerContainerOriginPx.y-=t;this.minPx.y-=t;this.maxPx.y-=t}this.applyTransform();var c,u,h;for(u=0,h=this.layers.length;h>u;++u){c=this.layers[u];if(c.visibility&&(c===this.baseLayer||c.inRange)){c.moveByPx(e,t);c.events.triggerEvent("move")}}this.events.triggerEvent("move")}},adjustZoom:function(e){if(this.baseLayer&&this.baseLayer.wrapDateLine){var t=this.baseLayer.resolutions,n=this.getMaxExtent().getWidth()/this.size.w;if(this.getResolutionForZoom(e)>n)if(this.fractionalZoom)e=this.getZoomForResolution(n);else for(var r=0|e,i=t.length;i>r;++r)if(t[r]<=n){e=r;break}}return e},getMinZoom:function(){return this.adjustZoom(0)},moveTo:function(e,t,n){null==e||e instanceof OpenLayers.LonLat||(e=new OpenLayers.LonLat(e));n||(n={});if(null!=t){t=parseFloat(t);this.fractionalZoom||(t=Math.round(t))}var r=t;t=this.adjustZoom(t);t!==r&&(e=this.getCenter());var i=n.dragging||this.dragging,a=n.forceZoomChange;if(!this.getCachedCenter()&&!this.isValidLonLat(e)){e=this.maxExtent.getCenterLonLat();this.center=e.clone()}if(null!=this.restrictedExtent){null==e&&(e=this.center);null==t&&(t=this.getZoom());var s=this.getResolutionForZoom(t),o=this.calculateBounds(e,s);if(!this.restrictedExtent.containsBounds(o)){var l=this.restrictedExtent.getCenterLonLat();o.getWidth()>this.restrictedExtent.getWidth()?e=new OpenLayers.LonLat(l.lon,e.lat):o.left<this.restrictedExtent.left?e=e.add(this.restrictedExtent.left-o.left,0):o.right>this.restrictedExtent.right&&(e=e.add(this.restrictedExtent.right-o.right,0));o.getHeight()>this.restrictedExtent.getHeight()?e=new OpenLayers.LonLat(e.lon,l.lat):o.bottom<this.restrictedExtent.bottom?e=e.add(0,this.restrictedExtent.bottom-o.bottom):o.top>this.restrictedExtent.top&&(e=e.add(0,this.restrictedExtent.top-o.top))}}var c=a||this.isValidZoomLevel(t)&&t!=this.getZoom(),u=this.isValidLonLat(e)&&!e.equals(this.center);if(c||u||i){i||this.events.triggerEvent("movestart",{zoomChanged:c});if(u){!c&&this.center&&this.centerLayerContainer(e);this.center=e.clone()}var h=c?this.getResolutionForZoom(t):this.getResolution();if(c||null==this.layerContainerOrigin){this.layerContainerOrigin=this.getCachedCenter();this.layerContainerOriginPx.x=0;this.layerContainerOriginPx.y=0;this.applyTransform();var p=this.getMaxExtent({restricted:!0}),d=p.getCenterLonLat(),f=this.center.lon-d.lon,m=d.lat-this.center.lat,y=Math.round(p.getWidth()/h),g=Math.round(p.getHeight()/h);this.minPx={x:(this.size.w-y)/2-f/h,y:(this.size.h-g)/2-m/h};this.maxPx={x:this.minPx.x+Math.round(p.getWidth()/h),y:this.minPx.y+Math.round(p.getHeight()/h)}}if(c){this.zoom=t;this.resolution=h}var v=this.getExtent();if(this.baseLayer.visibility){this.baseLayer.moveTo(v,c,n.dragging);n.dragging||this.baseLayer.events.triggerEvent("moveend",{zoomChanged:c})}v=this.baseLayer.getExtent();for(var C=this.layers.length-1;C>=0;--C){var L=this.layers[C];if(L!==this.baseLayer&&!L.isBaseLayer){var T=L.calculateInRange();if(L.inRange!=T){L.inRange=T;T||L.display(!1);this.events.triggerEvent("changelayer",{layer:L,property:"visibility"})}if(T&&L.visibility){L.moveTo(v,c,n.dragging);n.dragging||L.events.triggerEvent("moveend",{zoomChanged:c})}}}this.events.triggerEvent("move");i||this.events.triggerEvent("moveend");if(c){for(var C=0,w=this.popups.length;w>C;C++)this.popups[C].updatePosition();this.events.triggerEvent("zoomend")}}},centerLayerContainer:function(e){var t=this.getViewPortPxFromLonLat(this.layerContainerOrigin),n=this.getViewPortPxFromLonLat(e);if(null!=t&&null!=n){var r=this.layerContainerOriginPx.x,i=this.layerContainerOriginPx.y,a=Math.round(t.x-n.x),s=Math.round(t.y-n.y);this.applyTransform(this.layerContainerOriginPx.x=a,this.layerContainerOriginPx.y=s);var o=r-a,l=i-s;this.minPx.x-=o;this.maxPx.x-=o;this.minPx.y-=l;this.maxPx.y-=l}},isValidZoomLevel:function(e){return null!=e&&e>=0&&e<this.getNumZoomLevels()},isValidLonLat:function(e){var t=!1;if(null!=e){var n=this.getMaxExtent(),r=this.baseLayer.wrapDateLine&&n;t=n.containsLonLat(e,{worldBounds:r})}return t},getProjection:function(){var e=this.getProjectionObject();return e?e.getCode():null},getProjectionObject:function(){var e=null;null!=this.baseLayer&&(e=this.baseLayer.projection);return e},getMaxResolution:function(){var e=null;null!=this.baseLayer&&(e=this.baseLayer.maxResolution);return e},getMaxExtent:function(e){var t=null;e&&e.restricted&&this.restrictedExtent?t=this.restrictedExtent:null!=this.baseLayer&&(t=this.baseLayer.maxExtent);return t},getNumZoomLevels:function(){var e=null;null!=this.baseLayer&&(e=this.baseLayer.numZoomLevels);return e},getExtent:function(){var e=null;null!=this.baseLayer&&(e=this.baseLayer.getExtent());return e},getResolution:function(){var e=null;null!=this.baseLayer?e=this.baseLayer.getResolution():this.allOverlays===!0&&this.layers.length>0&&(e=this.layers[0].getResolution());return e},getUnits:function(){var e=null;null!=this.baseLayer&&(e=this.baseLayer.units);return e},getScale:function(){var e=null;if(null!=this.baseLayer){var t=this.getResolution(),n=this.baseLayer.units;e=OpenLayers.Util.getScaleFromResolution(t,n)}return e},getZoomForExtent:function(e,t){var n=null;null!=this.baseLayer&&(n=this.baseLayer.getZoomForExtent(e,t));return n},getResolutionForZoom:function(e){var t=null;this.baseLayer&&(t=this.baseLayer.getResolutionForZoom(e));return t},getZoomForResolution:function(e,t){var n=null;null!=this.baseLayer&&(n=this.baseLayer.getZoomForResolution(e,t));return n},zoomTo:function(e,t){var n=this;if(n.isValidZoomLevel(e)){n.baseLayer.wrapDateLine&&(e=n.adjustZoom(e));if(n.zoomTween){var r=n.getResolution(),i=n.getResolutionForZoom(e),a={scale:1},s={scale:r/i};if(n.zoomTween.playing&&n.zoomTween.duration<3*n.zoomDuration)n.zoomTween.finish={scale:n.zoomTween.finish.scale*s.scale};else{if(!t){var o=n.getSize();t={x:o.w/2,y:o.h/2}}n.zoomTween.start(a,s,n.zoomDuration,{minFrameRate:50,callbacks:{eachStep:function(e){var r=n.layerContainerOriginPx,i=e.scale,a=(i-1)*(r.x-t.x)|0,s=(i-1)*(r.y-t.y)|0;n.applyTransform(r.x+a,r.y+s,i)},done:function(e){n.applyTransform();var r=n.getResolution()/e.scale,i=n.getZoomForResolution(r,!0);n.moveTo(n.getZoomTargetCenter(t,r),i,!0)}}})}}else{var l=t?n.getZoomTargetCenter(t,n.getResolutionForZoom(e)):null;n.setCenter(l,e)}}},zoomIn:function(){this.zoomTo(this.getZoom()+1)},zoomOut:function(){this.zoomTo(this.getZoom()-1)},zoomToExtent:function(e,t){e instanceof OpenLayers.Bounds||(e=new OpenLayers.Bounds(e));var n=e.getCenterLonLat();if(this.baseLayer.wrapDateLine){var r=this.getMaxExtent();e=e.clone();for(;e.right<e.left;)e.right+=r.getWidth();n=e.getCenterLonLat().wrapDateLine(r)}this.setCenter(n,this.getZoomForExtent(e,t))},zoomToMaxExtent:function(e){var t=e?e.restricted:!0,n=this.getMaxExtent({restricted:t});this.zoomToExtent(n)},zoomToScale:function(e,t){var n=OpenLayers.Util.getResolutionFromScale(e,this.baseLayer.units),r=this.size.w*n/2,i=this.size.h*n/2,a=this.getCachedCenter(),s=new OpenLayers.Bounds(a.lon-r,a.lat-i,a.lon+r,a.lat+i);this.zoomToExtent(s,t)},getLonLatFromViewPortPx:function(e){var t=null;null!=this.baseLayer&&(t=this.baseLayer.getLonLatFromViewPortPx(e));return t},getViewPortPxFromLonLat:function(e){var t=null;null!=this.baseLayer&&(t=this.baseLayer.getViewPortPxFromLonLat(e));return t},getZoomTargetCenter:function(e,t){var n=null,r=this.getSize(),i=r.w/2-e.x,a=e.y-r.h/2,s=this.getLonLatFromPixel(e);s&&(n=new OpenLayers.LonLat(s.lon+i*t,s.lat+a*t));return n},getLonLatFromPixel:function(e){return this.getLonLatFromViewPortPx(e)},getPixelFromLonLat:function(e){var t=this.getViewPortPxFromLonLat(e);t.x=Math.round(t.x);t.y=Math.round(t.y);return t},getGeodesicPixelSize:function(e){var t=e?this.getLonLatFromPixel(e):this.getCachedCenter()||new OpenLayers.LonLat(0,0),n=this.getResolution(),r=t.add(-n/2,0),i=t.add(n/2,0),a=t.add(0,-n/2),s=t.add(0,n/2),o=new OpenLayers.Projection("EPSG:4326"),l=this.getProjectionObject()||o;if(!l.equals(o)){r.transform(l,o);i.transform(l,o);a.transform(l,o);s.transform(l,o)}return new OpenLayers.Size(OpenLayers.Util.distVincenty(r,i),OpenLayers.Util.distVincenty(a,s))},getViewPortPxFromLayerPx:function(e){var t=null;if(null!=e){var n=this.layerContainerOriginPx.x,r=this.layerContainerOriginPx.y;t=e.add(n,r)}return t},getLayerPxFromViewPortPx:function(e){var t=null;if(null!=e){var n=-this.layerContainerOriginPx.x,r=-this.layerContainerOriginPx.y;t=e.add(n,r);(isNaN(t.x)||isNaN(t.y))&&(t=null)}return t},getLonLatFromLayerPx:function(e){e=this.getViewPortPxFromLayerPx(e);return this.getLonLatFromViewPortPx(e)},getLayerPxFromLonLat:function(e){var t=this.getPixelFromLonLat(e);return this.getLayerPxFromViewPortPx(t)},applyTransform:function(e,t,n){n=n||1;var r=this.layerContainerOriginPx,i=1!==n;e=e||r.x;t=t||r.y;var a=this.layerContainerDiv.style,s=this.applyTransform.transform,o=this.applyTransform.template;if(void 0===s){s=OpenLayers.Util.vendorPrefix.style("transform");this.applyTransform.transform=s;if(s){var l=OpenLayers.Element.getStyle(this.viewPortDiv,OpenLayers.Util.vendorPrefix.css("transform"));if(!l||"none"!==l){o=["translate3d(",",0) ","scale3d(",",1)"];a[s]=[o[0],"0,0",o[1]].join("")}o&&~a[s].indexOf(o[0])||(o=["translate(",") ","scale(",")"]);this.applyTransform.template=o}}if(null===s||"translate3d("!==o[0]&&i!==!0){a.left=e+"px";a.top=t+"px";null!==s&&(a[s]="")}else{if(i===!0&&"translate("===o[0]){e-=r.x;t-=r.y;a.left=r.x+"px";a.top=r.y+"px"}a[s]=[o[0],e,"px,",t,"px",o[1],o[2],n,",",n,o[3]].join("")}},CLASS_NAME:"OpenLayers.Map"});OpenLayers.Map.TILE_WIDTH=256;OpenLayers.Map.TILE_HEIGHT=256;OpenLayers.Layer=OpenLayers.Class({id:null,name:null,div:null,opacity:1,alwaysInRange:null,RESOLUTION_PROPERTIES:["scales","resolutions","maxScale","minScale","maxResolution","minResolution","numZoomLevels","maxZoomLevel"],events:null,map:null,isBaseLayer:!1,alpha:!1,displayInLayerSwitcher:!0,visibility:!0,attribution:null,inRange:!1,imageSize:null,options:null,eventListeners:null,gutter:0,projection:null,units:null,scales:null,resolutions:null,maxExtent:null,minExtent:null,maxResolution:null,minResolution:null,numZoomLevels:null,minScale:null,maxScale:null,displayOutsideMaxExtent:!1,wrapDateLine:!1,metadata:null,initialize:function(e,t){this.metadata={};t=OpenLayers.Util.extend({},t);null!=this.alwaysInRange&&(t.alwaysInRange=this.alwaysInRange);this.addOptions(t);this.name=e;if(null==this.id){this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_");this.div=OpenLayers.Util.createDiv(this.id);this.div.style.width="100%";this.div.style.height="100%";this.div.dir="ltr";this.events=new OpenLayers.Events(this,this.div);this.eventListeners instanceof Object&&this.events.on(this.eventListeners)}},destroy:function(e){null==e&&(e=!0);null!=this.map&&this.map.removeLayer(this,e);this.projection=null;this.map=null;this.name=null;this.div=null;this.options=null;if(this.events){this.eventListeners&&this.events.un(this.eventListeners);this.events.destroy()}this.eventListeners=null;this.events=null;

},clone:function(e){null==e&&(e=new OpenLayers.Layer(this.name,this.getOptions()));OpenLayers.Util.applyDefaults(e,this);e.map=null;return e},getOptions:function(){var e={};for(var t in this.options)e[t]=this[t];return e},setName:function(e){if(e!=this.name){this.name=e;null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"name"})}},addOptions:function(e,t){null==this.options&&(this.options={});if(e){"string"==typeof e.projection&&(e.projection=new OpenLayers.Projection(e.projection));e.projection&&OpenLayers.Util.applyDefaults(e,OpenLayers.Projection.defaults[e.projection.getCode()]);!e.maxExtent||e.maxExtent instanceof OpenLayers.Bounds||(e.maxExtent=new OpenLayers.Bounds(e.maxExtent));!e.minExtent||e.minExtent instanceof OpenLayers.Bounds||(e.minExtent=new OpenLayers.Bounds(e.minExtent))}OpenLayers.Util.extend(this.options,e);OpenLayers.Util.extend(this,e);this.projection&&this.projection.getUnits()&&(this.units=this.projection.getUnits());if(this.map){var n=this.map.getResolution(),r=this.RESOLUTION_PROPERTIES.concat(["projection","units","minExtent","maxExtent"]);for(var i in e)if(e.hasOwnProperty(i)&&OpenLayers.Util.indexOf(r,i)>=0){this.initResolutions();if(t&&this.map.baseLayer===this){this.map.setCenter(this.map.getCenter(),this.map.getZoomForResolution(n),!1,!0);this.map.events.triggerEvent("changebaselayer",{layer:this})}break}}},onMapResize:function(){},redraw:function(){var e=!1;if(this.map){this.inRange=this.calculateInRange();var t=this.getExtent();if(t&&this.inRange&&this.visibility){var n=!0;this.moveTo(t,n,!1);this.events.triggerEvent("moveend",{zoomChanged:n});e=!0}}return e},moveTo:function(e,t,n){var r=this.visibility;this.isBaseLayer||(r=r&&this.inRange);this.display(r)},moveByPx:function(e,t){},setMap:function(e){if(null==this.map){this.map=e;this.maxExtent=this.maxExtent||this.map.maxExtent;this.minExtent=this.minExtent||this.map.minExtent;this.projection=this.projection||this.map.projection;"string"==typeof this.projection&&(this.projection=new OpenLayers.Projection(this.projection));this.units=this.projection.getUnits()||this.units||this.map.units;this.initResolutions();if(!this.isBaseLayer){this.inRange=this.calculateInRange();var t=this.visibility&&this.inRange;this.div.style.display=t?"":"none"}this.setTileSize()}},afterAdd:function(){},removeMap:function(e){},getImageSize:function(e){return this.imageSize||this.tileSize},setTileSize:function(e){var t=e?e:this.tileSize?this.tileSize:this.map.getTileSize();this.tileSize=t;this.gutter&&(this.imageSize=new OpenLayers.Size(t.w+2*this.gutter,t.h+2*this.gutter))},getVisibility:function(){return this.visibility},setVisibility:function(e){if(e!=this.visibility){this.visibility=e;this.display(e);this.redraw();null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"visibility"});this.events.triggerEvent("visibilitychanged")}},display:function(e){e!=("none"!=this.div.style.display)&&(this.div.style.display=e&&this.calculateInRange()?"block":"none")},calculateInRange:function(){var e=!1;if(this.alwaysInRange)e=!0;else if(this.map){var t=this.map.getResolution();e=t>=this.minResolution&&t<=this.maxResolution}return e},setIsBaseLayer:function(e){if(e!=this.isBaseLayer){this.isBaseLayer=e;null!=this.map&&this.map.events.triggerEvent("changebaselayer",{layer:this})}},initResolutions:function(){var e,t,n,r={},i=!0;for(e=0,t=this.RESOLUTION_PROPERTIES.length;t>e;e++){n=this.RESOLUTION_PROPERTIES[e];r[n]=this.options[n];i&&this.options[n]&&(i=!1)}null==this.options.alwaysInRange&&(this.alwaysInRange=i);null==r.resolutions&&(r.resolutions=this.resolutionsFromScales(r.scales));null==r.resolutions&&(r.resolutions=this.calculateResolutions(r));if(null==r.resolutions){for(e=0,t=this.RESOLUTION_PROPERTIES.length;t>e;e++){n=this.RESOLUTION_PROPERTIES[e];r[n]=null!=this.options[n]?this.options[n]:this.map[n]}null==r.resolutions&&(r.resolutions=this.resolutionsFromScales(r.scales));null==r.resolutions&&(r.resolutions=this.calculateResolutions(r))}var a;this.options.maxResolution&&"auto"!==this.options.maxResolution&&(a=this.options.maxResolution);this.options.minScale&&(a=OpenLayers.Util.getResolutionFromScale(this.options.minScale,this.units));var s;this.options.minResolution&&"auto"!==this.options.minResolution&&(s=this.options.minResolution);this.options.maxScale&&(s=OpenLayers.Util.getResolutionFromScale(this.options.maxScale,this.units));if(r.resolutions){r.resolutions.sort(function(e,t){return t-e});a||(a=r.resolutions[0]);if(!s){var o=r.resolutions.length-1;s=r.resolutions[o]}}this.resolutions=r.resolutions;if(this.resolutions){t=this.resolutions.length;this.scales=new Array(t);for(e=0;t>e;e++)this.scales[e]=OpenLayers.Util.getScaleFromResolution(this.resolutions[e],this.units);this.numZoomLevels=t}this.minResolution=s;s&&(this.maxScale=OpenLayers.Util.getScaleFromResolution(s,this.units));this.maxResolution=a;a&&(this.minScale=OpenLayers.Util.getScaleFromResolution(a,this.units))},resolutionsFromScales:function(e){if(null!=e){var t,n,r;r=e.length;t=new Array(r);for(n=0;r>n;n++)t[n]=OpenLayers.Util.getResolutionFromScale(e[n],this.units);return t}},calculateResolutions:function(e){var t,n,r,i=e.maxResolution;if(null!=e.minScale)i=OpenLayers.Util.getResolutionFromScale(e.minScale,this.units);else if("auto"==i&&null!=this.maxExtent){t=this.map.getSize();n=this.maxExtent.getWidth()/t.w;r=this.maxExtent.getHeight()/t.h;i=Math.max(n,r)}var a=e.minResolution;if(null!=e.maxScale)a=OpenLayers.Util.getResolutionFromScale(e.maxScale,this.units);else if("auto"==e.minResolution&&null!=this.minExtent){t=this.map.getSize();n=this.minExtent.getWidth()/t.w;r=this.minExtent.getHeight()/t.h;a=Math.max(n,r)}if("number"!=typeof i&&"number"!=typeof a&&null!=this.maxExtent){var s=this.map.getTileSize();i=Math.max(this.maxExtent.getWidth()/s.w,this.maxExtent.getHeight()/s.h)}var o=e.maxZoomLevel,l=e.numZoomLevels;if("number"==typeof a&&"number"==typeof i&&void 0===l){var c=i/a;l=Math.floor(Math.log(c)/Math.log(2))+1}else void 0===l&&null!=o&&(l=o+1);if(!("number"!=typeof l||0>=l||"number"!=typeof i&&"number"!=typeof a)){var u=new Array(l),h=2;"number"==typeof a&&"number"==typeof i&&(h=Math.pow(i/a,1/(l-1)));var p;if("number"==typeof i)for(p=0;l>p;p++)u[p]=i/Math.pow(h,p);else for(p=0;l>p;p++)u[l-1-p]=a*Math.pow(h,p);return u}},getResolution:function(){var e=this.map.getZoom();return this.getResolutionForZoom(e)},getExtent:function(){return this.map.calculateBounds()},getZoomForExtent:function(e,t){var n=this.map.getSize(),r=Math.max(e.getWidth()/n.w,e.getHeight()/n.h);return this.getZoomForResolution(r,t)},getDataExtent:function(){},getResolutionForZoom:function(e){e=Math.max(0,Math.min(e,this.resolutions.length-1));var t;if(this.map.fractionalZoom){var n=Math.floor(e),r=Math.ceil(e);t=this.resolutions[n]-(e-n)*(this.resolutions[n]-this.resolutions[r])}else t=this.resolutions[Math.round(e)];return t},getZoomForResolution:function(e,t){var n,r,i;if(this.map.fractionalZoom){var a,s=0,o=this.resolutions.length-1,l=this.resolutions[s],c=this.resolutions[o];for(r=0,i=this.resolutions.length;i>r;++r){a=this.resolutions[r];if(a>=e){l=a;s=r}if(e>=a){c=a;o=r;break}}var u=l-c;n=u>0?s+(l-e)/u:s}else{var h,p=Number.POSITIVE_INFINITY;for(r=0,i=this.resolutions.length;i>r;r++)if(t){h=Math.abs(this.resolutions[r]-e);if(h>p)break;p=h}else if(this.resolutions[r]<e)break;n=Math.max(0,r-1)}return n},getLonLatFromViewPortPx:function(e){var t=null,n=this.map;if(null!=e&&n.minPx){var r=n.getResolution(),i=n.getMaxExtent({restricted:!0}),a=(e.x-n.minPx.x)*r+i.left,s=(n.minPx.y-e.y)*r+i.top;t=new OpenLayers.LonLat(a,s);this.wrapDateLine&&(t=t.wrapDateLine(this.maxExtent))}return t},getViewPortPxFromLonLat:function(e,t){var n=null;if(null!=e){t=t||this.map.getResolution();var r=this.map.calculateBounds(null,t);n=new OpenLayers.Pixel(1/t*(e.lon-r.left),1/t*(r.top-e.lat))}return n},setOpacity:function(e){if(e!=this.opacity){this.opacity=e;for(var t=this.div.childNodes,n=0,r=t.length;r>n;++n){var i=t[n].firstChild||t[n],a=t[n].lastChild;a&&"iframe"===a.nodeName.toLowerCase()&&(i=a.parentNode);OpenLayers.Util.modifyDOMElement(i,null,null,null,null,null,null,e)}null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"opacity"})}},getZIndex:function(){return this.div.style.zIndex},setZIndex:function(e){this.div.style.zIndex=e},adjustBounds:function(e){if(this.gutter){var t=this.gutter*this.map.getResolution();e=new OpenLayers.Bounds(e.left-t,e.bottom-t,e.right+t,e.top+t)}if(this.wrapDateLine){var n={rightTolerance:this.getResolution(),leftTolerance:this.getResolution()};e=e.wrapDateLine(this.maxExtent,n)}return e},CLASS_NAME:"OpenLayers.Layer"});OpenLayers.Layer.HTTPRequest=OpenLayers.Class(OpenLayers.Layer,{URL_HASH_FACTOR:(Math.sqrt(5)-1)/2,url:null,params:null,reproject:!1,initialize:function(e,t,n,r){OpenLayers.Layer.prototype.initialize.apply(this,[e,r]);this.url=t;this.params||(this.params=OpenLayers.Util.extend({},n))},destroy:function(){this.url=null;this.params=null;OpenLayers.Layer.prototype.destroy.apply(this,arguments)},clone:function(e){null==e&&(e=new OpenLayers.Layer.HTTPRequest(this.name,this.url,this.params,this.getOptions()));e=OpenLayers.Layer.prototype.clone.apply(this,[e]);return e},setUrl:function(e){this.url=e},mergeNewParams:function(e){this.params=OpenLayers.Util.extend(this.params,e);var t=this.redraw();null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"params"});return t},redraw:function(e){return e?this.mergeNewParams({_olSalt:Math.random()}):OpenLayers.Layer.prototype.redraw.apply(this,[])},selectUrl:function(e,t){for(var n=1,r=0,i=e.length;i>r;r++){n*=e.charCodeAt(r)*this.URL_HASH_FACTOR;n-=Math.floor(n)}return t[Math.floor(n*t.length)]},getFullRequestString:function(e,t){var n=t||this.url,r=OpenLayers.Util.extend({},this.params);r=OpenLayers.Util.extend(r,e);var i=OpenLayers.Util.getParameterString(r);OpenLayers.Util.isArray(n)&&(n=this.selectUrl(i,n));var a=OpenLayers.Util.upperCaseObject(OpenLayers.Util.getParameters(n));for(var s in r)s.toUpperCase()in a&&delete r[s];i=OpenLayers.Util.getParameterString(r);return OpenLayers.Util.urlAppend(n,i)},CLASS_NAME:"OpenLayers.Layer.HTTPRequest"});OpenLayers.Tile=OpenLayers.Class({events:null,eventListeners:null,id:null,layer:null,url:null,bounds:null,size:null,position:null,isLoading:!1,initialize:function(e,t,n,r,i,a){this.layer=e;this.position=t.clone();this.setBounds(n);this.url=r;i&&(this.size=i.clone());this.id=OpenLayers.Util.createUniqueID("Tile_");OpenLayers.Util.extend(this,a);this.events=new OpenLayers.Events(this);this.eventListeners instanceof Object&&this.events.on(this.eventListeners)},unload:function(){if(this.isLoading){this.isLoading=!1;this.events.triggerEvent("unload")}},destroy:function(){this.layer=null;this.bounds=null;this.size=null;this.position=null;this.eventListeners&&this.events.un(this.eventListeners);this.events.destroy();this.eventListeners=null;this.events=null},draw:function(e){e||this.clear();var t=this.shouldDraw();t&&!e&&this.events.triggerEvent("beforedraw")===!1&&(t=null);return t},shouldDraw:function(){var e=!1,t=this.layer.maxExtent;if(t){var n=this.layer.map,r=n.baseLayer.wrapDateLine&&n.getMaxExtent();this.bounds.intersectsBounds(t,{inclusive:!1,worldBounds:r})&&(e=!0)}return e||this.layer.displayOutsideMaxExtent},setBounds:function(e){e=e.clone();if(this.layer.map.baseLayer.wrapDateLine){var t=this.layer.map.getMaxExtent(),n=this.layer.map.getResolution();e=e.wrapDateLine(t,{leftTolerance:n,rightTolerance:n})}this.bounds=e},moveTo:function(e,t,n){null==n&&(n=!0);this.setBounds(e);this.position=t.clone();n&&this.draw()},clear:function(e){},CLASS_NAME:"OpenLayers.Tile"});OpenLayers.Tile.Image=OpenLayers.Class(OpenLayers.Tile,{url:null,imgDiv:null,frame:null,imageReloadAttempts:null,layerAlphaHack:null,asyncRequestId:null,maxGetUrlLength:null,canvasContext:null,crossOriginKeyword:null,initialize:function(e,t,n,r,i,a){OpenLayers.Tile.prototype.initialize.apply(this,arguments);this.url=r;this.layerAlphaHack=this.layer.alpha&&OpenLayers.Util.alphaHack();if(null!=this.maxGetUrlLength||this.layer.gutter||this.layerAlphaHack){this.frame=document.createElement("div");this.frame.style.position="absolute";this.frame.style.overflow="hidden"}null!=this.maxGetUrlLength&&OpenLayers.Util.extend(this,OpenLayers.Tile.Image.IFrame)},destroy:function(){if(this.imgDiv){this.clear();this.imgDiv=null;this.frame=null}this.asyncRequestId=null;OpenLayers.Tile.prototype.destroy.apply(this,arguments)},draw:function(){var e=OpenLayers.Tile.prototype.draw.apply(this,arguments);if(e){this.layer!=this.layer.map.baseLayer&&this.layer.reproject&&(this.bounds=this.getBoundsFromBaseLayer(this.position));if(this.isLoading)this._loadEvent="reload";else{this.isLoading=!0;this._loadEvent="loadstart"}this.renderTile();this.positionTile()}else e===!1&&this.unload();return e},renderTile:function(){if(this.layer.async){var e=this.asyncRequestId=(this.asyncRequestId||0)+1;this.layer.getURLasync(this.bounds,function(t){if(e==this.asyncRequestId){this.url=t;this.initImage()}},this)}else{this.url=this.layer.getURL(this.bounds);this.initImage()}},positionTile:function(){var e=this.getTile().style,t=this.frame?this.size:this.layer.getImageSize(this.bounds),n=1;this.layer instanceof OpenLayers.Layer.Grid&&(n=this.layer.getServerResolution()/this.layer.map.getResolution());e.left=this.position.x+"px";e.top=this.position.y+"px";e.width=Math.round(n*t.w)+"px";e.height=Math.round(n*t.h)+"px"},clear:function(){OpenLayers.Tile.prototype.clear.apply(this,arguments);var e=this.imgDiv;if(e){var t=this.getTile();t.parentNode===this.layer.div&&this.layer.div.removeChild(t);this.setImgSrc();this.layerAlphaHack===!0&&(e.style.filter="");OpenLayers.Element.removeClass(e,"olImageLoadError")}this.canvasContext=null},getImage:function(){if(!this.imgDiv){this.imgDiv=OpenLayers.Tile.Image.IMAGE.cloneNode(!1);var e=this.imgDiv.style;if(this.frame){var t=0,n=0;if(this.layer.gutter){t=this.layer.gutter/this.layer.tileSize.w*100;n=this.layer.gutter/this.layer.tileSize.h*100}e.left=-t+"%";e.top=-n+"%";e.width=2*t+100+"%";e.height=2*n+100+"%"}e.visibility="hidden";e.opacity=0;this.layer.opacity<1&&(e.filter="alpha(opacity="+100*this.layer.opacity+")");e.position="absolute";if(this.layerAlphaHack){e.paddingTop=e.height;e.height="0";e.width="100%"}this.frame&&this.frame.appendChild(this.imgDiv)}return this.imgDiv},setImage:function(e){this.imgDiv=e},initImage:function(){if(this.url||this.imgDiv){this.events.triggerEvent("beforeload");this.layer.div.appendChild(this.getTile());this.events.triggerEvent(this._loadEvent);var e=this.getImage(),t=e.getAttribute("src")||"";if(this.url&&OpenLayers.Util.isEquivalentUrl(t,this.url))this._loadTimeout=window.setTimeout(OpenLayers.Function.bind(this.onImageLoad,this),0);else{this.stopLoading();this.crossOriginKeyword&&e.removeAttribute("crossorigin");OpenLayers.Event.observe(e,"load",OpenLayers.Function.bind(this.onImageLoad,this));OpenLayers.Event.observe(e,"error",OpenLayers.Function.bind(this.onImageError,this));this.imageReloadAttempts=0;this.setImgSrc(this.url)}}else this.isLoading=!1},setImgSrc:function(e){var t=this.imgDiv;if(e){t.style.visibility="hidden";t.style.opacity=0;this.crossOriginKeyword&&("data:"!==e.substr(0,5)?t.setAttribute("crossorigin",this.crossOriginKeyword):t.removeAttribute("crossorigin"));t.src=e}else{this.stopLoading();this.imgDiv=null;t.parentNode&&t.parentNode.removeChild(t)}},getTile:function(){return this.frame?this.frame:this.getImage()},createBackBuffer:function(){if(this.imgDiv&&!this.isLoading){var e;if(this.frame){e=this.frame.cloneNode(!1);e.appendChild(this.imgDiv)}else e=this.imgDiv;this.imgDiv=null;return e}},onImageLoad:function(){var e=this.imgDiv;this.stopLoading();e.style.visibility="inherit";e.style.opacity=this.layer.opacity;this.isLoading=!1;this.canvasContext=null;this.events.triggerEvent("loadend");this.layerAlphaHack===!0&&(e.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+e.src+"', sizingMethod='scale')")},onImageError:function(){var e=this.imgDiv;if(null!=e.src){this.imageReloadAttempts++;if(this.imageReloadAttempts<=OpenLayers.IMAGE_RELOAD_ATTEMPTS)this.setImgSrc(this.layer.getURL(this.bounds));else{OpenLayers.Element.addClass(e,"olImageLoadError");this.events.triggerEvent("loaderror");this.onImageLoad()}}},stopLoading:function(){OpenLayers.Event.stopObservingElement(this.imgDiv);window.clearTimeout(this._loadTimeout);delete this._loadTimeout},getCanvasContext:function(){if(OpenLayers.CANVAS_SUPPORTED&&this.imgDiv&&!this.isLoading){if(!this.canvasContext){var e=document.createElement("canvas");e.width=this.size.w;e.height=this.size.h;this.canvasContext=e.getContext("2d");this.canvasContext.drawImage(this.imgDiv,0,0)}return this.canvasContext}},CLASS_NAME:"OpenLayers.Tile.Image"});OpenLayers.Tile.Image.IMAGE=function(){var e=new Image;e.className="olTileImage";e.galleryImg="no";return e}();OpenLayers.Layer.Grid=OpenLayers.Class(OpenLayers.Layer.HTTPRequest,{tileSize:null,tileOriginCorner:"bl",tileOrigin:null,tileOptions:null,tileClass:OpenLayers.Tile.Image,grid:null,singleTile:!1,ratio:1.5,buffer:0,transitionEffect:"resize",numLoadingTiles:0,serverResolutions:null,loading:!1,backBuffer:null,gridResolution:null,backBufferResolution:null,backBufferLonLat:null,backBufferTimerId:null,removeBackBufferDelay:null,className:null,gridLayout:null,rowSign:null,transitionendEvents:["transitionend","webkitTransitionEnd","otransitionend","oTransitionEnd"],initialize:function(e,t,n,r){OpenLayers.Layer.HTTPRequest.prototype.initialize.apply(this,arguments);this.grid=[];this._removeBackBuffer=OpenLayers.Function.bind(this.removeBackBuffer,this);this.initProperties();this.rowSign="t"===this.tileOriginCorner.substr(0,1)?1:-1},initProperties:function(){void 0===this.options.removeBackBufferDelay&&(this.removeBackBufferDelay=this.singleTile?0:2500);void 0===this.options.className&&(this.className=this.singleTile?"olLayerGridSingleTile":"olLayerGrid")},setMap:function(e){OpenLayers.Layer.HTTPRequest.prototype.setMap.call(this,e);OpenLayers.Element.addClass(this.div,this.className)},removeMap:function(e){this.removeBackBuffer()},destroy:function(){this.removeBackBuffer();this.clearGrid();this.grid=null;this.tileSize=null;OpenLayers.Layer.HTTPRequest.prototype.destroy.apply(this,arguments)},clearGrid:function(){if(this.grid){for(var e=0,t=this.grid.length;t>e;e++)for(var n=this.grid[e],r=0,i=n.length;i>r;r++){var a=n[r];this.destroyTile(a)}this.grid=[];this.gridResolution=null;this.gridLayout=null}},addOptions:function(e,t){var n=void 0!==e.singleTile&&e.singleTile!==this.singleTile;OpenLayers.Layer.HTTPRequest.prototype.addOptions.apply(this,arguments);if(this.map&&n){this.initProperties();this.clearGrid();this.tileSize=this.options.tileSize;this.setTileSize();this.moveTo(null,!0)}},clone:function(e){null==e&&(e=new OpenLayers.Layer.Grid(this.name,this.url,this.params,this.getOptions()));e=OpenLayers.Layer.HTTPRequest.prototype.clone.apply(this,[e]);null!=this.tileSize&&(e.tileSize=this.tileSize.clone());e.grid=[];e.gridResolution=null;e.backBuffer=null;e.backBufferTimerId=null;e.loading=!1;e.numLoadingTiles=0;return e},moveTo:function(e,t,n){OpenLayers.Layer.HTTPRequest.prototype.moveTo.apply(this,arguments);e=e||this.map.getExtent();if(null!=e){{var r=!this.grid.length||t,i=this.getTilesBounds(),a=this.map.getResolution();this.getServerResolution(a)}if(this.singleTile){if(r||!n&&!i.containsBounds(e)){t&&"resize"!==this.transitionEffect&&this.removeBackBuffer();t&&"resize"!==this.transitionEffect||this.applyBackBuffer(a);this.initSingleTile(e)}}else{r=r||!i.intersectsBounds(e,{worldBounds:this.map.baseLayer.wrapDateLine&&this.map.getMaxExtent()});if(r){!t||"resize"!==this.transitionEffect&&this.gridResolution!==a||this.applyBackBuffer(a);this.initGriddedTiles(e)}else this.moveGriddedTiles()}}},getTileData:function(e){var t=null,n=e.lon,r=e.lat,i=this.grid.length;if(this.map&&i){var a=this.map.getResolution(),s=this.tileSize.w,o=this.tileSize.h,l=this.grid[0][0].bounds,c=l.left,u=l.top;if(c>n&&this.map.baseLayer.wrapDateLine){var h=this.map.getMaxExtent().getWidth(),p=Math.ceil((c-n)/h);n+=h*p}var d=(n-c)/(a*s),f=(u-r)/(a*o),m=Math.floor(d),y=Math.floor(f);if(y>=0&&i>y){var g=this.grid[y][m];g&&(t={tile:g,i:Math.floor((d-m)*s),j:Math.floor((f-y)*o)})}}return t},destroyTile:function(e){this.removeTileMonitoringHooks(e);e.destroy()},getServerResolution:function(e){var t=Number.POSITIVE_INFINITY;e=e||this.map.getResolution();if(this.serverResolutions&&-1===OpenLayers.Util.indexOf(this.serverResolutions,e)){var n,r,i,a;for(n=this.serverResolutions.length-1;n>=0;n--){i=this.serverResolutions[n];r=Math.abs(i-e);if(r>t)break;t=r;a=i}e=a}return e},getServerZoom:function(){var e=this.getServerResolution();return this.serverResolutions?OpenLayers.Util.indexOf(this.serverResolutions,e):this.map.getZoomForResolution(e)+(this.zoomOffset||0)},applyBackBuffer:function(e){null!==this.backBufferTimerId&&this.removeBackBuffer();var t=this.backBuffer;if(!t){t=this.createBackBuffer();if(!t)return;e===this.gridResolution?this.div.insertBefore(t,this.div.firstChild):this.map.baseLayer.div.parentNode.insertBefore(t,this.map.baseLayer.div);this.backBuffer=t;var n=this.grid[0][0].bounds;this.backBufferLonLat={lon:n.left,lat:n.top};this.backBufferResolution=this.gridResolution}for(var r,i=this.backBufferResolution/e,a=t.childNodes,s=a.length-1;s>=0;--s){r=a[s];r.style.top=(i*r._i*r._h|0)+"px";r.style.left=(i*r._j*r._w|0)+"px";r.style.width=Math.round(i*r._w)+"px";r.style.height=Math.round(i*r._h)+"px"}var o=this.getViewPortPxFromLonLat(this.backBufferLonLat,e),l=this.map.layerContainerOriginPx.x,c=this.map.layerContainerOriginPx.y;t.style.left=Math.round(o.x-l)+"px";t.style.top=Math.round(o.y-c)+"px"},createBackBuffer:function(){var e;if(this.grid.length>0){e=document.createElement("div");e.id=this.div.id+"_bb";e.className="olBackBuffer";e.style.position="absolute";var t=this.map;e.style.zIndex="resize"===this.transitionEffect?this.getZIndex()-1:t.Z_INDEX_BASE.BaseLayer-(t.getNumLayers()-t.getLayerIndex(this));for(var n=0,r=this.grid.length;r>n;n++)for(var i=0,a=this.grid[n].length;a>i;i++){var s=this.grid[n][i],o=this.grid[n][i].createBackBuffer();if(o){o._i=n;o._j=i;o._w=s.size.w;o._h=s.size.h;o.id=s.id+"_bb";e.appendChild(o)}}}return e},removeBackBuffer:function(){if(this._transitionElement){for(var e=this.transitionendEvents.length-1;e>=0;--e)OpenLayers.Event.stopObserving(this._transitionElement,this.transitionendEvents[e],this._removeBackBuffer);delete this._transitionElement}if(this.backBuffer){this.backBuffer.parentNode&&this.backBuffer.parentNode.removeChild(this.backBuffer);this.backBuffer=null;this.backBufferResolution=null;if(null!==this.backBufferTimerId){window.clearTimeout(this.backBufferTimerId);this.backBufferTimerId=null}}},moveByPx:function(e,t){this.singleTile||this.moveGriddedTiles()},setTileSize:function(e){if(this.singleTile){e=this.map.getSize();e.h=parseInt(e.h*this.ratio,10);e.w=parseInt(e.w*this.ratio,10)}OpenLayers.Layer.HTTPRequest.prototype.setTileSize.apply(this,[e])},getTilesBounds:function(){var e=null,t=this.grid.length;if(t){var n=this.grid[t-1][0].bounds,r=this.grid[0].length*n.getWidth(),i=this.grid.length*n.getHeight();e=new OpenLayers.Bounds(n.left,n.bottom,n.left+r,n.bottom+i)}return e},initSingleTile:function(e){this.events.triggerEvent("retile");var t=e.getCenterLonLat(),n=e.getWidth()*this.ratio,r=e.getHeight()*this.ratio,i=new OpenLayers.Bounds(t.lon-n/2,t.lat-r/2,t.lon+n/2,t.lat+r/2),a=this.map.getLayerPxFromLonLat({lon:i.left,lat:i.top});this.grid.length||(this.grid[0]=[]);var s=this.grid[0][0];if(s)s.moveTo(i,a);else{s=this.addTile(i,a);this.addTileMonitoringHooks(s);s.draw();this.grid[0][0]=s}this.removeExcessTiles(1,1);this.gridResolution=this.getServerResolution()},calculateGridLayout:function(e,t,n){var r=n*this.tileSize.w,i=n*this.tileSize.h,a=e.left-t.lon,s=Math.floor(a/r)-this.buffer,o=this.rowSign,l=o*(t.lat-e.top+i),c=Math[~o?"floor":"ceil"](l/i)-this.buffer*o;return{tilelon:r,tilelat:i,startcol:s,startrow:c}},getTileOrigin:function(){var e=this.tileOrigin;if(!e){var t=this.getMaxExtent(),n={tl:["left","top"],tr:["right","top"],bl:["left","bottom"],br:["right","bottom"]}[this.tileOriginCorner];e=new OpenLayers.LonLat(t[n[0]],t[n[1]])}return e},getTileBoundsForGridIndex:function(e,t){var n=this.getTileOrigin(),r=this.gridLayout,i=r.tilelon,a=r.tilelat,s=r.startcol,o=r.startrow,l=this.rowSign;return new OpenLayers.Bounds(n.lon+(s+t)*i,n.lat-(o+e*l)*a*l,n.lon+(s+t+1)*i,n.lat-(o+(e-1)*l)*a*l)},initGriddedTiles:function(e){this.events.triggerEvent("retile");var t=this.map.getSize(),n=this.getTileOrigin(),r=this.map.getResolution(),i=this.getServerResolution(),a=r/i,s={w:this.tileSize.w/a,h:this.tileSize.h/a},o=Math.ceil(t.h/s.h)+2*this.buffer+1,l=Math.ceil(t.w/s.w)+2*this.buffer+1,c=this.calculateGridLayout(e,n,i);this.gridLayout=c;var u=c.tilelon,h=c.tilelat,p=this.map.layerContainerOriginPx.x,d=this.map.layerContainerOriginPx.y,f=this.getTileBoundsForGridIndex(0,0),m=this.map.getViewPortPxFromLonLat(new OpenLayers.LonLat(f.left,f.top));m.x=Math.round(m.x)-p;m.y=Math.round(m.y)-d;var y=[],g=this.map.getCenter(),v=0;do{var C=this.grid[v];if(!C){C=[];this.grid.push(C)}var L=0;do{f=this.getTileBoundsForGridIndex(v,L);var T=m.clone();T.x=T.x+L*Math.round(s.w);T.y=T.y+v*Math.round(s.h);var w=C[L];if(w)w.moveTo(f,T,!1);else{w=this.addTile(f,T);this.addTileMonitoringHooks(w);C.push(w)}var b=f.getCenterLonLat();y.push({tile:w,distance:Math.pow(b.lon-g.lon,2)+Math.pow(b.lat-g.lat,2)});L+=1}while(f.right<=e.right+u*this.buffer||l>L);v+=1}while(f.bottom>=e.bottom-h*this.buffer||o>v);this.removeExcessTiles(v,L);var r=this.getServerResolution();this.gridResolution=r;y.sort(function(e,t){return e.distance-t.distance});for(var S=0,E=y.length;E>S;++S)y[S].tile.draw()},getMaxExtent:function(){return this.maxExtent},addTile:function(e,t){var n=new this.tileClass(this,t,e,null,this.tileSize,this.tileOptions);this.events.triggerEvent("addtile",{tile:n});return n},addTileMonitoringHooks:function(e){var t="olTileReplacing";e.onLoadStart=function(){if(this.loading===!1){this.loading=!0;this.events.triggerEvent("loadstart")}this.events.triggerEvent("tileloadstart",{tile:e});this.numLoadingTiles++;!this.singleTile&&this.backBuffer&&this.gridResolution===this.backBufferResolution&&OpenLayers.Element.addClass(e.getTile(),t)};e.onLoadEnd=function(n){this.numLoadingTiles--;var r="unload"===n.type;this.events.triggerEvent("tileloaded",{tile:e,aborted:r});if(!this.singleTile&&!r&&this.backBuffer&&this.gridResolution===this.backBufferResolution){var i=e.getTile();if("none"===OpenLayers.Element.getStyle(i,"display")){var a=document.getElementById(e.id+"_bb");a&&a.parentNode.removeChild(a)}OpenLayers.Element.removeClass(i,t)}if(0===this.numLoadingTiles){if(this.backBuffer)if(0===this.backBuffer.childNodes.length)this.removeBackBuffer();else{this._transitionElement=r?this.div.lastChild:e.imgDiv;for(var s=this.transitionendEvents,o=s.length-1;o>=0;--o)OpenLayers.Event.observe(this._transitionElement,s[o],this._removeBackBuffer);this.backBufferTimerId=window.setTimeout(this._removeBackBuffer,this.removeBackBufferDelay)}this.loading=!1;this.events.triggerEvent("loadend")}};e.onLoadError=function(){this.events.triggerEvent("tileerror",{tile:e})};e.events.on({loadstart:e.onLoadStart,loadend:e.onLoadEnd,unload:e.onLoadEnd,loaderror:e.onLoadError,scope:this})},removeTileMonitoringHooks:function(e){e.unload();e.events.un({loadstart:e.onLoadStart,loadend:e.onLoadEnd,unload:e.onLoadEnd,loaderror:e.onLoadError,scope:this})},moveGriddedTiles:function(){for(var e=this.buffer+1;;){var t=this.grid[0][0],n={x:t.position.x+this.map.layerContainerOriginPx.x,y:t.position.y+this.map.layerContainerOriginPx.y},r=this.getServerResolution()/this.map.getResolution(),i={w:Math.round(this.tileSize.w*r),h:Math.round(this.tileSize.h*r)};if(n.x>-i.w*(e-1))this.shiftColumn(!0,i);else if(n.x<-i.w*e)this.shiftColumn(!1,i);else if(n.y>-i.h*(e-1))this.shiftRow(!0,i);else{if(!(n.y<-i.h*e))break;this.shiftRow(!1,i)}}},shiftRow:function(e,t){var n=this.grid,r=e?0:n.length-1,i=e?-1:1,a=this.rowSign,s=this.gridLayout;s.startrow+=i*a;for(var o=n[r],l=n[e?"pop":"shift"](),c=0,u=l.length;u>c;c++){var h=l[c],p=o[c].position.clone();p.y+=t.h*i;h.moveTo(this.getTileBoundsForGridIndex(r,c),p)}n[e?"unshift":"push"](l)},shiftColumn:function(e,t){var n=this.grid,r=e?0:n[0].length-1,i=e?-1:1,a=this.gridLayout;a.startcol+=i;for(var s=0,o=n.length;o>s;s++){var l=n[s],c=l[r].position.clone(),u=l[e?"pop":"shift"]();c.x+=t.w*i;u.moveTo(this.getTileBoundsForGridIndex(s,r),c);l[e?"unshift":"push"](u)}},removeExcessTiles:function(e,t){for(var n,r;this.grid.length>e;){var i=this.grid.pop();for(n=0,r=i.length;r>n;n++){var a=i[n];this.destroyTile(a)}}for(n=0,r=this.grid.length;r>n;n++)for(;this.grid[n].length>t;){var i=this.grid[n],a=i.pop();this.destroyTile(a)}},onMapResize:function(){if(this.singleTile){this.clearGrid();this.setTileSize()}},getTileBounds:function(e){var t=this.maxExtent,n=this.getResolution(),r=n*this.tileSize.w,i=n*this.tileSize.h,a=this.getLonLatFromViewPortPx(e),s=t.left+r*Math.floor((a.lon-t.left)/r),o=t.bottom+i*Math.floor((a.lat-t.bottom)/i);return new OpenLayers.Bounds(s,o,s+r,o+i)},CLASS_NAME:"OpenLayers.Layer.Grid"});OpenLayers.Layer.WMTS=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:!0,version:"1.0.0",requestEncoding:"KVP",url:null,layer:null,matrixSet:null,style:null,format:"image/jpeg",tileOrigin:null,tileFullExtent:null,formatSuffix:null,matrixIds:null,dimensions:null,params:null,zoomOffset:0,serverResolutions:null,formatSuffixMap:{"image/png":"png","image/png8":"png","image/png24":"png","image/png32":"png",png:"png","image/jpeg":"jpg","image/jpg":"jpg",jpeg:"jpg",jpg:"jpg"},matrix:null,initialize:function(e){var t={url:!0,layer:!0,style:!0,matrixSet:!0};for(var n in t)if(!(n in e))throw new Error("Missing property '"+n+"' in layer configuration.");e.params=OpenLayers.Util.upperCaseObject(e.params);var r=[e.name,e.url,e.params,e];OpenLayers.Layer.Grid.prototype.initialize.apply(this,r);this.formatSuffix||(this.formatSuffix=this.formatSuffixMap[this.format]||this.format.split("/").pop());if(this.matrixIds){var i=this.matrixIds.length;if(i&&"string"==typeof this.matrixIds[0]){var a=this.matrixIds;this.matrixIds=new Array(i);for(var s=0;i>s;++s)this.matrixIds[s]={identifier:a[s]}}}},setMap:function(){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments)},updateMatrixProperties:function(){this.matrix=this.getMatrix();if(this.matrix){this.matrix.topLeftCorner&&(this.tileOrigin=this.matrix.topLeftCorner);this.matrix.tileWidth&&this.matrix.tileHeight&&(this.tileSize=new OpenLayers.Size(this.matrix.tileWidth,this.matrix.tileHeight));this.tileOrigin||(this.tileOrigin=new OpenLayers.LonLat(this.maxExtent.left,this.maxExtent.top));this.tileFullExtent||(this.tileFullExtent=this.maxExtent)}},moveTo:function(e,t,n){(t||!this.matrix)&&this.updateMatrixProperties();return OpenLayers.Layer.Grid.prototype.moveTo.apply(this,arguments)},clone:function(e){null==e&&(e=new OpenLayers.Layer.WMTS(this.options));e=OpenLayers.Layer.Grid.prototype.clone.apply(this,[e]);return e},getIdentifier:function(){return this.getServerZoom()},getMatrix:function(){var e;if(this.matrixIds&&0!==this.matrixIds.length)if("scaleDenominator"in this.matrixIds[0])for(var t,n=OpenLayers.METERS_PER_INCH*OpenLayers.INCHES_PER_UNIT[this.units]*this.getServerResolution()/28e-5,r=Number.POSITIVE_INFINITY,i=0,a=this.matrixIds.length;a>i;++i){t=Math.abs(1-this.matrixIds[i].scaleDenominator/n);if(r>t){r=t;e=this.matrixIds[i]}}else e=this.matrixIds[this.getIdentifier()];else e={identifier:this.getIdentifier()};return e},getTileInfo:function(e){var t=this.getServerResolution(),n=(e.lon-this.tileOrigin.lon)/(t*this.tileSize.w),r=(this.tileOrigin.lat-e.lat)/(t*this.tileSize.h),i=Math.floor(n),a=Math.floor(r);return{col:i,row:a,
i:Math.floor((n-i)*this.tileSize.w),j:Math.floor((r-a)*this.tileSize.h)}},getURL:function(e){e=this.adjustBounds(e);var t="";if(!this.tileFullExtent||this.tileFullExtent.intersectsBounds(e)){var n,r=e.getCenterLonLat(),i=this.getTileInfo(r),a=(this.matrix.identifier,this.dimensions);t=OpenLayers.Util.isArray(this.url)?this.selectUrl([this.version,this.style,this.matrixSet,this.matrix.identifier,i.row,i.col].join(","),this.url):this.url;if("REST"===this.requestEncoding.toUpperCase()){n=this.params;if(-1!==t.indexOf("{")){var s=t.replace(/\{/g,"${"),o={style:this.style,Style:this.style,TileMatrixSet:this.matrixSet,TileMatrix:this.matrix.identifier,TileRow:i.row,TileCol:i.col};if(a){var l,c;for(c=a.length-1;c>=0;--c){l=a[c];o[l]=n[l.toUpperCase()]}}t=OpenLayers.String.format(s,o)}else{var u=this.version+"/"+this.layer+"/"+this.style+"/";if(a)for(var c=0;c<a.length;c++)n[a[c]]&&(u=u+n[a[c]]+"/");u=u+this.matrixSet+"/"+this.matrix.identifier+"/"+i.row+"/"+i.col+"."+this.formatSuffix;t.match(/\/$/)||(t+="/");t+=u}}else if("KVP"===this.requestEncoding.toUpperCase()){n={SERVICE:"WMTS",REQUEST:"GetTile",VERSION:this.version,LAYER:this.layer,STYLE:this.style,TILEMATRIXSET:this.matrixSet,TILEMATRIX:this.matrix.identifier,TILEROW:i.row,TILECOL:i.col,FORMAT:this.format};t=OpenLayers.Layer.Grid.prototype.getFullRequestString.apply(this,[n])}}return t},mergeNewParams:function(e){return"KVP"===this.requestEncoding.toUpperCase()?OpenLayers.Layer.Grid.prototype.mergeNewParams.apply(this,[OpenLayers.Util.upperCaseObject(e)]):void 0},CLASS_NAME:"OpenLayers.Layer.WMTS"});OpenLayers.Events.buttonclick=OpenLayers.Class({target:null,events:["mousedown","mouseup","click","dblclick","touchstart","touchmove","touchend","keydown"],startRegEx:/^mousedown|touchstart$/,cancelRegEx:/^touchmove$/,completeRegEx:/^mouseup|touchend$/,initialize:function(e){this.target=e;for(var t=this.events.length-1;t>=0;--t)this.target.register(this.events[t],this,this.buttonClick,{extension:!0})},destroy:function(){for(var e=this.events.length-1;e>=0;--e)this.target.unregister(this.events[e],this,this.buttonClick);delete this.target},getPressedButton:function(e){var t,n=3;do{if(OpenLayers.Element.hasClass(e,"olButton")){t=e;break}e=e.parentNode}while(--n>0&&e);return t},ignore:function(e){var t=3,n=!1;do{if("a"===e.nodeName.toLowerCase()){n=!0;break}e=e.parentNode}while(--t>0&&e);return n},buttonClick:function(e){var t=!0,n=OpenLayers.Event.element(e);if(n&&(OpenLayers.Event.isLeftClick(e)||!~e.type.indexOf("mouse"))){var r=this.getPressedButton(n);if(r){if("keydown"===e.type)switch(e.keyCode){case OpenLayers.Event.KEY_RETURN:case OpenLayers.Event.KEY_SPACE:this.target.triggerEvent("buttonclick",{buttonElement:r});OpenLayers.Event.stop(e);t=!1}else if(this.startEvt){if(this.completeRegEx.test(e.type)){var i=OpenLayers.Util.pagePosition(r),a=OpenLayers.Util.getViewportElement(),s=window.pageYOffset||a.scrollTop,o=window.pageXOffset||a.scrollLeft;i[0]=i[0]-o;i[1]=i[1]-s;this.target.triggerEvent("buttonclick",{buttonElement:r,buttonXY:{x:this.startEvt.clientX-i[0],y:this.startEvt.clientY-i[1]}})}this.cancelRegEx.test(e.type)&&delete this.startEvt;OpenLayers.Event.stop(e);t=!1}if(this.startRegEx.test(e.type)){this.startEvt=e;OpenLayers.Event.stop(e);t=!1}}else{t=!this.ignore(OpenLayers.Event.element(e));delete this.startEvt}}return t}});OpenLayers.Format=OpenLayers.Class({options:null,externalProjection:null,internalProjection:null,data:null,keepData:!1,initialize:function(e){OpenLayers.Util.extend(this,e);this.options=e},destroy:function(){},read:function(e){throw new Error("Read not implemented.")},write:function(e){throw new Error("Write not implemented.")},CLASS_NAME:"OpenLayers.Format"});OpenLayers.Format.XML=OpenLayers.Class(OpenLayers.Format,{namespaces:null,namespaceAlias:null,defaultPrefix:null,readers:{},writers:{},xmldom:null,initialize:function(e){window.ActiveXObject&&(this.xmldom=new ActiveXObject("Microsoft.XMLDOM"));OpenLayers.Format.prototype.initialize.apply(this,[e]);this.namespaces=OpenLayers.Util.extend({},this.namespaces);this.namespaceAlias={};for(var t in this.namespaces)this.namespaceAlias[this.namespaces[t]]=t},destroy:function(){this.xmldom=null;OpenLayers.Format.prototype.destroy.apply(this,arguments)},setNamespace:function(e,t){this.namespaces[e]=t;this.namespaceAlias[t]=e},read:function(e){var t=e.indexOf("<");t>0&&(e=e.substring(t));var n=OpenLayers.Util.Try(OpenLayers.Function.bind(function(){var t;t=window.ActiveXObject&&!this.xmldom?new ActiveXObject("Microsoft.XMLDOM"):this.xmldom;t.loadXML(e);return t},this),function(){return(new DOMParser).parseFromString(e,"text/xml")},function(){var t=new XMLHttpRequest;t.open("GET","data:text/xml;charset=utf-8,"+encodeURIComponent(e),!1);t.overrideMimeType&&t.overrideMimeType("text/xml");t.send(null);return t.responseXML});this.keepData&&(this.data=n);return n},write:function(e){var t;if(this.xmldom)t=e.xml;else{var n=new XMLSerializer;if(1==e.nodeType){var r=document.implementation.createDocument("","",null);r.importNode&&(e=r.importNode(e,!0));r.appendChild(e);t=n.serializeToString(r)}else t=n.serializeToString(e)}return t},createElementNS:function(e,t){var n;n=this.xmldom?"string"==typeof e?this.xmldom.createNode(1,t,e):this.xmldom.createNode(1,t,""):document.createElementNS(e,t);return n},createDocumentFragment:function(){var e;e=this.xmldom?this.xmldom.createDocumentFragment():document.createDocumentFragment();return e},createTextNode:function(e){var t;"string"!=typeof e&&(e=String(e));t=this.xmldom?this.xmldom.createTextNode(e):document.createTextNode(e);return t},getElementsByTagNameNS:function(e,t,n){var r=[];if(e.getElementsByTagNameNS)r=e.getElementsByTagNameNS(t,n);else for(var i,a,s=e.getElementsByTagName("*"),o=0,l=s.length;l>o;++o){i=s[o];a=i.prefix?i.prefix+":"+n:n;("*"==n||a==i.nodeName)&&("*"==t||t==i.namespaceURI)&&r.push(i)}return r},getAttributeNodeNS:function(e,t,n){var r=null;if(e.getAttributeNodeNS)r=e.getAttributeNodeNS(t,n);else for(var i,a,s=e.attributes,o=0,l=s.length;l>o;++o){i=s[o];if(i.namespaceURI==t){a=i.prefix?i.prefix+":"+n:n;if(a==i.nodeName){r=i;break}}}return r},getAttributeNS:function(e,t,n){var r="";if(e.getAttributeNS)r=e.getAttributeNS(t,n)||"";else{var i=this.getAttributeNodeNS(e,t,n);i&&(r=i.nodeValue)}return r},getChildValue:function(e,t){var n=t||"";if(e)for(var r=e.firstChild;r;r=r.nextSibling)switch(r.nodeType){case 3:case 4:n+=r.nodeValue}return n},isSimpleContent:function(e){for(var t=!0,n=e.firstChild;n;n=n.nextSibling)if(1===n.nodeType){t=!1;break}return t},contentType:function(e){for(var t=!1,n=!1,r=OpenLayers.Format.XML.CONTENT_TYPE.EMPTY,i=e.firstChild;i;i=i.nextSibling){switch(i.nodeType){case 1:n=!0;break;case 8:break;default:t=!0}if(n&&t)break}if(n&&t)r=OpenLayers.Format.XML.CONTENT_TYPE.MIXED;else{if(n)return OpenLayers.Format.XML.CONTENT_TYPE.COMPLEX;if(t)return OpenLayers.Format.XML.CONTENT_TYPE.SIMPLE}return r},hasAttributeNS:function(e,t,n){var r=!1;r=e.hasAttributeNS?e.hasAttributeNS(t,n):!!this.getAttributeNodeNS(e,t,n);return r},setAttributeNS:function(e,t,n,r){if(e.setAttributeNS)e.setAttributeNS(t,n,r);else{if(!this.xmldom)throw"setAttributeNS not implemented";if(t){var i=e.ownerDocument.createNode(2,n,t);i.nodeValue=r;e.setAttributeNode(i)}else e.setAttribute(n,r)}},createElementNSPlus:function(e,t){t=t||{};var n=t.uri||this.namespaces[t.prefix];if(!n){var r=e.indexOf(":");n=this.namespaces[e.substring(0,r)]}n||(n=this.namespaces[this.defaultPrefix]);var i=this.createElementNS(n,e);t.attributes&&this.setAttributes(i,t.attributes);var a=t.value;null!=a&&i.appendChild(this.createTextNode(a));return i},setAttributes:function(e,t){var n,r;for(var i in t)if(null!=t[i]&&t[i].toString){n=t[i].toString();r=this.namespaces[i.substring(0,i.indexOf(":"))]||null;this.setAttributeNS(e,r,i,n)}},readNode:function(e,t){t||(t={});var n=this.readers[e.namespaceURI?this.namespaceAlias[e.namespaceURI]:this.defaultPrefix];if(n){var r=e.localName||e.nodeName.split(":").pop(),i=n[r]||n["*"];i&&i.apply(this,[e,t])}return t},readChildNodes:function(e,t){t||(t={});for(var n,r=e.childNodes,i=0,a=r.length;a>i;++i){n=r[i];1==n.nodeType&&this.readNode(n,t)}return t},writeNode:function(e,t,n){var r,i,a=e.indexOf(":");if(a>0){r=e.substring(0,a);i=e.substring(a+1)}else{r=n?this.namespaceAlias[n.namespaceURI]:this.defaultPrefix;i=e}var s=this.writers[r][i].apply(this,[t]);n&&n.appendChild(s);return s},getChildEl:function(e,t,n){return e&&this.getThisOrNextEl(e.firstChild,t,n)},getNextEl:function(e,t,n){return e&&this.getThisOrNextEl(e.nextSibling,t,n)},getThisOrNextEl:function(e,t,n){e:for(var r=e;r;r=r.nextSibling)switch(r.nodeType){case 1:if(!(t&&t!==(r.localName||r.nodeName.split(":").pop())||n&&n!==r.namespaceURI))break e;r=null;break e;case 3:if(/^\s*$/.test(r.nodeValue))break;case 4:case 6:case 12:case 10:case 11:r=null;break e}return r||null},lookupNamespaceURI:function(e,t){var n=null;if(e)if(e.lookupNamespaceURI)n=e.lookupNamespaceURI(t);else e:switch(e.nodeType){case 1:if(null!==e.namespaceURI&&e.prefix===t){n=e.namespaceURI;break e}var r=e.attributes.length;if(r)for(var i,a=0;r>a;++a){i=e.attributes[a];if("xmlns"===i.prefix&&i.name==="xmlns:"+t){n=i.value||null;break e}if("xmlns"===i.name&&null===t){n=i.value||null;break e}}n=this.lookupNamespaceURI(e.parentNode,t);break e;case 2:n=this.lookupNamespaceURI(e.ownerElement,t);break e;case 9:n=this.lookupNamespaceURI(e.documentElement,t);break e;case 6:case 12:case 10:case 11:break e;default:n=this.lookupNamespaceURI(e.parentNode,t)}return n},getXMLDoc:function(){OpenLayers.Format.XML.document||this.xmldom||(document.implementation&&document.implementation.createDocument?OpenLayers.Format.XML.document=document.implementation.createDocument("","",null):!this.xmldom&&window.ActiveXObject&&(this.xmldom=new ActiveXObject("Microsoft.XMLDOM")));return OpenLayers.Format.XML.document||this.xmldom},CLASS_NAME:"OpenLayers.Format.XML"});OpenLayers.Format.XML.CONTENT_TYPE={EMPTY:0,SIMPLE:1,COMPLEX:2,MIXED:3};OpenLayers.Format.XML.lookupNamespaceURI=OpenLayers.Function.bind(OpenLayers.Format.XML.prototype.lookupNamespaceURI,OpenLayers.Format.XML.prototype);OpenLayers.Format.XML.document=null;OpenLayers.Format.WFST=function(e){e=OpenLayers.Util.applyDefaults(e,OpenLayers.Format.WFST.DEFAULTS);var t=OpenLayers.Format.WFST["v"+e.version.replace(/\./g,"_")];if(!t)throw"Unsupported WFST version: "+e.version;return new t(e)};OpenLayers.Format.WFST.DEFAULTS={version:"1.0.0"};OpenLayers.Feature=OpenLayers.Class({layer:null,id:null,lonlat:null,data:null,marker:null,popupClass:null,popup:null,initialize:function(e,t,n){this.layer=e;this.lonlat=t;this.data=null!=n?n:{};this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){null!=this.layer&&null!=this.layer.map&&null!=this.popup&&this.layer.map.removePopup(this.popup);null!=this.layer&&null!=this.marker&&this.layer.removeMarker(this.marker);this.layer=null;this.id=null;this.lonlat=null;this.data=null;if(null!=this.marker){this.destroyMarker(this.marker);this.marker=null}if(null!=this.popup){this.destroyPopup(this.popup);this.popup=null}},onScreen:function(){var e=!1;if(null!=this.layer&&null!=this.layer.map){var t=this.layer.map.getExtent();e=t.containsLonLat(this.lonlat)}return e},createMarker:function(){null!=this.lonlat&&(this.marker=new OpenLayers.Marker(this.lonlat,this.data.icon));return this.marker},destroyMarker:function(){this.marker.destroy()},createPopup:function(e){if(null!=this.lonlat){if(!this.popup){var t=this.marker?this.marker.icon:null,n=this.popupClass?this.popupClass:OpenLayers.Popup.Anchored;this.popup=new n(this.id+"_popup",this.lonlat,this.data.popupSize,this.data.popupContentHTML,t,e)}null!=this.data.overflow&&(this.popup.contentDiv.style.overflow=this.data.overflow);this.popup.feature=this}return this.popup},destroyPopup:function(){if(this.popup){this.popup.feature=null;this.popup.destroy();this.popup=null}},CLASS_NAME:"OpenLayers.Feature"});OpenLayers.State={UNKNOWN:"Unknown",INSERT:"Insert",UPDATE:"Update",DELETE:"Delete"};OpenLayers.Feature.Vector=OpenLayers.Class(OpenLayers.Feature,{fid:null,geometry:null,attributes:null,bounds:null,state:null,style:null,url:null,renderIntent:"default",modified:null,initialize:function(e,t,n){OpenLayers.Feature.prototype.initialize.apply(this,[null,null,t]);this.lonlat=null;this.geometry=e?e:null;this.state=null;this.attributes={};t&&(this.attributes=OpenLayers.Util.extend(this.attributes,t));this.style=n?n:null},destroy:function(){if(this.layer){this.layer.removeFeatures(this);this.layer=null}this.geometry=null;this.modified=null;OpenLayers.Feature.prototype.destroy.apply(this,arguments)},clone:function(){return new OpenLayers.Feature.Vector(this.geometry?this.geometry.clone():null,this.attributes,this.style)},onScreen:function(e){var t=!1;if(this.layer&&this.layer.map){var n=this.layer.map.getExtent();if(e){var r=this.geometry.getBounds();t=n.intersectsBounds(r)}else{var i=n.toGeometry();t=i.intersects(this.geometry)}}return t},getVisibility:function(){return!(this.style&&"none"==this.style.display||!this.layer||this.layer&&this.layer.styleMap&&"none"==this.layer.styleMap.createSymbolizer(this,this.renderIntent).display||this.layer&&!this.layer.getVisibility())},createMarker:function(){return null},destroyMarker:function(){},createPopup:function(){return null},atPoint:function(e,t,n){var r=!1;this.geometry&&(r=this.geometry.atPoint(e,t,n));return r},destroyPopup:function(){},move:function(e){if(!this.layer||!this.geometry.move)return void 0;var t;t="OpenLayers.LonLat"==e.CLASS_NAME?this.layer.getViewPortPxFromLonLat(e):e;var n=this.layer.getViewPortPxFromLonLat(this.geometry.getBounds().getCenterLonLat()),r=this.layer.map.getResolution();this.geometry.move(r*(t.x-n.x),r*(n.y-t.y));this.layer.drawFeature(this);return n},toState:function(e){if(e==OpenLayers.State.UPDATE)switch(this.state){case OpenLayers.State.UNKNOWN:case OpenLayers.State.DELETE:this.state=e;break;case OpenLayers.State.UPDATE:case OpenLayers.State.INSERT:}else if(e==OpenLayers.State.INSERT)switch(this.state){case OpenLayers.State.UNKNOWN:break;default:this.state=e}else if(e==OpenLayers.State.DELETE)switch(this.state){case OpenLayers.State.INSERT:break;case OpenLayers.State.DELETE:break;case OpenLayers.State.UNKNOWN:case OpenLayers.State.UPDATE:this.state=e}else e==OpenLayers.State.UNKNOWN&&(this.state=e)},CLASS_NAME:"OpenLayers.Feature.Vector"});OpenLayers.Feature.Vector.style={"default":{fillColor:"#ee9900",fillOpacity:.4,hoverFillColor:"white",hoverFillOpacity:.8,strokeColor:"#ee9900",strokeOpacity:1,strokeWidth:1,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"inherit",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},select:{fillColor:"blue",fillOpacity:.4,hoverFillColor:"white",hoverFillOpacity:.8,strokeColor:"blue",strokeOpacity:1,strokeWidth:2,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"pointer",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},temporary:{fillColor:"#66cccc",fillOpacity:.2,hoverFillColor:"white",hoverFillOpacity:.8,strokeColor:"#66cccc",strokeOpacity:1,strokeLinecap:"round",strokeWidth:2,strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"inherit",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},"delete":{display:"none"}};OpenLayers.Style=OpenLayers.Class({id:null,name:null,title:null,description:null,layerName:null,isDefault:!1,rules:null,context:null,defaultStyle:null,defaultsPerSymbolizer:!1,propertyStyles:null,initialize:function(e,t){OpenLayers.Util.extend(this,t);this.rules=[];t&&t.rules&&this.addRules(t.rules);this.setDefaultStyle(e||OpenLayers.Feature.Vector.style["default"]);this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){for(var e=0,t=this.rules.length;t>e;e++){this.rules[e].destroy();this.rules[e]=null}this.rules=null;this.defaultStyle=null},createSymbolizer:function(e){for(var t,n=this.defaultsPerSymbolizer?{}:this.createLiterals(OpenLayers.Util.extend({},this.defaultStyle),e),r=this.rules,i=[],a=!1,s=0,o=r.length;o>s;s++){t=r[s];var l=t.evaluate(e);if(l)if(t instanceof OpenLayers.Rule&&t.elseFilter)i.push(t);else{a=!0;this.applySymbolizer(t,n,e)}}if(0==a&&i.length>0){a=!0;for(var s=0,o=i.length;o>s;s++)this.applySymbolizer(i[s],n,e)}r.length>0&&0==a&&(n.display="none");null!=n.label&&"string"!=typeof n.label&&(n.label=String(n.label));return n},applySymbolizer:function(e,t,n){var r=n.geometry?this.getSymbolizerPrefix(n.geometry):OpenLayers.Style.SYMBOLIZER_PREFIXES[0],i=e.symbolizer[r]||e.symbolizer;if(this.defaultsPerSymbolizer===!0){var a=this.defaultStyle;OpenLayers.Util.applyDefaults(i,{pointRadius:a.pointRadius});(i.stroke===!0||i.graphic===!0)&&OpenLayers.Util.applyDefaults(i,{strokeWidth:a.strokeWidth,strokeColor:a.strokeColor,strokeOpacity:a.strokeOpacity,strokeDashstyle:a.strokeDashstyle,strokeLinecap:a.strokeLinecap});(i.fill===!0||i.graphic===!0)&&OpenLayers.Util.applyDefaults(i,{fillColor:a.fillColor,fillOpacity:a.fillOpacity});i.graphic===!0&&OpenLayers.Util.applyDefaults(i,{pointRadius:this.defaultStyle.pointRadius,externalGraphic:this.defaultStyle.externalGraphic,graphicName:this.defaultStyle.graphicName,graphicOpacity:this.defaultStyle.graphicOpacity,graphicWidth:this.defaultStyle.graphicWidth,graphicHeight:this.defaultStyle.graphicHeight,graphicXOffset:this.defaultStyle.graphicXOffset,graphicYOffset:this.defaultStyle.graphicYOffset})}return this.createLiterals(OpenLayers.Util.extend(t,i),n)},createLiterals:function(e,t){var n=OpenLayers.Util.extend({},t.attributes||t.data);OpenLayers.Util.extend(n,this.context);for(var r in this.propertyStyles)e[r]=OpenLayers.Style.createLiteral(e[r],n,t,r);return e},findPropertyStyles:function(){var e={},t=this.defaultStyle;this.addPropertyStyles(e,t);for(var n,r,i=this.rules,a=0,s=i.length;s>a;a++){n=i[a].symbolizer;for(var o in n){r=n[o];if("object"!=typeof r){this.addPropertyStyles(e,n);break}this.addPropertyStyles(e,r)}}return e},addPropertyStyles:function(e,t){var n;for(var r in t){n=t[r];"string"==typeof n&&n.match(/\$\{\w+\}/)&&(e[r]=!0)}return e},addRules:function(e){Array.prototype.push.apply(this.rules,e);this.propertyStyles=this.findPropertyStyles()},setDefaultStyle:function(e){this.defaultStyle=e;this.propertyStyles=this.findPropertyStyles()},getSymbolizerPrefix:function(e){for(var t=OpenLayers.Style.SYMBOLIZER_PREFIXES,n=0,r=t.length;r>n;n++)if(-1!=e.CLASS_NAME.indexOf(t[n]))return t[n]},clone:function(){var e=OpenLayers.Util.extend({},this);if(this.rules){e.rules=[];for(var t=0,n=this.rules.length;n>t;++t)e.rules.push(this.rules[t].clone())}e.context=this.context&&OpenLayers.Util.extend({},this.context);var r=OpenLayers.Util.extend({},this.defaultStyle);return new OpenLayers.Style(r,e)},CLASS_NAME:"OpenLayers.Style"});OpenLayers.Style.createLiteral=function(e,t,n,r){if("string"==typeof e&&-1!=e.indexOf("${")){e=OpenLayers.String.format(e,t,[n,r]);e=isNaN(e)||!e?e:parseFloat(e)}return e};OpenLayers.Style.SYMBOLIZER_PREFIXES=["Point","Line","Polygon","Text","Raster"];OpenLayers.Filter=OpenLayers.Class({initialize:function(e){OpenLayers.Util.extend(this,e)},destroy:function(){},evaluate:function(e){return!0},clone:function(){return null},toString:function(){var e;e=OpenLayers.Format&&OpenLayers.Format.CQL?OpenLayers.Format.CQL.prototype.write(this):Object.prototype.toString.call(this);return e},CLASS_NAME:"OpenLayers.Filter"});OpenLayers.Filter.Spatial=OpenLayers.Class(OpenLayers.Filter,{type:null,property:null,value:null,distance:null,distanceUnits:null,evaluate:function(e){var t=!1;switch(this.type){case OpenLayers.Filter.Spatial.BBOX:case OpenLayers.Filter.Spatial.INTERSECTS:if(e.geometry){var n=this.value;"OpenLayers.Bounds"==this.value.CLASS_NAME&&(n=this.value.toGeometry());e.geometry.intersects(n)&&(t=!0)}break;default:throw new Error("evaluate is not implemented for this filter type.")}return t},clone:function(){var e=OpenLayers.Util.applyDefaults({value:this.value&&this.value.clone&&this.value.clone()},this);return new OpenLayers.Filter.Spatial(e)},CLASS_NAME:"OpenLayers.Filter.Spatial"});OpenLayers.Filter.Spatial.BBOX="BBOX";OpenLayers.Filter.Spatial.INTERSECTS="INTERSECTS";OpenLayers.Filter.Spatial.DWITHIN="DWITHIN";OpenLayers.Filter.Spatial.WITHIN="WITHIN";OpenLayers.Filter.Spatial.CONTAINS="CONTAINS";OpenLayers.Filter.FeatureId=OpenLayers.Class(OpenLayers.Filter,{fids:null,type:"FID",initialize:function(e){this.fids=[];OpenLayers.Filter.prototype.initialize.apply(this,[e])},evaluate:function(e){for(var t=0,n=this.fids.length;n>t;t++){var r=e.fid||e.id;if(r==this.fids[t])return!0}return!1},clone:function(){var e=new OpenLayers.Filter.FeatureId;OpenLayers.Util.extend(e,this);e.fids=this.fids.slice();return e},CLASS_NAME:"OpenLayers.Filter.FeatureId"});OpenLayers.Format.WFST.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",wfs:"http://www.opengis.net/wfs",gml:"http://www.opengis.net/gml",ogc:"http://www.opengis.net/ogc",ows:"http://www.opengis.net/ows"},defaultPrefix:"wfs",version:null,schemaLocations:null,srsName:null,extractAttributes:!0,xy:!0,stateName:null,initialize:function(e){this.stateName={};this.stateName[OpenLayers.State.INSERT]="wfs:Insert";this.stateName[OpenLayers.State.UPDATE]="wfs:Update";this.stateName[OpenLayers.State.DELETE]="wfs:Delete";OpenLayers.Format.XML.prototype.initialize.apply(this,[e])},getSrsName:function(e,t){var n=t&&t.srsName;n||(n=e&&e.layer?e.layer.projection.getCode():this.srsName);return n},read:function(e,t){t=t||{};OpenLayers.Util.applyDefaults(t,{output:"features"});"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));e&&9==e.nodeType&&(e=e.documentElement);var n={};e&&this.readNode(e,n,!0);n.features&&"features"===t.output&&(n=n.features);return n},readers:{wfs:{FeatureCollection:function(e,t){t.features=[];this.readChildNodes(e,t)}}},write:function(e,t){var n=this.writeNode("wfs:Transaction",{features:e,options:t}),r=this.schemaLocationAttr();r&&this.setAttributeNS(n,this.namespaces.xsi,"xsi:schemaLocation",r);return OpenLayers.Format.XML.prototype.write.apply(this,[n])},writers:{wfs:{GetFeature:function(e){var t=this.createElementNSPlus("wfs:GetFeature",{attributes:{service:"WFS",version:this.version,handle:e&&e.handle,outputFormat:e&&e.outputFormat,maxFeatures:e&&e.maxFeatures,"xsi:schemaLocation":this.schemaLocationAttr(e)}});if("string"==typeof this.featureType)this.writeNode("Query",e,t);else for(var n=0,r=this.featureType.length;r>n;n++){e.featureType=this.featureType[n];this.writeNode("Query",e,t)}return t},Transaction:function(e){e=e||{};var t,n,r=e.options||{},i=this.createElementNSPlus("wfs:Transaction",{attributes:{service:"WFS",version:this.version,handle:r.handle}}),a=e.features;if(a){r.multi===!0&&OpenLayers.Util.extend(this.geometryTypes,{"OpenLayers.Geometry.Point":"MultiPoint","OpenLayers.Geometry.LineString":this.multiCurve===!0?"MultiCurve":"MultiLineString","OpenLayers.Geometry.Polygon":this.multiSurface===!0?"MultiSurface":"MultiPolygon"});var s,o;for(t=0,n=a.length;n>t;++t){o=a[t];s=this.stateName[o.state];s&&this.writeNode(s,{feature:o,options:r},i)}r.multi===!0&&this.setGeometryTypes()}if(r.nativeElements)for(t=0,n=r.nativeElements.length;n>t;++t)this.writeNode("wfs:Native",r.nativeElements[t],i);return i},Native:function(e){var t=this.createElementNSPlus("wfs:Native",{attributes:{vendorId:e.vendorId,safeToIgnore:e.safeToIgnore},value:e.value});return t},Insert:function(e){var t=e.feature,n=e.options,r=this.createElementNSPlus("wfs:Insert",{attributes:{handle:n&&n.handle}});this.srsName=this.getSrsName(t);this.writeNode("feature:_typeName",t,r);return r},Update:function(e){var t=e.feature,n=e.options,r=this.createElementNSPlus("wfs:Update",{attributes:{handle:n&&n.handle,typeName:(this.featureNS?this.featurePrefix+":":"")+this.featureType}});this.featureNS&&r.setAttribute("xmlns:"+this.featurePrefix,this.featureNS);var i=t.modified;if(null!==this.geometryName&&(!i||void 0!==i.geometry)){this.srsName=this.getSrsName(t);this.writeNode("Property",{name:this.geometryName,value:t.geometry},r)}for(var a in t.attributes)void 0===t.attributes[a]||i&&i.attributes&&(!i.attributes||void 0===i.attributes[a])||this.writeNode("Property",{name:a,value:t.attributes[a]},r);this.writeNode("ogc:Filter",new OpenLayers.Filter.FeatureId({fids:[t.fid]}),r);return r},Property:function(e){var t=this.createElementNSPlus("wfs:Property");this.writeNode("Name",e.name,t);null!==e.value&&this.writeNode("Value",e.value,t);return t},Name:function(e){return this.createElementNSPlus("wfs:Name",{value:e})},Value:function(e){var t;if(e instanceof OpenLayers.Geometry){t=this.createElementNSPlus("wfs:Value");var n=this.writeNode("feature:_geometry",e).firstChild;t.appendChild(n)}else t=this.createElementNSPlus("wfs:Value",{value:e});return t},Delete:function(e){var t=e.feature,n=e.options,r=this.createElementNSPlus("wfs:Delete",{attributes:{handle:n&&n.handle,typeName:(this.featureNS?this.featurePrefix+":":"")+this.featureType}});this.featureNS&&r.setAttribute("xmlns:"+this.featurePrefix,this.featureNS);this.writeNode("ogc:Filter",new OpenLayers.Filter.FeatureId({fids:[t.fid]}),r);return r}}},schemaLocationAttr:function(e){e=OpenLayers.Util.extend({featurePrefix:this.featurePrefix,schema:this.schema},e);var t=OpenLayers.Util.extend({},this.schemaLocations);e.schema&&(t[e.featurePrefix]=e.schema);var n,r=[];for(var i in t){n=this.namespaces[i];n&&r.push(n+" "+t[i])}var a=r.join(" ")||void 0;return a},setFilterProperty:function(e){if(e.filters)for(var t=0,n=e.filters.length;n>t;++t)OpenLayers.Format.WFST.v1.prototype.setFilterProperty.call(this,e.filters[t]);else e instanceof OpenLayers.Filter.Spatial&&!e.property&&(e.property=this.geometryName)},CLASS_NAME:"OpenLayers.Format.WFST.v1"});OpenLayers.Format.OGCExceptionReport=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ogc:"http://www.opengis.net/ogc"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},defaultPrefix:"ogc",read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));var t=e.documentElement,n={exceptionReport:null};if(t){this.readChildNodes(e,n);null===n.exceptionReport&&(n=(new OpenLayers.Format.OWSCommon).read(e))}return n},readers:{ogc:{ServiceExceptionReport:function(e,t){t.exceptionReport={exceptions:[]};this.readChildNodes(e,t.exceptionReport)},ServiceException:function(e,t){var n={code:e.getAttribute("code"),locator:e.getAttribute("locator"),text:this.getChildValue(e)};t.exceptions.push(n)}}},CLASS_NAME:"OpenLayers.Format.OGCExceptionReport"});OpenLayers.Format.XML.VersionedOGC=OpenLayers.Class(OpenLayers.Format.XML,{defaultVersion:null,version:null,profile:null,allowFallback:!1,name:null,stringifyOutput:!1,parser:null,initialize:function(e){OpenLayers.Format.XML.prototype.initialize.apply(this,[e]);var t=this.CLASS_NAME;this.name=t.substring(t.lastIndexOf(".")+1)},getVersion:function(e,t){var n;if(e){n=this.version;if(!n){n=e.getAttribute("version");n||(n=this.defaultVersion)}}else n=t&&t.version||this.version||this.defaultVersion;return n},getParser:function(e){e=e||this.defaultVersion;var t=this.profile?"_"+this.profile:"";if(!this.parser||this.parser.VERSION!=e){var n=OpenLayers.Format[this.name]["v"+e.replace(/\./g,"_")+t];if(!n){if(""!==t&&this.allowFallback){t="";n=OpenLayers.Format[this.name]["v"+e.replace(/\./g,"_")]}if(!n)throw"Can't find a "+this.name+" parser for version "+e+t}this.parser=new n(this.options)}return this.parser},write:function(e,t){var n=this.getVersion(null,t);this.parser=this.getParser(n);var r=this.parser.write(e,t);return this.stringifyOutput===!1?r:OpenLayers.Format.XML.prototype.write.apply(this,[r])},read:function(e,t){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));var n=e.documentElement,r=this.getVersion(n);this.parser=this.getParser(r);var i=this.parser.read(e,t),a=this.parser.errorProperty||null;if(null!==a&&void 0===i[a]){var s=new OpenLayers.Format.OGCExceptionReport;i.error=s.read(e)}i.version=r;return i},CLASS_NAME:"OpenLayers.Format.XML.VersionedOGC"});OpenLayers.Filter.Logical=OpenLayers.Class(OpenLayers.Filter,{filters:null,type:null,initialize:function(e){this.filters=[];OpenLayers.Filter.prototype.initialize.apply(this,[e])},destroy:function(){this.filters=null;OpenLayers.Filter.prototype.destroy.apply(this)},evaluate:function(e){var t,n;switch(this.type){case OpenLayers.Filter.Logical.AND:for(t=0,n=this.filters.length;n>t;t++)if(0==this.filters[t].evaluate(e))return!1;return!0;case OpenLayers.Filter.Logical.OR:for(t=0,n=this.filters.length;n>t;t++)if(1==this.filters[t].evaluate(e))return!0;return!1;case OpenLayers.Filter.Logical.NOT:return!this.filters[0].evaluate(e)}return void 0},clone:function(){for(var e=[],t=0,n=this.filters.length;n>t;++t)e.push(this.filters[t].clone());return new OpenLayers.Filter.Logical({type:this.type,filters:e})},CLASS_NAME:"OpenLayers.Filter.Logical"});OpenLayers.Filter.Logical.AND="&&";OpenLayers.Filter.Logical.OR="||";OpenLayers.Filter.Logical.NOT="!";OpenLayers.Filter.Comparison=OpenLayers.Class(OpenLayers.Filter,{type:null,property:null,value:null,matchCase:!0,lowerBoundary:null,upperBoundary:null,initialize:function(e){OpenLayers.Filter.prototype.initialize.apply(this,[e]);this.type===OpenLayers.Filter.Comparison.LIKE&&void 0===e.matchCase&&(this.matchCase=null)},evaluate:function(e){e instanceof OpenLayers.Feature.Vector&&(e=e.attributes);var t,n=!1,r=e[this.property];switch(this.type){case OpenLayers.Filter.Comparison.EQUAL_TO:t=this.value;n=this.matchCase||"string"!=typeof r||"string"!=typeof t?r==t:r.toUpperCase()==t.toUpperCase();break;case OpenLayers.Filter.Comparison.NOT_EQUAL_TO:t=this.value;n=this.matchCase||"string"!=typeof r||"string"!=typeof t?r!=t:r.toUpperCase()!=t.toUpperCase();break;case OpenLayers.Filter.Comparison.LESS_THAN:n=r<this.value;break;case OpenLayers.Filter.Comparison.GREATER_THAN:n=r>this.value;break;case OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO:n=r<=this.value;break;case OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO:n=r>=this.value;break;case OpenLayers.Filter.Comparison.BETWEEN:n=r>=this.lowerBoundary&&r<=this.upperBoundary;break;case OpenLayers.Filter.Comparison.LIKE:var i=new RegExp(this.value,"gi");n=i.test(r);break;case OpenLayers.Filter.Comparison.IS_NULL:n=null===r}return n},value2regex:function(e,t,n){if("."==e)throw new Error("'.' is an unsupported wildCard character for OpenLayers.Filter.Comparison");e=e?e:"*";t=t?t:".";n=n?n:"!";this.value=this.value.replace(new RegExp("\\"+n+"(.|$)","g"),"\\$1");this.value=this.value.replace(new RegExp("\\"+t,"g"),".");this.value=this.value.replace(new RegExp("\\"+e,"g"),".*");this.value=this.value.replace(new RegExp("\\\\.\\*","g"),"\\"+e);this.value=this.value.replace(new RegExp("\\\\\\.","g"),"\\"+t);return this.value},regex2value:function(){var e=this.value;e=e.replace(/!/g,"!!");e=e.replace(/(\\)?\\\./g,function(e,t){return t?e:"!."});e=e.replace(/(\\)?\\\*/g,function(e,t){return t?e:"!*"});e=e.replace(/\\\\/g,"\\");e=e.replace(/\.\*/g,"*");return e},clone:function(){return OpenLayers.Util.extend(new OpenLayers.Filter.Comparison,this)},CLASS_NAME:"OpenLayers.Filter.Comparison"});OpenLayers.Filter.Comparison.EQUAL_TO="==";OpenLayers.Filter.Comparison.NOT_EQUAL_TO="!=";OpenLayers.Filter.Comparison.LESS_THAN="<";OpenLayers.Filter.Comparison.GREATER_THAN=">";OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO="<=";OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO=">=";

OpenLayers.Filter.Comparison.BETWEEN="..";OpenLayers.Filter.Comparison.LIKE="~";OpenLayers.Filter.Comparison.IS_NULL="NULL";OpenLayers.Format.Filter=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",CLASS_NAME:"OpenLayers.Format.Filter"});OpenLayers.Filter.Function=OpenLayers.Class(OpenLayers.Filter,{name:null,params:null,CLASS_NAME:"OpenLayers.Filter.Function"});OpenLayers.Date={dateRegEx:/^(?:(\d{4})(?:-(\d{2})(?:-(\d{2}))?)?)?(?:(?:T(\d{1,2}):(\d{2}):(\d{2}(?:\.\d+)?)(Z|(?:[+-]\d{1,2}(?::(\d{2}))?)))|Z)?$/,toISOString:function(){return"toISOString"in Date.prototype?function(e){return e.toISOString()}:function(e){var t;t=isNaN(e.getTime())?"Invalid Date":e.getUTCFullYear()+"-"+OpenLayers.Number.zeroPad(e.getUTCMonth()+1,2)+"-"+OpenLayers.Number.zeroPad(e.getUTCDate(),2)+"T"+OpenLayers.Number.zeroPad(e.getUTCHours(),2)+":"+OpenLayers.Number.zeroPad(e.getUTCMinutes(),2)+":"+OpenLayers.Number.zeroPad(e.getUTCSeconds(),2)+"."+OpenLayers.Number.zeroPad(e.getUTCMilliseconds(),3)+"Z";return t}}(),parse:function(e){var t,n=e.match(this.dateRegEx);if(n&&(n[1]||n[7])){var r=parseInt(n[1],10)||0,i=parseInt(n[2],10)-1||0,a=parseInt(n[3],10)||1;t=new Date(Date.UTC(r,i,a));var s=n[7];if(s){var o=parseInt(n[4],10),l=parseInt(n[5],10),c=parseFloat(n[6]),u=0|c,h=Math.round(1e3*(c-u));t.setUTCHours(o,l,u,h);if("Z"!==s){var p=parseInt(s,10),d=parseInt(n[8],10)||0,f=-1e3*(3600*p+60*d);t=new Date(t.getTime()+f)}}}else t=new Date("invalid");return t}};OpenLayers.Format.Filter.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ogc:"http://www.opengis.net/ogc",gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"ogc",schemaLocation:null,initialize:function(e){OpenLayers.Format.XML.prototype.initialize.apply(this,[e])},read:function(e){var t={};this.readers.ogc.Filter.apply(this,[e,t]);return t.filter},readers:{ogc:{_expression:function(e){for(var t,n="",r=e.firstChild;r;r=r.nextSibling)switch(r.nodeType){case 1:t=this.readNode(r);t.property?n+="${"+t.property+"}":void 0!==t.value&&(n+=t.value);break;case 3:case 4:n+=r.nodeValue}return n},Filter:function(e,t){var n={fids:[],filters:[]};this.readChildNodes(e,n);n.fids.length>0?t.filter=new OpenLayers.Filter.FeatureId({fids:n.fids}):n.filters.length>0&&(t.filter=n.filters[0])},FeatureId:function(e,t){var n=e.getAttribute("fid");n&&t.fids.push(n)},And:function(e,t){var n=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND});this.readChildNodes(e,n);t.filters.push(n)},Or:function(e,t){var n=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.OR});this.readChildNodes(e,n);t.filters.push(n)},Not:function(e,t){var n=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.NOT});this.readChildNodes(e,n);t.filters.push(n)},PropertyIsLessThan:function(e,t){var n=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LESS_THAN});this.readChildNodes(e,n);t.filters.push(n)},PropertyIsGreaterThan:function(e,t){var n=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.GREATER_THAN});this.readChildNodes(e,n);t.filters.push(n)},PropertyIsLessThanOrEqualTo:function(e,t){var n=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO});this.readChildNodes(e,n);t.filters.push(n)},PropertyIsGreaterThanOrEqualTo:function(e,t){var n=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO});this.readChildNodes(e,n);t.filters.push(n)},PropertyIsBetween:function(e,t){var n=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.BETWEEN});this.readChildNodes(e,n);t.filters.push(n)},Literal:function(e,t){t.value=OpenLayers.String.numericIf(this.getChildValue(e),!0)},PropertyName:function(e,t){t.property=this.getChildValue(e)},LowerBoundary:function(e,t){t.lowerBoundary=OpenLayers.String.numericIf(this.readers.ogc._expression.call(this,e),!0)},UpperBoundary:function(e,t){t.upperBoundary=OpenLayers.String.numericIf(this.readers.ogc._expression.call(this,e),!0)},Intersects:function(e,t){this.readSpatial(e,t,OpenLayers.Filter.Spatial.INTERSECTS)},Within:function(e,t){this.readSpatial(e,t,OpenLayers.Filter.Spatial.WITHIN)},Contains:function(e,t){this.readSpatial(e,t,OpenLayers.Filter.Spatial.CONTAINS)},DWithin:function(e,t){this.readSpatial(e,t,OpenLayers.Filter.Spatial.DWITHIN)},Distance:function(e,t){t.distance=parseInt(this.getChildValue(e));t.distanceUnits=e.getAttribute("units")},Function:function(e,t){},PropertyIsNull:function(e,t){var n=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.IS_NULL});this.readChildNodes(e,n);t.filters.push(n)}}},readSpatial:function(e,t,n){var r=new OpenLayers.Filter.Spatial({type:n});this.readChildNodes(e,r);r.value=r.components[0];delete r.components;t.filters.push(r)},encodeLiteral:function(e){e instanceof Date&&(e=OpenLayers.Date.toISOString(e));return e},writeOgcExpression:function(e,t){e instanceof OpenLayers.Filter.Function?this.writeNode("Function",e,t):this.writeNode("Literal",e,t);return t},write:function(e){return this.writers.ogc.Filter.apply(this,[e])},writers:{ogc:{Filter:function(e){var t=this.createElementNSPlus("ogc:Filter");this.writeNode(this.getFilterType(e),e,t);return t},_featureIds:function(e){for(var t=this.createDocumentFragment(),n=0,r=e.fids.length;r>n;++n)this.writeNode("ogc:FeatureId",e.fids[n],t);return t},FeatureId:function(e){return this.createElementNSPlus("ogc:FeatureId",{attributes:{fid:e}})},And:function(e){for(var t,n=this.createElementNSPlus("ogc:And"),r=0,i=e.filters.length;i>r;++r){t=e.filters[r];this.writeNode(this.getFilterType(t),t,n)}return n},Or:function(e){for(var t,n=this.createElementNSPlus("ogc:Or"),r=0,i=e.filters.length;i>r;++r){t=e.filters[r];this.writeNode(this.getFilterType(t),t,n)}return n},Not:function(e){var t=this.createElementNSPlus("ogc:Not"),n=e.filters[0];this.writeNode(this.getFilterType(n),n,t);return t},PropertyIsLessThan:function(e){var t=this.createElementNSPlus("ogc:PropertyIsLessThan");this.writeNode("PropertyName",e,t);this.writeOgcExpression(e.value,t);return t},PropertyIsGreaterThan:function(e){var t=this.createElementNSPlus("ogc:PropertyIsGreaterThan");this.writeNode("PropertyName",e,t);this.writeOgcExpression(e.value,t);return t},PropertyIsLessThanOrEqualTo:function(e){var t=this.createElementNSPlus("ogc:PropertyIsLessThanOrEqualTo");this.writeNode("PropertyName",e,t);this.writeOgcExpression(e.value,t);return t},PropertyIsGreaterThanOrEqualTo:function(e){var t=this.createElementNSPlus("ogc:PropertyIsGreaterThanOrEqualTo");this.writeNode("PropertyName",e,t);this.writeOgcExpression(e.value,t);return t},PropertyIsBetween:function(e){var t=this.createElementNSPlus("ogc:PropertyIsBetween");this.writeNode("PropertyName",e,t);this.writeNode("LowerBoundary",e,t);this.writeNode("UpperBoundary",e,t);return t},PropertyName:function(e){return this.createElementNSPlus("ogc:PropertyName",{value:e.property})},Literal:function(e){var t=this.encodeLiteral||OpenLayers.Format.Filter.v1.prototype.encodeLiteral;return this.createElementNSPlus("ogc:Literal",{value:t(e)})},LowerBoundary:function(e){var t=this.createElementNSPlus("ogc:LowerBoundary");this.writeOgcExpression(e.lowerBoundary,t);return t},UpperBoundary:function(e){var t=this.createElementNSPlus("ogc:UpperBoundary");this.writeNode("Literal",e.upperBoundary,t);return t},INTERSECTS:function(e){return this.writeSpatial(e,"Intersects")},WITHIN:function(e){return this.writeSpatial(e,"Within")},CONTAINS:function(e){return this.writeSpatial(e,"Contains")},DWITHIN:function(e){var t=this.writeSpatial(e,"DWithin");this.writeNode("Distance",e,t);return t},Distance:function(e){return this.createElementNSPlus("ogc:Distance",{attributes:{units:e.distanceUnits},value:e.distance})},Function:function(e){for(var t=this.createElementNSPlus("ogc:Function",{attributes:{name:e.name}}),n=e.params,r=0,i=n.length;i>r;r++)this.writeOgcExpression(n[r],t);return t},PropertyIsNull:function(e){var t=this.createElementNSPlus("ogc:PropertyIsNull");this.writeNode("PropertyName",e,t);return t}}},getFilterType:function(e){var t=this.filterMap[e.type];if(!t)throw"Filter writing not supported for rule type: "+e.type;return t},filterMap:{"&&":"And","||":"Or","!":"Not","==":"PropertyIsEqualTo","!=":"PropertyIsNotEqualTo","<":"PropertyIsLessThan",">":"PropertyIsGreaterThan","<=":"PropertyIsLessThanOrEqualTo",">=":"PropertyIsGreaterThanOrEqualTo","..":"PropertyIsBetween","~":"PropertyIsLike",NULL:"PropertyIsNull",BBOX:"BBOX",DWITHIN:"DWITHIN",WITHIN:"WITHIN",CONTAINS:"CONTAINS",INTERSECTS:"INTERSECTS",FID:"_featureIds"},CLASS_NAME:"OpenLayers.Format.Filter.v1"});OpenLayers.Geometry=OpenLayers.Class({id:null,parent:null,bounds:null,initialize:function(){this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){this.id=null;this.bounds=null},clone:function(){return new OpenLayers.Geometry},setBounds:function(e){e&&(this.bounds=e.clone())},clearBounds:function(){this.bounds=null;this.parent&&this.parent.clearBounds()},extendBounds:function(e){var t=this.getBounds();t?this.bounds.extend(e):this.setBounds(e)},getBounds:function(){null==this.bounds&&this.calculateBounds();return this.bounds},calculateBounds:function(){},distanceTo:function(e,t){},getVertices:function(e){},atPoint:function(e,t,n){var r=!1,i=this.getBounds();if(null!=i&&null!=e){var a=null!=t?t:0,s=null!=n?n:0,o=new OpenLayers.Bounds(this.bounds.left-a,this.bounds.bottom-s,this.bounds.right+a,this.bounds.top+s);r=o.containsLonLat(e)}return r},getLength:function(){return 0},getArea:function(){return 0},getCentroid:function(){return null},toString:function(){var e;e=OpenLayers.Format&&OpenLayers.Format.WKT?OpenLayers.Format.WKT.prototype.write(new OpenLayers.Feature.Vector(this)):Object.prototype.toString.call(this);return e},CLASS_NAME:"OpenLayers.Geometry"});OpenLayers.Geometry.fromWKT=function(e){var t;if(OpenLayers.Format&&OpenLayers.Format.WKT){var n=OpenLayers.Geometry.fromWKT.format;if(!n){n=new OpenLayers.Format.WKT;OpenLayers.Geometry.fromWKT.format=n}var r=n.read(e);if(r instanceof OpenLayers.Feature.Vector)t=r.geometry;else if(OpenLayers.Util.isArray(r)){for(var i=r.length,a=new Array(i),s=0;i>s;++s)a[s]=r[s].geometry;t=new OpenLayers.Geometry.Collection(a)}}return t};OpenLayers.Geometry.segmentsIntersect=function(e,t,n){var r=n&&n.point,i=n&&n.tolerance,a=!1,s=e.x1-t.x1,o=e.y1-t.y1,l=e.x2-e.x1,c=e.y2-e.y1,u=t.y2-t.y1,h=t.x2-t.x1,p=u*l-h*c,d=h*o-u*s,f=l*o-c*s;if(0==p)0==d&&0==f&&(a=!0);else{var m=d/p,y=f/p;if(m>=0&&1>=m&&y>=0&&1>=y)if(r){var g=e.x1+m*l,v=e.y1+m*c;a=new OpenLayers.Geometry.Point(g,v)}else a=!0}if(i){var C;if(a){if(r){var L,g,v,T=[e,t];e:for(var w=0;2>w;++w){L=T[w];for(var b=1;3>b;++b){g=L["x"+b];v=L["y"+b];C=Math.sqrt(Math.pow(g-a.x,2)+Math.pow(v-a.y,2));if(i>C){a.x=g;a.y=v;break e}}}}}else{var S,E,g,v,O,A,T=[e,t];e:for(var w=0;2>w;++w){S=T[w];E=T[(w+1)%2];for(var b=1;3>b;++b){O={x:S["x"+b],y:S["y"+b]};A=OpenLayers.Geometry.distanceToSegment(O,E);if(A.distance<i){a=r?new OpenLayers.Geometry.Point(O.x,O.y):!0;break e}}}}}return a};OpenLayers.Geometry.distanceToSegment=function(e,t){var n=OpenLayers.Geometry.distanceSquaredToSegment(e,t);n.distance=Math.sqrt(n.distance);return n};OpenLayers.Geometry.distanceSquaredToSegment=function(e,t){var n,r,i=e.x,a=e.y,s=t.x1,o=t.y1,l=t.x2,c=t.y2,u=l-s,h=c-o,p=(u*(i-s)+h*(a-o))/(Math.pow(u,2)+Math.pow(h,2));if(0>=p){n=s;r=o}else if(p>=1){n=l;r=c}else{n=s+p*u;r=o+p*h}return{distance:Math.pow(n-i,2)+Math.pow(r-a,2),x:n,y:r,along:p}};OpenLayers.Geometry.Point=OpenLayers.Class(OpenLayers.Geometry,{x:null,y:null,initialize:function(e,t){OpenLayers.Geometry.prototype.initialize.apply(this,arguments);this.x=parseFloat(e);this.y=parseFloat(t)},clone:function(e){null==e&&(e=new OpenLayers.Geometry.Point(this.x,this.y));OpenLayers.Util.applyDefaults(e,this);return e},calculateBounds:function(){this.bounds=new OpenLayers.Bounds(this.x,this.y,this.x,this.y)},distanceTo:function(e,t){var n,r,i,a,s,o,l=!(t&&t.edge===!1),c=l&&t&&t.details;if(e instanceof OpenLayers.Geometry.Point){r=this.x;i=this.y;a=e.x;s=e.y;n=Math.sqrt(Math.pow(r-a,2)+Math.pow(i-s,2));o=c?{x0:r,y0:i,x1:a,y1:s,distance:n}:n}else{o=e.distanceTo(this,t);c&&(o={x0:o.x1,y0:o.y1,x1:o.x0,y1:o.y0,distance:o.distance})}return o},equals:function(e){var t=!1;null!=e&&(t=this.x==e.x&&this.y==e.y||isNaN(this.x)&&isNaN(this.y)&&isNaN(e.x)&&isNaN(e.y));return t},toShortString:function(){return this.x+", "+this.y},move:function(e,t){this.x=this.x+e;this.y=this.y+t;this.clearBounds()},rotate:function(e,t){e*=Math.PI/180;var n=this.distanceTo(t),r=e+Math.atan2(this.y-t.y,this.x-t.x);this.x=t.x+n*Math.cos(r);this.y=t.y+n*Math.sin(r);this.clearBounds()},getCentroid:function(){return new OpenLayers.Geometry.Point(this.x,this.y)},resize:function(e,t,n){n=void 0==n?1:n;this.x=t.x+e*n*(this.x-t.x);this.y=t.y+e*(this.y-t.y);this.clearBounds();return this},intersects:function(e){var t=!1;t="OpenLayers.Geometry.Point"==e.CLASS_NAME?this.equals(e):e.intersects(this);return t},transform:function(e,t){if(e&&t){OpenLayers.Projection.transform(this,e,t);this.bounds=null}return this},getVertices:function(e){return[this]},CLASS_NAME:"OpenLayers.Geometry.Point"});OpenLayers.Geometry.Collection=OpenLayers.Class(OpenLayers.Geometry,{components:null,componentTypes:null,initialize:function(e){OpenLayers.Geometry.prototype.initialize.apply(this,arguments);this.components=[];null!=e&&this.addComponents(e)},destroy:function(){this.components.length=0;this.components=null;OpenLayers.Geometry.prototype.destroy.apply(this,arguments)},clone:function(){for(var geometry=eval("new "+this.CLASS_NAME+"()"),i=0,len=this.components.length;len>i;i++)geometry.addComponent(this.components[i].clone());OpenLayers.Util.applyDefaults(geometry,this);return geometry},getComponentsString:function(){for(var e=[],t=0,n=this.components.length;n>t;t++)e.push(this.components[t].toShortString());return e.join(",")},calculateBounds:function(){this.bounds=null;var e=new OpenLayers.Bounds,t=this.components;if(t)for(var n=0,r=t.length;r>n;n++)e.extend(t[n].getBounds());null!=e.left&&null!=e.bottom&&null!=e.right&&null!=e.top&&this.setBounds(e)},addComponents:function(e){OpenLayers.Util.isArray(e)||(e=[e]);for(var t=0,n=e.length;n>t;t++)this.addComponent(e[t])},addComponent:function(e,t){var n=!1;if(e&&(null==this.componentTypes||OpenLayers.Util.indexOf(this.componentTypes,e.CLASS_NAME)>-1)){if(null!=t&&t<this.components.length){var r=this.components.slice(0,t),i=this.components.slice(t,this.components.length);r.push(e);this.components=r.concat(i)}else this.components.push(e);e.parent=this;this.clearBounds();n=!0}return n},removeComponents:function(e){var t=!1;OpenLayers.Util.isArray(e)||(e=[e]);for(var n=e.length-1;n>=0;--n)t=this.removeComponent(e[n])||t;return t},removeComponent:function(e){OpenLayers.Util.removeItem(this.components,e);this.clearBounds();return!0},getLength:function(){for(var e=0,t=0,n=this.components.length;n>t;t++)e+=this.components[t].getLength();return e},getArea:function(){for(var e=0,t=0,n=this.components.length;n>t;t++)e+=this.components[t].getArea();return e},getGeodesicArea:function(e){for(var t=0,n=0,r=this.components.length;r>n;n++)t+=this.components[n].getGeodesicArea(e);return t},getCentroid:function(e){if(!e)return this.components.length&&this.components[0].getCentroid();var t=this.components.length;if(!t)return!1;for(var n,r=[],i=[],a=0,s=Number.MAX_VALUE,o=0;t>o;++o){n=this.components[o];var l=n.getArea(),c=n.getCentroid(!0);if(!(isNaN(l)||isNaN(c.x)||isNaN(c.y))){r.push(l);a+=l;s=s>l&&l>0?l:s;i.push(c)}}t=r.length;if(0===a){for(var o=0;t>o;++o)r[o]=1;a=r.length}else{for(var o=0;t>o;++o)r[o]/=s;a/=s}for(var c,l,u=0,h=0,o=0;t>o;++o){c=i[o];l=r[o];u+=c.x*l;h+=c.y*l}return new OpenLayers.Geometry.Point(u/a,h/a)},getGeodesicLength:function(e){for(var t=0,n=0,r=this.components.length;r>n;n++)t+=this.components[n].getGeodesicLength(e);return t},move:function(e,t){for(var n=0,r=this.components.length;r>n;n++)this.components[n].move(e,t)},rotate:function(e,t){for(var n=0,r=this.components.length;r>n;++n)this.components[n].rotate(e,t)},resize:function(e,t,n){for(var r=0;r<this.components.length;++r)this.components[r].resize(e,t,n);return this},distanceTo:function(e,t){for(var n,r,i,a=!(t&&t.edge===!1),s=a&&t&&t.details,o=Number.POSITIVE_INFINITY,l=0,c=this.components.length;c>l;++l){n=this.components[l].distanceTo(e,t);i=s?n.distance:n;if(o>i){o=i;r=n;if(0==o)break}}return r},equals:function(e){var t=!0;if(e&&e.CLASS_NAME&&this.CLASS_NAME==e.CLASS_NAME)if(OpenLayers.Util.isArray(e.components)&&e.components.length==this.components.length){for(var n=0,r=this.components.length;r>n;++n)if(!this.components[n].equals(e.components[n])){t=!1;break}}else t=!1;else t=!1;return t},transform:function(e,t){if(e&&t){for(var n=0,r=this.components.length;r>n;n++){var i=this.components[n];i.transform(e,t)}this.bounds=null}return this},intersects:function(e){for(var t=!1,n=0,r=this.components.length;r>n;++n){t=e.intersects(this.components[n]);if(t)break}return t},getVertices:function(e){for(var t=[],n=0,r=this.components.length;r>n;++n)Array.prototype.push.apply(t,this.components[n].getVertices(e));return t},CLASS_NAME:"OpenLayers.Geometry.Collection"});OpenLayers.Geometry.MultiPoint=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.Point"],addPoint:function(e,t){this.addComponent(e,t)},removePoint:function(e){this.removeComponent(e)},CLASS_NAME:"OpenLayers.Geometry.MultiPoint"});OpenLayers.Geometry.Curve=OpenLayers.Class(OpenLayers.Geometry.MultiPoint,{componentTypes:["OpenLayers.Geometry.Point"],getLength:function(){var e=0;if(this.components&&this.components.length>1)for(var t=1,n=this.components.length;n>t;t++)e+=this.components[t-1].distanceTo(this.components[t]);return e},getGeodesicLength:function(e){var t=this;if(e){var n=new OpenLayers.Projection("EPSG:4326");n.equals(e)||(t=this.clone().transform(e,n))}var r=0;if(t.components&&t.components.length>1)for(var i,a,s=1,o=t.components.length;o>s;s++){i=t.components[s-1];a=t.components[s];r+=OpenLayers.Util.distVincenty({lon:i.x,lat:i.y},{lon:a.x,lat:a.y})}return 1e3*r},CLASS_NAME:"OpenLayers.Geometry.Curve"});OpenLayers.Geometry.LineString=OpenLayers.Class(OpenLayers.Geometry.Curve,{removeComponent:function(e){var t=this.components&&this.components.length>2;t&&OpenLayers.Geometry.Collection.prototype.removeComponent.apply(this,arguments);return t},intersects:function(e){var t=!1,n=e.CLASS_NAME;if("OpenLayers.Geometry.LineString"==n||"OpenLayers.Geometry.LinearRing"==n||"OpenLayers.Geometry.Point"==n){var r,i=this.getSortedSegments();r="OpenLayers.Geometry.Point"==n?[{x1:e.x,y1:e.y,x2:e.x,y2:e.y}]:e.getSortedSegments();var a,s,o,l,c,u,h,p;e:for(var d=0,f=i.length;f>d;++d){a=i[d];s=a.x1;o=a.x2;l=a.y1;c=a.y2;for(var m=0,y=r.length;y>m;++m){u=r[m];if(u.x1>o)break;if(!(u.x2<s)){h=u.y1;p=u.y2;if(!(Math.min(h,p)>Math.max(l,c)||Math.max(h,p)<Math.min(l,c)||!OpenLayers.Geometry.segmentsIntersect(a,u))){t=!0;break e}}}}}else t=e.intersects(this);return t},getSortedSegments:function(){function e(e,t){return e.x1-t.x1}for(var t,n,r=this.components.length-1,i=new Array(r),a=0;r>a;++a){t=this.components[a];n=this.components[a+1];i[a]=t.x<n.x?{x1:t.x,y1:t.y,x2:n.x,y2:n.y}:{x1:n.x,y1:n.y,x2:t.x,y2:t.y}}return i.sort(e)},splitWithSegment:function(e,t){for(var n,r,i,a,s,o=!(t&&t.edge===!1),l=t&&t.tolerance,c=[],u=this.getVertices(),h=[],p=[],d=!1,f={point:!0,tolerance:l},m=null,y=0,g=u.length-2;g>=y;++y){n=u[y];h.push(n.clone());r=u[y+1];s={x1:n.x,y1:n.y,x2:r.x,y2:r.y};i=OpenLayers.Geometry.segmentsIntersect(e,s,f);if(i instanceof OpenLayers.Geometry.Point){a=i.x===e.x1&&i.y===e.y1||i.x===e.x2&&i.y===e.y2||i.equals(n)||i.equals(r)?!0:!1;if(a||o){i.equals(p[p.length-1])||p.push(i.clone());if(0===y&&i.equals(n))continue;if(i.equals(r))continue;d=!0;i.equals(n)||h.push(i);c.push(new OpenLayers.Geometry.LineString(h));h=[i.clone()]}}}if(d){h.push(r.clone());c.push(new OpenLayers.Geometry.LineString(h))}if(p.length>0){var v=e.x1<e.x2?1:-1,C=e.y1<e.y2?1:-1;m={lines:c,points:p.sort(function(e,t){return v*e.x-v*t.x||C*e.y-C*t.y})}}return m},split:function(e,t){var n,r,i,a,s=null,o=t&&t.mutual;if(e instanceof OpenLayers.Geometry.LineString){var l,c,u,h,p,d,f=this.getVertices(),m=[];i=[];for(var y=0,g=f.length-2;g>=y;++y){l=f[y];c=f[y+1];u={x1:l.x,y1:l.y,x2:c.x,y2:c.y};a=a||[e];o&&m.push(l.clone());for(var v=0;v<a.length;++v){h=a[v].splitWithSegment(u,t);if(h){p=h.lines;if(p.length>0){p.unshift(v,1);Array.prototype.splice.apply(a,p);v+=p.length-2}if(o)for(var C=0,L=h.points.length;L>C;++C){d=h.points[C];if(!d.equals(l)){m.push(d);i.push(new OpenLayers.Geometry.LineString(m));m=d.equals(c)?[]:[d.clone()]}}}}}if(o&&i.length>0&&m.length>0){m.push(c.clone());i.push(new OpenLayers.Geometry.LineString(m))}}else s=e.splitWith(this,t);a&&a.length>1?r=!0:a=[];i&&i.length>1?n=!0:i=[];(r||n)&&(s=o?[i,a]:a);return s},splitWith:function(e,t){return e.split(this,t)},getVertices:function(e){var t;t=e===!0?[this.components[0],this.components[this.components.length-1]]:e===!1?this.components.slice(1,this.components.length-1):this.components.slice();return t},distanceTo:function(e,t){var n,r=!(t&&t.edge===!1),i=r&&t&&t.details,a={},s=Number.POSITIVE_INFINITY;if(e instanceof OpenLayers.Geometry.Point){for(var o,l=this.getSortedSegments(),c=e.x,u=e.y,h=0,p=l.length;p>h;++h){o=l[h];n=OpenLayers.Geometry.distanceToSegment(e,o);if(n.distance<s){s=n.distance;a=n;if(0===s)break}else if(o.x2>c&&(u>o.y1&&u<o.y2||u<o.y1&&u>o.y2))break}a=i?{distance:a.distance,x0:a.x,y0:a.y,x1:c,y1:u}:a.distance}else if(e instanceof OpenLayers.Geometry.LineString){var d,f,m,y,g,v=this.getSortedSegments(),C=e.getSortedSegments(),L=C.length,T={point:!0};e:for(var h=0,p=v.length;p>h;++h){d=v[h];y=d.x1;g=d.y1;for(var w=0;L>w;++w){f=C[w];m=OpenLayers.Geometry.segmentsIntersect(d,f,T);if(m){s=0;a={distance:0,x0:m.x,y0:m.y,x1:m.x,y1:m.y};break e}n=OpenLayers.Geometry.distanceToSegment({x:y,y:g},f);if(n.distance<s){s=n.distance;a={distance:s,x0:y,y0:g,x1:n.x,y1:n.y}}}}i||(a=a.distance);if(0!==s&&d){n=e.distanceTo(new OpenLayers.Geometry.Point(d.x2,d.y2),t);var b=i?n.distance:n;s>b&&(a=i?{distance:s,x0:n.x1,y0:n.y1,x1:n.x0,y1:n.y0}:b)}}else{a=e.distanceTo(this,t);i&&(a={distance:a.distance,x0:a.x1,y0:a.y1,x1:a.x0,y1:a.y0})}return a},simplify:function(e){if(this&&null!==this){var t=this.getVertices();if(t.length<3)return this;var n=function(e,t){return e-t},r=function(e,t,n,a){for(var s,l=0,c=0,u=t;n>u;u++){s=i(e[t],e[n],e[u]);if(s>l){l=s;c=u}}if(l>a&&c!=t){o.push(c);r(e,t,c,a);r(e,c,n,a)}},i=function(e,t,n){var r=Math.abs(.5*(e.x*t.y+t.x*n.y+n.x*e.y-t.x*e.y-n.x*t.y-e.x*n.y)),i=Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)),a=r/i*2;return a},a=0,s=t.length-1,o=[];o.push(a);o.push(s);for(;t[a].equals(t[s]);){s--;o.push(s)}r(t,a,s,e);var l=[];o.sort(n);for(var c=0;c<o.length;c++)l.push(t[o[c]]);return new OpenLayers.Geometry.LineString(l)}return this},CLASS_NAME:"OpenLayers.Geometry.LineString"});OpenLayers.Geometry.MultiLineString=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.LineString"],split:function(e,t){for(var n,r,i,a,s,o=null,l=t&&t.mutual,c=[],u=[e],h=0,p=this.components.length;p>h;++h){r=this.components[h];a=!1;for(var d=0;d<u.length;++d){n=r.split(u[d],t);if(n){if(l){i=n[0];for(var f=0,m=i.length;m>f;++f)0===f&&c.length?c[c.length-1].addComponent(i[f]):c.push(new OpenLayers.Geometry.MultiLineString([i[f]]));a=!0;n=n[1]}if(n.length){n.unshift(d,1);Array.prototype.splice.apply(u,n);break}}}a||(c.length?c[c.length-1].addComponent(r.clone()):c=[new OpenLayers.Geometry.MultiLineString(r.clone())])}c&&c.length>1?a=!0:c=[];u&&u.length>1?s=!0:u=[];(a||s)&&(o=l?[c,u]:u);return o},splitWith:function(e,t){var n,r,i,a,s,o,l,c=null,u=t&&t.mutual;if(e instanceof OpenLayers.Geometry.LineString){l=[];o=[e];for(var h=0,p=this.components.length;p>h;++h){s=!1;r=this.components[h];for(var d=0;d<o.length;++d){n=o[d].split(r,t);if(n){if(u){i=n[0];if(i.length){i.unshift(d,1);Array.prototype.splice.apply(o,i);d+=i.length-2}n=n[1];0===n.length&&(n=[r.clone()])}for(var f=0,m=n.length;m>f;++f)0===f&&l.length?l[l.length-1].addComponent(n[f]):l.push(new OpenLayers.Geometry.MultiLineString([n[f]]));s=!0}}s||(l.length?l[l.length-1].addComponent(r.clone()):l=[new OpenLayers.Geometry.MultiLineString([r.clone()])])}}else c=e.split(this);o&&o.length>1?a=!0:o=[];l&&l.length>1?s=!0:l=[];(a||s)&&(c=u?[o,l]:l);return c},CLASS_NAME:"OpenLayers.Geometry.MultiLineString"});OpenLayers.Geometry.LinearRing=OpenLayers.Class(OpenLayers.Geometry.LineString,{componentTypes:["OpenLayers.Geometry.Point"],addComponent:function(e,t){var n=!1,r=this.components.pop();null==t&&e.equals(r)||(n=OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,arguments));var i=this.components[0];OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,[i]);return n},removeComponent:function(e){var t=this.components&&this.components.length>3;if(t){this.components.pop();OpenLayers.Geometry.Collection.prototype.removeComponent.apply(this,arguments);var n=this.components[0];OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,[n])}return t},move:function(e,t){for(var n=0,r=this.components.length;r-1>n;n++)this.components[n].move(e,t)},rotate:function(e,t){for(var n=0,r=this.components.length;r-1>n;++n)this.components[n].rotate(e,t)},resize:function(e,t,n){for(var r=0,i=this.components.length;i-1>r;++r)this.components[r].resize(e,t,n);return this},transform:function(e,t){if(e&&t){for(var n=0,r=this.components.length;r-1>n;n++){var i=this.components[n];i.transform(e,t)}this.bounds=null}return this},getCentroid:function(){if(this.components){var e=this.components.length;if(e>0&&2>=e)return this.components[0].clone();if(e>2){var t=0,n=0,r=this.components[0].x,i=this.components[0].y,a=-1*this.getArea();if(0!=a){for(var s=0;e-1>s;s++){var o=this.components[s],l=this.components[s+1];t+=(o.x+l.x-2*r)*((o.x-r)*(l.y-i)-(l.x-r)*(o.y-i));n+=(o.y+l.y-2*i)*((o.x-r)*(l.y-i)-(l.x-r)*(o.y-i))}var c=r+t/(6*a),u=i+n/(6*a)}else{for(var s=0;e-1>s;s++){t+=this.components[s].x;n+=this.components[s].y}var c=t/(e-1),u=n/(e-1)}return new OpenLayers.Geometry.Point(c,u)}return null}},getArea:function(){var e=0;if(this.components&&this.components.length>2){for(var t=0,n=0,r=this.components.length;r-1>n;n++){var i=this.components[n],a=this.components[n+1];t+=(i.x+a.x)*(a.y-i.y)}e=-t/2}return e},getGeodesicArea:function(e){var t=this;if(e){var n=new OpenLayers.Projection("EPSG:4326");n.equals(e)||(t=this.clone().transform(e,n))}var r=0,i=t.components&&t.components.length;if(i>2){for(var a,s,o=0;i-1>o;o++){a=t.components[o];s=t.components[o+1];r+=OpenLayers.Util.rad(s.x-a.x)*(2+Math.sin(OpenLayers.Util.rad(a.y))+Math.sin(OpenLayers.Util.rad(s.y)))}r=6378137*r*6378137/2}return r},containsPoint:function(e){function t(e,t,n,r,i){return(e-i)*((r-t)/(i-n))+r}for(var n,r,i,a,s,o,l,c=OpenLayers.Number.limitSigDigs,u=14,h=c(e.x,u),p=c(e.y,u),d=this.components.length-1,f=0,m=0;d>m;++m){n=this.components[m];i=c(n.x,u);a=c(n.y,u);r=this.components[m+1];s=c(r.x,u);o=c(r.y,u);if(a!=o){l=c(t(p,i,a,s,o),u);if(l==h&&(o>a&&p>=a&&o>=p||a>o&&a>=p&&p>=o)){f=-1;break}h>=l||i!=s&&(l<Math.min(i,s)||l>Math.max(i,s))||(o>a&&p>=a&&o>p||a>o&&a>p&&p>=o)&&++f}else if(p==a&&(s>=i&&h>=i&&s>=h||i>=s&&i>=h&&h>=s)){f=-1;break}}var y=-1==f?1:!!(1&f);return y},intersects:function(e){var t=!1;if("OpenLayers.Geometry.Point"==e.CLASS_NAME)t=this.containsPoint(e);else if("OpenLayers.Geometry.LineString"==e.CLASS_NAME)t=e.intersects(this);else if("OpenLayers.Geometry.LinearRing"==e.CLASS_NAME)t=OpenLayers.Geometry.LineString.prototype.intersects.apply(this,[e]);else for(var n=0,r=e.components.length;r>n;++n){t=e.components[n].intersects(this);if(t)break}return t},getVertices:function(e){return e===!0?[]:this.components.slice(0,this.components.length-1)},CLASS_NAME:"OpenLayers.Geometry.LinearRing"});OpenLayers.Geometry.Polygon=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.LinearRing"],getArea:function(){var e=0;if(this.components&&this.components.length>0){e+=Math.abs(this.components[0].getArea());for(var t=1,n=this.components.length;n>t;t++)e-=Math.abs(this.components[t].getArea())}return e},getGeodesicArea:function(e){var t=0;if(this.components&&this.components.length>0){t+=Math.abs(this.components[0].getGeodesicArea(e));for(var n=1,r=this.components.length;r>n;n++)t-=Math.abs(this.components[n].getGeodesicArea(e))}return t},containsPoint:function(e){var t=this.components.length,n=!1;if(t>0){n=this.components[0].containsPoint(e);if(1!==n&&n&&t>1)for(var r,i=1;t>i;++i){r=this.components[i].containsPoint(e);if(r){n=1===r?1:!1;break}}}return n},intersects:function(e){var t,n,r=!1;if("OpenLayers.Geometry.Point"==e.CLASS_NAME)r=this.containsPoint(e);else if("OpenLayers.Geometry.LineString"==e.CLASS_NAME||"OpenLayers.Geometry.LinearRing"==e.CLASS_NAME){for(t=0,n=this.components.length;n>t;++t){r=e.intersects(this.components[t]);if(r)break}if(!r)for(t=0,n=e.components.length;n>t;++t){r=this.containsPoint(e.components[t]);if(r)break}}else for(t=0,n=e.components.length;n>t;++t){r=this.intersects(e.components[t]);if(r)break}if(!r&&"OpenLayers.Geometry.Polygon"==e.CLASS_NAME){var i=this.components[0];for(t=0,n=i.components.length;n>t;++t){r=e.containsPoint(i.components[t]);if(r)break}}return r},distanceTo:function(e,t){var n,r=!(t&&t.edge===!1);n=!r&&this.intersects(e)?0:OpenLayers.Geometry.Collection.prototype.distanceTo.apply(this,[e,t]);return n},CLASS_NAME:"OpenLayers.Geometry.Polygon"});OpenLayers.Geometry.Polygon.createRegularPolygon=function(e,t,n,r){var i=Math.PI*(1/n-.5);r&&(i+=r/180*Math.PI);for(var a,s,o,l=[],c=0;n>c;++c){a=i+2*c*Math.PI/n;s=e.x+t*Math.cos(a);o=e.y+t*Math.sin(a);l.push(new OpenLayers.Geometry.Point(s,o))}var u=new OpenLayers.Geometry.LinearRing(l);return new OpenLayers.Geometry.Polygon([u])};OpenLayers.Geometry.MultiPolygon=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.Polygon"],CLASS_NAME:"OpenLayers.Geometry.MultiPolygon"});OpenLayers.Format.GML=OpenLayers.Class(OpenLayers.Format.XML,{featureNS:"http://mapserver.gis.umn.edu/mapserver",featurePrefix:"feature",featureName:"featureMember",layerName:"features",geometryName:"geometry",collectionName:"FeatureCollection",gmlns:"http://www.opengis.net/gml",extractAttributes:!0,xy:!0,initialize:function(e){this.regExes={trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g};OpenLayers.Format.XML.prototype.initialize.apply(this,[e])},read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));for(var t=this.getElementsByTagNameNS(e.documentElement,this.gmlns,this.featureName),n=[],r=0;r<t.length;r++){var i=this.parseFeature(t[r]);i&&n.push(i)}return n},parseFeature:function(e){for(var t,n,r,i,a=["MultiPolygon","Polygon","MultiLineString","LineString","MultiPoint","Point","Envelope"],s=0;s<a.length;++s){t=a[s];n=this.getElementsByTagNameNS(e,this.gmlns,t);if(n.length>0){i=this.parseGeometry[t.toLowerCase()];if(!i)throw new TypeError("Unsupported geometry type: "+t);r=i.apply(this,[n[0]]);this.internalProjection&&this.externalProjection&&r.transform(this.externalProjection,this.internalProjection);break}}var o,l=this.getElementsByTagNameNS(e,this.gmlns,"Box");for(s=0;s<l.length;++s){var c=l[s],u=this.parseGeometry.box.apply(this,[c]),h=c.parentNode,p=h.localName||h.nodeName.split(":").pop();"boundedBy"===p?o=u:r=u.toGeometry()}var d;this.extractAttributes&&(d=this.parseAttributes(e));var f=new OpenLayers.Feature.Vector(r,d);f.bounds=o;f.gml={featureType:e.firstChild.nodeName.split(":")[1],featureNS:e.firstChild.namespaceURI,featureNSPrefix:e.firstChild.prefix};for(var m,y=e.firstChild;y;){if(1==y.nodeType){m=y.getAttribute("fid")||y.getAttribute("id");if(m)break}y=y.nextSibling}f.fid=m;return f},parseGeometry:{point:function(e){var t,n,r=[],t=this.getElementsByTagNameNS(e,this.gmlns,"pos");

if(t.length>0){n=t[0].firstChild.nodeValue;n=n.replace(this.regExes.trimSpace,"");r=n.split(this.regExes.splitSpace)}if(0==r.length){t=this.getElementsByTagNameNS(e,this.gmlns,"coordinates");if(t.length>0){n=t[0].firstChild.nodeValue;n=n.replace(this.regExes.removeSpace,"");r=n.split(",")}}if(0==r.length){t=this.getElementsByTagNameNS(e,this.gmlns,"coord");if(t.length>0){var i=this.getElementsByTagNameNS(t[0],this.gmlns,"X"),a=this.getElementsByTagNameNS(t[0],this.gmlns,"Y");i.length>0&&a.length>0&&(r=[i[0].firstChild.nodeValue,a[0].firstChild.nodeValue])}}2==r.length&&(r[2]=null);return this.xy?new OpenLayers.Geometry.Point(r[0],r[1],r[2]):new OpenLayers.Geometry.Point(r[1],r[0],r[2])},multipoint:function(e){var t=this.getElementsByTagNameNS(e,this.gmlns,"Point"),n=[];if(t.length>0)for(var r,i=0;i<t.length;++i){r=this.parseGeometry.point.apply(this,[t[i]]);r&&n.push(r)}return new OpenLayers.Geometry.MultiPoint(n)},linestring:function(e,t){var n,r,i=[],a=[];n=this.getElementsByTagNameNS(e,this.gmlns,"posList");if(n.length>0){r=this.getChildValue(n[0]);r=r.replace(this.regExes.trimSpace,"");i=r.split(this.regExes.splitSpace);for(var s,o,l,c,u=parseInt(n[0].getAttribute("dimension")),h=0;h<i.length/u;++h){s=h*u;o=i[s];l=i[s+1];c=2==u?null:i[s+2];a.push(this.xy?new OpenLayers.Geometry.Point(o,l,c):new OpenLayers.Geometry.Point(l,o,c))}}if(0==i.length){n=this.getElementsByTagNameNS(e,this.gmlns,"coordinates");if(n.length>0){r=this.getChildValue(n[0]);r=r.replace(this.regExes.trimSpace,"");r=r.replace(this.regExes.trimComma,",");for(var p=r.split(this.regExes.splitSpace),h=0;h<p.length;++h){i=p[h].split(",");2==i.length&&(i[2]=null);a.push(this.xy?new OpenLayers.Geometry.Point(i[0],i[1],i[2]):new OpenLayers.Geometry.Point(i[1],i[0],i[2]))}}}var d=null;0!=a.length&&(d=t?new OpenLayers.Geometry.LinearRing(a):new OpenLayers.Geometry.LineString(a));return d},multilinestring:function(e){var t=this.getElementsByTagNameNS(e,this.gmlns,"LineString"),n=[];if(t.length>0)for(var r,i=0;i<t.length;++i){r=this.parseGeometry.linestring.apply(this,[t[i]]);r&&n.push(r)}return new OpenLayers.Geometry.MultiLineString(n)},polygon:function(e){var t=this.getElementsByTagNameNS(e,this.gmlns,"LinearRing"),n=[];if(t.length>0)for(var r,i=0;i<t.length;++i){r=this.parseGeometry.linestring.apply(this,[t[i],!0]);r&&n.push(r)}return new OpenLayers.Geometry.Polygon(n)},multipolygon:function(e){var t=this.getElementsByTagNameNS(e,this.gmlns,"Polygon"),n=[];if(t.length>0)for(var r,i=0;i<t.length;++i){r=this.parseGeometry.polygon.apply(this,[t[i]]);r&&n.push(r)}return new OpenLayers.Geometry.MultiPolygon(n)},envelope:function(e){var t,n,r=[],i=this.getElementsByTagNameNS(e,this.gmlns,"lowerCorner");if(i.length>0){var a=[];if(i.length>0){t=i[0].firstChild.nodeValue;t=t.replace(this.regExes.trimSpace,"");a=t.split(this.regExes.splitSpace)}2==a.length&&(a[2]=null);if(this.xy)var s=new OpenLayers.Geometry.Point(a[0],a[1],a[2]);else var s=new OpenLayers.Geometry.Point(a[1],a[0],a[2])}var o=this.getElementsByTagNameNS(e,this.gmlns,"upperCorner");if(o.length>0){var a=[];if(o.length>0){t=o[0].firstChild.nodeValue;t=t.replace(this.regExes.trimSpace,"");a=t.split(this.regExes.splitSpace)}2==a.length&&(a[2]=null);if(this.xy)var l=new OpenLayers.Geometry.Point(a[0],a[1],a[2]);else var l=new OpenLayers.Geometry.Point(a[1],a[0],a[2])}if(s&&l){r.push(new OpenLayers.Geometry.Point(s.x,s.y));r.push(new OpenLayers.Geometry.Point(l.x,s.y));r.push(new OpenLayers.Geometry.Point(l.x,l.y));r.push(new OpenLayers.Geometry.Point(s.x,l.y));r.push(new OpenLayers.Geometry.Point(s.x,s.y));var c=new OpenLayers.Geometry.LinearRing(r);n=new OpenLayers.Geometry.Polygon([c])}return n},box:function(e){var t,n,r=this.getElementsByTagNameNS(e,this.gmlns,"coordinates"),i=null,a=null;if(r.length>0){t=r[0].firstChild.nodeValue;n=t.split(" ");if(2==n.length){i=n[0].split(",");a=n[1].split(",")}}return null!==i&&null!==a?new OpenLayers.Bounds(parseFloat(i[0]),parseFloat(i[1]),parseFloat(a[0]),parseFloat(a[1])):void 0}},parseAttributes:function(e){for(var t,n,r,i,a,s,o,l={},c=e.firstChild;c;){if(1==c.nodeType){t=c.childNodes;for(n=0;n<t.length;++n){r=t[n];if(1==r.nodeType){i=r.childNodes;if(1==i.length){a=i[0];if(3==a.nodeType||4==a.nodeType){s=r.prefix?r.nodeName.split(":")[1]:r.nodeName;o=a.nodeValue.replace(this.regExes.trimSpace,"");l[s]=o}}else l[r.nodeName.split(":").pop()]=null}}break}c=c.nextSibling}return l},write:function(e){OpenLayers.Util.isArray(e)||(e=[e]);for(var t=this.createElementNS("http://www.opengis.net/wfs","wfs:"+this.collectionName),n=0;n<e.length;n++)t.appendChild(this.createFeatureXML(e[n]));return OpenLayers.Format.XML.prototype.write.apply(this,[t])},createFeatureXML:function(e){var t=e.geometry,n=this.buildGeometryNode(t),r=this.createElementNS(this.featureNS,this.featurePrefix+":"+this.geometryName);r.appendChild(n);var i=this.createElementNS(this.gmlns,"gml:"+this.featureName),a=this.createElementNS(this.featureNS,this.featurePrefix+":"+this.layerName),s=e.fid||e.id;a.setAttribute("fid",s);a.appendChild(r);for(var o in e.attributes){var l=this.createTextNode(e.attributes[o]),c=o.substring(o.lastIndexOf(":")+1),u=this.createElementNS(this.featureNS,this.featurePrefix+":"+c);u.appendChild(l);a.appendChild(u)}i.appendChild(a);return i},buildGeometryNode:function(e){if(this.externalProjection&&this.internalProjection){e=e.clone();e.transform(this.internalProjection,this.externalProjection)}var t=e.CLASS_NAME,n=t.substring(t.lastIndexOf(".")+1),r=this.buildGeometry[n.toLowerCase()];return r.apply(this,[e])},buildGeometry:{point:function(e){var t=this.createElementNS(this.gmlns,"gml:Point");t.appendChild(this.buildCoordinatesNode(e));return t},multipoint:function(e){for(var t,n,r=this.createElementNS(this.gmlns,"gml:MultiPoint"),i=e.components,a=0;a<i.length;a++){t=this.createElementNS(this.gmlns,"gml:pointMember");n=this.buildGeometry.point.apply(this,[i[a]]);t.appendChild(n);r.appendChild(t)}return r},linestring:function(e){var t=this.createElementNS(this.gmlns,"gml:LineString");t.appendChild(this.buildCoordinatesNode(e));return t},multilinestring:function(e){for(var t,n,r=this.createElementNS(this.gmlns,"gml:MultiLineString"),i=e.components,a=0;a<i.length;++a){t=this.createElementNS(this.gmlns,"gml:lineStringMember");n=this.buildGeometry.linestring.apply(this,[i[a]]);t.appendChild(n);r.appendChild(t)}return r},linearring:function(e){var t=this.createElementNS(this.gmlns,"gml:LinearRing");t.appendChild(this.buildCoordinatesNode(e));return t},polygon:function(e){for(var t,n,r,i=this.createElementNS(this.gmlns,"gml:Polygon"),a=e.components,s=0;s<a.length;++s){r=0==s?"outerBoundaryIs":"innerBoundaryIs";t=this.createElementNS(this.gmlns,"gml:"+r);n=this.buildGeometry.linearring.apply(this,[a[s]]);t.appendChild(n);i.appendChild(t)}return i},multipolygon:function(e){for(var t,n,r=this.createElementNS(this.gmlns,"gml:MultiPolygon"),i=e.components,a=0;a<i.length;++a){t=this.createElementNS(this.gmlns,"gml:polygonMember");n=this.buildGeometry.polygon.apply(this,[i[a]]);t.appendChild(n);r.appendChild(t)}return r},bounds:function(e){var t=this.createElementNS(this.gmlns,"gml:Box");t.appendChild(this.buildCoordinatesNode(e));return t}},buildCoordinatesNode:function(e){var t=this.createElementNS(this.gmlns,"gml:coordinates");t.setAttribute("decimal",".");t.setAttribute("cs",",");t.setAttribute("ts"," ");var n=[];if(e instanceof OpenLayers.Bounds){n.push(e.left+","+e.bottom);n.push(e.right+","+e.top)}else for(var r=e.components?e.components:[e],i=0;i<r.length;i++)n.push(r[i].x+","+r[i].y);var a=this.createTextNode(n.join(" "));t.appendChild(a);return t},CLASS_NAME:"OpenLayers.Format.GML"});OpenLayers.Format.GML||(OpenLayers.Format.GML={});OpenLayers.Format.GML.Base=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",wfs:"http://www.opengis.net/wfs"},defaultPrefix:"gml",schemaLocation:null,featureType:null,featureNS:null,geometryName:"geometry",extractAttributes:!0,srsName:null,xy:!0,geometryTypes:null,singleFeatureType:null,regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g,featureMember:/^(.*:)?featureMembers?$/},initialize:function(e){OpenLayers.Format.XML.prototype.initialize.apply(this,[e]);this.setGeometryTypes();e&&e.featureNS&&this.setNamespace("feature",e.featureNS);this.singleFeatureType=!e||"string"==typeof e.featureType},read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));e&&9==e.nodeType&&(e=e.documentElement);var t=[];this.readNode(e,{features:t},!0);if(0==t.length){var n=this.getElementsByTagNameNS(e,this.namespaces.gml,"featureMember");if(n.length)for(var r=0,i=n.length;i>r;++r)this.readNode(n[r],{features:t},!0);else{var n=this.getElementsByTagNameNS(e,this.namespaces.gml,"featureMembers");n.length&&this.readNode(n[0],{features:t},!0)}}return t},readNode:function(e,t,n){if(n===!0&&this.autoConfig===!0){this.featureType=null;delete this.namespaceAlias[this.featureNS];delete this.namespaces.feature;this.featureNS=null}if(!this.featureNS&&!(e.prefix in this.namespaces)&&e.parentNode.namespaceURI==this.namespaces.gml&&this.regExes.featureMember.test(e.parentNode.nodeName)){this.featureType=e.nodeName.split(":").pop();this.setNamespace("feature",e.namespaceURI);this.featureNS=e.namespaceURI;this.autoConfig=!0}return OpenLayers.Format.XML.prototype.readNode.apply(this,[e,t])},readers:{gml:{_inherit:function(e,t,n){},featureMember:function(e,t){this.readChildNodes(e,t)},featureMembers:function(e,t){this.readChildNodes(e,t)},name:function(e,t){t.name=this.getChildValue(e)},boundedBy:function(e,t){var n={};this.readChildNodes(e,n);n.components&&n.components.length>0&&(t.bounds=n.components[0])},Point:function(e,t){var n={points:[]};this.readChildNodes(e,n);t.components||(t.components=[]);t.components.push(n.points[0])},coordinates:function(e,t){var n=this.getChildValue(e).replace(this.regExes.trimSpace,"");n=n.replace(this.regExes.trimComma,",");for(var r,i=n.split(this.regExes.splitSpace),a=i.length,s=new Array(a),o=0;a>o;++o){r=i[o].split(",");s[o]=this.xy?new OpenLayers.Geometry.Point(r[0],r[1],r[2]):new OpenLayers.Geometry.Point(r[1],r[0],r[2])}t.points=s},coord:function(e,t){var n={};this.readChildNodes(e,n);t.points||(t.points=[]);t.points.push(new OpenLayers.Geometry.Point(n.x,n.y,n.z))},X:function(e,t){t.x=this.getChildValue(e)},Y:function(e,t){t.y=this.getChildValue(e)},Z:function(e,t){t.z=this.getChildValue(e)},MultiPoint:function(e,t){var n={components:[]};this.readers.gml._inherit.apply(this,[e,n,t]);this.readChildNodes(e,n);t.components=[new OpenLayers.Geometry.MultiPoint(n.components)]},pointMember:function(e,t){this.readChildNodes(e,t)},LineString:function(e,t){var n={};this.readers.gml._inherit.apply(this,[e,n,t]);this.readChildNodes(e,n);t.components||(t.components=[]);t.components.push(new OpenLayers.Geometry.LineString(n.points))},MultiLineString:function(e,t){var n={components:[]};this.readers.gml._inherit.apply(this,[e,n,t]);this.readChildNodes(e,n);t.components=[new OpenLayers.Geometry.MultiLineString(n.components)]},lineStringMember:function(e,t){this.readChildNodes(e,t)},Polygon:function(e,t){var n={outer:null,inner:[]};this.readers.gml._inherit.apply(this,[e,n,t]);this.readChildNodes(e,n);n.inner.unshift(n.outer);t.components||(t.components=[]);t.components.push(new OpenLayers.Geometry.Polygon(n.inner))},LinearRing:function(e,t){var n={};this.readers.gml._inherit.apply(this,[e,n]);this.readChildNodes(e,n);t.components=[new OpenLayers.Geometry.LinearRing(n.points)]},MultiPolygon:function(e,t){var n={components:[]};this.readers.gml._inherit.apply(this,[e,n,t]);this.readChildNodes(e,n);t.components=[new OpenLayers.Geometry.MultiPolygon(n.components)]},polygonMember:function(e,t){this.readChildNodes(e,t)},GeometryCollection:function(e,t){var n={components:[]};this.readers.gml._inherit.apply(this,[e,n,t]);this.readChildNodes(e,n);t.components=[new OpenLayers.Geometry.Collection(n.components)]},geometryMember:function(e,t){this.readChildNodes(e,t)}},feature:{"*":function(e,t){var n,r=e.localName||e.nodeName.split(":").pop();t.features?this.singleFeatureType||-1===OpenLayers.Util.indexOf(this.featureType,r)?r===this.featureType&&(n="_typeName"):n="_typeName":0==e.childNodes.length||1==e.childNodes.length&&3==e.firstChild.nodeType?this.extractAttributes&&(n="_attribute"):n="_geometry";n&&this.readers.feature[n].apply(this,[e,t])},_typeName:function(e,t){var n={components:[],attributes:{}};this.readChildNodes(e,n);n.name&&(n.attributes.name=n.name);var r=new OpenLayers.Feature.Vector(n.components[0],n.attributes);if(!this.singleFeatureType){r.type=e.nodeName.split(":").pop();r.namespace=e.namespaceURI}var i=e.getAttribute("fid")||this.getAttributeNS(e,this.namespaces.gml,"id");i&&(r.fid=i);this.internalProjection&&this.externalProjection&&r.geometry&&r.geometry.transform(this.externalProjection,this.internalProjection);n.bounds&&(r.bounds=n.bounds);t.features.push(r)},_geometry:function(e,t){this.geometryName||(this.geometryName=e.nodeName.split(":").pop());this.readChildNodes(e,t)},_attribute:function(e,t){var n=e.localName||e.nodeName.split(":").pop(),r=this.getChildValue(e);t.attributes[n]=r}},wfs:{FeatureCollection:function(e,t){this.readChildNodes(e,t)}}},write:function(e){var t;t=OpenLayers.Util.isArray(e)?"featureMembers":"featureMember";var n=this.writeNode("gml:"+t,e);this.setAttributeNS(n,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);return OpenLayers.Format.XML.prototype.write.apply(this,[n])},writers:{gml:{featureMember:function(e){var t=this.createElementNSPlus("gml:featureMember");this.writeNode("feature:_typeName",e,t);return t},MultiPoint:function(e){for(var t=this.createElementNSPlus("gml:MultiPoint"),n=e.components||[e],r=0,i=n.length;i>r;++r)this.writeNode("pointMember",n[r],t);return t},pointMember:function(e){var t=this.createElementNSPlus("gml:pointMember");this.writeNode("Point",e,t);return t},MultiLineString:function(e){for(var t=this.createElementNSPlus("gml:MultiLineString"),n=e.components||[e],r=0,i=n.length;i>r;++r)this.writeNode("lineStringMember",n[r],t);return t},lineStringMember:function(e){var t=this.createElementNSPlus("gml:lineStringMember");this.writeNode("LineString",e,t);return t},MultiPolygon:function(e){for(var t=this.createElementNSPlus("gml:MultiPolygon"),n=e.components||[e],r=0,i=n.length;i>r;++r)this.writeNode("polygonMember",n[r],t);return t},polygonMember:function(e){var t=this.createElementNSPlus("gml:polygonMember");this.writeNode("Polygon",e,t);return t},GeometryCollection:function(e){for(var t=this.createElementNSPlus("gml:GeometryCollection"),n=0,r=e.components.length;r>n;++n)this.writeNode("geometryMember",e.components[n],t);return t},geometryMember:function(e){var t=this.createElementNSPlus("gml:geometryMember"),n=this.writeNode("feature:_geometry",e);t.appendChild(n.firstChild);return t}},feature:{_typeName:function(e){var t=this.createElementNSPlus("feature:"+this.featureType,{attributes:{fid:e.fid}});e.geometry&&this.writeNode("feature:_geometry",e.geometry,t);for(var n in e.attributes){var r=e.attributes[n];null!=r&&this.writeNode("feature:_attribute",{name:n,value:r},t)}return t},_geometry:function(e){this.externalProjection&&this.internalProjection&&(e=e.clone().transform(this.internalProjection,this.externalProjection));var t=this.createElementNSPlus("feature:"+this.geometryName),n=this.geometryTypes[e.CLASS_NAME],r=this.writeNode("gml:"+n,e,t);this.srsName&&r.setAttribute("srsName",this.srsName);return t},_attribute:function(e){return this.createElementNSPlus("feature:"+e.name,{value:e.value})}},wfs:{FeatureCollection:function(e){for(var t=this.createElementNSPlus("wfs:FeatureCollection"),n=0,r=e.length;r>n;++n)this.writeNode("gml:featureMember",e[n],t);return t}}},setGeometryTypes:function(){this.geometryTypes={"OpenLayers.Geometry.Point":"Point","OpenLayers.Geometry.MultiPoint":"MultiPoint","OpenLayers.Geometry.LineString":"LineString","OpenLayers.Geometry.MultiLineString":"MultiLineString","OpenLayers.Geometry.Polygon":"Polygon","OpenLayers.Geometry.MultiPolygon":"MultiPolygon","OpenLayers.Geometry.Collection":"GeometryCollection"}},CLASS_NAME:"OpenLayers.Format.GML.Base"});OpenLayers.Format.GML.v3=OpenLayers.Class(OpenLayers.Format.GML.Base,{schemaLocation:"http://www.opengis.net/gml http://schemas.opengis.net/gml/3.1.1/profiles/gmlsfProfile/1.0.0/gmlsf.xsd",curve:!1,multiCurve:!0,surface:!1,multiSurface:!0,initialize:function(e){OpenLayers.Format.GML.Base.prototype.initialize.apply(this,[e])},readers:{gml:OpenLayers.Util.applyDefaults({_inherit:function(e,t,n){var r=parseInt(e.getAttribute("srsDimension"),10)||n&&n.srsDimension;r&&(t.srsDimension=r)},featureMembers:function(e,t){this.readChildNodes(e,t)},Curve:function(e,t){var n={points:[]};this.readers.gml._inherit.apply(this,[e,n,t]);this.readChildNodes(e,n);t.components||(t.components=[]);t.components.push(new OpenLayers.Geometry.LineString(n.points))},segments:function(e,t){this.readChildNodes(e,t)},LineStringSegment:function(e,t){var n={};this.readChildNodes(e,n);n.points&&Array.prototype.push.apply(t.points,n.points)},pos:function(e,t){var n,r=this.getChildValue(e).replace(this.regExes.trimSpace,""),i=r.split(this.regExes.splitSpace);n=this.xy?new OpenLayers.Geometry.Point(i[0],i[1],i[2]):new OpenLayers.Geometry.Point(i[1],i[0],i[2]);t.points=[n]},posList:function(e,t){for(var n,r,i,a=this.getChildValue(e).replace(this.regExes.trimSpace,""),s=a.split(this.regExes.splitSpace),o=t.srsDimension||parseInt(e.getAttribute("srsDimension")||e.getAttribute("dimension"),10)||2,l=s.length/o,c=new Array(l),u=0,h=s.length;h>u;u+=o){n=s[u];r=s[u+1];i=2==o?void 0:s[u+2];c[u/o]=this.xy?new OpenLayers.Geometry.Point(n,r,i):new OpenLayers.Geometry.Point(r,n,i)}t.points=c},Surface:function(e,t){this.readChildNodes(e,t)},patches:function(e,t){this.readChildNodes(e,t)},PolygonPatch:function(e,t){this.readers.gml.Polygon.apply(this,[e,t])},exterior:function(e,t){var n={};this.readChildNodes(e,n);t.outer=n.components[0]},interior:function(e,t){var n={};this.readChildNodes(e,n);t.inner.push(n.components[0])},MultiCurve:function(e,t){var n={components:[]};this.readers.gml._inherit.apply(this,[e,n,t]);this.readChildNodes(e,n);n.components.length>0&&(t.components=[new OpenLayers.Geometry.MultiLineString(n.components)])},curveMember:function(e,t){this.readChildNodes(e,t)},MultiSurface:function(e,t){var n={components:[]};this.readers.gml._inherit.apply(this,[e,n,t]);this.readChildNodes(e,n);n.components.length>0&&(t.components=[new OpenLayers.Geometry.MultiPolygon(n.components)])},surfaceMember:function(e,t){this.readChildNodes(e,t)},surfaceMembers:function(e,t){this.readChildNodes(e,t)},pointMembers:function(e,t){this.readChildNodes(e,t)},lineStringMembers:function(e,t){this.readChildNodes(e,t)},polygonMembers:function(e,t){this.readChildNodes(e,t)},geometryMembers:function(e,t){this.readChildNodes(e,t)},Envelope:function(e,t){var n={points:new Array(2)};this.readChildNodes(e,n);t.components||(t.components=[]);var r=n.points[0],i=n.points[1];t.components.push(new OpenLayers.Bounds(r.x,r.y,i.x,i.y))},lowerCorner:function(e,t){var n={};this.readers.gml.pos.apply(this,[e,n]);t.points[0]=n.points[0]},upperCorner:function(e,t){var n={};this.readers.gml.pos.apply(this,[e,n]);t.points[1]=n.points[0]}},OpenLayers.Format.GML.Base.prototype.readers.gml),feature:OpenLayers.Format.GML.Base.prototype.readers.feature,wfs:OpenLayers.Format.GML.Base.prototype.readers.wfs},write:function(e){var t;t=OpenLayers.Util.isArray(e)?"featureMembers":"featureMember";var n=this.writeNode("gml:"+t,e);this.setAttributeNS(n,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);return OpenLayers.Format.XML.prototype.write.apply(this,[n])},writers:{gml:OpenLayers.Util.applyDefaults({featureMembers:function(e){for(var t=this.createElementNSPlus("gml:featureMembers"),n=0,r=e.length;r>n;++n)this.writeNode("feature:_typeName",e[n],t);return t},Point:function(e){var t=this.createElementNSPlus("gml:Point");this.writeNode("pos",e,t);return t},pos:function(e){var t=this.xy?e.x+" "+e.y:e.y+" "+e.x;return this.createElementNSPlus("gml:pos",{value:t})},LineString:function(e){var t=this.createElementNSPlus("gml:LineString");this.writeNode("posList",e.components,t);return t},Curve:function(e){var t=this.createElementNSPlus("gml:Curve");this.writeNode("segments",e,t);return t},segments:function(e){var t=this.createElementNSPlus("gml:segments");this.writeNode("LineStringSegment",e,t);return t},LineStringSegment:function(e){var t=this.createElementNSPlus("gml:LineStringSegment");this.writeNode("posList",e.components,t);return t},posList:function(e){for(var t,n=e.length,r=new Array(n),i=0;n>i;++i){t=e[i];r[i]=this.xy?t.x+" "+t.y:t.y+" "+t.x}return this.createElementNSPlus("gml:posList",{value:r.join(" ")})},Surface:function(e){var t=this.createElementNSPlus("gml:Surface");this.writeNode("patches",e,t);return t},patches:function(e){var t=this.createElementNSPlus("gml:patches");this.writeNode("PolygonPatch",e,t);return t},PolygonPatch:function(e){var t=this.createElementNSPlus("gml:PolygonPatch",{attributes:{interpolation:"planar"}});this.writeNode("exterior",e.components[0],t);for(var n=1,r=e.components.length;r>n;++n)this.writeNode("interior",e.components[n],t);return t},Polygon:function(e){var t=this.createElementNSPlus("gml:Polygon");this.writeNode("exterior",e.components[0],t);for(var n=1,r=e.components.length;r>n;++n)this.writeNode("interior",e.components[n],t);return t},exterior:function(e){var t=this.createElementNSPlus("gml:exterior");this.writeNode("LinearRing",e,t);return t},interior:function(e){var t=this.createElementNSPlus("gml:interior");this.writeNode("LinearRing",e,t);return t},LinearRing:function(e){var t=this.createElementNSPlus("gml:LinearRing");this.writeNode("posList",e.components,t);return t},MultiCurve:function(e){for(var t=this.createElementNSPlus("gml:MultiCurve"),n=e.components||[e],r=0,i=n.length;i>r;++r)this.writeNode("curveMember",n[r],t);return t},curveMember:function(e){var t=this.createElementNSPlus("gml:curveMember");this.curve?this.writeNode("Curve",e,t):this.writeNode("LineString",e,t);return t},MultiSurface:function(e){for(var t=this.createElementNSPlus("gml:MultiSurface"),n=e.components||[e],r=0,i=n.length;i>r;++r)this.writeNode("surfaceMember",n[r],t);return t},surfaceMember:function(e){var t=this.createElementNSPlus("gml:surfaceMember");this.surface?this.writeNode("Surface",e,t):this.writeNode("Polygon",e,t);return t},Envelope:function(e){var t=this.createElementNSPlus("gml:Envelope");this.writeNode("lowerCorner",e,t);this.writeNode("upperCorner",e,t);this.srsName&&t.setAttribute("srsName",this.srsName);return t},lowerCorner:function(e){var t=this.xy?e.left+" "+e.bottom:e.bottom+" "+e.left;return this.createElementNSPlus("gml:lowerCorner",{value:t})},upperCorner:function(e){var t=this.xy?e.right+" "+e.top:e.top+" "+e.right;return this.createElementNSPlus("gml:upperCorner",{value:t})}},OpenLayers.Format.GML.Base.prototype.writers.gml),feature:OpenLayers.Format.GML.Base.prototype.writers.feature,wfs:OpenLayers.Format.GML.Base.prototype.writers.wfs},setGeometryTypes:function(){this.geometryTypes={"OpenLayers.Geometry.Point":"Point","OpenLayers.Geometry.MultiPoint":"MultiPoint","OpenLayers.Geometry.LineString":this.curve===!0?"Curve":"LineString","OpenLayers.Geometry.MultiLineString":this.multiCurve===!1?"MultiLineString":"MultiCurve","OpenLayers.Geometry.Polygon":this.surface===!0?"Surface":"Polygon","OpenLayers.Geometry.MultiPolygon":this.multiSurface===!1?"MultiPolygon":"MultiSurface","OpenLayers.Geometry.Collection":"GeometryCollection"}},CLASS_NAME:"OpenLayers.Format.GML.v3"});OpenLayers.Format.Filter.v1_1_0=OpenLayers.Class(OpenLayers.Format.GML.v3,OpenLayers.Format.Filter.v1,{VERSION:"1.1.0",schemaLocation:"http://www.opengis.net/ogc/filter/1.1.0/filter.xsd",initialize:function(e){OpenLayers.Format.GML.v3.prototype.initialize.apply(this,[e])},readers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(e,t){var n=e.getAttribute("matchCase"),r=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,matchCase:!("false"===n||"0"===n)});this.readChildNodes(e,r);t.filters.push(r)},PropertyIsNotEqualTo:function(e,t){var n=e.getAttribute("matchCase"),r=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.NOT_EQUAL_TO,matchCase:!("false"===n||"0"===n)});this.readChildNodes(e,r);t.filters.push(r)},PropertyIsLike:function(e,t){var n=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE});this.readChildNodes(e,n);var r=e.getAttribute("wildCard"),i=e.getAttribute("singleChar"),a=e.getAttribute("escapeChar");n.value2regex(r,i,a);t.filters.push(n)}},OpenLayers.Format.Filter.v1.prototype.readers.ogc),gml:OpenLayers.Format.GML.v3.prototype.readers.gml,feature:OpenLayers.Format.GML.v3.prototype.readers.feature},writers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(e){var t=this.createElementNSPlus("ogc:PropertyIsEqualTo",{attributes:{matchCase:e.matchCase}});this.writeNode("PropertyName",e,t);this.writeOgcExpression(e.value,t);return t},PropertyIsNotEqualTo:function(e){var t=this.createElementNSPlus("ogc:PropertyIsNotEqualTo",{attributes:{matchCase:e.matchCase}});this.writeNode("PropertyName",e,t);this.writeOgcExpression(e.value,t);return t},PropertyIsLike:function(e){var t=this.createElementNSPlus("ogc:PropertyIsLike",{attributes:{matchCase:e.matchCase,wildCard:"*",singleChar:".",escapeChar:"!"}});this.writeNode("PropertyName",e,t);this.writeNode("Literal",e.regex2value(),t);return t},BBOX:function(e){var t=this.createElementNSPlus("ogc:BBOX");e.property&&this.writeNode("PropertyName",e,t);var n=this.writeNode("gml:Envelope",e.value);e.projection&&n.setAttribute("srsName",e.projection);t.appendChild(n);return t},SortBy:function(e){for(var t=this.createElementNSPlus("ogc:SortBy"),n=0,r=e.length;r>n;n++)this.writeNode("ogc:SortProperty",e[n],t);return t},SortProperty:function(e){var t=this.createElementNSPlus("ogc:SortProperty");this.writeNode("ogc:PropertyName",e,t);this.writeNode("ogc:SortOrder","DESC"==e.order?"DESC":"ASC",t);return t},SortOrder:function(e){var t=this.createElementNSPlus("ogc:SortOrder",{value:e});return t}},OpenLayers.Format.Filter.v1.prototype.writers.ogc),gml:OpenLayers.Format.GML.v3.prototype.writers.gml,feature:OpenLayers.Format.GML.v3.prototype.writers.feature},writeSpatial:function(e,t){var n=this.createElementNSPlus("ogc:"+t);this.writeNode("PropertyName",e,n);if(e.value instanceof OpenLayers.Filter.Function)this.writeNode("Function",e.value,n);else{var r;r=e.value instanceof OpenLayers.Geometry?this.writeNode("feature:_geometry",e.value).firstChild:this.writeNode("gml:Envelope",e.value);e.projection&&r.setAttribute("srsName",e.projection);n.appendChild(r)}return n},CLASS_NAME:"OpenLayers.Format.Filter.v1_1_0"});OpenLayers.Format.OWSCommon=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",getVersion:function(e,t){var n=this.version;if(!n){var r=e.getAttribute("xmlns:ows");r&&"1.1"===r.substring(r.lastIndexOf("/")+1)&&(n="1.1.0");n||(n=this.defaultVersion)}return n},CLASS_NAME:"OpenLayers.Format.OWSCommon"});OpenLayers.Format.OWSCommon.v1=OpenLayers.Class(OpenLayers.Format.XML,{regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},read:function(e,t){t=OpenLayers.Util.applyDefaults(t,this.options);var n={};this.readChildNodes(e,n);return n},readers:{ows:{Exception:function(e,t){var n={code:e.getAttribute("exceptionCode"),locator:e.getAttribute("locator"),texts:[]};t.exceptions.push(n);this.readChildNodes(e,n)},ExceptionText:function(e,t){var n=this.getChildValue(e);t.texts.push(n)},ServiceIdentification:function(e,t){t.serviceIdentification={};this.readChildNodes(e,t.serviceIdentification)},Title:function(e,t){t.title=this.getChildValue(e)},Abstract:function(e,t){t["abstract"]=this.getChildValue(e)},Keywords:function(e,t){t.keywords={};this.readChildNodes(e,t.keywords)},Keyword:function(e,t){t[this.getChildValue(e)]=!0},ServiceType:function(e,t){t.serviceType={codeSpace:e.getAttribute("codeSpace"),value:this.getChildValue(e)}},ServiceTypeVersion:function(e,t){t.serviceTypeVersion=this.getChildValue(e)},Fees:function(e,t){t.fees=this.getChildValue(e)},AccessConstraints:function(e,t){t.accessConstraints=this.getChildValue(e)},ServiceProvider:function(e,t){t.serviceProvider={};this.readChildNodes(e,t.serviceProvider)},ProviderName:function(e,t){t.providerName=this.getChildValue(e)},ProviderSite:function(e,t){t.providerSite=this.getAttributeNS(e,this.namespaces.xlink,"href")},ServiceContact:function(e,t){t.serviceContact={};this.readChildNodes(e,t.serviceContact)},IndividualName:function(e,t){t.individualName=this.getChildValue(e)},PositionName:function(e,t){t.positionName=this.getChildValue(e)},ContactInfo:function(e,t){t.contactInfo={};this.readChildNodes(e,t.contactInfo)},Phone:function(e,t){t.phone={};this.readChildNodes(e,t.phone)},Voice:function(e,t){t.voice=this.getChildValue(e)},Address:function(e,t){t.address={};this.readChildNodes(e,t.address)},DeliveryPoint:function(e,t){t.deliveryPoint=this.getChildValue(e)},City:function(e,t){t.city=this.getChildValue(e)},AdministrativeArea:function(e,t){t.administrativeArea=this.getChildValue(e)},PostalCode:function(e,t){t.postalCode=this.getChildValue(e)},Country:function(e,t){t.country=this.getChildValue(e)},ElectronicMailAddress:function(e,t){t.electronicMailAddress=this.getChildValue(e)},Role:function(e,t){t.role=this.getChildValue(e)},OperationsMetadata:function(e,t){t.operationsMetadata={};this.readChildNodes(e,t.operationsMetadata)},Operation:function(e,t){var n=e.getAttribute("name");t[n]={};this.readChildNodes(e,t[n])},DCP:function(e,t){t.dcp={};this.readChildNodes(e,t.dcp)},HTTP:function(e,t){t.http={};this.readChildNodes(e,t.http)},Get:function(e,t){t.get||(t.get=[]);var n={url:this.getAttributeNS(e,this.namespaces.xlink,"href")};this.readChildNodes(e,n);t.get.push(n)},Post:function(e,t){t.post||(t.post=[]);var n={url:this.getAttributeNS(e,this.namespaces.xlink,"href")};this.readChildNodes(e,n);t.post.push(n)},Parameter:function(e,t){t.parameters||(t.parameters={});var n=e.getAttribute("name");t.parameters[n]={};this.readChildNodes(e,t.parameters[n])},Constraint:function(e,t){t.constraints||(t.constraints={});var n=e.getAttribute("name");t.constraints[n]={};this.readChildNodes(e,t.constraints[n])},Value:function(e,t){t[this.getChildValue(e)]=!0},OutputFormat:function(e,t){t.formats.push({value:this.getChildValue(e)});this.readChildNodes(e,t)},WGS84BoundingBox:function(e,t){var n={};n.crs=e.getAttribute("crs");if(t.BoundingBox)t.BoundingBox.push(n);else{t.projection=n.crs;n=t}this.readChildNodes(e,n)},BoundingBox:function(e,t){this.readers.ows.WGS84BoundingBox.apply(this,[e,t])},LowerCorner:function(e,t){var n=this.getChildValue(e).replace(this.regExes.trimSpace,"");n=n.replace(this.regExes.trimComma,",");var r=n.split(this.regExes.splitSpace);t.left=r[0];t.bottom=r[1]},UpperCorner:function(e,t){var n=this.getChildValue(e).replace(this.regExes.trimSpace,"");n=n.replace(this.regExes.trimComma,",");var r=n.split(this.regExes.splitSpace);t.right=r[0];t.top=r[1];t.bounds=new OpenLayers.Bounds(t.left,t.bottom,t.right,t.top);delete t.left;delete t.bottom;delete t.right;delete t.top},Language:function(e,t){t.language=this.getChildValue(e)}}},writers:{ows:{BoundingBox:function(e,t){var n=this.createElementNSPlus(t||"ows:BoundingBox",{attributes:{crs:e.projection}});this.writeNode("ows:LowerCorner",e,n);this.writeNode("ows:UpperCorner",e,n);return n},LowerCorner:function(e){var t=this.createElementNSPlus("ows:LowerCorner",{value:e.bounds.left+" "+e.bounds.bottom});return t},UpperCorner:function(e){var t=this.createElementNSPlus("ows:UpperCorner",{value:e.bounds.right+" "+e.bounds.top});return t},Identifier:function(e){var t=this.createElementNSPlus("ows:Identifier",{
value:e});return t},Title:function(e){var t=this.createElementNSPlus("ows:Title",{value:e});return t},Abstract:function(e){var t=this.createElementNSPlus("ows:Abstract",{value:e});return t},OutputFormat:function(e){var t=this.createElementNSPlus("ows:OutputFormat",{value:e});return t}}},CLASS_NAME:"OpenLayers.Format.OWSCommon.v1"});OpenLayers.Format.OWSCommon.v1_0_0=OpenLayers.Class(OpenLayers.Format.OWSCommon.v1,{namespaces:{ows:"http://www.opengis.net/ows",xlink:"http://www.w3.org/1999/xlink"},readers:{ows:OpenLayers.Util.applyDefaults({ExceptionReport:function(e,t){t.success=!1;t.exceptionReport={version:e.getAttribute("version"),language:e.getAttribute("language"),exceptions:[]};this.readChildNodes(e,t.exceptionReport)}},OpenLayers.Format.OWSCommon.v1.prototype.readers.ows)},writers:{ows:OpenLayers.Format.OWSCommon.v1.prototype.writers.ows},CLASS_NAME:"OpenLayers.Format.OWSCommon.v1_0_0"});OpenLayers.Format.WFST.v1_1_0=OpenLayers.Class(OpenLayers.Format.Filter.v1_1_0,OpenLayers.Format.WFST.v1,{version:"1.1.0",schemaLocations:{wfs:"http://schemas.opengis.net/wfs/1.1.0/wfs.xsd"},initialize:function(e){OpenLayers.Format.Filter.v1_1_0.prototype.initialize.apply(this,[e]);OpenLayers.Format.WFST.v1.prototype.initialize.apply(this,[e])},readNode:function(e,t,n){return OpenLayers.Format.GML.v3.prototype.readNode.apply(this,arguments)},readers:{wfs:OpenLayers.Util.applyDefaults({FeatureCollection:function(e,t){t.numberOfFeatures=parseInt(e.getAttribute("numberOfFeatures"));OpenLayers.Format.WFST.v1.prototype.readers.wfs.FeatureCollection.apply(this,arguments)},TransactionResponse:function(e,t){t.insertIds=[];t.success=!1;this.readChildNodes(e,t)},TransactionSummary:function(e,t){t.success=!0},InsertResults:function(e,t){this.readChildNodes(e,t)},Feature:function(e,t){var n={fids:[]};this.readChildNodes(e,n);t.insertIds.push(n.fids[0])}},OpenLayers.Format.WFST.v1.prototype.readers.wfs),gml:OpenLayers.Format.GML.v3.prototype.readers.gml,feature:OpenLayers.Format.GML.v3.prototype.readers.feature,ogc:OpenLayers.Format.Filter.v1_1_0.prototype.readers.ogc,ows:OpenLayers.Format.OWSCommon.v1_0_0.prototype.readers.ows},writers:{wfs:OpenLayers.Util.applyDefaults({GetFeature:function(e){var t=OpenLayers.Format.WFST.v1.prototype.writers.wfs.GetFeature.apply(this,arguments);e&&this.setAttributes(t,{resultType:e.resultType,startIndex:e.startIndex,count:e.count});return t},Query:function(e){e=OpenLayers.Util.extend({featureNS:this.featureNS,featurePrefix:this.featurePrefix,featureType:this.featureType,srsName:this.srsName},e);var t=e.featurePrefix,n=this.createElementNSPlus("wfs:Query",{attributes:{typeName:(t?t+":":"")+e.featureType,srsName:e.srsName}});e.featureNS&&n.setAttribute("xmlns:"+t,e.featureNS);if(e.propertyNames)for(var r=0,i=e.propertyNames.length;i>r;r++)this.writeNode("wfs:PropertyName",{property:e.propertyNames[r]},n);if(e.filter){OpenLayers.Format.WFST.v1_1_0.prototype.setFilterProperty.call(this,e.filter);this.writeNode("ogc:Filter",e.filter,n)}return n},PropertyName:function(e){return this.createElementNSPlus("wfs:PropertyName",{value:e.property})}},OpenLayers.Format.WFST.v1.prototype.writers.wfs),gml:OpenLayers.Format.GML.v3.prototype.writers.gml,feature:OpenLayers.Format.GML.v3.prototype.writers.feature,ogc:OpenLayers.Format.Filter.v1_1_0.prototype.writers.ogc},CLASS_NAME:"OpenLayers.Format.WFST.v1_1_0"});OpenLayers.Control=OpenLayers.Class({id:null,map:null,div:null,type:null,allowSelection:!1,displayClass:"",title:"",autoActivate:!1,active:null,handlerOptions:null,handler:null,eventListeners:null,events:null,initialize:function(e){this.displayClass=this.CLASS_NAME.replace("OpenLayers.","ol").replace(/\./g,"");OpenLayers.Util.extend(this,e);this.events=new OpenLayers.Events(this);this.eventListeners instanceof Object&&this.events.on(this.eventListeners);null==this.id&&(this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_"))},destroy:function(){if(this.events){this.eventListeners&&this.events.un(this.eventListeners);this.events.destroy();this.events=null}this.eventListeners=null;if(this.handler){this.handler.destroy();this.handler=null}if(this.handlers){for(var e in this.handlers)this.handlers.hasOwnProperty(e)&&"function"==typeof this.handlers[e].destroy&&this.handlers[e].destroy();this.handlers=null}if(this.map){this.map.removeControl(this);this.map=null}this.div=null},setMap:function(e){this.map=e;this.handler&&this.handler.setMap(e)},draw:function(e){if(null==this.div){this.div=OpenLayers.Util.createDiv(this.id);this.div.className=this.displayClass;if(!this.allowSelection){this.div.className+=" olControlNoSelect";this.div.setAttribute("unselectable","on",0);this.div.onselectstart=OpenLayers.Function.False}""!=this.title&&(this.div.title=this.title)}null!=e&&(this.position=e.clone());this.moveTo(this.position);return this.div},moveTo:function(e){if(null!=e&&null!=this.div){this.div.style.left=e.x+"px";this.div.style.top=e.y+"px"}},activate:function(){if(this.active)return!1;this.handler&&this.handler.activate();this.active=!0;this.map&&OpenLayers.Element.addClass(this.map.viewPortDiv,this.displayClass.replace(/ /g,"")+"Active");this.events.triggerEvent("activate");return!0},deactivate:function(){if(this.active){this.handler&&this.handler.deactivate();this.active=!1;this.map&&OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass.replace(/ /g,"")+"Active");this.events.triggerEvent("deactivate");return!0}return!1},CLASS_NAME:"OpenLayers.Control"});OpenLayers.Control.TYPE_BUTTON=1;OpenLayers.Control.TYPE_TOGGLE=2;OpenLayers.Control.TYPE_TOOL=3;OpenLayers.Control.PanZoom=OpenLayers.Class(OpenLayers.Control,{slideFactor:50,slideRatio:null,buttons:null,position:null,initialize:function(e){this.position=new OpenLayers.Pixel(OpenLayers.Control.PanZoom.X,OpenLayers.Control.PanZoom.Y);OpenLayers.Control.prototype.initialize.apply(this,arguments)},destroy:function(){this.map&&this.map.events.unregister("buttonclick",this,this.onButtonClick);this.removeButtons();this.buttons=null;this.position=null;OpenLayers.Control.prototype.destroy.apply(this,arguments)},setMap:function(e){OpenLayers.Control.prototype.setMap.apply(this,arguments);this.map.events.register("buttonclick",this,this.onButtonClick)},draw:function(e){OpenLayers.Control.prototype.draw.apply(this,arguments);e=this.position;this.buttons=[];var t={w:18,h:18},n=new OpenLayers.Pixel(e.x+t.w/2,e.y);this._addButton("panup","north-mini.png",n,t);e.y=n.y+t.h;this._addButton("panleft","west-mini.png",e,t);this._addButton("panright","east-mini.png",e.add(t.w,0),t);this._addButton("pandown","south-mini.png",n.add(0,2*t.h),t);this._addButton("zoomin","zoom-plus-mini.png",n.add(0,3*t.h+5),t);this._addButton("zoomworld","zoom-world-mini.png",n.add(0,4*t.h+5),t);this._addButton("zoomout","zoom-minus-mini.png",n.add(0,5*t.h+5),t);return this.div},_addButton:function(e,t,n,r){var i=OpenLayers.Util.getImageLocation(t),a=OpenLayers.Util.createAlphaImageDiv(this.id+"_"+e,n,r,i,"absolute");a.style.cursor="pointer";this.div.appendChild(a);a.action=e;a.className="olButton";this.buttons.push(a);return a},_removeButton:function(e){this.div.removeChild(e);OpenLayers.Util.removeItem(this.buttons,e)},removeButtons:function(){for(var e=this.buttons.length-1;e>=0;--e)this._removeButton(this.buttons[e])},onButtonClick:function(e){var t=e.buttonElement;switch(t.action){case"panup":this.map.pan(0,-this.getSlideFactor("h"));break;case"pandown":this.map.pan(0,this.getSlideFactor("h"));break;case"panleft":this.map.pan(-this.getSlideFactor("w"),0);break;case"panright":this.map.pan(this.getSlideFactor("w"),0);break;case"zoomin":this.map.zoomIn();break;case"zoomout":this.map.zoomOut();break;case"zoomworld":this.map.zoomToMaxExtent()}},getSlideFactor:function(e){return this.slideRatio?this.map.getSize()[e]*this.slideRatio:this.slideFactor},CLASS_NAME:"OpenLayers.Control.PanZoom"});OpenLayers.Control.PanZoom.X=4;OpenLayers.Control.PanZoom.Y=4;OpenLayers.Control.PanZoomBar=OpenLayers.Class(OpenLayers.Control.PanZoom,{zoomStopWidth:18,zoomStopHeight:11,slider:null,sliderEvents:null,zoombarDiv:null,zoomWorldIcon:!1,panIcons:!0,forceFixedZoomLevel:!1,mouseDragStart:null,deltaY:null,zoomStart:null,destroy:function(){this._removeZoomBar();this.map.events.un({changebaselayer:this.redraw,updatesize:this.redraw,scope:this});OpenLayers.Control.PanZoom.prototype.destroy.apply(this,arguments);delete this.mouseDragStart;delete this.zoomStart},setMap:function(e){OpenLayers.Control.PanZoom.prototype.setMap.apply(this,arguments);this.map.events.on({changebaselayer:this.redraw,updatesize:this.redraw,scope:this})},redraw:function(){if(null!=this.div){this.removeButtons();this._removeZoomBar()}this.draw()},draw:function(e){OpenLayers.Control.prototype.draw.apply(this,arguments);e=this.position.clone();this.buttons=[];var t={w:18,h:18};if(this.panIcons){var n=new OpenLayers.Pixel(e.x+t.w/2,e.y),r=t.w;this.zoomWorldIcon&&(n=new OpenLayers.Pixel(e.x+t.w,e.y));this._addButton("panup","north-mini.png",n,t);e.y=n.y+t.h;this._addButton("panleft","west-mini.png",e,t);if(this.zoomWorldIcon){this._addButton("zoomworld","zoom-world-mini.png",e.add(t.w,0),t);r*=2}this._addButton("panright","east-mini.png",e.add(r,0),t);this._addButton("pandown","south-mini.png",n.add(0,2*t.h),t);this._addButton("zoomin","zoom-plus-mini.png",n.add(0,3*t.h+5),t);n=this._addZoomBar(n.add(0,4*t.h+5));this._addButton("zoomout","zoom-minus-mini.png",n,t)}else{this._addButton("zoomin","zoom-plus-mini.png",e,t);n=this._addZoomBar(e.add(0,t.h));this._addButton("zoomout","zoom-minus-mini.png",n,t);if(this.zoomWorldIcon){n=n.add(0,t.h+3);this._addButton("zoomworld","zoom-world-mini.png",n,t)}}return this.div},_addZoomBar:function(e){var t=OpenLayers.Util.getImageLocation("slider.png"),n=this.id+"_"+this.map.id,r=this.map.getMinZoom(),i=this.map.getNumZoomLevels()-1-this.map.getZoom(),a=OpenLayers.Util.createAlphaImageDiv(n,e.add(-1,i*this.zoomStopHeight),{w:20,h:9},t,"absolute");a.style.cursor="move";this.slider=a;this.sliderEvents=new OpenLayers.Events(this,a,null,!0,{includeXY:!0});this.sliderEvents.on({touchstart:this.zoomBarDown,touchmove:this.zoomBarDrag,touchend:this.zoomBarUp,mousedown:this.zoomBarDown,mousemove:this.zoomBarDrag,mouseup:this.zoomBarUp});var s={w:this.zoomStopWidth,h:this.zoomStopHeight*(this.map.getNumZoomLevels()-r)},t=OpenLayers.Util.getImageLocation("zoombar.png"),o=null;if(OpenLayers.Util.alphaHack()){var n=this.id+"_"+this.map.id;o=OpenLayers.Util.createAlphaImageDiv(n,e,{w:s.w,h:this.zoomStopHeight},t,"absolute",null,"crop");o.style.height=s.h+"px"}else o=OpenLayers.Util.createDiv("OpenLayers_Control_PanZoomBar_Zoombar"+this.map.id,e,s,t);o.style.cursor="pointer";o.className="olButton";this.zoombarDiv=o;this.div.appendChild(o);this.startTop=parseInt(o.style.top);this.div.appendChild(a);this.map.events.register("zoomend",this,this.moveZoomBar);e=e.add(0,this.zoomStopHeight*(this.map.getNumZoomLevels()-r));return e},_removeZoomBar:function(){this.sliderEvents.un({touchstart:this.zoomBarDown,touchmove:this.zoomBarDrag,touchend:this.zoomBarUp,mousedown:this.zoomBarDown,mousemove:this.zoomBarDrag,mouseup:this.zoomBarUp});this.sliderEvents.destroy();this.div.removeChild(this.zoombarDiv);this.zoombarDiv=null;this.div.removeChild(this.slider);this.slider=null;this.map.events.unregister("zoomend",this,this.moveZoomBar)},onButtonClick:function(e){OpenLayers.Control.PanZoom.prototype.onButtonClick.apply(this,arguments);if(e.buttonElement===this.zoombarDiv){var t=e.buttonXY.y/this.zoomStopHeight;(this.forceFixedZoomLevel||!this.map.fractionalZoom)&&(t=Math.floor(t));var n=this.map.getNumZoomLevels()-1-t;n=Math.min(Math.max(n,0),this.map.getNumZoomLevels()-1);this.map.zoomTo(n)}},passEventToSlider:function(e){this.sliderEvents.handleBrowserEvent(e)},zoomBarDown:function(e){if(OpenLayers.Event.isLeftClick(e)||OpenLayers.Event.isSingleTouch(e)){this.map.events.on({touchmove:this.passEventToSlider,mousemove:this.passEventToSlider,mouseup:this.passEventToSlider,scope:this});this.mouseDragStart=e.xy.clone();this.zoomStart=e.xy.clone();this.div.style.cursor="move";this.zoombarDiv.offsets=null;OpenLayers.Event.stop(e)}},zoomBarDrag:function(e){if(null!=this.mouseDragStart){var t=this.mouseDragStart.y-e.xy.y,n=OpenLayers.Util.pagePosition(this.zoombarDiv);if(e.clientY-n[1]>0&&e.clientY-n[1]<parseInt(this.zoombarDiv.style.height)-2){var r=parseInt(this.slider.style.top)-t;this.slider.style.top=r+"px";this.mouseDragStart=e.xy.clone()}this.deltaY=this.zoomStart.y-e.xy.y;OpenLayers.Event.stop(e)}},zoomBarUp:function(e){if((OpenLayers.Event.isLeftClick(e)||"touchend"===e.type)&&this.mouseDragStart){this.div.style.cursor="";this.map.events.un({touchmove:this.passEventToSlider,mouseup:this.passEventToSlider,mousemove:this.passEventToSlider,scope:this});var t=this.map.zoom;if(!this.forceFixedZoomLevel&&this.map.fractionalZoom){t+=this.deltaY/this.zoomStopHeight;t=Math.min(Math.max(t,0),this.map.getNumZoomLevels()-1)}else{t+=this.deltaY/this.zoomStopHeight;t=Math.max(Math.round(t),0)}this.map.zoomTo(t);this.mouseDragStart=null;this.zoomStart=null;this.deltaY=0;OpenLayers.Event.stop(e)}},moveZoomBar:function(){var e=(this.map.getNumZoomLevels()-1-this.map.getZoom())*this.zoomStopHeight+this.startTop+1;this.slider.style.top=e+"px"},CLASS_NAME:"OpenLayers.Control.PanZoomBar"});OpenLayers.Events.featureclick=OpenLayers.Class({cache:null,map:null,provides:["featureclick","nofeatureclick","featureover","featureout"],initialize:function(e){this.target=e;if(e.object instanceof OpenLayers.Map)this.setMap(e.object);else{if(!(e.object instanceof OpenLayers.Layer.Vector))throw"Listeners for '"+this.provides.join("', '")+"' events can only be registered for OpenLayers.Layer.Vector or OpenLayers.Map instances";e.object.map?this.setMap(e.object.map):e.object.events.register("added",this,function(t){this.setMap(e.object.map)})}for(var t=this.provides.length-1;t>=0;--t)e.extensions[this.provides[t]]=!0},setMap:function(e){this.map=e;this.cache={};e.events.register("mousedown",this,this.start,{extension:!0});e.events.register("mouseup",this,this.onClick,{extension:!0});e.events.register("touchstart",this,this.start,{extension:!0});e.events.register("touchmove",this,this.cancel,{extension:!0});e.events.register("touchend",this,this.onClick,{extension:!0});e.events.register("mousemove",this,this.onMousemove,{extension:!0})},start:function(e){this.startEvt=e},cancel:function(e){delete this.startEvt},onClick:function(e){if(this.startEvt&&("touchend"===e.type||OpenLayers.Event.isLeftClick(e))){var t=this.getFeatures(this.startEvt);delete this.startEvt;for(var n,r,i,a={},s=0,o=t.length;o>s;++s){n=t[s];r=n.layer;a[r.id]=!0;i=this.triggerEvent("featureclick",{feature:n});if(i===!1)break}for(s=0,o=this.map.layers.length;o>s;++s){r=this.map.layers[s];r instanceof OpenLayers.Layer.Vector&&!a[r.id]&&this.triggerEvent("nofeatureclick",{layer:r})}}},onMousemove:function(e){delete this.startEvt;for(var t,n=this.getFeatures(e),r={},i=[],a=0,s=n.length;s>a;++a){t=n[a];r[t.id]=t;this.cache[t.id]||i.push(t)}var o=[];for(var l in this.cache){t=this.cache[l];t.layer&&t.layer.map?r[t.id]||o.push(t):delete this.cache[l]}var c;for(a=0,s=i.length;s>a;++a){t=i[a];this.cache[t.id]=t;c=this.triggerEvent("featureover",{feature:t});if(c===!1)break}for(a=0,s=o.length;s>a;++a){t=o[a];delete this.cache[t.id];c=this.triggerEvent("featureout",{feature:t});if(c===!1)break}},triggerEvent:function(e,t){var n=t.feature?t.feature.layer:t.layer,r=this.target.object;return r instanceof OpenLayers.Map||r===n?this.target.triggerEvent(e,t):void 0},getFeatures:function(e){var t,n,r,i,a,s=e.clientX,o=e.clientY,l=[],c=[],u=[];for(i=this.map.layers.length-1;i>=0;--i){t=this.map.layers[i];if("none"!==t.div.style.display)if(t.renderer instanceof OpenLayers.Renderer.Elements){if(t instanceof OpenLayers.Layer.Vector){n=document.elementFromPoint(s,o);for(;n&&n._featureId;){r=t.getFeatureById(n._featureId);if(r){l.push(r);n.style.display="none";c.push(n);n=document.elementFromPoint(s,o)}else n=!1}}u.push(t);t.div.style.display="none"}else if(t.renderer instanceof OpenLayers.Renderer.Canvas){r=t.renderer.getFeatureIdFromEvent(e);if(r){l.push(r);u.push(t)}}}for(i=0,a=c.length;a>i;++i)c[i].style.display="";for(i=u.length-1;i>=0;--i)u[i].div.style.display="block";return l},destroy:function(){for(var e=this.provides.length-1;e>=0;--e)delete this.target.extensions[this.provides[e]];this.map.events.un({mousemove:this.onMousemove,mousedown:this.start,mouseup:this.onClick,touchstart:this.start,touchmove:this.cancel,touchend:this.onClick,scope:this});delete this.cache;delete this.map;delete this.target}});OpenLayers.Events.nofeatureclick=OpenLayers.Events.featureclick;OpenLayers.Events.featureover=OpenLayers.Events.featureclick;OpenLayers.Events.featureout=OpenLayers.Events.featureclick;OpenLayers.Handler=OpenLayers.Class({id:null,control:null,map:null,keyMask:null,active:!1,evt:null,touch:!1,initialize:function(e,t,n){OpenLayers.Util.extend(this,n);this.control=e;this.callbacks=t;var r=this.map||e.map;r&&this.setMap(r);this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},setMap:function(e){this.map=e},checkModifiers:function(e){if(null==this.keyMask)return!0;var t=(e.shiftKey?OpenLayers.Handler.MOD_SHIFT:0)|(e.ctrlKey?OpenLayers.Handler.MOD_CTRL:0)|(e.altKey?OpenLayers.Handler.MOD_ALT:0)|(e.metaKey?OpenLayers.Handler.MOD_META:0);return t==this.keyMask},activate:function(){if(this.active)return!1;for(var e=OpenLayers.Events.prototype.BROWSER_EVENTS,t=0,n=e.length;n>t;t++)this[e[t]]&&this.register(e[t],this[e[t]]);this.active=!0;return!0},deactivate:function(){if(!this.active)return!1;for(var e=OpenLayers.Events.prototype.BROWSER_EVENTS,t=0,n=e.length;n>t;t++)this[e[t]]&&this.unregister(e[t],this[e[t]]);this.touch=!1;this.active=!1;return!0},startTouch:function(){if(!this.touch){this.touch=!0;for(var e=["mousedown","mouseup","mousemove","click","dblclick","mouseout"],t=0,n=e.length;n>t;t++)this[e[t]]&&this.unregister(e[t],this[e[t]])}},callback:function(e,t){e&&this.callbacks[e]&&this.callbacks[e].apply(this.control,t)},register:function(e,t){this.map.events.registerPriority(e,this,t);this.map.events.registerPriority(e,this,this.setEvent)},unregister:function(e,t){this.map.events.unregister(e,this,t);this.map.events.unregister(e,this,this.setEvent)},setEvent:function(e){this.evt=e;return!0},destroy:function(){this.deactivate();this.control=this.map=null},CLASS_NAME:"OpenLayers.Handler"});OpenLayers.Handler.MOD_NONE=0;OpenLayers.Handler.MOD_SHIFT=1;OpenLayers.Handler.MOD_CTRL=2;OpenLayers.Handler.MOD_ALT=4;OpenLayers.Handler.MOD_META=8;OpenLayers.Handler.Point=OpenLayers.Class(OpenLayers.Handler,{point:null,layer:null,multi:!1,citeCompliant:!1,mouseDown:!1,stoppedDown:null,lastDown:null,lastUp:null,persist:!1,stopDown:!1,stopUp:!1,layerOptions:null,pixelTolerance:5,lastTouchPx:null,initialize:function(e,t,n){n&&n.layerOptions&&n.layerOptions.styleMap||(this.style=OpenLayers.Util.extend(OpenLayers.Feature.Vector.style["default"],{}));OpenLayers.Handler.prototype.initialize.apply(this,arguments)},activate:function(){if(!OpenLayers.Handler.prototype.activate.apply(this,arguments))return!1;var e=OpenLayers.Util.extend({displayInLayerSwitcher:!1,calculateInRange:OpenLayers.Function.True,wrapDateLine:this.citeCompliant},this.layerOptions);this.layer=new OpenLayers.Layer.Vector(this.CLASS_NAME,e);this.map.addLayer(this.layer);return!0},createFeature:function(e){var t=this.layer.getLonLatFromViewPortPx(e),n=new OpenLayers.Geometry.Point(t.lon,t.lat);this.point=new OpenLayers.Feature.Vector(n);this.callback("create",[this.point.geometry,this.point]);this.point.geometry.clearBounds();this.layer.addFeatures([this.point],{silent:!0})},deactivate:function(){if(!OpenLayers.Handler.prototype.deactivate.apply(this,arguments))return!1;this.cancel();if(null!=this.layer.map){this.destroyFeature(!0);this.layer.destroy(!1)}this.layer=null;return!0},destroyFeature:function(e){!this.layer||!e&&this.persist||this.layer.destroyFeatures();this.point=null},destroyPersistedFeature:function(){var e=this.layer;e&&e.features.length>1&&this.layer.features[0].destroy()},finalize:function(e){var t=e?"cancel":"done";this.mouseDown=!1;this.lastDown=null;this.lastUp=null;this.lastTouchPx=null;this.callback(t,[this.geometryClone()]);this.destroyFeature(e)},cancel:function(){this.finalize(!0)},click:function(e){OpenLayers.Event.stop(e);return!1},dblclick:function(e){OpenLayers.Event.stop(e);return!1},modifyFeature:function(e){this.point||this.createFeature(e);var t=this.layer.getLonLatFromViewPortPx(e);this.point.geometry.x=t.lon;this.point.geometry.y=t.lat;this.callback("modify",[this.point.geometry,this.point,!1]);this.point.geometry.clearBounds();this.drawFeature()},drawFeature:function(){this.layer.drawFeature(this.point,this.style)},getGeometry:function(){var e=this.point&&this.point.geometry;e&&this.multi&&(e=new OpenLayers.Geometry.MultiPoint([e]));return e},geometryClone:function(){var e=this.getGeometry();return e&&e.clone()},mousedown:function(e){return this.down(e)},touchstart:function(e){this.startTouch();this.lastTouchPx=e.xy;return this.down(e)},mousemove:function(e){return this.move(e)},touchmove:function(e){this.lastTouchPx=e.xy;return this.move(e)},mouseup:function(e){return this.up(e)},touchend:function(e){e.xy=this.lastTouchPx;return this.up(e)},down:function(e){this.mouseDown=!0;this.lastDown=e.xy;this.touch||this.modifyFeature(e.xy);this.stoppedDown=this.stopDown;return!this.stopDown},move:function(e){this.touch||this.mouseDown&&!this.stoppedDown||this.modifyFeature(e.xy);return!0},up:function(e){this.mouseDown=!1;this.stoppedDown=this.stopDown;if(!this.checkModifiers(e))return!0;if(this.lastUp&&this.lastUp.equals(e.xy))return!0;if(this.lastDown&&this.passesTolerance(this.lastDown,e.xy,this.pixelTolerance)){this.touch&&this.modifyFeature(e.xy);this.persist&&this.destroyPersistedFeature();this.lastUp=e.xy;this.finalize();return!this.stopUp}return!0},mouseout:function(e){if(OpenLayers.Util.mouseLeft(e,this.map.viewPortDiv)){this.stoppedDown=this.stopDown;this.mouseDown=!1}},passesTolerance:function(e,t,n){var r=!0;if(null!=n&&e&&t){var i=e.distanceTo(t);i>n&&(r=!1)}return r},CLASS_NAME:"OpenLayers.Handler.Point"});OpenLayers.Handler.Path=OpenLayers.Class(OpenLayers.Handler.Point,{line:null,maxVertices:null,doubleTouchTolerance:20,freehand:!1,freehandToggle:"shiftKey",timerId:null,redoStack:null,createFeature:function(e){var t=this.layer.getLonLatFromViewPortPx(e),n=new OpenLayers.Geometry.Point(t.lon,t.lat);this.point=new OpenLayers.Feature.Vector(n);this.line=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString([this.point.geometry]));this.callback("create",[this.point.geometry,this.getSketch()]);this.point.geometry.clearBounds();this.layer.addFeatures([this.line,this.point],{silent:!0})},destroyFeature:function(e){OpenLayers.Handler.Point.prototype.destroyFeature.call(this,e);this.line=null},destroyPersistedFeature:function(){var e=this.layer;e&&e.features.length>2&&this.layer.features[0].destroy()},removePoint:function(){this.point&&this.layer.removeFeatures([this.point])},addPoint:function(e){this.layer.removeFeatures([this.point]);var t=this.layer.getLonLatFromViewPortPx(e);this.point=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(t.lon,t.lat));this.line.geometry.addComponent(this.point.geometry,this.line.geometry.components.length);this.layer.addFeatures([this.point]);this.callback("point",[this.point.geometry,this.getGeometry()]);this.callback("modify",[this.point.geometry,this.getSketch()]);this.drawFeature();delete this.redoStack},insertXY:function(e,t){this.line.geometry.addComponent(new OpenLayers.Geometry.Point(e,t),this.getCurrentPointIndex());this.drawFeature();delete this.redoStack},insertDeltaXY:function(e,t){var n=this.getCurrentPointIndex()-1,r=this.line.geometry.components[n];!r||isNaN(r.x)||isNaN(r.y)||this.insertXY(r.x+e,r.y+t)},insertDirectionLength:function(e,t){e*=Math.PI/180;var n=t*Math.cos(e),r=t*Math.sin(e);this.insertDeltaXY(n,r)},insertDeflectionLength:function(e,t){var n=this.getCurrentPointIndex()-1;if(n>0){var r=this.line.geometry.components[n],i=this.line.geometry.components[n-1],a=Math.atan2(r.y-i.y,r.x-i.x);this.insertDirectionLength(180*a/Math.PI+e,t)}},getCurrentPointIndex:function(){return this.line.geometry.components.length-1},undo:function(){var e=this.line.geometry,t=e.components,n=this.getCurrentPointIndex()-1,r=t[n],i=e.removeComponent(r);if(i){if(this.touch&&n>0){t=e.components;var a=t[n-1],s=this.getCurrentPointIndex(),o=t[s];o.x=a.x;o.y=a.y}this.redoStack||(this.redoStack=[]);this.redoStack.push(r);this.drawFeature()}return i},redo:function(){var e=this.redoStack&&this.redoStack.pop();if(e){this.line.geometry.addComponent(e,this.getCurrentPointIndex());this.drawFeature()}return!!e},freehandMode:function(e){return this.freehandToggle&&e[this.freehandToggle]?!this.freehand:this.freehand},modifyFeature:function(e,t){this.line||this.createFeature(e);var n=this.layer.getLonLatFromViewPortPx(e);this.point.geometry.x=n.lon;this.point.geometry.y=n.lat;this.callback("modify",[this.point.geometry,this.getSketch(),t]);this.point.geometry.clearBounds();this.drawFeature()},drawFeature:function(){this.layer.drawFeature(this.line,this.style);this.layer.drawFeature(this.point,this.style)},getSketch:function(){return this.line},getGeometry:function(){var e=this.line&&this.line.geometry;e&&this.multi&&(e=new OpenLayers.Geometry.MultiLineString([e]));return e},touchstart:function(e){if(this.timerId&&this.passesTolerance(this.lastTouchPx,e.xy,this.doubleTouchTolerance)){this.finishGeometry();window.clearTimeout(this.timerId);this.timerId=null;return!1}if(this.timerId){window.clearTimeout(this.timerId);this.timerId=null}this.timerId=window.setTimeout(OpenLayers.Function.bind(function(){this.timerId=null},this),300);return OpenLayers.Handler.Point.prototype.touchstart.call(this,e)},down:function(e){var t=this.stopDown;if(this.freehandMode(e)){t=!0;if(this.touch){this.modifyFeature(e.xy,!!this.lastUp);OpenLayers.Event.stop(e)}}this.touch||this.lastDown&&this.passesTolerance(this.lastDown,e.xy,this.pixelTolerance)||this.modifyFeature(e.xy,!!this.lastUp);this.mouseDown=!0;this.lastDown=e.xy;this.stoppedDown=t;return!t},move:function(e){if(this.stoppedDown&&this.freehandMode(e)){this.persist&&this.destroyPersistedFeature();if(this.maxVertices&&this.line&&this.line.geometry.components.length===this.maxVertices){this.removePoint();this.finalize()}else this.addPoint(e.xy);return!1}this.touch||this.mouseDown&&!this.stoppedDown||this.modifyFeature(e.xy,!!this.lastUp);return!0},up:function(e){if(this.mouseDown&&(!this.lastUp||!this.lastUp.equals(e.xy)))if(this.stoppedDown&&this.freehandMode(e)){this.persist&&this.destroyPersistedFeature();this.removePoint();this.finalize()}else if(this.passesTolerance(this.lastDown,e.xy,this.pixelTolerance)){this.touch&&this.modifyFeature(e.xy);null==this.lastUp&&this.persist&&this.destroyPersistedFeature();this.addPoint(e.xy);this.lastUp=e.xy;this.line.geometry.components.length===this.maxVertices+1&&this.finishGeometry()}this.stoppedDown=this.stopDown;this.mouseDown=!1;return!this.stopUp},finishGeometry:function(){var e=this.line.geometry.components.length-1;this.line.geometry.removeComponent(this.line.geometry.components[e]);this.removePoint();this.finalize()},dblclick:function(e){this.freehandMode(e)||this.finishGeometry();return!1},CLASS_NAME:"OpenLayers.Handler.Path"});OpenLayers.Handler.Polygon=OpenLayers.Class(OpenLayers.Handler.Path,{holeModifier:null,drawingHole:!1,polygon:null,createFeature:function(e){var t=this.layer.getLonLatFromViewPortPx(e),n=new OpenLayers.Geometry.Point(t.lon,t.lat);this.point=new OpenLayers.Feature.Vector(n);this.line=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LinearRing([this.point.geometry]));this.polygon=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon([this.line.geometry]));this.callback("create",[this.point.geometry,this.getSketch()]);this.point.geometry.clearBounds();this.layer.addFeatures([this.polygon,this.point],{silent:!0})},addPoint:function(e){if(!this.drawingHole&&this.holeModifier&&this.evt&&this.evt[this.holeModifier])for(var t,n,r=this.point.geometry,i=this.control.layer.features,a=i.length-1;a>=0;--a){t=i[a].geometry;if((t instanceof OpenLayers.Geometry.Polygon||t instanceof OpenLayers.Geometry.MultiPolygon)&&t.intersects(r)){n=i[a];this.control.layer.removeFeatures([n],{silent:!0});this.control.layer.events.registerPriority("sketchcomplete",this,this.finalizeInteriorRing);this.control.layer.events.registerPriority("sketchmodified",this,this.enforceTopology);n.geometry.addComponent(this.line.geometry);this.polygon=n;this.drawingHole=!0;break}}OpenLayers.Handler.Path.prototype.addPoint.apply(this,arguments)},getCurrentPointIndex:function(){return this.line.geometry.components.length-2},enforceTopology:function(e){var t=e.vertex,n=this.line.geometry.components;if(!this.polygon.geometry.intersects(t)){var r=n[n.length-3];t.x=r.x;t.y=r.y}},finishGeometry:function(){var e=this.line.geometry.components.length-2;this.line.geometry.removeComponent(this.line.geometry.components[e]);this.removePoint();this.finalize()},finalizeInteriorRing:function(){var e=this.line.geometry,t=0!==e.getArea();if(t){for(var n=this.polygon.geometry.components,r=n.length-2;r>=0;--r)if(e.intersects(n[r])){t=!1;break}if(t){e:for(var r=n.length-2;r>0;--r)for(var i=n[r].components,a=0,s=i.length;s>a;++a)if(e.containsPoint(i[a])){t=!1;break e}}}t?this.polygon.state!==OpenLayers.State.INSERT&&(this.polygon.state=OpenLayers.State.UPDATE):this.polygon.geometry.removeComponent(e);this.restoreFeature();return!1},cancel:function(){if(this.drawingHole){this.polygon.geometry.removeComponent(this.line.geometry);this.restoreFeature(!0)}return OpenLayers.Handler.Path.prototype.cancel.apply(this,arguments)},restoreFeature:function(e){this.control.layer.events.unregister("sketchcomplete",this,this.finalizeInteriorRing);this.control.layer.events.unregister("sketchmodified",this,this.enforceTopology);this.layer.removeFeatures([this.polygon],{silent:!0});this.control.layer.addFeatures([this.polygon],{silent:!0});this.drawingHole=!1;e||this.control.layer.events.triggerEvent("sketchcomplete",{feature:this.polygon})},destroyFeature:function(e){OpenLayers.Handler.Path.prototype.destroyFeature.call(this,e);this.polygon=null},drawFeature:function(){this.layer.drawFeature(this.polygon,this.style);this.layer.drawFeature(this.point,this.style)},getSketch:function(){return this.polygon},getGeometry:function(){var e=this.polygon&&this.polygon.geometry;e&&this.multi&&(e=new OpenLayers.Geometry.MultiPolygon([e]));return e},CLASS_NAME:"OpenLayers.Handler.Polygon"});OpenLayers.Renderer=OpenLayers.Class({container:null,root:null,extent:null,locked:!1,size:null,resolution:null,map:null,featureDx:0,initialize:function(e,t){this.container=OpenLayers.Util.getElement(e);OpenLayers.Util.extend(this,t)},destroy:function(){this.container=null;this.extent=null;this.size=null;this.resolution=null;this.map=null},supported:function(){return!1},setExtent:function(e,t){this.extent=e.clone();if(this.map.baseLayer&&this.map.baseLayer.wrapDateLine){var n=e.getWidth()/this.map.getExtent().getWidth(),e=e.scale(1/n);this.extent=e.wrapDateLine(this.map.getMaxExtent()).scale(n)}t&&(this.resolution=null);return!0},setSize:function(e){this.size=e.clone();this.resolution=null},getResolution:function(){this.resolution=this.resolution||this.map.getResolution();return this.resolution},drawFeature:function(e,t){null==t&&(t=e.style);if(e.geometry){var n=e.geometry.getBounds();if(n){var r;this.map.baseLayer&&this.map.baseLayer.wrapDateLine&&(r=this.map.getMaxExtent());n.intersectsBounds(this.extent,{worldBounds:r})?this.calculateFeatureDx(n,r):t={display:"none"};var i=this.drawGeometry(e.geometry,t,e.id);if("none"!=t.display&&t.label&&i!==!1){var a=e.geometry.getCentroid();if(t.labelXOffset||t.labelYOffset){var s=isNaN(t.labelXOffset)?0:t.labelXOffset,o=isNaN(t.labelYOffset)?0:t.labelYOffset,l=this.getResolution();

a.move(s*l,o*l)}this.drawText(e.id,t,a)}else this.removeText(e.id);return i}}},calculateFeatureDx:function(e,t){this.featureDx=0;if(t){var n=t.getWidth(),r=(this.extent.left+this.extent.right)/2,i=(e.left+e.right)/2,a=Math.round((i-r)/n);this.featureDx=a*n}},drawGeometry:function(e,t,n){},drawText:function(e,t,n){},removeText:function(e){},clear:function(){},getFeatureIdFromEvent:function(e){},eraseFeatures:function(e){OpenLayers.Util.isArray(e)||(e=[e]);for(var t=0,n=e.length;n>t;++t){var r=e[t];this.eraseGeometry(r.geometry,r.id);this.removeText(r.id)}},eraseGeometry:function(e,t){},moveRoot:function(e){},getRenderLayerId:function(){return this.container.id},applyDefaultSymbolizer:function(e){var t=OpenLayers.Util.extend({},OpenLayers.Renderer.defaultSymbolizer);if(e.stroke===!1){delete t.strokeWidth;delete t.strokeColor}e.fill===!1&&delete t.fillColor;OpenLayers.Util.extend(t,e);return t},CLASS_NAME:"OpenLayers.Renderer"});OpenLayers.Renderer.defaultSymbolizer={fillColor:"#000000",strokeColor:"#000000",strokeWidth:2,fillOpacity:1,strokeOpacity:1,pointRadius:0,labelAlign:"cm"};OpenLayers.Renderer.symbol={star:[350,75,379,161,469,161,397,215,423,301,350,250,277,301,303,215,231,161,321,161,350,75],cross:[4,0,6,0,6,4,10,4,10,6,6,6,6,10,4,10,4,6,0,6,0,4,4,4,4,0],x:[0,0,25,0,50,35,75,0,100,0,65,50,100,100,75,100,50,65,25,100,0,100,35,50,0,0],square:[0,0,0,1,1,1,1,0,0,0],triangle:[0,10,10,10,5,0,0,10]};OpenLayers.Renderer.Canvas=OpenLayers.Class(OpenLayers.Renderer,{hitDetection:!0,hitOverflow:0,canvas:null,features:null,pendingRedraw:!1,cachedSymbolBounds:{},initialize:function(e,t){OpenLayers.Renderer.prototype.initialize.apply(this,arguments);this.root=document.createElement("canvas");this.container.appendChild(this.root);this.canvas=this.root.getContext("2d");this.features={};if(this.hitDetection){this.hitCanvas=document.createElement("canvas");this.hitContext=this.hitCanvas.getContext("2d")}},setExtent:function(){OpenLayers.Renderer.prototype.setExtent.apply(this,arguments);return!1},eraseGeometry:function(e,t){this.eraseFeatures(this.features[t][0])},supported:function(){return OpenLayers.CANVAS_SUPPORTED},setSize:function(e){this.size=e.clone();var t=this.root;t.style.width=e.w+"px";t.style.height=e.h+"px";t.width=e.w;t.height=e.h;this.resolution=null;if(this.hitDetection){var n=this.hitCanvas;n.style.width=e.w+"px";n.style.height=e.h+"px";n.width=e.w;n.height=e.h}},drawFeature:function(e,t){var n;if(e.geometry){t=this.applyDefaultSymbolizer(t||e.style);var r,i=e.geometry.getBounds();this.map.baseLayer&&this.map.baseLayer.wrapDateLine&&(r=this.map.getMaxExtent());var a=i&&i.intersectsBounds(this.extent,{worldBounds:r});n="none"!==t.display&&!!i&&a;n?this.features[e.id]=[e,t]:delete this.features[e.id];this.pendingRedraw=!0}if(this.pendingRedraw&&!this.locked){this.redraw();this.pendingRedraw=!1}return n},drawGeometry:function(e,t,n){var r=e.CLASS_NAME;if("OpenLayers.Geometry.Collection"!=r&&"OpenLayers.Geometry.MultiPoint"!=r&&"OpenLayers.Geometry.MultiLineString"!=r&&"OpenLayers.Geometry.MultiPolygon"!=r)switch(e.CLASS_NAME){case"OpenLayers.Geometry.Point":this.drawPoint(e,t,n);break;case"OpenLayers.Geometry.LineString":this.drawLineString(e,t,n);break;case"OpenLayers.Geometry.LinearRing":this.drawLinearRing(e,t,n);break;case"OpenLayers.Geometry.Polygon":this.drawPolygon(e,t,n)}else for(var i=0;i<e.components.length;i++)this.drawGeometry(e.components[i],t,n)},drawExternalGraphic:function(e,t,n){var r=new Image,i=t.title||t.graphicTitle;i&&(r.title=i);var a=t.graphicWidth||t.graphicHeight,s=t.graphicHeight||t.graphicWidth;a=a?a:2*t.pointRadius;s=s?s:2*t.pointRadius;var o=void 0!=t.graphicXOffset?t.graphicXOffset:-(.5*a),l=void 0!=t.graphicYOffset?t.graphicYOffset:-(.5*s),c=t.graphicOpacity||t.fillOpacity,u=function(){if(this.features[n]){var t=this.getLocalXY(e),i=t[0],u=t[1];if(!isNaN(i)&&!isNaN(u)){var h=i+o|0,p=u+l|0,d=this.canvas;d.globalAlpha=c;var f=OpenLayers.Renderer.Canvas.drawImageScaleFactor||(OpenLayers.Renderer.Canvas.drawImageScaleFactor=/android 2.1/.test(navigator.userAgent.toLowerCase())?320/window.screen.width:1);d.drawImage(r,h*f,p*f,a*f,s*f);if(this.hitDetection){this.setHitContextStyle("fill",n);this.hitContext.fillRect(h,p,a,s)}}}};r.onload=OpenLayers.Function.bind(u,this);r.src=t.externalGraphic},drawNamedSymbol:function(e,t,n){var r,i,a,s,o,l,c,u,h,p=Math.PI/180,d=OpenLayers.Renderer.symbol[t.graphicName];if(!d)throw new Error(t.graphicName+" is not a valid symbol name");if(d.length&&!(d.length<2)){var f=this.getLocalXY(e),m=f[0],y=f[1];if(!isNaN(m)&&!isNaN(y)){this.canvas.lineCap="round";this.canvas.lineJoin="round";if(this.hitDetection){this.hitContext.lineCap="round";this.hitContext.lineJoin="round"}if(t.graphicName in this.cachedSymbolBounds)l=this.cachedSymbolBounds[t.graphicName];else{l=new OpenLayers.Bounds;for(o=0;o<d.length;o+=2)l.extend(new OpenLayers.LonLat(d[o],d[o+1]));this.cachedSymbolBounds[t.graphicName]=l}this.canvas.save();this.hitDetection&&this.hitContext.save();this.canvas.translate(m,y);this.hitDetection&&this.hitContext.translate(m,y);u=p*t.rotation;if(!isNaN(u)){this.canvas.rotate(u);this.hitDetection&&this.hitContext.rotate(u)}c=2*t.pointRadius/Math.max(l.getWidth(),l.getHeight());this.canvas.scale(c,c);this.hitDetection&&this.hitContext.scale(c,c);a=l.getCenterLonLat().lon;s=l.getCenterLonLat().lat;this.canvas.translate(-a,-s);this.hitDetection&&this.hitContext.translate(-a,-s);h=t.strokeWidth;t.strokeWidth=h/c;if(t.fill!==!1){this.setCanvasStyle("fill",t);this.canvas.beginPath();for(o=0;o<d.length;o+=2){r=d[o];i=d[o+1];0==o&&this.canvas.moveTo(r,i);this.canvas.lineTo(r,i)}this.canvas.closePath();this.canvas.fill();if(this.hitDetection){this.setHitContextStyle("fill",n,t);this.hitContext.beginPath();for(o=0;o<d.length;o+=2){r=d[o];i=d[o+1];0==o&&this.canvas.moveTo(r,i);this.hitContext.lineTo(r,i)}this.hitContext.closePath();this.hitContext.fill()}}if(t.stroke!==!1){this.setCanvasStyle("stroke",t);this.canvas.beginPath();for(o=0;o<d.length;o+=2){r=d[o];i=d[o+1];0==o&&this.canvas.moveTo(r,i);this.canvas.lineTo(r,i)}this.canvas.closePath();this.canvas.stroke();if(this.hitDetection){this.setHitContextStyle("stroke",n,t,c);this.hitContext.beginPath();for(o=0;o<d.length;o+=2){r=d[o];i=d[o+1];0==o&&this.hitContext.moveTo(r,i);this.hitContext.lineTo(r,i)}this.hitContext.closePath();this.hitContext.stroke()}}t.strokeWidth=h;this.canvas.restore();this.hitDetection&&this.hitContext.restore();this.setCanvasStyle("reset")}}},setCanvasStyle:function(e,t){if("fill"===e){this.canvas.globalAlpha=t.fillOpacity;this.canvas.fillStyle=t.fillColor}else if("stroke"===e){this.canvas.globalAlpha=t.strokeOpacity;this.canvas.strokeStyle=t.strokeColor;this.canvas.lineWidth=t.strokeWidth}else{this.canvas.globalAlpha=0;this.canvas.lineWidth=1}},featureIdToHex:function(e){var t=Number(e.split("_").pop())+1;if(t>=16777216){this.hitOverflow=t-16777215;t=t%16777216+1}var n="000000"+t.toString(16),r=n.length;n="#"+n.substring(r-6,r);return n},setHitContextStyle:function(e,t,n,r){var i=this.featureIdToHex(t);if("fill"==e){this.hitContext.globalAlpha=1;this.hitContext.fillStyle=i}else if("stroke"==e){this.hitContext.globalAlpha=1;this.hitContext.strokeStyle=i;"undefined"==typeof r?this.hitContext.lineWidth=n.strokeWidth+2:isNaN(r)||(this.hitContext.lineWidth=n.strokeWidth+2/r)}else{this.hitContext.globalAlpha=0;this.hitContext.lineWidth=1}},drawPoint:function(e,t,n){if(t.graphic!==!1)if(t.externalGraphic)this.drawExternalGraphic(e,t,n);else if(t.graphicName&&"circle"!=t.graphicName)this.drawNamedSymbol(e,t,n);else{var r=this.getLocalXY(e),i=r[0],a=r[1];if(!isNaN(i)&&!isNaN(a)){var s=2*Math.PI,o=t.pointRadius;if(t.fill!==!1){this.setCanvasStyle("fill",t);this.canvas.beginPath();this.canvas.arc(i,a,o,0,s,!0);this.canvas.fill();if(this.hitDetection){this.setHitContextStyle("fill",n,t);this.hitContext.beginPath();this.hitContext.arc(i,a,o,0,s,!0);this.hitContext.fill()}}if(t.stroke!==!1){this.setCanvasStyle("stroke",t);this.canvas.beginPath();this.canvas.arc(i,a,o,0,s,!0);this.canvas.stroke();if(this.hitDetection){this.setHitContextStyle("stroke",n,t);this.hitContext.beginPath();this.hitContext.arc(i,a,o,0,s,!0);this.hitContext.stroke()}this.setCanvasStyle("reset")}}}},drawLineString:function(e,t,n){t=OpenLayers.Util.applyDefaults({fill:!1},t);this.drawLinearRing(e,t,n)},drawLinearRing:function(e,t,n){if(t.fill!==!1){this.setCanvasStyle("fill",t);this.renderPath(this.canvas,e,t,n,"fill");if(this.hitDetection){this.setHitContextStyle("fill",n,t);this.renderPath(this.hitContext,e,t,n,"fill")}}if(t.stroke!==!1){this.setCanvasStyle("stroke",t);this.renderPath(this.canvas,e,t,n,"stroke");if(this.hitDetection){this.setHitContextStyle("stroke",n,t);this.renderPath(this.hitContext,e,t,n,"stroke")}}this.setCanvasStyle("reset")},renderPath:function(e,t,n,r,i){var a=t.components,s=a.length;e.beginPath();var o=this.getLocalXY(a[0]),l=o[0],c=o[1];if(!isNaN(l)&&!isNaN(c)){e.moveTo(o[0],o[1]);for(var u=1;s>u;++u){var h=this.getLocalXY(a[u]);e.lineTo(h[0],h[1])}"fill"===i?e.fill():e.stroke()}},drawPolygon:function(e,t,n){var r=e.components,i=r.length;this.drawLinearRing(r[0],t,n);for(var a=1;i>a;++a){this.canvas.globalCompositeOperation="destination-out";this.hitDetection&&(this.hitContext.globalCompositeOperation="destination-out");this.drawLinearRing(r[a],OpenLayers.Util.applyDefaults({stroke:!1,fillOpacity:1},t),n);this.canvas.globalCompositeOperation="source-over";this.hitDetection&&(this.hitContext.globalCompositeOperation="source-over");this.drawLinearRing(r[a],OpenLayers.Util.applyDefaults({fill:!1},t),n)}},drawText:function(e,t){var n=this.getLocalXY(e);this.setCanvasStyle("reset");this.canvas.fillStyle=t.fontColor;this.canvas.globalAlpha=t.fontOpacity||1;var r=[t.fontStyle?t.fontStyle:"normal","normal",t.fontWeight?t.fontWeight:"normal",t.fontSize?t.fontSize:"1em",t.fontFamily?t.fontFamily:"sans-serif"].join(" "),i=t.label.split("\n"),a=i.length;if(this.canvas.fillText){this.canvas.font=r;this.canvas.textAlign=OpenLayers.Renderer.Canvas.LABEL_ALIGN[t.labelAlign[0]]||"center";this.canvas.textBaseline=OpenLayers.Renderer.Canvas.LABEL_ALIGN[t.labelAlign[1]]||"middle";var s=OpenLayers.Renderer.Canvas.LABEL_FACTOR[t.labelAlign[1]];null==s&&(s=-.5);var o=this.canvas.measureText("Mg").height||this.canvas.measureText("xx").width;n[1]+=o*s*(a-1);for(var l=0;a>l;l++){if(t.labelOutlineWidth){this.canvas.save();this.canvas.globalAlpha=t.labelOutlineOpacity||t.fontOpacity||1;this.canvas.strokeStyle=t.labelOutlineColor;this.canvas.lineWidth=t.labelOutlineWidth;this.canvas.strokeText(i[l],n[0],n[1]+o*l+1);this.canvas.restore()}this.canvas.fillText(i[l],n[0],n[1]+o*l)}}else if(this.canvas.mozDrawText){this.canvas.mozTextStyle=r;var c=OpenLayers.Renderer.Canvas.LABEL_FACTOR[t.labelAlign[0]];null==c&&(c=-.5);var s=OpenLayers.Renderer.Canvas.LABEL_FACTOR[t.labelAlign[1]];null==s&&(s=-.5);var o=this.canvas.mozMeasureText("xx");n[1]+=o*(1+s*a);for(var l=0;a>l;l++){var u=n[0]+c*this.canvas.mozMeasureText(i[l]),h=n[1]+l*o;this.canvas.translate(u,h);this.canvas.mozDrawText(i[l]);this.canvas.translate(-u,-h)}}this.setCanvasStyle("reset")},getLocalXY:function(e){var t=this.getResolution(),n=this.extent,r=(e.x-this.featureDx)/t+-n.left/t,i=n.top/t-e.y/t;return[r,i]},clear:function(){var e=this.root.height,t=this.root.width;this.canvas.clearRect(0,0,t,e);this.features={};this.hitDetection&&this.hitContext.clearRect(0,0,t,e)},getFeatureIdFromEvent:function(e){var t,n;if(this.hitDetection&&"none"!==this.root.style.display&&!this.map.dragging){var r=e.xy,i=0|r.x,a=0|r.y,s=this.hitContext.getImageData(i,a,1,1).data;if(255===s[3]){var o=s[2]+256*(s[1]+256*s[0]);if(o){t="OpenLayers_Feature_Vector_"+(o-1+this.hitOverflow);try{n=this.features[t][0]}catch(l){}}}}return n},eraseFeatures:function(e){OpenLayers.Util.isArray(e)||(e=[e]);for(var t=0;t<e.length;++t)delete this.features[e[t].id];this.redraw()},redraw:function(){if(!this.locked){var e=this.root.height,t=this.root.width;this.canvas.clearRect(0,0,t,e);this.hitDetection&&this.hitContext.clearRect(0,0,t,e);var n,r,i,a=[],s=this.map.baseLayer&&this.map.baseLayer.wrapDateLine&&this.map.getMaxExtent();for(var o in this.features)if(this.features.hasOwnProperty(o)){n=this.features[o][0];r=n.geometry;this.calculateFeatureDx(r.getBounds(),s);i=this.features[o][1];this.drawGeometry(r,i,n.id);i.label&&a.push([n,i])}for(var l,c=0,u=a.length;u>c;++c){l=a[c];this.drawText(l[0].geometry.getCentroid(),l[1])}}},CLASS_NAME:"OpenLayers.Renderer.Canvas"});OpenLayers.Renderer.Canvas.LABEL_ALIGN={l:"left",r:"right",t:"top",b:"bottom"};OpenLayers.Renderer.Canvas.LABEL_FACTOR={l:0,r:-1,t:0,b:-1};OpenLayers.Renderer.Canvas.drawImageScaleFactor=null;OpenLayers.Handler.MouseWheel=OpenLayers.Class(OpenLayers.Handler,{wheelListener:null,interval:0,maxDelta:Number.POSITIVE_INFINITY,delta:0,cumulative:!0,initialize:function(e,t,n){OpenLayers.Handler.prototype.initialize.apply(this,arguments);this.wheelListener=OpenLayers.Function.bindAsEventListener(this.onWheelEvent,this)},destroy:function(){OpenLayers.Handler.prototype.destroy.apply(this,arguments);this.wheelListener=null},onWheelEvent:function(e){if(this.map&&this.checkModifiers(e)){for(var t=!1,n=!1,r=!1,i=OpenLayers.Event.element(e);null!=i&&!r&&!t;){if(!t)try{var a;if(i.currentStyle)a=i.currentStyle.overflow;else{var s=document.defaultView.getComputedStyle(i,null);a=s.getPropertyValue("overflow")}t=a&&"auto"==a||"scroll"==a}catch(o){}if(!n){n=OpenLayers.Element.hasClass(i,"olScrollable");if(!n)for(var l=0,c=this.map.layers.length;c>l;l++){var u=this.map.layers[l];if(i==u.div||i==u.pane){n=!0;break}}}r=i==this.map.div;i=i.parentNode}if(!t&&r){if(n){var h=0;if(e.wheelDelta){h=e.wheelDelta;h%160===0&&(h=.75*h);h/=120}else e.detail&&(h=-(e.detail/Math.abs(e.detail)));this.delta+=h;window.clearTimeout(this._timeoutId);if(this.interval&&Math.abs(this.delta)<this.maxDelta){var p=OpenLayers.Util.extend({},e);this._timeoutId=window.setTimeout(OpenLayers.Function.bind(function(){this.wheelZoom(p)},this),this.interval)}else this.wheelZoom(e)}OpenLayers.Event.stop(e)}}},wheelZoom:function(e){var t=this.delta;this.delta=0;if(t){e.xy=this.map.events.getMousePosition(e);0>t?this.callback("down",[e,this.cumulative?Math.max(-this.maxDelta,t):-1]):this.callback("up",[e,this.cumulative?Math.min(this.maxDelta,t):1])}},activate:function(e){if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){var t=this.wheelListener;OpenLayers.Event.observe(window,"DOMMouseScroll",t);OpenLayers.Event.observe(window,"mousewheel",t);OpenLayers.Event.observe(document,"mousewheel",t);return!0}return!1},deactivate:function(e){if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){var t=this.wheelListener;OpenLayers.Event.stopObserving(window,"DOMMouseScroll",t);OpenLayers.Event.stopObserving(window,"mousewheel",t);OpenLayers.Event.stopObserving(document,"mousewheel",t);return!0}return!1},CLASS_NAME:"OpenLayers.Handler.MouseWheel"});OpenLayers.Format.WMSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.1.1",profile:null,CLASS_NAME:"OpenLayers.Format.WMSCapabilities"});OpenLayers.Format.WMSCapabilities.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{wms:"http://www.opengis.net/wms",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"wms",read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));var t=e;e&&9==e.nodeType&&(e=e.documentElement);var n={};this.readNode(e,n);if(void 0===n.service){var r=new OpenLayers.Format.OGCExceptionReport;n.error=r.read(t)}return n},readers:{wms:{Service:function(e,t){t.service={};this.readChildNodes(e,t.service)},Name:function(e,t){t.name=this.getChildValue(e)},Title:function(e,t){t.title=this.getChildValue(e)},Abstract:function(e,t){t["abstract"]=this.getChildValue(e)},BoundingBox:function(e,t){var n={};n.bbox=[parseFloat(e.getAttribute("minx")),parseFloat(e.getAttribute("miny")),parseFloat(e.getAttribute("maxx")),parseFloat(e.getAttribute("maxy"))];var r={x:parseFloat(e.getAttribute("resx")),y:parseFloat(e.getAttribute("resy"))};isNaN(r.x)&&isNaN(r.y)||(n.res=r);return n},OnlineResource:function(e,t){t.href=this.getAttributeNS(e,this.namespaces.xlink,"href")},ContactInformation:function(e,t){t.contactInformation={};this.readChildNodes(e,t.contactInformation)},ContactPersonPrimary:function(e,t){t.personPrimary={};this.readChildNodes(e,t.personPrimary)},ContactPerson:function(e,t){t.person=this.getChildValue(e)},ContactOrganization:function(e,t){t.organization=this.getChildValue(e)},ContactPosition:function(e,t){t.position=this.getChildValue(e)},ContactAddress:function(e,t){t.contactAddress={};this.readChildNodes(e,t.contactAddress)},AddressType:function(e,t){t.type=this.getChildValue(e)},Address:function(e,t){t.address=this.getChildValue(e)},City:function(e,t){t.city=this.getChildValue(e)},StateOrProvince:function(e,t){t.stateOrProvince=this.getChildValue(e)},PostCode:function(e,t){t.postcode=this.getChildValue(e)},Country:function(e,t){t.country=this.getChildValue(e)},ContactVoiceTelephone:function(e,t){t.phone=this.getChildValue(e)},ContactFacsimileTelephone:function(e,t){t.fax=this.getChildValue(e)},ContactElectronicMailAddress:function(e,t){t.email=this.getChildValue(e)},Fees:function(e,t){var n=this.getChildValue(e);n&&"none"!=n.toLowerCase()&&(t.fees=n)},AccessConstraints:function(e,t){var n=this.getChildValue(e);n&&"none"!=n.toLowerCase()&&(t.accessConstraints=n)},Capability:function(e,t){t.capability={nestedLayers:[],layers:[]};this.readChildNodes(e,t.capability)},Request:function(e,t){t.request={};this.readChildNodes(e,t.request)},GetCapabilities:function(e,t){t.getcapabilities={formats:[]};this.readChildNodes(e,t.getcapabilities)},Format:function(e,t){OpenLayers.Util.isArray(t.formats)?t.formats.push(this.getChildValue(e)):t.format=this.getChildValue(e)},DCPType:function(e,t){this.readChildNodes(e,t)},HTTP:function(e,t){this.readChildNodes(e,t)},Get:function(e,t){t.get={};this.readChildNodes(e,t.get);t.href||(t.href=t.get.href)},Post:function(e,t){t.post={};this.readChildNodes(e,t.post);t.href||(t.href=t.get.href)},GetMap:function(e,t){t.getmap={formats:[]};this.readChildNodes(e,t.getmap)},GetFeatureInfo:function(e,t){t.getfeatureinfo={formats:[]};this.readChildNodes(e,t.getfeatureinfo)},Exception:function(e,t){t.exception={formats:[]};this.readChildNodes(e,t.exception)},Layer:function(e,t){var n,r;if(t.capability){r=t.capability;n=t}else r=t;var i=e.getAttributeNode("queryable"),a=i&&i.specified?e.getAttribute("queryable"):null;i=e.getAttributeNode("cascaded");var s=i&&i.specified?e.getAttribute("cascaded"):null;i=e.getAttributeNode("opaque");var o=i&&i.specified?e.getAttribute("opaque"):null,l=e.getAttribute("noSubsets"),c=e.getAttribute("fixedWidth"),u=e.getAttribute("fixedHeight"),h=n||{},p=OpenLayers.Util.extend,d={nestedLayers:[],styles:n?[].concat(n.styles):[],srs:n?p({},h.srs):{},metadataURLs:[],bbox:n?p({},h.bbox):{},llbbox:h.llbbox,dimensions:n?p({},h.dimensions):{},authorityURLs:n?p({},h.authorityURLs):{},identifiers:{},keywords:[],queryable:a&&""!==a?"1"===a||"true"===a:h.queryable||!1,cascaded:null!==s?parseInt(s):h.cascaded||0,opaque:o?"1"===o||"true"===o:h.opaque||!1,noSubsets:null!==l?"1"===l||"true"===l:h.noSubsets||!1,fixedWidth:null!=c?parseInt(c):h.fixedWidth||0,fixedHeight:null!=u?parseInt(u):h.fixedHeight||0,minScale:h.minScale,maxScale:h.maxScale,attribution:h.attribution};t.nestedLayers.push(d);d.capability=r;this.readChildNodes(e,d);delete d.capability;if(d.name){var f=d.name.split(":"),m=r.request,y=m.getfeatureinfo;f.length>0&&(d.prefix=f[0]);r.layers.push(d);void 0===d.formats&&(d.formats=m.getmap.formats);void 0===d.infoFormats&&y&&(d.infoFormats=y.formats)}},Attribution:function(e,t){t.attribution={};this.readChildNodes(e,t.attribution)},LogoURL:function(e,t){t.logo={width:e.getAttribute("width"),height:e.getAttribute("height")};this.readChildNodes(e,t.logo)},Style:function(e,t){var n={};t.styles.push(n);this.readChildNodes(e,n)},LegendURL:function(e,t){var n={width:e.getAttribute("width"),height:e.getAttribute("height")};t.legend=n;this.readChildNodes(e,n)},MetadataURL:function(e,t){var n={type:e.getAttribute("type")};t.metadataURLs.push(n);this.readChildNodes(e,n)},DataURL:function(e,t){t.dataURL={};this.readChildNodes(e,t.dataURL)},FeatureListURL:function(e,t){t.featureListURL={};this.readChildNodes(e,t.featureListURL)},AuthorityURL:function(e,t){var n=e.getAttribute("name"),r={};this.readChildNodes(e,r);t.authorityURLs[n]=r.href},Identifier:function(e,t){var n=e.getAttribute("authority");t.identifiers[n]=this.getChildValue(e)},KeywordList:function(e,t){this.readChildNodes(e,t)},SRS:function(e,t){t.srs[this.getChildValue(e)]=!0}}},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1"});OpenLayers.Format.WMSCapabilities.v1_3=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1,{readers:{wms:OpenLayers.Util.applyDefaults({WMS_Capabilities:function(e,t){this.readChildNodes(e,t)},LayerLimit:function(e,t){t.layerLimit=parseInt(this.getChildValue(e))},MaxWidth:function(e,t){t.maxWidth=parseInt(this.getChildValue(e))},MaxHeight:function(e,t){t.maxHeight=parseInt(this.getChildValue(e))},BoundingBox:function(e,t){var n=OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms.BoundingBox.apply(this,[e,t]);n.srs=e.getAttribute("CRS");t.bbox[n.srs]=n},CRS:function(e,t){this.readers.wms.SRS.apply(this,[e,t])},EX_GeographicBoundingBox:function(e,t){t.llbbox=[];this.readChildNodes(e,t.llbbox)},westBoundLongitude:function(e,t){t[0]=this.getChildValue(e)},eastBoundLongitude:function(e,t){t[2]=this.getChildValue(e)},southBoundLatitude:function(e,t){t[1]=this.getChildValue(e)},northBoundLatitude:function(e,t){t[3]=this.getChildValue(e)},MinScaleDenominator:function(e,t){t.maxScale=parseFloat(this.getChildValue(e)).toPrecision(16)},MaxScaleDenominator:function(e,t){t.minScale=parseFloat(this.getChildValue(e)).toPrecision(16)},Dimension:function(e,t){var n=e.getAttribute("name").toLowerCase(),r={name:n,units:e.getAttribute("units"),unitsymbol:e.getAttribute("unitSymbol"),nearestVal:"1"===e.getAttribute("nearestValue"),multipleVal:"1"===e.getAttribute("multipleValues"),"default":e.getAttribute("default")||"",current:"1"===e.getAttribute("current"),values:this.getChildValue(e).split(",")};t.dimensions[r.name]=r},Keyword:function(e,t){var n={value:this.getChildValue(e),vocabulary:e.getAttribute("vocabulary")};t.keywords&&t.keywords.push(n)}},OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms),sld:{UserDefinedSymbolization:function(e,t){this.readers.wms.UserDefinedSymbolization.apply(this,[e,t]);t.userSymbols.inlineFeature=1==parseInt(e.getAttribute("InlineFeature"));t.userSymbols.remoteWCS=1==parseInt(e.getAttribute("RemoteWCS"))},DescribeLayer:function(e,t){this.readers.wms.DescribeLayer.apply(this,[e,t])},GetLegendGraphic:function(e,t){this.readers.wms.GetLegendGraphic.apply(this,[e,t])}}},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_3"});OpenLayers.Format.WMSCapabilities.v1_3_0=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_3,{version:"1.3.0",CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_3_0"});OpenLayers.Format.GML.v2=OpenLayers.Class(OpenLayers.Format.GML.Base,{schemaLocation:"http://www.opengis.net/gml http://schemas.opengis.net/gml/2.1.2/feature.xsd",initialize:function(e){OpenLayers.Format.GML.Base.prototype.initialize.apply(this,[e])},readers:{gml:OpenLayers.Util.applyDefaults({outerBoundaryIs:function(e,t){var n={};this.readChildNodes(e,n);t.outer=n.components[0]},innerBoundaryIs:function(e,t){var n={};this.readChildNodes(e,n);t.inner.push(n.components[0])},Box:function(e,t){var n={};this.readChildNodes(e,n);t.components||(t.components=[]);var r=n.points[0],i=n.points[1];t.components.push(new OpenLayers.Bounds(r.x,r.y,i.x,i.y))}},OpenLayers.Format.GML.Base.prototype.readers.gml),feature:OpenLayers.Format.GML.Base.prototype.readers.feature,wfs:OpenLayers.Format.GML.Base.prototype.readers.wfs},write:function(e){var t;t=OpenLayers.Util.isArray(e)?"wfs:FeatureCollection":"gml:featureMember";var n=this.writeNode(t,e);this.setAttributeNS(n,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);return OpenLayers.Format.XML.prototype.write.apply(this,[n])},writers:{gml:OpenLayers.Util.applyDefaults({Point:function(e){var t=this.createElementNSPlus("gml:Point");this.writeNode("coordinates",[e],t);return t},coordinates:function(e){for(var t,n=e.length,r=new Array(n),i=0;n>i;++i){t=e[i];r[i]=this.xy?t.x+","+t.y:t.y+","+t.x;void 0!=t.z&&(r[i]+=","+t.z)}return this.createElementNSPlus("gml:coordinates",{attributes:{decimal:".",cs:",",ts:" "},value:1==n?r[0]:r.join(" ")})},LineString:function(e){var t=this.createElementNSPlus("gml:LineString");this.writeNode("coordinates",e.components,t);return t},Polygon:function(e){var t=this.createElementNSPlus("gml:Polygon");this.writeNode("outerBoundaryIs",e.components[0],t);for(var n=1;n<e.components.length;++n)this.writeNode("innerBoundaryIs",e.components[n],t);return t},outerBoundaryIs:function(e){var t=this.createElementNSPlus("gml:outerBoundaryIs");this.writeNode("LinearRing",e,t);return t},innerBoundaryIs:function(e){var t=this.createElementNSPlus("gml:innerBoundaryIs");this.writeNode("LinearRing",e,t);return t},LinearRing:function(e){var t=this.createElementNSPlus("gml:LinearRing");this.writeNode("coordinates",e.components,t);return t},Box:function(e){var t=this.createElementNSPlus("gml:Box");this.writeNode("coordinates",[{x:e.left,y:e.bottom},{x:e.right,y:e.top}],t);this.srsName&&t.setAttribute("srsName",this.srsName);return t}},OpenLayers.Format.GML.Base.prototype.writers.gml),feature:OpenLayers.Format.GML.Base.prototype.writers.feature,wfs:OpenLayers.Format.GML.Base.prototype.writers.wfs},CLASS_NAME:"OpenLayers.Format.GML.v2"});OpenLayers.Format.Filter.v1_0_0=OpenLayers.Class(OpenLayers.Format.GML.v2,OpenLayers.Format.Filter.v1,{VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/ogc/filter/1.0.0/filter.xsd",initialize:function(e){OpenLayers.Format.GML.v2.prototype.initialize.apply(this,[e])},readers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(e,t){var n=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO});this.readChildNodes(e,n);t.filters.push(n)},PropertyIsNotEqualTo:function(e,t){var n=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.NOT_EQUAL_TO});this.readChildNodes(e,n);t.filters.push(n)},PropertyIsLike:function(e,t){var n=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE});this.readChildNodes(e,n);var r=e.getAttribute("wildCard"),i=e.getAttribute("singleChar"),a=e.getAttribute("escape");n.value2regex(r,i,a);t.filters.push(n)}},OpenLayers.Format.Filter.v1.prototype.readers.ogc),gml:OpenLayers.Format.GML.v2.prototype.readers.gml,feature:OpenLayers.Format.GML.v2.prototype.readers.feature},writers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(e){var t=this.createElementNSPlus("ogc:PropertyIsEqualTo");this.writeNode("PropertyName",e,t);this.writeOgcExpression(e.value,t);return t},PropertyIsNotEqualTo:function(e){var t=this.createElementNSPlus("ogc:PropertyIsNotEqualTo");this.writeNode("PropertyName",e,t);this.writeOgcExpression(e.value,t);return t},PropertyIsLike:function(e){var t=this.createElementNSPlus("ogc:PropertyIsLike",{attributes:{wildCard:"*",singleChar:".",escape:"!"}});this.writeNode("PropertyName",e,t);this.writeNode("Literal",e.regex2value(),t);return t},BBOX:function(e){var t=this.createElementNSPlus("ogc:BBOX");e.property&&this.writeNode("PropertyName",e,t);var n=this.writeNode("gml:Box",e.value,t);e.projection&&n.setAttribute("srsName",e.projection);return t}},OpenLayers.Format.Filter.v1.prototype.writers.ogc),gml:OpenLayers.Format.GML.v2.prototype.writers.gml,feature:OpenLayers.Format.GML.v2.prototype.writers.feature},writeSpatial:function(e,t){var n=this.createElementNSPlus("ogc:"+t);this.writeNode("PropertyName",e,n);if(e.value instanceof OpenLayers.Filter.Function)this.writeNode("Function",e.value,n);else{var r;r=e.value instanceof OpenLayers.Geometry?this.writeNode("feature:_geometry",e.value).firstChild:this.writeNode("gml:Box",e.value);e.projection&&r.setAttribute("srsName",e.projection);n.appendChild(r)}return n},CLASS_NAME:"OpenLayers.Format.Filter.v1_0_0"});OpenLayers.Format.WFST.v1_0_0=OpenLayers.Class(OpenLayers.Format.Filter.v1_0_0,OpenLayers.Format.WFST.v1,{version:"1.0.0",srsNameInQuery:!1,schemaLocations:{wfs:"http://schemas.opengis.net/wfs/1.0.0/WFS-transaction.xsd"},initialize:function(e){OpenLayers.Format.Filter.v1_0_0.prototype.initialize.apply(this,[e]);OpenLayers.Format.WFST.v1.prototype.initialize.apply(this,[e])},readNode:function(e,t,n){return OpenLayers.Format.GML.v2.prototype.readNode.apply(this,arguments)},readers:{wfs:OpenLayers.Util.applyDefaults({WFS_TransactionResponse:function(e,t){t.insertIds=[];t.success=!1;this.readChildNodes(e,t)},InsertResult:function(e,t){var n={fids:[]};this.readChildNodes(e,n);t.insertIds=t.insertIds.concat(n.fids)},TransactionResult:function(e,t){this.readChildNodes(e,t)},Status:function(e,t){this.readChildNodes(e,t)},SUCCESS:function(e,t){t.success=!0}},OpenLayers.Format.WFST.v1.prototype.readers.wfs),gml:OpenLayers.Format.GML.v2.prototype.readers.gml,feature:OpenLayers.Format.GML.v2.prototype.readers.feature,ogc:OpenLayers.Format.Filter.v1_0_0.prototype.readers.ogc},writers:{wfs:OpenLayers.Util.applyDefaults({Query:function(e){e=OpenLayers.Util.extend({featureNS:this.featureNS,featurePrefix:this.featurePrefix,featureType:this.featureType,srsName:this.srsName,srsNameInQuery:this.srsNameInQuery},e);var t=e.featurePrefix,n=this.createElementNSPlus("wfs:Query",{attributes:{typeName:(t?t+":":"")+e.featureType}});e.srsNameInQuery&&e.srsName&&n.setAttribute("srsName",e.srsName);e.featureNS&&n.setAttribute("xmlns:"+t,e.featureNS);if(e.propertyNames)for(var r=0,i=e.propertyNames.length;i>r;r++)this.writeNode("ogc:PropertyName",{property:e.propertyNames[r]},n);if(e.filter){this.setFilterProperty(e.filter);this.writeNode("ogc:Filter",e.filter,n)}return n}},OpenLayers.Format.WFST.v1.prototype.writers.wfs),gml:OpenLayers.Format.GML.v2.prototype.writers.gml,feature:OpenLayers.Format.GML.v2.prototype.writers.feature,ogc:OpenLayers.Format.Filter.v1_0_0.prototype.writers.ogc},CLASS_NAME:"OpenLayers.Format.WFST.v1_0_0"});OpenLayers.ElementsIndexer=OpenLayers.Class({maxZIndex:null,order:null,indices:null,compare:null,initialize:function(e){this.compare=e?OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER_Y_ORDER:OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER_DRAWING_ORDER;this.clear()},insert:function(e){this.exists(e)&&this.remove(e);var t=e.id;this.determineZIndex(e);for(var n,r=-1,i=this.order.length;i-r>1;){n=parseInt((r+i)/2);var a=this.compare(this,e,OpenLayers.Util.getElement(this.order[n]));a>0?r=n:i=n}this.order.splice(i,0,t);this.indices[t]=this.getZIndex(e);return this.getNextElement(i)},remove:function(e){var t=e.id,n=OpenLayers.Util.indexOf(this.order,t);if(n>=0){this.order.splice(n,1);delete this.indices[t];if(this.order.length>0){var r=this.order[this.order.length-1];this.maxZIndex=this.indices[r]}else this.maxZIndex=0}},clear:function(){this.order=[];this.indices={};this.maxZIndex=0},exists:function(e){return null!=this.indices[e.id]},getZIndex:function(e){return e._style.graphicZIndex},determineZIndex:function(e){var t=e._style.graphicZIndex;if(null==t){t=this.maxZIndex;e._style.graphicZIndex=t}else t>this.maxZIndex&&(this.maxZIndex=t)},getNextElement:function(e){var t=e+1;if(t<this.order.length){var n=OpenLayers.Util.getElement(this.order[t]);void 0==n&&(n=this.getNextElement(t));return n}return null},CLASS_NAME:"OpenLayers.ElementsIndexer"});OpenLayers.ElementsIndexer.IndexingMethods={Z_ORDER:function(e,t,n){var r=e.getZIndex(t),i=0;if(n){var a=e.getZIndex(n);i=r-a}return i},Z_ORDER_DRAWING_ORDER:function(e,t,n){var r=OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER(e,t,n);n&&0==r&&(r=1);return r},Z_ORDER_Y_ORDER:function(e,t,n){
var r=OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER(e,t,n);if(n&&0===r){var i=n._boundsBottom-t._boundsBottom;r=0===i?1:i}return r}};OpenLayers.Renderer.Elements=OpenLayers.Class(OpenLayers.Renderer,{rendererRoot:null,root:null,vectorRoot:null,textRoot:null,xmlns:null,xOffset:0,indexer:null,BACKGROUND_ID_SUFFIX:"_background",LABEL_ID_SUFFIX:"_label",LABEL_OUTLINE_SUFFIX:"_outline",initialize:function(e,t){OpenLayers.Renderer.prototype.initialize.apply(this,arguments);this.rendererRoot=this.createRenderRoot();this.root=this.createRoot("_root");this.vectorRoot=this.createRoot("_vroot");this.textRoot=this.createRoot("_troot");this.root.appendChild(this.vectorRoot);this.root.appendChild(this.textRoot);this.rendererRoot.appendChild(this.root);this.container.appendChild(this.rendererRoot);t&&(t.zIndexing||t.yOrdering)&&(this.indexer=new OpenLayers.ElementsIndexer(t.yOrdering))},destroy:function(){this.clear();this.rendererRoot=null;this.root=null;this.xmlns=null;OpenLayers.Renderer.prototype.destroy.apply(this,arguments)},clear:function(){var e,t=this.vectorRoot;if(t)for(;e=t.firstChild;)t.removeChild(e);t=this.textRoot;if(t)for(;e=t.firstChild;)t.removeChild(e);this.indexer&&this.indexer.clear()},setExtent:function(e,t){var n=OpenLayers.Renderer.prototype.setExtent.apply(this,arguments),r=this.getResolution();if(this.map.baseLayer&&this.map.baseLayer.wrapDateLine){var i,a=e.getWidth()/this.map.getExtent().getWidth(),e=e.scale(1/a),s=this.map.getMaxExtent();s.right>e.left&&s.right<e.right?i=!0:s.left>e.left&&s.left<e.right&&(i=!1);if(i!==this.rightOfDateLine||t){n=!1;this.xOffset=i===!0?s.getWidth()/r:0}this.rightOfDateLine=i}return n},getNodeType:function(e,t){},drawGeometry:function(e,t,n){var r=e.CLASS_NAME,i=!0;if("OpenLayers.Geometry.Collection"==r||"OpenLayers.Geometry.MultiPoint"==r||"OpenLayers.Geometry.MultiLineString"==r||"OpenLayers.Geometry.MultiPolygon"==r){for(var a=0,s=e.components.length;s>a;a++)i=this.drawGeometry(e.components[a],t,n)&&i;return i}i=!1;var o=!1;if("none"!=t.display){t.backgroundGraphic?this.redrawBackgroundNode(e.id,e,t,n):o=!0;i=this.redrawNode(e.id,e,t,n)}if(0==i){var l=document.getElementById(e.id);if(l){l._style.backgroundGraphic&&(o=!0);l.parentNode.removeChild(l)}}if(o){var l=document.getElementById(e.id+this.BACKGROUND_ID_SUFFIX);l&&l.parentNode.removeChild(l)}return i},redrawNode:function(e,t,n,r){n=this.applyDefaultSymbolizer(n);var i=this.nodeFactory(e,this.getNodeType(t,n));i._featureId=r;i._boundsBottom=t.getBounds().bottom;i._geometryClass=t.CLASS_NAME;i._style=n;var a=this.drawGeometryNode(i,t,n);if(a===!1)return!1;i=a.node;if(this.indexer){var s=this.indexer.insert(i);s?this.vectorRoot.insertBefore(i,s):this.vectorRoot.appendChild(i)}else i.parentNode!==this.vectorRoot&&this.vectorRoot.appendChild(i);this.postDraw(i);return a.complete},redrawBackgroundNode:function(e,t,n,r){var i=OpenLayers.Util.extend({},n);i.externalGraphic=i.backgroundGraphic;i.graphicXOffset=i.backgroundXOffset;i.graphicYOffset=i.backgroundYOffset;i.graphicZIndex=i.backgroundGraphicZIndex;i.graphicWidth=i.backgroundWidth||i.graphicWidth;i.graphicHeight=i.backgroundHeight||i.graphicHeight;i.backgroundGraphic=null;i.backgroundXOffset=null;i.backgroundYOffset=null;i.backgroundGraphicZIndex=null;return this.redrawNode(e+this.BACKGROUND_ID_SUFFIX,t,i,null)},drawGeometryNode:function(e,t,n){n=n||e._style;var r,i={isFilled:void 0===n.fill?!0:n.fill,isStroked:void 0===n.stroke?!!n.strokeWidth:n.stroke};switch(t.CLASS_NAME){case"OpenLayers.Geometry.Point":if(n.graphic===!1){i.isFilled=!1;i.isStroked=!1}r=this.drawPoint(e,t);break;case"OpenLayers.Geometry.LineString":i.isFilled=!1;r=this.drawLineString(e,t);break;case"OpenLayers.Geometry.LinearRing":r=this.drawLinearRing(e,t);break;case"OpenLayers.Geometry.Polygon":r=this.drawPolygon(e,t);break;case"OpenLayers.Geometry.Rectangle":r=this.drawRectangle(e,t)}e._options=i;return 0!=r?{node:this.setStyle(e,n,i,t),complete:r}:!1},postDraw:function(e){},drawPoint:function(e,t){},drawLineString:function(e,t){},drawLinearRing:function(e,t){},drawPolygon:function(e,t){},drawRectangle:function(e,t){},drawCircle:function(e,t){},removeText:function(e){var t=document.getElementById(e+this.LABEL_ID_SUFFIX);t&&this.textRoot.removeChild(t);var n=document.getElementById(e+this.LABEL_OUTLINE_SUFFIX);n&&this.textRoot.removeChild(n)},getFeatureIdFromEvent:function(e){var t=e.target,n=t&&t.correspondingUseElement,r=n?n:t||e.srcElement;return r._featureId},eraseGeometry:function(e,t){if("OpenLayers.Geometry.MultiPoint"==e.CLASS_NAME||"OpenLayers.Geometry.MultiLineString"==e.CLASS_NAME||"OpenLayers.Geometry.MultiPolygon"==e.CLASS_NAME||"OpenLayers.Geometry.Collection"==e.CLASS_NAME)for(var n=0,r=e.components.length;r>n;n++)this.eraseGeometry(e.components[n],t);else{var i=OpenLayers.Util.getElement(e.id);if(i&&i.parentNode){if(i.geometry){i.geometry.destroy();i.geometry=null}i.parentNode.removeChild(i);this.indexer&&this.indexer.remove(i);if(i._style.backgroundGraphic){var a=e.id+this.BACKGROUND_ID_SUFFIX,s=OpenLayers.Util.getElement(a);s&&s.parentNode&&s.parentNode.removeChild(s)}}}},nodeFactory:function(e,t){var n=OpenLayers.Util.getElement(e);if(n){if(!this.nodeTypeCompare(n,t)){n.parentNode.removeChild(n);n=this.nodeFactory(e,t)}}else n=this.createNode(t,e);return n},nodeTypeCompare:function(e,t){},createNode:function(e,t){},moveRoot:function(e){var t=this.root;e.root.parentNode==this.rendererRoot&&(t=e.root);t.parentNode.removeChild(t);e.rendererRoot.appendChild(t)},getRenderLayerId:function(){return this.root.parentNode.parentNode.id},isComplexSymbol:function(e){return"circle"!=e&&!!e},CLASS_NAME:"OpenLayers.Renderer.Elements"});OpenLayers.Strategy=OpenLayers.Class({layer:null,options:null,active:null,autoActivate:!0,autoDestroy:!0,initialize:function(e){OpenLayers.Util.extend(this,e);this.options=e;this.active=!1},destroy:function(){this.deactivate();this.layer=null;this.options=null},setLayer:function(e){this.layer=e},activate:function(){if(!this.active){this.active=!0;return!0}return!1},deactivate:function(){if(this.active){this.active=!1;return!0}return!1},CLASS_NAME:"OpenLayers.Strategy"});OpenLayers.Strategy.Fixed=OpenLayers.Class(OpenLayers.Strategy,{preload:!1,activate:function(){var e=OpenLayers.Strategy.prototype.activate.apply(this,arguments);if(e){this.layer.events.on({refresh:this.load,scope:this});1==this.layer.visibility||this.preload?this.load():this.layer.events.on({visibilitychanged:this.load,scope:this})}return e},deactivate:function(){var e=OpenLayers.Strategy.prototype.deactivate.call(this);e&&this.layer.events.un({refresh:this.load,visibilitychanged:this.load,scope:this});return e},load:function(e){var t=this.layer;t.events.triggerEvent("loadstart",{filter:t.filter});t.protocol.read(OpenLayers.Util.applyDefaults({callback:this.merge,filter:t.filter,scope:this},e));t.events.un({visibilitychanged:this.load,scope:this})},merge:function(e){var t=this.layer;t.destroyFeatures();var n=e.features;if(n&&n.length>0){var r=t.projection,i=t.map.getProjectionObject();if(!i.equals(r))for(var a,s=0,o=n.length;o>s;++s){a=n[s].geometry;a&&a.transform(r,i)}t.addFeatures(n)}t.events.triggerEvent("loadend",{response:e})},CLASS_NAME:"OpenLayers.Strategy.Fixed"});OpenLayers.Protocol=OpenLayers.Class({format:null,options:null,autoDestroy:!0,defaultFilter:null,initialize:function(e){e=e||{};OpenLayers.Util.extend(this,e);this.options=e},mergeWithDefaultFilter:function(e){var t;t=e&&this.defaultFilter?new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:[this.defaultFilter,e]}):e||this.defaultFilter||void 0;return t},destroy:function(){this.options=null;this.format=null},read:function(e){e=e||{};e.filter=this.mergeWithDefaultFilter(e.filter)},create:function(){},update:function(){},"delete":function(){},commit:function(){},abort:function(e){},createCallback:function(e,t,n){return OpenLayers.Function.bind(function(){e.apply(this,[t,n])},this)},CLASS_NAME:"OpenLayers.Protocol"});OpenLayers.Protocol.Response=OpenLayers.Class({code:null,requestType:null,last:!0,features:null,data:null,reqFeatures:null,priv:null,error:null,initialize:function(e){OpenLayers.Util.extend(this,e)},success:function(){return this.code>0},CLASS_NAME:"OpenLayers.Protocol.Response"});OpenLayers.Protocol.Response.SUCCESS=1;OpenLayers.Protocol.Response.FAILURE=0;OpenLayers.Protocol.WFS=function(e){e=OpenLayers.Util.applyDefaults(e,OpenLayers.Protocol.WFS.DEFAULTS);var t=OpenLayers.Protocol.WFS["v"+e.version.replace(/\./g,"_")];if(!t)throw"Unsupported WFS version: "+e.version;return new t(e)};OpenLayers.Protocol.WFS.fromWMSLayer=function(e,t){var n,r,i=e.params.LAYERS,a=(OpenLayers.Util.isArray(i)?i[0]:i).split(":");a.length>1&&(r=a[0]);n=a.pop();var s={url:e.url,featureType:n,featurePrefix:r,srsName:e.projection&&e.projection.getCode()||e.map&&e.map.getProjectionObject().getCode(),version:"1.1.0"};return new OpenLayers.Protocol.WFS(OpenLayers.Util.applyDefaults(t,s))};OpenLayers.Protocol.WFS.DEFAULTS={version:"1.0.0"};OpenLayers.Layer.Markers=OpenLayers.Class(OpenLayers.Layer,{isBaseLayer:!1,markers:null,drawn:!1,initialize:function(e,t){OpenLayers.Layer.prototype.initialize.apply(this,arguments);this.markers=[]},destroy:function(){this.clearMarkers();this.markers=null;OpenLayers.Layer.prototype.destroy.apply(this,arguments)},setOpacity:function(e){if(e!=this.opacity){this.opacity=e;for(var t=0,n=this.markers.length;n>t;t++)this.markers[t].setOpacity(this.opacity)}},moveTo:function(e,t,n){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);if(t||!this.drawn){for(var r=0,i=this.markers.length;i>r;r++)this.drawMarker(this.markers[r]);this.drawn=!0}},addMarker:function(e){this.markers.push(e);this.opacity<1&&e.setOpacity(this.opacity);if(this.map&&this.map.getExtent()){e.map=this.map;this.drawMarker(e)}},removeMarker:function(e){if(this.markers&&this.markers.length){OpenLayers.Util.removeItem(this.markers,e);e.erase()}},clearMarkers:function(){if(null!=this.markers)for(;this.markers.length>0;)this.removeMarker(this.markers[0])},drawMarker:function(e){var t=this.map.getLayerPxFromLonLat(e.lonlat);if(null==t)e.display(!1);else if(e.isDrawn())e.icon&&e.icon.moveTo(t);else{var n=e.draw(t);this.div.appendChild(n)}},getDataExtent:function(){var e=null;if(this.markers&&this.markers.length>0)for(var e=new OpenLayers.Bounds,t=0,n=this.markers.length;n>t;t++){var r=this.markers[t];e.extend(r.lonlat)}return e},CLASS_NAME:"OpenLayers.Layer.Markers"});OpenLayers.ProxyHost="";OpenLayers.Request||(OpenLayers.Request={});OpenLayers.Util.extend(OpenLayers.Request,{DEFAULT_CONFIG:{method:"GET",url:window.location.href,async:!0,user:void 0,password:void 0,params:null,proxy:OpenLayers.ProxyHost,headers:{},data:null,callback:function(){},success:null,failure:null,scope:null},URL_SPLIT_REGEX:/([^:]*:)\/\/([^:]*:?[^@]*@)?([^:\/\?]*):?([^\/\?]*)/,events:new OpenLayers.Events(this),makeSameOrigin:function(e,t){var n=0!==e.indexOf("http"),r=!n&&e.match(this.URL_SPLIT_REGEX);if(r){var i=window.location;n=r[1]==i.protocol&&r[3]==i.hostname;var a=r[4],s=i.port;(80!=a&&""!=a||"80"!=s&&""!=s)&&(n=n&&a==s)}n||t&&(e="function"==typeof t?t(e):t+encodeURIComponent(e));return e},issue:function(e){var t=OpenLayers.Util.extend(this.DEFAULT_CONFIG,{proxy:OpenLayers.ProxyHost});e=e||{};e.headers=e.headers||{};e=OpenLayers.Util.applyDefaults(e,t);e.headers=OpenLayers.Util.applyDefaults(e.headers,t.headers);var n,r=!1;for(n in e.headers)e.headers.hasOwnProperty(n)&&"x-requested-with"===n.toLowerCase()&&(r=!0);r===!1&&(e.headers["X-Requested-With"]="XMLHttpRequest");var i=new OpenLayers.Request.XMLHttpRequest,a=OpenLayers.Util.urlAppend(e.url,OpenLayers.Util.getParameterString(e.params||{}));a=OpenLayers.Request.makeSameOrigin(a,e.proxy);i.open(e.method,a,e.async,e.user,e.password);for(var s in e.headers)i.setRequestHeader(s,e.headers[s]);var o=this.events,l=this;i.onreadystatechange=function(){if(i.readyState==OpenLayers.Request.XMLHttpRequest.DONE){var t=o.triggerEvent("complete",{request:i,config:e,requestUrl:a});t!==!1&&l.runCallbacks({request:i,config:e,requestUrl:a})}};e.async===!1?i.send(e.data):window.setTimeout(function(){0!==i.readyState&&i.send(e.data)},0);return i},runCallbacks:function(e){var t,n=e.request,r=e.config,i=r.scope?OpenLayers.Function.bind(r.callback,r.scope):r.callback;r.success&&(t=r.scope?OpenLayers.Function.bind(r.success,r.scope):r.success);var a;r.failure&&(a=r.scope?OpenLayers.Function.bind(r.failure,r.scope):r.failure);"file:"==OpenLayers.Util.createUrlObject(r.url).protocol&&n.responseText&&(n.status=200);i(n);if(!n.status||n.status>=200&&n.status<300){this.events.triggerEvent("success",e);t&&t(n)}if(n.status&&(n.status<200||n.status>=300)){this.events.triggerEvent("failure",e);a&&a(n)}},GET:function(e){e=OpenLayers.Util.extend(e,{method:"GET"});return OpenLayers.Request.issue(e)},POST:function(e){e=OpenLayers.Util.extend(e,{method:"POST"});e.headers=e.headers?e.headers:{};"CONTENT-TYPE"in OpenLayers.Util.upperCaseObject(e.headers)||(e.headers["Content-Type"]="application/xml");return OpenLayers.Request.issue(e)},PUT:function(e){e=OpenLayers.Util.extend(e,{method:"PUT"});e.headers=e.headers?e.headers:{};"CONTENT-TYPE"in OpenLayers.Util.upperCaseObject(e.headers)||(e.headers["Content-Type"]="application/xml");return OpenLayers.Request.issue(e)},DELETE:function(e){e=OpenLayers.Util.extend(e,{method:"DELETE"});return OpenLayers.Request.issue(e)},HEAD:function(e){e=OpenLayers.Util.extend(e,{method:"HEAD"});return OpenLayers.Request.issue(e)},OPTIONS:function(e){e=OpenLayers.Util.extend(e,{method:"OPTIONS"});return OpenLayers.Request.issue(e)}});!function(){function e(){this._object=o&&!u?new o:new window.ActiveXObject("Microsoft.XMLHTTP");this._listeners=[]}function t(){return new e}function n(e){e._object.send(e._data);if(l&&!e._async){e.readyState=t.OPENED;a(e);for(;e.readyState<t.DONE;){e.readyState++;r(e);if(e._aborted)return}}}function r(e){t.onreadystatechange&&t.onreadystatechange.apply(e);e.dispatchEvent({type:"readystatechange",bubbles:!1,cancelable:!1,timeStamp:new Date+0})}function i(e){var t=e.responseXML,n=e.responseText;if(c&&n&&t&&!t.documentElement&&e.getResponseHeader("Content-Type").match(/[^\/]+\/[^\+]+\+xml/)){t=new window.ActiveXObject("Microsoft.XMLDOM");t.async=!1;t.validateOnParse=!1;t.loadXML(n)}return t&&(c&&0!=t.parseError||!t.documentElement||t.documentElement&&"parsererror"==t.documentElement.tagName)?null:t}function a(e){try{e.responseText=e._object.responseText}catch(t){}try{e.responseXML=i(e._object)}catch(t){}try{e.status=e._object.status}catch(t){}try{e.statusText=e._object.statusText}catch(t){}}function s(e){e._object.onreadystatechange=new window.Function}var o=window.XMLHttpRequest,l=!!window.controllers,c=window.document.all&&!window.opera,u=c&&window.navigator.userAgent.match(/MSIE 7.0/);t.prototype=e.prototype;l&&o.wrapped&&(t.wrapped=o.wrapped);t.UNSENT=0;t.OPENED=1;t.HEADERS_RECEIVED=2;t.LOADING=3;t.DONE=4;t.prototype.readyState=t.UNSENT;t.prototype.responseText="";t.prototype.responseXML=null;t.prototype.status=0;t.prototype.statusText="";t.prototype.priority="NORMAL";t.prototype.onreadystatechange=null;t.onreadystatechange=null;t.onopen=null;t.onsend=null;t.onabort=null;t.prototype.open=function(e,n,i,o,u){delete this._headers;arguments.length<3&&(i=!0);this._async=i;var h,p=this,d=this.readyState;if(c&&i){h=function(){if(d!=t.DONE){s(p);p.abort()}};window.attachEvent("onunload",h)}t.onopen&&t.onopen.apply(this,arguments);arguments.length>4?this._object.open(e,n,i,o,u):arguments.length>3?this._object.open(e,n,i,o):this._object.open(e,n,i);this.readyState=t.OPENED;r(this);this._object.onreadystatechange=function(){if(!l||i){p.readyState=p._object.readyState;a(p);if(p._aborted)p.readyState=t.UNSENT;else{if(p.readyState==t.DONE){delete p._data;s(p);c&&i&&window.detachEvent("onunload",h)}d!=p.readyState&&r(p);d=p.readyState}}}};t.prototype.send=function(e){t.onsend&&t.onsend.apply(this,arguments);arguments.length||(e=null);if(e&&e.nodeType){e=window.XMLSerializer?(new window.XMLSerializer).serializeToString(e):e.xml;this._headers["Content-Type"]||this._object.setRequestHeader("Content-Type","application/xml")}this._data=e;n(this)};t.prototype.abort=function(){t.onabort&&t.onabort.apply(this,arguments);this.readyState>t.UNSENT&&(this._aborted=!0);this._object.abort();s(this);this.readyState=t.UNSENT;delete this._data};t.prototype.getAllResponseHeaders=function(){return this._object.getAllResponseHeaders()};t.prototype.getResponseHeader=function(e){return this._object.getResponseHeader(e)};t.prototype.setRequestHeader=function(e,t){this._headers||(this._headers={});this._headers[e]=t;return this._object.setRequestHeader(e,t)};t.prototype.addEventListener=function(e,t,n){for(var r,i=0;r=this._listeners[i];i++)if(r[0]==e&&r[1]==t&&r[2]==n)return;this._listeners.push([e,t,n])};t.prototype.removeEventListener=function(e,t,n){for(var r,i=0;(r=this._listeners[i])&&(r[0]!=e||r[1]!=t||r[2]!=n);i++);r&&this._listeners.splice(i,1)};t.prototype.dispatchEvent=function(e){var t={type:e.type,target:this,currentTarget:this,eventPhase:2,bubbles:e.bubbles,cancelable:e.cancelable,timeStamp:e.timeStamp,stopPropagation:function(){},preventDefault:function(){},initEvent:function(){}};"readystatechange"==t.type&&this.onreadystatechange&&(this.onreadystatechange.handleEvent||this.onreadystatechange).apply(this,[t]);for(var n,r=0;n=this._listeners[r];r++)n[0]!=t.type||n[2]||(n[1].handleEvent||n[1]).apply(this,[t])};t.prototype.toString=function(){return"[object XMLHttpRequest]"};t.toString=function(){return"[XMLHttpRequest]"};window.Function.prototype.apply||(window.Function.prototype.apply=function(e,t){t||(t=[]);e.__func=this;e.__func(t[0],t[1],t[2],t[3],t[4]);delete e.__func});OpenLayers.Request||(OpenLayers.Request={});OpenLayers.Request.XMLHttpRequest=t}();OpenLayers.Format.KML=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{kml:"http://www.opengis.net/kml/2.2",gx:"http://www.google.com/kml/ext/2.2"},kmlns:"http://earth.google.com/kml/2.0",placemarksDesc:"No description available",foldersName:"OpenLayers export",foldersDesc:"Exported on "+new Date,extractAttributes:!0,kvpAttributes:!1,extractStyles:!1,extractTracks:!1,trackAttributes:null,internalns:null,features:null,styles:null,styleBaseUrl:"",fetched:null,maxDepth:0,initialize:function(e){this.regExes={trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g,kmlColor:/(\w{2})(\w{2})(\w{2})(\w{2})/,kmlIconPalette:/root:\/\/icons\/palette-(\d+)(\.\w+)/,straightBracket:/\$\[(.*?)\]/g};this.externalProjection=new OpenLayers.Projection("EPSG:4326");OpenLayers.Format.XML.prototype.initialize.apply(this,[e])},read:function(e){this.features=[];this.styles={};this.fetched={};var t={depth:0,styleBaseUrl:this.styleBaseUrl};return this.parseData(e,t)},parseData:function(e,t){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));for(var n=["Link","NetworkLink","Style","StyleMap","Placemark"],r=0,i=n.length;i>r;++r){var a=n[r],s=this.getElementsByTagNameNS(e,"*",a);if(0!=s.length)switch(a.toLowerCase()){case"link":case"networklink":this.parseLinks(s,t);break;case"style":this.extractStyles&&this.parseStyles(s,t);break;case"stylemap":this.extractStyles&&this.parseStyleMaps(s,t);break;case"placemark":this.parseFeatures(s,t)}}return this.features},parseLinks:function(e,t){if(t.depth>=this.maxDepth)return!1;var n=OpenLayers.Util.extend({},t);n.depth++;for(var r=0,i=e.length;i>r;r++){var a=this.parseProperty(e[r],"*","href");if(a&&!this.fetched[a]){this.fetched[a]=!0;var s=this.fetchLink(a);s&&this.parseData(s,n)}}},fetchLink:function(e){var t=OpenLayers.Request.GET({url:e,async:!1});return t?t.responseText:void 0},parseStyles:function(e,t){for(var n=0,r=e.length;r>n;n++){var i=this.parseStyle(e[n]);if(i){var a=(t.styleBaseUrl||"")+"#"+i.id;this.styles[a]=i}}},parseKmlColor:function(e){var t=null;if(e){var n=e.match(this.regExes.kmlColor);n&&(t={color:"#"+n[4]+n[3]+n[2],opacity:parseInt(n[1],16)/255})}return t},parseStyle:function(e){for(var t,n,r={},i=["LineStyle","PolyStyle","IconStyle","BalloonStyle","LabelStyle"],a=0,s=i.length;s>a;++a){t=i[a];n=this.getElementsByTagNameNS(e,"*",t)[0];if(n)switch(t.toLowerCase()){case"linestyle":var o=this.parseProperty(n,"*","color"),l=this.parseKmlColor(o);if(l){r.strokeColor=l.color;r.strokeOpacity=l.opacity}var c=this.parseProperty(n,"*","width");c&&(r.strokeWidth=c);break;case"polystyle":var o=this.parseProperty(n,"*","color"),l=this.parseKmlColor(o);if(l){r.fillOpacity=l.opacity;r.fillColor=l.color}var u=this.parseProperty(n,"*","fill");"0"==u&&(r.fillColor="none");var h=this.parseProperty(n,"*","outline");"0"==h&&(r.strokeWidth="0");break;case"iconstyle":var p=parseFloat(this.parseProperty(n,"*","scale")||1),c=32*p,d=32*p,f=this.getElementsByTagNameNS(n,"*","Icon")[0];if(f){var m=this.parseProperty(f,"*","href");if(m){var y=this.parseProperty(f,"*","w"),g=this.parseProperty(f,"*","h"),v="http://maps.google.com/mapfiles/kml";if(OpenLayers.String.startsWith(m,v)&&!y&&!g){y=64;g=64;p/=2}y=y||g;g=g||y;y&&(c=parseInt(y)*p);g&&(d=parseInt(g)*p);var C=m.match(this.regExes.kmlIconPalette);if(C){var L=C[1],T=C[2],w=this.parseProperty(f,"*","x"),b=this.parseProperty(f,"*","y"),S=w?w/32:0,E=b?7-b/32:7,O=8*E+S;m="http://maps.google.com/mapfiles/kml/pal"+L+"/icon"+O+T}r.graphicOpacity=1;r.externalGraphic=m}}var A=this.getElementsByTagNameNS(n,"*","hotSpot")[0];if(A){var w=parseFloat(A.getAttribute("x")),b=parseFloat(A.getAttribute("y")),x=A.getAttribute("xunits");"pixels"==x?r.graphicXOffset=-w*p:"insetPixels"==x?r.graphicXOffset=-c+w*p:"fraction"==x&&(r.graphicXOffset=-c*w);var P=A.getAttribute("yunits");"pixels"==P?r.graphicYOffset=-d+b*p+1:"insetPixels"==P?r.graphicYOffset=-(b*p)+1:"fraction"==P&&(r.graphicYOffset=-d*(1-b)+1)}r.graphicWidth=c;r.graphicHeight=d;break;case"balloonstyle":var _=OpenLayers.Util.getXmlNodeValue(n);_&&(r.balloonStyle=_.replace(this.regExes.straightBracket,"${$1}"));break;case"labelstyle":var o=this.parseProperty(n,"*","color"),l=this.parseKmlColor(o);if(l){r.fontColor=l.color;r.fontOpacity=l.opacity}}}!r.strokeColor&&r.fillColor&&(r.strokeColor=r.fillColor);var N=e.getAttribute("id");N&&r&&(r.id=N);return r},parseStyleMaps:function(e,t){for(var n=0,r=e.length;r>n;n++)for(var i=e[n],a=this.getElementsByTagNameNS(i,"*","Pair"),s=i.getAttribute("id"),o=0,l=a.length;l>o;o++){var c=a[o],u=this.parseProperty(c,"*","key"),h=this.parseProperty(c,"*","styleUrl");h&&"normal"==u&&(this.styles[(t.styleBaseUrl||"")+"#"+s]=this.styles[(t.styleBaseUrl||"")+h])}},parseFeatures:function(e,t){for(var n=[],r=0,i=e.length;i>r;r++){var a=e[r],s=this.parseFeature.apply(this,[a]);if(!s)throw"Bad Placemark: "+r;this.extractStyles&&s.attributes&&s.attributes.styleUrl&&(s.style=this.getStyle(s.attributes.styleUrl,t));if(this.extractStyles){var o=this.getElementsByTagNameNS(a,"*","Style")[0];if(o){var l=this.parseStyle(o);l&&(s.style=OpenLayers.Util.extend(s.style,l))}}if(this.extractTracks){var c=this.getElementsByTagNameNS(a,this.namespaces.gx,"Track");if(c&&c.length>0){var u=c[0],h={features:[],feature:s};this.readNode(u,h);h.features.length>0&&n.push.apply(n,h.features)}}else n.push(s)}this.features=this.features.concat(n)},readers:{kml:{when:function(e,t){t.whens.push(OpenLayers.Date.parse(this.getChildValue(e)))},_trackPointAttribute:function(e,t){var n=e.nodeName.split(":").pop();t.attributes[n].push(this.getChildValue(e))}},gx:{Track:function(e,t){var n={whens:[],points:[],angles:[]};if(this.trackAttributes){var r;n.attributes={};for(var i=0,a=this.trackAttributes.length;a>i;++i){r=this.trackAttributes[i];n.attributes[r]=[];r in this.readers.kml||(this.readers.kml[r]=this.readers.kml._trackPointAttribute)}}this.readChildNodes(e,n);if(n.whens.length!==n.points.length)throw new Error("gx:Track with unequal number of when ("+n.whens.length+") and gx:coord ("+n.points.length+") elements.");var s=n.angles.length>0;if(s&&n.whens.length!==n.angles.length)throw new Error("gx:Track with unequal number of when ("+n.whens.length+") and gx:angles ("+n.angles.length+") elements.");for(var o,l,c,i=0,a=n.whens.length;a>i;++i){o=t.feature.clone();o.fid=t.feature.fid||t.feature.id;l=n.points[i];o.geometry=l;"z"in l&&(o.attributes.altitude=l.z);this.internalProjection&&this.externalProjection&&o.geometry.transform(this.externalProjection,this.internalProjection);if(this.trackAttributes)for(var u=0,h=this.trackAttributes.length;h>u;++u){var r=this.trackAttributes[u];o.attributes[r]=n.attributes[r][i]}o.attributes.when=n.whens[i];o.attributes.trackId=t.feature.id;if(s){c=n.angles[i];o.attributes.heading=parseFloat(c[0]);o.attributes.tilt=parseFloat(c[1]);o.attributes.roll=parseFloat(c[2])}t.features.push(o)}},coord:function(e,t){var n=this.getChildValue(e),r=n.replace(this.regExes.trimSpace,"").split(/\s+/),i=new OpenLayers.Geometry.Point(r[0],r[1]);r.length>2&&(i.z=parseFloat(r[2]));t.points.push(i)},angles:function(e,t){var n=this.getChildValue(e),r=n.replace(this.regExes.trimSpace,"").split(/\s+/);t.angles.push(r)}}},parseFeature:function(e){for(var t,n,r,i,a=["MultiGeometry","Polygon","LineString","Point"],s=0,o=a.length;o>s;++s){t=a[s];this.internalns=e.namespaceURI?e.namespaceURI:this.kmlns;n=this.getElementsByTagNameNS(e,this.internalns,t);if(n.length>0){var i=this.parseGeometry[t.toLowerCase()];if(!i)throw new TypeError("Unsupported geometry type: "+t);r=i.apply(this,[n[0]]);this.internalProjection&&this.externalProjection&&r.transform(this.externalProjection,this.internalProjection);break}}var l;this.extractAttributes&&(l=this.parseAttributes(e));var c=new OpenLayers.Feature.Vector(r,l),u=e.getAttribute("id")||e.getAttribute("name");null!=u&&(c.fid=u);return c},getStyle:function(e,t){var n=OpenLayers.Util.removeTail(e),r=OpenLayers.Util.extend({},t);r.depth++;r.styleBaseUrl=n;if(!this.styles[e]&&!OpenLayers.String.startsWith(e,"#")&&r.depth<=this.maxDepth&&!this.fetched[n]){var i=this.fetchLink(n);i&&this.parseData(i,r)}var a=OpenLayers.Util.extend({},this.styles[e]);return a},parseGeometry:{point:function(e){var t=this.getElementsByTagNameNS(e,this.internalns,"coordinates"),n=[];if(t.length>0){var r=t[0].firstChild.nodeValue;r=r.replace(this.regExes.removeSpace,"");n=r.split(",")}var i=null;if(!(n.length>1))throw"Bad coordinate string: "+r;2==n.length&&(n[2]=null);i=new OpenLayers.Geometry.Point(n[0],n[1],n[2]);return i},linestring:function(e,t){var n=this.getElementsByTagNameNS(e,this.internalns,"coordinates"),r=null;if(n.length>0){var i=this.getChildValue(n[0]);i=i.replace(this.regExes.trimSpace,"");i=i.replace(this.regExes.trimComma,",");for(var a,s,o=i.split(this.regExes.splitSpace),l=o.length,c=new Array(l),u=0;l>u;++u){a=o[u].split(",");s=a.length;if(!(s>1))throw"Bad LineString point coordinates: "+o[u];2==a.length&&(a[2]=null);c[u]=new OpenLayers.Geometry.Point(a[0],a[1],a[2])}if(!l)throw"Bad LineString coordinates: "+i;r=t?new OpenLayers.Geometry.LinearRing(c):new OpenLayers.Geometry.LineString(c)}return r},polygon:function(e){var t=this.getElementsByTagNameNS(e,this.internalns,"LinearRing"),n=t.length,r=new Array(n);if(n>0)for(var i,a=0,s=t.length;s>a;++a){i=this.parseGeometry.linestring.apply(this,[t[a],!0]);if(!i)throw"Bad LinearRing geometry: "+a;r[a]=i}return new OpenLayers.Geometry.Polygon(r)},multigeometry:function(e){for(var t,n,r=[],i=e.childNodes,a=0,s=i.length;s>a;++a){t=i[a];if(1==t.nodeType){var o=t.prefix?t.nodeName.split(":")[1]:t.nodeName,n=this.parseGeometry[o.toLowerCase()];n&&r.push(n.apply(this,[t]))}}return new OpenLayers.Geometry.Collection(r)}},parseAttributes:function(e){var t={},n=e.getElementsByTagName("ExtendedData");n.length&&(t=this.parseExtendedData(n[0]));for(var r,i,a,s=e.childNodes,o=0,l=s.length;l>o;++o){r=s[o];if(1==r.nodeType){i=r.childNodes;if(i.length>=1&&i.length<=3){var a;switch(i.length){case 1:a=i[0];break;case 2:var c=i[0],u=i[1];a=3==c.nodeType||4==c.nodeType?c:u;break;case 3:default:a=i[1]}if(3==a.nodeType||4==a.nodeType){var h=r.prefix?r.nodeName.split(":")[1]:r.nodeName,p=OpenLayers.Util.getXmlNodeValue(a);if(p){p=p.replace(this.regExes.trimSpace,"");t[h]=p}}}}}return t},parseExtendedData:function(e){var t,n,r,i,a={},s=e.getElementsByTagName("Data");for(t=0,n=s.length;n>t;t++){r=s[t];i=r.getAttribute("name");var o={},l=r.getElementsByTagName("value");l.length&&(o.value=this.getChildValue(l[0]));if(this.kvpAttributes)a[i]=o.value;else{var c=r.getElementsByTagName("displayName");c.length&&(o.displayName=this.getChildValue(c[0]));a[i]=o}}var u=e.getElementsByTagName("SimpleData");for(t=0,n=u.length;n>t;t++){var o={};r=u[t];i=r.getAttribute("name");o.value=this.getChildValue(r);if(this.kvpAttributes)a[i]=o.value;else{o.displayName=i;a[i]=o}}return a},parseProperty:function(e,t,n){var r,i=this.getElementsByTagNameNS(e,t,n);try{r=OpenLayers.Util.getXmlNodeValue(i[0])}catch(a){r=null}return r},write:function(e){OpenLayers.Util.isArray(e)||(e=[e]);for(var t=this.createElementNS(this.kmlns,"kml"),n=this.createFolderXML(),r=0,i=e.length;i>r;++r)n.appendChild(this.createPlacemarkXML(e[r]));t.appendChild(n);return OpenLayers.Format.XML.prototype.write.apply(this,[t])},createFolderXML:function(){var e=this.createElementNS(this.kmlns,"Folder");if(this.foldersName){var t=this.createElementNS(this.kmlns,"name"),n=this.createTextNode(this.foldersName);t.appendChild(n);e.appendChild(t)}if(this.foldersDesc){var r=this.createElementNS(this.kmlns,"description"),i=this.createTextNode(this.foldersDesc);r.appendChild(i);e.appendChild(r)}return e},createPlacemarkXML:function(e){var t=this.createElementNS(this.kmlns,"name"),n=e.style&&e.style.label?e.style.label:e.id,r=e.attributes.name||n;t.appendChild(this.createTextNode(r));var i=this.createElementNS(this.kmlns,"description"),a=e.attributes.description||this.placemarksDesc;i.appendChild(this.createTextNode(a));var s=this.createElementNS(this.kmlns,"Placemark");null!=e.fid&&s.setAttribute("id",e.fid);s.appendChild(t);s.appendChild(i);var o=this.buildGeometryNode(e.geometry);s.appendChild(o);if(e.attributes){var l=this.buildExtendedData(e.attributes);l&&s.appendChild(l)}return s},buildGeometryNode:function(e){var t=e.CLASS_NAME,n=t.substring(t.lastIndexOf(".")+1),r=this.buildGeometry[n.toLowerCase()],i=null;r&&(i=r.apply(this,[e]));return i},buildGeometry:{point:function(e){var t=this.createElementNS(this.kmlns,"Point");t.appendChild(this.buildCoordinatesNode(e));return t},multipoint:function(e){return this.buildGeometry.collection.apply(this,[e])},linestring:function(e){var t=this.createElementNS(this.kmlns,"LineString");t.appendChild(this.buildCoordinatesNode(e));return t},multilinestring:function(e){return this.buildGeometry.collection.apply(this,[e])},linearring:function(e){var t=this.createElementNS(this.kmlns,"LinearRing");t.appendChild(this.buildCoordinatesNode(e));return t},polygon:function(e){for(var t,n,r,i=this.createElementNS(this.kmlns,"Polygon"),a=e.components,s=0,o=a.length;o>s;++s){r=0==s?"outerBoundaryIs":"innerBoundaryIs";t=this.createElementNS(this.kmlns,r);n=this.buildGeometry.linearring.apply(this,[a[s]]);t.appendChild(n);i.appendChild(t)}return i},multipolygon:function(e){return this.buildGeometry.collection.apply(this,[e])},collection:function(e){for(var t,n=this.createElementNS(this.kmlns,"MultiGeometry"),r=0,i=e.components.length;i>r;++r){t=this.buildGeometryNode.apply(this,[e.components[r]]);t&&n.appendChild(t)}return n}},buildCoordinatesNode:function(e){var t,n=this.createElementNS(this.kmlns,"coordinates"),r=e.components;if(r){for(var i,a=r.length,s=new Array(a),o=0;a>o;++o){i=r[o];s[o]=this.buildCoordinates(i)}t=s.join(" ")}else t=this.buildCoordinates(e);var l=this.createTextNode(t);n.appendChild(l);return n},buildCoordinates:function(e){if(this.internalProjection&&this.externalProjection){e=e.clone();e.transform(this.internalProjection,this.externalProjection)}return e.x+","+e.y},buildExtendedData:function(e){var t=this.createElementNS(this.kmlns,"ExtendedData");for(var n in e)if(e[n]&&"name"!=n&&"description"!=n&&"styleUrl"!=n){
var r=this.createElementNS(this.kmlns,"Data");r.setAttribute("name",n);var i=this.createElementNS(this.kmlns,"value");if("object"==typeof e[n]){e[n].value&&i.appendChild(this.createTextNode(e[n].value));if(e[n].displayName){var a=this.createElementNS(this.kmlns,"displayName");a.appendChild(this.getXMLDoc().createCDATASection(e[n].displayName));r.appendChild(a)}}else i.appendChild(this.createTextNode(e[n]));r.appendChild(i);t.appendChild(r)}return this.isSimpleContent(t)?null:t},CLASS_NAME:"OpenLayers.Format.KML"});OpenLayers.Format.WMSCapabilities.v1_1=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1,{readers:{wms:OpenLayers.Util.applyDefaults({WMT_MS_Capabilities:function(e,t){this.readChildNodes(e,t)},Keyword:function(e,t){t.keywords&&t.keywords.push(this.getChildValue(e))},DescribeLayer:function(e,t){t.describelayer={formats:[]};this.readChildNodes(e,t.describelayer)},GetLegendGraphic:function(e,t){t.getlegendgraphic={formats:[]};this.readChildNodes(e,t.getlegendgraphic)},GetStyles:function(e,t){t.getstyles={formats:[]};this.readChildNodes(e,t.getstyles)},PutStyles:function(e,t){t.putstyles={formats:[]};this.readChildNodes(e,t.putstyles)},UserDefinedSymbolization:function(e,t){var n={supportSLD:1==parseInt(e.getAttribute("SupportSLD")),userLayer:1==parseInt(e.getAttribute("UserLayer")),userStyle:1==parseInt(e.getAttribute("UserStyle")),remoteWFS:1==parseInt(e.getAttribute("RemoteWFS"))};t.userSymbols=n},LatLonBoundingBox:function(e,t){t.llbbox=[parseFloat(e.getAttribute("minx")),parseFloat(e.getAttribute("miny")),parseFloat(e.getAttribute("maxx")),parseFloat(e.getAttribute("maxy"))]},BoundingBox:function(e,t){var n=OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms.BoundingBox.apply(this,[e,t]);n.srs=e.getAttribute("SRS");t.bbox[n.srs]=n},ScaleHint:function(e,t){var n=e.getAttribute("min"),r=e.getAttribute("max"),i=Math.pow(2,.5),a=OpenLayers.INCHES_PER_UNIT.m;0!=n&&(t.maxScale=parseFloat((n/i*a*OpenLayers.DOTS_PER_INCH).toPrecision(13)));r!=Number.POSITIVE_INFINITY&&(t.minScale=parseFloat((r/i*a*OpenLayers.DOTS_PER_INCH).toPrecision(13)))},Dimension:function(e,t){var n=e.getAttribute("name").toLowerCase(),r={name:n,units:e.getAttribute("units"),unitsymbol:e.getAttribute("unitSymbol")};t.dimensions[r.name]=r},Extent:function(e,t){var n=e.getAttribute("name").toLowerCase();if(n in t.dimensions){var r=t.dimensions[n];r.nearestVal="1"===e.getAttribute("nearestValue");r.multipleVal="1"===e.getAttribute("multipleValues");r.current="1"===e.getAttribute("current");r["default"]=e.getAttribute("default")||"";var i=this.getChildValue(e);r.values=i.split(",")}}},OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms)},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1"});OpenLayers.Format.WMSCapabilities.v1_1_0=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_1,{version:"1.1.0",readers:{wms:OpenLayers.Util.applyDefaults({SRS:function(e,t){for(var n=this.getChildValue(e),r=n.split(/ +/),i=0,a=r.length;a>i;i++)t.srs[r[i]]=!0}},OpenLayers.Format.WMSCapabilities.v1_1.prototype.readers.wms)},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1_0"});OpenLayers.Protocol.WFS.v1=OpenLayers.Class(OpenLayers.Protocol,{version:null,srsName:"EPSG:4326",featureType:null,featureNS:null,geometryName:"the_geom",schema:null,featurePrefix:"feature",formatOptions:null,readFormat:null,readOptions:null,initialize:function(e){OpenLayers.Protocol.prototype.initialize.apply(this,[e]);e.format||(this.format=OpenLayers.Format.WFST(OpenLayers.Util.extend({version:this.version,featureType:this.featureType,featureNS:this.featureNS,featurePrefix:this.featurePrefix,geometryName:this.geometryName,srsName:this.srsName,schema:this.schema},this.formatOptions)));!e.geometryName&&parseFloat(this.format.version)>1&&this.setGeometryName(null)},destroy:function(){this.options&&!this.options.format&&this.format.destroy();this.format=null;OpenLayers.Protocol.prototype.destroy.apply(this)},read:function(e){OpenLayers.Protocol.prototype.read.apply(this,arguments);e=OpenLayers.Util.extend({},e);OpenLayers.Util.applyDefaults(e,this.options||{});var t=new OpenLayers.Protocol.Response({requestType:"read"}),n=OpenLayers.Format.XML.prototype.write.apply(this.format,[this.format.writeNode("wfs:GetFeature",e)]);t.priv=OpenLayers.Request.POST({url:e.url,callback:this.createCallback(this.handleRead,t,e),params:e.params,headers:e.headers,data:n});return t},setFeatureType:function(e){this.featureType=e;this.format.featureType=e},setGeometryName:function(e){this.geometryName=e;this.format.geometryName=e},handleRead:function(e,t){t=OpenLayers.Util.extend({},t);OpenLayers.Util.applyDefaults(t,this.options);if(t.callback){var n=e.priv;if(n.status>=200&&n.status<300){var r=this.parseResponse(n,t.readOptions);if(r&&r.success!==!1){t.readOptions&&"object"==t.readOptions.output?OpenLayers.Util.extend(e,r):e.features=r;e.code=OpenLayers.Protocol.Response.SUCCESS}else{e.code=OpenLayers.Protocol.Response.FAILURE;e.error=r}}else e.code=OpenLayers.Protocol.Response.FAILURE;t.callback.call(t.scope,e)}},parseResponse:function(e,t){var n=e.responseXML;n&&n.documentElement||(n=e.responseText);if(!n||n.length<=0)return null;var r=null!==this.readFormat?this.readFormat.read(n):this.format.read(n,t);if(!this.featureNS){var i=this.readFormat||this.format;this.featureNS=i.featureNS;i.autoConfig=!1;this.geometryName||this.setGeometryName(i.geometryName)}return r},commit:function(e,t){t=OpenLayers.Util.extend({},t);OpenLayers.Util.applyDefaults(t,this.options);var n=new OpenLayers.Protocol.Response({requestType:"commit",reqFeatures:e});n.priv=OpenLayers.Request.POST({url:t.url,headers:t.headers,data:this.format.write(e,t),callback:this.createCallback(this.handleCommit,n,t)});return n},handleCommit:function(e,t){if(t.callback){var n=e.priv,r=n.responseXML;r&&r.documentElement||(r=n.responseText);var i=this.format.read(r)||{};e.insertIds=i.insertIds||[];if(i.success)e.code=OpenLayers.Protocol.Response.SUCCESS;else{e.code=OpenLayers.Protocol.Response.FAILURE;e.error=i}t.callback.call(t.scope,e)}},filterDelete:function(e,t){t=OpenLayers.Util.extend({},t);OpenLayers.Util.applyDefaults(t,this.options);var n=(new OpenLayers.Protocol.Response({requestType:"commit"}),this.format.createElementNSPlus("wfs:Transaction",{attributes:{service:"WFS",version:this.version}})),r=this.format.createElementNSPlus("wfs:Delete",{attributes:{typeName:(t.featureNS?this.featurePrefix+":":"")+t.featureType}});t.featureNS&&r.setAttribute("xmlns:"+this.featurePrefix,t.featureNS);var i=this.format.writeNode("ogc:Filter",e);r.appendChild(i);n.appendChild(r);var a=OpenLayers.Format.XML.prototype.write.apply(this.format,[n]);return OpenLayers.Request.POST({url:this.url,callback:t.callback||function(){},data:a})},abort:function(e){e&&e.priv.abort()},CLASS_NAME:"OpenLayers.Protocol.WFS.v1"});OpenLayers.Format.OWSCommon.v1_1_0=OpenLayers.Class(OpenLayers.Format.OWSCommon.v1,{namespaces:{ows:"http://www.opengis.net/ows/1.1",xlink:"http://www.w3.org/1999/xlink"},readers:{ows:OpenLayers.Util.applyDefaults({ExceptionReport:function(e,t){t.exceptionReport={version:e.getAttribute("version"),language:e.getAttribute("xml:lang"),exceptions:[]};this.readChildNodes(e,t.exceptionReport)},AllowedValues:function(e,t){t.allowedValues={};this.readChildNodes(e,t.allowedValues)},AnyValue:function(e,t){t.anyValue=!0},DataType:function(e,t){t.dataType=this.getChildValue(e)},Range:function(e,t){t.range={};this.readChildNodes(e,t.range)},MinimumValue:function(e,t){t.minValue=this.getChildValue(e)},MaximumValue:function(e,t){t.maxValue=this.getChildValue(e)},Identifier:function(e,t){t.identifier=this.getChildValue(e)},SupportedCRS:function(e,t){t.supportedCRS=this.getChildValue(e)}},OpenLayers.Format.OWSCommon.v1.prototype.readers.ows)},writers:{ows:OpenLayers.Util.applyDefaults({Range:function(e){var t=this.createElementNSPlus("ows:Range",{attributes:{"ows:rangeClosure":e.closure}});this.writeNode("ows:MinimumValue",e.minValue,t);this.writeNode("ows:MaximumValue",e.maxValue,t);return t},MinimumValue:function(e){var t=this.createElementNSPlus("ows:MinimumValue",{value:e});return t},MaximumValue:function(e){var t=this.createElementNSPlus("ows:MaximumValue",{value:e});return t},Value:function(e){var t=this.createElementNSPlus("ows:Value",{value:e});return t}},OpenLayers.Format.OWSCommon.v1.prototype.writers.ows)},CLASS_NAME:"OpenLayers.Format.OWSCommon.v1_1_0"});OpenLayers.Kinetic=OpenLayers.Class({threshold:0,deceleration:.0035,nbPoints:100,delay:200,points:void 0,timerId:void 0,initialize:function(e){OpenLayers.Util.extend(this,e)},begin:function(){OpenLayers.Animation.stop(this.timerId);this.timerId=void 0;this.points=[]},update:function(e){this.points.unshift({xy:e,tick:(new Date).getTime()});this.points.length>this.nbPoints&&this.points.pop()},end:function(e){for(var t,n,r=(new Date).getTime(),i=0,a=this.points.length;a>i;i++){n=this.points[i];if(r-n.tick>this.delay)break;t=n}if(t){var s=(new Date).getTime()-t.tick,o=Math.sqrt(Math.pow(e.x-t.xy.x,2)+Math.pow(e.y-t.xy.y,2)),l=o/s;if(!(0==l||l<this.threshold)){var c=Math.asin((e.y-t.xy.y)/o);t.xy.x<=e.x&&(c=Math.PI-c);return{speed:l,theta:c}}}},move:function(e,t){var n=e.speed,r=Math.cos(e.theta),i=-Math.sin(e.theta),a=(new Date).getTime(),s=0,o=0,l=function(){if(null!=this.timerId){var e=(new Date).getTime()-a,l=-this.deceleration*Math.pow(e,2)/2+n*e,c=l*r,u=l*i,h={};h.end=!1;var p=-this.deceleration*e+n;if(0>=p){OpenLayers.Animation.stop(this.timerId);this.timerId=null;h.end=!0}h.x=c-s;h.y=u-o;s=c;o=u;t(h.x,h.y,h.end)}};this.timerId=OpenLayers.Animation.start(OpenLayers.Function.bind(l,this))},CLASS_NAME:"OpenLayers.Kinetic"});OpenLayers.Strategy.Filter=OpenLayers.Class(OpenLayers.Strategy,{filter:null,cache:null,caching:!1,activate:function(){var e=OpenLayers.Strategy.prototype.activate.apply(this,arguments);if(e){this.cache=[];this.layer.events.on({beforefeaturesadded:this.handleAdd,beforefeaturesremoved:this.handleRemove,scope:this})}return e},deactivate:function(){this.cache=null;this.layer&&this.layer.events&&this.layer.events.un({beforefeaturesadded:this.handleAdd,beforefeaturesremoved:this.handleRemove,scope:this});return OpenLayers.Strategy.prototype.deactivate.apply(this,arguments)},handleAdd:function(e){if(!this.caching&&this.filter){var t=e.features;e.features=[];for(var n,r=0,i=t.length;i>r;++r){n=t[r];this.filter.evaluate(n)?e.features.push(n):this.cache.push(n)}}},handleRemove:function(e){this.caching||(this.cache=[])},setFilter:function(e){this.filter=e;var t=this.cache;this.cache=[];this.handleAdd({features:this.layer.features});if(this.cache.length>0){this.caching=!0;this.layer.removeFeatures(this.cache.slice());this.caching=!1}if(t.length>0){var n={features:t};this.handleAdd(n);if(n.features.length>0){this.caching=!0;this.layer.addFeatures(n.features);this.caching=!1}}},CLASS_NAME:"OpenLayers.Strategy.Filter"});OpenLayers.Handler.Drag=OpenLayers.Class(OpenLayers.Handler,{started:!1,stopDown:!0,dragging:!1,last:null,start:null,lastMoveEvt:null,oldOnselectstart:null,interval:0,timeoutId:null,documentDrag:!1,documentEvents:null,initialize:function(e,t,n){OpenLayers.Handler.prototype.initialize.apply(this,arguments);if(this.documentDrag===!0){var r=this;this._docMove=function(e){r.mousemove({xy:{x:e.clientX,y:e.clientY},element:document})};this._docUp=function(e){r.mouseup({xy:{x:e.clientX,y:e.clientY}})}}},dragstart:function(e){var t=!0;this.dragging=!1;if(this.checkModifiers(e)&&(OpenLayers.Event.isLeftClick(e)||OpenLayers.Event.isSingleTouch(e))){this.started=!0;this.start=e.xy;this.last=e.xy;OpenLayers.Element.addClass(this.map.viewPortDiv,"olDragDown");this.down(e);this.callback("down",[e.xy]);OpenLayers.Event.preventDefault(e);this.oldOnselectstart||(this.oldOnselectstart=document.onselectstart?document.onselectstart:OpenLayers.Function.True);document.onselectstart=OpenLayers.Function.False;t=!this.stopDown}else{this.started=!1;this.start=null;this.last=null}return t},dragmove:function(e){this.lastMoveEvt=e;if(this.started&&!this.timeoutId&&(e.xy.x!=this.last.x||e.xy.y!=this.last.y)){if(this.documentDrag===!0&&this.documentEvents)if(e.element===document){this.adjustXY(e);this.setEvent(e)}else this.removeDocumentEvents();this.interval>0&&(this.timeoutId=setTimeout(OpenLayers.Function.bind(this.removeTimeout,this),this.interval));this.dragging=!0;this.move(e);this.callback("move",[e.xy]);if(!this.oldOnselectstart){this.oldOnselectstart=document.onselectstart;document.onselectstart=OpenLayers.Function.False}this.last=e.xy}return!0},dragend:function(e){if(this.started){if(this.documentDrag===!0&&this.documentEvents){this.adjustXY(e);this.removeDocumentEvents()}var t=this.start!=this.last;this.started=!1;this.dragging=!1;OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown");this.up(e);this.callback("up",[e.xy]);t&&this.callback("done",[e.xy]);document.onselectstart=this.oldOnselectstart}return!0},down:function(e){},move:function(e){},up:function(e){},out:function(e){},mousedown:function(e){return this.dragstart(e)},touchstart:function(e){this.startTouch();return this.dragstart(e)},mousemove:function(e){return this.dragmove(e)},touchmove:function(e){return this.dragmove(e)},removeTimeout:function(){this.timeoutId=null;this.dragging&&this.mousemove(this.lastMoveEvt)},mouseup:function(e){return this.dragend(e)},touchend:function(e){e.xy=this.last;return this.dragend(e)},mouseout:function(e){if(this.started&&OpenLayers.Util.mouseLeft(e,this.map.viewPortDiv))if(this.documentDrag===!0)this.addDocumentEvents();else{var t=this.start!=this.last;this.started=!1;this.dragging=!1;OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown");this.out(e);this.callback("out",[]);t&&this.callback("done",[e.xy]);document.onselectstart&&(document.onselectstart=this.oldOnselectstart)}return!0},click:function(e){return this.start==this.last},activate:function(){var e=!1;if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){this.dragging=!1;e=!0}return e},deactivate:function(){var e=!1;if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){this.started=!1;this.dragging=!1;this.start=null;this.last=null;e=!0;OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown")}return e},adjustXY:function(e){var t=OpenLayers.Util.pagePosition(this.map.viewPortDiv);e.xy.x-=t[0];e.xy.y-=t[1]},addDocumentEvents:function(){OpenLayers.Element.addClass(document.body,"olDragDown");this.documentEvents=!0;OpenLayers.Event.observe(document,"mousemove",this._docMove);OpenLayers.Event.observe(document,"mouseup",this._docUp)},removeDocumentEvents:function(){OpenLayers.Element.removeClass(document.body,"olDragDown");this.documentEvents=!1;OpenLayers.Event.stopObserving(document,"mousemove",this._docMove);OpenLayers.Event.stopObserving(document,"mouseup",this._docUp)},CLASS_NAME:"OpenLayers.Handler.Drag"});OpenLayers.Handler.Box=OpenLayers.Class(OpenLayers.Handler,{dragHandler:null,boxDivClassName:"olHandlerBoxZoomBox",boxOffsets:null,initialize:function(e,t,n){OpenLayers.Handler.prototype.initialize.apply(this,arguments);this.dragHandler=new OpenLayers.Handler.Drag(this,{down:this.startBox,move:this.moveBox,out:this.removeBox,up:this.endBox},{keyMask:this.keyMask})},destroy:function(){OpenLayers.Handler.prototype.destroy.apply(this,arguments);if(this.dragHandler){this.dragHandler.destroy();this.dragHandler=null}},setMap:function(e){OpenLayers.Handler.prototype.setMap.apply(this,arguments);this.dragHandler&&this.dragHandler.setMap(e)},startBox:function(e){this.callback("start",[]);this.zoomBox=OpenLayers.Util.createDiv("zoomBox",{x:-9999,y:-9999});this.zoomBox.className=this.boxDivClassName;this.zoomBox.style.zIndex=this.map.Z_INDEX_BASE.Popup-1;this.map.viewPortDiv.appendChild(this.zoomBox);OpenLayers.Element.addClass(this.map.viewPortDiv,"olDrawBox")},moveBox:function(e){var t=this.dragHandler.start.x,n=this.dragHandler.start.y,r=Math.abs(t-e.x),i=Math.abs(n-e.y),a=this.getBoxOffsets();this.zoomBox.style.width=r+a.width+1+"px";this.zoomBox.style.height=i+a.height+1+"px";this.zoomBox.style.left=(e.x<t?t-r-a.left:t-a.left)+"px";this.zoomBox.style.top=(e.y<n?n-i-a.top:n-a.top)+"px"},endBox:function(e){var t;if(Math.abs(this.dragHandler.start.x-e.x)>5||Math.abs(this.dragHandler.start.y-e.y)>5){var n=this.dragHandler.start,r=Math.min(n.y,e.y),i=Math.max(n.y,e.y),a=Math.min(n.x,e.x),s=Math.max(n.x,e.x);t=new OpenLayers.Bounds(a,i,s,r)}else t=this.dragHandler.start.clone();this.removeBox();this.callback("done",[t])},removeBox:function(){this.map.viewPortDiv.removeChild(this.zoomBox);this.zoomBox=null;this.boxOffsets=null;OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDrawBox")},activate:function(){if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){this.dragHandler.activate();return!0}return!1},deactivate:function(){if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){this.dragHandler.deactivate()&&this.zoomBox&&this.removeBox();return!0}return!1},getBoxOffsets:function(){if(!this.boxOffsets){var e=document.createElement("div");e.style.position="absolute";e.style.border="1px solid black";e.style.width="3px";document.body.appendChild(e);var t=3==e.clientWidth;document.body.removeChild(e);var n=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-left-width")),r=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-right-width")),i=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-top-width")),a=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-bottom-width"));this.boxOffsets={left:n,right:r,top:i,bottom:a,width:t===!1?n+r:0,height:t===!1?i+a:0}}return this.boxOffsets},CLASS_NAME:"OpenLayers.Handler.Box"});OpenLayers.Control.ZoomBox=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,out:!1,keyMask:null,alwaysZoom:!1,zoomOnClick:!0,draw:function(){this.handler=new OpenLayers.Handler.Box(this,{done:this.zoomBox},{keyMask:this.keyMask})},zoomBox:function(e){if(e instanceof OpenLayers.Bounds){var t,n=e.getCenterPixel();if(this.out){var r=e.right-e.left,i=e.bottom-e.top,a=Math.min(this.map.size.h/i,this.map.size.w/r),s=this.map.getExtent(),o=this.map.getLonLatFromPixel(n),l=o.lon-s.getWidth()/2*a,c=o.lon+s.getWidth()/2*a,u=o.lat-s.getHeight()/2*a,h=o.lat+s.getHeight()/2*a;t=new OpenLayers.Bounds(l,u,c,h)}else{var p=this.map.getLonLatFromPixel({x:e.left,y:e.bottom}),d=this.map.getLonLatFromPixel({x:e.right,y:e.top});t=new OpenLayers.Bounds(p.lon,p.lat,d.lon,d.lat)}var f=this.map.getZoom(),m=this.map.getSize(),y={x:m.w/2,y:m.h/2},g=this.map.getZoomForExtent(t),v=this.map.getResolution(),C=this.map.getResolutionForZoom(g);if(v==C)this.map.setCenter(this.map.getLonLatFromPixel(n));else{var L={x:(v*n.x-C*y.x)/(v-C),y:(v*n.y-C*y.y)/(v-C)};this.map.zoomTo(g,L)}f==this.map.getZoom()&&1==this.alwaysZoom&&this.map.zoomTo(f+(this.out?-1:1))}else this.zoomOnClick&&(this.out?this.map.zoomTo(this.map.getZoom()-1,e):this.map.zoomTo(this.map.getZoom()+1,e))},CLASS_NAME:"OpenLayers.Control.ZoomBox"});OpenLayers.Control.DragPan=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,panned:!1,interval:0,documentDrag:!1,kinetic:null,enableKinetic:!0,kineticInterval:10,draw:function(){if(this.enableKinetic&&OpenLayers.Kinetic){var e={interval:this.kineticInterval};"object"==typeof this.enableKinetic&&(e=OpenLayers.Util.extend(e,this.enableKinetic));this.kinetic=new OpenLayers.Kinetic(e)}this.handler=new OpenLayers.Handler.Drag(this,{move:this.panMap,done:this.panMapDone,down:this.panMapStart},{interval:this.interval,documentDrag:this.documentDrag})},panMapStart:function(){this.kinetic&&this.kinetic.begin()},panMap:function(e){this.kinetic&&this.kinetic.update(e);this.panned=!0;this.map.pan(this.handler.last.x-e.x,this.handler.last.y-e.y,{dragging:!0,animate:!1})},panMapDone:function(e){if(this.panned){var t=null;this.kinetic&&(t=this.kinetic.end(e));this.map.pan(this.handler.last.x-e.x,this.handler.last.y-e.y,{dragging:!!t,animate:!1});if(t){var n=this;this.kinetic.move(t,function(e,t,r){n.map.pan(e,t,{dragging:!r,animate:!1})})}this.panned=!1}},CLASS_NAME:"OpenLayers.Control.DragPan"});OpenLayers.Handler.Click=OpenLayers.Class(OpenLayers.Handler,{delay:300,single:!0,"double":!1,pixelTolerance:0,dblclickTolerance:13,stopSingle:!1,stopDouble:!1,timerId:null,down:null,last:null,first:null,rightclickTimerId:null,touchstart:function(e){this.startTouch();this.down=this.getEventInfo(e);this.last=this.getEventInfo(e);return!0},touchmove:function(e){this.last=this.getEventInfo(e);return!0},touchend:function(e){if(this.down){e.xy=this.last.xy;e.lastTouches=this.last.touches;this.handleSingle(e);this.down=null}return!0},mousedown:function(e){this.down=this.getEventInfo(e);this.last=this.getEventInfo(e);return!0},mouseup:function(e){var t=!0;this.checkModifiers(e)&&this.control.handleRightClicks&&OpenLayers.Event.isRightClick(e)&&(t=this.rightclick(e));return t},rightclick:function(e){if(this.passesTolerance(e)){if(null!=this.rightclickTimerId){this.clearTimer();this.callback("dblrightclick",[e]);return!this.stopDouble}var t=this["double"]?OpenLayers.Util.extend({},e):this.callback("rightclick",[e]),n=OpenLayers.Function.bind(this.delayedRightCall,this,t);this.rightclickTimerId=window.setTimeout(n,this.delay)}return!this.stopSingle},delayedRightCall:function(e){this.rightclickTimerId=null;e&&this.callback("rightclick",[e])},click:function(e){this.last||(this.last=this.getEventInfo(e));this.handleSingle(e);return!this.stopSingle},dblclick:function(e){this.handleDouble(e);return!this.stopDouble},handleDouble:function(e){if(this.passesDblclickTolerance(e)){this["double"]&&this.callback("dblclick",[e]);this.clearTimer()}},handleSingle:function(e){if(this.passesTolerance(e))if(null!=this.timerId){if(this.last.touches&&1===this.last.touches.length){this["double"]&&OpenLayers.Event.preventDefault(e);this.handleDouble(e)}this.last.touches&&2===this.last.touches.length||this.clearTimer()}else{this.first=this.getEventInfo(e);var t=this.single?OpenLayers.Util.extend({},e):null;this.queuePotentialClick(t)}},queuePotentialClick:function(e){this.timerId=window.setTimeout(OpenLayers.Function.bind(this.delayedCall,this,e),this.delay)},passesTolerance:function(e){var t=!0;if(null!=this.pixelTolerance&&this.down&&this.down.xy){t=this.pixelTolerance>=this.down.xy.distanceTo(e.xy);if(t&&this.touch&&this.down.touches.length===this.last.touches.length)for(var n=0,r=this.down.touches.length;r>n;++n)if(this.getTouchDistance(this.down.touches[n],this.last.touches[n])>this.pixelTolerance){t=!1;break}}return t},getTouchDistance:function(e,t){return Math.sqrt(Math.pow(e.clientX-t.clientX,2)+Math.pow(e.clientY-t.clientY,2))},passesDblclickTolerance:function(e){var t=!0;this.down&&this.first&&(t=this.down.xy.distanceTo(this.first.xy)<=this.dblclickTolerance);return t},clearTimer:function(){if(null!=this.timerId){window.clearTimeout(this.timerId);this.timerId=null}if(null!=this.rightclickTimerId){window.clearTimeout(this.rightclickTimerId);this.rightclickTimerId=null}},delayedCall:function(e){this.timerId=null;e&&this.callback("click",[e])},getEventInfo:function(e){var t;if(e.touches){var n=e.touches.length;t=new Array(n);for(var r,i=0;n>i;i++){r=e.touches[i];t[i]={clientX:r.olClientX,clientY:r.olClientY}}}return{xy:e.xy,touches:t}},deactivate:function(){var e=!1;if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){this.clearTimer();this.down=null;this.first=null;this.last=null;e=!0}return e},CLASS_NAME:"OpenLayers.Handler.Click"});OpenLayers.Control.Navigation=OpenLayers.Class(OpenLayers.Control,{dragPan:null,dragPanOptions:null,pinchZoom:null,pinchZoomOptions:null,documentDrag:!1,zoomBox:null,zoomBoxEnabled:!0,zoomWheelEnabled:!0,mouseWheelOptions:null,handleRightClicks:!1,zoomBoxKeyMask:OpenLayers.Handler.MOD_SHIFT,autoActivate:!0,initialize:function(e){this.handlers={};OpenLayers.Control.prototype.initialize.apply(this,arguments)},destroy:function(){this.deactivate();this.dragPan&&this.dragPan.destroy();this.dragPan=null;this.zoomBox&&this.zoomBox.destroy();this.zoomBox=null;this.pinchZoom&&this.pinchZoom.destroy();this.pinchZoom=null;OpenLayers.Control.prototype.destroy.apply(this,arguments)},activate:function(){this.dragPan.activate();this.zoomWheelEnabled&&this.handlers.wheel.activate();this.handlers.click.activate();this.zoomBoxEnabled&&this.zoomBox.activate();this.pinchZoom&&this.pinchZoom.activate();return OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){this.pinchZoom&&this.pinchZoom.deactivate();this.zoomBox.deactivate();this.dragPan.deactivate();this.handlers.click.deactivate();this.handlers.wheel.deactivate();return OpenLayers.Control.prototype.deactivate.apply(this,arguments)},draw:function(){this.handleRightClicks&&(this.map.viewPortDiv.oncontextmenu=OpenLayers.Function.False);var e={click:this.defaultClick,dblclick:this.defaultDblClick,dblrightclick:this.defaultDblRightClick},t={"double":!0,stopDouble:!0};this.handlers.click=new OpenLayers.Handler.Click(this,e,t);this.dragPan=new OpenLayers.Control.DragPan(OpenLayers.Util.extend({map:this.map,documentDrag:this.documentDrag},this.dragPanOptions));this.zoomBox=new OpenLayers.Control.ZoomBox({map:this.map,keyMask:this.zoomBoxKeyMask});this.dragPan.draw();this.zoomBox.draw();var n=this.map.fractionalZoom?{}:{cumulative:!1,interval:50,maxDelta:6};this.handlers.wheel=new OpenLayers.Handler.MouseWheel(this,{up:this.wheelUp,down:this.wheelDown},OpenLayers.Util.extend(n,this.mouseWheelOptions));OpenLayers.Control.PinchZoom&&(this.pinchZoom=new OpenLayers.Control.PinchZoom(OpenLayers.Util.extend({map:this.map},this.pinchZoomOptions)))},defaultClick:function(e){e.lastTouches&&2==e.lastTouches.length&&this.map.zoomOut()},defaultDblClick:function(e){this.map.zoomTo(this.map.zoom+1,e.xy)},defaultDblRightClick:function(e){this.map.zoomTo(this.map.zoom-1,e.xy)},wheelChange:function(e,t){this.map.fractionalZoom||(t=Math.round(t));var n=this.map.getZoom(),r=n+t;r=Math.max(r,0);r=Math.min(r,this.map.getNumZoomLevels());r!==n&&this.map.zoomTo(r,e.xy)},wheelUp:function(e,t){this.wheelChange(e,t||1)},wheelDown:function(e,t){this.wheelChange(e,t||-1)},disableZoomBox:function(){this.zoomBoxEnabled=!1;this.zoomBox.deactivate()},enableZoomBox:function(){this.zoomBoxEnabled=!0;this.active&&this.zoomBox.activate()},disableZoomWheel:function(){this.zoomWheelEnabled=!1;this.handlers.wheel.deactivate()},enableZoomWheel:function(){this.zoomWheelEnabled=!0;this.active&&this.handlers.wheel.activate()},CLASS_NAME:"OpenLayers.Control.Navigation"});OpenLayers.Layer.WMS=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{service:"WMS",version:"1.1.1",request:"GetMap",styles:"",format:"image/jpeg"},isBaseLayer:!0,encodeBBOX:!1,noMagic:!1,yx:{},initialize:function(e,t,n,r){var i=[];n=OpenLayers.Util.upperCaseObject(n);parseFloat(n.VERSION)>=1.3&&!n.EXCEPTIONS&&(n.EXCEPTIONS="INIMAGE");i.push(e,t,n,r);OpenLayers.Layer.Grid.prototype.initialize.apply(this,i);OpenLayers.Util.applyDefaults(this.params,OpenLayers.Util.upperCaseObject(this.DEFAULT_PARAMS));if(!this.noMagic&&this.params.TRANSPARENT&&"true"==this.params.TRANSPARENT.toString().toLowerCase()){null!=r&&r.isBaseLayer||(this.isBaseLayer=!1);"image/jpeg"==this.params.FORMAT&&(this.params.FORMAT=OpenLayers.Util.alphaHack()?"image/gif":"image/png")}},clone:function(e){null==e&&(e=new OpenLayers.Layer.WMS(this.name,this.url,this.params,this.getOptions()));e=OpenLayers.Layer.Grid.prototype.clone.apply(this,[e]);return e},reverseAxisOrder:function(){var e=this.projection.getCode();return parseFloat(this.params.VERSION)>=1.3&&!!(this.yx[e]||OpenLayers.Projection.defaults[e]&&OpenLayers.Projection.defaults[e].yx)},getURL:function(e){e=this.adjustBounds(e);var t=this.getImageSize(),n={},r=this.reverseAxisOrder();n.BBOX=this.encodeBBOX?e.toBBOX(null,r):e.toArray(r);n.WIDTH=t.w;n.HEIGHT=t.h;var i=this.getFullRequestString(n);return i},mergeNewParams:function(e){var t=OpenLayers.Util.upperCaseObject(e),n=[t];return OpenLayers.Layer.Grid.prototype.mergeNewParams.apply(this,n)},getFullRequestString:function(e,t){var n=this.map.getProjectionObject(),r=this.projection&&this.projection.equals(n)?this.projection.getCode():n.getCode(),i="none"==r?null:r;parseFloat(this.params.VERSION)>=1.3?this.params.CRS=i:this.params.SRS=i;"boolean"==typeof this.params.TRANSPARENT&&(e.TRANSPARENT=this.params.TRANSPARENT?"TRUE":"FALSE");return OpenLayers.Layer.Grid.prototype.getFullRequestString.apply(this,arguments)},CLASS_NAME:"OpenLayers.Layer.WMS"});OpenLayers.StyleMap=OpenLayers.Class({styles:null,extendDefault:!0,initialize:function(e,t){this.styles={"default":new OpenLayers.Style(OpenLayers.Feature.Vector.style["default"]),select:new OpenLayers.Style(OpenLayers.Feature.Vector.style.select),temporary:new OpenLayers.Style(OpenLayers.Feature.Vector.style.temporary),"delete":new OpenLayers.Style(OpenLayers.Feature.Vector.style["delete"])};if(e instanceof OpenLayers.Style){this.styles["default"]=e;this.styles.select=e;this.styles.temporary=e;this.styles["delete"]=e}else if("object"==typeof e)for(var n in e)if(e[n]instanceof OpenLayers.Style)this.styles[n]=e[n];else{if("object"!=typeof e[n]){this.styles["default"]=new OpenLayers.Style(e);this.styles.select=new OpenLayers.Style(e);this.styles.temporary=new OpenLayers.Style(e);this.styles["delete"]=new OpenLayers.Style(e);break}this.styles[n]=new OpenLayers.Style(e[n])}OpenLayers.Util.extend(this,t)},destroy:function(){for(var e in this.styles)this.styles[e].destroy();this.styles=null},createSymbolizer:function(e,t){e||(e=new OpenLayers.Feature.Vector);this.styles[t]||(t="default");e.renderIntent=t;var n={};this.extendDefault&&"default"!=t&&(n=this.styles["default"].createSymbolizer(e));return OpenLayers.Util.extend(n,this.styles[t].createSymbolizer(e))},addUniqueValueRules:function(e,t,n,r){var i=[];for(var a in n)i.push(new OpenLayers.Rule({symbolizer:n[a],context:r,filter:new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:t,value:a})}));this.styles[e].addRules(i)},CLASS_NAME:"OpenLayers.StyleMap"});OpenLayers.Layer.Vector=OpenLayers.Class(OpenLayers.Layer,{isBaseLayer:!1,isFixed:!1,features:null,filter:null,selectedFeatures:null,unrenderedFeatures:null,reportError:!0,style:null,styleMap:null,strategies:null,protocol:null,renderers:["SVG","VML","Canvas"],renderer:null,rendererOptions:null,geometryType:null,drawn:!1,ratio:1,initialize:function(e,t){OpenLayers.Layer.prototype.initialize.apply(this,arguments);this.renderer&&this.renderer.supported()||this.assignRenderer();if(!this.renderer||!this.renderer.supported()){this.renderer=null;this.displayError()}this.styleMap||(this.styleMap=new OpenLayers.StyleMap);this.features=[];this.selectedFeatures=[];this.unrenderedFeatures={};if(this.strategies)for(var n=0,r=this.strategies.length;r>n;n++)this.strategies[n].setLayer(this)},destroy:function(){if(this.strategies){var e,t,n;for(t=0,n=this.strategies.length;n>t;t++){e=this.strategies[t];e.autoDestroy&&e.destroy()}this.strategies=null}if(this.protocol){this.protocol.autoDestroy&&this.protocol.destroy();this.protocol=null}this.destroyFeatures();this.features=null;this.selectedFeatures=null;this.unrenderedFeatures=null;this.renderer&&this.renderer.destroy();this.renderer=null;this.geometryType=null;this.drawn=null;OpenLayers.Layer.prototype.destroy.apply(this,arguments)},clone:function(e){null==e&&(e=new OpenLayers.Layer.Vector(this.name,this.getOptions()));e=OpenLayers.Layer.prototype.clone.apply(this,[e]);for(var t=this.features,n=t.length,r=new Array(n),i=0;n>i;++i)r[i]=t[i].clone();e.features=r;return e},refresh:function(e){this.calculateInRange()&&this.visibility&&this.events.triggerEvent("refresh",e)},assignRenderer:function(){for(var e=0,t=this.renderers.length;t>e;e++){var n=this.renderers[e],r="function"==typeof n?n:OpenLayers.Renderer[n];if(r&&r.prototype.supported()){this.renderer=new r(this.div,this.rendererOptions);break}}},displayError:function(){this.reportError&&OpenLayers.Console.userError(OpenLayers.i18n("browserNotSupported",{renderers:this.renderers.join("\n")
}))},setMap:function(e){OpenLayers.Layer.prototype.setMap.apply(this,arguments);if(this.renderer){this.renderer.map=this.map;var t=this.map.getSize();t.w=t.w*this.ratio;t.h=t.h*this.ratio;this.renderer.setSize(t)}else this.map.removeLayer(this)},afterAdd:function(){if(this.strategies){var e,t,n;for(t=0,n=this.strategies.length;n>t;t++){e=this.strategies[t];e.autoActivate&&e.activate()}}},removeMap:function(e){this.drawn=!1;if(this.strategies){var t,n,r;for(n=0,r=this.strategies.length;r>n;n++){t=this.strategies[n];t.autoActivate&&t.deactivate()}}},onMapResize:function(){OpenLayers.Layer.prototype.onMapResize.apply(this,arguments);var e=this.map.getSize();e.w=e.w*this.ratio;e.h=e.h*this.ratio;this.renderer.setSize(e)},moveTo:function(e,t,n){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);var r=!0;if(!n){this.renderer.root.style.visibility="hidden";var i=this.map.getSize(),a=i.w,s=i.h,o=a/2*this.ratio-a/2,l=s/2*this.ratio-s/2;o+=this.map.layerContainerOriginPx.x;o=-Math.round(o);l+=this.map.layerContainerOriginPx.y;l=-Math.round(l);this.div.style.left=o+"px";this.div.style.top=l+"px";var c=this.map.getExtent().scale(this.ratio);r=this.renderer.setExtent(c,t);this.renderer.root.style.visibility="visible";OpenLayers.IS_GECKO===!0&&(this.div.scrollLeft=this.div.scrollLeft);if(!t&&r)for(var u in this.unrenderedFeatures){var h=this.unrenderedFeatures[u];this.drawFeature(h)}}if(!this.drawn||t||!r){this.drawn=!0;for(var h,u=0,p=this.features.length;p>u;u++){this.renderer.locked=u!==p-1;h=this.features[u];this.drawFeature(h)}}},display:function(e){OpenLayers.Layer.prototype.display.apply(this,arguments);var t=this.div.style.display;t!=this.renderer.root.style.display&&(this.renderer.root.style.display=t)},addFeatures:function(e,t){OpenLayers.Util.isArray(e)||(e=[e]);var n=!t||!t.silent;if(n){var r={features:e},i=this.events.triggerEvent("beforefeaturesadded",r);if(i===!1)return;e=r.features}for(var a=[],s=0,o=e.length;o>s;s++){this.renderer.locked=s!=e.length-1?!0:!1;var l=e[s];if(this.geometryType&&!(l.geometry instanceof this.geometryType))throw new TypeError("addFeatures: component should be an "+this.geometryType.prototype.CLASS_NAME);l.layer=this;!l.style&&this.style&&(l.style=OpenLayers.Util.extend({},this.style));if(n){if(this.events.triggerEvent("beforefeatureadded",{feature:l})===!1)continue;this.preFeatureInsert(l)}a.push(l);this.features.push(l);this.drawFeature(l);if(n){this.events.triggerEvent("featureadded",{feature:l});this.onFeatureInsert(l)}}n&&this.events.triggerEvent("featuresadded",{features:a})},removeFeatures:function(e,t){if(e&&0!==e.length){if(e===this.features)return this.removeAllFeatures(t);OpenLayers.Util.isArray(e)||(e=[e]);e===this.selectedFeatures&&(e=e.slice());var n=!t||!t.silent;n&&this.events.triggerEvent("beforefeaturesremoved",{features:e});for(var r=e.length-1;r>=0;r--){this.renderer.locked=0!=r&&e[r-1].geometry?!0:!1;var i=e[r];delete this.unrenderedFeatures[i.id];n&&this.events.triggerEvent("beforefeatureremoved",{feature:i});this.features=OpenLayers.Util.removeItem(this.features,i);i.layer=null;i.geometry&&this.renderer.eraseFeatures(i);-1!=OpenLayers.Util.indexOf(this.selectedFeatures,i)&&OpenLayers.Util.removeItem(this.selectedFeatures,i);n&&this.events.triggerEvent("featureremoved",{feature:i})}n&&this.events.triggerEvent("featuresremoved",{features:e})}},removeAllFeatures:function(e){var t=!e||!e.silent,n=this.features;t&&this.events.triggerEvent("beforefeaturesremoved",{features:n});for(var r,i=n.length-1;i>=0;i--){r=n[i];t&&this.events.triggerEvent("beforefeatureremoved",{feature:r});r.layer=null;t&&this.events.triggerEvent("featureremoved",{feature:r})}this.renderer.clear();this.features=[];this.unrenderedFeatures={};this.selectedFeatures=[];t&&this.events.triggerEvent("featuresremoved",{features:n})},destroyFeatures:function(e,t){var n=void 0==e;n&&(e=this.features);if(e){this.removeFeatures(e,t);for(var r=e.length-1;r>=0;r--)e[r].destroy()}},drawFeature:function(e,t){if(this.drawn){if("object"!=typeof t){t||e.state!==OpenLayers.State.DELETE||(t="delete");var n=t||e.renderIntent;t=e.style||this.style;t||(t=this.styleMap.createSymbolizer(e,n))}var r=this.renderer.drawFeature(e,t);r===!1||null===r?this.unrenderedFeatures[e.id]=e:delete this.unrenderedFeatures[e.id]}},eraseFeatures:function(e){this.renderer.eraseFeatures(e)},getFeatureFromEvent:function(e){if(!this.renderer)throw new Error("getFeatureFromEvent called on layer with no renderer. This usually means you destroyed a layer, but not some handler which is associated with it.");var t=null,n=this.renderer.getFeatureIdFromEvent(e);n&&(t="string"==typeof n?this.getFeatureById(n):n);return t},getFeatureBy:function(e,t){for(var n=null,r=0,i=this.features.length;i>r;++r)if(this.features[r][e]==t){n=this.features[r];break}return n},getFeatureById:function(e){return this.getFeatureBy("id",e)},getFeatureByFid:function(e){return this.getFeatureBy("fid",e)},getFeaturesByAttribute:function(e,t){var n,r,i=this.features.length,a=[];for(n=0;i>n;n++){r=this.features[n];r&&r.attributes&&r.attributes[e]===t&&a.push(r)}return a},onFeatureInsert:function(e){},preFeatureInsert:function(e){},getDataExtent:function(){var e=null,t=this.features;if(t&&t.length>0)for(var n=null,r=0,i=t.length;i>r;r++){n=t[r].geometry;if(n){null===e&&(e=new OpenLayers.Bounds);e.extend(n.getBounds())}}return e},CLASS_NAME:"OpenLayers.Layer.Vector"});OpenLayers.Renderer.SVG=OpenLayers.Class(OpenLayers.Renderer.Elements,{xmlns:"http://www.w3.org/2000/svg",xlinkns:"http://www.w3.org/1999/xlink",MAX_PIXEL:15e3,translationParameters:null,symbolMetrics:null,initialize:function(e){if(this.supported()){OpenLayers.Renderer.Elements.prototype.initialize.apply(this,arguments);this.translationParameters={x:0,y:0};this.symbolMetrics={}}},supported:function(){var e="http://www.w3.org/TR/SVG11/feature#";return document.implementation&&(document.implementation.hasFeature("org.w3c.svg","1.0")||document.implementation.hasFeature(e+"SVG","1.1")||document.implementation.hasFeature(e+"BasicStructure","1.1"))},inValidRange:function(e,t,n){var r=e+(n?0:this.translationParameters.x),i=t+(n?0:this.translationParameters.y);return r>=-this.MAX_PIXEL&&r<=this.MAX_PIXEL&&i>=-this.MAX_PIXEL&&i<=this.MAX_PIXEL},setExtent:function(e,t){var n=OpenLayers.Renderer.Elements.prototype.setExtent.apply(this,arguments),r=this.getResolution(),i=-e.left/r,a=e.top/r;if(t){this.left=i;this.top=a;var s="0 0 "+this.size.w+" "+this.size.h;this.rendererRoot.setAttributeNS(null,"viewBox",s);this.translate(this.xOffset,0);return!0}var o=this.translate(i-this.left+this.xOffset,a-this.top);o||this.setExtent(e,!0);return n&&o},translate:function(e,t){if(this.inValidRange(e,t,!0)){var n="";(e||t)&&(n="translate("+e+","+t+")");this.root.setAttributeNS(null,"transform",n);this.translationParameters={x:e,y:t};return!0}return!1},setSize:function(e){OpenLayers.Renderer.prototype.setSize.apply(this,arguments);this.rendererRoot.setAttributeNS(null,"width",this.size.w);this.rendererRoot.setAttributeNS(null,"height",this.size.h)},getNodeType:function(e,t){var n=null;switch(e.CLASS_NAME){case"OpenLayers.Geometry.Point":n=t.externalGraphic?"image":this.isComplexSymbol(t.graphicName)?"svg":"circle";break;case"OpenLayers.Geometry.Rectangle":n="rect";break;case"OpenLayers.Geometry.LineString":n="polyline";break;case"OpenLayers.Geometry.LinearRing":n="polygon";break;case"OpenLayers.Geometry.Polygon":case"OpenLayers.Geometry.Curve":n="path"}return n},setStyle:function(e,t,n){t=t||e._style;n=n||e._options;var r=t.title||t.graphicTitle;if(r){e.setAttributeNS(null,"title",r);var i=e.getElementsByTagName("title");if(i.length>0)i[0].firstChild.textContent=r;else{var a=this.nodeFactory(null,"title");a.textContent=r;e.appendChild(a)}}var s,o=parseFloat(e.getAttributeNS(null,"r")),l=1;if("OpenLayers.Geometry.Point"==e._geometryClass&&o){e.style.visibility="";if(t.graphic===!1)e.style.visibility="hidden";else if(t.externalGraphic){s=this.getPosition(e);t.graphicWidth&&t.graphicHeight&&e.setAttributeNS(null,"preserveAspectRatio","none");var c=t.graphicWidth||t.graphicHeight,u=t.graphicHeight||t.graphicWidth;c=c?c:2*t.pointRadius;u=u?u:2*t.pointRadius;var h=void 0!=t.graphicXOffset?t.graphicXOffset:-(.5*c),p=void 0!=t.graphicYOffset?t.graphicYOffset:-(.5*u),d=t.graphicOpacity||t.fillOpacity;e.setAttributeNS(null,"x",(s.x+h).toFixed());e.setAttributeNS(null,"y",(s.y+p).toFixed());e.setAttributeNS(null,"width",c);e.setAttributeNS(null,"height",u);e.setAttributeNS(this.xlinkns,"xlink:href",t.externalGraphic);e.setAttributeNS(null,"style","opacity: "+d);e.onclick=OpenLayers.Event.preventDefault}else if(this.isComplexSymbol(t.graphicName)){var f=3*t.pointRadius,m=2*f,y=this.importSymbol(t.graphicName);s=this.getPosition(e);l=3*this.symbolMetrics[y.id][0]/m;var g=e.parentNode,v=e.nextSibling;g&&g.removeChild(e);e.firstChild&&e.removeChild(e.firstChild);e.appendChild(y.firstChild.cloneNode(!0));e.setAttributeNS(null,"viewBox",y.getAttributeNS(null,"viewBox"));e.setAttributeNS(null,"width",m);e.setAttributeNS(null,"height",m);e.setAttributeNS(null,"x",s.x-f);e.setAttributeNS(null,"y",s.y-f);v?g.insertBefore(e,v):g&&g.appendChild(e)}else e.setAttributeNS(null,"r",t.pointRadius);var C=t.rotation;if((void 0!==C||void 0!==e._rotation)&&s){e._rotation=C;C|=0;if("svg"!==e.nodeName)e.setAttributeNS(null,"transform","rotate("+C+" "+s.x+" "+s.y+")");else{var L=this.symbolMetrics[y.id];e.firstChild.setAttributeNS(null,"transform","rotate("+C+" "+L[1]+" "+L[2]+")")}}}if(n.isFilled){e.setAttributeNS(null,"fill",t.fillColor);e.setAttributeNS(null,"fill-opacity",t.fillOpacity)}else e.setAttributeNS(null,"fill","none");if(n.isStroked){e.setAttributeNS(null,"stroke",t.strokeColor);e.setAttributeNS(null,"stroke-opacity",t.strokeOpacity);e.setAttributeNS(null,"stroke-width",t.strokeWidth*l);e.setAttributeNS(null,"stroke-linecap",t.strokeLinecap||"round");e.setAttributeNS(null,"stroke-linejoin","round");t.strokeDashstyle&&e.setAttributeNS(null,"stroke-dasharray",this.dashStyle(t,l))}else e.setAttributeNS(null,"stroke","none");t.pointerEvents&&e.setAttributeNS(null,"pointer-events",t.pointerEvents);null!=t.cursor&&e.setAttributeNS(null,"cursor",t.cursor);return e},dashStyle:function(e,t){var n=e.strokeWidth*t,r=e.strokeDashstyle;switch(r){case"solid":return"none";case"dot":return[1,4*n].join();case"dash":return[4*n,4*n].join();case"dashdot":return[4*n,4*n,1,4*n].join();case"longdash":return[8*n,4*n].join();case"longdashdot":return[8*n,4*n,1,4*n].join();default:return OpenLayers.String.trim(r).replace(/\s+/g,",")}},createNode:function(e,t){var n=document.createElementNS(this.xmlns,e);t&&n.setAttributeNS(null,"id",t);return n},nodeTypeCompare:function(e,t){return t==e.nodeName},createRenderRoot:function(){var e=this.nodeFactory(this.container.id+"_svgRoot","svg");e.style.display="block";return e},createRoot:function(e){return this.nodeFactory(this.container.id+e,"g")},createDefs:function(){var e=this.nodeFactory(this.container.id+"_defs","defs");this.rendererRoot.appendChild(e);return e},drawPoint:function(e,t){return this.drawCircle(e,t,1)},drawCircle:function(e,t,n){var r=this.getResolution(),i=(t.x-this.featureDx)/r+this.left,a=this.top-t.y/r;if(this.inValidRange(i,a)){e.setAttributeNS(null,"cx",i);e.setAttributeNS(null,"cy",a);e.setAttributeNS(null,"r",n);return e}return!1},drawLineString:function(e,t){var n=this.getComponentsString(t.components);if(n.path){e.setAttributeNS(null,"points",n.path);return n.complete?e:null}return!1},drawLinearRing:function(e,t){var n=this.getComponentsString(t.components);if(n.path){e.setAttributeNS(null,"points",n.path);return n.complete?e:null}return!1},drawPolygon:function(e,t){for(var n,r,i="",a=!0,s=!0,o=0,l=t.components.length;l>o;o++){i+=" M";n=this.getComponentsString(t.components[o].components," ");r=n.path;if(r){i+=" "+r;s=n.complete&&s}else a=!1}i+=" z";if(a){e.setAttributeNS(null,"d",i);e.setAttributeNS(null,"fill-rule","evenodd");return s?e:null}return!1},drawRectangle:function(e,t){var n=this.getResolution(),r=(t.x-this.featureDx)/n+this.left,i=this.top-t.y/n;if(this.inValidRange(r,i)){e.setAttributeNS(null,"x",r);e.setAttributeNS(null,"y",i);e.setAttributeNS(null,"width",t.width/n);e.setAttributeNS(null,"height",t.height/n);return e}return!1},drawText:function(e,t,n){var r=!!t.labelOutlineWidth;if(r){var i=OpenLayers.Util.extend({},t);i.fontColor=i.labelOutlineColor;i.fontStrokeColor=i.labelOutlineColor;i.fontStrokeWidth=t.labelOutlineWidth;t.labelOutlineOpacity&&(i.fontOpacity=t.labelOutlineOpacity);delete i.labelOutlineWidth;this.drawText(e,i,n)}var a=this.getResolution(),s=(n.x-this.featureDx)/a+this.left,o=n.y/a-this.top,l=r?this.LABEL_OUTLINE_SUFFIX:this.LABEL_ID_SUFFIX,c=this.nodeFactory(e+l,"text");c.setAttributeNS(null,"x",s);c.setAttributeNS(null,"y",-o);t.fontColor&&c.setAttributeNS(null,"fill",t.fontColor);t.fontStrokeColor&&c.setAttributeNS(null,"stroke",t.fontStrokeColor);t.fontStrokeWidth&&c.setAttributeNS(null,"stroke-width",t.fontStrokeWidth);t.fontOpacity&&c.setAttributeNS(null,"opacity",t.fontOpacity);t.fontFamily&&c.setAttributeNS(null,"font-family",t.fontFamily);t.fontSize&&c.setAttributeNS(null,"font-size",t.fontSize);t.fontWeight&&c.setAttributeNS(null,"font-weight",t.fontWeight);t.fontStyle&&c.setAttributeNS(null,"font-style",t.fontStyle);if(t.labelSelect===!0){c.setAttributeNS(null,"pointer-events","visible");c._featureId=e}else c.setAttributeNS(null,"pointer-events","none");var u=t.labelAlign||OpenLayers.Renderer.defaultSymbolizer.labelAlign;c.setAttributeNS(null,"text-anchor",OpenLayers.Renderer.SVG.LABEL_ALIGN[u[0]]||"middle");OpenLayers.IS_GECKO===!0&&c.setAttributeNS(null,"dominant-baseline",OpenLayers.Renderer.SVG.LABEL_ALIGN[u[1]]||"central");for(var h=t.label.split("\n"),p=h.length;c.childNodes.length>p;)c.removeChild(c.lastChild);for(var d=0;p>d;d++){var f=this.nodeFactory(e+l+"_tspan_"+d,"tspan");if(t.labelSelect===!0){f._featureId=e;f._geometry=n;f._geometryClass=n.CLASS_NAME}OpenLayers.IS_GECKO===!1&&f.setAttributeNS(null,"baseline-shift",OpenLayers.Renderer.SVG.LABEL_VSHIFT[u[1]]||"-35%");f.setAttribute("x",s);if(0==d){var m=OpenLayers.Renderer.SVG.LABEL_VFACTOR[u[1]];null==m&&(m=-.5);f.setAttribute("dy",m*(p-1)+"em")}else f.setAttribute("dy","1em");f.textContent=""===h[d]?" ":h[d];f.parentNode||c.appendChild(f)}c.parentNode||this.textRoot.appendChild(c)},getComponentsString:function(e,t){for(var n,r,i=[],a=!0,s=e.length,o=[],l=0;s>l;l++){r=e[l];i.push(r);n=this.getShortString(r);if(n)o.push(n);else{l>0&&this.getShortString(e[l-1])&&o.push(this.clipLine(e[l],e[l-1]));s-1>l&&this.getShortString(e[l+1])&&o.push(this.clipLine(e[l],e[l+1]));a=!1}}return{path:o.join(t||","),complete:a}},clipLine:function(e,t){if(t.equals(e))return"";var n,r=this.getResolution(),i=this.MAX_PIXEL-this.translationParameters.x,a=this.MAX_PIXEL-this.translationParameters.y,s=(t.x-this.featureDx)/r+this.left,o=this.top-t.y/r,l=(e.x-this.featureDx)/r+this.left,c=this.top-e.y/r;if(-i>l||l>i){n=(c-o)/(l-s);l=0>l?-i:i;c=o+(l-s)*n}if(-a>c||c>a){n=(l-s)/(c-o);c=0>c?-a:a;l=s+(c-o)*n}return l+","+c},getShortString:function(e){var t=this.getResolution(),n=(e.x-this.featureDx)/t+this.left,r=this.top-e.y/t;return this.inValidRange(n,r)?n+","+r:!1},getPosition:function(e){return{x:parseFloat(e.getAttributeNS(null,"cx")),y:parseFloat(e.getAttributeNS(null,"cy"))}},importSymbol:function(e){this.defs||(this.defs=this.createDefs());var t=this.container.id+"-"+e,n=document.getElementById(t);if(null!=n)return n;var r=OpenLayers.Renderer.symbol[e];if(!r)throw new Error(e+" is not a valid symbol name");var i=this.nodeFactory(t,"symbol"),a=this.nodeFactory(null,"polygon");i.appendChild(a);for(var s,o,l=new OpenLayers.Bounds(Number.MAX_VALUE,Number.MAX_VALUE,0,0),c=[],u=0;u<r.length;u+=2){s=r[u];o=r[u+1];l.left=Math.min(l.left,s);l.bottom=Math.min(l.bottom,o);l.right=Math.max(l.right,s);l.top=Math.max(l.top,o);c.push(s,",",o)}a.setAttributeNS(null,"points",c.join(" "));var h=l.getWidth(),p=l.getHeight(),d=[l.left-h,l.bottom-p,3*h,3*p];i.setAttributeNS(null,"viewBox",d.join(" "));this.symbolMetrics[t]=[Math.max(h,p),l.getCenterLonLat().lon,l.getCenterLonLat().lat];this.defs.appendChild(i);return i},getFeatureIdFromEvent:function(e){var t=OpenLayers.Renderer.Elements.prototype.getFeatureIdFromEvent.apply(this,arguments);if(!t){var n=e.target;t=n.parentNode&&n!=this.rendererRoot?n.parentNode._featureId:void 0}return t},CLASS_NAME:"OpenLayers.Renderer.SVG"});OpenLayers.Renderer.SVG.LABEL_ALIGN={l:"start",r:"end",b:"bottom",t:"hanging"};OpenLayers.Renderer.SVG.LABEL_VSHIFT={t:"-70%",b:"0"};OpenLayers.Renderer.SVG.LABEL_VFACTOR={t:0,b:-1};OpenLayers.Renderer.SVG.preventDefault=function(e){OpenLayers.Event.preventDefault(e)};OpenLayers.Control.ScaleLine=OpenLayers.Class(OpenLayers.Control,{maxWidth:100,topOutUnits:"km",topInUnits:"m",bottomOutUnits:"mi",bottomInUnits:"ft",eTop:null,eBottom:null,geodesic:!1,draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);if(!this.eTop){this.eTop=document.createElement("div");this.eTop.className=this.displayClass+"Top";{this.topInUnits.length}this.div.appendChild(this.eTop);this.eTop.style.visibility=""==this.topOutUnits||""==this.topInUnits?"hidden":"visible";this.eBottom=document.createElement("div");this.eBottom.className=this.displayClass+"Bottom";this.div.appendChild(this.eBottom);this.eBottom.style.visibility=""==this.bottomOutUnits||""==this.bottomInUnits?"hidden":"visible"}this.map.events.register("moveend",this,this.update);this.update();return this.div},getBarLen:function(e){var t,n=parseInt(Math.log(e)/Math.log(10)),r=Math.pow(10,n),i=parseInt(e/r);t=i>5?5:i>2?2:1;return t*r},update:function(){var e=this.map.getResolution();if(e){var t=this.map.getUnits(),n=OpenLayers.INCHES_PER_UNIT,r=this.maxWidth*e*n[t],i=1;if(this.geodesic===!0){var a=(this.map.getGeodesicPixelSize().w||1e-6)*this.maxWidth,s=r/n.km;i=a/s;r*=i}var o,l;if(r>1e5){o=this.topOutUnits;l=this.bottomOutUnits}else{o=this.topInUnits;l=this.bottomInUnits}var c=r/n[o],u=r/n[l],h=this.getBarLen(c),p=this.getBarLen(u);c=h/n[t]*n[o];u=p/n[t]*n[l];var d=c/e/i,f=u/e/i;if("visible"==this.eBottom.style.visibility){this.eBottom.style.width=Math.round(f)+"px";this.eBottom.innerHTML=p+" "+l}if("visible"==this.eTop.style.visibility){this.eTop.style.width=Math.round(d)+"px";this.eTop.innerHTML=h+" "+o}}},CLASS_NAME:"OpenLayers.Control.ScaleLine"});OpenLayers.Icon=OpenLayers.Class({url:null,size:null,offset:null,calculateOffset:null,imageDiv:null,px:null,initialize:function(e,t,n,r){this.url=e;this.size=t||{w:20,h:20};this.offset=n||{x:-(this.size.w/2),y:-(this.size.h/2)};this.calculateOffset=r;var i=OpenLayers.Util.createUniqueID("OL_Icon_");this.imageDiv=OpenLayers.Util.createAlphaImageDiv(i)},destroy:function(){this.erase();OpenLayers.Event.stopObservingElement(this.imageDiv.firstChild);this.imageDiv.innerHTML="";this.imageDiv=null},clone:function(){return new OpenLayers.Icon(this.url,this.size,this.offset,this.calculateOffset)},setSize:function(e){null!=e&&(this.size=e);this.draw()},setUrl:function(e){null!=e&&(this.url=e);this.draw()},draw:function(e){OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,null,this.size,this.url,"absolute");this.moveTo(e);return this.imageDiv},erase:function(){null!=this.imageDiv&&null!=this.imageDiv.parentNode&&OpenLayers.Element.remove(this.imageDiv)},setOpacity:function(e){OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,null,null,null,null,null,null,e)},moveTo:function(e){null!=e&&(this.px=e);if(null!=this.imageDiv)if(null==this.px)this.display(!1);else{this.calculateOffset&&(this.offset=this.calculateOffset(this.size));OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,{x:this.px.x+this.offset.x,y:this.px.y+this.offset.y})}},display:function(e){this.imageDiv.style.display=e?"":"none"},isDrawn:function(){var e=this.imageDiv&&this.imageDiv.parentNode&&11!=this.imageDiv.parentNode.nodeType;return e},CLASS_NAME:"OpenLayers.Icon"});OpenLayers.Marker=OpenLayers.Class({icon:null,lonlat:null,events:null,map:null,initialize:function(e,t){this.lonlat=e;var n=t?t:OpenLayers.Marker.defaultIcon();if(null==this.icon)this.icon=n;else{this.icon.url=n.url;this.icon.size=n.size;this.icon.offset=n.offset;this.icon.calculateOffset=n.calculateOffset}this.events=new OpenLayers.Events(this,this.icon.imageDiv)},destroy:function(){this.erase();this.map=null;this.events.destroy();this.events=null;if(null!=this.icon){this.icon.destroy();this.icon=null}},draw:function(e){return this.icon.draw(e)},erase:function(){null!=this.icon&&this.icon.erase()},moveTo:function(e){null!=e&&null!=this.icon&&this.icon.moveTo(e);this.lonlat=this.map.getLonLatFromLayerPx(e)},isDrawn:function(){var e=this.icon&&this.icon.isDrawn();return e},onScreen:function(){var e=!1;if(this.map){var t=this.map.getExtent();e=t.containsLonLat(this.lonlat)}return e},inflate:function(e){this.icon&&this.icon.setSize({w:this.icon.size.w*e,h:this.icon.size.h*e})},setOpacity:function(e){this.icon.setOpacity(e)},setUrl:function(e){this.icon.setUrl(e)},display:function(e){this.icon.display(e)},CLASS_NAME:"OpenLayers.Marker"});OpenLayers.Marker.defaultIcon=function(){return new OpenLayers.Icon(OpenLayers.Util.getImageLocation("marker.png"),{w:21,h:25},{x:-10.5,y:-25})};OpenLayers.Format.JSON=OpenLayers.Class(OpenLayers.Format,{indent:"    ",space:" ",newline:"\n",level:0,pretty:!1,nativeJSON:function(){return!(!window.JSON||"function"!=typeof JSON.parse||"function"!=typeof JSON.stringify)}(),read:function(json,filter){function walk(e,t){if(t&&"object"==typeof t)for(var n in t)t.hasOwnProperty(n)&&(t[n]=walk(n,t[n]));return filter(e,t)}var object;if(this.nativeJSON)object=JSON.parse(json,filter);else try{if(/^[\],:{}\s]*$/.test(json.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){object=eval("("+json+")");"function"==typeof filter&&(object=walk("",object))}}catch(e){}this.keepData&&(this.data=object);return object},write:function(e,t){this.pretty=!!t;var n=null,r=typeof e;if(this.serialize[r])try{n=!this.pretty&&this.nativeJSON?JSON.stringify(e):this.serialize[r].apply(this,[e])}catch(i){OpenLayers.Console.error("Trouble serializing: "+i)}return n},writeIndent:function(){var e=[];if(this.pretty)for(var t=0;t<this.level;++t)e.push(this.indent);return e.join("")},writeNewline:function(){return this.pretty?this.newline:""},writeSpace:function(){return this.pretty?this.space:""},serialize:{object:function(e){if(null==e)return"null";if(e.constructor==Date)return this.serialize.date.apply(this,[e]);if(e.constructor==Array)return this.serialize.array.apply(this,[e]);var t=["{"];this.level+=1;var n,r,i,a=!1;for(n in e)if(e.hasOwnProperty(n)){r=OpenLayers.Format.JSON.prototype.write.apply(this,[n,this.pretty]);i=OpenLayers.Format.JSON.prototype.write.apply(this,[e[n],this.pretty]);if(null!=r&&null!=i){a&&t.push(",");t.push(this.writeNewline(),this.writeIndent(),r,":",this.writeSpace(),i);a=!0}}this.level-=1;t.push(this.writeNewline(),this.writeIndent(),"}");return t.join("")},array:function(e){var t,n=["["];this.level+=1;for(var r=0,i=e.length;i>r;++r){t=OpenLayers.Format.JSON.prototype.write.apply(this,[e[r],this.pretty]);if(null!=t){r>0&&n.push(",");n.push(this.writeNewline(),this.writeIndent(),t)}}this.level-=1;n.push(this.writeNewline(),this.writeIndent(),"]");return n.join("")},string:function(e){var t={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return/["\\\x00-\x1f]/.test(e)?'"'+e.replace(/([\x00-\x1f\\"])/g,function(e,n){var r=t[n];if(r)return r;r=n.charCodeAt();return"\\u00"+Math.floor(r/16).toString(16)+(r%16).toString(16)})+'"':'"'+e+'"'},number:function(e){return isFinite(e)?String(e):"null"},"boolean":function(e){return String(e)},date:function(e){function t(e){return 10>e?"0"+e:e}return'"'+e.getFullYear()+"-"+t(e.getMonth()+1)+"-"+t(e.getDate())+"T"+t(e.getHours())+":"+t(e.getMinutes())+":"+t(e.getSeconds())+'"'}},CLASS_NAME:"OpenLayers.Format.JSON"});OpenLayers.Format.GeoJSON=OpenLayers.Class(OpenLayers.Format.JSON,{ignoreExtraDims:!1,read:function(e,t,n){t=t?t:"FeatureCollection";var r=null,i=null;i="string"==typeof e?OpenLayers.Format.JSON.prototype.read.apply(this,[e,n]):e;if(i){if("string"!=typeof i.type)OpenLayers.Console.error("Bad GeoJSON - no type: "+e);else if(this.isValidType(i,t))switch(t){case"Geometry":try{r=this.parseGeometry(i)}catch(a){OpenLayers.Console.error(a)}break;case"Feature":try{r=this.parseFeature(i);r.type="Feature"}catch(a){OpenLayers.Console.error(a)}break;case"FeatureCollection":r=[];switch(i.type){case"Feature":try{r.push(this.parseFeature(i))}catch(a){r=null;OpenLayers.Console.error(a)}break;case"FeatureCollection":for(var s=0,o=i.features.length;o>s;++s)try{r.push(this.parseFeature(i.features[s]))}catch(a){r=null;OpenLayers.Console.error(a)}break;default:try{var l=this.parseGeometry(i);r.push(new OpenLayers.Feature.Vector(l))}catch(a){r=null;OpenLayers.Console.error(a)}}}}else OpenLayers.Console.error("Bad JSON: "+e);return r},isValidType:function(e,t){var n=!1;switch(t){case"Geometry":-1==OpenLayers.Util.indexOf(["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon","Box","GeometryCollection"],e.type)?OpenLayers.Console.error("Unsupported geometry type: "+e.type):n=!0;break;case"FeatureCollection":n=!0;break;default:e.type==t?n=!0:OpenLayers.Console.error("Cannot convert types from "+e.type+" to "+t)}return n},parseFeature:function(e){var t,n,r,i;r=e.properties?e.properties:{};i=e.geometry&&e.geometry.bbox||e.bbox;try{n=this.parseGeometry(e.geometry)}catch(a){throw a}t=new OpenLayers.Feature.Vector(n,r);i&&(t.bounds=OpenLayers.Bounds.fromArray(i));e.id&&(t.fid=e.id);return t},parseGeometry:function(e){if(null==e)return null;var t,n=!1;if("GeometryCollection"==e.type){if(!OpenLayers.Util.isArray(e.geometries))throw"GeometryCollection must have geometries array: "+e;for(var r=e.geometries.length,i=new Array(r),a=0;r>a;++a)i[a]=this.parseGeometry.apply(this,[e.geometries[a]]);t=new OpenLayers.Geometry.Collection(i);n=!0}else{if(!OpenLayers.Util.isArray(e.coordinates))throw"Geometry must have coordinates array: "+e;if(!this.parseCoords[e.type.toLowerCase()])throw"Unsupported geometry type: "+e.type;try{t=this.parseCoords[e.type.toLowerCase()].apply(this,[e.coordinates])}catch(s){throw s}}this.internalProjection&&this.externalProjection&&!n&&t.transform(this.externalProjection,this.internalProjection);return t},parseCoords:{point:function(e){if(0==this.ignoreExtraDims&&2!=e.length)throw"Only 2D points are supported: "+e;return new OpenLayers.Geometry.Point(e[0],e[1])},multipoint:function(e){for(var t=[],n=null,r=0,i=e.length;i>r;++r){try{n=this.parseCoords.point.apply(this,[e[r]])}catch(a){throw a}t.push(n)}return new OpenLayers.Geometry.MultiPoint(t)},linestring:function(e){for(var t=[],n=null,r=0,i=e.length;i>r;++r){try{n=this.parseCoords.point.apply(this,[e[r]])}catch(a){throw a}t.push(n)}return new OpenLayers.Geometry.LineString(t)},multilinestring:function(e){for(var t=[],n=null,r=0,i=e.length;i>r;++r){try{n=this.parseCoords.linestring.apply(this,[e[r]])}catch(a){throw a}t.push(n)}return new OpenLayers.Geometry.MultiLineString(t)},polygon:function(e){for(var t,n,r=[],i=0,a=e.length;a>i;++i){try{n=this.parseCoords.linestring.apply(this,[e[i]])}catch(s){throw s}t=new OpenLayers.Geometry.LinearRing(n.components);r.push(t)}return new OpenLayers.Geometry.Polygon(r)},multipolygon:function(e){for(var t=[],n=null,r=0,i=e.length;i>r;++r){try{n=this.parseCoords.polygon.apply(this,[e[r]])}catch(a){throw a}t.push(n)}return new OpenLayers.Geometry.MultiPolygon(t)},box:function(e){if(2!=e.length)throw"GeoJSON box coordinates must have 2 elements";return new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(e[0][0],e[0][1]),new OpenLayers.Geometry.Point(e[1][0],e[0][1]),new OpenLayers.Geometry.Point(e[1][0],e[1][1]),new OpenLayers.Geometry.Point(e[0][0],e[1][1]),new OpenLayers.Geometry.Point(e[0][0],e[0][1])])])}},write:function(e,t){var n={type:null};if(OpenLayers.Util.isArray(e)){n.type="FeatureCollection";var r=e.length;n.features=new Array(r);for(var i=0;r>i;++i){var a=e[i];if(!a instanceof OpenLayers.Feature.Vector){var s="FeatureCollection only supports collections of features: "+a;throw s}n.features[i]=this.extract.feature.apply(this,[a])}}else if(0==e.CLASS_NAME.indexOf("OpenLayers.Geometry"))n=this.extract.geometry.apply(this,[e]);else if(e instanceof OpenLayers.Feature.Vector){n=this.extract.feature.apply(this,[e]);e.layer&&e.layer.projection&&(n.crs=this.createCRSObject(e))}return OpenLayers.Format.JSON.prototype.write.apply(this,[n,t])},createCRSObject:function(e){var t=e.layer.projection.toString(),n={};if(t.match(/epsg:/i)){var r=parseInt(t.substring(t.indexOf(":")+1));n=4326==r?{type:"name",properties:{name:"urn:ogc:def:crs:OGC:1.3:CRS84"}}:{type:"name",properties:{name:"EPSG:"+r}}}return n},extract:{feature:function(e){var t=this.extract.geometry.apply(this,[e.geometry]),n={type:"Feature",properties:e.attributes,geometry:t};null!=e.fid&&(n.id=e.fid);return n},geometry:function(e){if(null==e)return null;if(this.internalProjection&&this.externalProjection){e=e.clone();e.transform(this.internalProjection,this.externalProjection)}var t,n=e.CLASS_NAME.split(".")[2],r=this.extract[n.toLowerCase()].apply(this,[e]);t="Collection"==n?{type:"GeometryCollection",geometries:r}:{type:n,coordinates:r};return t},point:function(e){return[e.x,e.y]},multipoint:function(e){for(var t=[],n=0,r=e.components.length;r>n;++n)t.push(this.extract.point.apply(this,[e.components[n]]));return t},linestring:function(e){for(var t=[],n=0,r=e.components.length;r>n;++n)t.push(this.extract.point.apply(this,[e.components[n]]));return t},multilinestring:function(e){for(var t=[],n=0,r=e.components.length;r>n;++n)t.push(this.extract.linestring.apply(this,[e.components[n]]));return t},polygon:function(e){for(var t=[],n=0,r=e.components.length;r>n;++n)t.push(this.extract.linestring.apply(this,[e.components[n]]));return t},multipolygon:function(e){for(var t=[],n=0,r=e.components.length;r>n;++n)t.push(this.extract.polygon.apply(this,[e.components[n]]));return t},collection:function(e){for(var t=e.components.length,n=new Array(t),r=0;t>r;++r)n[r]=this.extract.geometry.apply(this,[e.components[r]]);return n}},CLASS_NAME:"OpenLayers.Format.GeoJSON"});OpenLayers.Popup=OpenLayers.Class({events:null,id:"",lonlat:null,div:null,contentSize:null,size:null,contentHTML:null,backgroundColor:"",opacity:"",border:"",contentDiv:null,groupDiv:null,closeDiv:null,autoSize:!1,minSize:null,maxSize:null,displayClass:"olPopup",contentDisplayClass:"olPopupContent",padding:0,disableFirefoxOverflowHack:!1,fixPadding:function(){"number"==typeof this.padding&&(this.padding=new OpenLayers.Bounds(this.padding,this.padding,this.padding,this.padding))},panMapIfOutOfView:!1,keepInMap:!1,closeOnMove:!1,map:null,initialize:function(e,t,n,r,i,a){null==e&&(e=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_"));this.id=e;this.lonlat=t;this.contentSize=null!=n?n:new OpenLayers.Size(OpenLayers.Popup.WIDTH,OpenLayers.Popup.HEIGHT);null!=r&&(this.contentHTML=r);this.backgroundColor=OpenLayers.Popup.COLOR;this.opacity=OpenLayers.Popup.OPACITY;this.border=OpenLayers.Popup.BORDER;this.div=OpenLayers.Util.createDiv(this.id,null,null,null,null,null,"hidden");this.div.className=this.displayClass;var s=this.id+"_GroupDiv";this.groupDiv=OpenLayers.Util.createDiv(s,null,null,null,"relative",null,"hidden");var e=this.div.id+"_contentDiv";this.contentDiv=OpenLayers.Util.createDiv(e,null,this.contentSize.clone(),null,"relative");this.contentDiv.className=this.contentDisplayClass;this.groupDiv.appendChild(this.contentDiv);this.div.appendChild(this.groupDiv);i&&this.addCloseBox(a);this.registerEvents()},destroy:function(){this.id=null;this.lonlat=null;this.size=null;this.contentHTML=null;this.backgroundColor=null;this.opacity=null;this.border=null;this.closeOnMove&&this.map&&this.map.events.unregister("movestart",this,this.hide);

this.events.destroy();this.events=null;if(this.closeDiv){OpenLayers.Event.stopObservingElement(this.closeDiv);this.groupDiv.removeChild(this.closeDiv)}this.closeDiv=null;this.div.removeChild(this.groupDiv);this.groupDiv=null;null!=this.map&&this.map.removePopup(this);this.map=null;this.div=null;this.autoSize=null;this.minSize=null;this.maxSize=null;this.padding=null;this.panMapIfOutOfView=null},draw:function(e){null==e&&null!=this.lonlat&&null!=this.map&&(e=this.map.getLayerPxFromLonLat(this.lonlat));this.closeOnMove&&this.map.events.register("movestart",this,this.hide);if(!this.disableFirefoxOverflowHack&&"firefox"==OpenLayers.BROWSER_NAME){this.map.events.register("movestart",this,function(){var e=document.defaultView.getComputedStyle(this.contentDiv,null),t=e.getPropertyValue("overflow");if("hidden"!=t){this.contentDiv._oldOverflow=t;this.contentDiv.style.overflow="hidden"}});this.map.events.register("moveend",this,function(){var e=this.contentDiv._oldOverflow;if(e){this.contentDiv.style.overflow=e;this.contentDiv._oldOverflow=null}})}this.moveTo(e);this.autoSize||this.size||this.setSize(this.contentSize);this.setBackgroundColor();this.setOpacity();this.setBorder();this.setContentHTML();this.panMapIfOutOfView&&this.panIntoView();return this.div},updatePosition:function(){if(this.lonlat&&this.map){var e=this.map.getLayerPxFromLonLat(this.lonlat);e&&this.moveTo(e)}},moveTo:function(e){if(null!=e&&null!=this.div){this.div.style.left=e.x+"px";this.div.style.top=e.y+"px"}},visible:function(){return OpenLayers.Element.visible(this.div)},toggle:function(){this.visible()?this.hide():this.show()},show:function(){this.div.style.display="";this.panMapIfOutOfView&&this.panIntoView()},hide:function(){this.div.style.display="none"},setSize:function(e){this.size=e.clone();var t=this.getContentDivPadding(),n=t.left+t.right,r=t.top+t.bottom;this.fixPadding();n+=this.padding.left+this.padding.right;r+=this.padding.top+this.padding.bottom;if(this.closeDiv){var i=parseInt(this.closeDiv.style.width);n+=i+t.right}this.size.w+=n;this.size.h+=r;if("msie"==OpenLayers.BROWSER_NAME){this.contentSize.w+=t.left+t.right;this.contentSize.h+=t.bottom+t.top}if(null!=this.div){this.div.style.width=this.size.w+"px";this.div.style.height=this.size.h+"px"}if(null!=this.contentDiv){this.contentDiv.style.width=e.w+"px";this.contentDiv.style.height=e.h+"px"}},updateSize:function(){var e="<div class='"+this.contentDisplayClass+"'>"+this.contentDiv.innerHTML+"</div>",t=this.map?this.map.div:document.body,n=OpenLayers.Util.getRenderedDimensions(e,null,{displayClass:this.displayClass,containerElement:t}),r=this.getSafeContentSize(n),i=null;if(r.equals(n))i=n;else{var a={w:r.w<n.w?r.w:null,h:r.h<n.h?r.h:null};if(a.w&&a.h)i=r;else{var s=OpenLayers.Util.getRenderedDimensions(e,a,{displayClass:this.contentDisplayClass,containerElement:t}),o=OpenLayers.Element.getStyle(this.contentDiv,"overflow");if("hidden"!=o&&s.equals(r)){var l=OpenLayers.Util.getScrollbarWidth();a.w?s.h+=l:s.w+=l}i=this.getSafeContentSize(s)}}this.setSize(i)},setBackgroundColor:function(e){void 0!=e&&(this.backgroundColor=e);null!=this.div&&(this.div.style.backgroundColor=this.backgroundColor)},setOpacity:function(e){void 0!=e&&(this.opacity=e);if(null!=this.div){this.div.style.opacity=this.opacity;this.div.style.filter="alpha(opacity="+100*this.opacity+")"}},setBorder:function(e){void 0!=e&&(this.border=e);null!=this.div&&(this.div.style.border=this.border)},setContentHTML:function(e){null!=e&&(this.contentHTML=e);if(null!=this.contentDiv&&null!=this.contentHTML&&this.contentHTML!=this.contentDiv.innerHTML){this.contentDiv.innerHTML=this.contentHTML;if(this.autoSize){this.registerImageListeners();this.updateSize()}}},registerImageListeners:function(){for(var e=function(){if(null!==this.popup.id){this.popup.updateSize();this.popup.visible()&&this.popup.panMapIfOutOfView&&this.popup.panIntoView();OpenLayers.Event.stopObserving(this.img,"load",this.img._onImgLoad)}},t=this.contentDiv.getElementsByTagName("img"),n=0,r=t.length;r>n;n++){var i=t[n];if(0==i.width||0==i.height){var a={popup:this,img:i};i._onImgLoad=OpenLayers.Function.bind(e,a);OpenLayers.Event.observe(i,"load",i._onImgLoad)}}},getSafeContentSize:function(e){var t=e.clone(),n=this.getContentDivPadding(),r=n.left+n.right,i=n.top+n.bottom;this.fixPadding();r+=this.padding.left+this.padding.right;i+=this.padding.top+this.padding.bottom;if(this.closeDiv){var a=parseInt(this.closeDiv.style.width);r+=a+n.right}if(this.minSize){t.w=Math.max(t.w,this.minSize.w-r);t.h=Math.max(t.h,this.minSize.h-i)}if(this.maxSize){t.w=Math.min(t.w,this.maxSize.w-r);t.h=Math.min(t.h,this.maxSize.h-i)}if(this.map&&this.map.size){var s=0,o=0;if(this.keepInMap&&!this.panMapIfOutOfView){var l=this.map.getPixelFromLonLat(this.lonlat);switch(this.relativePosition){case"tr":s=l.x;o=this.map.size.h-l.y;break;case"tl":s=this.map.size.w-l.x;o=this.map.size.h-l.y;break;case"bl":s=this.map.size.w-l.x;o=l.y;break;case"br":s=l.x;o=l.y;break;default:s=l.x;o=this.map.size.h-l.y}}var c=this.map.size.h-this.map.paddingForPopups.top-this.map.paddingForPopups.bottom-i-o,u=this.map.size.w-this.map.paddingForPopups.left-this.map.paddingForPopups.right-r-s;t.w=Math.min(t.w,u);t.h=Math.min(t.h,c)}return t},getContentDivPadding:function(){var e=this._contentDivPadding;if(!e){if(null==this.div.parentNode){this.div.style.display="none";document.body.appendChild(this.div)}e=new OpenLayers.Bounds(OpenLayers.Element.getStyle(this.contentDiv,"padding-left"),OpenLayers.Element.getStyle(this.contentDiv,"padding-bottom"),OpenLayers.Element.getStyle(this.contentDiv,"padding-right"),OpenLayers.Element.getStyle(this.contentDiv,"padding-top"));this._contentDivPadding=e;if(this.div.parentNode==document.body){document.body.removeChild(this.div);this.div.style.display=""}}return e},addCloseBox:function(e){this.closeDiv=OpenLayers.Util.createDiv(this.id+"_close",null,{w:17,h:17});this.closeDiv.className="olPopupCloseBox";var t=this.getContentDivPadding();this.closeDiv.style.right=t.right+"px";this.closeDiv.style.top=t.top+"px";this.groupDiv.appendChild(this.closeDiv);var n=e||function(e){this.hide();OpenLayers.Event.stop(e)};OpenLayers.Event.observe(this.closeDiv,"touchend",OpenLayers.Function.bindAsEventListener(n,this));OpenLayers.Event.observe(this.closeDiv,"click",OpenLayers.Function.bindAsEventListener(n,this))},panIntoView:function(){var e=this.map.getSize(),t=this.map.getViewPortPxFromLayerPx(new OpenLayers.Pixel(parseInt(this.div.style.left),parseInt(this.div.style.top))),n=t.clone();t.x<this.map.paddingForPopups.left?n.x=this.map.paddingForPopups.left:t.x+this.size.w>e.w-this.map.paddingForPopups.right&&(n.x=e.w-this.map.paddingForPopups.right-this.size.w);t.y<this.map.paddingForPopups.top?n.y=this.map.paddingForPopups.top:t.y+this.size.h>e.h-this.map.paddingForPopups.bottom&&(n.y=e.h-this.map.paddingForPopups.bottom-this.size.h);var r=t.x-n.x,i=t.y-n.y;this.map.pan(r,i)},registerEvents:function(){function e(e){OpenLayers.Event.stop(e,!0)}this.events=new OpenLayers.Events(this,this.div,null,!0);this.events.on({mousedown:this.onmousedown,mousemove:this.onmousemove,mouseup:this.onmouseup,click:this.onclick,mouseout:this.onmouseout,dblclick:this.ondblclick,touchstart:e,scope:this})},onmousedown:function(e){this.mousedown=!0;OpenLayers.Event.stop(e,!0)},onmousemove:function(e){this.mousedown&&OpenLayers.Event.stop(e,!0)},onmouseup:function(e){if(this.mousedown){this.mousedown=!1;OpenLayers.Event.stop(e,!0)}},onclick:function(e){OpenLayers.Event.stop(e,!0)},onmouseout:function(e){this.mousedown=!1},ondblclick:function(e){OpenLayers.Event.stop(e,!0)},CLASS_NAME:"OpenLayers.Popup"});OpenLayers.Popup.WIDTH=200;OpenLayers.Popup.HEIGHT=200;OpenLayers.Popup.COLOR="white";OpenLayers.Popup.OPACITY=1;OpenLayers.Popup.BORDER="0px";OpenLayers.Popup.Anchored=OpenLayers.Class(OpenLayers.Popup,{relativePosition:null,keepInMap:!0,anchor:null,initialize:function(e,t,n,r,i,a,s){var o=[e,t,n,r,a,s];OpenLayers.Popup.prototype.initialize.apply(this,o);this.anchor=null!=i?i:{size:new OpenLayers.Size(0,0),offset:new OpenLayers.Pixel(0,0)}},destroy:function(){this.anchor=null;this.relativePosition=null;OpenLayers.Popup.prototype.destroy.apply(this,arguments)},show:function(){this.updatePosition();OpenLayers.Popup.prototype.show.apply(this,arguments)},moveTo:function(e){var t=this.relativePosition;this.relativePosition=this.calculateRelativePosition(e);OpenLayers.Popup.prototype.moveTo.call(this,this.calculateNewPx(e));this.relativePosition!=t&&this.updateRelativePosition()},setSize:function(e){OpenLayers.Popup.prototype.setSize.apply(this,arguments);if(this.lonlat&&this.map){var t=this.map.getLayerPxFromLonLat(this.lonlat);this.moveTo(t)}},calculateRelativePosition:function(e){var t=this.map.getLonLatFromLayerPx(e),n=this.map.getExtent(),r=n.determineQuadrant(t);return OpenLayers.Bounds.oppositeQuadrant(r)},updateRelativePosition:function(){},calculateNewPx:function(e){var t=e.offset(this.anchor.offset),n=this.size||this.contentSize,r="t"==this.relativePosition.charAt(0);t.y+=r?-n.h:this.anchor.size.h;var i="l"==this.relativePosition.charAt(1);t.x+=i?-n.w:this.anchor.size.w;return t},CLASS_NAME:"OpenLayers.Popup.Anchored"});OpenLayers.Popup.Framed=OpenLayers.Class(OpenLayers.Popup.Anchored,{imageSrc:null,imageSize:null,isAlphaImage:!1,positionBlocks:null,blocks:null,fixedRelativePosition:!1,initialize:function(e,t,n,r,i,a,s){OpenLayers.Popup.Anchored.prototype.initialize.apply(this,arguments);if(this.fixedRelativePosition){this.updateRelativePosition();this.calculateRelativePosition=function(e){return this.relativePosition}}this.contentDiv.style.position="absolute";this.contentDiv.style.zIndex=1;a&&(this.closeDiv.style.zIndex=1);this.groupDiv.style.position="absolute";this.groupDiv.style.top="0px";this.groupDiv.style.left="0px";this.groupDiv.style.height="100%";this.groupDiv.style.width="100%"},destroy:function(){this.imageSrc=null;this.imageSize=null;this.isAlphaImage=null;this.fixedRelativePosition=!1;this.positionBlocks=null;for(var e=0;e<this.blocks.length;e++){var t=this.blocks[e];t.image&&t.div.removeChild(t.image);t.image=null;t.div&&this.groupDiv.removeChild(t.div);t.div=null}this.blocks=null;OpenLayers.Popup.Anchored.prototype.destroy.apply(this,arguments)},setBackgroundColor:function(e){},setBorder:function(){},setOpacity:function(e){},setSize:function(e){OpenLayers.Popup.Anchored.prototype.setSize.apply(this,arguments);this.updateBlocks()},updateRelativePosition:function(){this.padding=this.positionBlocks[this.relativePosition].padding;if(this.closeDiv){var e=this.getContentDivPadding();this.closeDiv.style.right=e.right+this.padding.right+"px";this.closeDiv.style.top=e.top+this.padding.top+"px"}this.updateBlocks()},calculateNewPx:function(e){var t=OpenLayers.Popup.Anchored.prototype.calculateNewPx.apply(this,arguments);t=t.offset(this.positionBlocks[this.relativePosition].offset);return t},createBlocks:function(){this.blocks=[];var e=null;for(var t in this.positionBlocks){e=t;break}for(var n=this.positionBlocks[e],r=0;r<n.blocks.length;r++){var i={};this.blocks.push(i);var a=this.id+"_FrameDecorationDiv_"+r;i.div=OpenLayers.Util.createDiv(a,null,null,null,"absolute",null,"hidden",null);var s=this.id+"_FrameDecorationImg_"+r,o=this.isAlphaImage?OpenLayers.Util.createAlphaImageDiv:OpenLayers.Util.createImage;i.image=o(s,null,this.imageSize,this.imageSrc,"absolute",null,null,null);i.div.appendChild(i.image);this.groupDiv.appendChild(i.div)}},updateBlocks:function(){this.blocks||this.createBlocks();if(this.size&&this.relativePosition){for(var e=this.positionBlocks[this.relativePosition],t=0;t<e.blocks.length;t++){var n=e.blocks[t],r=this.blocks[t],i=n.anchor.left,a=n.anchor.bottom,s=n.anchor.right,o=n.anchor.top,l=isNaN(n.size.w)?this.size.w-(s+i):n.size.w,c=isNaN(n.size.h)?this.size.h-(a+o):n.size.h;r.div.style.width=(0>l?0:l)+"px";r.div.style.height=(0>c?0:c)+"px";r.div.style.left=null!=i?i+"px":"";r.div.style.bottom=null!=a?a+"px":"";r.div.style.right=null!=s?s+"px":"";r.div.style.top=null!=o?o+"px":"";r.image.style.left=n.position.x+"px";r.image.style.top=n.position.y+"px"}this.contentDiv.style.left=this.padding.left+"px";this.contentDiv.style.top=this.padding.top+"px"}},CLASS_NAME:"OpenLayers.Popup.Framed"});OpenLayers.Format.WMTSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",yx:{"urn:ogc:def:crs:EPSG::4326":!0},createLayer:function(e,t){if(!("layer"in t))throw new Error("Missing property 'layer' in configuration.");for(var n,r=e.contents,i=(r.layers,0),a=r.layers.length;a>i;++i)if(r.layers[i].identifier===t.layer){n=r.layers[i];break}if(!n)throw new Error("Layer not found");var s=t.format;!s&&n.formats&&n.formats.length&&(s=n.formats[0]);var o;t.matrixSet?o=r.tileMatrixSets[t.matrixSet]:n.tileMatrixSetLinks.length>=1&&(o=r.tileMatrixSets[n.tileMatrixSetLinks[0].tileMatrixSet]);if(!o)throw new Error("matrixSet not found");for(var l,i=0,a=n.styles.length;a>i;++i){l=n.styles[i];if(l.isDefault)break}var c=t.requestEncoding;if(!c){c="KVP";if(e.operationsMetadata.GetTile.dcp.http){var u=e.operationsMetadata.GetTile.dcp.http;if(u.get[0].constraints){var h=u.get[0].constraints,p=h.GetEncoding.allowedValues;p.KVP||!p.REST&&!p.RESTful||(c="REST")}}}var d=[],f=t.params||{};delete t.params;for(var m=0,y=n.dimensions.length;y>m;m++){var g=n.dimensions[m];d.push(g.identifier);f.hasOwnProperty(g.identifier)||(f[g.identifier]=g["default"])}var v=t.projection||o.supportedCRS.replace(/urn:ogc:def:crs:(\w+):(.*:)?(\w+)$/,"$1:$3"),C=t.units||("EPSG:4326"===v?"degrees":"m"),L=[];for(var T in o.matrixIds)o.matrixIds.hasOwnProperty(T)&&L.push(28e-5*o.matrixIds[T].scaleDenominator/OpenLayers.METERS_PER_INCH/OpenLayers.INCHES_PER_UNIT[C]);var w;if("REST"===c&&n.resourceUrls){w=[];for(var b,S=(n.resourceUrls,0),E=n.resourceUrls.length;E>S;++S){b=n.resourceUrls[S];b.format===s&&"tile"===b.resourceType&&w.push(b.template)}}else{var O=e.operationsMetadata.GetTile.dcp.http.get;w=[];for(var A,i=0,a=O.length;a>i;i++){A=O[i].constraints;(!A||A&&A.GetEncoding.allowedValues[c])&&w.push(O[i].url)}}return new OpenLayers.Layer.WMTS(OpenLayers.Util.applyDefaults(t,{url:w,requestEncoding:c,name:n.title,style:l.identifier,format:s,matrixIds:o.matrixIds,matrixSet:o.identifier,projection:v,units:C,resolutions:t.isBaseLayer===!1?void 0:L,serverResolutions:L,tileFullExtent:o.bounds,dimensions:d,params:f}))},CLASS_NAME:"OpenLayers.Format.WMTSCapabilities"});OpenLayers.Control.Button=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_BUTTON,trigger:function(){},CLASS_NAME:"OpenLayers.Control.Button"});OpenLayers.Control.Measure=OpenLayers.Class(OpenLayers.Control,{callbacks:null,displaySystem:"metric",geodesic:!1,displaySystemUnits:{geographic:["dd"],english:["mi","ft","in"],metric:["km","m"]},partialDelay:300,delayedTrigger:null,persist:!1,immediate:!1,initialize:function(e,t){OpenLayers.Control.prototype.initialize.apply(this,[t]);var n={done:this.measureComplete,point:this.measurePartial};this.immediate&&(n.modify=this.measureImmediate);this.callbacks=OpenLayers.Util.extend(n,this.callbacks);this.handlerOptions=OpenLayers.Util.extend({persist:this.persist},this.handlerOptions);this.handler=new e(this,this.callbacks,this.handlerOptions)},deactivate:function(){this.cancelDelay();return OpenLayers.Control.prototype.deactivate.apply(this,arguments)},cancel:function(){this.cancelDelay();this.handler.cancel()},setImmediate:function(e){this.immediate=e;this.immediate?this.callbacks.modify=this.measureImmediate:delete this.callbacks.modify},updateHandler:function(e,t){var n=this.active;n&&this.deactivate();this.handler=new e(this,this.callbacks,t);n&&this.activate()},measureComplete:function(e){this.cancelDelay();this.measure(e,"measure")},measurePartial:function(e,t){this.cancelDelay();t=t.clone();this.handler.freehandMode(this.handler.evt)?this.measure(t,"measurepartial"):this.delayedTrigger=window.setTimeout(OpenLayers.Function.bind(function(){this.delayedTrigger=null;this.measure(t,"measurepartial")},this),this.partialDelay)},measureImmediate:function(e,t,n){if(n&&!this.handler.freehandMode(this.handler.evt)){this.cancelDelay();this.measure(t.geometry,"measurepartial")}},cancelDelay:function(){if(null!==this.delayedTrigger){window.clearTimeout(this.delayedTrigger);this.delayedTrigger=null}},measure:function(e,t){var n,r;if(e.CLASS_NAME.indexOf("LineString")>-1){n=this.getBestLength(e);r=1}else{n=this.getBestArea(e);r=2}this.events.triggerEvent(t,{measure:n[0],units:n[1],order:r,geometry:e})},getBestArea:function(e){for(var t,n,r=this.displaySystemUnits[this.displaySystem],i=0,a=r.length;a>i;++i){t=r[i];n=this.getArea(e,t);if(n>1)break}return[n,t]},getArea:function(e,t){var n,r;if(this.geodesic){n=e.getGeodesicArea(this.map.getProjectionObject());r="m"}else{n=e.getArea();r=this.map.getUnits()}var i=OpenLayers.INCHES_PER_UNIT[t];if(i){var a=OpenLayers.INCHES_PER_UNIT[r];n*=Math.pow(a/i,2)}return n},getBestLength:function(e){for(var t,n,r=this.displaySystemUnits[this.displaySystem],i=0,a=r.length;a>i;++i){t=r[i];n=this.getLength(e,t);if(n>1)break}return[n,t]},getLength:function(e,t){var n,r;if(this.geodesic){n=e.getGeodesicLength(this.map.getProjectionObject());r="m"}else{n=e.getLength();r=this.map.getUnits()}var i=OpenLayers.INCHES_PER_UNIT[t];if(i){var a=OpenLayers.INCHES_PER_UNIT[r];n*=a/i}return n},CLASS_NAME:"OpenLayers.Control.Measure"});OpenLayers.Format.WMTSCapabilities.v1_0_0=OpenLayers.Class(OpenLayers.Format.OWSCommon.v1_1_0,{version:"1.0.0",namespaces:{ows:"http://www.opengis.net/ows/1.1",wmts:"http://www.opengis.net/wmts/1.0",xlink:"http://www.w3.org/1999/xlink"},yx:null,defaultPrefix:"wmts",initialize:function(e){OpenLayers.Format.XML.prototype.initialize.apply(this,[e]);this.options=e;var t=OpenLayers.Util.extend({},OpenLayers.Format.WMTSCapabilities.prototype.yx);this.yx=OpenLayers.Util.extend(t,this.yx)},read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));e&&9==e.nodeType&&(e=e.documentElement);var t={};this.readNode(e,t);t.version=this.version;return t},readers:{wmts:{Capabilities:function(e,t){this.readChildNodes(e,t)},Contents:function(e,t){t.contents={};t.contents.layers=[];t.contents.tileMatrixSets={};this.readChildNodes(e,t.contents)},Layer:function(e,t){var n={styles:[],formats:[],dimensions:[],tileMatrixSetLinks:[]};n.layers=[];this.readChildNodes(e,n);t.layers.push(n)},Style:function(e,t){var n={};n.isDefault="true"===e.getAttribute("isDefault");this.readChildNodes(e,n);t.styles.push(n)},Format:function(e,t){t.formats.push(this.getChildValue(e))},TileMatrixSetLink:function(e,t){var n={};this.readChildNodes(e,n);t.tileMatrixSetLinks.push(n)},TileMatrixSet:function(e,t){if(t.layers){var n={matrixIds:[]};this.readChildNodes(e,n);t.tileMatrixSets[n.identifier]=n}else t.tileMatrixSet=this.getChildValue(e)},TileMatrix:function(e,t){var n={supportedCRS:t.supportedCRS};this.readChildNodes(e,n);t.matrixIds.push(n)},ScaleDenominator:function(e,t){t.scaleDenominator=parseFloat(this.getChildValue(e))},TopLeftCorner:function(e,t){var n,r=this.getChildValue(e),i=r.split(" ");if(t.supportedCRS){var a=t.supportedCRS.replace(/urn:ogc:def:crs:(\w+):.+:(\w+)$/,"urn:ogc:def:crs:$1::$2");n=!!this.yx[a]}t.topLeftCorner=n?new OpenLayers.LonLat(i[1],i[0]):new OpenLayers.LonLat(i[0],i[1])},TileWidth:function(e,t){t.tileWidth=parseInt(this.getChildValue(e))},TileHeight:function(e,t){t.tileHeight=parseInt(this.getChildValue(e))},MatrixWidth:function(e,t){t.matrixWidth=parseInt(this.getChildValue(e))},MatrixHeight:function(e,t){t.matrixHeight=parseInt(this.getChildValue(e))},ResourceURL:function(e,t){t.resourceUrl=t.resourceUrl||{};var n=e.getAttribute("resourceType");t.resourceUrls||(t.resourceUrls=[]);var r=t.resourceUrl[n]={format:e.getAttribute("format"),template:e.getAttribute("template"),resourceType:n};t.resourceUrls.push(r)},WSDL:function(e,t){t.wsdl={};t.wsdl.href=e.getAttribute("xlink:href")},ServiceMetadataURL:function(e,t){t.serviceMetadataUrl={};t.serviceMetadataUrl.href=e.getAttribute("xlink:href")},LegendURL:function(e,t){t.legend={};t.legend.href=e.getAttribute("xlink:href");t.legend.format=e.getAttribute("format")},Dimension:function(e,t){var n={values:[]};this.readChildNodes(e,n);t.dimensions.push(n)},Default:function(e,t){t["default"]=this.getChildValue(e)},Value:function(e,t){t.values.push(this.getChildValue(e))}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.WMTSCapabilities.v1_0_0"});OpenLayers.Popup.FramedCloud=OpenLayers.Class(OpenLayers.Popup.Framed,{contentDisplayClass:"olFramedCloudPopupContent",autoSize:!0,panMapIfOutOfView:!0,imageSize:new OpenLayers.Size(1276,736),isAlphaImage:!1,fixedRelativePosition:!1,positionBlocks:{tl:{offset:new OpenLayers.Pixel(44,0),padding:new OpenLayers.Bounds(8,40,8,9),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,51,22,0),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,50,0,0),position:new OpenLayers.Pixel(-1238,0)},{size:new OpenLayers.Size("auto",19),anchor:new OpenLayers.Bounds(0,32,22,null),position:new OpenLayers.Pixel(0,-631)},{size:new OpenLayers.Size(22,18),anchor:new OpenLayers.Bounds(null,32,0,null),position:new OpenLayers.Pixel(-1238,-632)},{size:new OpenLayers.Size(81,35),anchor:new OpenLayers.Bounds(null,0,0,null),position:new OpenLayers.Pixel(0,-688)}]},tr:{offset:new OpenLayers.Pixel(-45,0),padding:new OpenLayers.Bounds(8,40,8,9),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,51,22,0),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,50,0,0),position:new OpenLayers.Pixel(-1238,0)},{size:new OpenLayers.Size("auto",19),anchor:new OpenLayers.Bounds(0,32,22,null),position:new OpenLayers.Pixel(0,-631)},{size:new OpenLayers.Size(22,19),anchor:new OpenLayers.Bounds(null,32,0,null),position:new OpenLayers.Pixel(-1238,-631)},{size:new OpenLayers.Size(81,35),anchor:new OpenLayers.Bounds(0,0,null,null),position:new OpenLayers.Pixel(-215,-687)}]},bl:{offset:new OpenLayers.Pixel(45,0),padding:new OpenLayers.Bounds(8,9,8,40),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,21,22,32),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,21,0,32),position:new OpenLayers.Pixel(-1238,0)},{size:new OpenLayers.Size("auto",21),anchor:new OpenLayers.Bounds(0,0,22,null),position:new OpenLayers.Pixel(0,-629)},{size:new OpenLayers.Size(22,21),anchor:new OpenLayers.Bounds(null,0,0,null),position:new OpenLayers.Pixel(-1238,-629)},{size:new OpenLayers.Size(81,33),anchor:new OpenLayers.Bounds(null,null,0,0),position:new OpenLayers.Pixel(-101,-674)}]},br:{offset:new OpenLayers.Pixel(-44,0),padding:new OpenLayers.Bounds(8,9,8,40),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,21,22,32),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,21,0,32),position:new OpenLayers.Pixel(-1238,0)},{size:new OpenLayers.Size("auto",21),anchor:new OpenLayers.Bounds(0,0,22,null),position:new OpenLayers.Pixel(0,-629)},{size:new OpenLayers.Size(22,21),anchor:new OpenLayers.Bounds(null,0,0,null),position:new OpenLayers.Pixel(-1238,-629)},{size:new OpenLayers.Size(81,33),anchor:new OpenLayers.Bounds(0,null,null,0),position:new OpenLayers.Pixel(-311,-674)}]}},minSize:new OpenLayers.Size(105,10),maxSize:new OpenLayers.Size(1200,660),initialize:function(e,t,n,r,i,a,s){this.imageSrc=OpenLayers.Util.getImageLocation("cloud-popup-relative.png");OpenLayers.Popup.Framed.prototype.initialize.apply(this,arguments);this.contentDiv.className=this.contentDisplayClass},CLASS_NAME:"OpenLayers.Popup.FramedCloud"});OpenLayers.Handler.Pinch=OpenLayers.Class(OpenLayers.Handler,{started:!1,stopDown:!1,pinching:!1,last:null,start:null,touchstart:function(e){var t=!0;this.pinching=!1;if(OpenLayers.Event.isMultiTouch(e)){this.started=!0;this.last=this.start={distance:this.getDistance(e.touches),delta:0,scale:1};this.callback("start",[e,this.start]);t=!this.stopDown}else{if(this.started)return!1;this.started=!1;this.start=null;this.last=null}OpenLayers.Event.preventDefault(e);return t},touchmove:function(e){if(this.started&&OpenLayers.Event.isMultiTouch(e)){this.pinching=!0;var t=this.getPinchData(e);this.callback("move",[e,t]);this.last=t;OpenLayers.Event.stop(e)}else if(this.started)return!1;return!0},touchend:function(e){if(this.started&&!OpenLayers.Event.isMultiTouch(e)){this.started=!1;this.pinching=!1;this.callback("done",[e,this.start,this.last]);this.start=null;this.last=null;return!1}return!0},activate:function(){var e=!1;if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){this.pinching=!1;e=!0}return e},deactivate:function(){var e=!1;if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){this.started=!1;this.pinching=!1;this.start=null;this.last=null;e=!0}return e},getDistance:function(e){var t=e[0],n=e[1];return Math.sqrt(Math.pow(t.olClientX-n.olClientX,2)+Math.pow(t.olClientY-n.olClientY,2))},getPinchData:function(e){var t=this.getDistance(e.touches),n=t/this.start.distance;return{distance:t,delta:this.last.distance-t,scale:n}},CLASS_NAME:"OpenLayers.Handler.Pinch"});OpenLayers.Handler.Hover=OpenLayers.Class(OpenLayers.Handler,{delay:500,pixelTolerance:null,stopMove:!1,px:null,timerId:null,mousemove:function(e){if(this.passesTolerance(e.xy)){this.clearTimer();this.callback("move",[e]);this.px=e.xy;e=OpenLayers.Util.extend({},e);this.timerId=window.setTimeout(OpenLayers.Function.bind(this.delayedCall,this,e),this.delay)}return!this.stopMove},mouseout:function(e){if(OpenLayers.Util.mouseLeft(e,this.map.viewPortDiv)){this.clearTimer();this.callback("move",[e])}return!0},passesTolerance:function(e){var t=!0;if(this.pixelTolerance&&this.px){var n=Math.sqrt(Math.pow(this.px.x-e.x,2)+Math.pow(this.px.y-e.y,2));n<this.pixelTolerance&&(t=!1)}return t},clearTimer:function(){if(null!=this.timerId){window.clearTimeout(this.timerId);this.timerId=null}},delayedCall:function(e){this.callback("pause",[e])},deactivate:function(){var e=!1;if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){this.clearTimer();e=!0}return e},CLASS_NAME:"OpenLayers.Handler.Hover"});OpenLayers.Control.NavigationHistory=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOGGLE,previous:null,previousOptions:null,next:null,nextOptions:null,limit:50,autoActivate:!0,clearOnDeactivate:!1,registry:null,nextStack:null,previousStack:null,listeners:null,restoring:!1,initialize:function(e){OpenLayers.Control.prototype.initialize.apply(this,[e]);this.registry=OpenLayers.Util.extend({moveend:this.getState},this.registry);var t={trigger:OpenLayers.Function.bind(this.previousTrigger,this),displayClass:this.displayClass+" "+this.displayClass+"Previous"};OpenLayers.Util.extend(t,this.previousOptions);this.previous=new OpenLayers.Control.Button(t);var n={trigger:OpenLayers.Function.bind(this.nextTrigger,this),displayClass:this.displayClass+" "+this.displayClass+"Next"};OpenLayers.Util.extend(n,this.nextOptions);this.next=new OpenLayers.Control.Button(n);this.clear()},onPreviousChange:function(e,t){e&&!this.previous.active?this.previous.activate():!e&&this.previous.active&&this.previous.deactivate()},onNextChange:function(e,t){e&&!this.next.active?this.next.activate():!e&&this.next.active&&this.next.deactivate()},destroy:function(){OpenLayers.Control.prototype.destroy.apply(this);this.previous.destroy();this.next.destroy();this.deactivate();for(var e in this)this[e]=null},setMap:function(e){this.map=e;this.next.setMap(e);this.previous.setMap(e)},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);this.next.draw();this.previous.draw()},previousTrigger:function(){var e=this.previousStack.shift(),t=this.previousStack.shift();if(void 0!=t){this.nextStack.unshift(e);this.previousStack.unshift(t);this.restoring=!0;this.restore(t);this.restoring=!1;this.onNextChange(this.nextStack[0],this.nextStack.length);this.onPreviousChange(this.previousStack[1],this.previousStack.length-1)}else this.previousStack.unshift(e);return t},nextTrigger:function(){var e=this.nextStack.shift();if(void 0!=e){this.previousStack.unshift(e);this.restoring=!0;this.restore(e);this.restoring=!1;this.onNextChange(this.nextStack[0],this.nextStack.length);this.onPreviousChange(this.previousStack[1],this.previousStack.length-1)}return e},clear:function(){this.previousStack=[];this.previous.deactivate();this.nextStack=[];this.next.deactivate()},getState:function(){return{center:this.map.getCenter(),resolution:this.map.getResolution(),projection:this.map.getProjectionObject(),units:this.map.getProjectionObject().getUnits()||this.map.units||this.map.baseLayer.units}},restore:function(e){var t,n;if(this.map.getProjectionObject()==e.projection){n=this.map.getZoomForResolution(e.resolution);t=e.center}else{t=e.center.clone();t.transform(e.projection,this.map.getProjectionObject());var r=e.units,i=this.map.getProjectionObject().getUnits()||this.map.units||this.map.baseLayer.units,a=r&&i?OpenLayers.INCHES_PER_UNIT[r]/OpenLayers.INCHES_PER_UNIT[i]:1;n=this.map.getZoomForResolution(a*e.resolution)}this.map.setCenter(t,n)},setListeners:function(){this.listeners={};for(var e in this.registry)this.listeners[e]=OpenLayers.Function.bind(function(){if(!this.restoring){var t=this.registry[e].apply(this,arguments);this.previousStack.unshift(t);this.previousStack.length>1&&this.onPreviousChange(this.previousStack[1],this.previousStack.length-1);this.previousStack.length>this.limit+1&&this.previousStack.pop();if(this.nextStack.length>0){this.nextStack=[];this.onNextChange(null,0)}}return!0},this)},activate:function(){var e=!1;if(this.map&&OpenLayers.Control.prototype.activate.apply(this)){null==this.listeners&&this.setListeners();for(var t in this.listeners)this.map.events.register(t,this,this.listeners[t]);e=!0;0==this.previousStack.length&&this.initStack()}return e},initStack:function(){this.map.getCenter()&&this.listeners.moveend()},deactivate:function(){var e=!1;if(this.map&&OpenLayers.Control.prototype.deactivate.apply(this)){for(var t in this.listeners)this.map.events.unregister(t,this,this.listeners[t]);this.clearOnDeactivate&&this.clear();e=!0}return e},CLASS_NAME:"OpenLayers.Control.NavigationHistory"});OpenLayers.Protocol.WFS.v1_0_0=OpenLayers.Class(OpenLayers.Protocol.WFS.v1,{version:"1.0.0",CLASS_NAME:"OpenLayers.Protocol.WFS.v1_0_0"});OpenLayers.Strategy.Cluster=OpenLayers.Class(OpenLayers.Strategy,{distance:20,threshold:null,features:null,clusters:null,clustering:!1,resolution:null,activate:function(){var e=OpenLayers.Strategy.prototype.activate.call(this);e&&this.layer.events.on({beforefeaturesadded:this.cacheFeatures,featuresremoved:this.clearCache,moveend:this.cluster,scope:this});return e},deactivate:function(){var e=OpenLayers.Strategy.prototype.deactivate.call(this);if(e){this.clearCache();this.layer.events.un({beforefeaturesadded:this.cacheFeatures,featuresremoved:this.clearCache,moveend:this.cluster,scope:this})}return e},cacheFeatures:function(e){var t=!0;if(!this.clustering){this.clearCache();this.features=e.features;this.cluster();t=!1}return t},clearCache:function(){this.clustering||(this.features=null)},cluster:function(e){if((!e||e.zoomChanged)&&this.features){var t=this.layer.map.getResolution();if(t!=this.resolution||!this.clustersExist()){this.resolution=t;for(var n,r,i,a=[],s=0;s<this.features.length;++s){n=this.features[s];if(n.geometry){r=!1;for(var o=a.length-1;o>=0;--o){i=a[o];if(this.shouldCluster(i,n)){this.addToCluster(i,n);r=!0;break}}r||a.push(this.createCluster(this.features[s]))}}this.clustering=!0;this.layer.removeAllFeatures();this.clustering=!1;if(a.length>0){if(this.threshold>1){var l=a.slice();a=[];for(var c,s=0,u=l.length;u>s;++s){c=l[s];c.attributes.count<this.threshold?Array.prototype.push.apply(a,c.cluster):a.push(c);

}}this.clustering=!0;this.layer.addFeatures(a);this.clustering=!1}this.clusters=a}}},clustersExist:function(){var e=!1;if(this.clusters&&this.clusters.length>0&&this.clusters.length==this.layer.features.length){e=!0;for(var t=0;t<this.clusters.length;++t)if(this.clusters[t]!=this.layer.features[t]){e=!1;break}}return e},shouldCluster:function(e,t){var n=e.geometry.getBounds().getCenterLonLat(),r=t.geometry.getBounds().getCenterLonLat(),i=Math.sqrt(Math.pow(n.lon-r.lon,2)+Math.pow(n.lat-r.lat,2))/this.resolution;return i<=this.distance},addToCluster:function(e,t){e.cluster.push(t);e.attributes.count+=1},createCluster:function(e){var t=e.geometry.getBounds().getCenterLonLat(),n=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(t.lon,t.lat),{count:1});n.cluster=[e];return n},CLASS_NAME:"OpenLayers.Strategy.Cluster"});OpenLayers.Control.OverviewMap=OpenLayers.Class(OpenLayers.Control,{element:null,ovmap:null,size:{w:180,h:90},layers:null,minRectSize:15,minRectDisplayClass:"RectReplacement",minRatio:8,maxRatio:32,mapOptions:null,autoPan:!1,handlers:null,resolutionFactor:1,maximized:!1,maximizeTitle:"",minimizeTitle:"",initialize:function(e){this.layers=[];this.handlers={};OpenLayers.Control.prototype.initialize.apply(this,[e])},destroy:function(){if(this.mapDiv){this.handlers.click&&this.handlers.click.destroy();this.handlers.drag&&this.handlers.drag.destroy();this.ovmap&&this.ovmap.viewPortDiv.removeChild(this.extentRectangle);this.extentRectangle=null;if(this.rectEvents){this.rectEvents.destroy();this.rectEvents=null}if(this.ovmap){this.ovmap.destroy();this.ovmap=null}this.element.removeChild(this.mapDiv);this.mapDiv=null;this.div.removeChild(this.element);this.element=null;if(this.maximizeDiv){this.div.removeChild(this.maximizeDiv);this.maximizeDiv=null}if(this.minimizeDiv){this.div.removeChild(this.minimizeDiv);this.minimizeDiv=null}this.map.events.un({buttonclick:this.onButtonClick,moveend:this.update,changebaselayer:this.baseLayerDraw,scope:this});OpenLayers.Control.prototype.destroy.apply(this,arguments)}},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);if(0===this.layers.length){if(!this.map.baseLayer){this.map.events.register("changebaselayer",this,this.baseLayerDraw);return this.div}var e=this.map.baseLayer.clone();this.layers=[e]}this.element=document.createElement("div");this.element.className=this.displayClass+"Element";this.element.style.display="none";this.mapDiv=document.createElement("div");this.mapDiv.style.width=this.size.w+"px";this.mapDiv.style.height=this.size.h+"px";this.mapDiv.style.position="relative";this.mapDiv.style.overflow="hidden";this.mapDiv.id=OpenLayers.Util.createUniqueID("overviewMap");this.extentRectangle=document.createElement("div");this.extentRectangle.style.position="absolute";this.extentRectangle.style.zIndex=1e3;this.extentRectangle.className=this.displayClass+"ExtentRectangle";this.element.appendChild(this.mapDiv);this.div.appendChild(this.element);if(this.outsideViewport)this.element.style.display="";else{this.div.className+=" "+this.displayClass+"Container";var t=OpenLayers.Util.getImageLocation("layer-switcher-maximize.png");this.maximizeDiv=OpenLayers.Util.createAlphaImageDiv(this.displayClass+"MaximizeButton",null,null,t,"absolute");this.maximizeDiv.style.display="none";this.maximizeDiv.className=this.displayClass+"MaximizeButton olButton";this.maximizeTitle&&(this.maximizeDiv.title=this.maximizeTitle);this.div.appendChild(this.maximizeDiv);var t=OpenLayers.Util.getImageLocation("layer-switcher-minimize.png");this.minimizeDiv=OpenLayers.Util.createAlphaImageDiv("OpenLayers_Control_minimizeDiv",null,null,t,"absolute");this.minimizeDiv.style.display="none";this.minimizeDiv.className=this.displayClass+"MinimizeButton olButton";this.minimizeTitle&&(this.minimizeDiv.title=this.minimizeTitle);this.div.appendChild(this.minimizeDiv);this.minimizeControl()}this.map.getExtent()&&this.update();this.map.events.on({buttonclick:this.onButtonClick,moveend:this.update,scope:this});this.maximized&&this.maximizeControl();return this.div},baseLayerDraw:function(){this.draw();this.map.events.unregister("changebaselayer",this,this.baseLayerDraw)},rectDrag:function(e){var t=this.handlers.drag.last.x-e.x,n=this.handlers.drag.last.y-e.y;if(0!=t||0!=n){var r=this.rectPxBounds.top,i=this.rectPxBounds.left,a=Math.abs(this.rectPxBounds.getHeight()),s=this.rectPxBounds.getWidth(),o=Math.max(0,r-n);o=Math.min(o,this.ovmap.size.h-this.hComp-a);var l=Math.max(0,i-t);l=Math.min(l,this.ovmap.size.w-this.wComp-s);this.setRectPxBounds(new OpenLayers.Bounds(l,o+a,l+s,o))}},mapDivClick:function(e){var t=this.rectPxBounds.getCenterPixel(),n=e.xy.x-t.x,r=e.xy.y-t.y,i=this.rectPxBounds.top,a=this.rectPxBounds.left,s=Math.abs(this.rectPxBounds.getHeight()),o=this.rectPxBounds.getWidth(),l=Math.max(0,i+r);l=Math.min(l,this.ovmap.size.h-s);var c=Math.max(0,a+n);c=Math.min(c,this.ovmap.size.w-o);this.setRectPxBounds(new OpenLayers.Bounds(c,l+s,c+o,l));this.updateMapToRect()},onButtonClick:function(e){e.buttonElement===this.minimizeDiv?this.minimizeControl():e.buttonElement===this.maximizeDiv&&this.maximizeControl()},maximizeControl:function(e){this.element.style.display="";this.showToggle(!1);null!=e&&OpenLayers.Event.stop(e)},minimizeControl:function(e){this.element.style.display="none";this.showToggle(!0);null!=e&&OpenLayers.Event.stop(e)},showToggle:function(e){this.maximizeDiv&&(this.maximizeDiv.style.display=e?"":"none");this.minimizeDiv&&(this.minimizeDiv.style.display=e?"none":"")},update:function(){null==this.ovmap&&this.createMap();(this.autoPan||!this.isSuitableOverview())&&this.updateOverview();this.updateRectToMap()},isSuitableOverview:function(){var e=this.map.getExtent(),t=this.map.getMaxExtent(),n=new OpenLayers.Bounds(Math.max(e.left,t.left),Math.max(e.bottom,t.bottom),Math.min(e.right,t.right),Math.min(e.top,t.top));this.ovmap.getProjection()!=this.map.getProjection()&&(n=n.transform(this.map.getProjectionObject(),this.ovmap.getProjectionObject()));var r=this.ovmap.getResolution()/this.map.getResolution();return r>this.minRatio&&r<=this.maxRatio&&this.ovmap.getExtent().containsBounds(n)},updateOverview:function(){var e=this.map.getResolution(),t=this.ovmap.getResolution(),n=t/e;n>this.maxRatio?t=this.minRatio*e:n<=this.minRatio&&(t=this.maxRatio*e);var r;if(this.ovmap.getProjection()!=this.map.getProjection()){r=this.map.center.clone();r.transform(this.map.getProjectionObject(),this.ovmap.getProjectionObject())}else r=this.map.center;this.ovmap.setCenter(r,this.ovmap.getZoomForResolution(t*this.resolutionFactor));this.updateRectToMap()},createMap:function(){var e=OpenLayers.Util.extend({controls:[],maxResolution:"auto",fallThrough:!1},this.mapOptions);this.ovmap=new OpenLayers.Map(this.mapDiv,e);this.ovmap.viewPortDiv.appendChild(this.extentRectangle);OpenLayers.Event.stopObserving(window,"unload",this.ovmap.unloadDestroy);this.ovmap.addLayers(this.layers);this.ovmap.zoomToMaxExtent();this.wComp=parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-left-width"))+parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-right-width"));this.wComp=this.wComp?this.wComp:2;this.hComp=parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-top-width"))+parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-bottom-width"));this.hComp=this.hComp?this.hComp:2;this.handlers.drag=new OpenLayers.Handler.Drag(this,{move:this.rectDrag,done:this.updateMapToRect},{map:this.ovmap});this.handlers.click=new OpenLayers.Handler.Click(this,{click:this.mapDivClick},{single:!0,"double":!1,stopSingle:!0,stopDouble:!0,pixelTolerance:1,map:this.ovmap});this.handlers.click.activate();this.rectEvents=new OpenLayers.Events(this,this.extentRectangle,null,!0);this.rectEvents.register("mouseover",this,function(e){this.handlers.drag.active||this.map.dragging||this.handlers.drag.activate()});this.rectEvents.register("mouseout",this,function(e){this.handlers.drag.dragging||this.handlers.drag.deactivate()});if(this.ovmap.getProjection()!=this.map.getProjection()){var t=this.map.getProjectionObject().getUnits()||this.map.units||this.map.baseLayer.units,n=this.ovmap.getProjectionObject().getUnits()||this.ovmap.units||this.ovmap.baseLayer.units;this.resolutionFactor=t&&n?OpenLayers.INCHES_PER_UNIT[t]/OpenLayers.INCHES_PER_UNIT[n]:1}},updateRectToMap:function(){var e;e=this.ovmap.getProjection()!=this.map.getProjection()?this.map.getExtent().transform(this.map.getProjectionObject(),this.ovmap.getProjectionObject()):this.map.getExtent();var t=this.getRectBoundsFromMapBounds(e);t&&this.setRectPxBounds(t)},updateMapToRect:function(){var e=this.getMapBoundsFromRectBounds(this.rectPxBounds);this.ovmap.getProjection()!=this.map.getProjection()&&(e=e.transform(this.ovmap.getProjectionObject(),this.map.getProjectionObject()));this.map.panTo(e.getCenterLonLat())},setRectPxBounds:function(e){var t=Math.max(e.top,0),n=Math.max(e.left,0),r=Math.min(e.top+Math.abs(e.getHeight()),this.ovmap.size.h-this.hComp),i=Math.min(e.left+e.getWidth(),this.ovmap.size.w-this.wComp),a=Math.max(i-n,0),s=Math.max(r-t,0);if(a<this.minRectSize||s<this.minRectSize){this.extentRectangle.className=this.displayClass+this.minRectDisplayClass;var o=n+a/2-this.minRectSize/2,l=t+s/2-this.minRectSize/2;this.extentRectangle.style.top=Math.round(l)+"px";this.extentRectangle.style.left=Math.round(o)+"px";this.extentRectangle.style.height=this.minRectSize+"px";this.extentRectangle.style.width=this.minRectSize+"px"}else{this.extentRectangle.className=this.displayClass+"ExtentRectangle";this.extentRectangle.style.top=Math.round(t)+"px";this.extentRectangle.style.left=Math.round(n)+"px";this.extentRectangle.style.height=Math.round(s)+"px";this.extentRectangle.style.width=Math.round(a)+"px"}this.rectPxBounds=new OpenLayers.Bounds(Math.round(n),Math.round(r),Math.round(i),Math.round(t))},getRectBoundsFromMapBounds:function(e){var t=this.getOverviewPxFromLonLat({lon:e.left,lat:e.bottom}),n=this.getOverviewPxFromLonLat({lon:e.right,lat:e.top}),r=null;t&&n&&(r=new OpenLayers.Bounds(t.x,t.y,n.x,n.y));return r},getMapBoundsFromRectBounds:function(e){var t=this.getLonLatFromOverviewPx({x:e.left,y:e.bottom}),n=this.getLonLatFromOverviewPx({x:e.right,y:e.top});return new OpenLayers.Bounds(t.lon,t.lat,n.lon,n.lat)},getLonLatFromOverviewPx:function(e){var t=this.ovmap.size,n=this.ovmap.getResolution(),r=this.ovmap.getExtent().getCenterLonLat(),i=e.x-t.w/2,a=e.y-t.h/2;return{lon:r.lon+i*n,lat:r.lat-a*n}},getOverviewPxFromLonLat:function(e){var t=this.ovmap.getResolution(),n=this.ovmap.getExtent();return n?{x:Math.round(1/t*(e.lon-n.left)),y:Math.round(1/t*(n.top-e.lat))}:void 0},CLASS_NAME:"OpenLayers.Control.OverviewMap"});OpenLayers.Renderer.VML=OpenLayers.Class(OpenLayers.Renderer.Elements,{xmlns:"urn:schemas-microsoft-com:vml",symbolCache:{},offset:null,initialize:function(e){if(this.supported()){if(!document.namespaces.olv){document.namespaces.add("olv",this.xmlns);for(var t=document.createStyleSheet(),n=["shape","rect","oval","fill","stroke","imagedata","group","textbox"],r=0,i=n.length;i>r;r++)t.addRule("olv\\:"+n[r],"behavior: url(#default#VML); position: absolute; display: inline-block;")}OpenLayers.Renderer.Elements.prototype.initialize.apply(this,arguments)}},supported:function(){return!!document.namespaces},setExtent:function(e,t){var n=OpenLayers.Renderer.Elements.prototype.setExtent.apply(this,arguments),r=this.getResolution(),i=e.left/r|0,a=e.top/r-this.size.h|0;if(t||!this.offset){this.offset={x:i,y:a};i=0;a=0}else{i-=this.offset.x;a-=this.offset.y}var s=i-this.xOffset+" "+a;this.root.coordorigin=s;for(var o,l=[this.root,this.vectorRoot,this.textRoot],c=0,u=l.length;u>c;++c){o=l[c];var h=this.size.w+" "+this.size.h;o.coordsize=h}this.root.style.flip="y";return n},setSize:function(e){OpenLayers.Renderer.prototype.setSize.apply(this,arguments);for(var t,n=[this.rendererRoot,this.root,this.vectorRoot,this.textRoot],r=this.size.w+"px",i=this.size.h+"px",a=0,s=n.length;s>a;++a){t=n[a];t.style.width=r;t.style.height=i}},getNodeType:function(e,t){var n=null;switch(e.CLASS_NAME){case"OpenLayers.Geometry.Point":n=t.externalGraphic?"olv:rect":this.isComplexSymbol(t.graphicName)?"olv:shape":"olv:oval";break;case"OpenLayers.Geometry.Rectangle":n="olv:rect";break;case"OpenLayers.Geometry.LineString":case"OpenLayers.Geometry.LinearRing":case"OpenLayers.Geometry.Polygon":case"OpenLayers.Geometry.Curve":n="olv:shape"}return n},setStyle:function(e,t,n,r){t=t||e._style;n=n||e._options;var i=t.fillColor,a=t.title||t.graphicTitle;a&&(e.title=a);if("OpenLayers.Geometry.Point"===e._geometryClass)if(t.externalGraphic){n.isFilled=!0;var s=t.graphicWidth||t.graphicHeight,o=t.graphicHeight||t.graphicWidth;s=s?s:2*t.pointRadius;o=o?o:2*t.pointRadius;var l=this.getResolution(),c=void 0!=t.graphicXOffset?t.graphicXOffset:-(.5*s),u=void 0!=t.graphicYOffset?t.graphicYOffset:-(.5*o);e.style.left=((r.x-this.featureDx)/l-this.offset.x+c|0)+"px";e.style.top=(r.y/l-this.offset.y-(u+o)|0)+"px";e.style.width=s+"px";e.style.height=o+"px";e.style.flip="y";i="none";n.isStroked=!1}else if(this.isComplexSymbol(t.graphicName)){var h=this.importSymbol(t.graphicName);e.path=h.path;e.coordorigin=h.left+","+h.bottom;var p=h.size;e.coordsize=p+","+p;this.drawCircle(e,r,t.pointRadius);e.style.flip="y"}else this.drawCircle(e,r,t.pointRadius);n.isFilled?e.fillcolor=i:e.filled="false";var d=e.getElementsByTagName("fill"),f=0==d.length?null:d[0];if(n.isFilled){f||(f=this.createNode("olv:fill",e.id+"_fill"));f.opacity=t.fillOpacity;if("OpenLayers.Geometry.Point"===e._geometryClass&&t.externalGraphic){t.graphicOpacity&&(f.opacity=t.graphicOpacity);f.src=t.externalGraphic;f.type="frame";t.graphicWidth&&t.graphicHeight||(f.aspect="atmost")}f.parentNode!=e&&e.appendChild(f)}else f&&e.removeChild(f);var m=t.rotation;if(void 0!==m||void 0!==e._rotation){e._rotation=m;if(t.externalGraphic){this.graphicRotate(e,c,u,t);f.opacity=0}else"OpenLayers.Geometry.Point"===e._geometryClass&&(e.style.rotation=m||0)}var y=e.getElementsByTagName("stroke"),g=0==y.length?null:y[0];if(n.isStroked){if(!g){g=this.createNode("olv:stroke",e.id+"_stroke");e.appendChild(g)}g.on=!0;g.color=t.strokeColor;g.weight=t.strokeWidth+"px";g.opacity=t.strokeOpacity;g.endcap="butt"==t.strokeLinecap?"flat":t.strokeLinecap||"round";t.strokeDashstyle&&(g.dashstyle=this.dashStyle(t))}else{e.stroked=!1;g&&(g.on=!1)}"inherit"!=t.cursor&&null!=t.cursor&&(e.style.cursor=t.cursor);return e},graphicRotate:function(e,t,n,r){var i,a,r=r||e._style,s=r.rotation||0;if(r.graphicWidth&&r.graphicHeight){a=Math.max(r.graphicWidth,r.graphicHeight);i=r.graphicWidth/r.graphicHeight;var o=Math.round(r.graphicWidth||a*i),l=Math.round(r.graphicHeight||a);e.style.width=o+"px";e.style.height=l+"px";var c=document.getElementById(e.id+"_image");if(!c){c=this.createNode("olv:imagedata",e.id+"_image");e.appendChild(c)}c.style.width=o+"px";c.style.height=l+"px";c.src=r.externalGraphic;c.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='', sizingMethod='scale')";var u=s*Math.PI/180,h=Math.sin(u),p=Math.cos(u),d="progid:DXImageTransform.Microsoft.Matrix(M11="+p+",M12="+-h+",M21="+h+",M22="+p+",SizingMethod='auto expand')\n",f=r.graphicOpacity||r.fillOpacity;f&&1!=f&&(d+="progid:DXImageTransform.Microsoft.BasicImage(opacity="+f+")\n");e.style.filter=d;var m=new OpenLayers.Geometry.Point(-t,-n),y=new OpenLayers.Bounds(0,0,o,l).toGeometry();y.rotate(r.rotation,m);var g=y.getBounds();e.style.left=Math.round(parseInt(e.style.left)+g.left)+"px";e.style.top=Math.round(parseInt(e.style.top)-g.bottom)+"px"}else{var v=new Image;v.onreadystatechange=OpenLayers.Function.bind(function(){if("complete"==v.readyState||"interactive"==v.readyState){i=v.width/v.height;a=Math.max(2*r.pointRadius,r.graphicWidth||0,r.graphicHeight||0);t*=i;r.graphicWidth=a*i;r.graphicHeight=a;this.graphicRotate(e,t,n,r)}},this);v.src=r.externalGraphic}},postDraw:function(e){e.style.visibility="visible";var t=e._style.fillColor,n=e._style.strokeColor;"none"==t&&e.fillcolor!=t&&(e.fillcolor=t);"none"==n&&e.strokecolor!=n&&(e.strokecolor=n)},setNodeDimension:function(e,t){var n=t.getBounds();if(n){var r=this.getResolution(),i=new OpenLayers.Bounds((n.left-this.featureDx)/r-this.offset.x|0,n.bottom/r-this.offset.y|0,(n.right-this.featureDx)/r-this.offset.x|0,n.top/r-this.offset.y|0);e.style.left=i.left+"px";e.style.top=i.top+"px";e.style.width=i.getWidth()+"px";e.style.height=i.getHeight()+"px";e.coordorigin=i.left+" "+i.top;e.coordsize=i.getWidth()+" "+i.getHeight()}},dashStyle:function(e){var t=e.strokeDashstyle;switch(t){case"solid":case"dot":case"dash":case"dashdot":case"longdash":case"longdashdot":return t;default:var n=t.split(/[ ,]/);return 2==n.length?1*n[0]>=2*n[1]?"longdash":1==n[0]||1==n[1]?"dot":"dash":4==n.length?1*n[0]>=2*n[1]?"longdashdot":"dashdot":"solid"}},createNode:function(e,t){var n=document.createElement(e);t&&(n.id=t);n.unselectable="on";n.onselectstart=OpenLayers.Function.False;return n},nodeTypeCompare:function(e,t){var n=t,r=n.indexOf(":");-1!=r&&(n=n.substr(r+1));var i=e.nodeName;r=i.indexOf(":");-1!=r&&(i=i.substr(r+1));return n==i},createRenderRoot:function(){return this.nodeFactory(this.container.id+"_vmlRoot","div")},createRoot:function(e){return this.nodeFactory(this.container.id+e,"olv:group")},drawPoint:function(e,t){return this.drawCircle(e,t,1)},drawCircle:function(e,t,n){if(!isNaN(t.x)&&!isNaN(t.y)){var r=this.getResolution();e.style.left=((t.x-this.featureDx)/r-this.offset.x|0)-n+"px";e.style.top=(t.y/r-this.offset.y|0)-n+"px";var i=2*n;e.style.width=i+"px";e.style.height=i+"px";return e}return!1},drawLineString:function(e,t){return this.drawLine(e,t,!1)},drawLinearRing:function(e,t){return this.drawLine(e,t,!0)},drawLine:function(e,t,n){this.setNodeDimension(e,t);for(var r,i,a,s=this.getResolution(),o=t.components.length,l=new Array(o),c=0;o>c;c++){r=t.components[c];i=(r.x-this.featureDx)/s-this.offset.x|0;a=r.y/s-this.offset.y|0;l[c]=" "+i+","+a+" l "}var u=n?" x e":" e";e.path="m"+l.join("")+u;return e},drawPolygon:function(e,t){this.setNodeDimension(e,t);var n,r,i,a,s,o,l,c,u,h,p,d,f=this.getResolution(),m=[];for(n=0,r=t.components.length;r>n;n++){m.push("m");i=t.components[n].components;a=0===n;s=null;o=null;for(l=0,c=i.length;c>l;l++){u=i[l];p=(u.x-this.featureDx)/f-this.offset.x|0;d=u.y/f-this.offset.y|0;h=" "+p+","+d;m.push(h);0==l&&m.push(" l");a||(s?s!=h&&(o?o!=h&&(a=!0):o=h):s=h)}m.push(a?" x ":" ")}m.push("e");e.path=m.join("");return e},drawRectangle:function(e,t){var n=this.getResolution();e.style.left=((t.x-this.featureDx)/n-this.offset.x|0)+"px";e.style.top=(t.y/n-this.offset.y|0)+"px";e.style.width=(t.width/n|0)+"px";e.style.height=(t.height/n|0)+"px";return e},drawText:function(e,t,n){var r=this.nodeFactory(e+this.LABEL_ID_SUFFIX,"olv:rect"),i=this.nodeFactory(e+this.LABEL_ID_SUFFIX+"_textbox","olv:textbox"),a=this.getResolution();r.style.left=((n.x-this.featureDx)/a-this.offset.x|0)+"px";r.style.top=(n.y/a-this.offset.y|0)+"px";r.style.flip="y";i.innerText=t.label;"inherit"!=t.cursor&&null!=t.cursor&&(i.style.cursor=t.cursor);t.fontColor&&(i.style.color=t.fontColor);t.fontOpacity&&(i.style.filter="alpha(opacity="+100*t.fontOpacity+")");t.fontFamily&&(i.style.fontFamily=t.fontFamily);t.fontSize&&(i.style.fontSize=t.fontSize);t.fontWeight&&(i.style.fontWeight=t.fontWeight);t.fontStyle&&(i.style.fontStyle=t.fontStyle);if(t.labelSelect===!0){r._featureId=e;i._featureId=e;i._geometry=n;i._geometryClass=n.CLASS_NAME}i.style.whiteSpace="nowrap";i.inset="1px,0px,0px,0px";if(!r.parentNode){r.appendChild(i);this.textRoot.appendChild(r)}var s=t.labelAlign||"cm";1==s.length&&(s+="m");var o=i.clientWidth*OpenLayers.Renderer.VML.LABEL_SHIFT[s.substr(0,1)],l=i.clientHeight*OpenLayers.Renderer.VML.LABEL_SHIFT[s.substr(1,1)];r.style.left=parseInt(r.style.left)-o-1+"px";r.style.top=parseInt(r.style.top)+l+"px"},moveRoot:function(e){var t=this.map.getLayer(e.container.id);t instanceof OpenLayers.Layer.Vector.RootContainer&&(t=this.map.getLayer(this.container.id));t&&t.renderer.clear();OpenLayers.Renderer.Elements.prototype.moveRoot.apply(this,arguments);t&&t.redraw()},importSymbol:function(e){var t=this.container.id+"-"+e,n=this.symbolCache[t];if(n)return n;var r=OpenLayers.Renderer.symbol[e];if(!r)throw new Error(e+" is not a valid symbol name");for(var i=new OpenLayers.Bounds(Number.MAX_VALUE,Number.MAX_VALUE,0,0),a=["m"],s=0;s<r.length;s+=2){var o=r[s],l=r[s+1];i.left=Math.min(i.left,o);i.bottom=Math.min(i.bottom,l);i.right=Math.max(i.right,o);i.top=Math.max(i.top,l);a.push(o);a.push(l);0==s&&a.push("l")}a.push("x e");var c=a.join(" "),u=(i.getWidth()-i.getHeight())/2;if(u>0){i.bottom=i.bottom-u;i.top=i.top+u}else{i.left=i.left+u;i.right=i.right-u}n={path:c,size:i.getWidth(),left:i.left,bottom:i.bottom};this.symbolCache[t]=n;return n},CLASS_NAME:"OpenLayers.Renderer.VML"});OpenLayers.Renderer.VML.LABEL_SHIFT={l:0,c:.5,r:1,t:0,m:.5,b:1};OpenLayers.Protocol.HTTP=OpenLayers.Class(OpenLayers.Protocol,{url:null,headers:null,params:null,callback:null,scope:null,readWithPOST:!1,updateWithPOST:!1,deleteWithPOST:!1,wildcarded:!1,srsInBBOX:!1,initialize:function(e){e=e||{};this.params={};this.headers={};OpenLayers.Protocol.prototype.initialize.apply(this,arguments);if(!this.filterToParams&&OpenLayers.Format.QueryStringFilter){var t=new OpenLayers.Format.QueryStringFilter({wildcarded:this.wildcarded,srsInBBOX:this.srsInBBOX});this.filterToParams=function(e,n){return t.write(e,n)}}},destroy:function(){this.params=null;this.headers=null;OpenLayers.Protocol.prototype.destroy.apply(this)},read:function(e){OpenLayers.Protocol.prototype.read.apply(this,arguments);e=e||{};e.params=OpenLayers.Util.applyDefaults(e.params,this.options.params);e=OpenLayers.Util.applyDefaults(e,this.options);e.filter&&this.filterToParams&&(e.params=this.filterToParams(e.filter,e.params));var t=void 0!==e.readWithPOST?e.readWithPOST:this.readWithPOST,n=new OpenLayers.Protocol.Response({requestType:"read"});if(t){var r=e.headers||{};r["Content-Type"]="application/x-www-form-urlencoded";n.priv=OpenLayers.Request.POST({url:e.url,callback:this.createCallback(this.handleRead,n,e),data:OpenLayers.Util.getParameterString(e.params),headers:r})}else n.priv=OpenLayers.Request.GET({url:e.url,callback:this.createCallback(this.handleRead,n,e),params:e.params,headers:e.headers});return n},handleRead:function(e,t){this.handleResponse(e,t)},create:function(e,t){t=OpenLayers.Util.applyDefaults(t,this.options);var n=new OpenLayers.Protocol.Response({reqFeatures:e,requestType:"create"});n.priv=OpenLayers.Request.POST({url:t.url,callback:this.createCallback(this.handleCreate,n,t),headers:t.headers,data:this.format.write(e)});return n},handleCreate:function(e,t){this.handleResponse(e,t)},update:function(e,t){t=t||{};var n=t.url||e.url||this.options.url+"/"+e.fid;t=OpenLayers.Util.applyDefaults(t,this.options);var r=new OpenLayers.Protocol.Response({reqFeatures:e,requestType:"update"}),i=this.updateWithPOST?"POST":"PUT";r.priv=OpenLayers.Request[i]({url:n,callback:this.createCallback(this.handleUpdate,r,t),headers:t.headers,data:this.format.write(e)});return r},handleUpdate:function(e,t){this.handleResponse(e,t)},"delete":function(e,t){t=t||{};var n=t.url||e.url||this.options.url+"/"+e.fid;t=OpenLayers.Util.applyDefaults(t,this.options);var r=new OpenLayers.Protocol.Response({reqFeatures:e,requestType:"delete"}),i=this.deleteWithPOST?"POST":"DELETE",a={url:n,callback:this.createCallback(this.handleDelete,r,t),headers:t.headers};this.deleteWithPOST&&(a.data=this.format.write(e));r.priv=OpenLayers.Request[i](a);return r},handleDelete:function(e,t){this.handleResponse(e,t)},handleResponse:function(e,t){var n=e.priv;if(t.callback){if(n.status>=200&&n.status<300){"delete"!=e.requestType&&(e.features=this.parseFeatures(n));e.code=OpenLayers.Protocol.Response.SUCCESS}else e.code=OpenLayers.Protocol.Response.FAILURE;t.callback.call(t.scope,e)}},parseFeatures:function(e){var t=e.responseXML;t&&t.documentElement||(t=e.responseText);return!t||t.length<=0?null:this.format.read(t)},commit:function(e,t){function n(e){for(var t=e.features?e.features.length:0,n=new Array(t),i=0;t>i;++i)n[i]=e.features[i].fid;f.insertIds=n;r.apply(this,[e])}function r(e){this.callUserCallback(e,t);d=d&&e.success();a++;if(a>=p&&t.callback){f.code=d?OpenLayers.Protocol.Response.SUCCESS:OpenLayers.Protocol.Response.FAILURE;t.callback.apply(t.scope,[f])}}t=OpenLayers.Util.applyDefaults(t,this.options);var i=[],a=0,s={};s[OpenLayers.State.INSERT]=[];s[OpenLayers.State.UPDATE]=[];s[OpenLayers.State.DELETE]=[];for(var o,l,c=[],u=0,h=e.length;h>u;++u){o=e[u];l=s[o.state];if(l){l.push(o);c.push(o)}}var p=(s[OpenLayers.State.INSERT].length>0?1:0)+s[OpenLayers.State.UPDATE].length+s[OpenLayers.State.DELETE].length,d=!0,f=new OpenLayers.Protocol.Response({reqFeatures:c}),m=s[OpenLayers.State.INSERT];m.length>0&&i.push(this.create(m,OpenLayers.Util.applyDefaults({callback:n,scope:this},t.create)));m=s[OpenLayers.State.UPDATE];for(var u=m.length-1;u>=0;--u)i.push(this.update(m[u],OpenLayers.Util.applyDefaults({callback:r,scope:this},t.update)));m=s[OpenLayers.State.DELETE];for(var u=m.length-1;u>=0;--u)i.push(this["delete"](m[u],OpenLayers.Util.applyDefaults({callback:r,scope:this},t["delete"])));return i},abort:function(e){e&&e.priv.abort()},callUserCallback:function(e,t){var n=t[e.requestType];n&&n.callback&&n.callback.call(n.scope,e)},CLASS_NAME:"OpenLayers.Protocol.HTTP"});OpenLayers.Handler.Feature=OpenLayers.Class(OpenLayers.Handler,{EVENTMAP:{click:{"in":"click",out:"clickout"},mousemove:{"in":"over",out:"out"},dblclick:{"in":"dblclick",out:null},mousedown:{"in":null,out:null},mouseup:{"in":null,out:null},touchstart:{"in":"click",out:"clickout"}},feature:null,lastFeature:null,down:null,up:null,clickTolerance:4,geometryTypes:null,stopClick:!0,stopDown:!0,stopUp:!1,initialize:function(e,t,n,r){OpenLayers.Handler.prototype.initialize.apply(this,[e,n,r]);this.layer=t},touchstart:function(e){this.startTouch();return OpenLayers.Event.isMultiTouch(e)?!0:this.mousedown(e)},touchmove:function(e){OpenLayers.Event.preventDefault(e)},mousedown:function(e){(OpenLayers.Event.isLeftClick(e)||OpenLayers.Event.isSingleTouch(e))&&(this.down=e.xy);return this.handle(e)?!this.stopDown:!0},mouseup:function(e){this.up=e.xy;return this.handle(e)?!this.stopUp:!0},click:function(e){return this.handle(e)?!this.stopClick:!0},mousemove:function(e){if(!this.callbacks.over&&!this.callbacks.out)return!0;this.handle(e);return!0},dblclick:function(e){return!this.handle(e)},geometryTypeMatches:function(e){return null==this.geometryTypes||OpenLayers.Util.indexOf(this.geometryTypes,e.geometry.CLASS_NAME)>-1},handle:function(e){this.feature&&!this.feature.layer&&(this.feature=null);var t=e.type,n=!1,r=!!this.feature,i="click"==t||"dblclick"==t||"touchstart"==t;this.feature=this.layer.getFeatureFromEvent(e);this.feature&&!this.feature.layer&&(this.feature=null);this.lastFeature&&!this.lastFeature.layer&&(this.lastFeature=null);if(this.feature){"touchstart"===t&&OpenLayers.Event.preventDefault(e);var a=this.feature!=this.lastFeature;if(this.geometryTypeMatches(this.feature)){if(r&&a){this.lastFeature&&this.triggerCallback(t,"out",[this.lastFeature]);this.triggerCallback(t,"in",[this.feature])}else(!r||i)&&this.triggerCallback(t,"in",[this.feature]);this.lastFeature=this.feature;n=!0}else{this.lastFeature&&(r&&a||i)&&this.triggerCallback(t,"out",[this.lastFeature]);this.feature=null}}else this.lastFeature&&(r||i)&&this.triggerCallback(t,"out",[this.lastFeature]);return n},triggerCallback:function(e,t,n){var r=this.EVENTMAP[e][t];if(r)if("click"==e&&this.up&&this.down){var i=Math.sqrt(Math.pow(this.up.x-this.down.x,2)+Math.pow(this.up.y-this.down.y,2));i<=this.clickTolerance&&this.callback(r,n);this.up=this.down=null}else this.callback(r,n)},activate:function(){var e=!1;if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){this.moveLayerToTop();this.map.events.on({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this});e=!0}return e},deactivate:function(){var e=!1;if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){this.moveLayerBack();this.feature=null;this.lastFeature=null;this.down=null;this.up=null;this.map.events.un({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this});e=!0}return e},handleMapEvents:function(e){("removelayer"==e.type||"order"==e.property)&&this.moveLayerToTop()},moveLayerToTop:function(){var e=Math.max(this.map.Z_INDEX_BASE.Feature-1,this.layer.getZIndex())+1;this.layer.setZIndex(e)},moveLayerBack:function(){var e=this.layer.getZIndex()-1;e>=this.map.Z_INDEX_BASE.Feature?this.layer.setZIndex(e):this.map.setLayerZIndex(this.layer,this.map.getLayerIndex(this.layer))},CLASS_NAME:"OpenLayers.Handler.Feature"});OpenLayers.Control.DragFeature=OpenLayers.Class(OpenLayers.Control,{geometryTypes:null,onStart:function(e,t){},onDrag:function(e,t){},onComplete:function(e,t){},onEnter:function(e){},onLeave:function(e){},documentDrag:!1,layer:null,feature:null,dragCallbacks:{},featureCallbacks:{},lastPixel:null,initialize:function(e,t){OpenLayers.Control.prototype.initialize.apply(this,[t]);this.layer=e;this.handlers={drag:new OpenLayers.Handler.Drag(this,OpenLayers.Util.extend({down:this.downFeature,move:this.moveFeature,up:this.upFeature,out:this.cancel,done:this.doneDragging},this.dragCallbacks),{documentDrag:this.documentDrag}),feature:new OpenLayers.Handler.Feature(this,this.layer,OpenLayers.Util.extend({click:this.clickFeature,clickout:this.clickoutFeature,over:this.overFeature,out:this.outFeature},this.featureCallbacks),{geometryTypes:this.geometryTypes})}},clickFeature:function(e){if(this.handlers.feature.touch&&!this.over&&this.overFeature(e)){this.handlers.drag.dragstart(this.handlers.feature.evt);this.handlers.drag.stopDown=!1}},clickoutFeature:function(e){if(this.handlers.feature.touch&&this.over){this.outFeature(e);this.handlers.drag.stopDown=!0}},destroy:function(){this.layer=null;OpenLayers.Control.prototype.destroy.apply(this,[])},activate:function(){return this.handlers.feature.activate()&&OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){this.handlers.drag.deactivate();this.handlers.feature.deactivate();this.feature=null;this.dragging=!1;this.lastPixel=null;OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass+"Over");return OpenLayers.Control.prototype.deactivate.apply(this,arguments)},overFeature:function(e){var t=!1;if(this.handlers.drag.dragging)this.over=this.feature.id==e.id?!0:!1;else{this.feature=e;this.handlers.drag.activate();t=!0;this.over=!0;OpenLayers.Element.addClass(this.map.viewPortDiv,this.displayClass+"Over");this.onEnter(e)}return t},downFeature:function(e){this.lastPixel=e;this.onStart(this.feature,e)},moveFeature:function(e){var t=this.map.getResolution();this.feature.geometry.move(t*(e.x-this.lastPixel.x),t*(this.lastPixel.y-e.y));this.layer.drawFeature(this.feature);this.lastPixel=e;this.onDrag(this.feature,e)},upFeature:function(e){this.over||this.handlers.drag.deactivate()},doneDragging:function(e){this.onComplete(this.feature,e)},outFeature:function(e){if(this.handlers.drag.dragging)this.feature.id==e.id&&(this.over=!1);else{this.over=!1;this.handlers.drag.deactivate();OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass+"Over");this.onLeave(e);this.feature=null}},cancel:function(){this.handlers.drag.deactivate();this.over=!1},setMap:function(e){this.handlers.drag.setMap(e);this.handlers.feature.setMap(e);OpenLayers.Control.prototype.setMap.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.DragFeature"});OpenLayers.Format.WMSGetFeatureInfo=OpenLayers.Class(OpenLayers.Format.XML,{layerIdentifier:"_layer",featureIdentifier:"_feature",regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},gmlFormat:null,read:function(e){var t;"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));
var n=e.documentElement;if(n){var r=this["read_"+n.nodeName];t=r?r.call(this,n):new OpenLayers.Format.GML(this.options?this.options:{}).read(e)}else t=e;return t},read_msGMLOutput:function(e){var t=[],n=this.getSiblingNodesByTagCriteria(e,this.layerIdentifier);if(n)for(var r=0,i=n.length;i>r;++r){var a=n[r],s=a.nodeName;a.prefix&&(s=s.split(":")[1]);var s=s.replace(this.layerIdentifier,""),o=this.getSiblingNodesByTagCriteria(a,this.featureIdentifier);if(o)for(var l=0;l<o.length;l++){var c=o[l],u=this.parseGeometry(c),h=this.parseAttributes(c),p=new OpenLayers.Feature.Vector(u.geometry,h,null);p.bounds=u.bounds;p.type=s;t.push(p)}}return t},read_FeatureInfoResponse:function(e){for(var t=[],n=this.getElementsByTagNameNS(e,"*","FIELDS"),r=0,i=n.length;i>r;r++){var a,s=n[r],o=null,l={},c=s.attributes.length;if(c>0)for(a=0;c>a;a++){var u=s.attributes[a];l[u.nodeName]=u.nodeValue}else{var h=s.childNodes;for(a=0,c=h.length;c>a;++a){var p=h[a];3!=p.nodeType&&(l[p.getAttribute("name")]=p.getAttribute("value"))}}t.push(new OpenLayers.Feature.Vector(o,l,null))}return t},getSiblingNodesByTagCriteria:function(e,t){var n,r,i,a,s,o=[];if(e&&e.hasChildNodes()){n=e.childNodes;i=n.length;for(var l=0;i>l;l++){s=n[l];for(;s&&1!=s.nodeType;){s=s.nextSibling;l++}r=s?s.nodeName:"";if(r.length>0&&r.indexOf(t)>-1)o.push(s);else{a=this.getSiblingNodesByTagCriteria(s,t);a.length>0&&(0==o.length?o=a:o.push(a))}}}return o},parseAttributes:function(e){var t={};if(1==e.nodeType)for(var n=e.childNodes,r=n.length,i=0;r>i;++i){var a=n[i];if(1==a.nodeType){var s=a.childNodes,o=a.prefix?a.nodeName.split(":")[1]:a.nodeName;if(0==s.length)t[o]=null;else if(1==s.length){var l=s[0];if(3==l.nodeType||4==l.nodeType){var c=l.nodeValue.replace(this.regExes.trimSpace,"");t[o]=c}}}}return t},parseGeometry:function(e){this.gmlFormat||(this.gmlFormat=new OpenLayers.Format.GML);var t,n=this.gmlFormat.parseFeature(e),r=null;if(n){t=n.geometry&&n.geometry.clone();r=n.bounds&&n.bounds.clone();n.destroy()}return{geometry:t,bounds:r}},CLASS_NAME:"OpenLayers.Format.WMSGetFeatureInfo"});OpenLayers.Control.WMSGetFeatureInfo=OpenLayers.Class(OpenLayers.Control,{hover:!1,drillDown:!1,maxFeatures:10,clickCallback:"click",output:"features",layers:null,queryVisible:!1,url:null,layerUrls:null,infoFormat:"text/html",vendorParams:{},format:null,formatOptions:null,handler:null,hoverRequest:null,initialize:function(e){e=e||{};e.handlerOptions=e.handlerOptions||{};OpenLayers.Control.prototype.initialize.apply(this,[e]);this.format||(this.format=new OpenLayers.Format.WMSGetFeatureInfo(e.formatOptions));this.drillDown===!0&&(this.hover=!1);if(this.hover)this.handler=new OpenLayers.Handler.Hover(this,{move:this.cancelHover,pause:this.getInfoForHover},OpenLayers.Util.extend(this.handlerOptions.hover||{},{delay:250}));else{var t={};t[this.clickCallback]=this.getInfoForClick;this.handler=new OpenLayers.Handler.Click(this,t,this.handlerOptions.click||{})}},getInfoForClick:function(e){this.events.triggerEvent("beforegetfeatureinfo",{xy:e.xy});OpenLayers.Element.addClass(this.map.viewPortDiv,"olCursorWait");this.request(e.xy,{})},getInfoForHover:function(e){this.events.triggerEvent("beforegetfeatureinfo",{xy:e.xy});this.request(e.xy,{hover:!0})},cancelHover:function(){if(this.hoverRequest){this.hoverRequest.abort();this.hoverRequest=null}},findLayers:function(){for(var e,t,n=this.layers||this.map.layers,r=[],i=n.length-1;i>=0;--i){e=n[i];if(e instanceof OpenLayers.Layer.WMS&&(!this.queryVisible||e.getVisibility())){t=OpenLayers.Util.isArray(e.url)?e.url[0]:e.url;this.drillDown!==!1||this.url||(this.url=t);(this.drillDown===!0||this.urlMatches(t))&&r.push(e)}}return r},urlMatches:function(e){var t=OpenLayers.Util.isEquivalentUrl(this.url,e);if(!t&&this.layerUrls)for(var n=0,r=this.layerUrls.length;r>n;++n)if(OpenLayers.Util.isEquivalentUrl(this.layerUrls[n],e)){t=!0;break}return t},buildWMSOptions:function(e,t,n,r){for(var i=[],a=[],s=0,o=t.length;o>s;s++)if(null!=t[s].params.LAYERS){i=i.concat(t[s].params.LAYERS);a=a.concat(this.getStyleNames(t[s]))}var l=t[0],c=this.map.getProjection(),u=l.projection;u&&u.equals(this.map.getProjectionObject())&&(c=u.getCode());var h=OpenLayers.Util.extend({service:"WMS",version:l.params.VERSION,request:"GetFeatureInfo",exceptions:l.params.EXCEPTIONS,bbox:this.map.getExtent().toBBOX(null,l.reverseAxisOrder()),feature_count:this.maxFeatures,height:this.map.getSize().h,width:this.map.getSize().w,format:r,info_format:l.params.INFO_FORMAT||this.infoFormat},parseFloat(l.params.VERSION)>=1.3?{crs:c,i:parseInt(n.x),j:parseInt(n.y)}:{srs:c,x:parseInt(n.x),y:parseInt(n.y)});0!=i.length&&(h=OpenLayers.Util.extend({layers:i,query_layers:i,styles:a},h));OpenLayers.Util.applyDefaults(h,this.vendorParams);return{url:e,params:OpenLayers.Util.upperCaseObject(h),callback:function(t){this.handleResponse(n,t,e)},scope:this}},getStyleNames:function(e){var t;t=e.params.STYLES?e.params.STYLES:OpenLayers.Util.isArray(e.params.LAYERS)?new Array(e.params.LAYERS.length):e.params.LAYERS.replace(/[^,]/g,"");return t},request:function(e,t){var n=this.findLayers();if(0!=n.length){t=t||{};if(this.drillDown===!1){var r=this.buildWMSOptions(this.url,n,e,n[0].params.FORMAT),i=OpenLayers.Request.GET(r);t.hover===!0&&(this.hoverRequest=i)}else{this._requestCount=0;this._numRequests=0;this.features=[];for(var a,s={},o=0,l=n.length;l>o;o++){var c=n[o];a=OpenLayers.Util.isArray(c.url)?c.url[0]:c.url;if(a in s)s[a].push(c);else{this._numRequests++;s[a]=[c]}}var n;for(var a in s){n=s[a];var r=this.buildWMSOptions(a,n,e,n[0].params.FORMAT);OpenLayers.Request.GET(r)}}}else{this.events.triggerEvent("nogetfeatureinfo");OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait")}},triggerGetFeatureInfo:function(e,t,n){this.events.triggerEvent("getfeatureinfo",{text:e.responseText,features:n,request:e,xy:t});OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait")},handleResponse:function(e,t,n){var r=t.responseXML;r&&r.documentElement||(r=t.responseText);var i=this.format.read(r);if(this.drillDown===!1)this.triggerGetFeatureInfo(t,e,i);else{this._requestCount++;this._features=(this._features||[]).concat("object"===this.output?{url:n,features:i}:i);if(this._requestCount===this._numRequests){this.triggerGetFeatureInfo(t,e,this._features.concat());delete this._features;delete this._requestCount;delete this._numRequests}}},CLASS_NAME:"OpenLayers.Control.WMSGetFeatureInfo"});OpenLayers.Protocol.WFS.v1_1_0=OpenLayers.Class(OpenLayers.Protocol.WFS.v1,{version:"1.1.0",initialize:function(e){OpenLayers.Protocol.WFS.v1.prototype.initialize.apply(this,arguments);this.outputFormat&&!this.readFormat&&("gml2"==this.outputFormat.toLowerCase()?this.readFormat=new OpenLayers.Format.GML.v2({featureType:this.featureType,featureNS:this.featureNS,geometryName:this.geometryName}):"json"==this.outputFormat.toLowerCase()&&(this.readFormat=new OpenLayers.Format.GeoJSON))},CLASS_NAME:"OpenLayers.Protocol.WFS.v1_1_0"});OpenLayers.Control.PinchZoom=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,pinchOrigin:null,currentCenter:null,autoActivate:!0,preserveCenter:!1,initialize:function(e){OpenLayers.Control.prototype.initialize.apply(this,arguments);this.handler=new OpenLayers.Handler.Pinch(this,{start:this.pinchStart,move:this.pinchMove,done:this.pinchDone},this.handlerOptions)},pinchStart:function(e,t){var n=this.preserveCenter?this.map.getPixelFromLonLat(this.map.getCenter()):e.xy;this.pinchOrigin=n;this.currentCenter=n},pinchMove:function(e,t){var n=t.scale,r=this.map.layerContainerOriginPx,i=this.pinchOrigin,a=this.preserveCenter?this.map.getPixelFromLonLat(this.map.getCenter()):e.xy,s=Math.round(r.x+a.x-i.x+(n-1)*(r.x-i.x)),o=Math.round(r.y+a.y-i.y+(n-1)*(r.y-i.y));this.map.applyTransform(s,o,n);this.currentCenter=a},pinchDone:function(e,t,n){this.map.applyTransform();var r=this.map.getZoomForResolution(this.map.getResolution()/n.scale,!0);if(r!==this.map.getZoom()||!this.currentCenter.equals(this.pinchOrigin)){var i=this.map.getResolutionForZoom(r),a=this.map.getLonLatFromPixel(this.pinchOrigin),s=this.currentCenter,o=this.map.getSize();a.lon+=i*(o.w/2-s.x);a.lat-=i*(o.h/2-s.y);this.map.div.clientWidth=this.map.div.clientWidth;this.map.setCenter(a,r)}},CLASS_NAME:"OpenLayers.Control.PinchZoom"});OpenLayers.Format.WMSCapabilities.v1_1_1=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_1,{version:"1.1.1",readers:{wms:OpenLayers.Util.applyDefaults({SRS:function(e,t){t.srs[this.getChildValue(e)]=!0}},OpenLayers.Format.WMSCapabilities.v1_1.prototype.readers.wms)},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1_1"});var Proj4js={defaultDatum:"WGS84",transform:function(e,t,n){if(!e.readyToUse){this.reportError("Proj4js initialization for:"+e.srsCode+" not yet complete");return n}if(!t.readyToUse){this.reportError("Proj4js initialization for:"+t.srsCode+" not yet complete");return n}if(e.datum&&t.datum&&((e.datum.datum_type==Proj4js.common.PJD_3PARAM||e.datum.datum_type==Proj4js.common.PJD_7PARAM)&&"WGS84"!=t.datumCode||(t.datum.datum_type==Proj4js.common.PJD_3PARAM||t.datum.datum_type==Proj4js.common.PJD_7PARAM)&&"WGS84"!=e.datumCode)){var r=Proj4js.WGS84;this.transform(e,r,n);e=r}"enu"!=e.axis&&this.adjust_axis(e,!1,n);if("longlat"==e.projName){n.x*=Proj4js.common.D2R;n.y*=Proj4js.common.D2R}else{if(e.to_meter){n.x*=e.to_meter;n.y*=e.to_meter}e.inverse(n)}e.from_greenwich&&(n.x+=e.from_greenwich);n=this.datum_transform(e.datum,t.datum,n);t.from_greenwich&&(n.x-=t.from_greenwich);if("longlat"==t.projName){n.x*=Proj4js.common.R2D;n.y*=Proj4js.common.R2D}else{t.forward(n);if(t.to_meter){n.x/=t.to_meter;n.y/=t.to_meter}}"enu"!=t.axis&&this.adjust_axis(t,!0,n);return n},datum_transform:function(e,t,n){if(e.compare_datums(t))return n;if(e.datum_type==Proj4js.common.PJD_NODATUM||t.datum_type==Proj4js.common.PJD_NODATUM)return n;if(e.es!=t.es||e.a!=t.a||e.datum_type==Proj4js.common.PJD_3PARAM||e.datum_type==Proj4js.common.PJD_7PARAM||t.datum_type==Proj4js.common.PJD_3PARAM||t.datum_type==Proj4js.common.PJD_7PARAM){e.geodetic_to_geocentric(n);(e.datum_type==Proj4js.common.PJD_3PARAM||e.datum_type==Proj4js.common.PJD_7PARAM)&&e.geocentric_to_wgs84(n);(t.datum_type==Proj4js.common.PJD_3PARAM||t.datum_type==Proj4js.common.PJD_7PARAM)&&t.geocentric_from_wgs84(n);t.geocentric_to_geodetic(n)}return n},adjust_axis:function(e,t,n){for(var r,i,a=n.x,s=n.y,o=n.z||0,l=0;3>l;l++)if(!t||2!=l||void 0!==n.z){if(0==l){r=a;i="x"}else if(1==l){r=s;i="y"}else{r=o;i="z"}switch(e.axis[l]){case"e":n[i]=r;break;case"w":n[i]=-r;break;case"n":n[i]=r;break;case"s":n[i]=-r;break;case"u":void 0!==n[i]&&(n.z=r);break;case"d":void 0!==n[i]&&(n.z=-r);break;default:alert("ERROR: unknow axis ("+e.axis[l]+") - check definition of "+e.projName);return null}}return n},reportError:function(e){},extend:function(e,t){e=e||{};if(t)for(var n in t){var r=t[n];void 0!==r&&(e[n]=r)}return e},Class:function(){for(var e,t=function(){this.initialize.apply(this,arguments)},n={},r=0;r<arguments.length;++r){e="function"==typeof arguments[r]?arguments[r].prototype:arguments[r];Proj4js.extend(n,e)}t.prototype=n;return t},bind:function(e,t){var n=Array.prototype.slice.apply(arguments,[2]);return function(){var r=n.concat(Array.prototype.slice.apply(arguments,[0]));return e.apply(t,r)}},scriptName:"proj4js-combined.js",defsLookupService:"http://spatialreference.org/ref",libPath:null,getScriptLocation:function(){if(this.libPath)return this.libPath;for(var e=this.scriptName,t=e.length,n=document.getElementsByTagName("script"),r=0;r<n.length;r++){var i=n[r].getAttribute("src");if(i){var a=i.lastIndexOf(e);if(a>-1&&a+t==i.length){this.libPath=i.slice(0,-t);break}}}return this.libPath||""},loadScript:function(e,t,n,r){var i=document.createElement("script");i.defer=!1;i.type="text/javascript";i.id=e;i.src=e;i.onload=t;i.onerror=n;i.loadCheck=r;/MSIE/.test(navigator.userAgent)&&(i.onreadystatechange=this.checkReadyState);document.getElementsByTagName("head")[0].appendChild(i)},checkReadyState:function(){"loaded"==this.readyState&&(this.loadCheck()?this.onload():this.onerror())}};Proj4js.Proj=Proj4js.Class({readyToUse:!1,title:null,projName:null,units:null,datum:null,x0:0,y0:0,localCS:!1,queue:null,initialize:function(e,t){this.srsCodeInput=e;this.queue=[];t&&this.queue.push(t);if(e.indexOf("GEOGCS")>=0||e.indexOf("GEOCCS")>=0||e.indexOf("PROJCS")>=0||e.indexOf("LOCAL_CS")>=0){this.parseWKT(e);this.deriveConstants();this.loadProjCode(this.projName)}else{if(0==e.indexOf("urn:")){var n=e.split(":");"ogc"!=n[1]&&"x-ogc"!=n[1]||"def"!=n[2]||"crs"!=n[3]||(e=n[4]+":"+n[n.length-1])}else if(0==e.indexOf("http://")){var r=e.split("#");r[0].match(/epsg.org/)?e="EPSG:"+r[1]:r[0].match(/RIG.xml/)&&(e="IGNF:"+r[1])}this.srsCode=e.toUpperCase();if(0==this.srsCode.indexOf("EPSG")){this.srsCode=this.srsCode;this.srsAuth="epsg";this.srsProjNumber=this.srsCode.substring(5)}else if(0==this.srsCode.indexOf("IGNF")){this.srsCode=this.srsCode;this.srsAuth="IGNF";this.srsProjNumber=this.srsCode.substring(5)}else if(0==this.srsCode.indexOf("CRS")){this.srsCode=this.srsCode;this.srsAuth="CRS";this.srsProjNumber=this.srsCode.substring(4)}else{this.srsAuth="";this.srsProjNumber=this.srsCode}this.loadProjDefinition()}},loadProjDefinition:function(){if(Proj4js.defs[this.srsCode])this.defsLoaded();else{var e=Proj4js.getScriptLocation()+"defs/"+this.srsAuth.toUpperCase()+this.srsProjNumber+".js";Proj4js.loadScript(e,Proj4js.bind(this.defsLoaded,this),Proj4js.bind(this.loadFromService,this),Proj4js.bind(this.checkDefsLoaded,this))}},loadFromService:function(){var e=Proj4js.defsLookupService+"/"+this.srsAuth+"/"+this.srsProjNumber+"/proj4js/";Proj4js.loadScript(e,Proj4js.bind(this.defsLoaded,this),Proj4js.bind(this.defsFailed,this),Proj4js.bind(this.checkDefsLoaded,this))},defsLoaded:function(){this.parseDefs();this.loadProjCode(this.projName)},checkDefsLoaded:function(){return Proj4js.defs[this.srsCode]?!0:!1},defsFailed:function(){Proj4js.reportError("failed to load projection definition for: "+this.srsCode);Proj4js.defs[this.srsCode]=Proj4js.defs.WGS84;this.defsLoaded()},loadProjCode:function(e){if(Proj4js.Proj[e])this.initTransforms();else{var t=Proj4js.getScriptLocation()+"projCode/"+e+".js";Proj4js.loadScript(t,Proj4js.bind(this.loadProjCodeSuccess,this,e),Proj4js.bind(this.loadProjCodeFailure,this,e),Proj4js.bind(this.checkCodeLoaded,this,e))}},loadProjCodeSuccess:function(e){Proj4js.Proj[e].dependsOn?this.loadProjCode(Proj4js.Proj[e].dependsOn):this.initTransforms()},loadProjCodeFailure:function(e){Proj4js.reportError("failed to find projection file for: "+e)},checkCodeLoaded:function(e){return Proj4js.Proj[e]?!0:!1},initTransforms:function(){Proj4js.extend(this,Proj4js.Proj[this.projName]);this.init();this.readyToUse=!0;if(this.queue)for(var e;e=this.queue.shift();)e.call(this,this)},wktRE:/^(\w+)\[(.*)\]$/,parseWKT:function(e){var t=e.match(this.wktRE);if(t){var n,r=t[1],i=t[2],a=i.split(",");n="TOWGS84"==r.toUpperCase()?r:a.shift();n=n.replace(/^\"/,"");n=n.replace(/\"$/,"");for(var s=new Array,o=0,l="",c=0;c<a.length;++c){for(var u=a[c],h=0;h<u.length;++h){"["==u.charAt(h)&&++o;"]"==u.charAt(h)&&--o}l+=u;if(0===o){s.push(l);l=""}else l+=","}switch(r){case"LOCAL_CS":this.projName="identity";this.localCS=!0;this.srsCode=n;break;case"GEOGCS":this.projName="longlat";this.geocsCode=n;this.srsCode||(this.srsCode=n);break;case"PROJCS":this.srsCode=n;break;case"GEOCCS":break;case"PROJECTION":this.projName=Proj4js.wktProjections[n];break;case"DATUM":this.datumName=n;break;case"LOCAL_DATUM":this.datumCode="none";break;case"SPHEROID":this.ellps=n;this.a=parseFloat(s.shift());this.rf=parseFloat(s.shift());break;case"PRIMEM":this.from_greenwich=parseFloat(s.shift());break;case"UNIT":this.units=n;this.unitsPerMeter=parseFloat(s.shift());break;case"PARAMETER":var p=n.toLowerCase(),d=parseFloat(s.shift());switch(p){case"false_easting":this.x0=d;break;case"false_northing":this.y0=d;break;case"scale_factor":this.k0=d;break;case"central_meridian":this.long0=d*Proj4js.common.D2R;break;case"latitude_of_origin":this.lat0=d*Proj4js.common.D2R;break;case"more_here":}break;case"TOWGS84":this.datum_params=s;break;case"AXIS":var p=n.toLowerCase(),d=s.shift();switch(d){case"EAST":d="e";break;case"WEST":d="w";break;case"NORTH":d="n";break;case"SOUTH":d="s";break;case"UP":d="u";break;case"DOWN":d="d";break;case"OTHER":default:d=" "}this.axis||(this.axis="enu");switch(p){case"x":this.axis=d+this.axis.substr(1,2);break;case"y":this.axis=this.axis.substr(0,1)+d+this.axis.substr(2,1);break;case"z":this.axis=this.axis.substr(0,2)+d}case"MORE_HERE":}for(var c=0;c<s.length;++c)this.parseWKT(s[c])}},parseDefs:function(){this.defData=Proj4js.defs[this.srsCode];var e,t;if(this.defData){for(var n=this.defData.split("+"),r=0;r<n.length;r++){var i=n[r].split("=");e=i[0].toLowerCase();t=i[1];switch(e.replace(/\s/gi,"")){case"":break;case"title":this.title=t;break;case"proj":this.projName=t.replace(/\s/gi,"");break;case"units":this.units=t.replace(/\s/gi,"");break;case"datum":this.datumCode=t.replace(/\s/gi,"");break;case"nadgrids":this.nagrids=t.replace(/\s/gi,"");break;case"ellps":this.ellps=t.replace(/\s/gi,"");break;case"a":this.a=parseFloat(t);break;case"b":this.b=parseFloat(t);break;case"rf":this.rf=parseFloat(t);break;case"lat_0":this.lat0=t*Proj4js.common.D2R;break;case"lat_1":this.lat1=t*Proj4js.common.D2R;break;case"lat_2":this.lat2=t*Proj4js.common.D2R;break;case"lat_ts":this.lat_ts=t*Proj4js.common.D2R;break;case"lon_0":this.long0=t*Proj4js.common.D2R;break;case"alpha":this.alpha=parseFloat(t)*Proj4js.common.D2R;break;case"lonc":this.longc=t*Proj4js.common.D2R;break;case"x_0":this.x0=parseFloat(t);break;case"y_0":this.y0=parseFloat(t);break;case"k_0":this.k0=parseFloat(t);break;case"k":this.k0=parseFloat(t);break;case"r_a":this.R_A=!0;break;case"zone":this.zone=parseInt(t,10);break;case"south":this.utmSouth=!0;break;case"towgs84":this.datum_params=t.split(",");break;case"to_meter":this.to_meter=parseFloat(t);break;case"from_greenwich":this.from_greenwich=t*Proj4js.common.D2R;break;case"pm":t=t.replace(/\s/gi,"");this.from_greenwich=Proj4js.PrimeMeridian[t]?Proj4js.PrimeMeridian[t]:parseFloat(t);this.from_greenwich*=Proj4js.common.D2R;break;case"axis":t=t.replace(/\s/gi,"");var a="ewnsud";3==t.length&&-1!=a.indexOf(t.substr(0,1))&&-1!=a.indexOf(t.substr(1,1))&&-1!=a.indexOf(t.substr(2,1))&&(this.axis=t);break;case"no_defs":}}this.deriveConstants()}},deriveConstants:function(){"@null"==this.nagrids&&(this.datumCode="none");if(this.datumCode&&"none"!=this.datumCode){var e=Proj4js.Datum[this.datumCode];if(e){this.datum_params=e.towgs84?e.towgs84.split(","):null;this.ellps=e.ellipse;this.datumName=e.datumName?e.datumName:this.datumCode}}if(!this.a){var t=Proj4js.Ellipsoid[this.ellps]?Proj4js.Ellipsoid[this.ellps]:Proj4js.Ellipsoid.WGS84;Proj4js.extend(this,t)}this.rf&&!this.b&&(this.b=(1-1/this.rf)*this.a);if(0===this.rf||Math.abs(this.a-this.b)<Proj4js.common.EPSLN){this.sphere=!0;this.b=this.a}this.a2=this.a*this.a;this.b2=this.b*this.b;this.es=(this.a2-this.b2)/this.a2;this.e=Math.sqrt(this.es);if(this.R_A){this.a*=1-this.es*(Proj4js.common.SIXTH+this.es*(Proj4js.common.RA4+this.es*Proj4js.common.RA6));this.a2=this.a*this.a;this.b2=this.b*this.b;this.es=0}this.ep2=(this.a2-this.b2)/this.b2;this.k0||(this.k0=1);this.axis||(this.axis="enu");this.datum=new Proj4js.datum(this)}});Proj4js.Proj.longlat={init:function(){},forward:function(e){return e},inverse:function(e){return e}};Proj4js.Proj.identity=Proj4js.Proj.longlat;Proj4js.defs={WGS84:"+title=long/lat:WGS84 +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees","EPSG:4326":"+title=long/lat:WGS84 +proj=longlat +a=6378137.0 +b=6356752.31424518 +ellps=WGS84 +datum=WGS84 +units=degrees","EPSG:4269":"+title=long/lat:NAD83 +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees","EPSG:3875":"+title= Google Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"};Proj4js.defs["EPSG:3785"]=Proj4js.defs["EPSG:3875"];Proj4js.defs.GOOGLE=Proj4js.defs["EPSG:3875"];Proj4js.defs["EPSG:900913"]=Proj4js.defs["EPSG:3875"];Proj4js.defs["EPSG:102113"]=Proj4js.defs["EPSG:3875"];Proj4js.common={PI:3.141592653589793,HALF_PI:1.5707963267948966,TWO_PI:6.283185307179586,FORTPI:.7853981633974483,R2D:57.29577951308232,D2R:.017453292519943295,SEC_TO_RAD:484813681109536e-20,EPSLN:1e-10,MAX_ITER:20,COS_67P5:.3826834323650898,AD_C:1.0026,PJD_UNKNOWN:0,PJD_3PARAM:1,PJD_7PARAM:2,PJD_GRIDSHIFT:3,PJD_WGS84:4,PJD_NODATUM:5,SRS_WGS84_SEMIMAJOR:6378137,SIXTH:.16666666666666666,RA4:.04722222222222222,RA6:.022156084656084655,RV4:.06944444444444445,RV6:.04243827160493827,msfnz:function(e,t,n){var r=e*t;return n/Math.sqrt(1-r*r)},tsfnz:function(e,t,n){var r=e*n,i=.5*e;r=Math.pow((1-r)/(1+r),i);return Math.tan(.5*(this.HALF_PI-t))/r},phi2z:function(e,t){for(var n,r,i=.5*e,a=this.HALF_PI-2*Math.atan(t),s=0;15>=s;s++){n=e*Math.sin(a);r=this.HALF_PI-2*Math.atan(t*Math.pow((1-n)/(1+n),i))-a;a+=r;if(Math.abs(r)<=1e-10)return a}alert("phi2z has NoConvergence");return-9999},qsfnz:function(e,t){var n;if(e>1e-7){n=e*t;return(1-e*e)*(t/(1-n*n)-.5/e*Math.log((1-n)/(1+n)))}return 2*t},asinz:function(e){Math.abs(e)>1&&(e=e>1?1:-1);return Math.asin(e)},e0fn:function(e){return 1-.25*e*(1+e/16*(3+1.25*e))},e1fn:function(e){return.375*e*(1+.25*e*(1+.46875*e))},e2fn:function(e){return.05859375*e*e*(1+.75*e)},e3fn:function(e){return e*e*e*(35/3072)},mlfn:function(e,t,n,r,i){return e*i-t*Math.sin(2*i)+n*Math.sin(4*i)-r*Math.sin(6*i)},srat:function(e,t){return Math.pow((1-e)/(1+e),t)},sign:function(e){return 0>e?-1:1},adjust_lon:function(e){e=Math.abs(e)<this.PI?e:e-this.sign(e)*this.TWO_PI;return e},adjust_lat:function(e){e=Math.abs(e)<this.HALF_PI?e:e-this.sign(e)*this.PI;return e},latiso:function(e,t,n){if(Math.abs(t)>this.HALF_PI)return+Number.NaN;if(t==this.HALF_PI)return Number.POSITIVE_INFINITY;if(t==-1*this.HALF_PI)return-1*Number.POSITIVE_INFINITY;var r=e*n;return Math.log(Math.tan((this.HALF_PI+t)/2))+e*Math.log((1-r)/(1+r))/2},fL:function(e,t){return 2*Math.atan(e*Math.exp(t))-this.HALF_PI},invlatiso:function(e,t){var n=this.fL(1,t),r=0,i=0;do{r=n;i=e*Math.sin(r);n=this.fL(Math.exp(e*Math.log((1+i)/(1-i))/2),t)}while(Math.abs(n-r)>1e-12);return n},sinh:function(e){var t=Math.exp(e);t=(t-1/t)/2;return t},cosh:function(e){var t=Math.exp(e);t=(t+1/t)/2;return t},tanh:function(e){var t=Math.exp(e);t=(t-1/t)/(t+1/t);return t},asinh:function(e){var t=e>=0?1:-1;return t*Math.log(Math.abs(e)+Math.sqrt(e*e+1))},acosh:function(e){return 2*Math.log(Math.sqrt((e+1)/2)+Math.sqrt((e-1)/2))},atanh:function(e){return Math.log((e-1)/(e+1))/2},gN:function(e,t,n){var r=t*n;return e/Math.sqrt(1-r*r)},pj_enfn:function(e){var t=new Array;t[0]=this.C00-e*(this.C02+e*(this.C04+e*(this.C06+e*this.C08)));t[1]=e*(this.C22-e*(this.C04+e*(this.C06+e*this.C08)));var n=e*e;t[2]=n*(this.C44-e*(this.C46+e*this.C48));n*=e;t[3]=n*(this.C66-e*this.C68);t[4]=n*e*this.C88;return t},pj_mlfn:function(e,t,n,r){n*=t;t*=t;return r[0]*e-n*(r[1]+t*(r[2]+t*(r[3]+t*r[4])))},pj_inv_mlfn:function(e,t,n){for(var r=1/(1-t),i=e,a=Proj4js.common.MAX_ITER;a;--a){var s=Math.sin(i),o=1-t*s*s;o=(this.pj_mlfn(i,s,Math.cos(i),n)-e)*o*Math.sqrt(o)*r;i-=o;if(Math.abs(o)<Proj4js.common.EPSLN)return i}Proj4js.reportError("cass:pj_inv_mlfn: Convergence error");return i},C00:1,C02:.25,C04:.046875,C06:.01953125,C08:.01068115234375,C22:.75,C44:.46875,C46:.013020833333333334,C48:.007120768229166667,C66:.3645833333333333,C68:.005696614583333333,C88:.3076171875};Proj4js.datum=Proj4js.Class({initialize:function(e){this.datum_type=Proj4js.common.PJD_WGS84;e.datumCode&&"none"==e.datumCode&&(this.datum_type=Proj4js.common.PJD_NODATUM);if(e&&e.datum_params){for(var t=0;t<e.datum_params.length;t++)e.datum_params[t]=parseFloat(e.datum_params[t]);(0!=e.datum_params[0]||0!=e.datum_params[1]||0!=e.datum_params[2])&&(this.datum_type=Proj4js.common.PJD_3PARAM);if(e.datum_params.length>3&&(0!=e.datum_params[3]||0!=e.datum_params[4]||0!=e.datum_params[5]||0!=e.datum_params[6])){this.datum_type=Proj4js.common.PJD_7PARAM;e.datum_params[3]*=Proj4js.common.SEC_TO_RAD;e.datum_params[4]*=Proj4js.common.SEC_TO_RAD;e.datum_params[5]*=Proj4js.common.SEC_TO_RAD;e.datum_params[6]=e.datum_params[6]/1e6+1}}if(e){this.a=e.a;this.b=e.b;this.es=e.es;this.ep2=e.ep2;this.datum_params=e.datum_params}},compare_datums:function(e){if(this.datum_type!=e.datum_type)return!1;if(this.a!=e.a||Math.abs(this.es-e.es)>5e-11)return!1;if(this.datum_type==Proj4js.common.PJD_3PARAM)return this.datum_params[0]==e.datum_params[0]&&this.datum_params[1]==e.datum_params[1]&&this.datum_params[2]==e.datum_params[2];if(this.datum_type==Proj4js.common.PJD_7PARAM)return this.datum_params[0]==e.datum_params[0]&&this.datum_params[1]==e.datum_params[1]&&this.datum_params[2]==e.datum_params[2]&&this.datum_params[3]==e.datum_params[3]&&this.datum_params[4]==e.datum_params[4]&&this.datum_params[5]==e.datum_params[5]&&this.datum_params[6]==e.datum_params[6];if(this.datum_type==Proj4js.common.PJD_GRIDSHIFT||e.datum_type==Proj4js.common.PJD_GRIDSHIFT){alert("ERROR: Grid shift transformations are not implemented.");return!1}return!0},geodetic_to_geocentric:function(e){var t,n,r,i,a,s,o,l=e.x,c=e.y,u=e.z?e.z:0,h=0;if(c<-Proj4js.common.HALF_PI&&c>-1.001*Proj4js.common.HALF_PI)c=-Proj4js.common.HALF_PI;else if(c>Proj4js.common.HALF_PI&&c<1.001*Proj4js.common.HALF_PI)c=Proj4js.common.HALF_PI;else if(c<-Proj4js.common.HALF_PI||c>Proj4js.common.HALF_PI){Proj4js.reportError("geocent:lat out of range:"+c);return null}l>Proj4js.common.PI&&(l-=2*Proj4js.common.PI);a=Math.sin(c);o=Math.cos(c);s=a*a;i=this.a/Math.sqrt(1-this.es*s);t=(i+u)*o*Math.cos(l);n=(i+u)*o*Math.sin(l);r=(i*(1-this.es)+u)*a;e.x=t;e.y=n;e.z=r;return h},geocentric_to_geodetic:function(e){var t,n,r,i,a,s,o,l,c,u,h,p,d,f,m,y,g,v=1e-12,C=v*v,L=30,T=e.x,w=e.y,b=e.z?e.z:0;d=!1;t=Math.sqrt(T*T+w*w);n=Math.sqrt(T*T+w*w+b*b);if(t/this.a<v){d=!0;m=0;if(n/this.a<v){y=Proj4js.common.HALF_PI;g=-this.b;return}}else m=Math.atan2(w,T);r=b/n;i=t/n;a=1/Math.sqrt(1-this.es*(2-this.es)*i*i);l=i*(1-this.es)*a;c=r*a;f=0;do{f++;o=this.a/Math.sqrt(1-this.es*c*c);g=t*l+b*c-o*(1-this.es*c*c);s=this.es*o/(o+g);a=1/Math.sqrt(1-s*(2-s)*i*i);u=i*(1-s)*a;h=r*a;p=h*l-u*c;l=u;c=h}while(p*p>C&&L>f);y=Math.atan(h/Math.abs(u));e.x=m;e.y=y;e.z=g;return e},geocentric_to_geodetic_noniter:function(e){var t,n,r,i,a,s,o,l,c,u,h,p,d,f,m,y,g,v=e.x,C=e.y,L=e.z?e.z:0;v=parseFloat(v);C=parseFloat(C);L=parseFloat(L);g=!1;if(0!=v)t=Math.atan2(C,v);else if(C>0)t=Proj4js.common.HALF_PI;else if(0>C)t=-Proj4js.common.HALF_PI;else{g=!0;t=0;if(L>0)n=Proj4js.common.HALF_PI;else{if(!(0>L)){n=Proj4js.common.HALF_PI;r=-this.b;return}n=-Proj4js.common.HALF_PI}}a=v*v+C*C;i=Math.sqrt(a);s=L*Proj4js.common.AD_C;l=Math.sqrt(s*s+a);u=s/l;p=i/l;h=u*u*u;o=L+this.b*this.ep2*h;y=i-this.a*this.es*p*p*p;c=Math.sqrt(o*o+y*y);d=o/c;f=y/c;m=this.a/Math.sqrt(1-this.es*d*d);r=f>=Proj4js.common.COS_67P5?i/f-m:f<=-Proj4js.common.COS_67P5?i/-f-m:L/d+m*(this.es-1);0==g&&(n=Math.atan(d/f));e.x=t;e.y=n;e.z=r;return e},geocentric_to_wgs84:function(e){if(this.datum_type==Proj4js.common.PJD_3PARAM){e.x+=this.datum_params[0];e.y+=this.datum_params[1];e.z+=this.datum_params[2]}else if(this.datum_type==Proj4js.common.PJD_7PARAM){var t=this.datum_params[0],n=this.datum_params[1],r=this.datum_params[2],i=this.datum_params[3],a=this.datum_params[4],s=this.datum_params[5],o=this.datum_params[6],l=o*(e.x-s*e.y+a*e.z)+t,c=o*(s*e.x+e.y-i*e.z)+n,u=o*(-a*e.x+i*e.y+e.z)+r;e.x=l;e.y=c;e.z=u}},geocentric_from_wgs84:function(e){if(this.datum_type==Proj4js.common.PJD_3PARAM){e.x-=this.datum_params[0];e.y-=this.datum_params[1];e.z-=this.datum_params[2]}else if(this.datum_type==Proj4js.common.PJD_7PARAM){var t=this.datum_params[0],n=this.datum_params[1],r=this.datum_params[2],i=this.datum_params[3],a=this.datum_params[4],s=this.datum_params[5],o=this.datum_params[6],l=(e.x-t)/o,c=(e.y-n)/o,u=(e.z-r)/o;e.x=l+s*c-a*u;e.y=-s*l+c+i*u;e.z=a*l-i*c+u}}});Proj4js.Point=Proj4js.Class({initialize:function(e,t,n){if("object"==typeof e){this.x=e[0];this.y=e[1];this.z=e[2]||0}else if("string"==typeof e&&"undefined"==typeof t){var r=e.split(",");this.x=parseFloat(r[0]);this.y=parseFloat(r[1]);this.z=parseFloat(r[2])||0}else{this.x=e;this.y=t;this.z=n||0}},clone:function(){return new Proj4js.Point(this.x,this.y,this.z)},toString:function(){return"x="+this.x+",y="+this.y},toShortString:function(){return this.x+", "+this.y}});Proj4js.PrimeMeridian={greenwich:0,lisbon:-9.131906111111,paris:2.337229166667,bogota:-74.080916666667,madrid:-3.687938888889,rome:12.452333333333,bern:7.439583333333,jakarta:106.807719444444,ferro:-17.666666666667,brussels:4.367975,stockholm:18.058277777778,athens:23.7163375,oslo:10.722916666667};Proj4js.Ellipsoid={MERIT:{a:6378137,rf:298.257,ellipseName:"MERIT 1983"},SGS85:{a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"},GRS80:{a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"},IAU76:{a:6378140,rf:298.257,ellipseName:"IAU 1976"},airy:{a:6377563.396,b:6356256.91,ellipseName:"Airy 1830"},"APL4.":{a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"},NWL9D:{a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"},mod_airy:{a:6377340.189,b:6356034.446,ellipseName:"Modified Airy"},andrae:{a:6377104.43,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"},aust_SA:{a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"},GRS67:{a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"},bessel:{a:6377397.155,rf:299.1528128,ellipseName:"Bessel 1841"},bess_nam:{a:6377483.865,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"},clrk66:{a:6378206.4,b:6356583.8,ellipseName:"Clarke 1866"},clrk80:{a:6378249.145,rf:293.4663,ellipseName:"Clarke 1880 mod."},CPM:{a:6375738.7,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"},delmbr:{a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"},engelis:{a:6378136.05,rf:298.2566,ellipseName:"Engelis 1985"},evrst30:{a:6377276.345,rf:300.8017,ellipseName:"Everest 1830"},evrst48:{a:6377304.063,rf:300.8017,ellipseName:"Everest 1948"},evrst56:{a:6377301.243,rf:300.8017,ellipseName:"Everest 1956"},evrst69:{a:6377295.664,rf:300.8017,ellipseName:"Everest 1969"},evrstSS:{a:6377298.556,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"},fschr60:{a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"},fschr60m:{a:6378155,rf:298.3,ellipseName:"Fischer 1960"},fschr68:{a:6378150,rf:298.3,ellipseName:"Fischer 1968"},helmert:{a:6378200,rf:298.3,ellipseName:"Helmert 1906"},hough:{a:6378270,rf:297,ellipseName:"Hough"},intl:{a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"},kaula:{a:6378163,rf:298.24,ellipseName:"Kaula 1961"},lerch:{a:6378139,rf:298.257,ellipseName:"Lerch 1979"},mprts:{a:6397300,rf:191,ellipseName:"Maupertius 1738"},new_intl:{a:6378157.5,b:6356772.2,ellipseName:"New International 1967"},plessis:{a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"},krass:{a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"},SEasia:{a:6378155,b:6356773.3205,ellipseName:"Southeast Asia"},walbeck:{a:6376896,b:6355834.8467,ellipseName:"Walbeck"},WGS60:{a:6378165,rf:298.3,ellipseName:"WGS 60"},WGS66:{a:6378145,rf:298.25,ellipseName:"WGS 66"},WGS72:{a:6378135,rf:298.26,ellipseName:"WGS 72"},WGS84:{a:6378137,rf:298.257223563,ellipseName:"WGS 84"},sphere:{a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"}};Proj4js.Datum={WGS84:{towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},GGRS87:{towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},NAD83:{towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},NAD27:{nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},potsdam:{towgs84:"606.0,23.0,413.0",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},carthage:{towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},hermannskogel:{towgs84:"653.0,-212.0,449.0",
ellipse:"bessel",datumName:"Hermannskogel"},ire65:{towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},nzgd49:{towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},OSGB36:{towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"}};Proj4js.WGS84=new Proj4js.Proj("WGS84");Proj4js.Datum.OSB36=Proj4js.Datum.OSGB36;Proj4js.wktProjections={"Lambert Tangential Conformal Conic Projection":"lcc",Mercator:"merc","Popular Visualisation Pseudo Mercator":"merc",Mercator_1SP:"merc",Transverse_Mercator:"tmerc","Transverse Mercator":"tmerc","Lambert Azimuthal Equal Area":"laea","Universal Transverse Mercator System":"utm"};Proj4js.Proj.aea={init:function(){if(Math.abs(this.lat1+this.lat2)<Proj4js.common.EPSLN)Proj4js.reportError("aeaInitEqualLatitudes");else{this.temp=this.b/this.a;this.es=1-Math.pow(this.temp,2);this.e3=Math.sqrt(this.es);this.sin_po=Math.sin(this.lat1);this.cos_po=Math.cos(this.lat1);this.t1=this.sin_po;this.con=this.sin_po;this.ms1=Proj4js.common.msfnz(this.e3,this.sin_po,this.cos_po);this.qs1=Proj4js.common.qsfnz(this.e3,this.sin_po,this.cos_po);this.sin_po=Math.sin(this.lat2);this.cos_po=Math.cos(this.lat2);this.t2=this.sin_po;this.ms2=Proj4js.common.msfnz(this.e3,this.sin_po,this.cos_po);this.qs2=Proj4js.common.qsfnz(this.e3,this.sin_po,this.cos_po);this.sin_po=Math.sin(this.lat0);this.cos_po=Math.cos(this.lat0);this.t3=this.sin_po;this.qs0=Proj4js.common.qsfnz(this.e3,this.sin_po,this.cos_po);this.ns0=Math.abs(this.lat1-this.lat2)>Proj4js.common.EPSLN?(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.con;this.c=this.ms1*this.ms1+this.ns0*this.qs1;this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0}},forward:function(e){var t=e.x,n=e.y;this.sin_phi=Math.sin(n);this.cos_phi=Math.cos(n);var r=Proj4js.common.qsfnz(this.e3,this.sin_phi,this.cos_phi),i=this.a*Math.sqrt(this.c-this.ns0*r)/this.ns0,a=this.ns0*Proj4js.common.adjust_lon(t-this.long0),s=i*Math.sin(a)+this.x0,o=this.rh-i*Math.cos(a)+this.y0;e.x=s;e.y=o;return e},inverse:function(e){var t,n,r,i,a,s;e.x-=this.x0;e.y=this.rh-e.y+this.y0;if(this.ns0>=0){t=Math.sqrt(e.x*e.x+e.y*e.y);r=1}else{t=-Math.sqrt(e.x*e.x+e.y*e.y);r=-1}i=0;0!=t&&(i=Math.atan2(r*e.x,r*e.y));r=t*this.ns0/this.a;n=(this.c-r*r)/this.ns0;if(this.e3>=1e-10){r=1-.5*(1-this.es)*Math.log((1-this.e3)/(1+this.e3))/this.e3;s=Math.abs(Math.abs(r)-Math.abs(n))>1e-10?this.phi1z(this.e3,n):n>=0?.5*Proj4js.common.PI:-.5*Proj4js.common.PI}else s=this.phi1z(this.e3,n);a=Proj4js.common.adjust_lon(i/this.ns0+this.long0);e.x=a;e.y=s;return e},phi1z:function(e,t){var n,r,i,a,s,o=Proj4js.common.asinz(.5*t);if(e<Proj4js.common.EPSLN)return o;for(var l=e*e,c=1;25>=c;c++){n=Math.sin(o);r=Math.cos(o);i=e*n;a=1-i*i;s=.5*a*a/r*(t/(1-l)-n/a+.5/e*Math.log((1-i)/(1+i)));o+=s;if(Math.abs(s)<=1e-7)return o}Proj4js.reportError("aea:phi1z:Convergence error");return null}};Proj4js.Proj.sterea={dependsOn:"gauss",init:function(){Proj4js.Proj.gauss.init.apply(this);if(this.rc){this.sinc0=Math.sin(this.phic0);this.cosc0=Math.cos(this.phic0);this.R2=2*this.rc;this.title||(this.title="Oblique Stereographic Alternative")}else Proj4js.reportError("sterea:init:E_ERROR_0")},forward:function(e){var t,n,r,i;e.x=Proj4js.common.adjust_lon(e.x-this.long0);Proj4js.Proj.gauss.forward.apply(this,[e]);t=Math.sin(e.y);n=Math.cos(e.y);r=Math.cos(e.x);i=this.k0*this.R2/(1+this.sinc0*t+this.cosc0*n*r);e.x=i*n*Math.sin(e.x);e.y=i*(this.cosc0*t-this.sinc0*n*r);e.x=this.a*e.x+this.x0;e.y=this.a*e.y+this.y0;return e},inverse:function(e){var t,n,r,i,a;e.x=(e.x-this.x0)/this.a;e.y=(e.y-this.y0)/this.a;e.x/=this.k0;e.y/=this.k0;if(a=Math.sqrt(e.x*e.x+e.y*e.y)){var s=2*Math.atan2(a,this.R2);t=Math.sin(s);n=Math.cos(s);i=Math.asin(n*this.sinc0+e.y*t*this.cosc0/a);r=Math.atan2(e.x*t,a*this.cosc0*n-e.y*this.sinc0*t)}else{i=this.phic0;r=0}e.x=r;e.y=i;Proj4js.Proj.gauss.inverse.apply(this,[e]);e.x=Proj4js.common.adjust_lon(e.x+this.long0);return e}};Proj4js.Proj.poly={init:function(){0==this.lat0&&(this.lat0=90);this.temp=this.b/this.a;this.es=1-Math.pow(this.temp,2);this.e=Math.sqrt(this.es);this.e0=Proj4js.common.e0fn(this.es);this.e1=Proj4js.common.e1fn(this.es);this.e2=Proj4js.common.e2fn(this.es);this.e3=Proj4js.common.e3fn(this.es);this.ml0=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat0)},forward:function(e){var t,n,r,i,a,s,o,l=e.x,c=e.y;r=Proj4js.common.adjust_lon(l-this.long0);if(Math.abs(c)<=1e-7){s=this.x0+this.a*r;o=this.y0-this.a*this.ml0}else{t=Math.sin(c);n=Math.cos(c);i=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,c);a=Proj4js.common.msfnz(this.e,t,n);r=t;s=this.x0+this.a*a*Math.sin(r)/t;o=this.y0+this.a*(i-this.ml0+a*(1-Math.cos(r))/t)}e.x=s;e.y=o;return e},inverse:function(e){var t,n,r,i,a,s;e.x-=this.x0;e.y-=this.y0;t=this.ml0+e.y/this.a;i=0;if(Math.abs(t)<=1e-7){a=e.x/this.a+this.long0;s=0}else{n=t*t+e.x/this.a*(e.x/this.a);i=phi4z(this.es,this.e0,this.e1,this.e2,this.e3,this.al,n,r,s);if(1!=i)return i;a=Proj4js.common.adjust_lon(Proj4js.common.asinz(e.x*r/this.a)/Math.sin(s)+this.long0)}e.x=a;e.y=s;return e}};Proj4js.Proj.equi={init:function(){this.x0||(this.x0=0);this.y0||(this.y0=0);this.lat0||(this.lat0=0);this.long0||(this.long0=0)},forward:function(e){var t=e.x,n=e.y,r=Proj4js.common.adjust_lon(t-this.long0),i=this.x0+this.a*r*Math.cos(this.lat0),a=this.y0+this.a*n;this.t1=i;this.t2=Math.cos(this.lat0);e.x=i;e.y=a;return e},inverse:function(e){e.x-=this.x0;e.y-=this.y0;var t=e.y/this.a;Math.abs(t)>Proj4js.common.HALF_PI&&Proj4js.reportError("equi:Inv:DataError");var n=Proj4js.common.adjust_lon(this.long0+e.x/(this.a*Math.cos(this.lat0)));e.x=n;e.y=t}};Proj4js.Proj.merc={init:function(){this.lat_ts&&(this.k0=this.sphere?Math.cos(this.lat_ts):Proj4js.common.msfnz(this.es,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))},forward:function(e){var t=e.x,n=e.y;if(n*Proj4js.common.R2D>90&&n*Proj4js.common.R2D<-90&&t*Proj4js.common.R2D>180&&t*Proj4js.common.R2D<-180){Proj4js.reportError("merc:forward: llInputOutOfRange: "+t+" : "+n);return null}var r,i;if(Math.abs(Math.abs(n)-Proj4js.common.HALF_PI)<=Proj4js.common.EPSLN){Proj4js.reportError("merc:forward: ll2mAtPoles");return null}if(this.sphere){r=this.x0+this.a*this.k0*Proj4js.common.adjust_lon(t-this.long0);i=this.y0+this.a*this.k0*Math.log(Math.tan(Proj4js.common.FORTPI+.5*n))}else{var a=Math.sin(n),s=Proj4js.common.tsfnz(this.e,n,a);r=this.x0+this.a*this.k0*Proj4js.common.adjust_lon(t-this.long0);i=this.y0-this.a*this.k0*Math.log(s)}e.x=r;e.y=i;return e},inverse:function(e){var t,n,r=e.x-this.x0,i=e.y-this.y0;if(this.sphere)n=Proj4js.common.HALF_PI-2*Math.atan(Math.exp(-i/this.a*this.k0));else{var a=Math.exp(-i/(this.a*this.k0));n=Proj4js.common.phi2z(this.e,a);if(-9999==n){Proj4js.reportError("merc:inverse: lat = -9999");return null}}t=Proj4js.common.adjust_lon(this.long0+r/(this.a*this.k0));e.x=t;e.y=n;return e}};Proj4js.Proj.utm={dependsOn:"tmerc",init:function(){if(this.zone){this.lat0=0;this.long0=(6*Math.abs(this.zone)-183)*Proj4js.common.D2R;this.x0=5e5;this.y0=this.utmSouth?1e7:0;this.k0=.9996;Proj4js.Proj.tmerc.init.apply(this);this.forward=Proj4js.Proj.tmerc.forward;this.inverse=Proj4js.Proj.tmerc.inverse}else Proj4js.reportError("utm:init: zone must be specified for UTM")}};Proj4js.Proj.eqdc={init:function(){this.mode||(this.mode=0);this.temp=this.b/this.a;this.es=1-Math.pow(this.temp,2);this.e=Math.sqrt(this.es);this.e0=Proj4js.common.e0fn(this.es);this.e1=Proj4js.common.e1fn(this.es);this.e2=Proj4js.common.e2fn(this.es);this.e3=Proj4js.common.e3fn(this.es);this.sinphi=Math.sin(this.lat1);this.cosphi=Math.cos(this.lat1);this.ms1=Proj4js.common.msfnz(this.e,this.sinphi,this.cosphi);this.ml1=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat1);if(0!=this.mode){Math.abs(this.lat1+this.lat2)<Proj4js.common.EPSLN&&Proj4js.reportError("eqdc:Init:EqualLatitudes");this.sinphi=Math.sin(this.lat2);this.cosphi=Math.cos(this.lat2);this.ms2=Proj4js.common.msfnz(this.e,this.sinphi,this.cosphi);this.ml2=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat2);this.ns=Math.abs(this.lat1-this.lat2)>=Proj4js.common.EPSLN?(this.ms1-this.ms2)/(this.ml2-this.ml1):this.sinphi}else this.ns=this.sinphi;this.g=this.ml1+this.ms1/this.ns;this.ml0=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat0);this.rh=this.a*(this.g-this.ml0)},forward:function(e){var t=e.x,n=e.y,r=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,n),i=this.a*(this.g-r),a=this.ns*Proj4js.common.adjust_lon(t-this.long0),s=this.x0+i*Math.sin(a),o=this.y0+this.rh-i*Math.cos(a);e.x=s;e.y=o;return e},inverse:function(e){e.x-=this.x0;e.y=this.rh-e.y+this.y0;var t,n;if(this.ns>=0){n=Math.sqrt(e.x*e.x+e.y*e.y);t=1}else{n=-Math.sqrt(e.x*e.x+e.y*e.y);t=-1}var r=0;0!=n&&(r=Math.atan2(t*e.x,t*e.y));var i=this.g-n/this.a,a=this.phi3z(i,this.e0,this.e1,this.e2,this.e3),s=Proj4js.common.adjust_lon(this.long0+r/this.ns);e.x=s;e.y=a;return e},phi3z:function(e,t,n,r,i){var a,s;a=e;for(var o=0;15>o;o++){s=(e+n*Math.sin(2*a)-r*Math.sin(4*a)+i*Math.sin(6*a))/t-a;a+=s;if(Math.abs(s)<=1e-10)return a}Proj4js.reportError("PHI3Z-CONV:Latitude failed to converge after 15 iterations");return null}};Proj4js.Proj.tmerc={init:function(){this.e0=Proj4js.common.e0fn(this.es);this.e1=Proj4js.common.e1fn(this.es);this.e2=Proj4js.common.e2fn(this.es);this.e3=Proj4js.common.e3fn(this.es);this.ml0=this.a*Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat0)},forward:function(e){var t,n,r,i=e.x,a=e.y,s=Proj4js.common.adjust_lon(i-this.long0),o=Math.sin(a),l=Math.cos(a);if(this.sphere){var c=l*Math.sin(s);if(Math.abs(Math.abs(c)-1)<1e-10){Proj4js.reportError("tmerc:forward: Point projects into infinity");return 93}n=.5*this.a*this.k0*Math.log((1+c)/(1-c));t=Math.acos(l*Math.cos(s)/Math.sqrt(1-c*c));0>a&&(t=-t);r=this.a*this.k0*(t-this.lat0)}else{var u=l*s,h=Math.pow(u,2),p=this.ep2*Math.pow(l,2),d=Math.tan(a),f=Math.pow(d,2);t=1-this.es*Math.pow(o,2);var m=this.a/Math.sqrt(t),y=this.a*Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,a);n=this.k0*m*u*(1+h/6*(1-f+p+h/20*(5-18*f+Math.pow(f,2)+72*p-58*this.ep2)))+this.x0;r=this.k0*(y-this.ml0+m*d*h*(.5+h/24*(5-f+9*p+4*Math.pow(p,2)+h/30*(61-58*f+Math.pow(f,2)+600*p-330*this.ep2))))+this.y0}e.x=n;e.y=r;return e},inverse:function(e){var t,n,r,i,a,s,o=6;if(this.sphere){var l=Math.exp(e.x/(this.a*this.k0)),c=.5*(l-1/l),u=this.lat0+e.y/(this.a*this.k0),h=Math.cos(u);t=Math.sqrt((1-h*h)/(1+c*c));a=Proj4js.common.asinz(t);0>u&&(a=-a);s=0==c&&0==h?this.long0:Proj4js.common.adjust_lon(Math.atan2(c,h)+this.long0)}else{var p=e.x-this.x0,d=e.y-this.y0;t=(this.ml0+d/this.k0)/this.a;n=t;for(i=0;!0;i++){r=(t+this.e1*Math.sin(2*n)-this.e2*Math.sin(4*n)+this.e3*Math.sin(6*n))/this.e0-n;n+=r;if(Math.abs(r)<=Proj4js.common.EPSLN)break;if(i>=o){Proj4js.reportError("tmerc:inverse: Latitude failed to converge");return 95}}if(Math.abs(n)<Proj4js.common.HALF_PI){var f=Math.sin(n),m=Math.cos(n),y=Math.tan(n),g=this.ep2*Math.pow(m,2),v=Math.pow(g,2),C=Math.pow(y,2),L=Math.pow(C,2);t=1-this.es*Math.pow(f,2);var T=this.a/Math.sqrt(t),w=T*(1-this.es)/t,b=p/(T*this.k0),S=Math.pow(b,2);a=n-T*y*S/w*(.5-S/24*(5+3*C+10*g-4*v-9*this.ep2-S/30*(61+90*C+298*g+45*L-252*this.ep2-3*v)));s=Proj4js.common.adjust_lon(this.long0+b*(1-S/6*(1+2*C+g-S/20*(5-2*g+28*C-3*v+8*this.ep2+24*L)))/m)}else{a=Proj4js.common.HALF_PI*Proj4js.common.sign(d);s=this.long0}}e.x=s;e.y=a;return e}};Proj4js.defs.GOOGLE="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs";Proj4js.defs["EPSG:900913"]=Proj4js.defs.GOOGLE;Proj4js.Proj.gstmerc={init:function(){var e=this.b/this.a;this.e=Math.sqrt(1-e*e);this.lc=this.long0;this.rs=Math.sqrt(1+this.e*this.e*Math.pow(Math.cos(this.lat0),4)/(1-this.e*this.e));var t=Math.sin(this.lat0),n=Math.asin(t/this.rs),r=Math.sin(n);this.cp=Proj4js.common.latiso(0,n,r)-this.rs*Proj4js.common.latiso(this.e,this.lat0,t);this.n2=this.k0*this.a*Math.sqrt(1-this.e*this.e)/(1-this.e*this.e*t*t);this.xs=this.x0;this.ys=this.y0-this.n2*n;this.title||(this.title="Gauss Schreiber transverse mercator")},forward:function(e){var t=e.x,n=e.y,r=this.rs*(t-this.lc),i=this.cp+this.rs*Proj4js.common.latiso(this.e,n,Math.sin(n)),a=Math.asin(Math.sin(r)/Proj4js.common.cosh(i)),s=Proj4js.common.latiso(0,a,Math.sin(a));e.x=this.xs+this.n2*s;e.y=this.ys+this.n2*Math.atan(Proj4js.common.sinh(i)/Math.cos(r));return e},inverse:function(e){var t=e.x,n=e.y,r=Math.atan(Proj4js.common.sinh((t-this.xs)/this.n2)/Math.cos((n-this.ys)/this.n2)),i=Math.asin(Math.sin((n-this.ys)/this.n2)/Proj4js.common.cosh((t-this.xs)/this.n2)),a=Proj4js.common.latiso(0,i,Math.sin(i));e.x=this.lc+r/this.rs;e.y=Proj4js.common.invlatiso(this.e,(a-this.cp)/this.rs);return e}};Proj4js.Proj.ortho={init:function(e){this.sin_p14=Math.sin(this.lat0);this.cos_p14=Math.cos(this.lat0)},forward:function(e){var t,n,r,i,a,s,o=e.x,l=e.y;r=Proj4js.common.adjust_lon(o-this.long0);t=Math.sin(l);n=Math.cos(l);i=Math.cos(r);s=this.sin_p14*t+this.cos_p14*n*i;a=1;if(s>0||Math.abs(s)<=Proj4js.common.EPSLN)var c=this.a*a*n*Math.sin(r),u=this.y0+this.a*a*(this.cos_p14*t-this.sin_p14*n*i);else Proj4js.reportError("orthoFwdPointError");e.x=c;e.y=u;return e},inverse:function(e){var t,n,r,i,a,s,o;e.x-=this.x0;e.y-=this.y0;t=Math.sqrt(e.x*e.x+e.y*e.y);t>this.a+1e-7&&Proj4js.reportError("orthoInvDataError");n=Proj4js.common.asinz(t/this.a);r=Math.sin(n);i=Math.cos(n);s=this.long0;Math.abs(t)<=Proj4js.common.EPSLN&&(o=this.lat0);o=Proj4js.common.asinz(i*this.sin_p14+e.y*r*this.cos_p14/t);a=Math.abs(this.lat0)-Proj4js.common.HALF_PI;Math.abs(a)<=Proj4js.common.EPSLN&&(s=Proj4js.common.adjust_lon(this.lat0>=0?this.long0+Math.atan2(e.x,-e.y):this.long0-Math.atan2(-e.x,e.y)));a=i-this.sin_p14*Math.sin(o);e.x=s;e.y=o;return e}};Proj4js.Proj.krovak={init:function(){this.a=6377397.155;this.es=.006674372230614;this.e=Math.sqrt(this.es);this.lat0||(this.lat0=.863937979737193);this.long0||(this.long0=.4334234309119251);this.k0||(this.k0=.9999);this.s45=.785398163397448;this.s90=2*this.s45;this.fi0=this.lat0;this.e2=this.es;this.e=Math.sqrt(this.e2);this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2));this.uq=1.04216856380474;this.u0=Math.asin(Math.sin(this.fi0)/this.alfa);this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2);this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g;this.k1=this.k0;this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2));this.s0=1.37008346281555;this.n=Math.sin(this.s0);this.ro0=this.k1*this.n0/Math.tan(this.s0);this.ad=this.s90-this.uq},forward:function(e){var t,n,r,i,a,s,o,l=e.x,c=e.y,u=Proj4js.common.adjust_lon(l-this.long0);t=Math.pow((1+this.e*Math.sin(c))/(1-this.e*Math.sin(c)),this.alfa*this.e/2);n=2*(Math.atan(this.k*Math.pow(Math.tan(c/2+this.s45),this.alfa)/t)-this.s45);r=-u*this.alfa;i=Math.asin(Math.cos(this.ad)*Math.sin(n)+Math.sin(this.ad)*Math.cos(n)*Math.cos(r));a=Math.asin(Math.cos(n)*Math.sin(r)/Math.cos(i));s=this.n*a;o=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(i/2+this.s45),this.n);e.y=o*Math.cos(s)/1;e.x=o*Math.sin(s)/1;if(this.czech){e.y*=-1;e.x*=-1}return e},inverse:function(e){var t,n,r,i,a,s,o,l,c=e.x;e.x=e.y;e.y=c;if(this.czech){e.y*=-1;e.x*=-1}s=Math.sqrt(e.x*e.x+e.y*e.y);a=Math.atan2(e.y,e.x);i=a/Math.sin(this.s0);r=2*(Math.atan(Math.pow(this.ro0/s,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45);t=Math.asin(Math.cos(this.ad)*Math.sin(r)-Math.sin(this.ad)*Math.cos(r)*Math.cos(i));n=Math.asin(Math.cos(r)*Math.sin(i)/Math.cos(t));e.x=this.long0-n/this.alfa;o=t;l=0;var u=0;do{e.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(t/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(o))/(1-this.e*Math.sin(o)),this.e/2))-this.s45);Math.abs(o-e.y)<1e-10&&(l=1);o=e.y;u+=1}while(0==l&&15>u);if(u>=15){Proj4js.reportError("PHI3Z-CONV:Latitude failed to converge after 15 iterations");return null}return e}};Proj4js.Proj.somerc={init:function(){var e=this.lat0;this.lambda0=this.long0;var t=Math.sin(e),n=this.a,r=this.rf,i=1/r,a=2*i-Math.pow(i,2),s=this.e=Math.sqrt(a);this.R=this.k0*n*Math.sqrt(1-a)/(1-a*Math.pow(t,2));this.alpha=Math.sqrt(1+a/(1-a)*Math.pow(Math.cos(e),4));this.b0=Math.asin(t/this.alpha);this.K=Math.log(Math.tan(Math.PI/4+this.b0/2))-this.alpha*Math.log(Math.tan(Math.PI/4+e/2))+this.alpha*s/2*Math.log((1+s*t)/(1-s*t))},forward:function(e){var t=Math.log(Math.tan(Math.PI/4-e.y/2)),n=this.e/2*Math.log((1+this.e*Math.sin(e.y))/(1-this.e*Math.sin(e.y))),r=-this.alpha*(t+n)+this.K,i=2*(Math.atan(Math.exp(r))-Math.PI/4),a=this.alpha*(e.x-this.lambda0),s=Math.atan(Math.sin(a)/(Math.sin(this.b0)*Math.tan(i)+Math.cos(this.b0)*Math.cos(a))),o=Math.asin(Math.cos(this.b0)*Math.sin(i)-Math.sin(this.b0)*Math.cos(i)*Math.cos(a));e.y=this.R/2*Math.log((1+Math.sin(o))/(1-Math.sin(o)))+this.y0;e.x=this.R*s+this.x0;return e},inverse:function(e){for(var t=e.x-this.x0,n=e.y-this.y0,r=t/this.R,i=2*(Math.atan(Math.exp(n/this.R))-Math.PI/4),a=Math.asin(Math.cos(this.b0)*Math.sin(i)+Math.sin(this.b0)*Math.cos(i)*Math.cos(r)),s=Math.atan(Math.sin(r)/(Math.cos(this.b0)*Math.cos(r)-Math.sin(this.b0)*Math.tan(i))),o=this.lambda0+s/this.alpha,l=0,c=a,u=-1e3,h=0;Math.abs(c-u)>1e-7;){if(++h>20){Proj4js.reportError("omercFwdInfinity");return}l=1/this.alpha*(Math.log(Math.tan(Math.PI/4+a/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(c))/2));u=c;c=2*Math.atan(Math.exp(l))-Math.PI/2}e.x=o;e.y=c;return e}};Proj4js.Proj.stere={ssfn_:function(e,t,n){t*=n;return Math.tan(.5*(Proj4js.common.HALF_PI+e))*Math.pow((1-t)/(1+t),.5*n)},TOL:1e-8,NITER:8,CONV:1e-10,S_POLE:0,N_POLE:1,OBLIQ:2,EQUIT:3,init:function(){this.phits=this.lat_ts?this.lat_ts:Proj4js.common.HALF_PI;var e=Math.abs(this.lat0);this.mode=Math.abs(e)-Proj4js.common.HALF_PI<Proj4js.common.EPSLN?this.lat0<0?this.S_POLE:this.N_POLE:e>Proj4js.common.EPSLN?this.OBLIQ:this.EQUIT;this.phits=Math.abs(this.phits);if(this.es){var t;switch(this.mode){case this.N_POLE:case this.S_POLE:if(Math.abs(this.phits-Proj4js.common.HALF_PI)<Proj4js.common.EPSLN)this.akm1=2*this.k0/Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e));else{e=Math.sin(this.phits);this.akm1=Math.cos(this.phits)/Proj4js.common.tsfnz(this.e,this.phits,e);e*=this.e;this.akm1/=Math.sqrt(1-e*e)}break;case this.EQUIT:this.akm1=2*this.k0;break;case this.OBLIQ:e=Math.sin(this.lat0);t=2*Math.atan(this.ssfn_(this.lat0,e,this.e))-Proj4js.common.HALF_PI;e*=this.e;this.akm1=2*this.k0*Math.cos(this.lat0)/Math.sqrt(1-e*e);this.sinX1=Math.sin(t);this.cosX1=Math.cos(t)}}else switch(this.mode){case this.OBLIQ:this.sinph0=Math.sin(this.lat0);this.cosph0=Math.cos(this.lat0);case this.EQUIT:this.akm1=2*this.k0;break;case this.S_POLE:case this.N_POLE:this.akm1=Math.abs(this.phits-Proj4js.common.HALF_PI)>=Proj4js.common.EPSLN?Math.cos(this.phits)/Math.tan(Proj4js.common.FORTPI-.5*this.phits):2*this.k0}},forward:function(e){var t=e.x;t=Proj4js.common.adjust_lon(t-this.long0);var n,r,i=e.y;if(this.sphere){var a,s,o,l;a=Math.sin(i);s=Math.cos(i);o=Math.cos(t);l=Math.sin(t);switch(this.mode){case this.EQUIT:r=1+s*o;r<=Proj4js.common.EPSLN&&Proj4js.reportError("stere:forward:Equit");r=this.akm1/r;n=r*s*l;r*=a;break;case this.OBLIQ:r=1+this.sinph0*a+this.cosph0*s*o;r<=Proj4js.common.EPSLN&&Proj4js.reportError("stere:forward:Obliq");r=this.akm1/r;n=r*s*l;r*=this.cosph0*a-this.sinph0*s*o;break;case this.N_POLE:o=-o;i=-i;case this.S_POLE:Math.abs(i-Proj4js.common.HALF_PI)<this.TOL&&Proj4js.reportError("stere:forward:S_POLE");r=this.akm1*Math.tan(Proj4js.common.FORTPI+.5*i);n=l*r;r*=o}}else{o=Math.cos(t);l=Math.sin(t);a=Math.sin(i);var c,u;if(this.mode==this.OBLIQ||this.mode==this.EQUIT){var h=2*Math.atan(this.ssfn_(i,a,this.e));c=Math.sin(h-Proj4js.common.HALF_PI);u=Math.cos(h)}switch(this.mode){case this.OBLIQ:var p=this.akm1/(this.cosX1*(1+this.sinX1*c+this.cosX1*u*o));r=p*(this.cosX1*c-this.sinX1*u*o);n=p*u;break;case this.EQUIT:var p=2*this.akm1/(1+u*o);r=p*c;n=p*u;break;case this.S_POLE:i=-i;o=-o;a=-a;case this.N_POLE:n=this.akm1*Proj4js.common.tsfnz(this.e,i,a);r=-n*o}n*=l}e.x=n*this.a+this.x0;e.y=r*this.a+this.y0;return e},inverse:function(e){var t,n,r,i,a,s,o=(e.x-this.x0)/this.a,l=(e.y-this.y0)/this.a,c=0,u=0,h=0,p=0;if(this.sphere){var d,f,m,y;f=Math.sqrt(o*o+l*l);d=2*Math.atan(f/this.akm1);m=Math.sin(d);y=Math.cos(d);t=0;switch(this.mode){case this.EQUIT:n=Math.abs(f)<=Proj4js.common.EPSLN?0:Math.asin(l*m/f);(0!=y||0!=o)&&(t=Math.atan2(o*m,y*f));break;case this.OBLIQ:n=Math.abs(f)<=Proj4js.common.EPSLN?this.phi0:Math.asin(y*this.sinph0+l*m*this.cosph0/f);d=y-this.sinph0*Math.sin(n);(0!=d||0!=o)&&(t=Math.atan2(o*m*this.cosph0,d*f));break;case this.N_POLE:l=-l;case this.S_POLE:n=Math.abs(f)<=Proj4js.common.EPSLN?this.phi0:Math.asin(this.mode==this.S_POLE?-y:y);t=0==o&&0==l?0:Math.atan2(o,l)}e.x=Proj4js.common.adjust_lon(t+this.long0);e.y=n}else{a=Math.sqrt(o*o+l*l);switch(this.mode){case this.OBLIQ:case this.EQUIT:c=2*Math.atan2(a*this.cosX1,this.akm1);r=Math.cos(c);i=Math.sin(c);u=Math.asin(0==a?r*this.sinX1:r*this.sinX1+l*i*this.cosX1/a);c=Math.tan(.5*(Proj4js.common.HALF_PI+u));o*=i;l=a*this.cosX1*r-l*this.sinX1*i;p=Proj4js.common.HALF_PI;h=.5*this.e;break;case this.N_POLE:l=-l;case this.S_POLE:c=-a/this.akm1;u=Proj4js.common.HALF_PI-2*Math.atan(c);p=-Proj4js.common.HALF_PI;h=-.5*this.e}for(s=this.NITER;s--;u=n){i=this.e*Math.sin(u);n=2*Math.atan(c*Math.pow((1+i)/(1-i),h))-p;if(Math.abs(u-n)<this.CONV){this.mode==this.S_POLE&&(n=-n);t=0==o&&0==l?0:Math.atan2(o,l);e.x=Proj4js.common.adjust_lon(t+this.long0);e.y=n;return e}}}}};Proj4js.Proj.nzmg={iterations:1,init:function(){this.A=new Array;this.A[1]=.6399175073;this.A[2]=-.1358797613;this.A[3]=.063294409;this.A[4]=-.02526853;this.A[5]=.0117879;this.A[6]=-.0055161;this.A[7]=.0026906;this.A[8]=-.001333;this.A[9]=67e-5;this.A[10]=-34e-5;this.B_re=new Array;this.B_im=new Array;this.B_re[1]=.7557853228;this.B_im[1]=0;this.B_re[2]=.249204646;this.B_im[2]=.003371507;this.B_re[3]=-.001541739;this.B_im[3]=.04105856;this.B_re[4]=-.10162907;this.B_im[4]=.01727609;this.B_re[5]=-.26623489;this.B_im[5]=-.36249218;this.B_re[6]=-.6870983;this.B_im[6]=-1.1651967;this.C_re=new Array;this.C_im=new Array;this.C_re[1]=1.3231270439;this.C_im[1]=0;this.C_re[2]=-.577245789;this.C_im[2]=-.007809598;this.C_re[3]=.508307513;this.C_im[3]=-.112208952;this.C_re[4]=-.15094762;this.C_im[4]=.18200602;this.C_re[5]=1.01418179;this.C_im[5]=1.64497696;this.C_re[6]=1.9660549;this.C_im[6]=2.5127645;this.D=new Array;this.D[1]=1.5627014243;this.D[2]=.5185406398;this.D[3]=-.03333098;this.D[4]=-.1052906;this.D[5]=-.0368594;this.D[6]=.007317;this.D[7]=.0122;this.D[8]=.00394;this.D[9]=-.0013},forward:function(e){for(var t=e.x,n=e.y,r=n-this.lat0,i=t-this.long0,a=r/Proj4js.common.SEC_TO_RAD*1e-5,s=i,o=1,l=0,c=1;10>=c;c++){o*=a;l+=this.A[c]*o}for(var u,h,p=l,d=s,f=1,m=0,y=0,g=0,c=1;6>=c;c++){u=f*p-m*d;h=m*p+f*d;f=u;m=h;y=y+this.B_re[c]*f-this.B_im[c]*m;g=g+this.B_im[c]*f+this.B_re[c]*m}e.x=g*this.a+this.x0;e.y=y*this.a+this.y0;return e},inverse:function(e){for(var t,n,r=e.x,i=e.y,a=r-this.x0,s=i-this.y0,o=s/this.a,l=a/this.a,c=1,u=0,h=0,p=0,d=1;6>=d;d++){t=c*o-u*l;n=u*o+c*l;c=t;u=n;h=h+this.C_re[d]*c-this.C_im[d]*u;p=p+this.C_im[d]*c+this.C_re[d]*u}for(var f=0;f<this.iterations;f++){for(var m,y,g=h,v=p,C=o,L=l,d=2;6>=d;d++){m=g*h-v*p;y=v*h+g*p;g=m;v=y;C+=(d-1)*(this.B_re[d]*g-this.B_im[d]*v);L+=(d-1)*(this.B_im[d]*g+this.B_re[d]*v)}g=1;v=0;for(var T=this.B_re[1],w=this.B_im[1],d=2;6>=d;d++){m=g*h-v*p;y=v*h+g*p;g=m;v=y;T+=d*(this.B_re[d]*g-this.B_im[d]*v);w+=d*(this.B_im[d]*g+this.B_re[d]*v)}var b=T*T+w*w;h=(C*T+L*w)/b;p=(L*T-C*w)/b}for(var S=h,E=p,O=1,A=0,d=1;9>=d;d++){O*=S;A+=this.D[d]*O}var x=this.lat0+A*Proj4js.common.SEC_TO_RAD*1e5,P=this.long0+E;e.x=P;e.y=x;return e}};Proj4js.Proj.mill={init:function(){},forward:function(e){var t=e.x,n=e.y,r=Proj4js.common.adjust_lon(t-this.long0),i=this.x0+this.a*r,a=this.y0+this.a*Math.log(Math.tan(Proj4js.common.PI/4+n/2.5))*1.25;e.x=i;e.y=a;return e},inverse:function(e){e.x-=this.x0;e.y-=this.y0;var t=Proj4js.common.adjust_lon(this.long0+e.x/this.a),n=2.5*(Math.atan(Math.exp(.8*e.y/this.a))-Proj4js.common.PI/4);e.x=t;e.y=n;return e}};Proj4js.Proj.gnom={init:function(e){this.sin_p14=Math.sin(this.lat0);this.cos_p14=Math.cos(this.lat0);this.infinity_dist=1e3*this.a;this.rc=1},forward:function(e){var t,n,r,i,a,s,o,l,c=e.x,u=e.y;r=Proj4js.common.adjust_lon(c-this.long0);t=Math.sin(u);n=Math.cos(u);i=Math.cos(r);s=this.sin_p14*t+this.cos_p14*n*i;a=1;if(s>0||Math.abs(s)<=Proj4js.common.EPSLN){o=this.x0+this.a*a*n*Math.sin(r)/s;l=this.y0+this.a*a*(this.cos_p14*t-this.sin_p14*n*i)/s}else{Proj4js.reportError("orthoFwdPointError");o=this.x0+this.infinity_dist*n*Math.sin(r);l=this.y0+this.infinity_dist*(this.cos_p14*t-this.sin_p14*n*i)}e.x=o;e.y=l;return e},inverse:function(e){var t,n,r,i,a,s;e.x=(e.x-this.x0)/this.a;e.y=(e.y-this.y0)/this.a;e.x/=this.k0;e.y/=this.k0;if(t=Math.sqrt(e.x*e.x+e.y*e.y)){i=Math.atan2(t,this.rc);n=Math.sin(i);r=Math.cos(i);s=Proj4js.common.asinz(r*this.sin_p14+e.y*n*this.cos_p14/t);a=Math.atan2(e.x*n,t*this.cos_p14*r-e.y*this.sin_p14*n);a=Proj4js.common.adjust_lon(this.long0+a)}else{s=this.phic0;a=0}e.x=a;e.y=s;return e}};Proj4js.Proj.sinu={init:function(){if(this.sphere){this.n=1;this.m=0;this.es=0;this.C_y=Math.sqrt((this.m+1)/this.n);this.C_x=this.C_y/(this.m+1)}else this.en=Proj4js.common.pj_enfn(this.es)},forward:function(e){var t,n,r=e.x,i=e.y;r=Proj4js.common.adjust_lon(r-this.long0);if(this.sphere){if(this.m)for(var a=this.n*Math.sin(i),s=Proj4js.common.MAX_ITER;s;--s){var o=(this.m*i+Math.sin(i)-a)/(this.m+Math.cos(i));i-=o;if(Math.abs(o)<Proj4js.common.EPSLN)break}else i=1!=this.n?Math.asin(this.n*Math.sin(i)):i;t=this.a*this.C_x*r*(this.m+Math.cos(i));n=this.a*this.C_y*i}else{var l=Math.sin(i),c=Math.cos(i);n=this.a*Proj4js.common.pj_mlfn(i,l,c,this.en);t=this.a*r*c/Math.sqrt(1-this.es*l*l)}e.x=t;e.y=n;return e},inverse:function(e){var t,n,r;e.x-=this.x0;e.y-=this.y0;t=e.y/this.a;if(this.sphere){e.y/=this.C_y;t=this.m?Math.asin((this.m*e.y+Math.sin(e.y))/this.n):1!=this.n?Math.asin(Math.sin(e.y)/this.n):e.y;r=e.x/(this.C_x*(this.m+Math.cos(e.y)))}else{t=Proj4js.common.pj_inv_mlfn(e.y/this.a,this.es,this.en);var i=Math.abs(t);if(i<Proj4js.common.HALF_PI){i=Math.sin(t);n=this.long0+e.x*Math.sqrt(1-this.es*i*i)/(this.a*Math.cos(t));r=Proj4js.common.adjust_lon(n)}else i-Proj4js.common.EPSLN<Proj4js.common.HALF_PI&&(r=this.long0)}e.x=r;e.y=t;return e}};Proj4js.Proj.vandg={init:function(){this.R=6370997},forward:function(e){var t,n,r=e.x,i=e.y,a=Proj4js.common.adjust_lon(r-this.long0);if(Math.abs(i)<=Proj4js.common.EPSLN){t=this.x0+this.R*a;n=this.y0}var s=Proj4js.common.asinz(2*Math.abs(i/Proj4js.common.PI));if(Math.abs(a)<=Proj4js.common.EPSLN||Math.abs(Math.abs(i)-Proj4js.common.HALF_PI)<=Proj4js.common.EPSLN){t=this.x0;n=i>=0?this.y0+Proj4js.common.PI*this.R*Math.tan(.5*s):this.y0+Proj4js.common.PI*this.R*-Math.tan(.5*s)}var o=.5*Math.abs(Proj4js.common.PI/a-a/Proj4js.common.PI),l=o*o,c=Math.sin(s),u=Math.cos(s),h=u/(c+u-1),p=h*h,d=h*(2/c-1),f=d*d,m=Proj4js.common.PI*this.R*(o*(h-f)+Math.sqrt(l*(h-f)*(h-f)-(f+l)*(p-f)))/(f+l);0>a&&(m=-m);t=this.x0+m;m=Math.abs(m/(Proj4js.common.PI*this.R));n=i>=0?this.y0+Proj4js.common.PI*this.R*Math.sqrt(1-m*m-2*o*m):this.y0-Proj4js.common.PI*this.R*Math.sqrt(1-m*m-2*o*m);e.x=t;e.y=n;return e},inverse:function(e){var t,n,r,i,a,s,o,l,c,u,h,p,d;e.x-=this.x0;e.y-=this.y0;h=Proj4js.common.PI*this.R;r=e.x/h;i=e.y/h;a=r*r+i*i;s=-Math.abs(i)*(1+a);o=s-2*i*i+r*r;l=-2*s+1+2*i*i+a*a;d=i*i/l+(2*o*o*o/l/l/l-9*s*o/l/l)/27;c=(s-o*o/3/l)/l;u=2*Math.sqrt(-c/3);h=3*d/c/u;Math.abs(h)>1&&(h=h>=0?1:-1);p=Math.acos(h)/3;n=e.y>=0?(-u*Math.cos(p+Proj4js.common.PI/3)-o/3/l)*Proj4js.common.PI:-(-u*Math.cos(p+Proj4js.common.PI/3)-o/3/l)*Proj4js.common.PI;Math.abs(r)<Proj4js.common.EPSLN&&(t=this.long0);t=Proj4js.common.adjust_lon(this.long0+Proj4js.common.PI*(a-1+Math.sqrt(1+2*(r*r-i*i)+a*a))/2/r);e.x=t;e.y=n;return e}};Proj4js.Proj.cea={init:function(){},forward:function(e){var t=e.x,n=e.y,r=Proj4js.common.adjust_lon(t-this.long0),i=this.x0+this.a*r*Math.cos(this.lat_ts),a=this.y0+this.a*Math.sin(n)/Math.cos(this.lat_ts);e.x=i;e.y=a;return e},inverse:function(e){e.x-=this.x0;e.y-=this.y0;var t=Proj4js.common.adjust_lon(this.long0+e.x/this.a/Math.cos(this.lat_ts)),n=Math.asin(e.y/this.a*Math.cos(this.lat_ts));e.x=t;e.y=n;return e}};Proj4js.Proj.eqc={init:function(){this.x0||(this.x0=0);this.y0||(this.y0=0);this.lat0||(this.lat0=0);this.long0||(this.long0=0);this.lat_ts||(this.lat_ts=0);this.title||(this.title="Equidistant Cylindrical (Plate Carre)");this.rc=Math.cos(this.lat_ts)},forward:function(e){var t=e.x,n=e.y,r=Proj4js.common.adjust_lon(t-this.long0),i=Proj4js.common.adjust_lat(n-this.lat0);e.x=this.x0+this.a*r*this.rc;e.y=this.y0+this.a*i;return e},inverse:function(e){var t=e.x,n=e.y;e.x=Proj4js.common.adjust_lon(this.long0+(t-this.x0)/(this.a*this.rc));e.y=Proj4js.common.adjust_lat(this.lat0+(n-this.y0)/this.a);return e}};Proj4js.Proj.cass={init:function(){if(!this.sphere){this.en=Proj4js.common.pj_enfn(this.es);this.m0=Proj4js.common.pj_mlfn(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en)}},C1:.16666666666666666,C2:.008333333333333333,C3:.041666666666666664,C4:.3333333333333333,C5:.06666666666666667,forward:function(e){var t,n,r=e.x,i=e.y;r=Proj4js.common.adjust_lon(r-this.long0);if(this.sphere){t=Math.asin(Math.cos(i)*Math.sin(r));n=Math.atan2(Math.tan(i),Math.cos(r))-this.phi0}else{this.n=Math.sin(i);this.c=Math.cos(i);n=Proj4js.common.pj_mlfn(i,this.n,this.c,this.en);this.n=1/Math.sqrt(1-this.es*this.n*this.n);this.tn=Math.tan(i);this.t=this.tn*this.tn;this.a1=r*this.c;this.c*=this.es*this.c/(1-this.es);this.a2=this.a1*this.a1;t=this.n*this.a1*(1-this.a2*this.t*(this.C1-(8-this.t+8*this.c)*this.a2*this.C2));n-=this.m0-this.n*this.tn*this.a2*(.5+(5-this.t+6*this.c)*this.a2*this.C3)}e.x=this.a*t+this.x0;e.y=this.a*n+this.y0;return e},inverse:function(e){e.x-=this.x0;e.y-=this.y0;var t,n,r=e.x/this.a,i=e.y/this.a;if(this.sphere){this.dd=i+this.lat0;t=Math.asin(Math.sin(this.dd)*Math.cos(r));n=Math.atan2(Math.tan(r),Math.cos(this.dd))}else{var a=Proj4js.common.pj_inv_mlfn(this.m0+i,this.es,this.en);this.tn=Math.tan(a);this.t=this.tn*this.tn;this.n=Math.sin(a);this.r=1/(1-this.es*this.n*this.n);this.n=Math.sqrt(this.r);this.r*=(1-this.es)*this.n;this.dd=r/this.n;this.d2=this.dd*this.dd;t=a-this.n*this.tn/this.r*this.d2*(.5-(1+3*this.t)*this.d2*this.C3);n=this.dd*(1+this.t*this.d2*(-this.C4+(1+3*this.t)*this.d2*this.C5))/Math.cos(a)}e.x=Proj4js.common.adjust_lon(this.long0+n);e.y=t;return e}};Proj4js.Proj.gauss={init:function(){var e=Math.sin(this.lat0),t=Math.cos(this.lat0);t*=t;this.rc=Math.sqrt(1-this.es)/(1-this.es*e*e);this.C=Math.sqrt(1+this.es*t*t/(1-this.es));this.phic0=Math.asin(e/this.C);this.ratexp=.5*this.C*this.e;this.K=Math.tan(.5*this.phic0+Proj4js.common.FORTPI)/(Math.pow(Math.tan(.5*this.lat0+Proj4js.common.FORTPI),this.C)*Proj4js.common.srat(this.e*e,this.ratexp))},forward:function(e){var t=e.x,n=e.y;e.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*n+Proj4js.common.FORTPI),this.C)*Proj4js.common.srat(this.e*Math.sin(n),this.ratexp))-Proj4js.common.HALF_PI;e.x=this.C*t;return e},inverse:function(e){for(var t=1e-14,n=e.x/this.C,r=e.y,i=Math.pow(Math.tan(.5*r+Proj4js.common.FORTPI)/this.K,1/this.C),a=Proj4js.common.MAX_ITER;a>0;--a){r=2*Math.atan(i*Proj4js.common.srat(this.e*Math.sin(e.y),-.5*this.e))-Proj4js.common.HALF_PI;if(Math.abs(r-e.y)<t)break;e.y=r}if(!a){Proj4js.reportError("gauss:inverse:convergence failed");return null}e.x=n;e.y=r;return e}};Proj4js.Proj.omerc={init:function(){this.mode||(this.mode=0);if(!this.lon1){this.lon1=0;this.mode=1}this.lon2||(this.lon2=0);this.lat2||(this.lat2=0);{var e=this.b/this.a,t=1-Math.pow(e,2);Math.sqrt(t)}this.sin_p20=Math.sin(this.lat0);this.cos_p20=Math.cos(this.lat0);

this.con=1-this.es*this.sin_p20*this.sin_p20;this.com=Math.sqrt(1-t);this.bl=Math.sqrt(1+this.es*Math.pow(this.cos_p20,4)/(1-t));this.al=this.a*this.bl*this.k0*this.com/this.con;if(Math.abs(this.lat0)<Proj4js.common.EPSLN){this.ts=1;this.d=1;this.el=1}else{this.ts=Proj4js.common.tsfnz(this.e,this.lat0,this.sin_p20);this.con=Math.sqrt(this.con);this.d=this.bl*this.com/(this.cos_p20*this.con);this.f=this.d*this.d-1>0?this.lat0>=0?this.d+Math.sqrt(this.d*this.d-1):this.d-Math.sqrt(this.d*this.d-1):this.d;this.el=this.f*Math.pow(this.ts,this.bl)}if(0!=this.mode){this.g=.5*(this.f-1/this.f);this.gama=Proj4js.common.asinz(Math.sin(this.alpha)/this.d);this.longc=this.longc-Proj4js.common.asinz(this.g*Math.tan(this.gama))/this.bl;this.con=Math.abs(this.lat0);if(this.con>Proj4js.common.EPSLN&&Math.abs(this.con-Proj4js.common.HALF_PI)>Proj4js.common.EPSLN){this.singam=Math.sin(this.gama);this.cosgam=Math.cos(this.gama);this.sinaz=Math.sin(this.alpha);this.cosaz=Math.cos(this.alpha);this.u=this.lat0>=0?this.al/this.bl*Math.atan(Math.sqrt(this.d*this.d-1)/this.cosaz):-(this.al/this.bl)*Math.atan(Math.sqrt(this.d*this.d-1)/this.cosaz)}else Proj4js.reportError("omerc:Init:DataError")}else{this.sinphi=Math.sin(this.at1);this.ts1=Proj4js.common.tsfnz(this.e,this.lat1,this.sinphi);this.sinphi=Math.sin(this.lat2);this.ts2=Proj4js.common.tsfnz(this.e,this.lat2,this.sinphi);this.h=Math.pow(this.ts1,this.bl);this.l=Math.pow(this.ts2,this.bl);this.f=this.el/this.h;this.g=.5*(this.f-1/this.f);this.j=(this.el*this.el-this.l*this.h)/(this.el*this.el+this.l*this.h);this.p=(this.l-this.h)/(this.l+this.h);this.dlon=this.lon1-this.lon2;this.dlon<-Proj4js.common.PI&&(this.lon2=this.lon2-2*Proj4js.common.PI);this.dlon>Proj4js.common.PI&&(this.lon2=this.lon2+2*Proj4js.common.PI);this.dlon=this.lon1-this.lon2;this.longc=.5*(this.lon1+this.lon2)-Math.atan(this.j*Math.tan(.5*this.bl*this.dlon)/this.p)/this.bl;this.dlon=Proj4js.common.adjust_lon(this.lon1-this.longc);this.gama=Math.atan(Math.sin(this.bl*this.dlon)/this.g);this.alpha=Proj4js.common.asinz(this.d*Math.sin(this.gama));Math.abs(this.lat1-this.lat2)<=Proj4js.common.EPSLN?Proj4js.reportError("omercInitDataError"):this.con=Math.abs(this.lat1);this.con<=Proj4js.common.EPSLN||Math.abs(this.con-Proj4js.common.HALF_PI)<=Proj4js.common.EPSLN?Proj4js.reportError("omercInitDataError"):Math.abs(Math.abs(this.lat0)-Proj4js.common.HALF_PI)<=Proj4js.common.EPSLN&&Proj4js.reportError("omercInitDataError");this.singam=Math.sin(this.gam);this.cosgam=Math.cos(this.gam);this.sinaz=Math.sin(this.alpha);this.cosaz=Math.cos(this.alpha);this.u=this.lat0>=0?this.al/this.bl*Math.atan(Math.sqrt(this.d*this.d-1)/this.cosaz):-(this.al/this.bl)*Math.atan(Math.sqrt(this.d*this.d-1)/this.cosaz)}},forward:function(e){var t,n,r,i,a,s,o,l,c,u,h,p=e.x,d=e.y;t=Math.sin(d);u=Proj4js.common.adjust_lon(p-this.longc);s=Math.sin(this.bl*u);if(Math.abs(Math.abs(d)-Proj4js.common.HALF_PI)>Proj4js.common.EPSLN){h=Proj4js.common.tsfnz(this.e,d,t);i=this.el/Math.pow(h,this.bl);c=.5*(i-1/i);n=.5*(i+1/i);o=(c*this.singam-s*this.cosgam)/n;r=Math.cos(this.bl*u);if(Math.abs(r)<1e-7)a=this.al*this.bl*u;else{a=this.al*Math.atan((c*this.cosgam+s*this.singam)/r)/this.bl;0>r&&(a+=Proj4js.common.PI*this.al/this.bl)}}else{o=d>=0?this.singam:-this.singam;a=this.al*d/this.bl}Math.abs(Math.abs(o)-1)<=Proj4js.common.EPSLN&&Proj4js.reportError("omercFwdInfinity");l=.5*this.al*Math.log((1-o)/(1+o))/this.bl;a-=this.u;var f=this.x0+l*this.cosaz+a*this.sinaz,m=this.y0+a*this.cosaz-l*this.sinaz;e.x=f;e.y=m;return e},inverse:function(e){var t,n,r,i,a,s,o,l,c,u,h,p,d;e.x-=this.x0;e.y-=this.y0;d=0;i=e.x*this.cosaz-e.y*this.sinaz;a=e.y*this.cosaz+e.x*this.sinaz;a+=this.u;s=Math.exp(-this.bl*i/this.al);o=.5*(s-1/s);n=.5*(s+1/s);c=Math.sin(this.bl*a/this.al);u=(c*this.cosgam+o*this.singam)/n;if(Math.abs(Math.abs(u)-1)<=Proj4js.common.EPSLN){h=this.longc;p=u>=0?Proj4js.common.HALF_PI:-Proj4js.common.HALF_PI}else{r=1/this.bl;l=Math.pow(this.el/Math.sqrt((1+u)/(1-u)),r);p=Proj4js.common.phi2z(this.e,l);t=this.longc-Math.atan2(o*this.cosgam-c*this.singam,r)/this.bl;h=Proj4js.common.adjust_lon(t)}e.x=h;e.y=p;return e}};Proj4js.Proj.lcc={init:function(){this.lat2||(this.lat2=this.lat0);this.k0||(this.k0=1);if(Math.abs(this.lat1+this.lat2)<Proj4js.common.EPSLN)Proj4js.reportError("lcc:init: Equal Latitudes");else{var e=this.b/this.a;this.e=Math.sqrt(1-e*e);var t=Math.sin(this.lat1),n=Math.cos(this.lat1),r=Proj4js.common.msfnz(this.e,t,n),i=Proj4js.common.tsfnz(this.e,this.lat1,t),a=Math.sin(this.lat2),s=Math.cos(this.lat2),o=Proj4js.common.msfnz(this.e,a,s),l=Proj4js.common.tsfnz(this.e,this.lat2,a),c=Proj4js.common.tsfnz(this.e,this.lat0,Math.sin(this.lat0));this.ns=Math.abs(this.lat1-this.lat2)>Proj4js.common.EPSLN?Math.log(r/o)/Math.log(i/l):t;this.f0=r/(this.ns*Math.pow(i,this.ns));this.rh=this.a*this.f0*Math.pow(c,this.ns);this.title||(this.title="Lambert Conformal Conic")}},forward:function(e){var t=e.x,n=e.y;if(!(90>=n&&n>=-90&&180>=t&&t>=-180)){Proj4js.reportError("lcc:forward: llInputOutOfRange: "+t+" : "+n);return null}var r,i,a=Math.abs(Math.abs(n)-Proj4js.common.HALF_PI);if(a>Proj4js.common.EPSLN){r=Proj4js.common.tsfnz(this.e,n,Math.sin(n));i=this.a*this.f0*Math.pow(r,this.ns)}else{a=n*this.ns;if(0>=a){Proj4js.reportError("lcc:forward: No Projection");return null}i=0}var s=this.ns*Proj4js.common.adjust_lon(t-this.long0);e.x=this.k0*i*Math.sin(s)+this.x0;e.y=this.k0*(this.rh-i*Math.cos(s))+this.y0;return e},inverse:function(e){var t,n,r,i,a,s=(e.x-this.x0)/this.k0,o=this.rh-(e.y-this.y0)/this.k0;if(this.ns>0){t=Math.sqrt(s*s+o*o);n=1}else{t=-Math.sqrt(s*s+o*o);n=-1}var l=0;0!=t&&(l=Math.atan2(n*s,n*o));if(0!=t||this.ns>0){n=1/this.ns;r=Math.pow(t/(this.a*this.f0),n);i=Proj4js.common.phi2z(this.e,r);if(-9999==i)return null}else i=-Proj4js.common.HALF_PI;a=Proj4js.common.adjust_lon(l/this.ns+this.long0);e.x=a;e.y=i;return e}};Proj4js.Proj.laea={S_POLE:1,N_POLE:2,EQUIT:3,OBLIQ:4,init:function(){var e=Math.abs(this.lat0);this.mode=Math.abs(e-Proj4js.common.HALF_PI)<Proj4js.common.EPSLN?this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(e)<Proj4js.common.EPSLN?this.EQUIT:this.OBLIQ;if(this.es>0){var t;this.qp=Proj4js.common.qsfnz(this.e,1);this.mmf=.5/(1-this.es);this.apa=this.authset(this.es);switch(this.mode){case this.N_POLE:case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp);this.dd=1/this.rq;this.xmf=1;this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp);t=Math.sin(this.lat0);this.sinb1=Proj4js.common.qsfnz(this.e,t)/this.qp;this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1);this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*t*t)*this.rq*this.cosb1);this.ymf=(this.xmf=this.rq)/this.dd;this.xmf*=this.dd}}else if(this.mode==this.OBLIQ){this.sinph0=Math.sin(this.lat0);this.cosph0=Math.cos(this.lat0)}},forward:function(e){var t,n,r=e.x,i=e.y;r=Proj4js.common.adjust_lon(r-this.long0);if(this.sphere){var a,s,o;o=Math.sin(i);s=Math.cos(i);a=Math.cos(r);switch(this.mode){case this.OBLIQ:case this.EQUIT:n=this.mode==this.EQUIT?1+s*a:1+this.sinph0*o+this.cosph0*s*a;if(n<=Proj4js.common.EPSLN){Proj4js.reportError("laea:fwd:y less than eps");return null}n=Math.sqrt(2/n);t=n*s*Math.sin(r);n*=this.mode==this.EQUIT?o:this.cosph0*o-this.sinph0*s*a;break;case this.N_POLE:a=-a;case this.S_POLE:if(Math.abs(i+this.phi0)<Proj4js.common.EPSLN){Proj4js.reportError("laea:fwd:phi < eps");return null}n=Proj4js.common.FORTPI-.5*i;n=2*(this.mode==this.S_POLE?Math.cos(n):Math.sin(n));t=n*Math.sin(r);n*=a}}else{var a,l,o,c,u=0,h=0,p=0;a=Math.cos(r);l=Math.sin(r);o=Math.sin(i);c=Proj4js.common.qsfnz(this.e,o);if(this.mode==this.OBLIQ||this.mode==this.EQUIT){u=c/this.qp;h=Math.sqrt(1-u*u)}switch(this.mode){case this.OBLIQ:p=1+this.sinb1*u+this.cosb1*h*a;break;case this.EQUIT:p=1+h*a;break;case this.N_POLE:p=Proj4js.common.HALF_PI+i;c=this.qp-c;break;case this.S_POLE:p=i-Proj4js.common.HALF_PI;c=this.qp+c}if(Math.abs(p)<Proj4js.common.EPSLN){Proj4js.reportError("laea:fwd:b < eps");return null}switch(this.mode){case this.OBLIQ:case this.EQUIT:p=Math.sqrt(2/p);n=this.mode==this.OBLIQ?this.ymf*p*(this.cosb1*u-this.sinb1*h*a):(p=Math.sqrt(2/(1+h*a)))*u*this.ymf;t=this.xmf*p*h*l;break;case this.N_POLE:case this.S_POLE:if(c>=0){t=(p=Math.sqrt(c))*l;n=a*(this.mode==this.S_POLE?p:-p)}else t=n=0}}e.x=this.a*t+this.x0;e.y=this.a*n+this.y0;return e},inverse:function(e){e.x-=this.x0;e.y-=this.y0;var t,n,r=e.x/this.a,i=e.y/this.a;if(this.sphere){var a,s=0,o=0;a=Math.sqrt(r*r+i*i);n=.5*a;if(n>1){Proj4js.reportError("laea:Inv:DataError");return null}n=2*Math.asin(n);if(this.mode==this.OBLIQ||this.mode==this.EQUIT){o=Math.sin(n);s=Math.cos(n)}switch(this.mode){case this.EQUIT:n=Math.abs(a)<=Proj4js.common.EPSLN?0:Math.asin(i*o/a);r*=o;i=s*a;break;case this.OBLIQ:n=Math.abs(a)<=Proj4js.common.EPSLN?this.phi0:Math.asin(s*this.sinph0+i*o*this.cosph0/a);r*=o*this.cosph0;i=(s-Math.sin(n)*this.sinph0)*a;break;case this.N_POLE:i=-i;n=Proj4js.common.HALF_PI-n;break;case this.S_POLE:n-=Proj4js.common.HALF_PI}t=0!=i||this.mode!=this.EQUIT&&this.mode!=this.OBLIQ?Math.atan2(r,i):0}else{var l,c,u,h,p=0;switch(this.mode){case this.EQUIT:case this.OBLIQ:r/=this.dd;i*=this.dd;h=Math.sqrt(r*r+i*i);if(h<Proj4js.common.EPSLN){e.x=0;e.y=this.phi0;return e}c=2*Math.asin(.5*h/this.rq);l=Math.cos(c);r*=c=Math.sin(c);if(this.mode==this.OBLIQ){p=l*this.sinb1+i*c*this.cosb1/h;u=this.qp*p;i=h*this.cosb1*l-i*this.sinb1*c}else{p=i*c/h;u=this.qp*p;i=h*l}break;case this.N_POLE:i=-i;case this.S_POLE:u=r*r+i*i;if(!u){e.x=0;e.y=this.phi0;return e}p=1-u/this.qp;this.mode==this.S_POLE&&(p=-p)}t=Math.atan2(r,i);n=this.authlat(Math.asin(p),this.apa)}e.x=Proj4js.common.adjust_lon(this.long0+t);e.y=n;return e},P00:.3333333333333333,P01:.17222222222222222,P02:.10257936507936508,P10:.06388888888888888,P11:.0664021164021164,P20:.016415012942191543,authset:function(e){var t,n=new Array;n[0]=e*this.P00;t=e*e;n[0]+=t*this.P01;n[1]=t*this.P10;t*=e;n[0]+=t*this.P02;n[1]+=t*this.P11;n[2]=t*this.P20;return n},authlat:function(e,t){var n=e+e;return e+t[0]*Math.sin(n)+t[1]*Math.sin(n+n)+t[2]*Math.sin(n+n+n)}};Proj4js.Proj.aeqd={init:function(){this.sin_p12=Math.sin(this.lat0);this.cos_p12=Math.cos(this.lat0)},forward:function(e){var t,n=e.x,r=(e.y,Math.sin(e.y)),i=Math.cos(e.y),a=Proj4js.common.adjust_lon(n-this.long0),s=Math.cos(a),o=this.sin_p12*r+this.cos_p12*i*s;if(Math.abs(Math.abs(o)-1)<Proj4js.common.EPSLN){t=1;if(0>o){Proj4js.reportError("aeqd:Fwd:PointError");return}}else{var l=Math.acos(o);t=l/Math.sin(l)}e.x=this.x0+this.a*t*i*Math.sin(a);e.y=this.y0+this.a*t*(this.cos_p12*r-this.sin_p12*i*s);return e},inverse:function(e){e.x-=this.x0;e.y-=this.y0;var t=Math.sqrt(e.x*e.x+e.y*e.y);if(!(t>2*Proj4js.common.HALF_PI*this.a)){var n,r=t/this.a,i=Math.sin(r),a=Math.cos(r),s=this.long0;if(Math.abs(t)<=Proj4js.common.EPSLN)n=this.lat0;else{n=Proj4js.common.asinz(a*this.sin_p12+e.y*i*this.cos_p12/t);var o=Math.abs(this.lat0)-Proj4js.common.HALF_PI;if(Math.abs(o)<=Proj4js.common.EPSLN)s=Proj4js.common.adjust_lon(this.lat0>=0?this.long0+Math.atan2(e.x,-e.y):this.long0-Math.atan2(-e.x,e.y));else{o=a-this.sin_p12*Math.sin(n);if(Math.abs(o)<Proj4js.common.EPSLN&&Math.abs(e.x)<Proj4js.common.EPSLN);else{{Math.atan2(e.x*i*this.cos_p12,o*t)}s=Proj4js.common.adjust_lon(this.long0+Math.atan2(e.x*i*this.cos_p12,o*t))}}}e.x=s;e.y=n;return e}Proj4js.reportError("aeqdInvDataError")}};Proj4js.Proj.moll={init:function(){},forward:function(e){for(var t=e.x,n=e.y,r=Proj4js.common.adjust_lon(t-this.long0),i=n,a=Proj4js.common.PI*Math.sin(n),s=0;!0;s++){var o=-(i+Math.sin(i)-a)/(1+Math.cos(i));i+=o;if(Math.abs(o)<Proj4js.common.EPSLN)break;s>=50&&Proj4js.reportError("moll:Fwd:IterationError")}i/=2;Proj4js.common.PI/2-Math.abs(n)<Proj4js.common.EPSLN&&(r=0);var l=.900316316158*this.a*r*Math.cos(i)+this.x0,c=1.4142135623731*this.a*Math.sin(i)+this.y0;e.x=l;e.y=c;return e},inverse:function(e){var t,n;e.x-=this.x0;var n=e.y/(1.4142135623731*this.a);Math.abs(n)>.999999999999&&(n=.999999999999);var t=Math.asin(n),r=Proj4js.common.adjust_lon(this.long0+e.x/(.900316316158*this.a*Math.cos(t)));r<-Proj4js.common.PI&&(r=-Proj4js.common.PI);r>Proj4js.common.PI&&(r=Proj4js.common.PI);n=(2*t+Math.sin(2*t))/Proj4js.common.PI;Math.abs(n)>1&&(n=1);var i=Math.asin(n);e.x=r;e.y=i;return e}};Proj4js.defs["EPSG:25830"]="+proj=utm +zone=30 +ellps=GRS80 +units=m +no_defs";Proj4js.Proj.utm={dependsOn:"tmerc",init:function(){if(this.zone){this.lat0=0;this.long0=(6*Math.abs(this.zone)-183)*Proj4js.common.D2R;this.x0=5e5;this.y0=this.utmSouth?1e7:0;this.k0=.9996;Proj4js.Proj.tmerc.init.apply(this);this.forward=Proj4js.Proj.tmerc.forward;this.inverse=Proj4js.Proj.tmerc.inverse}else Proj4js.reportError("utm:init: zone must be specified for UTM")}};!function(e,t){function n(e){var t=e.length,n=ue.type(e);return ue.isWindow(e)?!1:1===e.nodeType&&t?!0:"array"===n||"function"!==n&&(0===t||"number"==typeof t&&t>0&&t-1 in e)}function r(e){var t=Ee[e]={};ue.each(e.match(pe)||[],function(e,n){t[n]=!0});return t}function i(e,n,r,i){if(ue.acceptData(e)){var a,s,o=ue.expando,l=e.nodeType,c=l?ue.cache:e,u=l?e[o]:e[o]&&o;if(u&&c[u]&&(i||c[u].data)||r!==t||"string"!=typeof n){u||(u=l?e[o]=te.pop()||ue.guid++:o);c[u]||(c[u]=l?{}:{toJSON:ue.noop});("object"==typeof n||"function"==typeof n)&&(i?c[u]=ue.extend(c[u],n):c[u].data=ue.extend(c[u].data,n));s=c[u];if(!i){s.data||(s.data={});s=s.data}r!==t&&(s[ue.camelCase(n)]=r);if("string"==typeof n){a=s[n];null==a&&(a=s[ue.camelCase(n)])}else a=s;return a}}}function a(e,t,n){if(ue.acceptData(e)){var r,i,a=e.nodeType,s=a?ue.cache:e,l=a?e[ue.expando]:ue.expando;if(s[l]){if(t){r=n?s[l]:s[l].data;if(r){if(ue.isArray(t))t=t.concat(ue.map(t,ue.camelCase));else if(t in r)t=[t];else{t=ue.camelCase(t);t=t in r?[t]:t.split(" ")}i=t.length;for(;i--;)delete r[t[i]];if(n?!o(r):!ue.isEmptyObject(r))return}}if(!n){delete s[l].data;if(!o(s[l]))return}a?ue.cleanData([e],!0):ue.support.deleteExpando||s!=s.window?delete s[l]:s[l]=null}}}function s(e,n,r){if(r===t&&1===e.nodeType){var i="data-"+n.replace(Ae,"-$1").toLowerCase();r=e.getAttribute(i);if("string"==typeof r){try{r="true"===r?!0:"false"===r?!1:"null"===r?null:+r+""===r?+r:Oe.test(r)?ue.parseJSON(r):r}catch(a){}ue.data(e,n,r)}else r=t}return r}function o(e){var t;for(t in e)if(("data"!==t||!ue.isEmptyObject(e[t]))&&"toJSON"!==t)return!1;return!0}function l(){return!0}function c(){return!1}function u(){try{return K.activeElement}catch(e){}}function h(e,t){do e=e[t];while(e&&1!==e.nodeType);return e}function p(e,t,n){if(ue.isFunction(t))return ue.grep(e,function(e,r){return!!t.call(e,r,e)!==n});if(t.nodeType)return ue.grep(e,function(e){return e===t!==n});if("string"==typeof t){if(Ge.test(t))return ue.filter(t,e,n);t=ue.filter(t,e)}return ue.grep(e,function(e){return ue.inArray(e,t)>=0!==n})}function d(e){var t=Ve.split("|"),n=e.createDocumentFragment();if(n.createElement)for(;t.length;)n.createElement(t.pop());return n}function f(e,t){return ue.nodeName(e,"table")&&ue.nodeName(1===t.nodeType?t:t.firstChild,"tr")?e.getElementsByTagName("tbody")[0]||e.appendChild(e.ownerDocument.createElement("tbody")):e}function m(e){e.type=(null!==ue.find.attr(e,"type"))+"/"+e.type;return e}function y(e){var t=it.exec(e.type);t?e.type=t[1]:e.removeAttribute("type");return e}function g(e,t){for(var n,r=0;null!=(n=e[r]);r++)ue._data(n,"globalEval",!t||ue._data(t[r],"globalEval"))}function v(e,t){if(1===t.nodeType&&ue.hasData(e)){var n,r,i,a=ue._data(e),s=ue._data(t,a),o=a.events;if(o){delete s.handle;s.events={};for(n in o)for(r=0,i=o[n].length;i>r;r++)ue.event.add(t,n,o[n][r])}s.data&&(s.data=ue.extend({},s.data))}}function C(e,t){var n,r,i;if(1===t.nodeType){n=t.nodeName.toLowerCase();if(!ue.support.noCloneEvent&&t[ue.expando]){i=ue._data(t);for(r in i.events)ue.removeEvent(t,r,i.handle);t.removeAttribute(ue.expando)}if("script"===n&&t.text!==e.text){m(t).text=e.text;y(t)}else if("object"===n){t.parentNode&&(t.outerHTML=e.outerHTML);ue.support.html5Clone&&e.innerHTML&&!ue.trim(t.innerHTML)&&(t.innerHTML=e.innerHTML)}else if("input"===n&&tt.test(e.type)){t.defaultChecked=t.checked=e.checked;t.value!==e.value&&(t.value=e.value)}else"option"===n?t.defaultSelected=t.selected=e.defaultSelected:("input"===n||"textarea"===n)&&(t.defaultValue=e.defaultValue)}}function L(e,n){var r,i,a=0,s=typeof e.getElementsByTagName!==Y?e.getElementsByTagName(n||"*"):typeof e.querySelectorAll!==Y?e.querySelectorAll(n||"*"):t;if(!s)for(s=[],r=e.childNodes||e;null!=(i=r[a]);a++)!n||ue.nodeName(i,n)?s.push(i):ue.merge(s,L(i,n));return n===t||n&&ue.nodeName(e,n)?ue.merge([e],s):s}function T(e){tt.test(e.type)&&(e.defaultChecked=e.checked)}function w(e,t){if(t in e)return t;for(var n=t.charAt(0).toUpperCase()+t.slice(1),r=t,i=St.length;i--;){t=St[i]+n;if(t in e)return t}return r}function b(e,t){e=t||e;return"none"===ue.css(e,"display")||!ue.contains(e.ownerDocument,e)}function S(e,t){for(var n,r,i,a=[],s=0,o=e.length;o>s;s++){r=e[s];if(r.style){a[s]=ue._data(r,"olddisplay");n=r.style.display;if(t){a[s]||"none"!==n||(r.style.display="");""===r.style.display&&b(r)&&(a[s]=ue._data(r,"olddisplay",x(r.nodeName)))}else if(!a[s]){i=b(r);(n&&"none"!==n||!i)&&ue._data(r,"olddisplay",i?n:ue.css(r,"display"))}}}for(s=0;o>s;s++){r=e[s];r.style&&(t&&"none"!==r.style.display&&""!==r.style.display||(r.style.display=t?a[s]||"":"none"))}return e}function E(e,t,n){var r=gt.exec(t);return r?Math.max(0,r[1]-(n||0))+(r[2]||"px"):t}function O(e,t,n,r,i){for(var a=n===(r?"border":"content")?4:"width"===t?1:0,s=0;4>a;a+=2){"margin"===n&&(s+=ue.css(e,n+bt[a],!0,i));if(r){"content"===n&&(s-=ue.css(e,"padding"+bt[a],!0,i));"margin"!==n&&(s-=ue.css(e,"border"+bt[a]+"Width",!0,i))}else{s+=ue.css(e,"padding"+bt[a],!0,i);"padding"!==n&&(s+=ue.css(e,"border"+bt[a]+"Width",!0,i))}}return s}function A(e,t,n){var r=!0,i="width"===t?e.offsetWidth:e.offsetHeight,a=ut(e),s=ue.support.boxSizing&&"border-box"===ue.css(e,"boxSizing",!1,a);if(0>=i||null==i){i=ht(e,t,a);(0>i||null==i)&&(i=e.style[t]);if(vt.test(i))return i;r=s&&(ue.support.boxSizingReliable||i===e.style[t]);i=parseFloat(i)||0}return i+O(e,t,n||(s?"border":"content"),r,a)+"px"}function x(e){var t=K,n=Lt[e];if(!n){n=P(e,t);if("none"===n||!n){ct=(ct||ue("<iframe frameborder='0' width='0' height='0'/>").css("cssText","display:block !important")).appendTo(t.documentElement);t=(ct[0].contentWindow||ct[0].contentDocument).document;t.write("<!doctype html><html><body>");t.close();n=P(e,t);ct.detach()}Lt[e]=n}return n}function P(e,t){var n=ue(t.createElement(e)).appendTo(t.body),r=ue.css(n[0],"display");n.remove();return r}function _(e,t,n,r){var i;if(ue.isArray(t))ue.each(t,function(t,i){n||Ot.test(e)?r(e,i):_(e+"["+("object"==typeof i?t:"")+"]",i,n,r)});else if(n||"object"!==ue.type(t))r(e,t);else for(i in t)_(e+"["+i+"]",t[i],n,r)}function N(e){return function(t,n){if("string"!=typeof t){n=t;t="*"}var r,i=0,a=t.toLowerCase().match(pe)||[];if(ue.isFunction(n))for(;r=a[i++];)if("+"===r[0]){r=r.slice(1)||"*";(e[r]=e[r]||[]).unshift(n)}else(e[r]=e[r]||[]).push(n)}}function M(e,t,n,r){function i(o){var l;a[o]=!0;ue.each(e[o]||[],function(e,o){var c=o(t,n,r);if("string"==typeof c&&!s&&!a[c]){t.dataTypes.unshift(c);i(c);return!1}return s?!(l=c):void 0});return l}var a={},s=e===zt;return i(t.dataTypes[0])||!a["*"]&&i("*")}function k(e,n){var r,i,a=ue.ajaxSettings.flatOptions||{};for(i in n)n[i]!==t&&((a[i]?e:r||(r={}))[i]=n[i]);r&&ue.extend(!0,e,r);return e}function I(e,n,r){for(var i,a,s,o,l=e.contents,c=e.dataTypes;"*"===c[0];){c.shift();a===t&&(a=e.mimeType||n.getResponseHeader("Content-Type"))}if(a)for(o in l)if(l[o]&&l[o].test(a)){c.unshift(o);break}if(c[0]in r)s=c[0];else{for(o in r){if(!c[0]||e.converters[o+" "+c[0]]){s=o;break}i||(i=o)}s=s||i}if(s){s!==c[0]&&c.unshift(s);return r[s]}}function R(e,t,n,r){var i,a,s,o,l,c={},u=e.dataTypes.slice();if(u[1])for(s in e.converters)c[s.toLowerCase()]=e.converters[s];a=u.shift();for(;a;){e.responseFields[a]&&(n[e.responseFields[a]]=t);!l&&r&&e.dataFilter&&(t=e.dataFilter(t,e.dataType));l=a;a=u.shift();if(a)if("*"===a)a=l;else if("*"!==l&&l!==a){s=c[l+" "+a]||c["* "+a];if(!s)for(i in c){o=i.split(" ");if(o[1]===a){s=c[l+" "+o[0]]||c["* "+o[0]];if(s){if(s===!0)s=c[i];else if(c[i]!==!0){a=o[0];u.unshift(o[1])}break}}}if(s!==!0)if(s&&e["throws"])t=s(t);else try{t=s(t)}catch(h){return{state:"parsererror",error:s?h:"No conversion from "+l+" to "+a}}}}return{state:"success",data:t}}function D(){try{return new e.XMLHttpRequest}catch(t){}}function F(){try{return new e.ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}function j(){setTimeout(function(){Jt=t});return Jt=ue.now()}function B(e,t,n){for(var r,i=(an[t]||[]).concat(an["*"]),a=0,s=i.length;s>a;a++)if(r=i[a].call(n,t,e))return r}function $(e,t,n){var r,i,a=0,s=rn.length,o=ue.Deferred().always(function(){delete l.elem}),l=function(){if(i)return!1;for(var t=Jt||j(),n=Math.max(0,c.startTime+c.duration-t),r=n/c.duration||0,a=1-r,s=0,l=c.tweens.length;l>s;s++)c.tweens[s].run(a);o.notifyWith(e,[c,a,n]);if(1>a&&l)return n;o.resolveWith(e,[c]);return!1},c=o.promise({elem:e,props:ue.extend({},t),opts:ue.extend(!0,{specialEasing:{}},n),originalProperties:t,originalOptions:n,startTime:Jt||j(),duration:n.duration,tweens:[],createTween:function(t,n){var r=ue.Tween(e,c.opts,t,n,c.opts.specialEasing[t]||c.opts.easing);c.tweens.push(r);return r},stop:function(t){var n=0,r=t?c.tweens.length:0;if(i)return this;i=!0;for(;r>n;n++)c.tweens[n].run(1);t?o.resolveWith(e,[c,t]):o.rejectWith(e,[c,t]);return this}}),u=c.props;U(u,c.opts.specialEasing);for(;s>a;a++){r=rn[a].call(c,e,u,c.opts);if(r)return r}ue.map(u,B,c);ue.isFunction(c.opts.start)&&c.opts.start.call(e,c);ue.fx.timer(ue.extend(l,{elem:e,anim:c,queue:c.opts.queue}));return c.progress(c.opts.progress).done(c.opts.done,c.opts.complete).fail(c.opts.fail).always(c.opts.always)}function U(e,t){var n,r,i,a,s;for(n in e){r=ue.camelCase(n);i=t[r];a=e[n];if(ue.isArray(a)){i=a[1];a=e[n]=a[0]}if(n!==r){e[r]=a;delete e[n]}s=ue.cssHooks[r];if(s&&"expand"in s){a=s.expand(a);delete e[r];for(n in a)if(!(n in e)){e[n]=a[n];t[n]=i}}else t[r]=i}}function G(e,t,n){var r,i,a,s,o,l,c=this,u={},h=e.style,p=e.nodeType&&b(e),d=ue._data(e,"fxshow");if(!n.queue){o=ue._queueHooks(e,"fx");if(null==o.unqueued){o.unqueued=0;l=o.empty.fire;o.empty.fire=function(){o.unqueued||l()}}o.unqueued++;c.always(function(){c.always(function(){o.unqueued--;ue.queue(e,"fx").length||o.empty.fire()})})}if(1===e.nodeType&&("height"in t||"width"in t)){n.overflow=[h.overflow,h.overflowX,h.overflowY];"inline"===ue.css(e,"display")&&"none"===ue.css(e,"float")&&(ue.support.inlineBlockNeedsLayout&&"inline"!==x(e.nodeName)?h.zoom=1:h.display="inline-block")}if(n.overflow){h.overflow="hidden";ue.support.shrinkWrapBlocks||c.always(function(){h.overflow=n.overflow[0];h.overflowX=n.overflow[1];h.overflowY=n.overflow[2]})}for(r in t){i=t[r];if(en.exec(i)){delete t[r];a=a||"toggle"===i;if(i===(p?"hide":"show"))continue;u[r]=d&&d[r]||ue.style(e,r)}}if(!ue.isEmptyObject(u)){d?"hidden"in d&&(p=d.hidden):d=ue._data(e,"fxshow",{});a&&(d.hidden=!p);p?ue(e).show():c.done(function(){ue(e).hide()});c.done(function(){var t;ue._removeData(e,"fxshow");for(t in u)ue.style(e,t,u[t])});for(r in u){s=B(p?d[r]:0,r,c);if(!(r in d)){d[r]=s.start;if(p){s.end=s.start;s.start="width"===r||"height"===r?1:0}}}}}function z(e,t,n,r,i){return new z.prototype.init(e,t,n,r,i)}function H(e,t){var n,r={height:e},i=0;t=t?1:0;for(;4>i;i+=2-t){n=bt[i];r["margin"+n]=r["padding"+n]=e}t&&(r.opacity=r.width=e);return r}function W(e){return ue.isWindow(e)?e:9===e.nodeType?e.defaultView||e.parentWindow:!1}var V,q,Y=typeof t,X=e.location,K=e.document,Q=K.documentElement,J=e.jQuery,Z=e.$,ee={},te=[],ne="1.10.2",re=te.concat,ie=te.push,ae=te.slice,se=te.indexOf,oe=ee.toString,le=ee.hasOwnProperty,ce=ne.trim,ue=function(e,t){return new ue.fn.init(e,t,q)},he=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,pe=/\S+/g,de=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,fe=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,me=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,ye=/^[\],:{}\s]*$/,ge=/(?:^|:|,)(?:\s*\[)+/g,ve=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,Ce=/"[^"\\\r\n]*"|true|false|null|-?(?:\d+\.|)\d+(?:[eE][+-]?\d+|)/g,Le=/^-ms-/,Te=/-([\da-z])/gi,we=function(e,t){return t.toUpperCase()},be=function(e){if(K.addEventListener||"load"===e.type||"complete"===K.readyState){Se();ue.ready()}},Se=function(){if(K.addEventListener){K.removeEventListener("DOMContentLoaded",be,!1);e.removeEventListener("load",be,!1)}else{K.detachEvent("onreadystatechange",be);e.detachEvent("onload",be)}};ue.fn=ue.prototype={jquery:ne,constructor:ue,init:function(e,n,r){var i,a;if(!e)return this;if("string"==typeof e){i="<"===e.charAt(0)&&">"===e.charAt(e.length-1)&&e.length>=3?[null,e,null]:fe.exec(e);if(!i||!i[1]&&n)return!n||n.jquery?(n||r).find(e):this.constructor(n).find(e);if(i[1]){n=n instanceof ue?n[0]:n;ue.merge(this,ue.parseHTML(i[1],n&&n.nodeType?n.ownerDocument||n:K,!0));if(me.test(i[1])&&ue.isPlainObject(n))for(i in n)ue.isFunction(this[i])?this[i](n[i]):this.attr(i,n[i]);return this}a=K.getElementById(i[2]);if(a&&a.parentNode){if(a.id!==i[2])return r.find(e);this.length=1;this[0]=a}this.context=K;this.selector=e;return this}if(e.nodeType){this.context=this[0]=e;this.length=1;return this}if(ue.isFunction(e))return r.ready(e);if(e.selector!==t){this.selector=e.selector;this.context=e.context}return ue.makeArray(e,this)},selector:"",length:0,toArray:function(){return ae.call(this)},get:function(e){return null==e?this.toArray():0>e?this[this.length+e]:this[e]},pushStack:function(e){var t=ue.merge(this.constructor(),e);t.prevObject=this;t.context=this.context;return t},each:function(e,t){return ue.each(this,e,t)},ready:function(e){ue.ready.promise().done(e);return this},slice:function(){return this.pushStack(ae.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,n=+e+(0>e?t:0);return this.pushStack(n>=0&&t>n?[this[n]]:[])},map:function(e){return this.pushStack(ue.map(this,function(t,n){return e.call(t,n,t)}))},end:function(){return this.prevObject||this.constructor(null)},push:ie,sort:[].sort,splice:[].splice};ue.fn.init.prototype=ue.fn;ue.extend=ue.fn.extend=function(){var e,n,r,i,a,s,o=arguments[0]||{},l=1,c=arguments.length,u=!1;if("boolean"==typeof o){u=o;o=arguments[1]||{};l=2}"object"==typeof o||ue.isFunction(o)||(o={});if(c===l){o=this;--l}for(;c>l;l++)if(null!=(a=arguments[l]))for(i in a){e=o[i];r=a[i];if(o!==r)if(u&&r&&(ue.isPlainObject(r)||(n=ue.isArray(r)))){if(n){n=!1;s=e&&ue.isArray(e)?e:[]}else s=e&&ue.isPlainObject(e)?e:{};o[i]=ue.extend(u,s,r)}else r!==t&&(o[i]=r)}return o};ue.extend({expando:"jQuery"+(ne+Math.random()).replace(/\D/g,""),noConflict:function(t){e.$===ue&&(e.$=Z);t&&e.jQuery===ue&&(e.jQuery=J);return ue},isReady:!1,readyWait:1,holdReady:function(e){e?ue.readyWait++:ue.ready(!0)},ready:function(e){if(e===!0?!--ue.readyWait:!ue.isReady){if(!K.body)return setTimeout(ue.ready);ue.isReady=!0;if(!(e!==!0&&--ue.readyWait>0)){V.resolveWith(K,[ue]);ue.fn.trigger&&ue(K).trigger("ready").off("ready")}}},isFunction:function(e){return"function"===ue.type(e)},isArray:Array.isArray||function(e){return"array"===ue.type(e)},isWindow:function(e){return null!=e&&e==e.window},isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},type:function(e){return null==e?String(e):"object"==typeof e||"function"==typeof e?ee[oe.call(e)]||"object":typeof e},isPlainObject:function(e){var n;if(!e||"object"!==ue.type(e)||e.nodeType||ue.isWindow(e))return!1;try{if(e.constructor&&!le.call(e,"constructor")&&!le.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(r){return!1}if(ue.support.ownLast)for(n in e)return le.call(e,n);for(n in e);return n===t||le.call(e,n)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},error:function(e){throw new Error(e)},parseHTML:function(e,t,n){if(!e||"string"!=typeof e)return null;if("boolean"==typeof t){n=t;t=!1}t=t||K;var r=me.exec(e),i=!n&&[];if(r)return[t.createElement(r[1])];r=ue.buildFragment([e],t,i);i&&ue(i).remove();return ue.merge([],r.childNodes)},parseJSON:function(t){if(e.JSON&&e.JSON.parse)return e.JSON.parse(t);if(null===t)return t;if("string"==typeof t){t=ue.trim(t);if(t&&ye.test(t.replace(ve,"@").replace(Ce,"]").replace(ge,"")))return new Function("return "+t)()}ue.error("Invalid JSON: "+t)},parseXML:function(n){var r,i;if(!n||"string"!=typeof n)return null;try{if(e.DOMParser){i=new DOMParser;r=i.parseFromString(n,"text/xml")}else{r=new ActiveXObject("Microsoft.XMLDOM");r.async="false";r.loadXML(n)}}catch(a){r=t}r&&r.documentElement&&!r.getElementsByTagName("parsererror").length||ue.error("Invalid XML: "+n);return r},noop:function(){},globalEval:function(t){t&&ue.trim(t)&&(e.execScript||function(t){e.eval.call(e,t)})(t)},camelCase:function(e){return e.replace(Le,"ms-").replace(Te,we)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,t,r){var i,a=0,s=e.length,o=n(e);if(r)if(o)for(;s>a;a++){i=t.apply(e[a],r);if(i===!1)break}else for(a in e){i=t.apply(e[a],r);if(i===!1)break}else if(o)for(;s>a;a++){i=t.call(e[a],a,e[a]);if(i===!1)break}else for(a in e){i=t.call(e[a],a,e[a]);if(i===!1)break}return e},trim:ce&&!ce.call("\ufeff\xa0")?function(e){return null==e?"":ce.call(e)}:function(e){return null==e?"":(e+"").replace(de,"")},makeArray:function(e,t){var r=t||[];null!=e&&(n(Object(e))?ue.merge(r,"string"==typeof e?[e]:e):ie.call(r,e));return r},inArray:function(e,t,n){var r;if(t){if(se)return se.call(t,e,n);r=t.length;n=n?0>n?Math.max(0,r+n):n:0;for(;r>n;n++)if(n in t&&t[n]===e)return n}return-1},merge:function(e,n){var r=n.length,i=e.length,a=0;if("number"==typeof r)for(;r>a;a++)e[i++]=n[a];else for(;n[a]!==t;)e[i++]=n[a++];e.length=i;return e},grep:function(e,t,n){var r,i=[],a=0,s=e.length;n=!!n;for(;s>a;a++){r=!!t(e[a],a);n!==r&&i.push(e[a])}return i},map:function(e,t,r){var i,a=0,s=e.length,o=n(e),l=[];if(o)for(;s>a;a++){i=t(e[a],a,r);null!=i&&(l[l.length]=i)}else for(a in e){i=t(e[a],a,r);null!=i&&(l[l.length]=i)}return re.apply([],l)},guid:1,proxy:function(e,n){var r,i,a;if("string"==typeof n){a=e[n];n=e;e=a}if(!ue.isFunction(e))return t;r=ae.call(arguments,2);i=function(){return e.apply(n||this,r.concat(ae.call(arguments)))};i.guid=e.guid=e.guid||ue.guid++;return i},access:function(e,n,r,i,a,s,o){var l=0,c=e.length,u=null==r;if("object"===ue.type(r)){a=!0;for(l in r)ue.access(e,n,l,r[l],!0,s,o)}else if(i!==t){a=!0;ue.isFunction(i)||(o=!0);if(u)if(o){n.call(e,i);n=null}else{u=n;n=function(e,t,n){return u.call(ue(e),n)}}if(n)for(;c>l;l++)n(e[l],r,o?i:i.call(e[l],l,n(e[l],r)))}return a?e:u?n.call(e):c?n(e[0],r):s},now:function(){return(new Date).getTime()},swap:function(e,t,n,r){var i,a,s={};for(a in t){s[a]=e.style[a];e.style[a]=t[a]}i=n.apply(e,r||[]);for(a in t)e.style[a]=s[a];return i}});ue.ready.promise=function(t){if(!V){V=ue.Deferred();if("complete"===K.readyState)setTimeout(ue.ready);else if(K.addEventListener){K.addEventListener("DOMContentLoaded",be,!1);e.addEventListener("load",be,!1)}else{K.attachEvent("onreadystatechange",be);e.attachEvent("onload",be);var n=!1;try{n=null==e.frameElement&&K.documentElement}catch(r){}n&&n.doScroll&&!function i(){if(!ue.isReady){try{n.doScroll("left")}catch(e){return setTimeout(i,50)}Se();ue.ready()}}()}}return V.promise(t)};ue.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){ee["[object "+t+"]"]=t.toLowerCase()});q=ue(K);!function(e,t){function n(e,t,n,r){var i,a,s,o,l,c,u,h,f,m;(t?t.ownerDocument||t:$)!==M&&N(t);t=t||M;n=n||[];if(!e||"string"!=typeof e)return n;if(1!==(o=t.nodeType)&&9!==o)return[];if(I&&!r){if(i=Ce.exec(e))if(s=i[1]){if(9===o){a=t.getElementById(s);if(!a||!a.parentNode)return n;if(a.id===s){n.push(a);return n}}else if(t.ownerDocument&&(a=t.ownerDocument.getElementById(s))&&j(t,a)&&a.id===s){n.push(a);return n}}else{if(i[2]){ee.apply(n,t.getElementsByTagName(e));return n}if((s=i[3])&&b.getElementsByClassName&&t.getElementsByClassName){
ee.apply(n,t.getElementsByClassName(s));return n}}if(b.qsa&&(!R||!R.test(e))){h=u=B;f=t;m=9===o&&e;if(1===o&&"object"!==t.nodeName.toLowerCase()){c=p(e);(u=t.getAttribute("id"))?h=u.replace(we,"\\$&"):t.setAttribute("id",h);h="[id='"+h+"'] ";l=c.length;for(;l--;)c[l]=h+d(c[l]);f=de.test(e)&&t.parentNode||t;m=c.join(",")}if(m)try{ee.apply(n,f.querySelectorAll(m));return n}catch(y){}finally{u||t.removeAttribute("id")}}}return T(e.replace(ce,"$1"),t,n,r)}function r(){function e(n,r){t.push(n+=" ")>E.cacheLength&&delete e[t.shift()];return e[n]=r}var t=[];return e}function i(e){e[B]=!0;return e}function a(e){var t=M.createElement("div");try{return!!e(t)}catch(n){return!1}finally{t.parentNode&&t.parentNode.removeChild(t);t=null}}function s(e,t){for(var n=e.split("|"),r=e.length;r--;)E.attrHandle[n[r]]=t}function o(e,t){var n=t&&e,r=n&&1===e.nodeType&&1===t.nodeType&&(~t.sourceIndex||X)-(~e.sourceIndex||X);if(r)return r;if(n)for(;n=n.nextSibling;)if(n===t)return-1;return e?1:-1}function l(e){return function(t){var n=t.nodeName.toLowerCase();return"input"===n&&t.type===e}}function c(e){return function(t){var n=t.nodeName.toLowerCase();return("input"===n||"button"===n)&&t.type===e}}function u(e){return i(function(t){t=+t;return i(function(n,r){for(var i,a=e([],n.length,t),s=a.length;s--;)n[i=a[s]]&&(n[i]=!(r[i]=n[i]))})})}function h(){}function p(e,t){var r,i,a,s,o,l,c,u=H[e+" "];if(u)return t?0:u.slice(0);o=e;l=[];c=E.preFilter;for(;o;){if(!r||(i=he.exec(o))){i&&(o=o.slice(i[0].length)||o);l.push(a=[])}r=!1;if(i=pe.exec(o)){r=i.shift();a.push({value:r,type:i[0].replace(ce," ")});o=o.slice(r.length)}for(s in E.filter)if((i=ge[s].exec(o))&&(!c[s]||(i=c[s](i)))){r=i.shift();a.push({value:r,type:s,matches:i});o=o.slice(r.length)}if(!r)break}return t?o.length:o?n.error(e):H(e,l).slice(0)}function d(e){for(var t=0,n=e.length,r="";n>t;t++)r+=e[t].value;return r}function f(e,t,n){var r=t.dir,i=n&&"parentNode"===r,a=G++;return t.first?function(t,n,a){for(;t=t[r];)if(1===t.nodeType||i)return e(t,n,a)}:function(t,n,s){var o,l,c,u=U+" "+a;if(s){for(;t=t[r];)if((1===t.nodeType||i)&&e(t,n,s))return!0}else for(;t=t[r];)if(1===t.nodeType||i){c=t[B]||(t[B]={});if((l=c[r])&&l[0]===u){if((o=l[1])===!0||o===S)return o===!0}else{l=c[r]=[u];l[1]=e(t,n,s)||S;if(l[1]===!0)return!0}}}}function m(e){return e.length>1?function(t,n,r){for(var i=e.length;i--;)if(!e[i](t,n,r))return!1;return!0}:e[0]}function y(e,t,n,r,i){for(var a,s=[],o=0,l=e.length,c=null!=t;l>o;o++)if((a=e[o])&&(!n||n(a,r,i))){s.push(a);c&&t.push(o)}return s}function g(e,t,n,r,a,s){r&&!r[B]&&(r=g(r));a&&!a[B]&&(a=g(a,s));return i(function(i,s,o,l){var c,u,h,p=[],d=[],f=s.length,m=i||L(t||"*",o.nodeType?[o]:o,[]),g=!e||!i&&t?m:y(m,p,e,o,l),v=n?a||(i?e:f||r)?[]:s:g;n&&n(g,v,o,l);if(r){c=y(v,d);r(c,[],o,l);u=c.length;for(;u--;)(h=c[u])&&(v[d[u]]=!(g[d[u]]=h))}if(i){if(a||e){if(a){c=[];u=v.length;for(;u--;)(h=v[u])&&c.push(g[u]=h);a(null,v=[],c,l)}u=v.length;for(;u--;)(h=v[u])&&(c=a?ne.call(i,h):p[u])>-1&&(i[c]=!(s[c]=h))}}else{v=y(v===s?v.splice(f,v.length):v);a?a(null,s,v,l):ee.apply(s,v)}})}function v(e){for(var t,n,r,i=e.length,a=E.relative[e[0].type],s=a||E.relative[" "],o=a?1:0,l=f(function(e){return e===t},s,!0),c=f(function(e){return ne.call(t,e)>-1},s,!0),u=[function(e,n,r){return!a&&(r||n!==P)||((t=n).nodeType?l(e,n,r):c(e,n,r))}];i>o;o++)if(n=E.relative[e[o].type])u=[f(m(u),n)];else{n=E.filter[e[o].type].apply(null,e[o].matches);if(n[B]){r=++o;for(;i>r&&!E.relative[e[r].type];r++);return g(o>1&&m(u),o>1&&d(e.slice(0,o-1).concat({value:" "===e[o-2].type?"*":""})).replace(ce,"$1"),n,r>o&&v(e.slice(o,r)),i>r&&v(e=e.slice(r)),i>r&&d(e))}u.push(n)}return m(u)}function C(e,t){var r=0,a=t.length>0,s=e.length>0,o=function(i,o,l,c,u){var h,p,d,f=[],m=0,g="0",v=i&&[],C=null!=u,L=P,T=i||s&&E.find.TAG("*",u&&o.parentNode||o),w=U+=null==L?1:Math.random()||.1;if(C){P=o!==M&&o;S=r}for(;null!=(h=T[g]);g++){if(s&&h){p=0;for(;d=e[p++];)if(d(h,o,l)){c.push(h);break}if(C){U=w;S=++r}}if(a){(h=!d&&h)&&m--;i&&v.push(h)}}m+=g;if(a&&g!==m){p=0;for(;d=t[p++];)d(v,f,o,l);if(i){if(m>0)for(;g--;)v[g]||f[g]||(f[g]=J.call(c));f=y(f)}ee.apply(c,f);C&&!i&&f.length>0&&m+t.length>1&&n.uniqueSort(c)}if(C){U=w;P=L}return v};return a?i(o):o}function L(e,t,r){for(var i=0,a=t.length;a>i;i++)n(e,t[i],r);return r}function T(e,t,n,r){var i,a,s,o,l,c=p(e);if(!r&&1===c.length){a=c[0]=c[0].slice(0);if(a.length>2&&"ID"===(s=a[0]).type&&b.getById&&9===t.nodeType&&I&&E.relative[a[1].type]){t=(E.find.ID(s.matches[0].replace(be,Se),t)||[])[0];if(!t)return n;e=e.slice(a.shift().value.length)}i=ge.needsContext.test(e)?0:a.length;for(;i--;){s=a[i];if(E.relative[o=s.type])break;if((l=E.find[o])&&(r=l(s.matches[0].replace(be,Se),de.test(a[0].type)&&t.parentNode||t))){a.splice(i,1);e=r.length&&d(a);if(!e){ee.apply(n,r);return n}break}}}x(e,c)(r,t,!I,n,de.test(e));return n}var w,b,S,E,O,A,x,P,_,N,M,k,I,R,D,F,j,B="sizzle"+-new Date,$=e.document,U=0,G=0,z=r(),H=r(),W=r(),V=!1,q=function(e,t){if(e===t){V=!0;return 0}return 0},Y=typeof t,X=1<<31,K={}.hasOwnProperty,Q=[],J=Q.pop,Z=Q.push,ee=Q.push,te=Q.slice,ne=Q.indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(this[t]===e)return t;return-1},re="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",ie="[\\x20\\t\\r\\n\\f]",ae="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",se=ae.replace("w","w#"),oe="\\["+ie+"*("+ae+")"+ie+"*(?:([*^$|!~]?=)"+ie+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+se+")|)|)"+ie+"*\\]",le=":("+ae+")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|"+oe.replace(3,8)+")*)|.*)\\)|)",ce=new RegExp("^"+ie+"+|((?:^|[^\\\\])(?:\\\\.)*)"+ie+"+$","g"),he=new RegExp("^"+ie+"*,"+ie+"*"),pe=new RegExp("^"+ie+"*([>+~]|"+ie+")"+ie+"*"),de=new RegExp(ie+"*[+~]"),fe=new RegExp("="+ie+"*([^\\]'\"]*)"+ie+"*\\]","g"),me=new RegExp(le),ye=new RegExp("^"+se+"$"),ge={ID:new RegExp("^#("+ae+")"),CLASS:new RegExp("^\\.("+ae+")"),TAG:new RegExp("^("+ae.replace("w","w*")+")"),ATTR:new RegExp("^"+oe),PSEUDO:new RegExp("^"+le),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+ie+"*(even|odd|(([+-]|)(\\d*)n|)"+ie+"*(?:([+-]|)"+ie+"*(\\d+)|))"+ie+"*\\)|)","i"),bool:new RegExp("^(?:"+re+")$","i"),needsContext:new RegExp("^"+ie+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+ie+"*((?:-\\d)?\\d*)"+ie+"*\\)|)(?=[^-]|$)","i")},ve=/^[^{]+\{\s*\[native \w/,Ce=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,Le=/^(?:input|select|textarea|button)$/i,Te=/^h\d$/i,we=/'|\\/g,be=new RegExp("\\\\([\\da-f]{1,6}"+ie+"?|("+ie+")|.)","ig"),Se=function(e,t,n){var r="0x"+t-65536;return r!==r||n?t:0>r?String.fromCharCode(r+65536):String.fromCharCode(r>>10|55296,1023&r|56320)};try{ee.apply(Q=te.call($.childNodes),$.childNodes);Q[$.childNodes.length].nodeType}catch(Ee){ee={apply:Q.length?function(e,t){Z.apply(e,te.call(t))}:function(e,t){for(var n=e.length,r=0;e[n++]=t[r++];);e.length=n-1}}}A=n.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return t?"HTML"!==t.nodeName:!1};b=n.support={};N=n.setDocument=function(e){var t=e?e.ownerDocument||e:$,n=t.defaultView;if(t===M||9!==t.nodeType||!t.documentElement)return M;M=t;k=t.documentElement;I=!A(t);n&&n.attachEvent&&n!==n.top&&n.attachEvent("onbeforeunload",function(){N()});b.attributes=a(function(e){e.className="i";return!e.getAttribute("className")});b.getElementsByTagName=a(function(e){e.appendChild(t.createComment(""));return!e.getElementsByTagName("*").length});b.getElementsByClassName=a(function(e){e.innerHTML="<div class='a'></div><div class='a i'></div>";e.firstChild.className="i";return 2===e.getElementsByClassName("i").length});b.getById=a(function(e){k.appendChild(e).id=B;return!t.getElementsByName||!t.getElementsByName(B).length});if(b.getById){E.find.ID=function(e,t){if(typeof t.getElementById!==Y&&I){var n=t.getElementById(e);return n&&n.parentNode?[n]:[]}};E.filter.ID=function(e){var t=e.replace(be,Se);return function(e){return e.getAttribute("id")===t}}}else{delete E.find.ID;E.filter.ID=function(e){var t=e.replace(be,Se);return function(e){var n=typeof e.getAttributeNode!==Y&&e.getAttributeNode("id");return n&&n.value===t}}}E.find.TAG=b.getElementsByTagName?function(e,t){return typeof t.getElementsByTagName!==Y?t.getElementsByTagName(e):void 0}:function(e,t){var n,r=[],i=0,a=t.getElementsByTagName(e);if("*"===e){for(;n=a[i++];)1===n.nodeType&&r.push(n);return r}return a};E.find.CLASS=b.getElementsByClassName&&function(e,t){return typeof t.getElementsByClassName!==Y&&I?t.getElementsByClassName(e):void 0};D=[];R=[];if(b.qsa=ve.test(t.querySelectorAll)){a(function(e){e.innerHTML="<select><option selected=''></option></select>";e.querySelectorAll("[selected]").length||R.push("\\["+ie+"*(?:value|"+re+")");e.querySelectorAll(":checked").length||R.push(":checked")});a(function(e){var n=t.createElement("input");n.setAttribute("type","hidden");e.appendChild(n).setAttribute("t","");e.querySelectorAll("[t^='']").length&&R.push("[*^$]="+ie+"*(?:''|\"\")");e.querySelectorAll(":enabled").length||R.push(":enabled",":disabled");e.querySelectorAll("*,:x");R.push(",.*:")})}(b.matchesSelector=ve.test(F=k.webkitMatchesSelector||k.mozMatchesSelector||k.oMatchesSelector||k.msMatchesSelector))&&a(function(e){b.disconnectedMatch=F.call(e,"div");F.call(e,"[s!='']:x");D.push("!=",le)});R=R.length&&new RegExp(R.join("|"));D=D.length&&new RegExp(D.join("|"));j=ve.test(k.contains)||k.compareDocumentPosition?function(e,t){var n=9===e.nodeType?e.documentElement:e,r=t&&t.parentNode;return e===r||!(!r||1!==r.nodeType||!(n.contains?n.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1};q=k.compareDocumentPosition?function(e,n){if(e===n){V=!0;return 0}var r=n.compareDocumentPosition&&e.compareDocumentPosition&&e.compareDocumentPosition(n);return r?1&r||!b.sortDetached&&n.compareDocumentPosition(e)===r?e===t||j($,e)?-1:n===t||j($,n)?1:_?ne.call(_,e)-ne.call(_,n):0:4&r?-1:1:e.compareDocumentPosition?-1:1}:function(e,n){var r,i=0,a=e.parentNode,s=n.parentNode,l=[e],c=[n];if(e===n){V=!0;return 0}if(!a||!s)return e===t?-1:n===t?1:a?-1:s?1:_?ne.call(_,e)-ne.call(_,n):0;if(a===s)return o(e,n);r=e;for(;r=r.parentNode;)l.unshift(r);r=n;for(;r=r.parentNode;)c.unshift(r);for(;l[i]===c[i];)i++;return i?o(l[i],c[i]):l[i]===$?-1:c[i]===$?1:0};return t};n.matches=function(e,t){return n(e,null,null,t)};n.matchesSelector=function(e,t){(e.ownerDocument||e)!==M&&N(e);t=t.replace(fe,"='$1']");if(!(!b.matchesSelector||!I||D&&D.test(t)||R&&R.test(t)))try{var r=F.call(e,t);if(r||b.disconnectedMatch||e.document&&11!==e.document.nodeType)return r}catch(i){}return n(t,M,null,[e]).length>0};n.contains=function(e,t){(e.ownerDocument||e)!==M&&N(e);return j(e,t)};n.attr=function(e,n){(e.ownerDocument||e)!==M&&N(e);var r=E.attrHandle[n.toLowerCase()],i=r&&K.call(E.attrHandle,n.toLowerCase())?r(e,n,!I):t;return i===t?b.attributes||!I?e.getAttribute(n):(i=e.getAttributeNode(n))&&i.specified?i.value:null:i};n.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)};n.uniqueSort=function(e){var t,n=[],r=0,i=0;V=!b.detectDuplicates;_=!b.sortStable&&e.slice(0);e.sort(q);if(V){for(;t=e[i++];)t===e[i]&&(r=n.push(i));for(;r--;)e.splice(n[r],1)}return e};O=n.getText=function(e){var t,n="",r=0,i=e.nodeType;if(i){if(1===i||9===i||11===i){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=O(e)}else if(3===i||4===i)return e.nodeValue}else for(;t=e[r];r++)n+=O(t);return n};E=n.selectors={cacheLength:50,createPseudo:i,match:ge,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){e[1]=e[1].replace(be,Se);e[3]=(e[4]||e[5]||"").replace(be,Se);"~="===e[2]&&(e[3]=" "+e[3]+" ");return e.slice(0,4)},CHILD:function(e){e[1]=e[1].toLowerCase();if("nth"===e[1].slice(0,3)){e[3]||n.error(e[0]);e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3]));e[5]=+(e[7]+e[8]||"odd"===e[3])}else e[3]&&n.error(e[0]);return e},PSEUDO:function(e){var n,r=!e[5]&&e[2];if(ge.CHILD.test(e[0]))return null;if(e[3]&&e[4]!==t)e[2]=e[4];else if(r&&me.test(r)&&(n=p(r,!0))&&(n=r.indexOf(")",r.length-n)-r.length)){e[0]=e[0].slice(0,n);e[2]=r.slice(0,n)}return e.slice(0,3)}},filter:{TAG:function(e){var t=e.replace(be,Se).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=z[e+" "];return t||(t=new RegExp("(^|"+ie+")"+e+"("+ie+"|$)"))&&z(e,function(e){return t.test("string"==typeof e.className&&e.className||typeof e.getAttribute!==Y&&e.getAttribute("class")||"")})},ATTR:function(e,t,r){return function(i){var a=n.attr(i,e);if(null==a)return"!="===t;if(!t)return!0;a+="";return"="===t?a===r:"!="===t?a!==r:"^="===t?r&&0===a.indexOf(r):"*="===t?r&&a.indexOf(r)>-1:"$="===t?r&&a.slice(-r.length)===r:"~="===t?(" "+a+" ").indexOf(r)>-1:"|="===t?a===r||a.slice(0,r.length+1)===r+"-":!1}},CHILD:function(e,t,n,r,i){var a="nth"!==e.slice(0,3),s="last"!==e.slice(-4),o="of-type"===t;return 1===r&&0===i?function(e){return!!e.parentNode}:function(t,n,l){var c,u,h,p,d,f,m=a!==s?"nextSibling":"previousSibling",y=t.parentNode,g=o&&t.nodeName.toLowerCase(),v=!l&&!o;if(y){if(a){for(;m;){h=t;for(;h=h[m];)if(o?h.nodeName.toLowerCase()===g:1===h.nodeType)return!1;f=m="only"===e&&!f&&"nextSibling"}return!0}f=[s?y.firstChild:y.lastChild];if(s&&v){u=y[B]||(y[B]={});c=u[e]||[];d=c[0]===U&&c[1];p=c[0]===U&&c[2];h=d&&y.childNodes[d];for(;h=++d&&h&&h[m]||(p=d=0)||f.pop();)if(1===h.nodeType&&++p&&h===t){u[e]=[U,d,p];break}}else if(v&&(c=(t[B]||(t[B]={}))[e])&&c[0]===U)p=c[1];else for(;h=++d&&h&&h[m]||(p=d=0)||f.pop();)if((o?h.nodeName.toLowerCase()===g:1===h.nodeType)&&++p){v&&((h[B]||(h[B]={}))[e]=[U,p]);if(h===t)break}p-=i;return p===r||p%r===0&&p/r>=0}}},PSEUDO:function(e,t){var r,a=E.pseudos[e]||E.setFilters[e.toLowerCase()]||n.error("unsupported pseudo: "+e);if(a[B])return a(t);if(a.length>1){r=[e,e,"",t];return E.setFilters.hasOwnProperty(e.toLowerCase())?i(function(e,n){for(var r,i=a(e,t),s=i.length;s--;){r=ne.call(e,i[s]);e[r]=!(n[r]=i[s])}}):function(e){return a(e,0,r)}}return a}},pseudos:{not:i(function(e){var t=[],n=[],r=x(e.replace(ce,"$1"));return r[B]?i(function(e,t,n,i){for(var a,s=r(e,null,i,[]),o=e.length;o--;)(a=s[o])&&(e[o]=!(t[o]=a))}):function(e,i,a){t[0]=e;r(t,null,a,n);return!n.pop()}}),has:i(function(e){return function(t){return n(e,t).length>0}}),contains:i(function(e){return function(t){return(t.textContent||t.innerText||O(t)).indexOf(e)>-1}}),lang:i(function(e){ye.test(e||"")||n.error("unsupported lang: "+e);e=e.replace(be,Se).toLowerCase();return function(t){var n;do if(n=I?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang")){n=n.toLowerCase();return n===e||0===n.indexOf(e+"-")}while((t=t.parentNode)&&1===t.nodeType);return!1}}),target:function(t){var n=e.location&&e.location.hash;return n&&n.slice(1)===t.id},root:function(e){return e===k},focus:function(e){return e===M.activeElement&&(!M.hasFocus||M.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:function(e){return e.disabled===!1},disabled:function(e){return e.disabled===!0},checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){e.parentNode&&e.parentNode.selectedIndex;return e.selected===!0},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeName>"@"||3===e.nodeType||4===e.nodeType)return!1;return!0},parent:function(e){return!E.pseudos.empty(e)},header:function(e){return Te.test(e.nodeName)},input:function(e){return Le.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||t.toLowerCase()===e.type)},first:u(function(){return[0]}),last:u(function(e,t){return[t-1]}),eq:u(function(e,t,n){return[0>n?n+t:n]}),even:u(function(e,t){for(var n=0;t>n;n+=2)e.push(n);return e}),odd:u(function(e,t){for(var n=1;t>n;n+=2)e.push(n);return e}),lt:u(function(e,t,n){for(var r=0>n?n+t:n;--r>=0;)e.push(r);return e}),gt:u(function(e,t,n){for(var r=0>n?n+t:n;++r<t;)e.push(r);return e})}};E.pseudos.nth=E.pseudos.eq;for(w in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})E.pseudos[w]=l(w);for(w in{submit:!0,reset:!0})E.pseudos[w]=c(w);h.prototype=E.filters=E.pseudos;E.setFilters=new h;x=n.compile=function(e,t){var n,r=[],i=[],a=W[e+" "];if(!a){t||(t=p(e));n=t.length;for(;n--;){a=v(t[n]);a[B]?r.push(a):i.push(a)}a=W(e,C(i,r))}return a};b.sortStable=B.split("").sort(q).join("")===B;b.detectDuplicates=V;N();b.sortDetached=a(function(e){return 1&e.compareDocumentPosition(M.createElement("div"))});a(function(e){e.innerHTML="<a href='#'></a>";return"#"===e.firstChild.getAttribute("href")})||s("type|href|height|width",function(e,t,n){return n?void 0:e.getAttribute(t,"type"===t.toLowerCase()?1:2)});b.attributes&&a(function(e){e.innerHTML="<input/>";e.firstChild.setAttribute("value","");return""===e.firstChild.getAttribute("value")})||s("value",function(e,t,n){return n||"input"!==e.nodeName.toLowerCase()?void 0:e.defaultValue});a(function(e){return null==e.getAttribute("disabled")})||s(re,function(e,t,n){var r;return n?void 0:(r=e.getAttributeNode(t))&&r.specified?r.value:e[t]===!0?t.toLowerCase():null});ue.find=n;ue.expr=n.selectors;ue.expr[":"]=ue.expr.pseudos;ue.unique=n.uniqueSort;ue.text=n.getText;ue.isXMLDoc=n.isXML;ue.contains=n.contains}(e);var Ee={};ue.Callbacks=function(e){e="string"==typeof e?Ee[e]||r(e):ue.extend({},e);var n,i,a,s,o,l,c=[],u=!e.once&&[],h=function(t){i=e.memory&&t;a=!0;o=l||0;l=0;s=c.length;n=!0;for(;c&&s>o;o++)if(c[o].apply(t[0],t[1])===!1&&e.stopOnFalse){i=!1;break}n=!1;c&&(u?u.length&&h(u.shift()):i?c=[]:p.disable())},p={add:function(){if(c){var t=c.length;!function r(t){ue.each(t,function(t,n){var i=ue.type(n);"function"===i?e.unique&&p.has(n)||c.push(n):n&&n.length&&"string"!==i&&r(n)})}(arguments);if(n)s=c.length;else if(i){l=t;h(i)}}return this},remove:function(){c&&ue.each(arguments,function(e,t){for(var r;(r=ue.inArray(t,c,r))>-1;){c.splice(r,1);if(n){s>=r&&s--;o>=r&&o--}}});return this},has:function(e){return e?ue.inArray(e,c)>-1:!(!c||!c.length)},empty:function(){c=[];s=0;return this},disable:function(){c=u=i=t;return this},disabled:function(){return!c},lock:function(){u=t;i||p.disable();return this},locked:function(){return!u},fireWith:function(e,t){if(c&&(!a||u)){t=t||[];t=[e,t.slice?t.slice():t];n?u.push(t):h(t)}return this},fire:function(){p.fireWith(this,arguments);return this},fired:function(){return!!a}};return p};ue.extend({Deferred:function(e){var t=[["resolve","done",ue.Callbacks("once memory"),"resolved"],["reject","fail",ue.Callbacks("once memory"),"rejected"],["notify","progress",ue.Callbacks("memory")]],n="pending",r={state:function(){return n},always:function(){i.done(arguments).fail(arguments);return this},then:function(){var e=arguments;return ue.Deferred(function(n){ue.each(t,function(t,a){var s=a[0],o=ue.isFunction(e[t])&&e[t];i[a[1]](function(){var e=o&&o.apply(this,arguments);e&&ue.isFunction(e.promise)?e.promise().done(n.resolve).fail(n.reject).progress(n.notify):n[s+"With"](this===r?n.promise():this,o?[e]:arguments)})});e=null}).promise()},promise:function(e){return null!=e?ue.extend(e,r):r}},i={};r.pipe=r.then;ue.each(t,function(e,a){var s=a[2],o=a[3];r[a[1]]=s.add;o&&s.add(function(){n=o},t[1^e][2].disable,t[2][2].lock);i[a[0]]=function(){i[a[0]+"With"](this===i?r:this,arguments);return this};i[a[0]+"With"]=s.fireWith});r.promise(i);e&&e.call(i,i);return i},when:function(e){var t,n,r,i=0,a=ae.call(arguments),s=a.length,o=1!==s||e&&ue.isFunction(e.promise)?s:0,l=1===o?e:ue.Deferred(),c=function(e,n,r){return function(i){n[e]=this;r[e]=arguments.length>1?ae.call(arguments):i;r===t?l.notifyWith(n,r):--o||l.resolveWith(n,r)}};if(s>1){t=new Array(s);n=new Array(s);r=new Array(s);for(;s>i;i++)a[i]&&ue.isFunction(a[i].promise)?a[i].promise().done(c(i,r,a)).fail(l.reject).progress(c(i,n,t)):--o}o||l.resolveWith(r,a);return l.promise()}});ue.support=function(t){var n,r,i,a,s,o,l,c,u,h=K.createElement("div");h.setAttribute("className","t");h.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>";n=h.getElementsByTagName("*")||[];r=h.getElementsByTagName("a")[0];if(!r||!r.style||!n.length)return t;a=K.createElement("select");o=a.appendChild(K.createElement("option"));i=h.getElementsByTagName("input")[0];r.style.cssText="top:1px;float:left;opacity:.5";t.getSetAttribute="t"!==h.className;t.leadingWhitespace=3===h.firstChild.nodeType;t.tbody=!h.getElementsByTagName("tbody").length;t.htmlSerialize=!!h.getElementsByTagName("link").length;t.style=/top/.test(r.getAttribute("style"));t.hrefNormalized="/a"===r.getAttribute("href");t.opacity=/^0.5/.test(r.style.opacity);t.cssFloat=!!r.style.cssFloat;t.checkOn=!!i.value;t.optSelected=o.selected;t.enctype=!!K.createElement("form").enctype;t.html5Clone="<:nav></:nav>"!==K.createElement("nav").cloneNode(!0).outerHTML;t.inlineBlockNeedsLayout=!1;t.shrinkWrapBlocks=!1;t.pixelPosition=!1;t.deleteExpando=!0;t.noCloneEvent=!0;t.reliableMarginRight=!0;t.boxSizingReliable=!0;i.checked=!0;t.noCloneChecked=i.cloneNode(!0).checked;a.disabled=!0;t.optDisabled=!o.disabled;try{delete h.test}catch(p){t.deleteExpando=!1}i=K.createElement("input");i.setAttribute("value","");t.input=""===i.getAttribute("value");i.value="t";i.setAttribute("type","radio");t.radioValue="t"===i.value;i.setAttribute("checked","t");i.setAttribute("name","t");s=K.createDocumentFragment();s.appendChild(i);t.appendChecked=i.checked;t.checkClone=s.cloneNode(!0).cloneNode(!0).lastChild.checked;if(h.attachEvent){h.attachEvent("onclick",function(){t.noCloneEvent=!1});h.cloneNode(!0).click()}for(u in{submit:!0,change:!0,focusin:!0}){h.setAttribute(l="on"+u,"t");t[u+"Bubbles"]=l in e||h.attributes[l].expando===!1}h.style.backgroundClip="content-box";h.cloneNode(!0).style.backgroundClip="";t.clearCloneStyle="content-box"===h.style.backgroundClip;for(u in ue(t))break;t.ownLast="0"!==u;ue(function(){var n,r,i,a="padding:0;margin:0;border:0;display:block;box-sizing:content-box;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;",s=K.getElementsByTagName("body")[0];if(s){n=K.createElement("div");n.style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px";s.appendChild(n).appendChild(h);h.innerHTML="<table><tr><td></td><td>t</td></tr></table>";i=h.getElementsByTagName("td");i[0].style.cssText="padding:0;margin:0;border:0;display:none";c=0===i[0].offsetHeight;i[0].style.display="";i[1].style.display="none";t.reliableHiddenOffsets=c&&0===i[0].offsetHeight;h.innerHTML="";h.style.cssText="box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;";ue.swap(s,null!=s.style.zoom?{zoom:1}:{},function(){t.boxSizing=4===h.offsetWidth});if(e.getComputedStyle){t.pixelPosition="1%"!==(e.getComputedStyle(h,null)||{}).top;t.boxSizingReliable="4px"===(e.getComputedStyle(h,null)||{width:"4px"}).width;r=h.appendChild(K.createElement("div"));r.style.cssText=h.style.cssText=a;r.style.marginRight=r.style.width="0";h.style.width="1px";t.reliableMarginRight=!parseFloat((e.getComputedStyle(r,null)||{}).marginRight)}if(typeof h.style.zoom!==Y){h.innerHTML="";h.style.cssText=a+"width:1px;padding:1px;display:inline;zoom:1";t.inlineBlockNeedsLayout=3===h.offsetWidth;h.style.display="block";h.innerHTML="<div></div>";h.firstChild.style.width="5px";t.shrinkWrapBlocks=3!==h.offsetWidth;t.inlineBlockNeedsLayout&&(s.style.zoom=1)}s.removeChild(n);n=h=i=r=null}});n=a=s=o=r=i=null;return t}({});var Oe=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,Ae=/([A-Z])/g;ue.extend({cache:{},noData:{applet:!0,embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"},hasData:function(e){e=e.nodeType?ue.cache[e[ue.expando]]:e[ue.expando];return!!e&&!o(e)},data:function(e,t,n){return i(e,t,n)},removeData:function(e,t){return a(e,t)},_data:function(e,t,n){return i(e,t,n,!0)},_removeData:function(e,t){return a(e,t,!0)},acceptData:function(e){if(e.nodeType&&1!==e.nodeType&&9!==e.nodeType)return!1;var t=e.nodeName&&ue.noData[e.nodeName.toLowerCase()];return!t||t!==!0&&e.getAttribute("classid")===t}});ue.fn.extend({data:function(e,n){var r,i,a=null,o=0,l=this[0];if(e===t){if(this.length){a=ue.data(l);if(1===l.nodeType&&!ue._data(l,"parsedAttrs")){r=l.attributes;for(;o<r.length;o++){i=r[o].name;if(0===i.indexOf("data-")){i=ue.camelCase(i.slice(5));s(l,i,a[i])}}ue._data(l,"parsedAttrs",!0)}}return a}return"object"==typeof e?this.each(function(){ue.data(this,e)}):arguments.length>1?this.each(function(){ue.data(this,e,n)}):l?s(l,e,ue.data(l,e)):null},removeData:function(e){return this.each(function(){ue.removeData(this,e)})}});ue.extend({queue:function(e,t,n){var r;if(e){t=(t||"fx")+"queue";r=ue._data(e,t);n&&(!r||ue.isArray(n)?r=ue._data(e,t,ue.makeArray(n)):r.push(n));return r||[]}},dequeue:function(e,t){t=t||"fx";var n=ue.queue(e,t),r=n.length,i=n.shift(),a=ue._queueHooks(e,t),s=function(){ue.dequeue(e,t)};if("inprogress"===i){i=n.shift();r--}if(i){"fx"===t&&n.unshift("inprogress");delete a.stop;i.call(e,s,a)}!r&&a&&a.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return ue._data(e,n)||ue._data(e,n,{empty:ue.Callbacks("once memory").add(function(){ue._removeData(e,t+"queue");ue._removeData(e,n)})})}});ue.fn.extend({queue:function(e,n){var r=2;if("string"!=typeof e){n=e;e="fx";r--}return arguments.length<r?ue.queue(this[0],e):n===t?this:this.each(function(){var t=ue.queue(this,e,n);ue._queueHooks(this,e);"fx"===e&&"inprogress"!==t[0]&&ue.dequeue(this,e)})},dequeue:function(e){return this.each(function(){ue.dequeue(this,e)})},delay:function(e,t){e=ue.fx?ue.fx.speeds[e]||e:e;t=t||"fx";return this.queue(t,function(t,n){var r=setTimeout(t,e);n.stop=function(){clearTimeout(r)}})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,n){var r,i=1,a=ue.Deferred(),s=this,o=this.length,l=function(){--i||a.resolveWith(s,[s])};if("string"!=typeof e){n=e;e=t}e=e||"fx";for(;o--;){r=ue._data(s[o],e+"queueHooks");if(r&&r.empty){i++;r.empty.add(l)}}l();return a.promise(n)}});var xe,Pe,_e=/[\t\r\n\f]/g,Ne=/\r/g,Me=/^(?:input|select|textarea|button|object)$/i,ke=/^(?:a|area)$/i,Ie=/^(?:checked|selected)$/i,Re=ue.support.getSetAttribute,De=ue.support.input;ue.fn.extend({attr:function(e,t){return ue.access(this,ue.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){ue.removeAttr(this,e)})},prop:function(e,t){return ue.access(this,ue.prop,e,t,arguments.length>1)},removeProp:function(e){e=ue.propFix[e]||e;return this.each(function(){try{this[e]=t;delete this[e]}catch(n){}})},addClass:function(e){var t,n,r,i,a,s=0,o=this.length,l="string"==typeof e&&e;if(ue.isFunction(e))return this.each(function(t){ue(this).addClass(e.call(this,t,this.className))});if(l){t=(e||"").match(pe)||[];for(;o>s;s++){n=this[s];r=1===n.nodeType&&(n.className?(" "+n.className+" ").replace(_e," "):" ");if(r){a=0;for(;i=t[a++];)r.indexOf(" "+i+" ")<0&&(r+=i+" ");n.className=ue.trim(r)}}}return this},removeClass:function(e){var t,n,r,i,a,s=0,o=this.length,l=0===arguments.length||"string"==typeof e&&e;if(ue.isFunction(e))return this.each(function(t){ue(this).removeClass(e.call(this,t,this.className))});if(l){t=(e||"").match(pe)||[];for(;o>s;s++){n=this[s];r=1===n.nodeType&&(n.className?(" "+n.className+" ").replace(_e," "):"");if(r){a=0;for(;i=t[a++];)for(;r.indexOf(" "+i+" ")>=0;)r=r.replace(" "+i+" "," ");n.className=e?ue.trim(r):""}}}return this},toggleClass:function(e,t){var n=typeof e;return"boolean"==typeof t&&"string"===n?t?this.addClass(e):this.removeClass(e):this.each(ue.isFunction(e)?function(n){ue(this).toggleClass(e.call(this,n,this.className,t),t)}:function(){if("string"===n)for(var t,r=0,i=ue(this),a=e.match(pe)||[];t=a[r++];)i.hasClass(t)?i.removeClass(t):i.addClass(t);else if(n===Y||"boolean"===n){this.className&&ue._data(this,"__className__",this.className);this.className=this.className||e===!1?"":ue._data(this,"__className__")||""}})},hasClass:function(e){for(var t=" "+e+" ",n=0,r=this.length;r>n;n++)if(1===this[n].nodeType&&(" "+this[n].className+" ").replace(_e," ").indexOf(t)>=0)return!0;return!1},val:function(e){var n,r,i,a=this[0];if(arguments.length){i=ue.isFunction(e);return this.each(function(n){var a;if(1===this.nodeType){a=i?e.call(this,n,ue(this).val()):e;null==a?a="":"number"==typeof a?a+="":ue.isArray(a)&&(a=ue.map(a,function(e){return null==e?"":e+""}));r=ue.valHooks[this.type]||ue.valHooks[this.nodeName.toLowerCase()];r&&"set"in r&&r.set(this,a,"value")!==t||(this.value=a)}})}if(a){r=ue.valHooks[a.type]||ue.valHooks[a.nodeName.toLowerCase()];if(r&&"get"in r&&(n=r.get(a,"value"))!==t)return n;n=a.value;return"string"==typeof n?n.replace(Ne,""):null==n?"":n}}});ue.extend({valHooks:{option:{get:function(e){var t=ue.find.attr(e,"value");return null!=t?t:e.text}},select:{get:function(e){for(var t,n,r=e.options,i=e.selectedIndex,a="select-one"===e.type||0>i,s=a?null:[],o=a?i+1:r.length,l=0>i?o:a?i:0;o>l;l++){n=r[l];if(!(!n.selected&&l!==i||(ue.support.optDisabled?n.disabled:null!==n.getAttribute("disabled"))||n.parentNode.disabled&&ue.nodeName(n.parentNode,"optgroup"))){t=ue(n).val();if(a)return t;s.push(t)}}return s},set:function(e,t){for(var n,r,i=e.options,a=ue.makeArray(t),s=i.length;s--;){r=i[s];(r.selected=ue.inArray(ue(r).val(),a)>=0)&&(n=!0)}n||(e.selectedIndex=-1);return a}}},attr:function(e,n,r){var i,a,s=e.nodeType;if(e&&3!==s&&8!==s&&2!==s){if(typeof e.getAttribute===Y)return ue.prop(e,n,r);if(1!==s||!ue.isXMLDoc(e)){n=n.toLowerCase();i=ue.attrHooks[n]||(ue.expr.match.bool.test(n)?Pe:xe)}if(r===t){if(i&&"get"in i&&null!==(a=i.get(e,n)))return a;a=ue.find.attr(e,n);return null==a?t:a}if(null!==r){if(i&&"set"in i&&(a=i.set(e,r,n))!==t)return a;e.setAttribute(n,r+"");return r}ue.removeAttr(e,n)}},removeAttr:function(e,t){var n,r,i=0,a=t&&t.match(pe);if(a&&1===e.nodeType)for(;n=a[i++];){r=ue.propFix[n]||n;ue.expr.match.bool.test(n)?De&&Re||!Ie.test(n)?e[r]=!1:e[ue.camelCase("default-"+n)]=e[r]=!1:ue.attr(e,n,"");e.removeAttribute(Re?n:r)}},attrHooks:{type:{set:function(e,t){if(!ue.support.radioValue&&"radio"===t&&ue.nodeName(e,"input")){var n=e.value;e.setAttribute("type",t);n&&(e.value=n);return t}}}},propFix:{"for":"htmlFor","class":"className"},prop:function(e,n,r){var i,a,s,o=e.nodeType;if(e&&3!==o&&8!==o&&2!==o){s=1!==o||!ue.isXMLDoc(e);if(s){n=ue.propFix[n]||n;a=ue.propHooks[n]}return r!==t?a&&"set"in a&&(i=a.set(e,r,n))!==t?i:e[n]=r:a&&"get"in a&&null!==(i=a.get(e,n))?i:e[n]}},propHooks:{tabIndex:{get:function(e){var t=ue.find.attr(e,"tabindex");return t?parseInt(t,10):Me.test(e.nodeName)||ke.test(e.nodeName)&&e.href?0:-1}}}});Pe={set:function(e,t,n){t===!1?ue.removeAttr(e,n):De&&Re||!Ie.test(n)?e.setAttribute(!Re&&ue.propFix[n]||n,n):e[ue.camelCase("default-"+n)]=e[n]=!0;return n}};ue.each(ue.expr.match.bool.source.match(/\w+/g),function(e,n){var r=ue.expr.attrHandle[n]||ue.find.attr;ue.expr.attrHandle[n]=De&&Re||!Ie.test(n)?function(e,n,i){var a=ue.expr.attrHandle[n],s=i?t:(ue.expr.attrHandle[n]=t)!=r(e,n,i)?n.toLowerCase():null;ue.expr.attrHandle[n]=a;return s}:function(e,n,r){return r?t:e[ue.camelCase("default-"+n)]?n.toLowerCase():null}});De&&Re||(ue.attrHooks.value={set:function(e,t,n){if(!ue.nodeName(e,"input"))return xe&&xe.set(e,t,n);e.defaultValue=t;return void 0}});if(!Re){xe={set:function(e,n,r){var i=e.getAttributeNode(r);i||e.setAttributeNode(i=e.ownerDocument.createAttribute(r));i.value=n+="";return"value"===r||n===e.getAttribute(r)?n:t}};ue.expr.attrHandle.id=ue.expr.attrHandle.name=ue.expr.attrHandle.coords=function(e,n,r){var i;return r?t:(i=e.getAttributeNode(n))&&""!==i.value?i.value:null};ue.valHooks.button={get:function(e,n){var r=e.getAttributeNode(n);return r&&r.specified?r.value:t;

},set:xe.set};ue.attrHooks.contenteditable={set:function(e,t,n){xe.set(e,""===t?!1:t,n)}};ue.each(["width","height"],function(e,t){ue.attrHooks[t]={set:function(e,n){if(""===n){e.setAttribute(t,"auto");return n}}}})}ue.support.hrefNormalized||ue.each(["href","src"],function(e,t){ue.propHooks[t]={get:function(e){return e.getAttribute(t,4)}}});ue.support.style||(ue.attrHooks.style={get:function(e){return e.style.cssText||t},set:function(e,t){return e.style.cssText=t+""}});ue.support.optSelected||(ue.propHooks.selected={get:function(e){var t=e.parentNode;if(t){t.selectedIndex;t.parentNode&&t.parentNode.selectedIndex}return null}});ue.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){ue.propFix[this.toLowerCase()]=this});ue.support.enctype||(ue.propFix.enctype="encoding");ue.each(["radio","checkbox"],function(){ue.valHooks[this]={set:function(e,t){return ue.isArray(t)?e.checked=ue.inArray(ue(e).val(),t)>=0:void 0}};ue.support.checkOn||(ue.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})});var Fe=/^(?:input|select|textarea)$/i,je=/^key/,Be=/^(?:mouse|contextmenu)|click/,$e=/^(?:focusinfocus|focusoutblur)$/,Ue=/^([^.]*)(?:\.(.+)|)$/;ue.event={global:{},add:function(e,n,r,i,a){var s,o,l,c,u,h,p,d,f,m,y,g=ue._data(e);if(g){if(r.handler){c=r;r=c.handler;a=c.selector}r.guid||(r.guid=ue.guid++);(o=g.events)||(o=g.events={});if(!(h=g.handle)){h=g.handle=function(e){return typeof ue===Y||e&&ue.event.triggered===e.type?t:ue.event.dispatch.apply(h.elem,arguments)};h.elem=e}n=(n||"").match(pe)||[""];l=n.length;for(;l--;){s=Ue.exec(n[l])||[];f=y=s[1];m=(s[2]||"").split(".").sort();if(f){u=ue.event.special[f]||{};f=(a?u.delegateType:u.bindType)||f;u=ue.event.special[f]||{};p=ue.extend({type:f,origType:y,data:i,handler:r,guid:r.guid,selector:a,needsContext:a&&ue.expr.match.needsContext.test(a),namespace:m.join(".")},c);if(!(d=o[f])){d=o[f]=[];d.delegateCount=0;u.setup&&u.setup.call(e,i,m,h)!==!1||(e.addEventListener?e.addEventListener(f,h,!1):e.attachEvent&&e.attachEvent("on"+f,h))}if(u.add){u.add.call(e,p);p.handler.guid||(p.handler.guid=r.guid)}a?d.splice(d.delegateCount++,0,p):d.push(p);ue.event.global[f]=!0}}e=null}},remove:function(e,t,n,r,i){var a,s,o,l,c,u,h,p,d,f,m,y=ue.hasData(e)&&ue._data(e);if(y&&(u=y.events)){t=(t||"").match(pe)||[""];c=t.length;for(;c--;){o=Ue.exec(t[c])||[];d=m=o[1];f=(o[2]||"").split(".").sort();if(d){h=ue.event.special[d]||{};d=(r?h.delegateType:h.bindType)||d;p=u[d]||[];o=o[2]&&new RegExp("(^|\\.)"+f.join("\\.(?:.*\\.|)")+"(\\.|$)");l=a=p.length;for(;a--;){s=p[a];if(!(!i&&m!==s.origType||n&&n.guid!==s.guid||o&&!o.test(s.namespace)||r&&r!==s.selector&&("**"!==r||!s.selector))){p.splice(a,1);s.selector&&p.delegateCount--;h.remove&&h.remove.call(e,s)}}if(l&&!p.length){h.teardown&&h.teardown.call(e,f,y.handle)!==!1||ue.removeEvent(e,d,y.handle);delete u[d]}}else for(d in u)ue.event.remove(e,d+t[c],n,r,!0)}if(ue.isEmptyObject(u)){delete y.handle;ue._removeData(e,"events")}}},trigger:function(n,r,i,a){var s,o,l,c,u,h,p,d=[i||K],f=le.call(n,"type")?n.type:n,m=le.call(n,"namespace")?n.namespace.split("."):[];l=h=i=i||K;if(3!==i.nodeType&&8!==i.nodeType&&!$e.test(f+ue.event.triggered)){if(f.indexOf(".")>=0){m=f.split(".");f=m.shift();m.sort()}o=f.indexOf(":")<0&&"on"+f;n=n[ue.expando]?n:new ue.Event(f,"object"==typeof n&&n);n.isTrigger=a?2:3;n.namespace=m.join(".");n.namespace_re=n.namespace?new RegExp("(^|\\.)"+m.join("\\.(?:.*\\.|)")+"(\\.|$)"):null;n.result=t;n.target||(n.target=i);r=null==r?[n]:ue.makeArray(r,[n]);u=ue.event.special[f]||{};if(a||!u.trigger||u.trigger.apply(i,r)!==!1){if(!a&&!u.noBubble&&!ue.isWindow(i)){c=u.delegateType||f;$e.test(c+f)||(l=l.parentNode);for(;l;l=l.parentNode){d.push(l);h=l}h===(i.ownerDocument||K)&&d.push(h.defaultView||h.parentWindow||e)}p=0;for(;(l=d[p++])&&!n.isPropagationStopped();){n.type=p>1?c:u.bindType||f;s=(ue._data(l,"events")||{})[n.type]&&ue._data(l,"handle");s&&s.apply(l,r);s=o&&l[o];s&&ue.acceptData(l)&&s.apply&&s.apply(l,r)===!1&&n.preventDefault()}n.type=f;if(!a&&!n.isDefaultPrevented()&&(!u._default||u._default.apply(d.pop(),r)===!1)&&ue.acceptData(i)&&o&&i[f]&&!ue.isWindow(i)){h=i[o];h&&(i[o]=null);ue.event.triggered=f;try{i[f]()}catch(y){}ue.event.triggered=t;h&&(i[o]=h)}return n.result}}},dispatch:function(e){e=ue.event.fix(e);var n,r,i,a,s,o=[],l=ae.call(arguments),c=(ue._data(this,"events")||{})[e.type]||[],u=ue.event.special[e.type]||{};l[0]=e;e.delegateTarget=this;if(!u.preDispatch||u.preDispatch.call(this,e)!==!1){o=ue.event.handlers.call(this,e,c);n=0;for(;(a=o[n++])&&!e.isPropagationStopped();){e.currentTarget=a.elem;s=0;for(;(i=a.handlers[s++])&&!e.isImmediatePropagationStopped();)if(!e.namespace_re||e.namespace_re.test(i.namespace)){e.handleObj=i;e.data=i.data;r=((ue.event.special[i.origType]||{}).handle||i.handler).apply(a.elem,l);if(r!==t&&(e.result=r)===!1){e.preventDefault();e.stopPropagation()}}}u.postDispatch&&u.postDispatch.call(this,e);return e.result}},handlers:function(e,n){var r,i,a,s,o=[],l=n.delegateCount,c=e.target;if(l&&c.nodeType&&(!e.button||"click"!==e.type))for(;c!=this;c=c.parentNode||this)if(1===c.nodeType&&(c.disabled!==!0||"click"!==e.type)){a=[];for(s=0;l>s;s++){i=n[s];r=i.selector+" ";a[r]===t&&(a[r]=i.needsContext?ue(r,this).index(c)>=0:ue.find(r,this,null,[c]).length);a[r]&&a.push(i)}a.length&&o.push({elem:c,handlers:a})}l<n.length&&o.push({elem:this,handlers:n.slice(l)});return o},fix:function(e){if(e[ue.expando])return e;var t,n,r,i=e.type,a=e,s=this.fixHooks[i];s||(this.fixHooks[i]=s=Be.test(i)?this.mouseHooks:je.test(i)?this.keyHooks:{});r=s.props?this.props.concat(s.props):this.props;e=new ue.Event(a);t=r.length;for(;t--;){n=r[t];e[n]=a[n]}e.target||(e.target=a.srcElement||K);3===e.target.nodeType&&(e.target=e.target.parentNode);e.metaKey=!!e.metaKey;return s.filter?s.filter(e,a):e},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){null==e.which&&(e.which=null!=t.charCode?t.charCode:t.keyCode);return e}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,n){var r,i,a,s=n.button,o=n.fromElement;if(null==e.pageX&&null!=n.clientX){i=e.target.ownerDocument||K;a=i.documentElement;r=i.body;e.pageX=n.clientX+(a&&a.scrollLeft||r&&r.scrollLeft||0)-(a&&a.clientLeft||r&&r.clientLeft||0);e.pageY=n.clientY+(a&&a.scrollTop||r&&r.scrollTop||0)-(a&&a.clientTop||r&&r.clientTop||0)}!e.relatedTarget&&o&&(e.relatedTarget=o===e.target?n.toElement:o);e.which||s===t||(e.which=1&s?1:2&s?3:4&s?2:0);return e}},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==u()&&this.focus)try{this.focus();return!1}catch(e){}},delegateType:"focusin"},blur:{trigger:function(){if(this===u()&&this.blur){this.blur();return!1}},delegateType:"focusout"},click:{trigger:function(){if(ue.nodeName(this,"input")&&"checkbox"===this.type&&this.click){this.click();return!1}},_default:function(e){return ue.nodeName(e.target,"a")}},beforeunload:{postDispatch:function(e){e.result!==t&&(e.originalEvent.returnValue=e.result)}}},simulate:function(e,t,n,r){var i=ue.extend(new ue.Event,n,{type:e,isSimulated:!0,originalEvent:{}});r?ue.event.trigger(i,null,t):ue.event.dispatch.call(t,i);i.isDefaultPrevented()&&n.preventDefault()}};ue.removeEvent=K.removeEventListener?function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n,!1)}:function(e,t,n){var r="on"+t;if(e.detachEvent){typeof e[r]===Y&&(e[r]=null);e.detachEvent(r,n)}};ue.Event=function(e,t){if(!(this instanceof ue.Event))return new ue.Event(e,t);if(e&&e.type){this.originalEvent=e;this.type=e.type;this.isDefaultPrevented=e.defaultPrevented||e.returnValue===!1||e.getPreventDefault&&e.getPreventDefault()?l:c}else this.type=e;t&&ue.extend(this,t);this.timeStamp=e&&e.timeStamp||ue.now();this[ue.expando]=!0};ue.Event.prototype={isDefaultPrevented:c,isPropagationStopped:c,isImmediatePropagationStopped:c,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=l;e&&(e.preventDefault?e.preventDefault():e.returnValue=!1)},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=l;if(e){e.stopPropagation&&e.stopPropagation();e.cancelBubble=!0}},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=l;this.stopPropagation()}};ue.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,t){ue.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,r=this,i=e.relatedTarget,a=e.handleObj;if(!i||i!==r&&!ue.contains(r,i)){e.type=a.origType;n=a.handler.apply(this,arguments);e.type=t}return n}}});ue.support.submitBubbles||(ue.event.special.submit={setup:function(){if(ue.nodeName(this,"form"))return!1;ue.event.add(this,"click._submit keypress._submit",function(e){var n=e.target,r=ue.nodeName(n,"input")||ue.nodeName(n,"button")?n.form:t;if(r&&!ue._data(r,"submitBubbles")){ue.event.add(r,"submit._submit",function(e){e._submit_bubble=!0});ue._data(r,"submitBubbles",!0)}});return void 0},postDispatch:function(e){if(e._submit_bubble){delete e._submit_bubble;this.parentNode&&!e.isTrigger&&ue.event.simulate("submit",this.parentNode,e,!0)}},teardown:function(){if(ue.nodeName(this,"form"))return!1;ue.event.remove(this,"._submit");return void 0}});ue.support.changeBubbles||(ue.event.special.change={setup:function(){if(Fe.test(this.nodeName)){if("checkbox"===this.type||"radio"===this.type){ue.event.add(this,"propertychange._change",function(e){"checked"===e.originalEvent.propertyName&&(this._just_changed=!0)});ue.event.add(this,"click._change",function(e){this._just_changed&&!e.isTrigger&&(this._just_changed=!1);ue.event.simulate("change",this,e,!0)})}return!1}ue.event.add(this,"beforeactivate._change",function(e){var t=e.target;if(Fe.test(t.nodeName)&&!ue._data(t,"changeBubbles")){ue.event.add(t,"change._change",function(e){!this.parentNode||e.isSimulated||e.isTrigger||ue.event.simulate("change",this.parentNode,e,!0)});ue._data(t,"changeBubbles",!0)}})},handle:function(e){var t=e.target;return this!==t||e.isSimulated||e.isTrigger||"radio"!==t.type&&"checkbox"!==t.type?e.handleObj.handler.apply(this,arguments):void 0},teardown:function(){ue.event.remove(this,"._change");return!Fe.test(this.nodeName)}});ue.support.focusinBubbles||ue.each({focus:"focusin",blur:"focusout"},function(e,t){var n=0,r=function(e){ue.event.simulate(t,e.target,ue.event.fix(e),!0)};ue.event.special[t]={setup:function(){0===n++&&K.addEventListener(e,r,!0)},teardown:function(){0===--n&&K.removeEventListener(e,r,!0)}}});ue.fn.extend({on:function(e,n,r,i,a){var s,o;if("object"==typeof e){if("string"!=typeof n){r=r||n;n=t}for(s in e)this.on(s,n,r,e[s],a);return this}if(null==r&&null==i){i=n;r=n=t}else if(null==i)if("string"==typeof n){i=r;r=t}else{i=r;r=n;n=t}if(i===!1)i=c;else if(!i)return this;if(1===a){o=i;i=function(e){ue().off(e);return o.apply(this,arguments)};i.guid=o.guid||(o.guid=ue.guid++)}return this.each(function(){ue.event.add(this,e,i,r,n)})},one:function(e,t,n,r){return this.on(e,t,n,r,1)},off:function(e,n,r){var i,a;if(e&&e.preventDefault&&e.handleObj){i=e.handleObj;ue(e.delegateTarget).off(i.namespace?i.origType+"."+i.namespace:i.origType,i.selector,i.handler);return this}if("object"==typeof e){for(a in e)this.off(a,n,e[a]);return this}if(n===!1||"function"==typeof n){r=n;n=t}r===!1&&(r=c);return this.each(function(){ue.event.remove(this,e,r,n)})},trigger:function(e,t){return this.each(function(){ue.event.trigger(e,t,this)})},triggerHandler:function(e,t){var n=this[0];return n?ue.event.trigger(e,t,n,!0):void 0}});var Ge=/^.[^:#\[\.,]*$/,ze=/^(?:parents|prev(?:Until|All))/,He=ue.expr.match.needsContext,We={children:!0,contents:!0,next:!0,prev:!0};ue.fn.extend({find:function(e){var t,n=[],r=this,i=r.length;if("string"!=typeof e)return this.pushStack(ue(e).filter(function(){for(t=0;i>t;t++)if(ue.contains(r[t],this))return!0}));for(t=0;i>t;t++)ue.find(e,r[t],n);n=this.pushStack(i>1?ue.unique(n):n);n.selector=this.selector?this.selector+" "+e:e;return n},has:function(e){var t,n=ue(e,this),r=n.length;return this.filter(function(){for(t=0;r>t;t++)if(ue.contains(this,n[t]))return!0})},not:function(e){return this.pushStack(p(this,e||[],!0))},filter:function(e){return this.pushStack(p(this,e||[],!1))},is:function(e){return!!p(this,"string"==typeof e&&He.test(e)?ue(e):e||[],!1).length},closest:function(e,t){for(var n,r=0,i=this.length,a=[],s=He.test(e)||"string"!=typeof e?ue(e,t||this.context):0;i>r;r++)for(n=this[r];n&&n!==t;n=n.parentNode)if(n.nodeType<11&&(s?s.index(n)>-1:1===n.nodeType&&ue.find.matchesSelector(n,e))){n=a.push(n);break}return this.pushStack(a.length>1?ue.unique(a):a)},index:function(e){return e?"string"==typeof e?ue.inArray(this[0],ue(e)):ue.inArray(e.jquery?e[0]:e,this):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){var n="string"==typeof e?ue(e,t):ue.makeArray(e&&e.nodeType?[e]:e),r=ue.merge(this.get(),n);return this.pushStack(ue.unique(r))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}});ue.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return ue.dir(e,"parentNode")},parentsUntil:function(e,t,n){return ue.dir(e,"parentNode",n)},next:function(e){return h(e,"nextSibling")},prev:function(e){return h(e,"previousSibling")},nextAll:function(e){return ue.dir(e,"nextSibling")},prevAll:function(e){return ue.dir(e,"previousSibling")},nextUntil:function(e,t,n){return ue.dir(e,"nextSibling",n)},prevUntil:function(e,t,n){return ue.dir(e,"previousSibling",n)},siblings:function(e){return ue.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return ue.sibling(e.firstChild)},contents:function(e){return ue.nodeName(e,"iframe")?e.contentDocument||e.contentWindow.document:ue.merge([],e.childNodes)}},function(e,t){ue.fn[e]=function(n,r){var i=ue.map(this,t,n);"Until"!==e.slice(-5)&&(r=n);r&&"string"==typeof r&&(i=ue.filter(r,i));if(this.length>1){We[e]||(i=ue.unique(i));ze.test(e)&&(i=i.reverse())}return this.pushStack(i)}});ue.extend({filter:function(e,t,n){var r=t[0];n&&(e=":not("+e+")");return 1===t.length&&1===r.nodeType?ue.find.matchesSelector(r,e)?[r]:[]:ue.find.matches(e,ue.grep(t,function(e){return 1===e.nodeType}))},dir:function(e,n,r){for(var i=[],a=e[n];a&&9!==a.nodeType&&(r===t||1!==a.nodeType||!ue(a).is(r));){1===a.nodeType&&i.push(a);a=a[n]}return i},sibling:function(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n}});var Ve="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",qe=/ jQuery\d+="(?:null|\d+)"/g,Ye=new RegExp("<(?:"+Ve+")[\\s/>]","i"),Xe=/^\s+/,Ke=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,Qe=/<([\w:]+)/,Je=/<tbody/i,Ze=/<|&#?\w+;/,et=/<(?:script|style|link)/i,tt=/^(?:checkbox|radio)$/i,nt=/checked\s*(?:[^=]|=\s*.checked.)/i,rt=/^$|\/(?:java|ecma)script/i,it=/^true\/(.*)/,at=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,st={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:ue.support.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]},ot=d(K),lt=ot.appendChild(K.createElement("div"));st.optgroup=st.option;st.tbody=st.tfoot=st.colgroup=st.caption=st.thead;st.th=st.td;ue.fn.extend({text:function(e){return ue.access(this,function(e){return e===t?ue.text(this):this.empty().append((this[0]&&this[0].ownerDocument||K).createTextNode(e))},null,e,arguments.length)},append:function(){return this.domManip(arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=f(this,e);t.appendChild(e)}})},prepend:function(){return this.domManip(arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=f(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},remove:function(e,t){for(var n,r=e?ue.filter(e,this):this,i=0;null!=(n=r[i]);i++){t||1!==n.nodeType||ue.cleanData(L(n));if(n.parentNode){t&&ue.contains(n.ownerDocument,n)&&g(L(n,"script"));n.parentNode.removeChild(n)}}return this},empty:function(){for(var e,t=0;null!=(e=this[t]);t++){1===e.nodeType&&ue.cleanData(L(e,!1));for(;e.firstChild;)e.removeChild(e.firstChild);e.options&&ue.nodeName(e,"select")&&(e.options.length=0)}return this},clone:function(e,t){e=null==e?!1:e;t=null==t?e:t;return this.map(function(){return ue.clone(this,e,t)})},html:function(e){return ue.access(this,function(e){var n=this[0]||{},r=0,i=this.length;if(e===t)return 1===n.nodeType?n.innerHTML.replace(qe,""):t;if(!("string"!=typeof e||et.test(e)||!ue.support.htmlSerialize&&Ye.test(e)||!ue.support.leadingWhitespace&&Xe.test(e)||st[(Qe.exec(e)||["",""])[1].toLowerCase()])){e=e.replace(Ke,"<$1></$2>");try{for(;i>r;r++){n=this[r]||{};if(1===n.nodeType){ue.cleanData(L(n,!1));n.innerHTML=e}}n=0}catch(a){}}n&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var e=ue.map(this,function(e){return[e.nextSibling,e.parentNode]}),t=0;this.domManip(arguments,function(n){var r=e[t++],i=e[t++];if(i){r&&r.parentNode!==i&&(r=this.nextSibling);ue(this).remove();i.insertBefore(n,r)}},!0);return t?this:this.remove()},detach:function(e){return this.remove(e,!0)},domManip:function(e,t,n){e=re.apply([],e);var r,i,a,s,o,l,c=0,u=this.length,h=this,p=u-1,d=e[0],f=ue.isFunction(d);if(f||!(1>=u||"string"!=typeof d||ue.support.checkClone)&&nt.test(d))return this.each(function(r){var i=h.eq(r);f&&(e[0]=d.call(this,r,i.html()));i.domManip(e,t,n)});if(u){l=ue.buildFragment(e,this[0].ownerDocument,!1,!n&&this);r=l.firstChild;1===l.childNodes.length&&(l=r);if(r){s=ue.map(L(l,"script"),m);a=s.length;for(;u>c;c++){i=l;if(c!==p){i=ue.clone(i,!0,!0);a&&ue.merge(s,L(i,"script"))}t.call(this[c],i,c)}if(a){o=s[s.length-1].ownerDocument;ue.map(s,y);for(c=0;a>c;c++){i=s[c];rt.test(i.type||"")&&!ue._data(i,"globalEval")&&ue.contains(o,i)&&(i.src?ue._evalUrl(i.src):ue.globalEval((i.text||i.textContent||i.innerHTML||"").replace(at,"")))}}l=r=null}}return this}});ue.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){ue.fn[e]=function(e){for(var n,r=0,i=[],a=ue(e),s=a.length-1;s>=r;r++){n=r===s?this:this.clone(!0);ue(a[r])[t](n);ie.apply(i,n.get())}return this.pushStack(i)}});ue.extend({clone:function(e,t,n){var r,i,a,s,o,l=ue.contains(e.ownerDocument,e);if(ue.support.html5Clone||ue.isXMLDoc(e)||!Ye.test("<"+e.nodeName+">"))a=e.cloneNode(!0);else{lt.innerHTML=e.outerHTML;lt.removeChild(a=lt.firstChild)}if(!(ue.support.noCloneEvent&&ue.support.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||ue.isXMLDoc(e))){r=L(a);o=L(e);for(s=0;null!=(i=o[s]);++s)r[s]&&C(i,r[s])}if(t)if(n){o=o||L(e);r=r||L(a);for(s=0;null!=(i=o[s]);s++)v(i,r[s])}else v(e,a);r=L(a,"script");r.length>0&&g(r,!l&&L(e,"script"));r=o=i=null;return a},buildFragment:function(e,t,n,r){for(var i,a,s,o,l,c,u,h=e.length,p=d(t),f=[],m=0;h>m;m++){a=e[m];if(a||0===a)if("object"===ue.type(a))ue.merge(f,a.nodeType?[a]:a);else if(Ze.test(a)){o=o||p.appendChild(t.createElement("div"));l=(Qe.exec(a)||["",""])[1].toLowerCase();u=st[l]||st._default;o.innerHTML=u[1]+a.replace(Ke,"<$1></$2>")+u[2];i=u[0];for(;i--;)o=o.lastChild;!ue.support.leadingWhitespace&&Xe.test(a)&&f.push(t.createTextNode(Xe.exec(a)[0]));if(!ue.support.tbody){a="table"!==l||Je.test(a)?"<table>"!==u[1]||Je.test(a)?0:o:o.firstChild;i=a&&a.childNodes.length;for(;i--;)ue.nodeName(c=a.childNodes[i],"tbody")&&!c.childNodes.length&&a.removeChild(c)}ue.merge(f,o.childNodes);o.textContent="";for(;o.firstChild;)o.removeChild(o.firstChild);o=p.lastChild}else f.push(t.createTextNode(a))}o&&p.removeChild(o);ue.support.appendChecked||ue.grep(L(f,"input"),T);m=0;for(;a=f[m++];)if(!r||-1===ue.inArray(a,r)){s=ue.contains(a.ownerDocument,a);o=L(p.appendChild(a),"script");s&&g(o);if(n){i=0;for(;a=o[i++];)rt.test(a.type||"")&&n.push(a)}}o=null;return p},cleanData:function(e,t){for(var n,r,i,a,s=0,o=ue.expando,l=ue.cache,c=ue.support.deleteExpando,u=ue.event.special;null!=(n=e[s]);s++)if(t||ue.acceptData(n)){i=n[o];a=i&&l[i];if(a){if(a.events)for(r in a.events)u[r]?ue.event.remove(n,r):ue.removeEvent(n,r,a.handle);if(l[i]){delete l[i];c?delete n[o]:typeof n.removeAttribute!==Y?n.removeAttribute(o):n[o]=null;te.push(i)}}}},_evalUrl:function(e){return ue.ajax({url:e,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})}});ue.fn.extend({wrapAll:function(e){if(ue.isFunction(e))return this.each(function(t){ue(this).wrapAll(e.call(this,t))});if(this[0]){var t=ue(e,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&t.insertBefore(this[0]);t.map(function(){for(var e=this;e.firstChild&&1===e.firstChild.nodeType;)e=e.firstChild;return e}).append(this)}return this},wrapInner:function(e){return this.each(ue.isFunction(e)?function(t){ue(this).wrapInner(e.call(this,t))}:function(){var t=ue(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)})},wrap:function(e){var t=ue.isFunction(e);return this.each(function(n){ue(this).wrapAll(t?e.call(this,n):e)})},unwrap:function(){return this.parent().each(function(){ue.nodeName(this,"body")||ue(this).replaceWith(this.childNodes)}).end()}});var ct,ut,ht,pt=/alpha\([^)]*\)/i,dt=/opacity\s*=\s*([^)]*)/,ft=/^(top|right|bottom|left)$/,mt=/^(none|table(?!-c[ea]).+)/,yt=/^margin/,gt=new RegExp("^("+he+")(.*)$","i"),vt=new RegExp("^("+he+")(?!px)[a-z%]+$","i"),Ct=new RegExp("^([+-])=("+he+")","i"),Lt={BODY:"block"},Tt={position:"absolute",visibility:"hidden",display:"block"},wt={letterSpacing:0,fontWeight:400},bt=["Top","Right","Bottom","Left"],St=["Webkit","O","Moz","ms"];ue.fn.extend({css:function(e,n){return ue.access(this,function(e,n,r){var i,a,s={},o=0;if(ue.isArray(n)){a=ut(e);i=n.length;for(;i>o;o++)s[n[o]]=ue.css(e,n[o],!1,a);return s}return r!==t?ue.style(e,n,r):ue.css(e,n)},e,n,arguments.length>1)},show:function(){return S(this,!0)},hide:function(){return S(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){b(this)?ue(this).show():ue(this).hide()})}});ue.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=ht(e,"opacity");return""===n?"1":n}}}},cssNumber:{columnCount:!0,fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":ue.support.cssFloat?"cssFloat":"styleFloat"},style:function(e,n,r,i){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var a,s,o,l=ue.camelCase(n),c=e.style;n=ue.cssProps[l]||(ue.cssProps[l]=w(c,l));o=ue.cssHooks[n]||ue.cssHooks[l];if(r===t)return o&&"get"in o&&(a=o.get(e,!1,i))!==t?a:c[n];s=typeof r;if("string"===s&&(a=Ct.exec(r))){r=(a[1]+1)*a[2]+parseFloat(ue.css(e,n));s="number"}if(!(null==r||"number"===s&&isNaN(r))){"number"!==s||ue.cssNumber[l]||(r+="px");ue.support.clearCloneStyle||""!==r||0!==n.indexOf("background")||(c[n]="inherit");if(!(o&&"set"in o&&(r=o.set(e,r,i))===t))try{c[n]=r}catch(u){}}}},css:function(e,n,r,i){var a,s,o,l=ue.camelCase(n);n=ue.cssProps[l]||(ue.cssProps[l]=w(e.style,l));o=ue.cssHooks[n]||ue.cssHooks[l];o&&"get"in o&&(s=o.get(e,!0,r));s===t&&(s=ht(e,n,i));"normal"===s&&n in wt&&(s=wt[n]);if(""===r||r){a=parseFloat(s);return r===!0||ue.isNumeric(a)?a||0:s}return s}});if(e.getComputedStyle){ut=function(t){return e.getComputedStyle(t,null)};ht=function(e,n,r){var i,a,s,o=r||ut(e),l=o?o.getPropertyValue(n)||o[n]:t,c=e.style;if(o){""!==l||ue.contains(e.ownerDocument,e)||(l=ue.style(e,n));if(vt.test(l)&&yt.test(n)){i=c.width;a=c.minWidth;s=c.maxWidth;c.minWidth=c.maxWidth=c.width=l;l=o.width;c.width=i;c.minWidth=a;c.maxWidth=s}}return l}}else if(K.documentElement.currentStyle){ut=function(e){return e.currentStyle};ht=function(e,n,r){var i,a,s,o=r||ut(e),l=o?o[n]:t,c=e.style;null==l&&c&&c[n]&&(l=c[n]);if(vt.test(l)&&!ft.test(n)){i=c.left;a=e.runtimeStyle;s=a&&a.left;s&&(a.left=e.currentStyle.left);c.left="fontSize"===n?"1em":l;l=c.pixelLeft+"px";c.left=i;s&&(a.left=s)}return""===l?"auto":l}}ue.each(["height","width"],function(e,t){ue.cssHooks[t]={get:function(e,n,r){return n?0===e.offsetWidth&&mt.test(ue.css(e,"display"))?ue.swap(e,Tt,function(){return A(e,t,r)}):A(e,t,r):void 0},set:function(e,n,r){var i=r&&ut(e);return E(e,n,r?O(e,t,r,ue.support.boxSizing&&"border-box"===ue.css(e,"boxSizing",!1,i),i):0)}}});ue.support.opacity||(ue.cssHooks.opacity={get:function(e,t){return dt.test((t&&e.currentStyle?e.currentStyle.filter:e.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":t?"1":""},set:function(e,t){var n=e.style,r=e.currentStyle,i=ue.isNumeric(t)?"alpha(opacity="+100*t+")":"",a=r&&r.filter||n.filter||"";n.zoom=1;if((t>=1||""===t)&&""===ue.trim(a.replace(pt,""))&&n.removeAttribute){n.removeAttribute("filter");if(""===t||r&&!r.filter)return}n.filter=pt.test(a)?a.replace(pt,i):a+" "+i}});ue(function(){ue.support.reliableMarginRight||(ue.cssHooks.marginRight={get:function(e,t){return t?ue.swap(e,{display:"inline-block"},ht,[e,"marginRight"]):void 0}});!ue.support.pixelPosition&&ue.fn.position&&ue.each(["top","left"],function(e,t){ue.cssHooks[t]={get:function(e,n){if(n){n=ht(e,t);return vt.test(n)?ue(e).position()[t]+"px":n}}}})});if(ue.expr&&ue.expr.filters){ue.expr.filters.hidden=function(e){return e.offsetWidth<=0&&e.offsetHeight<=0||!ue.support.reliableHiddenOffsets&&"none"===(e.style&&e.style.display||ue.css(e,"display"))};ue.expr.filters.visible=function(e){return!ue.expr.filters.hidden(e)}}ue.each({margin:"",padding:"",border:"Width"},function(e,t){ue.cssHooks[e+t]={expand:function(n){for(var r=0,i={},a="string"==typeof n?n.split(" "):[n];4>r;r++)i[e+bt[r]+t]=a[r]||a[r-2]||a[0];return i}};yt.test(e)||(ue.cssHooks[e+t].set=E)});var Et=/%20/g,Ot=/\[\]$/,At=/\r?\n/g,xt=/^(?:submit|button|image|reset|file)$/i,Pt=/^(?:input|select|textarea|keygen)/i;ue.fn.extend({serialize:function(){return ue.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=ue.prop(this,"elements");return e?ue.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!ue(this).is(":disabled")&&Pt.test(this.nodeName)&&!xt.test(e)&&(this.checked||!tt.test(e))}).map(function(e,t){var n=ue(this).val();return null==n?null:ue.isArray(n)?ue.map(n,function(e){return{name:t.name,value:e.replace(At,"\r\n")}}):{name:t.name,value:n.replace(At,"\r\n")}}).get()}});ue.param=function(e,n){var r,i=[],a=function(e,t){t=ue.isFunction(t)?t():null==t?"":t;i[i.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};n===t&&(n=ue.ajaxSettings&&ue.ajaxSettings.traditional);if(ue.isArray(e)||e.jquery&&!ue.isPlainObject(e))ue.each(e,function(){a(this.name,this.value)});else for(r in e)_(r,e[r],n,a);return i.join("&").replace(Et,"+")};ue.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){ue.fn[t]=function(e,n){return arguments.length>0?this.on(t,null,e,n):this.trigger(t)}});ue.fn.extend({hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)},bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)}});var _t,Nt,Mt=ue.now(),kt=/\?/,It=/#.*$/,Rt=/([?&])_=[^&]*/,Dt=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,Ft=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,jt=/^(?:GET|HEAD)$/,Bt=/^\/\//,$t=/^([\w.+-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,Ut=ue.fn.load,Gt={},zt={},Ht="*/".concat("*");try{Nt=X.href}catch(Wt){Nt=K.createElement("a");Nt.href="";Nt=Nt.href}_t=$t.exec(Nt.toLowerCase())||[];ue.fn.load=function(e,n,r){if("string"!=typeof e&&Ut)return Ut.apply(this,arguments);var i,a,s,o=this,l=e.indexOf(" ");if(l>=0){i=e.slice(l,e.length);e=e.slice(0,l)}if(ue.isFunction(n)){r=n;n=t}else n&&"object"==typeof n&&(s="POST");o.length>0&&ue.ajax({url:e,type:s,dataType:"html",data:n}).done(function(e){a=arguments;o.html(i?ue("<div>").append(ue.parseHTML(e)).find(i):e)}).complete(r&&function(e,t){o.each(r,a||[e.responseText,t,e])});return this};ue.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){ue.fn[t]=function(e){return this.on(t,e)}});ue.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Nt,type:"GET",isLocal:Ft.test(_t[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Ht,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":ue.parseJSON,"text xml":ue.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?k(k(e,ue.ajaxSettings),t):k(ue.ajaxSettings,e)},ajaxPrefilter:N(Gt),ajaxTransport:N(zt),ajax:function(e,n){function r(e,n,r,i){var a,h,v,C,T,b=n;if(2!==L){L=2;l&&clearTimeout(l);u=t;o=i||"";w.readyState=e>0?4:0;a=e>=200&&300>e||304===e;r&&(C=I(p,w,r));C=R(p,C,w,a);if(a){if(p.ifModified){T=w.getResponseHeader("Last-Modified");T&&(ue.lastModified[s]=T);T=w.getResponseHeader("etag");T&&(ue.etag[s]=T)}if(204===e||"HEAD"===p.type)b="nocontent";else if(304===e)b="notmodified";else{b=C.state;h=C.data;v=C.error;a=!v}}else{v=b;if(e||!b){b="error";0>e&&(e=0)}}w.status=e;w.statusText=(n||b)+"";a?m.resolveWith(d,[h,b,w]):m.rejectWith(d,[w,b,v]);w.statusCode(g);g=t;c&&f.trigger(a?"ajaxSuccess":"ajaxError",[w,p,a?h:v]);y.fireWith(d,[w,b]);if(c){f.trigger("ajaxComplete",[w,p]);--ue.active||ue.event.trigger("ajaxStop")}}}if("object"==typeof e){n=e;e=t}n=n||{};var i,a,s,o,l,c,u,h,p=ue.ajaxSetup({},n),d=p.context||p,f=p.context&&(d.nodeType||d.jquery)?ue(d):ue.event,m=ue.Deferred(),y=ue.Callbacks("once memory"),g=p.statusCode||{},v={},C={},L=0,T="canceled",w={readyState:0,getResponseHeader:function(e){var t;if(2===L){if(!h){h={};for(;t=Dt.exec(o);)h[t[1].toLowerCase()]=t[2]}t=h[e.toLowerCase()]}return null==t?null:t},getAllResponseHeaders:function(){return 2===L?o:null},setRequestHeader:function(e,t){var n=e.toLowerCase();if(!L){e=C[n]=C[n]||e;v[e]=t}return this},overrideMimeType:function(e){L||(p.mimeType=e);return this},statusCode:function(e){var t;if(e)if(2>L)for(t in e)g[t]=[g[t],e[t]];else w.always(e[w.status]);return this},abort:function(e){var t=e||T;u&&u.abort(t);r(0,t);return this}};m.promise(w).complete=y.add;w.success=w.done;w.error=w.fail;p.url=((e||p.url||Nt)+"").replace(It,"").replace(Bt,_t[1]+"//");p.type=n.method||n.type||p.method||p.type;p.dataTypes=ue.trim(p.dataType||"*").toLowerCase().match(pe)||[""];if(null==p.crossDomain){i=$t.exec(p.url.toLowerCase());p.crossDomain=!(!i||i[1]===_t[1]&&i[2]===_t[2]&&(i[3]||("http:"===i[1]?"80":"443"))===(_t[3]||("http:"===_t[1]?"80":"443")))}p.data&&p.processData&&"string"!=typeof p.data&&(p.data=ue.param(p.data,p.traditional));M(Gt,p,n,w);if(2===L)return w;c=p.global;c&&0===ue.active++&&ue.event.trigger("ajaxStart");p.type=p.type.toUpperCase();p.hasContent=!jt.test(p.type);s=p.url;if(!p.hasContent){if(p.data){s=p.url+=(kt.test(s)?"&":"?")+p.data;delete p.data}p.cache===!1&&(p.url=Rt.test(s)?s.replace(Rt,"$1_="+Mt++):s+(kt.test(s)?"&":"?")+"_="+Mt++)}if(p.ifModified){
ue.lastModified[s]&&w.setRequestHeader("If-Modified-Since",ue.lastModified[s]);ue.etag[s]&&w.setRequestHeader("If-None-Match",ue.etag[s])}(p.data&&p.hasContent&&p.contentType!==!1||n.contentType)&&w.setRequestHeader("Content-Type",p.contentType);w.setRequestHeader("Accept",p.dataTypes[0]&&p.accepts[p.dataTypes[0]]?p.accepts[p.dataTypes[0]]+("*"!==p.dataTypes[0]?", "+Ht+"; q=0.01":""):p.accepts["*"]);for(a in p.headers)w.setRequestHeader(a,p.headers[a]);if(p.beforeSend&&(p.beforeSend.call(d,w,p)===!1||2===L))return w.abort();T="abort";for(a in{success:1,error:1,complete:1})w[a](p[a]);u=M(zt,p,n,w);if(u){w.readyState=1;c&&f.trigger("ajaxSend",[w,p]);p.async&&p.timeout>0&&(l=setTimeout(function(){w.abort("timeout")},p.timeout));try{L=1;u.send(v,r)}catch(b){if(!(2>L))throw b;r(-1,b)}}else r(-1,"No Transport");return w},getJSON:function(e,t,n){return ue.get(e,t,n,"json")},getScript:function(e,n){return ue.get(e,t,n,"script")}});ue.each(["get","post"],function(e,n){ue[n]=function(e,r,i,a){if(ue.isFunction(r)){a=a||i;i=r;r=t}return ue.ajax({url:e,type:n,dataType:a,data:r,success:i})}});ue.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(e){ue.globalEval(e);return e}}});ue.ajaxPrefilter("script",function(e){e.cache===t&&(e.cache=!1);if(e.crossDomain){e.type="GET";e.global=!1}});ue.ajaxTransport("script",function(e){if(e.crossDomain){var n,r=K.head||ue("head")[0]||K.documentElement;return{send:function(t,i){n=K.createElement("script");n.async=!0;e.scriptCharset&&(n.charset=e.scriptCharset);n.src=e.url;n.onload=n.onreadystatechange=function(e,t){if(t||!n.readyState||/loaded|complete/.test(n.readyState)){n.onload=n.onreadystatechange=null;n.parentNode&&n.parentNode.removeChild(n);n=null;t||i(200,"success")}};r.insertBefore(n,r.firstChild)},abort:function(){n&&n.onload(t,!0)}}}});var Vt=[],qt=/(=)\?(?=&|$)|\?\?/;ue.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=Vt.pop()||ue.expando+"_"+Mt++;this[e]=!0;return e}});ue.ajaxPrefilter("json jsonp",function(n,r,i){var a,s,o,l=n.jsonp!==!1&&(qt.test(n.url)?"url":"string"==typeof n.data&&!(n.contentType||"").indexOf("application/x-www-form-urlencoded")&&qt.test(n.data)&&"data");if(l||"jsonp"===n.dataTypes[0]){a=n.jsonpCallback=ue.isFunction(n.jsonpCallback)?n.jsonpCallback():n.jsonpCallback;l?n[l]=n[l].replace(qt,"$1"+a):n.jsonp!==!1&&(n.url+=(kt.test(n.url)?"&":"?")+n.jsonp+"="+a);n.converters["script json"]=function(){o||ue.error(a+" was not called");return o[0]};n.dataTypes[0]="json";s=e[a];e[a]=function(){o=arguments};i.always(function(){e[a]=s;if(n[a]){n.jsonpCallback=r.jsonpCallback;Vt.push(a)}o&&ue.isFunction(s)&&s(o[0]);o=s=t});return"script"}});var Yt,Xt,Kt=0,Qt=e.ActiveXObject&&function(){var e;for(e in Yt)Yt[e](t,!0)};ue.ajaxSettings.xhr=e.ActiveXObject?function(){return!this.isLocal&&D()||F()}:D;Xt=ue.ajaxSettings.xhr();ue.support.cors=!!Xt&&"withCredentials"in Xt;Xt=ue.support.ajax=!!Xt;Xt&&ue.ajaxTransport(function(n){if(!n.crossDomain||ue.support.cors){var r;return{send:function(i,a){var s,o,l=n.xhr();n.username?l.open(n.type,n.url,n.async,n.username,n.password):l.open(n.type,n.url,n.async);if(n.xhrFields)for(o in n.xhrFields)l[o]=n.xhrFields[o];n.mimeType&&l.overrideMimeType&&l.overrideMimeType(n.mimeType);n.crossDomain||i["X-Requested-With"]||(i["X-Requested-With"]="XMLHttpRequest");try{for(o in i)l.setRequestHeader(o,i[o])}catch(c){}l.send(n.hasContent&&n.data||null);r=function(e,i){var o,c,u,h;try{if(r&&(i||4===l.readyState)){r=t;if(s){l.onreadystatechange=ue.noop;Qt&&delete Yt[s]}if(i)4!==l.readyState&&l.abort();else{h={};o=l.status;c=l.getAllResponseHeaders();"string"==typeof l.responseText&&(h.text=l.responseText);try{u=l.statusText}catch(p){u=""}o||!n.isLocal||n.crossDomain?1223===o&&(o=204):o=h.text?200:404}}}catch(d){i||a(-1,d)}h&&a(o,u,h,c)};if(n.async)if(4===l.readyState)setTimeout(r);else{s=++Kt;if(Qt){if(!Yt){Yt={};ue(e).unload(Qt)}Yt[s]=r}l.onreadystatechange=r}else r()},abort:function(){r&&r(t,!0)}}}});var Jt,Zt,en=/^(?:toggle|show|hide)$/,tn=new RegExp("^(?:([+-])=|)("+he+")([a-z%]*)$","i"),nn=/queueHooks$/,rn=[G],an={"*":[function(e,t){var n=this.createTween(e,t),r=n.cur(),i=tn.exec(t),a=i&&i[3]||(ue.cssNumber[e]?"":"px"),s=(ue.cssNumber[e]||"px"!==a&&+r)&&tn.exec(ue.css(n.elem,e)),o=1,l=20;if(s&&s[3]!==a){a=a||s[3];i=i||[];s=+r||1;do{o=o||".5";s/=o;ue.style(n.elem,e,s+a)}while(o!==(o=n.cur()/r)&&1!==o&&--l)}if(i){s=n.start=+s||+r||0;n.unit=a;n.end=i[1]?s+(i[1]+1)*i[2]:+i[2]}return n}]};ue.Animation=ue.extend($,{tweener:function(e,t){if(ue.isFunction(e)){t=e;e=["*"]}else e=e.split(" ");for(var n,r=0,i=e.length;i>r;r++){n=e[r];an[n]=an[n]||[];an[n].unshift(t)}},prefilter:function(e,t){t?rn.unshift(e):rn.push(e)}});ue.Tween=z;z.prototype={constructor:z,init:function(e,t,n,r,i,a){this.elem=e;this.prop=n;this.easing=i||"swing";this.options=t;this.start=this.now=this.cur();this.end=r;this.unit=a||(ue.cssNumber[n]?"":"px")},cur:function(){var e=z.propHooks[this.prop];return e&&e.get?e.get(this):z.propHooks._default.get(this)},run:function(e){var t,n=z.propHooks[this.prop];this.pos=t=this.options.duration?ue.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):e;this.now=(this.end-this.start)*t+this.start;this.options.step&&this.options.step.call(this.elem,this.now,this);n&&n.set?n.set(this):z.propHooks._default.set(this);return this}};z.prototype.init.prototype=z.prototype;z.propHooks={_default:{get:function(e){var t;if(null!=e.elem[e.prop]&&(!e.elem.style||null==e.elem.style[e.prop]))return e.elem[e.prop];t=ue.css(e.elem,e.prop,"");return t&&"auto"!==t?t:0},set:function(e){ue.fx.step[e.prop]?ue.fx.step[e.prop](e):e.elem.style&&(null!=e.elem.style[ue.cssProps[e.prop]]||ue.cssHooks[e.prop])?ue.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now}}};z.propHooks.scrollTop=z.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}};ue.each(["toggle","show","hide"],function(e,t){var n=ue.fn[t];ue.fn[t]=function(e,r,i){return null==e||"boolean"==typeof e?n.apply(this,arguments):this.animate(H(t,!0),e,r,i)}});ue.fn.extend({fadeTo:function(e,t,n,r){return this.filter(b).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(e,t,n,r){var i=ue.isEmptyObject(e),a=ue.speed(t,n,r),s=function(){var t=$(this,ue.extend({},e),a);(i||ue._data(this,"finish"))&&t.stop(!0)};s.finish=s;return i||a.queue===!1?this.each(s):this.queue(a.queue,s)},stop:function(e,n,r){var i=function(e){var t=e.stop;delete e.stop;t(r)};if("string"!=typeof e){r=n;n=e;e=t}n&&e!==!1&&this.queue(e||"fx",[]);return this.each(function(){var t=!0,n=null!=e&&e+"queueHooks",a=ue.timers,s=ue._data(this);if(n)s[n]&&s[n].stop&&i(s[n]);else for(n in s)s[n]&&s[n].stop&&nn.test(n)&&i(s[n]);for(n=a.length;n--;)if(a[n].elem===this&&(null==e||a[n].queue===e)){a[n].anim.stop(r);t=!1;a.splice(n,1)}(t||!r)&&ue.dequeue(this,e)})},finish:function(e){e!==!1&&(e=e||"fx");return this.each(function(){var t,n=ue._data(this),r=n[e+"queue"],i=n[e+"queueHooks"],a=ue.timers,s=r?r.length:0;n.finish=!0;ue.queue(this,e,[]);i&&i.stop&&i.stop.call(this,!0);for(t=a.length;t--;)if(a[t].elem===this&&a[t].queue===e){a[t].anim.stop(!0);a.splice(t,1)}for(t=0;s>t;t++)r[t]&&r[t].finish&&r[t].finish.call(this);delete n.finish})}});ue.each({slideDown:H("show"),slideUp:H("hide"),slideToggle:H("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){ue.fn[e]=function(e,n,r){return this.animate(t,e,n,r)}});ue.speed=function(e,t,n){var r=e&&"object"==typeof e?ue.extend({},e):{complete:n||!n&&t||ue.isFunction(e)&&e,duration:e,easing:n&&t||t&&!ue.isFunction(t)&&t};r.duration=ue.fx.off?0:"number"==typeof r.duration?r.duration:r.duration in ue.fx.speeds?ue.fx.speeds[r.duration]:ue.fx.speeds._default;(null==r.queue||r.queue===!0)&&(r.queue="fx");r.old=r.complete;r.complete=function(){ue.isFunction(r.old)&&r.old.call(this);r.queue&&ue.dequeue(this,r.queue)};return r};ue.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2}};ue.timers=[];ue.fx=z.prototype.init;ue.fx.tick=function(){var e,n=ue.timers,r=0;Jt=ue.now();for(;r<n.length;r++){e=n[r];e()||n[r]!==e||n.splice(r--,1)}n.length||ue.fx.stop();Jt=t};ue.fx.timer=function(e){e()&&ue.timers.push(e)&&ue.fx.start()};ue.fx.interval=13;ue.fx.start=function(){Zt||(Zt=setInterval(ue.fx.tick,ue.fx.interval))};ue.fx.stop=function(){clearInterval(Zt);Zt=null};ue.fx.speeds={slow:600,fast:200,_default:400};ue.fx.step={};ue.expr&&ue.expr.filters&&(ue.expr.filters.animated=function(e){return ue.grep(ue.timers,function(t){return e===t.elem}).length});ue.fn.offset=function(e){if(arguments.length)return e===t?this:this.each(function(t){ue.offset.setOffset(this,e,t)});var n,r,i={top:0,left:0},a=this[0],s=a&&a.ownerDocument;if(s){n=s.documentElement;if(!ue.contains(n,a))return i;typeof a.getBoundingClientRect!==Y&&(i=a.getBoundingClientRect());r=W(s);return{top:i.top+(r.pageYOffset||n.scrollTop)-(n.clientTop||0),left:i.left+(r.pageXOffset||n.scrollLeft)-(n.clientLeft||0)}}};ue.offset={setOffset:function(e,t,n){var r=ue.css(e,"position");"static"===r&&(e.style.position="relative");var i,a,s=ue(e),o=s.offset(),l=ue.css(e,"top"),c=ue.css(e,"left"),u=("absolute"===r||"fixed"===r)&&ue.inArray("auto",[l,c])>-1,h={},p={};if(u){p=s.position();i=p.top;a=p.left}else{i=parseFloat(l)||0;a=parseFloat(c)||0}ue.isFunction(t)&&(t=t.call(e,n,o));null!=t.top&&(h.top=t.top-o.top+i);null!=t.left&&(h.left=t.left-o.left+a);"using"in t?t.using.call(e,h):s.css(h)}};ue.fn.extend({position:function(){if(this[0]){var e,t,n={top:0,left:0},r=this[0];if("fixed"===ue.css(r,"position"))t=r.getBoundingClientRect();else{e=this.offsetParent();t=this.offset();ue.nodeName(e[0],"html")||(n=e.offset());n.top+=ue.css(e[0],"borderTopWidth",!0);n.left+=ue.css(e[0],"borderLeftWidth",!0)}return{top:t.top-n.top-ue.css(r,"marginTop",!0),left:t.left-n.left-ue.css(r,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent||Q;e&&!ue.nodeName(e,"html")&&"static"===ue.css(e,"position");)e=e.offsetParent;return e||Q})}});ue.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,n){var r=/Y/.test(n);ue.fn[e]=function(i){return ue.access(this,function(e,i,a){var s=W(e);if(a===t)return s?n in s?s[n]:s.document.documentElement[i]:e[i];s?s.scrollTo(r?ue(s).scrollLeft():a,r?a:ue(s).scrollTop()):e[i]=a;return void 0},e,i,arguments.length,null)}});ue.each({Height:"height",Width:"width"},function(e,n){ue.each({padding:"inner"+e,content:n,"":"outer"+e},function(r,i){ue.fn[i]=function(i,a){var s=arguments.length&&(r||"boolean"!=typeof i),o=r||(i===!0||a===!0?"margin":"border");return ue.access(this,function(n,r,i){var a;if(ue.isWindow(n))return n.document.documentElement["client"+e];if(9===n.nodeType){a=n.documentElement;return Math.max(n.body["scroll"+e],a["scroll"+e],n.body["offset"+e],a["offset"+e],a["client"+e])}return i===t?ue.css(n,r,o):ue.style(n,r,i,o)},n,s?i:t,s,null)}})});ue.fn.size=function(){return this.length};ue.fn.andSelf=ue.fn.addBack;if("object"==typeof module&&module&&"object"==typeof module.exports)module.exports=ue;else{e.jQuery=e.$=ue;"function"==typeof define&&define.amd&&define("jquery",[],function(){return ue})}}(window);!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e(jQuery)}(function(e){if(!e.support.cors&&e.ajaxTransport&&window.XDomainRequest){var t=/^https?:\/\//i,n=/^get|post$/i,r=new RegExp("^"+location.protocol,"i");e.ajaxTransport("* text html xml json",function(i,a,s){if(i.crossDomain&&i.async&&n.test(i.type)&&t.test(i.url)&&r.test(i.url)){var o=null;return{send:function(t,n){var r="",s=(a.dataType||"").toLowerCase();o=new XDomainRequest;/^\d+$/.test(a.timeout)&&(o.timeout=a.timeout);o.ontimeout=function(){n(500,"timeout")};o.onload=function(){var t="Content-Length: "+o.responseText.length+"\r\nContent-Type: "+o.contentType,r={code:200,message:"success"},i={text:o.responseText};try{if("html"===s||/text\/html/i.test(o.contentType))i.html=o.responseText;else if("json"===s||"text"!==s&&/\/json/i.test(o.contentType))try{i.json=e.parseJSON(o.responseText)}catch(a){r.code=500;r.message="parseerror"}else if("xml"===s||"text"!==s&&/\/xml/i.test(o.contentType)){var l=new ActiveXObject("Microsoft.XMLDOM");l.async=!1;try{l.loadXML(o.responseText)}catch(a){l=void 0}if(!l||!l.documentElement||l.getElementsByTagName("parsererror").length){r.code=500;r.message="parseerror";throw"Invalid XML: "+o.responseText}i.xml=l}}catch(c){throw c}finally{n(r.code,r.message,i,t)}};o.onprogress=function(){};o.onerror=function(){n(500,"error",{text:o.responseText})};a.data&&(r="string"===e.type(a.data)?a.data:e.param(a.data));o.open(i.type,i.url);o.send(r)},abort:function(){o&&o.abort()}}}})}});!function(e){"use strict";var t=({defaults:{method:"GET",cancelRequests:!1,target:e(),source:null,callback:null,link:null,minLength:0,matchFromStart:!0},openXHR:{},cache:{}},function(t,r,i){var a=[];if(r)if(i.buildHTML)e(i.target).html(i.buildHTML({results:r}));else{for(var s=0;s<r.length;s++){var o=r[s];a[a.length]=e.isPlainObject(o)?'<li><a href="'+i.link+encodeURIComponent(o.id)+'">'+o.label+"</a></li>":'<li><a href="'+i.link+encodeURIComponent(o)+'">'+o+"</a></li>"}e(i.target).html(a.join(""))}null!==i.callback&&e.isFunction(i.callback)&&n(i);t.trigger(t.val().length>0?"targetUpdated.autocomplete":"targetCleared.autocomplete")}),n=function(t){e("li a",e(t.target)).on("click.autocomplete",function(e){e.stopPropagation();e.preventDefault();t.callback(e)})},r=function(e,t){t.html("").closest("fieldset").removeClass("ui-search-active");e.trigger("targetCleared.autocomplete")},i=function(n){var i,a,s,o,l=e(this),c=l.attr("id"),u=l.data("autocomplete");if(u){var h=u.settings,p=u.openXHR;i=l.val();if(i.length<h.minLength)r(l,e(h.target));else if(e.isArray(h.source)){a=h.source.sort().filter(function(t){o=h.matchFromStart?new RegExp("^"+i,"i"):new RegExp(i,"i");s=e.isPlainObject(t)?t.label:t;return o.test(s)});t(l,a,h)}else"function"==typeof h.source?h.source(i,function(e){t(l,e,h)}):e.ajax({type:h.method,url:h.source,data:{term:i},beforeSend:function(e){if(h.cancelRequests){if(p[c])p[c].abort();else{h.target.html('<li><a href="#">Searching...</a></li>');h.target.closest("fieldset").addClass("ui-search-active")}p[c]=e}},success:function(e){t(l,e,h)},complete:function(e,t){h.cancelRequests&&(p[c]=null)},dataType:"json"})}},a={init:function(t){var n=this,a={settings:null};a.settings=e.extend({},a.defaults,t);n.data("autocomplete",a);var s=a.settings;return n.off("keyup.autocomplete").on("keyup.autocomplete",i).next(".ui-input-clear").on("click",function(t){r(n,e(s.target))})},update:function(t){var n=this.data("autocomplete");if(n){n.settings=e.extend(n.settings,t);this.data("autocomplete",n)}return this},clear:function(){var t=this.data("autocomplete");t&&r(this,e(t.settings.target));return this},destroy:function(){var t=this.data("autocomplete");if(t){r(this,e(t.settings.target));this.removeData("autocomplete");this.off(".autocomplete")}return this}};e.fn.autocomplete=function(e){return a[e]?a[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?void 0:a.init.apply(this,arguments)}}(jQuery);!function(e){e.fn.drag=function(t,n,r){var i="string"==typeof t?t:"",a=e.isFunction(t)?t:e.isFunction(n)?n:null;0!==i.indexOf("drag")&&(i="drag"+i);r=(t==a?n:r)||{};return a?this.bind(i,r,a):this.trigger(i)};var t=e.event,n=t.special,r=n.drag={defaults:{which:1,distance:0,not:":input",handle:null,relative:!1,drop:!0,click:!1},datakey:"dragdata",noBubble:!0,add:function(t){var n=e.data(this,r.datakey),i=t.data||{};n.related+=1;e.each(r.defaults,function(e,t){void 0!==i[e]&&(n[e]=i[e])})},remove:function(){e.data(this,r.datakey).related-=1},setup:function(){if(!e.data(this,r.datakey)){var n=e.extend({related:0},r.defaults);e.data(this,r.datakey,n);t.add(this,"touchstart mousedown",r.init,n);this.attachEvent&&this.attachEvent("ondragstart",r.dontstart)}},teardown:function(){var n=e.data(this,r.datakey)||{};if(!n.related){e.removeData(this,r.datakey);t.remove(this,"touchstart mousedown",r.init);r.textselect(!0);this.detachEvent&&this.detachEvent("ondragstart",r.dontstart)}},init:function(i){if(!r.touched){var a,s=i.data;if(!(0!=i.which&&s.which>0&&i.which!=s.which||e(i.target).is(s.not)||s.handle&&!e(i.target).closest(s.handle,i.currentTarget).length)){r.touched="touchstart"==i.type?this:null;s.propagates=1;s.mousedown=this;s.interactions=[r.interaction(this,s)];s.target=i.target;s.pageX=i.pageX;s.pageY=i.pageY;s.dragging=null;a=r.hijack(i,"draginit",s);if(s.propagates){a=r.flatten(a);if(a&&a.length){s.interactions=[];e.each(a,function(){s.interactions.push(r.interaction(this,s))})}s.propagates=s.interactions.length;s.drop!==!1&&n.drop&&n.drop.handler(i,s);r.textselect(!1);r.touched?t.add(r.touched,"touchmove touchend",r.handler,s):t.add(document,"mousemove mouseup",r.handler,s);return!r.touched||s.live?!1:void 0}}}},interaction:function(t,n){var i=e(t)[n.relative?"position":"offset"]()||{top:0,left:0};return{drag:t,callback:new r.callback,droppable:[],offset:i}},handler:function(i){var a=i.data;switch(i.type){case!a.dragging&&"touchmove":i.preventDefault();case!a.dragging&&"mousemove":if(Math.pow(i.pageX-a.pageX,2)+Math.pow(i.pageY-a.pageY,2)<Math.pow(a.distance,2))break;i.target=a.target;r.hijack(i,"dragstart",a);a.propagates&&(a.dragging=!0);case"touchmove":i.preventDefault();case"mousemove":if(a.dragging){r.hijack(i,"drag",a);if(a.propagates){a.drop!==!1&&n.drop&&n.drop.handler(i,a);break}i.type="mouseup"}case"touchend":case"mouseup":default:r.touched?t.remove(r.touched,"touchmove touchend",r.handler):t.remove(document,"mousemove mouseup",r.handler);if(a.dragging){a.drop!==!1&&n.drop&&n.drop.handler(i,a);r.hijack(i,"dragend",a)}r.textselect(!0);a.click===!1&&a.dragging&&e.data(a.mousedown,"suppress.click",(new Date).getTime()+5);a.dragging=r.touched=!1}},hijack:function(n,i,a,s,o){if(a){var l,c,u,h={event:n.originalEvent,type:n.type},p=i.indexOf("drop")?"drag":"drop",d=s||0,f=isNaN(s)?a.interactions.length:s;n.type=i;n.originalEvent=null;a.results=[];do if(c=a.interactions[d]){if("dragend"!==i&&c.cancelled)continue;u=r.properties(n,a,c);c.results=[];e(o||c[p]||a.droppable).each(function(s,o){u.target=o;n.isPropagationStopped=function(){return!1};l=o?t.dispatch.call(o,n,u):null;if(l===!1){if("drag"==p){c.cancelled=!0;a.propagates-=1}"drop"==i&&(c[p][s]=null)}else"dropinit"==i&&c.droppable.push(r.element(l)||o);"dragstart"==i&&(c.proxy=e(r.element(l)||c.drag)[0]);c.results.push(l);delete n.result;return"dropinit"!==i?l:void 0});a.results[d]=r.flatten(c.results);"dropinit"==i&&(c.droppable=r.flatten(c.droppable));"dragstart"!=i||c.cancelled||u.update()}while(++d<f);n.type=h.type;n.originalEvent=h.event;return r.flatten(a.results)}},properties:function(e,t,n){var i=n.callback;i.drag=n.drag;i.proxy=n.proxy||n.drag;i.startX=t.pageX;i.startY=t.pageY;i.deltaX=e.pageX-t.pageX;i.deltaY=e.pageY-t.pageY;i.originalX=n.offset.left;i.originalY=n.offset.top;i.offsetX=i.originalX+i.deltaX;i.offsetY=i.originalY+i.deltaY;i.drop=r.flatten((n.drop||[]).slice());i.available=r.flatten((n.droppable||[]).slice());return i},element:function(e){return e&&(e.jquery||1==e.nodeType)?e:void 0},flatten:function(t){return e.map(t,function(t){return t&&t.jquery?e.makeArray(t):t&&t.length?r.flatten(t):t})},textselect:function(t){e(document)[t?"unbind":"bind"]("selectstart",r.dontstart).css("MozUserSelect",t?"":"none");document.unselectable=t?"off":"on"},dontstart:function(){return!1},callback:function(){}};r.callback.prototype={update:function(){n.drop&&this.available.length&&e.each(this.available,function(e){n.drop.locate(this,e)})}};var i=t.dispatch;t.dispatch=function(t){if(!(e.data(this,"suppress."+t.type)-(new Date).getTime()>0))return i.apply(this,arguments);e.removeData(this,"suppress."+t.type);return void 0};var a=t.fixHooks.touchstart=t.fixHooks.touchmove=t.fixHooks.touchend=t.fixHooks.touchcancel={props:"clientX clientY pageX pageY screenX screenY".split(" "),filter:function(t,n){if(n){var r=n.touches&&n.touches[0]||n.changedTouches&&n.changedTouches[0]||null;r&&e.each(a.props,function(e,n){t[n]=r[n]})}return t}};n.draginit=n.dragstart=n.dragend=r}(jQuery);!function(e){e.fn.drop=function(t,n,r){var i="string"==typeof t?t:"",a=e.isFunction(t)?t:e.isFunction(n)?n:null;0!==i.indexOf("drop")&&(i="drop"+i);r=(t==a?n:r)||{};return a?this.bind(i,r,a):this.trigger(i)};e.drop=function(t){t=t||{};r.multi=t.multi===!0?1/0:t.multi===!1?1:isNaN(t.multi)?r.multi:t.multi;r.delay=t.delay||r.delay;r.tolerance=e.isFunction(t.tolerance)?t.tolerance:null===t.tolerance?null:r.tolerance;r.mode=t.mode||r.mode||"intersect"};var t=e.event,n=t.special,r=e.event.special.drop={multi:1,delay:20,mode:"overlap",targets:[],datakey:"dropdata",noBubble:!0,add:function(t){var n=e.data(this,r.datakey);n.related+=1},remove:function(){e.data(this,r.datakey).related-=1},setup:function(){if(!e.data(this,r.datakey)){var t={related:0,active:[],anyactive:0,winner:0,location:{}};e.data(this,r.datakey,t);r.targets.push(this)}},teardown:function(){var t=e.data(this,r.datakey)||{};if(!t.related){e.removeData(this,r.datakey);var n=this;r.targets=e.grep(r.targets,function(e){return e!==n})}},handler:function(t,i){var a;if(i)switch(t.type){case"mousedown":case"touchstart":a=e(r.targets);"string"==typeof i.drop&&(a=a.filter(i.drop));a.each(function(){var t=e.data(this,r.datakey);t.active=[];t.anyactive=0;t.winner=0});i.droppable=a;n.drag.hijack(t,"dropinit",i);break;case"mousemove":case"touchmove":r.event=t;r.timer||r.tolerate(i);break;case"mouseup":case"touchend":r.timer=clearTimeout(r.timer);if(i.propagates){n.drag.hijack(t,"drop",i);n.drag.hijack(t,"dropend",i)}}},locate:function(t,n){var i=e.data(t,r.datakey),a=e(t),s=a.offset()||{},o=a.outerHeight(),l=a.outerWidth(),c={elem:t,width:l,height:o,top:s.top,left:s.left,right:s.left+l,bottom:s.top+o};if(i){i.location=c;i.index=n;i.elem=t}return c},contains:function(e,t){return(t[0]||t.left)>=e.left&&(t[0]||t.right)<=e.right&&(t[1]||t.top)>=e.top&&(t[1]||t.bottom)<=e.bottom},modes:{intersect:function(e,t,n){return this.contains(n,[e.pageX,e.pageY])?1e9:this.modes.overlap.apply(this,arguments)},overlap:function(e,t,n){return Math.max(0,Math.min(n.bottom,t.bottom)-Math.max(n.top,t.top))*Math.max(0,Math.min(n.right,t.right)-Math.max(n.left,t.left))},fit:function(e,t,n){return this.contains(n,t)?1:0},middle:function(e,t,n){return this.contains(n,[t.left+.5*t.width,t.top+.5*t.height])?1:0}},sort:function(e,t){return t.winner-e.winner||e.index-t.index},tolerate:function(t){var i,a,s,o,l,c,u,h,p=0,d=t.interactions.length,f=[r.event.pageX,r.event.pageY],m=r.tolerance||r.modes[r.mode];do if(h=t.interactions[p]){if(!h)return;h.drop=[];l=[];c=h.droppable.length;m&&(s=r.locate(h.proxy));i=0;do if(u=h.droppable[i]){o=e.data(u,r.datakey);a=o.location;if(!a)continue;o.winner=m?m.call(r,r.event,s,a):r.contains(a,f)?1:0;l.push(o)}while(++i<c);l.sort(r.sort);i=0;do if(o=l[i])if(o.winner&&h.drop.length<r.multi){if(!o.active[p]&&!o.anyactive)if(n.drag.hijack(r.event,"dropstart",t,p,o.elem)[0]!==!1){o.active[p]=1;o.anyactive+=1}else o.winner=0;o.winner&&h.drop.push(o.elem)}else if(o.active[p]&&1==o.anyactive){n.drag.hijack(r.event,"dropend",t,p,o.elem);o.active[p]=0;o.anyactive-=1}while(++i<c)}while(++p<d);r.last&&f[0]==r.last.pageX&&f[1]==r.last.pageY?delete r.timer:r.timer=setTimeout(function(){r.tolerate(t)},r.delay);r.last=r.event}};n.dropinit=n.dropstart=n.dropend=r}(jQuery);!function(e,t){e.fn.track=function(n){function r(t,n,r){t.each(function(){var t=e(this);if(window.MutationObserver){var n=t.data("__watcherObserver");if(null==n){n=new MutationObserver(r.fnc);t.data("__watcherObserver",n)}n.observe(this,{attributes:!0,subtree:a.watchChildren,childList:a.watchChildren,characterData:!0})}else r.intervalId=setInterval(r.fnc,interval)})}function i(n){var i=e(this),a=i.data(n);if(a){var s=this;if(a.func){var o=!1,l=0;for(l;l<a.props.length;l++){var c=a.props[l],u="";u=c.startsWith("attr_")?i.attr(c.replace("attr_","")):i.css(c);if(u!=t&&a.vals[l]!=u){a.vals[l]=u;o=!0;break}}if(o){i.untrack(n);a.func.call(s,a,l);r(i,n,a)}}}}var a=e.extend({properties:null,interval:100,id:"_watcher",watchChildren:!1,callback:null},n);return this.each(function(){var t=this,n=e(this),s=function(e,n){i.call(t,a.id)},o={id:a.id,props:a.properties.split(","),vals:[a.properties.split(",").length],func:a.callback,fnc:s,origProps:a.properties,interval:a.interval,intervalId:null};e.each(o.props,function(e){o.vals[e]=n.css(o.props[e])});n.data(a.id,o);r(n,a.id,o)})};e.fn.untrack=function(t){this.each(function(){var n=e(this),r=n.data(t);try{if(window.MutationObserver){var i=n.data("__watcherObserver");if(i){i.disconnect();n.removeData("__watcherObserver")}}else clearInterval(r.intervalId)}catch(a){}});return this};String.prototype.startsWith=function(e){return 0==this.length?!1:e==this.substr(0,e.length)}}(jQuery,void 0);var QRCode;!function(){function e(e){this.mode=c.MODE_8BIT_BYTE,this.data=e,this.parsedData=[];for(var t=[],n=0,r=this.data.length;r>n;n++){var i=this.data.charCodeAt(n);i>65536?(t[0]=240|(1835008&i)>>>18,t[1]=128|(258048&i)>>>12,t[2]=128|(4032&i)>>>6,t[3]=128|63&i):i>2048?(t[0]=224|(61440&i)>>>12,t[1]=128|(4032&i)>>>6,t[2]=128|63&i):i>128?(t[0]=192|(1984&i)>>>6,t[1]=128|63&i):t[0]=i,this.parsedData=this.parsedData.concat(t)}this.parsedData.length!=this.data.length&&(this.parsedData.unshift(191),this.parsedData.unshift(187),this.parsedData.unshift(239))}function t(e,t){this.typeNumber=e,this.errorCorrectLevel=t,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}function n(e,t){if(void 0==e.length)throw new Error(e.length+"/"+t);for(var n=0;n<e.length&&0==e[n];)n++;this.num=new Array(e.length-n+t);for(var r=0;r<e.length-n;r++)this.num[r]=e[r+n]}function r(e,t){this.totalCount=e,this.dataCount=t}function i(){this.buffer=[],this.length=0}function a(){return"undefined"!=typeof CanvasRenderingContext2D}function s(){var e=!1,t=navigator.userAgent;return/android/i.test(t)&&(e=!0,aMat=t.toString().match(/android ([0-9]\.[0-9])/i),aMat&&aMat[1]&&(e=parseFloat(aMat[1]))),e}function o(e,t){for(var n=1,r=l(e),i=0,a=m.length;a>=i;i++){var s=0;switch(t){case u.L:s=m[i][0];break;case u.M:s=m[i][1];break;case u.Q:s=m[i][2];break;case u.H:s=m[i][3]}if(s>=r)break;n++}if(n>m.length)throw new Error("Too long data");return n}function l(e){var t=encodeURI(e).toString().replace(/\%[0-9a-fA-F]{2}/g,"a");return t.length+(t.length!=e?3:0)}e.prototype={getLength:function(){return this.parsedData.length},write:function(e){for(var t=0,n=this.parsedData.length;n>t;t++)e.put(this.parsedData[t],8)}},t.prototype={addData:function(t){var n=new e(t);this.dataList.push(n),this.dataCache=null},isDark:function(e,t){if(0>e||this.moduleCount<=e||0>t||this.moduleCount<=t)throw new Error(e+","+t);return this.modules[e][t]},getModuleCount:function(){return this.moduleCount},make:function(){this.makeImpl(!1,this.getBestMaskPattern())},makeImpl:function(e,n){this.moduleCount=4*this.typeNumber+17,this.modules=new Array(this.moduleCount);for(var r=0;r<this.moduleCount;r++){this.modules[r]=new Array(this.moduleCount);for(var i=0;i<this.moduleCount;i++)this.modules[r][i]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(e,n),this.typeNumber>=7&&this.setupTypeNumber(e),null==this.dataCache&&(this.dataCache=t.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,n)},setupPositionProbePattern:function(e,t){for(var n=-1;7>=n;n++)if(!(-1>=e+n||this.moduleCount<=e+n))for(var r=-1;7>=r;r++)-1>=t+r||this.moduleCount<=t+r||(this.modules[e+n][t+r]=n>=0&&6>=n&&(0==r||6==r)||r>=0&&6>=r&&(0==n||6==n)||n>=2&&4>=n&&r>=2&&4>=r?!0:!1)},getBestMaskPattern:function(){for(var e=0,t=0,n=0;8>n;n++){this.makeImpl(!0,n);var r=p.getLostPoint(this);(0==n||e>r)&&(e=r,t=n)}return t},createMovieClip:function(e,t,n){var r=e.createEmptyMovieClip(t,n),i=1;this.make();for(var a=0;a<this.modules.length;a++)for(var s=a*i,o=0;o<this.modules[a].length;o++){var l=o*i,c=this.modules[a][o];c&&(r.beginFill(0,100),r.moveTo(l,s),r.lineTo(l+i,s),r.lineTo(l+i,s+i),r.lineTo(l,s+i),r.endFill())}return r},setupTimingPattern:function(){for(var e=8;e<this.moduleCount-8;e++)null==this.modules[e][6]&&(this.modules[e][6]=0==e%2);for(var t=8;t<this.moduleCount-8;t++)null==this.modules[6][t]&&(this.modules[6][t]=0==t%2)},setupPositionAdjustPattern:function(){for(var e=p.getPatternPosition(this.typeNumber),t=0;t<e.length;t++)for(var n=0;n<e.length;n++){var r=e[t],i=e[n];if(null==this.modules[r][i])for(var a=-2;2>=a;a++)for(var s=-2;2>=s;s++)this.modules[r+a][i+s]=-2==a||2==a||-2==s||2==s||0==a&&0==s?!0:!1}},setupTypeNumber:function(e){for(var t=p.getBCHTypeNumber(this.typeNumber),n=0;18>n;n++){var r=!e&&1==(1&t>>n);this.modules[Math.floor(n/3)][n%3+this.moduleCount-8-3]=r}for(var n=0;18>n;n++){var r=!e&&1==(1&t>>n);this.modules[n%3+this.moduleCount-8-3][Math.floor(n/3)]=r}},setupTypeInfo:function(e,t){for(var n=this.errorCorrectLevel<<3|t,r=p.getBCHTypeInfo(n),i=0;15>i;i++){var a=!e&&1==(1&r>>i);6>i?this.modules[i][8]=a:8>i?this.modules[i+1][8]=a:this.modules[this.moduleCount-15+i][8]=a}for(var i=0;15>i;i++){var a=!e&&1==(1&r>>i);8>i?this.modules[8][this.moduleCount-i-1]=a:9>i?this.modules[8][15-i-1+1]=a:this.modules[8][15-i-1]=a}this.modules[this.moduleCount-8][8]=!e},mapData:function(e,t){for(var n=-1,r=this.moduleCount-1,i=7,a=0,s=this.moduleCount-1;s>0;s-=2)for(6==s&&s--;;){for(var o=0;2>o;o++)if(null==this.modules[r][s-o]){var l=!1;a<e.length&&(l=1==(1&e[a]>>>i));var c=p.getMask(t,r,s-o);c&&(l=!l),this.modules[r][s-o]=l,i--,-1==i&&(a++,i=7)}if(r+=n,0>r||this.moduleCount<=r){r-=n,n=-n;break}}}},t.PAD0=236,t.PAD1=17,t.createData=function(e,n,a){for(var s=r.getRSBlocks(e,n),o=new i,l=0;l<a.length;l++){var c=a[l];o.put(c.mode,4),o.put(c.getLength(),p.getLengthInBits(c.mode,e)),c.write(o)}for(var u=0,l=0;l<s.length;l++)u+=s[l].dataCount;if(o.getLengthInBits()>8*u)throw new Error("code length overflow. ("+o.getLengthInBits()+">"+8*u+")");for(o.getLengthInBits()+4<=8*u&&o.put(0,4);0!=o.getLengthInBits()%8;)o.putBit(!1);for(;!(o.getLengthInBits()>=8*u)&&(o.put(t.PAD0,8),!(o.getLengthInBits()>=8*u));)o.put(t.PAD1,8);return t.createBytes(o,s)},t.createBytes=function(e,t){for(var r=0,i=0,a=0,s=new Array(t.length),o=new Array(t.length),l=0;l<t.length;l++){var c=t[l].dataCount,u=t[l].totalCount-c;i=Math.max(i,c),a=Math.max(a,u),s[l]=new Array(c);for(var h=0;h<s[l].length;h++)s[l][h]=255&e.buffer[h+r];r+=c;var d=p.getErrorCorrectPolynomial(u),f=new n(s[l],d.getLength()-1),m=f.mod(d);o[l]=new Array(d.getLength()-1);for(var h=0;h<o[l].length;h++){var y=h+m.getLength()-o[l].length;o[l][h]=y>=0?m.get(y):0}}for(var g=0,h=0;h<t.length;h++)g+=t[h].totalCount;for(var v=new Array(g),C=0,h=0;i>h;h++)for(var l=0;l<t.length;l++)h<s[l].length&&(v[C++]=s[l][h]);for(var h=0;a>h;h++)for(var l=0;l<t.length;l++)h<o[l].length&&(v[C++]=o[l][h]);return v};for(var c={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8},u={L:1,M:0,Q:3,H:2},h={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7},p={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],
G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(e){for(var t=e<<10;p.getBCHDigit(t)-p.getBCHDigit(p.G15)>=0;)t^=p.G15<<p.getBCHDigit(t)-p.getBCHDigit(p.G15);return(e<<10|t)^p.G15_MASK},getBCHTypeNumber:function(e){for(var t=e<<12;p.getBCHDigit(t)-p.getBCHDigit(p.G18)>=0;)t^=p.G18<<p.getBCHDigit(t)-p.getBCHDigit(p.G18);return e<<12|t},getBCHDigit:function(e){for(var t=0;0!=e;)t++,e>>>=1;return t},getPatternPosition:function(e){return p.PATTERN_POSITION_TABLE[e-1]},getMask:function(e,t,n){switch(e){case h.PATTERN000:return 0==(t+n)%2;case h.PATTERN001:return 0==t%2;case h.PATTERN010:return 0==n%3;case h.PATTERN011:return 0==(t+n)%3;case h.PATTERN100:return 0==(Math.floor(t/2)+Math.floor(n/3))%2;case h.PATTERN101:return 0==t*n%2+t*n%3;case h.PATTERN110:return 0==(t*n%2+t*n%3)%2;case h.PATTERN111:return 0==(t*n%3+(t+n)%2)%2;default:throw new Error("bad maskPattern:"+e)}},getErrorCorrectPolynomial:function(e){for(var t=new n([1],0),r=0;e>r;r++)t=t.multiply(new n([1,d.gexp(r)],0));return t},getLengthInBits:function(e,t){if(t>=1&&10>t)switch(e){case c.MODE_NUMBER:return 10;case c.MODE_ALPHA_NUM:return 9;case c.MODE_8BIT_BYTE:return 8;case c.MODE_KANJI:return 8;default:throw new Error("mode:"+e)}else if(27>t)switch(e){case c.MODE_NUMBER:return 12;case c.MODE_ALPHA_NUM:return 11;case c.MODE_8BIT_BYTE:return 16;case c.MODE_KANJI:return 10;default:throw new Error("mode:"+e)}else{if(!(41>t))throw new Error("type:"+t);switch(e){case c.MODE_NUMBER:return 14;case c.MODE_ALPHA_NUM:return 13;case c.MODE_8BIT_BYTE:return 16;case c.MODE_KANJI:return 12;default:throw new Error("mode:"+e)}}},getLostPoint:function(e){for(var t=e.getModuleCount(),n=0,r=0;t>r;r++)for(var i=0;t>i;i++){for(var a=0,s=e.isDark(r,i),o=-1;1>=o;o++)if(!(0>r+o||r+o>=t))for(var l=-1;1>=l;l++)0>i+l||i+l>=t||(0!=o||0!=l)&&s==e.isDark(r+o,i+l)&&a++;a>5&&(n+=3+a-5)}for(var r=0;t-1>r;r++)for(var i=0;t-1>i;i++){var c=0;e.isDark(r,i)&&c++,e.isDark(r+1,i)&&c++,e.isDark(r,i+1)&&c++,e.isDark(r+1,i+1)&&c++,(0==c||4==c)&&(n+=3)}for(var r=0;t>r;r++)for(var i=0;t-6>i;i++)e.isDark(r,i)&&!e.isDark(r,i+1)&&e.isDark(r,i+2)&&e.isDark(r,i+3)&&e.isDark(r,i+4)&&!e.isDark(r,i+5)&&e.isDark(r,i+6)&&(n+=40);for(var i=0;t>i;i++)for(var r=0;t-6>r;r++)e.isDark(r,i)&&!e.isDark(r+1,i)&&e.isDark(r+2,i)&&e.isDark(r+3,i)&&e.isDark(r+4,i)&&!e.isDark(r+5,i)&&e.isDark(r+6,i)&&(n+=40);for(var u=0,i=0;t>i;i++)for(var r=0;t>r;r++)e.isDark(r,i)&&u++;var h=Math.abs(100*u/t/t-50)/5;return n+=10*h}},d={glog:function(e){if(1>e)throw new Error("glog("+e+")");return d.LOG_TABLE[e]},gexp:function(e){for(;0>e;)e+=255;for(;e>=256;)e-=255;return d.EXP_TABLE[e]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)},f=0;8>f;f++)d.EXP_TABLE[f]=1<<f;for(var f=8;256>f;f++)d.EXP_TABLE[f]=d.EXP_TABLE[f-4]^d.EXP_TABLE[f-5]^d.EXP_TABLE[f-6]^d.EXP_TABLE[f-8];for(var f=0;255>f;f++)d.LOG_TABLE[d.EXP_TABLE[f]]=f;n.prototype={get:function(e){return this.num[e]},getLength:function(){return this.num.length},multiply:function(e){for(var t=new Array(this.getLength()+e.getLength()-1),r=0;r<this.getLength();r++)for(var i=0;i<e.getLength();i++)t[r+i]^=d.gexp(d.glog(this.get(r))+d.glog(e.get(i)));return new n(t,0)},mod:function(e){if(this.getLength()-e.getLength()<0)return this;for(var t=d.glog(this.get(0))-d.glog(e.get(0)),r=new Array(this.getLength()),i=0;i<this.getLength();i++)r[i]=this.get(i);for(var i=0;i<e.getLength();i++)r[i]^=d.gexp(d.glog(e.get(i))+t);return new n(r,0).mod(e)}},r.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],r.getRSBlocks=function(e,t){var n=r.getRsBlockTable(e,t);if(void 0==n)throw new Error("bad rs block @ typeNumber:"+e+"/errorCorrectLevel:"+t);for(var i=n.length/3,a=[],s=0;i>s;s++)for(var o=n[3*s+0],l=n[3*s+1],c=n[3*s+2],u=0;o>u;u++)a.push(new r(l,c));return a},r.getRsBlockTable=function(e,t){switch(t){case u.L:return r.RS_BLOCK_TABLE[4*(e-1)+0];case u.M:return r.RS_BLOCK_TABLE[4*(e-1)+1];case u.Q:return r.RS_BLOCK_TABLE[4*(e-1)+2];case u.H:return r.RS_BLOCK_TABLE[4*(e-1)+3];default:return void 0}},i.prototype={get:function(e){var t=Math.floor(e/8);return 1==(1&this.buffer[t]>>>7-e%8)},put:function(e,t){for(var n=0;t>n;n++)this.putBit(1==(1&e>>>t-n-1))},getLengthInBits:function(){return this.length},putBit:function(e){var t=Math.floor(this.length/8);this.buffer.length<=t&&this.buffer.push(0),e&&(this.buffer[t]|=128>>>this.length%8),this.length++}};var m=[[17,14,11,7],[32,26,20,14],[53,42,32,24],[78,62,46,34],[106,84,60,44],[134,106,74,58],[154,122,86,64],[192,152,108,84],[230,180,130,98],[271,213,151,119],[321,251,177,137],[367,287,203,155],[425,331,241,177],[458,362,258,194],[520,412,292,220],[586,450,322,250],[644,504,364,280],[718,560,394,310],[792,624,442,338],[858,666,482,382],[929,711,509,403],[1003,779,565,439],[1091,857,611,461],[1171,911,661,511],[1273,997,715,535],[1367,1059,751,593],[1465,1125,805,625],[1528,1190,868,658],[1628,1264,908,698],[1732,1370,982,742],[1840,1452,1030,790],[1952,1538,1112,842],[2068,1628,1168,898],[2188,1722,1228,958],[2303,1809,1283,983],[2431,1911,1351,1051],[2563,1989,1423,1093],[2699,2099,1499,1139],[2809,2213,1579,1219],[2953,2331,1663,1273]],y=function(){var e=function(e,t){this._el=e,this._htOption=t};return e.prototype.draw=function(e){function t(e,t){var n=document.createElementNS("http://www.w3.org/2000/svg",e);for(var r in t)t.hasOwnProperty(r)&&n.setAttribute(r,t[r]);return n}var n=this._htOption,r=this._el,i=e.getModuleCount();Math.floor(n.width/i),Math.floor(n.height/i),this.clear();var a=t("svg",{viewBox:"0 0 "+String(i)+" "+String(i),width:"100%",height:"100%",fill:n.colorLight});a.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),r.appendChild(a),a.appendChild(t("rect",{fill:n.colorDark,width:"1",height:"1",id:"template"}));for(var s=0;i>s;s++)for(var o=0;i>o;o++)if(e.isDark(s,o)){var l=t("use",{x:String(s),y:String(o)});l.setAttributeNS("http://www.w3.org/1999/xlink","href","#template"),a.appendChild(l)}},e.prototype.clear=function(){for(;this._el.hasChildNodes();)this._el.removeChild(this._el.lastChild)},e}(),g="svg"===document.documentElement.tagName.toLowerCase(),v=g?y:a()?function(){function e(){this._elImage.src=this._elCanvas.toDataURL("image/png"),this._elImage.style.display="block",this._elCanvas.style.display="none"}function t(e,t){var n=this;if(n._fFail=t,n._fSuccess=e,null===n._bSupportDataURI){var r=document.createElement("img"),i=function(){n._bSupportDataURI=!1,n._fFail&&_fFail.call(n)},a=function(){n._bSupportDataURI=!0,n._fSuccess&&n._fSuccess.call(n)};return r.onabort=i,r.onerror=i,r.onload=a,void(r.src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg==")}n._bSupportDataURI===!0&&n._fSuccess?n._fSuccess.call(n):n._bSupportDataURI===!1&&n._fFail&&n._fFail.call(n)}if(this._android&&this._android<=2.1){var n=1/window.devicePixelRatio,r=CanvasRenderingContext2D.prototype.drawImage;CanvasRenderingContext2D.prototype.drawImage=function(e,t,i,a,s,o,l,c){if("nodeName"in e&&/img/i.test(e.nodeName))for(var u=arguments.length-1;u>=1;u--)arguments[u]=arguments[u]*n;else"undefined"==typeof c&&(arguments[1]*=n,arguments[2]*=n,arguments[3]*=n,arguments[4]*=n);r.apply(this,arguments)}}var i=function(e,t){this._bIsPainted=!1,this._android=s(),this._htOption=t,this._elCanvas=document.createElement("canvas"),this._elCanvas.width=t.width,this._elCanvas.height=t.height,e.appendChild(this._elCanvas),this._el=e,this._oContext=this._elCanvas.getContext("2d"),this._bIsPainted=!1,this._elImage=document.createElement("img"),this._elImage.style.display="none",this._el.appendChild(this._elImage),this._bSupportDataURI=null};return i.prototype.draw=function(e){var t=this._elImage,n=this._oContext,r=this._htOption,i=e.getModuleCount(),a=r.width/i,s=r.height/i,o=Math.round(a),l=Math.round(s);t.style.display="none",this.clear();for(var c=0;i>c;c++)for(var u=0;i>u;u++){var h=e.isDark(c,u),p=u*a,d=c*s;n.strokeStyle=h?r.colorDark:r.colorLight,n.lineWidth=1,n.fillStyle=h?r.colorDark:r.colorLight,n.fillRect(p,d,a,s),n.strokeRect(Math.floor(p)+.5,Math.floor(d)+.5,o,l),n.strokeRect(Math.ceil(p)-.5,Math.ceil(d)-.5,o,l)}this._bIsPainted=!0},i.prototype.makeImage=function(){this._bIsPainted&&t.call(this,e)},i.prototype.isPainted=function(){return this._bIsPainted},i.prototype.clear=function(){this._oContext.clearRect(0,0,this._elCanvas.width,this._elCanvas.height),this._bIsPainted=!1},i.prototype.round=function(e){return e?Math.floor(1e3*e)/1e3:e},i}():function(){var e=function(e,t){this._el=e,this._htOption=t};return e.prototype.draw=function(e){for(var t=this._htOption,n=this._el,r=e.getModuleCount(),i=Math.floor(t.width/r),a=Math.floor(t.height/r),s=['<table style="border:0;border-collapse:collapse;">'],o=0;r>o;o++){s.push("<tr>");for(var l=0;r>l;l++)s.push('<td style="border:0;border-collapse:collapse;padding:0;margin:0;width:'+i+"px;height:"+a+"px;background-color:"+(e.isDark(o,l)?t.colorDark:t.colorLight)+';"></td>');s.push("</tr>")}s.push("</table>"),n.innerHTML=s.join("");var c=n.childNodes[0],u=(t.width-c.offsetWidth)/2,h=(t.height-c.offsetHeight)/2;u>0&&h>0&&(c.style.margin=h+"px "+u+"px")},e.prototype.clear=function(){this._el.innerHTML=""},e}();QRCode=function(e,t){if(this._htOption={width:256,height:256,typeNumber:4,colorDark:"#000000",colorLight:"#ffffff",correctLevel:u.H},"string"==typeof t&&(t={text:t}),t)for(var n in t)this._htOption[n]=t[n];"string"==typeof e&&(e=document.getElementById(e)),this._android=s(),this._el=e,this._oQRCode=null,this._oDrawing=new v(this._el,this._htOption),this._htOption.text&&this.makeCode(this._htOption.text)},QRCode.prototype.makeCode=function(e){this._oQRCode=new t(o(e,this._htOption.correctLevel),this._htOption.correctLevel),this._oQRCode.addData(e),this._oQRCode.make(),this._el.title=e,this._oDrawing.draw(this._oQRCode),this.makeImage()},QRCode.prototype.makeImage=function(){"function"==typeof this._oDrawing.makeImage&&(!this._android||this._android>=3)&&this._oDrawing.makeImage()},QRCode.prototype.clear=function(){this._oDrawing.clear()},QRCode.CorrectLevel=u}();var TC=TC||{};!function(){var e=[],t=[];TC.Map=TC.Map||function(e,t){var r=this;r.$events=$(r);r.isReady=!1;r.isLoaded=!1;r.controls=[];r.activeControl=null;r.layers=[];r.baseLayers=[];r.workLayers=[];r.baseLayer=null;r.vectors=null;var s=0;r.div=TC.Util.getDiv(e);r._$div=$(r.div);r._$div.addClass(TC.Consts.classes.LOADING);r._$div.data("map",r);r._$div.addClass(TC.Consts.classes.MAP);r._markerDeferreds=[];if(!TC.ready){TC.Cfg=$.extend({},TC.Defaults,TC.Cfg);TC.ready=!0}r.options=i(t);r._remainingLayers=0;var o=function(){if(r.options.stateful){l();r.state=r.checkLocation()}r.options.layout&&r.$events.trigger($.Event(TC.Consts.event.LAYOUTLOAD,{map:r}));t&&void 0!==t.workLayers&&(r.options.workLayers=t.workLayers);t&&void 0!==t.baseLayers&&(r.options.baseLayers=t.baseLayers);r._remainingLayers=r.options.baseLayers.length+r.options.workLayers.length;if(r.options.zoomToFeatures){var e=function i(e){clearTimeout(r._zoomToFeaturesTimeout);r._zoomToFeaturesTimeout=setTimeout(function(){r.zoomToFeatures(e.layer.features,{animate:!1});r.off(TC.Consts.event.FEATURESADD,i)},100)};r.on(TC.Consts.event.FEATURESADD,e)}else{var n=function a(e){if(e.layer.isBase&&e.layer===r.baseLayer){"undefined"!=typeof r.state&&r.setExtent(r.state.ext);r.off(TC.Consts.event.LAYERADD,a)}};r.on(TC.Consts.event.LAYERADD,n)}r.crs=r.options.crs;r.wrap=new TC.wrap.Map(r);TC.loadJS(!(TC.isLegacy?window[TC.Consts.PROJ4JSOBJ_LEGACY]:window[TC.Consts.PROJ4JSOBJ]),[TC.url.proj4js],function(){TC.loadJSInOrder(!(TC.isLegacy?window[TC.Consts.OLNS_LEGACY]:window[TC.Consts.OLNS]),[TC.url.ol,TC.url.olConnector],function(){TC.loadProjDef(r.options.crs,function(){r.wrap.setMap();for(var e in r.options.controls)if(r.options.controls[e])if("boolean"==typeof r.options.controls[e])r.addControl(e);else{var t=r.options.controls[e];e=e.substr(0,1).toUpperCase()+e.substr(1);r.addControl(e,t)}r.on(TC.Consts.event.BEFORELAYERUPDATE,y);r.on(TC.Consts.event.LAYERUPDATE,g);var n,i,a;for(n=0;n<r.options.baseLayers.length;n++){a=r.options.baseLayers[n];if("string"==typeof a)for(i=0;i<TC.Cfg.availableBaseLayers.length;i++)if(TC.Cfg.availableBaseLayers[i].id===a){a=TC.Cfg.availableBaseLayers[i];break}r.addLayer($.extend({},a,{isBase:!0,map:r}))}var s=function(e){e.isRaster()&&!e.names&&e.setVisibility(!1)};for(n=0;n<r.options.workLayers.length;n++){var o=!1;a=$.extend({},r.options.workLayers[n],{map:r});if(r.state&&a.type!==TC.Consts.layerType.VECTOR)for(var n=0;n<r.state.layers.length;n++){var l=r.state.layers[n];if(l.u===a.url&&a.layerNames.indexOf(l.n)>=0){a.hideTitle=l.hideTitle;a.renderOptions={opacity:l.o,hide:!l.v};l.Added=!0;break}o=!0}o||$.when(r.addLayer(a)).then(s)}r.state&&r.state.layers&&r.state.layers.forEach(function(e){if(!e.Added){var t=e.o,n=e.v;r.addLayer({id:TC.getUID(),url:TC.Util.isOnCapabilities(e.u,e.u.indexOf(window.location.protocol)<0)||e.u,hideTitle:e.h,layerNames:[e.n],renderOptions:{opacity:e.o,hide:!e.v}}).then(function(e){var r=e.wrap.getRootLayerNode();e.title=r.Title||r.title;e.setOpacity(t);e.setVisibility(n)})}});r.isReady=!0;r.$events.trigger($.Event(TC.Consts.event.MAPREADY))})})});r.on(TC.Consts.event.FEATURECLICK,function(e){r.activeControl&&r.activeControl.isExclusive()||e.feature.showPopup()});r.on(TC.Consts.event.NOFEATURECLICK,function(e){e.layer._noFeatureClicked=!0;var t,n,i=!0;for(t=0;t<r.workLayers.length;t++){n=r.workLayers[t];if(n instanceof TC.layer.Vector&&!n._noFeatureClicked){i=!1;break}}if(i){for(t=0;t<r.workLayers.length;t++){n=r.workLayers[t];n instanceof TC.layer.Vector&&delete n._noFeatureClicked}for(var a=r.getControlsByClass(TC.control.Popup),t=0,s=a.length;s>t;t++)a[t].hide()}})};r.one(TC.Consts.event.MAPREADY,function(){p(r._$div)});r.one(TC.Consts.event.MAPLOAD,function(){r._$div.removeClass(TC.Consts.classes.LOADING)});var l=function(){var e=4;window.jsonpack||TC.syncLoadJS(TC.apiLocation+TC.Consts.url.JSONPACK);var t=[TC.Consts.event.LAYERADD,TC.Consts.event.LAYERORDER,TC.Consts.event.LAYERREMOVE,TC.Consts.event.LAYERVISIBILITY,TC.Consts.event.ZOOM,TC.Consts.event.BASELAYERCHANGE].join(" ");r.on(TC.Consts.event.MAPLOAD,function(){r.loaded(function(){r.replaceCurrent=!0;h();r.on(t,$.proxy(h,r));var n;r.on(TC.Consts.event.LAYEROPACITY,function(e){clearTimeout(n);n=setTimeout(function(){h(e)},500)});window.addEventListener("popstate",function(n){var i;i=r.loadingCtrl&&r.loadingCtrl.addWait();setTimeout(function(){if(n&&null!=n.state){r.registerState=!1;r.off(t,$.proxy(h,r));$.when(m(n.state)).then(function(){r.on(t,$.proxy(h,r));r.loadingCtrl&&r.loadingCtrl.removeWait(i)})}},e)})})})},c=null,u=null,h=function(e){var t=".tc",n=d();if(r.replaceCurrent){window.history.replaceState(n,null,null);delete r.replaceCurrent}else if(void 0==r.registerState||r.registerState){var i=function(){u=c;c=TC.Util.utf8ToBase64(n);window.history.pushState(n,null,window.location.href.split("#").shift()+"#"+c)};if(e)switch(!0){case e.type==TC.Consts.event.BASELAYERCHANGE.replace(t,""):case e.type==TC.Consts.event.ZOOM.replace(t,""):case e.type==TC.Consts.event.LAYERORDER.replace(t,""):i();break;case e.type.toLowerCase().indexOf("LAYER".toLowerCase())>-1:e.layer.type==TC.Consts.layerType.WMS&&i()}}else r.registerState=!0},d=function(){for(var e={},t=r.getExtent(),n=0;n<t.length;n++)Math.abs(t[n])>180&&(t[n]=Math.floor(1e3*t[n])/1e3);e.ext=t;e.base=r.getBaseLayer().id;e.layers=[];for(var i,a,n=0;n<r.workLayers.length;n++){i=r.workLayers[n];if("WMS"==i.type&&!i.options.stateless&&i.layerNames&&i.layerNames.length){a={u:TC.Util.isOnCapabilities(i.url),n:i.layerNames[0],o:i.wrap.getLayer().getOpacity(),v:i.getVisibility(),h:i.options.hideTitle};e.layers.push(a)}}return jsonpack.pack(e)},f=function(){var e=[];r.workLayers.forEach(function(t){"vector"!=t.type&&e.push(t)});for(var t=0;t<e.length;t++)r.removeLayer(e[t])},m=function(e){var t=new $.Deferred,n=[];r.loadingctrl||(r.loadingCtrl=r.getControlsByClass("TC.control.LoadingIndicator")[0]);r.hasWait||(r.hasWait=r.loadingCtrl&&r.loadingCtrl.addWait());var i,a=function(){r.loadingCtrl&&r.loadingCtrl.removeWait(r.hasWait);delete r.hasWait;t.resolve()};if("string"==typeof e)try{i=jsonpack.unpack(e)}catch(s){i=JSON.parse(e)}else i=e;if(i){i.base!=r.getBaseLayer().id&&r.setBaseLayer(i.base);i.ext&&n.push(r.setExtent(i.ext));f();i.layers=i.layers||i.capas||[];if(i.layers.length>0)for(var o=0;o<i.layers.length;o++){var l=i.layers[o],c=l.o,u=l.v,h=!1;for(j=0;j<r.options.workLayers.length;j++){var p=$.extend({},r.options.workLayers[j],{map:r});if(p.type!==TC.Consts.layerType.VECTOR&&l.u===p.url&&p.layerNames.indexOf(l.n)){h=!0;p.renderOptions.opacity=l.o;p.renderOptions.hide=!l.v;n.push(r.addLayer(p).then(setVisibility));break}}h||n.push(r.addLayer({id:TC.getUID(),url:TC.Util.isOnCapabilities(l.u,l.u.indexOf(window.location.protocol)<0)||l.u,hideTitle:l.h,layerNames:[l.n],renderOptions:{opacity:l.o,hide:!l.v}}).then(function(e){var t=e.wrap.getRootLayerNode();e.title=t.Title||t.title;e.setOpacity(c);e.setVisibility(u)}))}$.when.apply($,n).done(function(){a()})}return t};a.getMapState=function(){var e=d();return TC.Util.utf8ToBase64(e)};a.getPreviousMapState=function(){return u};a.checkLocation=function(){var e=window.location.hash;if(e&&e.length>1){e=e.substr(1);var t;try{t=jsonpack.unpack(TC.Util.base64ToUtf8(e))}catch(n){try{t=JSON.parse(TC.Util.base64ToUtf8(e))}catch(n){r.toast(TC.Util.getLocaleString(r.options.locale,"mapStateNotValid"),{type:TC.Consts.msgType.ERROR})}}if(t)return t}};var y=function(e){if(0>=s){s=0;r.$events.trigger($.Event(TC.Consts.event.BEFOREUPDATE))}s+=1},g=function(e){s-=1;if(0>=s){s=0;r.$events.trigger($.Event(TC.Consts.event.UPDATE))}},v=function(e){var t=$.Deferred();if("string"==typeof e){var n=e,r=function(e,t){var n=$.Deferred();$.ajax({type:"HEAD",url:e,complete:function(r,i){n.resolve({resource:t,found:404!==r.status,url:e})}});return n.promise()},i=function(t,i){var l=$.Deferred(),c=[o+n+"/"+i,s+n+"/"+i,s+"responsive/"+i],u=0;!function h(n){r(c[n],t).done(function(t){t.found?l.resolve(a(e,t)):h(++n)})}(u);return l.promise()},a=function(e,t){if(!(t.resource in e)){var r=($.extend(!0,{},e),t.found?t.url:s+n+"/"+l[t.resource]);e[t.resource]=r}return e},s=TC.apiLocation+"TC/layout/",o="layout/",e={},l={script:"script.js",style:"style.css",markup:"markup.html",config:"config.json",i18n:"resources"},c=Object.keys(l).length;for(var u in l)i(u,l[u]).done(function(e){Object.keys(e).length===c&&t.resolve(e)})}else t.resolve(e);return t.promise()};TC.i18n=TC.i18n||{};TC.i18n.loadResources=TC.i18n.loadResources||function(e,t,n){var r;e?r=$.ajax({url:t+n+".json",type:"GET",dataType:"json",success:function(e){TC.i18n[n]=TC.i18n[n]||{};$.extend(TC.i18n[n],e);"undefined"!=typeof dust&&dust.i18n.add(n,TC.i18n[n])}}):dust.i18n.add(n,TC.i18n[n]);return r};var C=[],L=r.options.locale,T=$.Deferred();C.push(T);TC.loadJSInOrder(!window.dust||!window.dust.i18n,TC.url.templating,function(){if(L){dust.i18n.setLanguages([L]);C.push(TC.i18n.loadResources(!TC.i18n[L],TC.apiLocation+"TC/resources/",L))}T.resolve()});$.when.apply(this,C).always(function(){r.options.layout?v(r.options.layout).done(function(e){r.$events.trigger($.Event(TC.Consts.event.BEFORELAYOUTLOAD,{map:r}));var n;"string"==typeof e?n={href:$.trim(e)}:(e.hasOwnProperty("config")||e.hasOwnProperty("markup")||e.hasOwnProperty("style")||e.hasOwnProperty("ie8Style")||e.hasOwnProperty("script")||e.hasOwnProperty("href")||e.hasOwnProperty("i18n"))&&(n=$.extend({},e));n.href&&(n.href+=n.href.match(/\/$/)?"":"/");n.config=n.config||n.href+"config.json";n.markup=n.markup||n.href+"markup.html";n.style=n.style||n.href+"style.css";n.ie8Style=n.ie8Style||n.href+"ie8.css";n.script=n.script||n.href+"script.js";n.i18n=n.i18n||n.href+"resources";n.i18n&&(n.i18n+=n.i18n.match(/\/$/)?"":"/");r.layout=n;var a=[],s=$.Deferred();a.push(s);n.config?a.push($.ajax({url:n.config,type:"GET",dataType:"json",success:function(e){s.resolve(e.i18n);r.options=i(e,t)},error:function(e,t,n){TC.error(t+": "+n);s.resolve(!1)}})):s.resolve(!1);if(n.markup){var l;if(L){l=$.Deferred();a.push(l)}a.push($.ajax({url:n.markup,type:"GET",dataType:"html",success:function(e){s.then(function(t){if(t&&L)TC.i18n.loadResources(!0,n.i18n,L).always(function(){var t="tc-markup";dust.loadSource(dust.compile(e,t));dust.render(t,null,function(e,t){if(e){TC.error(e);l.reject()}else{r._$div.append(t);l.resolve()}})});else{r._$div.append(e);L&&l.resolve()}})},error:function(){l.reject()}}))}$.when.apply(this,a).always(function(){TC.loadJS(n.script,n.script,function(){p(r._$div);n.style&&TC.loadCSS(n.style);!Modernizr.canvas&&n.ie8Style&&TC.loadCSS(n.ie8Style);o()})})}):o()});r.$events.on(TC.Consts.event.UPDATEPARAMS,function(e){n(e.layer)});r.$events.on(TC.Consts.event.ZOOM,function(){for(var e=0;e<r.workLayers.length;e++)n(r.workLayers[e])});var w=TC.error;TC.error=function(e){w(e);r.toast(e,{type:TC.Consts.msgType.ERROR,duration:2*TC.Cfg.toastDuration})}};var n=function(e){e.type===TC.Consts.layerType.WMS&&(e.tree=null)},r=function(e,t){var n=$.map(e,function(e){var n={};e&&(n[t]=e[t]);return n}),r={};r[t]=TC.Cfg[t];n.unshift(r);if("baseLayers"===t&&n[1].baseLayers){r=n[1];for(var i=0;i<r.baseLayers.length;i++)"object"==typeof r.baseLayers[i]&&$.extend(r.baseLayers[i],$.grep(TC.Cfg.availableBaseLayers,function(e){return e.id===r.baseLayers[i].id})[0])}else{n.unshift(!0);r=$.extend.apply(this,n)}return r[t]},i=function(){var e=$.extend.apply(this,$.merge([!0,{},TC.Cfg],arguments));e.baseLayers=r(arguments,"baseLayers");e.workLayers=r(arguments,"workLayers");return e},a=TC.Map.prototype;a.addLayer=function(n,r){var i=this,a=d(n);if(a){var s;for(s=0,len=e.length;s<len&&d(e[s]);s++);e.splice(s,0,n);t.splice(s,0,r)}else{e.push(n);t.push(r)}for(var o=new $.Deferred,l=function(e){return"string"==typeof e?e:e.id},c=l(n),u=!1,h=0;h<i.options.baseLayers.length&&!u;h++)l(i.options.baseLayers[h])===c&&(u=!0);for(var h=0;h<i.options.workLayers.length&&!u;h++)l(i.options.workLayers[h])===c&&(u=!0);u||i.isLoaded||(i._remainingLayers=i._remainingLayers+1);var p,f,m;if(a){f=!TC.layer||!TC.layer.Raster;m=TC.apiLocation+"TC/layer/Raster.js"}else{f=!TC.layer||!TC.layer.Vector;m=TC.apiLocation+"TC/layer/Vector.js"}TC.loadJS(f,[m],function(){if("string"==typeof n){for(var a=0;a<TC.Cfg.availableBaseLayers.length;a++)if(TC.Cfg.availableBaseLayers[a].id===n){p=new TC.layer.Raster($.extend({},TC.Cfg.availableBaseLayers[a],{map:i}));break}}else if(n instanceof TC.Layer){p=n;p.map=i}else{n.map=i;p=n.type===TC.Consts.layerType.VECTOR||n.type===TC.Consts.layerType.KML||n.type===TC.Consts.layerType.WFS?new TC.layer.Vector(n):new TC.layer.Raster(n)}var s=$.inArray(n,e);0>s&&(s=0);e[s]=p;t[s]=r;i.$events.trigger($.Event(TC.Consts.event.BEFORELAYERADD,{layer:p}));$.when(i.wrap.getMap(),p.wrap.getLayer()).then(function(){var n=$.grep(e,function(e){return e.wrap&&e.wrap.isNative(e.wrap.getLayer())});if(n.length===e.length)for(var r=e.length,a=0;r>a;a++){var s=e.shift(),l=t.shift(),c=-1;d(s)&&(c=i.wrap.indexOfFirstVector());-1===c&&(c=i.wrap.getLayerCount());if(s)if(s.isCompatible(i.crs)){i.layers[i.layers.length]=s;if(s.isBase){i.state?s.isDefault=i.state.base===s.id:"string"==typeof i.options.defaultBaseLayer?s.isDefault=i.options.defaultBaseLayer===s.id:"number"==typeof i.options.defaultBaseLayer&&(s.isDefault=i.options.defaultBaseLayer===i.baseLayers.length);if(s.isDefault){i.wrap.setBaseLayer(s.wrap.getLayer());i.baseLayer=s}i.baseLayers[i.baseLayers.length]=s;i.options.baseLayers.length!==i.baseLayers.length||i.baseLayer||i.wrap.setBaseLayer(i.baseLayers[0].wrap.getLayer())}else{i.wrap.insertLayer(s.wrap.getLayer(),c);i.workLayers[i.workLayers.length]=s}i.$events.trigger($.Event(TC.Consts.event.LAYERADD,{layer:s}));$.isFunction(l)&&l(s)}else{var u,h='Layer "'+s.title+'" ("'+s.names+'"): ';u=s.isValidFromNames()?"layerSrsNotCompatible":"layerNameNotValid";h+=TC.Util.getLocaleString(i.options.locale,u);TC.error(h);i.$events.trigger($.Event(TC.Consts.event.LAYERERROR,{layer:s,reason:u}))}i._remainingLayers=i._remainingLayers-1;if(0===i._remainingLayers&&!i.isLoaded){i.isLoaded=!0;i.$events.trigger($.Event(TC.Consts.event.MAPLOAD))}}o.resolve(p)})});return o.promise()};a.removeLayer=function(e){var t=this,n=new $.Deferred;$.when(e.wrap.getLayer()).then(function(r){for(var i=0;i<t.layers.length;i++)t.layers[i]===e&&t.layers.splice(i,1);if(e.isBase){for(var i=0;i<t.baseLayers.length;i++)if(t.baseLayers[i]===e){t.baseLayers.splice(i,1);t.baseLayer===e&&t.setBaseLayer(t.baseLayers[0]);break}}else{for(var i=0;i<t.workLayers.length;i++)if(t.workLayers[i]===e){t.workLayers.splice(i,1);break}e===t.vectors&&(t.vectors=null)}t.wrap.removeLayer(r);t.$events.trigger($.Event(TC.Consts.event.LAYERREMOVE,{layer:e}));n.resolve(e)});return n};a.insertLayer=function(e,t,n){for(var r=this,i=-1,a=0;a<r.layers.length;a++)if(e===r.layers[a]){i=a;break}var s=[];s.push(e.wrap.getLayer());var o=r.layers[t];o&&s.push(o.wrap.getLayer());$.when.apply(this,s).then(function(a,s){var o=-1;o=s?r.wrap.getLayerIndex(s):r.wrap.getLayerCount();if(o>=0){e.map=r;r.wrap.insertLayer(a,o);i>-1&&r.layers.splice(i,1);r.layers.splice(t,0,e);r.workLayers=$.grep(r.layers,function(e){return!e.isBase});r.$events.trigger($.Event(TC.Consts.event.LAYERORDER,{layer:e,oldIndex:i,newIndex:t}))}$.isFunction(n)&&n()})};a.setLayerIndex=function(e,t){this.wrap.setLayerIndex(e.wrap.getLayer(),t)};a.putLayerOnTop=function(e){var t=this,n=t.wrap.getLayerCount();t.setLayerIndex(e,n-1)};a.setBaseLayer=function(e,t){var n=this,r=null,i=!1;if("string"==typeof e){var a;for(a=0;a<n.layers.length;a++)if(n.layers[a].id===e){e=n.layers[a];i=!0;break}if(!i)for(a=0;a<TC.Cfg.availableBaseLayers.length;a++)if(TC.Cfg.availableBaseLayers[a].id===e){e=n.addLayer($.extend(!0,{},TC.Cfg.availableBaseLayers[a],{isDefault:!0,map:n}));i=!0;break}}else i=$.inArray(e,n.layers)>=0;if(i){n.$events.trigger($.Event(TC.Consts.event.BEFOREBASELAYERCHANGE,{oldLayer:n.getBaseLayer(),newLayer:e}));r=e;$.when(n.wrap.getMap(),e).then(function(e,r){$.when(r.wrap.getLayer()).then(function(e){n.wrap.setBaseLayer(e).then(function(){n.baseLayer=r;n.$events.trigger($.Event(TC.Consts.event.BASELAYERCHANGE,{layer:r}));$.isFunction(t)&&t()})})})}else TC.error("Base layer is not in layers collection");return r};a.on=function(e,t){var n=this;n.$events.on(e,t);return n};a.one=function(e,t){var n=this;n.$events.one(e,t);return n};a.off=function(e,t){var n=this;n.$events.off(e,t);return n};a.ready=function(e){var t=this;$.isFunction(e)&&(t.isReady?e():t.one(TC.Consts.event.MAPREADY,e))};a.loaded=function(e){var t=this;$.isFunction(e)&&(t.isLoaded?e():t.one(TC.Consts.event.MAPLOAD,e))};a.getLayerTree=function(){var e=this,t={baseLayers:[],workLayers:[]};e.baseLayer&&(t.baseLayers[0]=e.baseLayer.getTree());for(var n=0;n<e.workLayers.length;n++){var r=e.workLayers[n].getTree();r&&t.workLayers.unshift(r)}return t};a.addControl=function(e,t){var n=this,r=new $.Deferred,i=function(e){n.controls.push(e);e.register(n);$dv=$(e.div);0===$dv.parent().length&&$dv.appendTo(n._$div);r.resolve(e)};if("string"==typeof e){e=e.substr(0,1).toUpperCase()+e.substr(1);TC.loadJS(!TC.Control||!TC.control[e],[TC.apiLocation+"TC/control/"+e+".js"],function(){i(new TC.control[e](null,t))})}else i(e);return r.promise()};a.getControlsByClass=function(e){var t=this,n=[],r=e;if("string"==typeof e){r=window;for(var i=e.split("."),a=0;a<i.length;a++){r=r[i[a]];if(!r)break}}if($.isFunction(r))for(var a=0;a<t.controls.length;a++){var s=t.controls[a];s instanceof r&&n.push(s)}return n};a.getDefaultControl=function(){var e=this.getControlsByClass("TC.control.FeatureInfo");return e&&e.length?e[0]:null};a.getLoadingIndicator=function(){var e=null,t=this.getControlsByClass("TC.control.LoadingIndicator");t.length&&(e=t[0]);return e};a.setExtent=function(e,t){return this.wrap.setExtent(e,t)};a.getExtent=function(){return this.wrap.getExtent()};a.setCenter=function(e,t){this.wrap.setCenter(e,t)};a.getCenter=function(){return this.wrap.getCenter()};a.setRotation=function(e){this.wrap.setRotation(e)};a.getRotation=function(){return this.wrap.getRotation()};a.getViewHTML=function(){return this.wrap.getViewport()};a.getCoordinateFromPixel=function(e){return this.wrap.getCoordinateFromPixel(e)};a.getPixelFromCoordinate=function(e){return this.wrap.getPixelFromCoordinate(e)};a.zoomToFeatures=function(e,t){var n=this;if(e.length>0){var r=[1/0,1/0,-(1/0),-(1/0)],i=t||{},a=i.pointBoundsRadius||n.options.pointBoundsRadius;a=n.wrap.isGeo()?a/TC.Util.getMetersPerDegree(n.getExtent()):a;var s=i.extentMargin;"number"!=typeof s&&(s=n.options.extentMargin);for(var o=0;o<e.length;o++){var l=e[o].getBounds();if(l){r[0]=Math.min(r[0],l[0]);r[1]=Math.min(r[1],l[1]);r[2]=Math.max(r[2],l[2]);r[3]=Math.max(r[3],l[3])}}if(r[2]-r[0]===0){r[0]=r[0]-a;r[2]=r[2]+a}if(r[3]-r[1]===0){r[1]=r[1]-a;r[3]=r[3]+a}if(n.options.extentMargin){var c=(r[2]-r[0])*s/2,u=(r[3]-r[1])*s/2;r[0]=r[0]-c;r[1]=r[1]-u;r[2]=r[2]+c;r[3]=r[3]+u}if(n.options.maxExtent){r[0]=Math.max(r[0],n.options.maxExtent[0]);r[1]=Math.max(r[1],n.options.maxExtent[1]);r[2]=Math.min(r[2],n.options.maxExtent[2]);r[3]=Math.min(r[3],n.options.maxExtent[3])}n.wrap.setExtent(r,i);

}};a.zoomToMarkers=function(e){var t=this;$.when.apply(this,t._markerDeferreds).then(function(){for(var n=[],r=0;r<t.workLayers.length;r++){var i=t.workLayers[r];if(i.type===TC.Consts.layerType.VECTOR)for(var a=0;a<i.features.length;a++){var s=i.features[a];s instanceof TC.feature.Marker&&(n[n.length]=s)}}for(var r=0;r<arguments.length;r++)n[n.length]=arguments[r];t.zoomToFeatures(n,e);t._markerDeferreds=[]})};a.getLayer=function(e){var t=this,n=null;if("string"==typeof e){for(var r=0;r<t.layers.length;r++)if(t.layers[r].id===e){n=t.layers[r];break}}else TC.Layer&&e instanceof TC.Layer&&(n=e);return n};var s=function(e){var t;if(e.vectors)t=e.vectors;else{t=e.addLayer({id:TC.getUID(),title:TC.i18n[e.options.locale].vectors,type:TC.Consts.layerType.VECTOR});e.vectors=t;$.when(t).then(function(t){e.vectors=t})}return t};a.addPoint=function(e,t){var n=this;if(t&&t.layer){var r=n.getLayer(t.layer);r&&r.addPoint(e,t)}else $.when(s(n)).then(function(n){n.addPoint(e,t)})};a.addMarker=function(e,t){var n=this;if(t&&t.layer){var r=n.getLayer(t.layer);r&&n._markerDeferreds.push(r.addMarker(e,t))}else{var i=new $.Deferred;n._markerDeferreds.push(i);$.when(s(n)).then(function(n){$.when(n.addMarker(e,t)).then(function(e){i.resolve(e)})})}};a.addPolyline=function(e,t){var n=this;if(t&&t.layer){var r=n.getLayer(t.layer);r&&t.layer.addPolyline(e,t)}else $.when(s(n)).then(function(n){n.addPolyline(e,t)})};a.addPolygon=function(e,t){var n=this;if(t&&t.layer){var r=n.getLayer(t.layer);r&&t.layer.addPolygon(e,t)}else $.when(s(n)).then(function(n){n.addPolygon(e,t)})};a.getBaseLayer=function(){return this.baseLayer||this.baseLayers[0]};a.getResolutions=function(){return this.getBaseLayer().getResolutions()};a.getResolution=function(){return this.wrap.getResolution()};a.setResolution=function(e){this.wrap.setResolution(e)};a.exportFeatures=function(e,t){var n=this,r=t||{},i=n.getLoadingIndicator(),a=i&&i.addWait(),s=n.wrap.exportFeatures(e,r),o=TC.Consts.mimeType[r.format],l=r.format||"";TC.Util.downloadFile((r.fileName||TC.getUID())+"."+l.toLowerCase(),o,s);i&&i.removeWait(a)};var o="tc-toast-container",l="tc-toast",c={},u=function(){var e=$(this),t=e.parent("."+o),n=e.html();e.addClass(TC.Consts.classes.HIDDEN);void 0!==c[n]&&(c[n]=void 0);setTimeout(function(){e.remove();t.find("."+l).length||t.remove()},1e3)};a.toast=function(e,t){var n=this,r=t||{},i=r.duration||TC.Cfg.toastDuration,a=c[e];if(a){clearTimeout(a.timeout);a.$toast.remove()}var s=n._$div.find("."+o);s.length||(s=$("<div>").addClass(o).appendTo(n._$div));a=c[e]={$toast:$("<div>").addClass(l).html(e).appendTo(s).on(TC.Consts.event.CLICK,u)};var h="";switch(r.type){case TC.Consts.msgType.INFO:h=TC.Consts.classes.INFO;break;case TC.Consts.msgType.WARNING:h=TC.Consts.classes.WARNING;break;case TC.Consts.msgType.ERROR:h=TC.Consts.classes.ERROR}a.$toast.addClass(h);a.timeout=setTimeout(function(){u.call(a.$toast)},i)};var h=!1,p=function(e){if(/iPad/i.test(navigator.userAgent)){var t=window.innerHeight,n=e.height(),r=Modernizr.mq("only screen and (orientation : landscape)")?20:0;n===t+r&&(h=!0)}var i=function(){e.toggleClass(TC.Consts.classes.IPAD_IOS7_FIX,Modernizr.mq("only screen and (orientation : landscape)"))};if(h){i();$(window).on("resize",i)}else $(window).off("resize",i)},d=function(e){return"string"==typeof e||e.type!==TC.Consts.layerType.VECTOR&&e.type!==TC.Consts.layerType.KML&&e.type!==TC.Consts.layerType.WFS}}();var TC=TC||{};!function(){Number.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e};var e=Number.prototype.toLocaleString;Number.prototype.toLocaleString=function(t,n){if("eu-ES"!=t||TC.Util.detectIE())return e.apply(this,arguments);var r=e.apply(this,arguments);r=r.replace(/\,/g,".");Math.floor(this)==this&&Number.isInteger(Math.floor(this))||(r=r.replace(/.([^.]*)$/,",$1"));return r};var t={},n={},r=["Capability","Request","GetMap","DCPType","0","HTTP","Get","OnlineResource"],a=["OperationsMetadata","GetTile","DCP","HTTP","Get","0","href"],s=function(e,t,n){return n<t.length-1?e.hasOwnProperty(t[n])?s(e[t[n]],t,++n):null:e[t[n]]};TC.Util=TC.Util||{getMapLocale:function(e){return e.options&&e.options.locale&&e.options.locale.replace("_","-")||"es-ES"},regex:{PROTOCOL:/(^https?:)/i},isOnCapabilities:function(e){var t=2==arguments.length?arguments[1]:!0,n=t?e:e.replace(TC.Util.regex.PROTOCOL,"");if(t){if(TC.capabilities[n])return e}else for(var i in TC.capabilities)if(i.replace(TC.Util.regex.PROTOCOL,"")==n)return i;for(i in TC.capabilities){var o=s(TC.capabilities[i],r,0)||s(TC.capabilities[i],a,0);if(o&&t&&e==o)return o;if(o&&e.replace(TC.Util.regex.PROTOCOL,"")==o.replace(TC.Util.regex.PROTOCOL,""))return o}return e},reqGetMapOnCapabilities:function(e){var t=2==arguments.length?arguments[1]:!0,n=(t?e:e.replace(TC.Util.regex.PROTOCOL,""),function(e){var n=s(e,r,0)||s(e,a,0);return n?t?n.split("?")[0]:n.split("?")[0].replace(TC.Util.regex.PROTOCOL,""):null});return TC.capabilities[e]?n(TC.capabilities[e]):null},getFNFromString:function(e){var t=window,n=e.split(".");for(i=0;i<n.length-1;i++){t=t[n[i]];if(void 0==t)return}return t[n[n.length-1]]},isURL:function(e){return/^(http|https|ftp|mailto)\:\/\//i.test(e)},isSameOrigin:function(e){var t=0!==e.indexOf("http")&&0!==e.indexOf("//"),n=!t&&e.match(TC.Consts.url.SPLIT_REGEX);if(n){var r=window.location,i=n[1];t=(i==r.protocol||void 0==i)&&n[3]==r.hostname;var a=n[4],s=r.port;(80!=a&&""!==a||"80"!=s&&""!==s)&&(t=t&&a==s)}return t},addProtocol:function(e){var t=e;e&&0===e.indexOf("//")&&(t=location.protocol+e);return t},getDiv:function(e){var t;t="string"==typeof e?document.getElementById(e):1==$(e).length?e:document.createElement("div");return t},getBackgroundUrlFromCss:function(e){var n="";if(void 0!==t[e])n=t[e];else{var r=$('<div style="display:none">').addClass(e).appendTo("body"),i=/^url\(['"]?(.*?)['"]?\)$/gi.exec(r.css("background-image"));i&&i.length>1&&(n=i[i.length-1]);r.remove();t[e]=n}return n},getPointIconUrl:function o(e){var t=null;if(e.url)t=e.url;else{var r;if("string"==typeof e.cssClass)r=e.cssClass;else{var i=e.classes||TC.Cfg.styles.marker.classes;r=i[0];if(e.group){if(void 0===n[e.group]){var a=0;for(var s in n)a++;a%=i.length;n[e.group]=i[a]}r=n[e.group]}}t=TC.Util.getBackgroundUrlFromCss(r)}t||e===TC.Cfg.styles.point||""===e.cssClass||(t=o(TC.Cfg.styles.point));return t},addArrayToTree:function l(e,t,n){var r=null,i=!1;n=n||0;var a=e[n];if(a){for(var s,o=0,c=t.children.length;c>o;o++){s=t.children[o];if(s.name===a){i=!0;var u=l(e,s,n+1);u&&(r=u);break}}if(!i){s={name:a,title:a,uid:"/"+e.slice(0,n+1).join("/"),children:[]};t.children.push(s);r=s}}return r},parseCoords:function(e){var t=null,n=function(e){var t=e,n={};n.type=TC.Consts.GEOGRAPHIC;var r=t.indexOf("\xb0");n.value=parseFloat(t.substr(0,r));t=t.substr(r+1);r=t.indexOf("'");if(r>=0){var i=parseFloat(t.substr(0,r))/60;n.value>=0?n.value+=i:n.value-=i;t=t.substr(r+1);r=t.indexOf("'");if(r>=0){i=parseFloat(t.substr(0,r).replace(",","."))/3600;n.value>=0?n.value+=i:n.value-=i}}return n},r=function(e){var t=$.trim(e);if(t.match(/^1?\d{0,2}\s*\u00B0(\s*\d{1,2}\s*'(\s*\d{1,2}([.,]\d+)?\s*'')?)?\s*[NnSsWwOoEe]$/g)){switch(t[t.length-1]){case"S":case"s":case"W":case"w":case"O":case"o":t="-"+t}t=t.substr(0,t.length-1);return n(t)}if(t.match(/^[+-]?1?\d{0,2}\s*\u00B0(\s*\d{1,2}\s*'(\s*\d{1,2}([.,]\d+)?\s*'')?)?$/g))return n(t);if(t.match(/^1?\d{0,2}([.,]\d+)?\s*\u00B0?\s*[NnSsWwOoEe]$/g)){var r={type:TC.Consts.GEOGRAPHIC,value:parseFloat(t.substr(0,t.length-1).replace(",","."))};t.match(/[SsWwOo]$/)&&(r.value=-r.value);return r}return t.match(/^[+-]?1?\d{0,2}([.,]\d+)?\s*\u00B0?$/g)?{type:TC.Consts.GEOGRAPHIC,value:parseFloat(t.replace(",","."))}:t.match(/^\d{6,7}([.,]\d+)?$/g)?{type:TC.Consts.UTM,value:parseFloat(t.replace(",","."))}:null};e=$.trim(e).toUpperCase();var i=e.split(",");4===i.length?i=[i.slice(0,1).join("."),i.slice(2,3).join(".")]:(1===i.length||3===i.length)&&(i=e.split(" "));if(2===i.length){var a=r(i[0]),s=r(i[1]);null!==a&&null!==s&&(t=[a,s])}return t},reproject:function(e,t,n){var r,i=!0;(TC.isLegacy?window[TC.Consts.PROJ4JSOBJ_LEGACY]:window[TC.Consts.PROJ4JSOBJ])||TC.syncLoadJS(TC.url.proj4js);if(!$.isArray(e)||!$.isArray(e[0])){i=!1;e=[e]}TC.loadProjDef(t,!0);TC.loadProjDef(n,!0);var a=new Proj4js.Proj(t),s=new Proj4js.Proj(n);r=new Array(e.length);for(var o=0,l=e.length;l>o;o++){var c=Proj4js.transform(a,s,{x:e[o][0],y:e[o][1]});r[o]=[c.x,c.y]}i||(r=r[0]);return r},getMetersPerDegree:function(e){var t=void 0,n=6370997;if($.isArray(e)&&e.length>=4){var r=this.degToRad(e[3]-e[1]),i=Math.sin(r/2),a=i*i,s=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));t=n*s/(e[3]-e[1])}return t},radToDeg:function(e){return 180*e/Math.PI},degToRad:function(e){return e*Math.PI/180},mod:function(e){return(e%(2*Math.PI)+2*Math.PI)%(2*Math.PI)},getLocaleString:function(e,t,n){var r=t;if(TC.i18n&&TC.i18n[e]){var i=TC.i18n[e][t];if(i){r=i;if(n)for(var a in n)r=r.replace("{"+a+"}",n[a])}}return r},getSimpleMimeType:function(e){var t="";if(e){var n=e.indexOf(";");n>0&&(e=e.substring(0,n));t=e}return t},getQueryStringParams:function(e){var t;if(e){var n=e.indexOf("?");if(n>=0){t=e.substr(n);var r=t.indexOf("#");r>=0&&(t=t.substr(0,r))}else t="?"}else t=location.search;var i=$.map(t.replace(/(^\?)/,"").split("&"),function(e){return e=e.split("="),this[e[0]]=e[1],this}.bind({}))[0];delete i[""];return i},fastUnshift:function(e,t){for(var n=e.length;n;){e[n]=e[n-1];n--}e[0]=t},storage:{getCookie:function(e){return $.cookie(e)},setCookie:function(e,t,n){return $.cookie(e,t,n)},getLocalValue:function(e){var t=null;t=localStorage&&localStorage instanceof Storage?localStorage.getItem(e):TC.Util.storage.getCookie(e);return t},setLocalValue:function(e,t){if(localStorage&&localStorage instanceof Storage)void 0===t?localStorage.removeItem(e):localStorage.setItem(e,t);else if(void 0===t){var n=new Date;n.setDate(n.getDate()-1);TC.Util.storage.setCookie(e,"",{expires:n})}else TC.Util.storage.setCookie(e,t);return e},getSessionLocalValue:function(e){var t=null;t=sessionStorage&&sessionStorage instanceof Storage?sessionStorage.getItem(e):TC.Util.storage.getCookie(e);return t},setSessionLocalValue:function(e,t){if(sessionStorage&&sessionStorage instanceof Storage)void 0===t?sessionStorage.removeItem(e):sessionStorage.setItem(e,t);else if(void 0===t){var n=new Date;n.setDate(n.getDate()-1);TC.Util.storage.setCookie(e,"",{expires:n})}else TC.Util.storage.setCookie(e,t);return e}},detectFirefox:function(){return/Firefox[\/\s](\d+\.\d+)/.test(navigator.userAgent)?new Number(RegExp.$1):!1},detectIE:function(){var e=window.navigator.userAgent,t=e.indexOf("MSIE ");if(t>0)return parseInt(e.substring(t+5,e.indexOf(".",t)),10);var n=e.indexOf("Trident/");if(n>0){var r=e.indexOf("rv:");return parseInt(e.substring(r+3,e.indexOf(".",r)),10)}var i=e.indexOf("Edge/");return i>0?parseInt(e.substring(i+5,e.indexOf(".",i)),10):!1},detectChrome:function(){return window.chrome},detectSafari:function(){return!!navigator.userAgent.match(/Version\/[\d\.]+.*Safari/)},detectMouse:function(){if(Modernizr.mq("(pointer:coarse)")&&Modernizr.mq("(pointer:fine)"))return!0;if(Modernizr.mq("(pointer:coarse)")&&!Modernizr.mq("(pointer:fine)")){var e=function(){var e,t="(hover: hover)",n=!Modernizr.touch;if("matchMedia"in window){e=window.matchMedia(t);e.media===t&&(n=e.matches)}else console.log("no dispone de matchMedia");return n};return e()?!0:!1}return!Modernizr.mq("(pointer:coarse)")&&Modernizr.mq("(pointer:fine)")?!0:Modernizr.mq("(pointer:none)")?!1:Modernizr.touch?void 0:!0},detectAndroid:function(){return navigator.userAgent.match(/Android/i)},detectBlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},detectIOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},detectMobileWindows:function(){return navigator.userAgent.match(/IEMobile/i)},detectMobile:function(){return TC.Util.detectAndroid()||TC.Util.detectIOS()||TC.Util.detectMobileWindows()||TC.Util.detectBlackBerry()},getElementByNodeName:function(e,t){for(var n=t.indexOf(":"),r=t.substr(n+1),i=e.getElementsByTagNameNS("*",r),a=0;a<i.length;a++)if(i[a].nodeName==t)return i;return void 0},removeURLParameter:function(e,t){var n=e.toLowerCase().split("?");if(n.length>=2){for(var r=encodeURIComponent(t.toLowerCase())+"=",i=n[1].split(/[&;]/g),a=i.length;a-->0;)-1!==i[a].lastIndexOf(r,0)&&i.splice(a,1);e=n[0]+"?"+i.join("&");return e}return e},showModal:function(e,t){var n=$(e),t=t||{};n.off("click").removeAttr("hidden");n.fadeIn(250,function(){n.on("click",".tc-modal-close",function(e){e.stopPropagation();return TC.Util.closeModal(t.closeCallback)});$.isFunction(t.openCallback)&&t.openCallback()})},closeModal:function(e){$(".tc-modal").hide().find(".tc-modal-window").removeAttr("style").off();e&&e()},closeAlert:function(e){$(e).parents(".tc-alert").hide()},getParameterByName:function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)","i"),n=t.exec(location.search);return null===n?"":decodeURIComponent(n[1].replace(/\+/g," "))},downloadFile:function(e,t,n){var r=new Blob([n],{type:t});if(navigator.msSaveBlob)navigator.msSaveBlob(r,e);else{var i=document.createElement("a");if(void 0!==i.download){var a=URL.createObjectURL(r);i.setAttribute("href",a);i.setAttribute("download",e);i.style.visibility="hidden";document.body.appendChild(i);i.click();document.body.removeChild(i)}}},shortenUrl:function(e){var t;$.ajax({url:"https://api-ssl.bitly.com/v3/shorten",data:{access_token:"6c466047309f44bd8173d83e81491648b243ee3d",longUrl:e},async:!1}).done(function(e){t=e.data.url});return t},utf8ToBase64:function(e){return window.btoa(unescape(encodeURIComponent(e)))},base64ToUtf8:function(e){var t;try{t=decodeURIComponent(escape(window.atob(e)))}catch(n){t=null}return t},operation:function(e,t,n,r){for(var i=[],a=0;a<e.length;a++){for(var s=e[a],o=!1,l=0;l<t.length;l++)if(n(s,t[l])){o=!0;break}o===r&&i.push(s)}return i},inBoth:function(e,t,n){return this.operation(e,t,n,!0)},inFirstOnly:function(e,t,n){return this.operation(e,t,n,!1)},inSecondOnly:function(e,t,n){return this.inFirstOnly(t,e,n)},toDataUrl:function(e,t){var n={type:"image/png",encoderOptions:.92},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:n,i=r.type,a=r.encoderOptions,s=e.getContext("2d");if(!s)return"";var o=e.width,l=e.height,c=s.getImageData(0,0,o,l),u=s.globalCompositeOperation;if(t){s.globalCompositeOperation="destination-over";s.fillStyle=t;s.fillRect(0,0,o,l)}var h=e.toDataURL(i,a);if(t){s.clearRect(0,0,o,l);s.putImageData(c,0,0);s.globalCompositeOperation=u}return h},imgToDataUrl:function(e,t){var n=$.Deferred(),r=new Image;r.crossOrigin="anonymous";r.onload=function(){var e,r=document.createElement("CANVAS"),i=r.getContext("2d");r.height=this.height;r.width=this.width;i.drawImage(this,0,0);e=TC.Util.toDataUrl(r,"#ffffff",{type:t||"image/jpeg",encoderOptions:1});n.resolve(e,r)};e=e.replace(/^https?\:/i,"");r.src=e;if(r.complete||void 0===r.complete){r.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";r.src=e}return n.promise()},addToCanvas:function(e,t,n){var r=function(e){var t=document.createElement("canvas"),n=t.getContext("2d");t.width=e.width;t.height=e.height;n.drawImage(e,0,0);return t},i=r(e),a=$.Deferred(),s=i.getContext("2d"),o=new Image;o.src=t;o.onload=function(){s.drawImage(o,n.x||0,n.y||0);a.resolve(i)};return a.promise()},calculateAspectRatioFit:function(e,t,n,r){var i=Math.min(n/e,r/t);return{width:e*i,height:t*i}},getFormattedDate:function(e){function t(e){return 10>e?"0"+e:e}var n=new Date(e);return[n.getFullYear(),t(n.getMonth()+1),t(n.getDate())].join("")}}}();!function(e,t){"use strict";function n(e,t){var n=e.length;~t&&n>t&&(n=t);return n}function r(e,t){T.setTimeout(e,t||0)}function i(e){r(function(){throw e})}function a(e){return/(^(https?:)?\/\/)|(\.(js|php)$)/.test(e)&&!/(\n|\r)/m.test(e)}function s(e){return e&&e.constructor&&e.call&&e.apply}function o(e){var t;return(t=Array.isArray)?t(e)?e:[e]:w.concat(e)}function l(e){return w.slice.call(e)}function c(){var e=l(arguments);return function(){return E.apply(E,e.concat(l(arguments)))}}function u(e,t){var n=this;if((!n.readyState||/^c|loade/.test(n.readyState))&&!n.loadStatus){n.onload=n.onreadystatechange=n.onerror=null;n.loadStatus=!0;if(t&&"error"===t.type){var r=n.src||"Resource",a=" fails to load.",s={name:"ConnectionError",source:r,evt:t,stack:r+a,message:a,toString:function(){return this.source+this.message}};i(s);e.reject(s)}else e.resolve()}}function h(e,t){var n="script",r=L.createElement(n),i=L.getElementsByTagName(n),a=i[i.length-1];r.async=!0;r.src=e;if(t){r.loadStatus=!1;var s=c(u,r,t);r.onload=r.onreadystatechange=r.onerror=s;var o=a;o=o||document.body.firstChild;o.parentNode.insertBefore(r,o)}}function p(e,t){S(function(){try{e.call(null,t)}catch(n){t.reject(n)}})}function d(e,t){if(!s(e)){if(a(e)){h(e,t);return}if(b){e=v+encodeURIComponent(e);h(e,t);return}}var n=s(e)?e:Function(e);if(!t.async){var r=n;n=function(e){try{r.call(null);e.resolve()}catch(t){e.reject(t)}}}p(n,t)}function f(e,t){var n=this;n.tasks=[];n.callbacks=[];n.errors=[];n.data={};n.nextTask=0;n.nextCallback=0;n.until=-1;n.digest=!1;n.add(e).whenDone(t)}function m(){var e=this;if(e.digest)r(c(m,e),50/3);else{e.digest=!0;for(var t,i,a=e.nextCallback;a<n(e.callbacks,e.until);a++)if(e.nextTask===e.tasks.length){i=e.nextCallback;t=e.callbacks[i];if(t){e.nextCallback=a+1;t.call(null,e.data,e.nextTask-1,e.errors);if(!t.untilThen)continue;e.nextCallback--;e.until=-1}e.callbacks.splice(i,1)}e.digest=!1}}function y(){var e=this;if(e.nextTask<e.tasks.length&&++e.nextTask!==e.tasks.length)return e;m.call(e);return e}function g(e,t){return new f(e,t)}var v="data:application/javascript,",C="OMITTED",L=document,T=window,w=Array.prototype,b=!0;L.all&&!L.addEventListener&&(b=!1);var S=T.requestAnimationFrame||T.webkitRequestAnimationFrame||T.mozRequestAnimationFrame||r,E=Function.call;f.prototype.resolve=function(e,t){var n=this;e&&e!==C&&(n.data[e]=t);return y.call(n)};f.prototype.reject=function(e){var t=this;if(e){i(e);t.errors.push(e)}return y.call(t)};f.prototype.whenDone=function(e){var t=this;if(!e)return t;if(t.nextTask>t.tasks.length)return t;t.callbacks.push(e);t.nextTask===t.tasks.length&&t.resolve();return t};f.prototype.add=function(e,t){var n=this;if(!e)return n;if(t&&n[t]){var r=new Error("Callback value name: "+t+" is registered");i(r);n.errors.push(r)}e=o(e);for(var a,s=({resolve:c(n.resolve,n,t),reject:n.reject,async:!!t},0);s<e.length;s++){a=e[s];if(a){n.tasks.push(a);d(a,n)}}return n};f.prototype.then=function(e,t){function n(){r.until=r.nextCallback;r.add(e,t)}var r=this;if(!e)return r;n.untilThen=!0;return r.whenDone(n)};"undefined"!=typeof module&&module.exports?module.exports=g:"function"==typeof define&&define.amd?define(function(){return g}):t[e]=g}("asyncJS",this);var TC=TC||{};TC.version="1.1.3";!function(){if(!TC.apiLocation){var e,t;if(document.currentScript)t=document.currentScript;else{var n=document.getElementsByTagName("script");t=n[n.length-1]}var e=t.getAttribute("src");TC.apiLocation=e.substr(0,e.lastIndexOf("/")+1)}}();if(!TC.Consts){TC.Consts={};TC.Consts.OLNS_LEGACY="OpenLayers";TC.Consts.OLNS="ol";TC.Consts.PROJ4JSOBJ_LEGACY="Proj4js";TC.Consts.PROJ4JSOBJ="proj4";TC.Consts.GEOGRAPHIC="geographic";TC.Consts.UTM="UTM";TC.Consts.OLD_BROWSER_ALERT="TC.oldBrowserAlert";TC.Consts.CLUSTER_ANIMATION_DURATION=200;TC.Consts.ZOOM_ANIMATION_DURATION=300;TC.Consts.URL_MAX_LENGTH=2048;TC.Consts.METER_PRECISION=0;TC.Consts.DEGREE_PRECISION=5;TC.Consts.url={SPLIT_REGEX:/([^:]*:)?\/\/([^:]*:?[^@]*@)?([^:\/\?]*):?([^\/\?]*)/,MODERNIZR:"lib/modernizr.js",JQUERY_LEGACY:TC.apiLocation+"lib/jquery/jquery.1.10.2.js",JQUERY:"//ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.js",OL_LEGACY:"lib/OpenLayers/OpenLayers.debug.js",OL:"lib/ol/build/ol-custom.js",OL_CONNECTOR_LEGACY:"TC/ol/ol2.js",OL_CONNECTOR:"TC/ol/ol3.js",TEMPLATING:"lib/dust/dust-full-helpers.min.js",TEMPLATING_I18N:"lib/dust/dustjs-i18n.min.js",PROJ4JS_LEGACY:"lib/proj4js/legacy/proj4js-compressed.js",PROJ4JS:"lib/proj4js/proj4-src.js",SPATIALREFERENCE:"http://spatialreference.org/",LOCALFORAGE:TC.apiLocation+"lib/localForage/localforage.min.js",D3C3:TC.apiLocation+"lib/d3c3/d3c3.min.js",CESIUM:TC.apiLocation+"lib/cesium/debug/Cesium.js",JSNLOG:"lib/jsnlog/jsnlog.min.js",ERROR_LOGGER:TC.apiLocation+"errors/logger.ashx",PDFMAKE:TC.apiLocation+"lib/pdfmake/pdfmake-fonts.min.js",JSONPACK:"lib/jsonpack/jsonpack.min.js"};TC.Consts.classes={MAP:"tc-map",POINT:"tc-point",MARKER:"tc-marker",VISIBLE:"tc-visible",HIDDEN:"tc-hidden",COLLAPSED:"tc-collapsed",CHECKED:"tc-checked",DISABLED:"tc-disabled",ACTIVE:"tc-active",LASTCHILD:"tc-lastchild",TRANSPARENT:"tc-transparent",DROP:"tc-drop",LOADING:"tc-loading",IPAD_IOS7_FIX:"tc-ipad-ios7-fix",INFO:"tc-msg-info",WARNING:"tc-msg-warning",ERROR:"tc-msg-error"};TC.Consts.msgType={INFO:"info",WARNING:"warning",ERROR:"error"};TC.Consts.event={MAPLOAD:"mapload.tc",MAPREADY:"mapready.tc",BEFORELAYERADD:"beforelayeradd.tc",LAYERADD:"layeradd.tc",LAYERREMOVE:"layerremove.tc",LAYERORDER:"layerorder.tc",BEFORELAYERUPDATE:"beforelayerupdate.tc",LAYERUPDATE:"layerupdate.tc",LAYERERROR:"layererror.tc",BEFOREBASELAYERCHANGE:"beforebaselayerchange.tc",BASELAYERCHANGE:"baselayerchange.tc",BEFOREUPDATE:"beforeupdate.tc",UPDATE:"update.tc",BEFOREZOOM:"beforezoom.tc",ZOOM:"zoom.tc",BEFOREUPDATEPARAMS:"beforeupdateparams.tc",UPDATEPARAMS:"updateparams.tc",VECTORUPDATE:"vectorupdate.tc",FEATUREADD:"featureadd.tc",BEFOREFEATURESADD:"beforefeaturesadd.tc",FEATURESADD:"featuresadd.tc",FEATUREREMOVE:"featureremove.tc",FEATURESIMPORT:"featuresimport.tc",BEFORETILELOAD:"beforetileload.tc",TILELOAD:"tileload.tc",CONTROLACTIVATE:"controlactivate.tc",CONTROLDEACTIVATE:"controldeactivate.tc",BEFORECONTROLRENDER:"beforecontrolrender.tc",CONTROLRENDER:"controlrender.tc",BEFORELAYOUTLOAD:"beforelayoutload.tc",LAYOUTLOAD:"layoutload.tc",LAYERVISIBILITY:"layervisibility.tc",LAYEROPACITY:"layeropacity.tc",FEATURECLICK:"featureclick.tc",NOFEATURECLICK:"nofeatureclick.tc",BEFOREFEATUREINFO:"beforefeatureinfo.tc",FEATUREINFO:"featureinfo.tc",NOFEATUREINFO:"nofeatureinfo.tc",FEATUREINFOERROR:"featureinfoerror.tc",CLICK:"click.tc",STARTLOADING:"startloading.tc",STOPLOADING:"stoploading.tc",EXTERNALSERVICEADDED:"externalserviceadded.tc"};TC.Consts.layer={IDENA_ORTHOPHOTO:"ortofoto",IDENA_BASEMAP:"mapabase",IDENA_CADASTER:"catastro",IDENA_CARTO:"cartografia",IDENA_ORTHOPHOTO2012:"ortofoto2012",IDENA_DYNBASEMAP:"mapabase_dinamico",IDENA_BW_RELIEF:"relieve_bn",IDENA_BASEMAP_ORTHOPHOTO:"base_orto",BLANK:"ninguno"};TC.Consts.text={API_ERROR:"Error API SITNA",APP_ERROR:"Error de aplicaci\xf3n"};TC.Consts.layerType={WMS:"WMS",WMTS:"WMTS",WFS:"WFS",VECTOR:"vector",KML:"KML",GPX:"GPX",GEOJSON:"GeoJSON",GROUP:"group"};TC.Consts.geom={POINT:"point",MULTIPOINT:"multipoint",POLYLINE:"polyline",POLYGON:"polygon",MULTIPOLYLINE:"multipolyline",MULTIPOLYGON:"multipolygon",CIRCLE:"circle",RECTANGLE:"rectangle"};TC.Consts.searchType={CADASTRAL:"cadastral",COORDINATES:"coordinates",MUNICIPALITY:"municipality",COUNCIL:"council",LOCALITY:"locality",STREET:"street",NUMBER:"number",URBAN:"urban",COMMONWEALTH:"commonwealth"};TC.Consts.mapSearchType={MUNICIPALITY:TC.Consts.searchType.MUNICIPALITY,COUNCIL:TC.Consts.searchType.COUNCIL,URBAN:TC.Consts.searchType.URBAN,COMMONWEALTH:TC.Consts.searchType.COMMONWEALTH,GENERIC:"generic"};TC.Consts.comparison={EQUAL_TO:"=="};TC.Consts.WMTSEncoding={KVP:"KVP",RESTFUL:"RESTful"};TC.Consts.mimeType={PNG:"image/png",JPEG:"image/jpeg",JSON:"application/json",KML:"application/vnd.google-earth.kml+xml",GML:"application/gml+xml",XML:"application/xml"};TC.Consts.format={JSON:"JSON",KML:"KML",GML:"GML",GML2:"GML2",GML3:"GML2",GEOJSON:"GeoJSON",TOPOJSON:"TopoJSON",GPX:"GPX",WKT:"WKT"};TC.Consts.visibility={NOT_VISIBLE:0,NOT_VISIBLE_AT_RESOLUTION:1,HAS_VISIBLE:2,VISIBLE:4};TC.Consts.MARKER="marker";TC.Defaults=function(){var e={},t=function(t){var n=t.features.length,r=e[n];if(!r){r=Math.round(15*Math.sqrt(n));e[n]=r}return r},n={},r=function(e){var t=e.features.length,r=n[t];if(!r){var i=Math.round(100+155*Math.min(6,t)/6);i>255&&(i=255);var a=Math.round(255-155*Math.max(0,t-4)/6);100>a&&(a=100);var s=100;r="#"+i.toString(16)+a.toString(16)+s.toString(16);n[t]=r}return r};return{imageRatio:1.05,proxy:"",crs:"EPSG:25830",utmCrs:"EPSG:25830",geoCrs:"EPSG:4326",initialExtent:[541084.221,4640788.225,685574.4632,4796618.764],maxExtent:[480408,4599748,742552,4861892],baselayerExtent:[480408,4599748,742552,4861892],resolutions:[1024,512,256,128,64,32,16,8,4,2,1,.5,.25],pointBoundsRadius:30,extentMargin:.2,mouseWheelZoom:!0,attribution:'<a href="http://sitna.navarra.es/" target="_blank">SITNA</a>',oldBrowserAlert:!0,notifyApplicationErrors:!1,maxErrorCount:10,locale:"es_ES",screenSize:20,pixelTolerance:10,toastDuration:5e3,avgTileSize:31e3,availableBaseLayers:[{id:TC.Consts.layer.IDENA_BASEMAP,title:"Mapa base",type:TC.Consts.layerType.WMTS,url:"//idena.navarra.es/ogc/wmts/",matrixSet:"epsg25830extended",layerNames:"mapabase",encoding:TC.Consts.WMTSEncoding.RESTFUL,format:"image/png",isDefault:!0,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-basemap.png"},{id:TC.Consts.layer.IDENA_ORTHOPHOTO,title:"Ortofoto 2014",type:TC.Consts.layerType.WMTS,url:"//idena.navarra.es/ogc/wmts/",matrixSet:"epsg25830reduced",layerNames:"ortofoto2014",encoding:TC.Consts.WMTSEncoding.RESTFUL,format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-orthophoto.jpg"},{id:TC.Consts.layer.IDENA_ORTHOPHOTO2012,title:"Ortofoto 2012",type:TC.Consts.layerType.WMTS,url:"//idena.navarra.es/ogc/wmts/",matrixSet:"epsg25830",layerNames:"ortofoto2012",encoding:TC.Consts.WMTSEncoding.RESTFUL,format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-ortho2012.jpg"},{id:TC.Consts.layer.IDENA_CADASTER,title:"Catastro",type:TC.Consts.layerType.WMS,url:"//idena.navarra.es/ogc/wms",layerNames:"catastro,regionesFronterizas",format:"image/png",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-cadaster.png"},{id:TC.Consts.layer.IDENA_CARTO,title:"Cartograf\xeda topogr\xe1fica",type:TC.Consts.layerType.WMS,url:"//idena.navarra.es/ogc/wms",layerNames:"IDENA:cartografia_topografica",format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-carto.png"},{id:TC.Consts.layer.IDENA_BW_RELIEF,title:"Relieve",type:TC.Consts.layerType.WMS,url:"//idena.navarra.es/ogc/wms",layerNames:"IDENA:mapa_relieve_bn",format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-relief_bw.jpg"},{id:TC.Consts.layer.IDENA_BASEMAP_ORTHOPHOTO,title:"Mapa base/ortofoto 2014",type:TC.Consts.layerType.WMS,url:"//idena.navarra.es/ogc/wms",layerNames:"mapaBase_orto",format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-base_ortho.jpg"},{id:TC.Consts.layer.IDENA_DYNBASEMAP,title:"Mapa base",type:TC.Consts.layerType.WMS,url:"//idena.navarra.es/ogc/wms",layerNames:"mapaBase,regionesFronterizas",format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-basemap.png"},{id:TC.Consts.layer.BLANK,title:"Mapa en blanco",type:TC.Consts.layerType.VECTOR}],baseLayers:[TC.Consts.layer.IDENA_BASEMAP,TC.Consts.layer.IDENA_ORTHOPHOTO,TC.Consts.layer.IDENA_CADASTER,TC.Consts.layer.IDENA_CARTO],defaultBaseLayer:TC.Consts.layer.IDENA_BASEMAP,workLayers:[],controls:{loadingIndicator:!0,navBar:!1,scaleBar:!1,scale:!1,scaleSelector:!1,overviewMap:!1,basemapSelector:!1,attribution:!0,TOC:!1,coordinates:!0,legend:!1,popup:!1,search:{url:"//idena.navarra.es/ogc/wfs",allowedSearchTypes:{coordinates:{},municipality:{}}},measure:!1,streetView:!0,featureInfo:!0},layout:null,styles:{point:{fillColor:"#f00",fillOpacity:.5,strokeColor:"#f00",strokeWidth:2,radius:6},marker:{classes:[TC.Consts.classes.MARKER+1,TC.Consts.classes.MARKER+2,TC.Consts.classes.MARKER+3,TC.Consts.classes.MARKER+4,TC.Consts.classes.MARKER+5],anchor:[.5,1],width:32,height:32},line:{strokeColor:"#f00",strokeWidth:2},polygon:{strokeColor:"#f00",strokeWidth:2,fillColor:"#000",fillOpacity:.3},cluster:{point:{cssClass:"",anchor:[.5,.5],fillColor:r,fillOpacity:.6,width:t,height:t,label:"${features.length}",fontColor:"#000",fontSize:12}},selection:{point:{fillColor:"#00f",fillOpacity:.5,strokeColor:"#00f",strokeWidth:2,radius:6},line:{strokeColor:"#00f",strokeWidth:2},polygon:{strokeColor:"#00f",strokeWidth:2,fillColor:"#000",fillOpacity:.3}}}}}();!function(){Array.prototype.map||(Array.prototype.map=function(e){"use strict";if(void 0===this||null===this)throw new TypeError;var t=Object(this),n=t.length>>>0;if("function"!=typeof e)throw new TypeError;for(var r=new Array(n),i=arguments.length>=2?arguments[1]:void 0,a=0;n>a;a++)a in t&&(r[a]=e.call(i,t[a],a,t));return r});TC.proxify=function(e){e=$.trim(e);var t=e;if(TC.Cfg.proxy){var n=!1;if(TC.Cfg.proxyExceptions)for(var r=0;r<TC.Cfg.proxyExceptions.length;r++)if(e.indexOf(TC.Cfg.proxyExceptions[r])>-1){n=!0;break}if(!n&&!TC.Util.isSameOrigin(e))if("function"==typeof TC.Cfg.proxy)t=TC.Cfg.proxy(e);else{t=TC.Cfg.proxy;"http"!=e.substr(0,4)&&(t+=window.location.protocol);t+=encodeURIComponent(e)}}return t};var e=function(){var e,t=document,n=t.getElementsByTagName("head");if(0===n.length){e=t.createElement("head");t.documentElement.insertBefore(e,document.body)}else e=n[0];return e};TC.syncLoadJS=function(t){var n=new XMLHttpRequest;n.open("GET",t,!1);n.send(null);var r=document.createElement("script");r.type="text/javascript";r.text=n.responseText;e().appendChild(r)};window.yepnope||TC.syncLoadJS(TC.apiLocation+TC.Consts.url.MODERNIZR);TC.isLegacy=!0;window.jQuery||TC.syncLoadJS(Modernizr.canvas&&!TC.isLegacy?TC.Consts.url.JQUERY:TC.Consts.url.JQUERY_LEGACY);TC.isDebug=!1;$(document).ready(function(){var e,t="Unknown library",n="OpenLayers 2",r="OpenLayers 3";if(TC.Control){e="Compiled";TC.isLegacy?window.OpenLayers&&(t=n):window.ol&&(t=r)}else{e="On demand";t=TC.isLegacy?n:r}TC.version=TC.version+" ("+e+"; "+t+"; @ "+TC.apiLocation+")"});TC.downloadedJSs=[];TC.requestedJSs={};TC.loadJSInOrder=function(e,t,n){TC.loadJS(e,t,n,!0)};TC.loadJS=function(e,t,n,r){arguments.length<4&&(r=!1);var i=$.isArray(t)?t:[t];if(Modernizr.canvas)if(e){for(var a,s=[],o=[],l=0;l<i.length;l++){a=i[l];TC.downloadedJSs[a]||(TC.requestedJSs[a]?o.push(a):s.push(a))}if(0==s.length&&0==o.length)n();else if(s.length>0&&0==o.length){for(var c=asyncJS(),l=0;l<s.length;l++)TC.requestedJSs[s[l]]=c;if(r)for(var l=0;l<s.length;l++)0==l?c.add(s[l]):c.then(s[l]);else c.add(s);c.whenDone(function(){for(var e=0;e<s.length;e++){TC.downloadedJSs.push(s[e]);delete TC.requestedJSs[s[e]]}n()})}else if(0==s.length&&o.length>0)for(var u,h=o.length,p=0,l=0;l<o.length;l++){var u=o[l],c=TC.requestedJSs[u];c.whenDone(function(e,t,r){p++;p>=h&&n()})}else console.error("Mezcla de tareas en proceso y nuevas!!")}else n();else{if(e)for(var l=0;l<i.length;l++)TC.syncLoadJS(i[l]);n&&n()}};var t=function(e){for(var t=!1,n=0;n<document.styleSheets.length;n++){var r=document.styleSheets[n].href;if(r){var i=r.indexOf(e);if(i>=0&&i===r.length-e.length){t=!0;break}}}return t};TC.loadCSS=function(n){if(!t(n)){var r=document.createElement("link");r.rel="stylesheet";r.href=n;e().appendChild(r)}};TC.loadProjDef=function(e,t){var n,r="EPSG:",i="urn:ogc:def:crs:EPSG::",a="http://www.opengis.net/gml/srs/epsg.xml#",s=r+"25830",o=i+"25830",l=a+"25830";if(TC.isLegacy){Proj4js.defs[s]="+proj=utm +zone=30 +ellps=GRS80 +units=m +no_defs";Proj4js.defs[o]=Proj4js.defs[s];Proj4js.defs[l]=Proj4js.defs[s];n=function(e){return Proj4js.defs[e]}}else{proj4.defs(s,"+proj=utm +zone=30 +ellps=GRS80 +units=m +no_defs");proj4.defs(o,proj4.defs(s));proj4.defs(l,proj4.defs(s));n=function(e){return proj4.defs(e)}}window.Proj4js||(window.Proj4js={Proj:function(e){return proj4(Proj4js.defs[e])},defs:proj4.defs,transform:proj4});var c=function(e){s=r+e;o=i+e;

l=a+e;Proj4js.defs[o]=Proj4js.defs[s];Proj4js.defs[l]=Proj4js.defs[s];if(!TC.isLegacy){proj4.defs(s,Proj4js.defs[s]);proj4.defs(o,Proj4js.defs[s]);proj4.defs(l,Proj4js.defs[s])}};if(n(e)){if($.isFunction(t)){c(h);t()}}else{var u=e.lastIndexOf("#");0>u&&(u=e.lastIndexOf(":"));var h=e.substr(u+1),p=TC.proxify(TC.Consts.url.SPATIALREFERENCE+"ref/epsg/"+h+"/proj4js/");if("boolean"==typeof t)if(t){TC.syncLoadJS(p);c(h)}else TC.loadJS(!0,p);else TC.loadJS(!0,p,function(){c(h);t()})}};TC.url={templating:[TC.apiLocation+TC.Consts.url.TEMPLATING,TC.apiLocation+TC.Consts.url.TEMPLATING_I18N]};if(TC.isLegacy){TC.url.ol=TC.apiLocation+TC.Consts.url.OL_LEGACY;TC.url.olConnector=TC.apiLocation+TC.Consts.url.OL_CONNECTOR_LEGACY;TC.url.proj4js=TC.apiLocation+TC.Consts.url.PROJ4JS_LEGACY}else{TC.url.ol=TC.apiLocation+TC.Consts.url.OL;TC.url.olConnector=TC.apiLocation+TC.Consts.url.OL_CONNECTOR;TC.url.proj4js=TC.apiLocation+TC.Consts.url.PROJ4JS}TC.Cfg=$.extend(!0,{},TC.Defaults,TC.Cfg);TC.capabilities={};TC.WFScapabilities={};TC.cache={};TC.inherit=function(e,t){function n(){}n.prototype=t.prototype;e._super=t.prototype;e.prototype=new n;e.prototype.constructor=e};TC.alert=function(e){alert(e)};TC.prompt=function(e,t,n){var r=prompt(e,t);$.isFunction(n)&&n(r)};TC.confirm=function(e,t,n){confirm(e)?$.isFunction(t)&&t():$.isFunction(n)&&n()};TC.error=function(e){window.console&&console.error(e)};TC.Object=function(){var e=this;e.$events=$(e)};TC.Object.prototype.on=function(e,t){var n=this;n.$events.on(e,t);return n};TC.Object.prototype.one=function(e,t){var n=this;n.$events.one(e,t);return n};TC.Object.prototype.off=function(e,t){var n=this;n.$events.off(e,t);return n};TC.wrap={Map:function(e){var t=this;t.parent=e;t.map=null;t.mapDeferred=new $.Deferred;t.getMap=function(){return t.map||t.mapDeferred.promise()}},Layer:function(e){var t=this;t.parent=e;t.layer=null;t.layerDeferred=new $.Deferred;t.getLayer=function(){return t.layer||t.layerDeferred.promise()};t.setLayer=function(e){t.layer=e;e?t.layerDeferred.resolve(e):t.layerDeferred.reject()}},layer:{Raster:function(){TC.wrap.Layer.apply(this,arguments)},Vector:function(){TC.wrap.Layer.apply(this,arguments)}},Control:function(e){var t=this;t.parent=e},control:{Click:function(){TC.wrap.Control.apply(this,arguments)},ScaleBar:function(){TC.wrap.Control.apply(this,arguments)},NavBar:function(){TC.wrap.Control.apply(this,arguments)},Coordinates:function(){TC.wrap.Control.apply(this,arguments)},Search:function(){TC.wrap.Control.apply(this,arguments)},Measure:function(){TC.wrap.Control.apply(this,arguments)},OverviewMap:function(){TC.wrap.Control.apply(this,arguments)},FeatureInfo:function(){TC.wrap.Control.apply(this,arguments)},Popup:function(){TC.wrap.Control.apply(this,arguments)},PolygonFeatureInfo:function(){TC.wrap.Control.apply(this,arguments)},Geolocation:function(){TC.wrap.Control.apply(this,arguments)},Draw:function(){TC.wrap.Control.apply(this,arguments)},CacheBuilder:function(){TC.wrap.Control.apply(this,arguments)},Edit:function(){TC.wrap.Control.apply(this,arguments)}},Feature:function(){}};TC.inherit(TC.wrap.layer.Raster,TC.wrap.Layer);TC.inherit(TC.wrap.layer.Vector,TC.wrap.Layer);TC.inherit(TC.wrap.control.Click,TC.wrap.Control);TC.inherit(TC.wrap.control.ScaleBar,TC.wrap.Control);TC.inherit(TC.wrap.control.NavBar,TC.wrap.Control);TC.inherit(TC.wrap.control.Coordinates,TC.wrap.Control);TC.inherit(TC.wrap.control.Measure,TC.wrap.Control);TC.inherit(TC.wrap.control.OverviewMap,TC.wrap.Control);TC.inherit(TC.wrap.control.Popup,TC.wrap.Control);TC.inherit(TC.wrap.control.FeatureInfo,TC.wrap.control.Click);TC.inherit(TC.wrap.control.PolygonFeatureInfo,TC.wrap.control.Click);TC.inherit(TC.wrap.control.Geolocation,TC.wrap.Control);TC.inherit(TC.wrap.control.Draw,TC.wrap.Control);TC.inherit(TC.wrap.control.CacheBuilder,TC.wrap.Control);TC.inherit(TC.wrap.control.Edit,TC.wrap.Control);TC.loadCSS(TC.apiLocation+"TC/css/tcmap.css");TC.Map||TC.syncLoadJS(TC.apiLocation+"TC/Map.js");TC.Util||TC.syncLoadJS(TC.apiLocation+"TC/Util.js");var n=1;TC.getUID=function(){var e=n.toString();n+=1;return e}}();!function(e,t){function n(e){return e}function r(e){return decodeURIComponent(e.replace(i," "))}var i=/\+/g;e.cookie=function(i,a,s){if(arguments.length>1&&(!/Object/.test(Object.prototype.toString.call(a))||null===a)){s=e.extend({},e.cookie.defaults,s);null===a&&(s.expires=-1);if("number"==typeof s.expires){var o=s.expires,l=s.expires=new Date;l.setDate(l.getDate()+o)}a=String(a);return t.cookie=[encodeURIComponent(i),"=",s.raw?a:encodeURIComponent(a),s.expires?";expires="+s.expires.toUTCString():"",s.path?";path="+s.path:"",s.domain?";domain="+s.domain:"",s.secure?";secure":""].join("")}s=a||e.cookie.defaults||{};for(var c,u=s.raw?n:r,h=t.cookie.split("; "),p=0;c=h[p]&&h[p].split("=");p++)if(u(c.shift())===i)return u(c.join("="));return null};e.cookie.defaults={}}(jQuery,document)}$(function(){var e=function(){var e,t,n,r=(navigator.appVersion,navigator.userAgent),i=navigator.appName,a=""+parseFloat(navigator.appVersion),s=parseInt(navigator.appVersion,10);if(-1!=(t=r.indexOf("Opera"))){i="Opera";a=r.substring(t+6);-1!=(t=r.indexOf("Version"))&&(a=r.substring(t+8))}else if(-1!=(t=r.indexOf("MSIE"))){i="Microsoft Internet Explorer";a=r.substring(t+5)}else if(-1!=(t=r.indexOf("Chrome"))){i="Chrome";a=r.substring(t+7)}else if(-1!=(t=r.indexOf("Safari"))){i="Safari";a=r.substring(t+7);-1!=(t=r.indexOf("Version"))&&(a=r.substring(t+8))}else if(-1!=(t=r.indexOf("Firefox"))){i="Firefox";a=r.substring(t+8)}else if((e=r.lastIndexOf(" ")+1)<(t=r.lastIndexOf("/"))){i=r.substring(e,t);a=r.substring(t+1);i.toLowerCase()==i.toUpperCase()&&(i=navigator.appName)}-1!=(n=a.indexOf(";"))&&(a=a.substring(0,n));-1!=(n=a.indexOf(" "))&&(a=a.substring(0,n));s=parseInt(""+a,10);if(isNaN(s)){a=""+parseFloat(navigator.appVersion);s=parseInt(navigator.appVersion,10)}return{name:i,version:s}};TC.browser=e();if(TC.Cfg.oldBrowserAlert&&!Modernizr.mq("only all")&&!TC.Util.storage.getCookie(TC.Consts.OLD_BROWSER_ALERT)){alert("Con su "+TC.browser.name+" "+TC.browser.version+" la aplicaci\xf3n no funcionar\xe1. Le recomendamos que utilice un navegador m\xe1s actualizado.");TC.Util.storage.setCookie(TC.Consts.OLD_BROWSER_ALERT,1)}/ip(ad|hone|od)/i.test(navigator.userAgent)&&(TC.Consts.event.CLICK="touchstart.tc");window.JL||TC.syncLoadJS(TC.apiLocation+TC.Consts.url.JSNLOG);JL.defaultAjaxUrl=TC.Consts.url.ERROR_LOGGER;window.addEventListener("error",function(){var e=0,t=$("."+TC.Consts.classes.MAP).data("map");return function(n){var r=n.message,i=n.filename,a=n.lineno,s=n.colno,o=n.error,l=i.indexOf(TC.apiLocation)>0;if((TC.Cfg.notifyApplicationErrors||l)&&e<TC.Cfg.maxErrorCount){var c=l?TC.Consts.text.API_ERROR:TC.Consts.text.APP_ERROR;JL("onerrorLogger").fatalException({msg:c,errorMsg:r,url:i,lineNumber:a,column:s,appUrl:location.href,prevState:t.getPreviousMapState(),userAgent:navigator.userAgent},o);e++;if(!TC.isDebug){var u="webmaster@itracasa.es";$.when(TC.i18n.loadResources(!TC.i18n[t.options.locale],TC.apiLocation+"TC/resources/",t.options.locale)).done(function(){TC.error(TC.Util.getLocaleString(t.options.locale,"genericError")+(t.options.contactEmail||u),{type:TC.Consts.msgType.ERROR})})}}return!1}}(),!1)});TC.Layer=function(e){var t=this;t.options=e||{};$.extend(t,t.options);t.id=t.options.id||TC.getUID();t.map=t.options.map;t.type=t.options.type||TC.Consts.layerType.WMS;var n=t.options.isBase?TC.Consts.mimeType.JPEG:TC.Consts.mimeType.PNG;t.options.format=t.options.format||n;void 0===t.options.hideTree&&(t.options.hideTree=!0);void 0===t.options.hideTitle&&(t.options.hideTitle=!1);t._cache={visibilityStates:{}};t.tree=null;t.wrap=null};TC.Layer.state={IDLE:"idle",LOADING:"loading"};TC.Layer.prototype.setVisibility=function(e){this.wrap.setVisibility(e)};TC.Layer.prototype.getVisibility=function(){var e=this,t=!1;e.map&&(e.isBase&&e.map.getBaseLayer()!==e||(t=e.wrap.getVisibility()));return t};TC.Layer.prototype.getOpacity=function(){var e=this,t=!1;e.map&&(e.isBase&&e.map.getBaseLayer()!==e||(t=e.wrap.getLayer().getOpacity()));return t};TC.Layer.prototype.setOpacity=function(e){var t=this;$.when(this.wrap.getLayer()).then(function(n){n.setOpacity(e);t.map&&t.map.$events.trigger($.Event(TC.Consts.event.LAYEROPACITY,{layer:t,opacity:e}))})};TC.Layer.prototype.isCompatible=function(e){return!0};TC.Layer.prototype.isValidFromNames=function(){return!0};TC.Layer.prototype.isRaster=function(){var e=!0,t=this;switch(t.type){case TC.Consts.layerType.VECTOR:case TC.Consts.layerType.KML:case TC.Consts.layerType.WFS:case TC.Consts.layerType.GROUP:e=!1}return e};TC.Layer.prototype.isVisibleByScale=function(e){return!0};TC.Layer.prototype.isVisibleByName=function(e){return!0};TC.Layer.prototype.getTree=function(){var e=this,t={name:e.name,title:e.title};return t};TC.Layer.prototype.findNode=function e(t,n){var r=null;if(n.uid==t)r=n;else for(var i=0;i<n.children.length;i++){var a=e(t,n.children[i]);if(a){r=a;break}}return r};TC.Layer.prototype.setNodeVisibility=function(e,t){this.setVisibility(t)};TC.Layer.prototype.getNodeVisibility=function(e){return TC.Consts.visibility.VISIBLE};TC.Layer.prototype.getResolutions=function(){return this.wrap.getResolutions?this.wrap.getResolutions():[]};TC.control=TC.control||{};TC.Control=function(){var e=this;e.$events=$(e);e.map=null;e.isActive=!1;e.isDisabled=!1;e._firstRender=$.Deferred();var t=arguments.length;e.options=$.extend({},t>1?arguments[1]:arguments[0]);e.div=TC.Util.getDiv(e.options.div?e.options.div:arguments[0]);e._$div=$(e.div);e._$div.addClass(TC.Control.prototype.CLASS).addClass(e.CLASS);e.template=e.options.template||e.template};TC.Control.prototype.on=function(e,t){var n=this;n.$events.on(e,t);return n};TC.Control.prototype.one=function(e,t){var n=this;n.$events.one(e,t);return n};TC.Control.prototype.off=function(e,t){var n=this;n.$events.off(e,t);return n};TC.Control.prototype.CLASS="tc-ctl";TC.Control.prototype.template="";TC.Control.prototype.show=function(){this._$div.show()};TC.Control.prototype.hide=function(){this._$div.hide()};TC.Control.prototype.render=function(e){var t=this;t.renderData(null,e)};TC.Control.prototype.renderData=function(e,t){var n=this;if(n.map){var r=$.Event(TC.Consts.event.BEFORECONTROLRENDER,{dataObject:e});n.$events.trigger(r)}n._$div.toggleClass(TC.Consts.classes.DISABLED,n.isDisabled);TC.loadJSInOrder(!window.dust,TC.url.templating,function(){var r,i=function(e){var t=$.Deferred(),n=[];for(var r in e){var i=e[r];if("string"==typeof i){var a=$.ajax({url:i,type:"get",dataType:"html"});a.templateKey=r;n.push(a)}else $.isFunction(i)&&i()}0==n.length?t.resolve():$.when.apply($,n).then(function(){if(3!=arguments.length||$.isArray(arguments[0]))for(var e=0;e<arguments.length;e++){var n=arguments[e],r=n[0],i=n[2].templateKey,a=dust.compile(r,i);dust.loadSource(a)}else{var r=arguments[0],i=arguments[2].templateKey,a=dust.compile(r,i);dust.loadSource(a)}t.resolve()},function(e,t,n){console.error("Deferred fallido")});return t};if("object"==typeof n.template)r=i(n.template);else{var a={};n.template&&(a[n.CLASS]=n.template);r=i(a)}r.then(function(){dust.cache[n.CLASS]&&dust.render(n.CLASS,e,function(e,t){n._$div.html(t);e&&TC.error(e)});n._firstRender.resolve();n.$events.trigger($.Event(TC.Consts.event.CONTROLRENDER));$.isFunction(t)&&t()})})};TC.Control.prototype.getRenderedHtml=function(e,t,n){var r=this,i=$.Deferred(),a=function(){dust.cache[e]&&dust.render(e,t,function(e,t){if(e){TC.error(e);i.reject()}else{$.isFunction(n)&&n(t);i.resolve(t)}})};TC.loadJSInOrder(!window.dust,TC.url.templating,function(){if(dust.cache[e])a();else{var t=r.template[e];if("string"==typeof t)$.ajax({url:t,type:"get",dataType:"html"}).done(function(){var t=arguments[0],n=dust.compile(t,e);dust.loadSource(n);a()});else if($.isFunction(t)){t();a()}}});return i};TC.Control.prototype.register=function(e){var t=this;t.map=e;t.render();t.options.active&&t.activate()};TC.Control.prototype.activate=function(){var e=this;if(e.map&&e.map.activeControl&&e.map.activeControl!=e){e.map.previousActiveControl=e.map.activeControl;e.map.activeControl.deactivate()}e.isActive=!0;if(e.map){e.map.activeControl=e;e.map.$events.trigger($.Event(TC.Consts.event.CONTROLACTIVATE,{control:e}));e.$events.trigger($.Event(TC.Consts.event.CONTROLACTIVATE,{control:e}))}};TC.Control.prototype.deactivate=function(e){0==arguments.length&&(e=!1);var t=this;t.isActive=!1;if(t.map){t.map.activeControl=null;if(!e){var n=t.map.getDefaultControl();n==t?n=null:t.map.previousActiveControl==t?n=null:n||(n=t.map.previousActiveControl);n&&n.activate()}t.map.$events.trigger($.Event(TC.Consts.event.CONTROLDEACTIVATE,{control:t}));t.$events.trigger($.Event(TC.Consts.event.CONTROLDEACTIVATE,{control:t}))}};TC.Control.prototype.enable=function(){var e=this;e.isDisabled=!1;e._$div&&e._$div.removeClass(TC.Consts.classes.DISABLED)};TC.Control.prototype.disable=function(){var e=this;e.isDisabled=!0;e._$div&&e._$div.addClass(TC.Consts.classes.DISABLED)};TC.Control.prototype.renderPromise=function(){return this._firstRender};TC.Control.prototype.isExclusive=function(){return!1};TC.Control.prototype.getLocaleString=function(e,t){var n=this,r=n.map?n.map.options.locale:TC.Cfg.locale;return TC.Util.getLocaleString(r,e,t)};TC.feature=TC.feature||{};TC.Feature=function(e,t){var n=this;n.wrap=new TC.wrap.Feature;n.wrap.parent=n;if($.isArray(e))n.geometry=e;else if(n.wrap.isNative(e)){n.wrap.feature=e;n.id=n.wrap.getId();n.geometry=n.wrap.getGeometry();n.folders=e._folders;n.data=n.wrap.getData()}var r=n.options=$.extend(!0,{},t);n.id=n.id||r.id||TC.getUID();n.data=r.data||n.data||null;n._visibilityState=TC.Consts.visibility.VISIBLE;n.showsPopup=void 0===r.showsPopup?!0:r.showsPopup;n.layer=r.layer||null;n._selected=!1;r.selected&&n.select()};TC.Feature.prototype.STYLETYPE=TC.Consts.geom.POLYGON;TC.Feature.prototype.getPath=function(){var e=[],t=this;t.folders?e=t.folders:t.options.group&&(e=[t.options.group]);return e};TC.Feature.prototype.setVisibility=function(e){var t=this;if(e&&t._visibilityState===TC.Consts.visibility.NOT_VISIBLE||!e&&t._visibilityState===TC.Consts.visibility.VISIBLE){t._visibilityState=e?TC.Consts.visibility.VISIBLE:TC.Consts.visibility.NOT_VISIBLE;t.layer.wrap.setFeatureVisibility(t,e)}};TC.Feature.prototype.setId=function(e){var t=this;t.id=e;t.wrap.setId(e)};TC.Feature.prototype.getBounds=function(){return this.wrap.getBounds()};TC.Feature.prototype.setStyle=function(e){var t=this;$.extend(!0,t.options,e);this.wrap.setStyle(t.options)};TC.Feature.prototype.getLegend=function(){var e=this;e._legend||(e._legend=e.wrap.getLegend());return e._legend};TC.Feature.prototype.getData=function(){var e=null,t=this;e=t.data?t.data:t.wrap.getData();return e};TC.Feature.prototype.setData=function(e){var t=this;t.data=$.extend(t.data,e);t.wrap.setData(e)};TC.Feature.prototype.getInfo=function(){var e=null,t=this,n=t.getData();if("object"==typeof n){var r=t.wrap.getTemplate();if(r)e=r.replace(/\$\[(\w+)\]/g,function(e,t){return n[t]});else{var i=[];for(var a in n){var s=n[a];if("string"==typeof s||"number"==typeof s){i[i.length]="<tr><th>";i[i.length]=a;i[i.length]="</th><td>";var o=TC.Util.isURL(s);if(o){i[i.length]='<a href="';i[i.length]=s;i[i.length]='" target="_blank">'}i[i.length]=s;o&&(i[i.length]="</a>");i[i.length]="</td></tr>"}}if(i.length>0){i.unshift("<table>");i[i.length]="</table>";e=i.join("")}}}else"string"==typeof n&&(e=n);return e};TC.Feature.prototype.showPopup=function(e){var t=this;if(t.showsPopup&&t.layer&&t.layer.map){var n,r=e||t.popup||t.layer.map.getControlsByClass("TC.control.Popup")[0];if(r){n=$.Deferred();n.resolve(r)}else TC.loadJS(!TC.control||!TC.control.Popup,[TC.apiLocation+"TC/control/Popup.js"],function(){n=t.layer.map.addControl(new TC.control.Popup)});n.then(function(e){e.currentFeature=t;for(var n=t.layer.map.getControlsByClass(TC.control.Popup),r=0,i=n.length;i>r;r++){var a=n[r];a!==e&&a.hide()}t.wrap.showPopup(e);t.layer.map.$events.trigger($.Event(TC.Consts.event.POPUP,{control:e}));e.fitToView(!0)})}};TC.Feature.prototype.select=function(){var e=this;e._selected=!0;e.layer&&e.layer.selectedFeatures.push(e);var t=e.options.selection||{};e.setStyle($.extend({},TC.Cfg.styles.selection[e.STYLETYPE],t[e.STYLETYPE]))};TC.Feature.prototype.unselect=function(){var e=this;e._selected=!1;e.setStyle();if(e.layer){var t=$.inArray(e,e.layer.selectedFeatures);t>=0&&e.layer.selectedFeatures.splice(t,1)}};TC.Feature.prototype.isSelected=function(){return this._selected};TC.feature=TC.feature||{};TC.Feature||TC.syncLoadJS(TC.apiLocation+"TC/Feature.js");TC.feature.Point=function(e,t){var n=this;TC.Feature.apply(n,arguments);var r;if(n.wrap.isNative(e)){e._wrap=n.wrap;n.wrap.feature=e}else{r=n.options=$.extend(!0,n.options,TC.Cfg.styles.point,t);n.wrap.createPoint(e,r)}};TC.inherit(TC.feature.Point,TC.Feature);!function(){var e=TC.feature.Point.prototype;e.STYLETYPE=TC.Consts.geom.POINT;e.getCoords=function(){return this.wrap.getGeometry()};e.setCoords=function(e){return this.wrap.setGeometry(e)};e.getInfo=function(){var e=this,t=TC.Feature.prototype.getInfo.apply(e,arguments);if(!t){t=e.title;e.group&&(t+=" "+e.group)}t||(t=TC.Util.getLocaleString(TC.Cfg.locale,"noData"));return t}}();TC.feature=TC.feature||{};TC.Feature||TC.syncLoadJS(TC.apiLocation+"TC/Feature.js");TC.feature.Circle=function(e,t){var n=this;TC.Feature.apply(n,arguments);var r;if(n.wrap.isNative(e)){e._wrap=n.wrap;n.wrap.feature=e}else{r=n.options=$.extend(!0,n.options,TC.Cfg.styles.polygon,t);n.wrap.createCircle(e,r)}};TC.inherit(TC.feature.Circle,TC.Feature);!function(){var e=TC.feature.Circle.prototype;e.getCoords=function(){return this.wrap.getGeometry()};e.setCoords=function(e){return this.wrap.setGeometry(e)};e.getInfo=function(){var e=this,t=TC.Feature.prototype.getInfo.apply(e,arguments);if(!t){t=e.title;e.group&&(t+=" "+e.group)}t||(t=TC.Util.getLocaleString(TC.Cfg.locale,"noData"));return t}}();TC.feature=TC.feature||{};TC.feature.Point||TC.syncLoadJS(TC.apiLocation+"TC/feature/Point.js");TC.feature.Marker=function(e,t){var n=this;TC.Feature.apply(n,arguments);if(n.wrap.isNative(e)){e._wrap=n.wrap;n.wrap.feature=e}else{var r=n.options=$.extend(!0,n.options,TC.Cfg.styles.marker,t),i=n.layer&&n.layer.map?n.layer.map.options.locale:TC.Cfg.locale;n.title=r.title||TC.i18n[i][TC.Consts.MARKER];n.wrap.createMarker(e,r)}};TC.inherit(TC.feature.Marker,TC.feature.Point);TC.feature.Marker.prototype.STYLETYPE="marker";TC.feature=TC.feature||{};TC.Feature||TC.syncLoadJS(TC.apiLocation+"TC/Feature.js");TC.feature.MultiPolygon=function(e,t){var n=this;TC.Feature.apply(n,arguments);var r;if(n.wrap.isNative(e)){e._wrap=n.wrap;n.wrap.feature=e}else{r=n.options=$.extend(!0,n.options,TC.Cfg.styles.polygon,t);n.wrap.createMultiPolygon(e,r)}};TC.inherit(TC.feature.MultiPolygon,TC.Feature);TC.feature.MultiPolygon.prototype.STYLETYPE=TC.Consts.geom.POLYGON;TC.feature=TC.feature||{};TC.Feature||TC.syncLoadJS(TC.apiLocation+"TC/Feature.js");TC.feature.MultiPolyline=function(e,t){var n=this;TC.Feature.apply(n,arguments);var r;if(n.wrap.isNative(e)){e._wrap=n.wrap;n.wrap.feature=e}else{r=n.options=$.extend(!0,n.options,TC.Cfg.styles.line,t);n.wrap.createMultiPolyline(e,r)}};TC.inherit(TC.feature.MultiPolyline,TC.Feature);TC.feature.MultiPolyline.prototype.STYLETYPE=TC.Consts.geom.POLYLINE;TC.feature=TC.feature||{};TC.Feature||TC.syncLoadJS(TC.apiLocation+"TC/Feature.js");TC.feature.Polygon=function(e,t){var n=this;TC.Feature.apply(n,arguments);var r;if(n.wrap.isNative(e)){e._wrap=n.wrap;n.wrap.feature=e}else{r=n.options=$.extend(!0,n.options,TC.Cfg.styles.polygon,t);n.wrap.createPolygon(e,r)}};TC.inherit(TC.feature.Polygon,TC.Feature);TC.feature.Polygon.prototype.STYLETYPE=TC.Consts.geom.POLYGON;TC.feature=TC.feature||{};TC.Feature||TC.syncLoadJS(TC.apiLocation+"TC/Feature.js");TC.feature.Polyline=function(e,t){var n=this;TC.Feature.apply(n,arguments);var r;if(n.wrap.isNative(e)){e._wrap=n.wrap;n.wrap.feature=e}else{r=n.options=$.extend(!0,n.options,TC.Cfg.styles.line,t);n.wrap.createPolyline(e,r)}};TC.inherit(TC.feature.Polyline,TC.Feature);TC.feature.Polyline.prototype.STYLETYPE=TC.Consts.geom.POLYLINE;TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control.js");TC.control.MapContents=function(){var e=this;TC.Control.apply(e,arguments);e.layerTrees={}};TC.inherit(TC.control.MapContents,TC.Control);!function(){var e=TC.control.MapContents.prototype;e.CLASS="tc-ctl-mc";var t={img:"tcImg"};e.render=function(e){var t=this;t.map&&t.renderData(t.map.getLayerTree(),e)};e.register=function(e){var t=this;TC.Control.prototype.register.call(t,e);t.render(function(){for(var n=0,r=e.layers.length;r>n;n++)t.updateLayerTree(e.layers[n]);e.on(TC.Consts.event.ZOOM,function(){t.updateScale()}).on(TC.Consts.event.UPDATEPARAMS,function(e){var n=e.layer.names,r=function i(e){var t=!1;if(e)if($.inArray(e.name,n)>=0)t=!0;else for(var r=0;r<e.children.length;r++)if(i(e.children[r])){t=!0;break}return t};r(t.layerTrees[e.layer.id])||0===n.length?t.update():t.updateLayerTree(e.layer)}).on(TC.Consts.event.LAYERVISIBILITY,function(e){t.updateLayerVisibility(e.layer)}).on(TC.Consts.event.LAYERADD,function(e){t.updateLayerTree(e.layer)}).on(TC.Consts.event.VECTORUPDATE+" "+TC.Consts.event.FEATUREADD+" "+TC.Consts.event.FEATURESADD,function(e){t._updateLayerTreeTimeout&&clearTimeout(t._updateLayerTreeTimeout);t._updateLayerTreeTimeout=setTimeout(function(){if(t.map.workLayers.indexOf(e.layer)>-1){t.updateLayerTree(e.layer);delete t._updateLayerTreeTimeout}},100)}).on(TC.Consts.event.LAYERREMOVE,function(e){t.removeLayer(e.layer)})})};e.updateScale=function(){};e.updateLayerVisibility=function(e){};e.updateLayerTree=function(e){this.layerTrees[e.id]=e.getTree()};e.removeLayer=function(e){this.update()};var n=function(e){return/[&?]REQUEST=getLegendGraphic/i.test(e)},r=function(e,t){var n="error.tc";TC.Cfg.proxy&&e.off(n).on(n,function(){e.attr("src",TC.proxify(t))});var r=t.indexOf("//");e.attr("src",0>r?t:t.substr(r))};e.styleLegendImage=function(e,i){if(!e.attr("src")){var a=e.data(t.img);if(i&&i.options.method&&"POST"===i.options.method)i.getLegendGraphicImage().done(function(t){r(e,t)}).fail(function(e){TC.error(e)});else{if(n(a)){var s=e.parent(),o=s.css("color"),l=o.indexOf("("),c=o.indexOf(")");if(l>=0&&c>l){color=o.substr(0,c).substr(l+1).split(",");o="0x";for(var u=0;3>u;u++){var h=parseInt(color[u]).toString(16);o+=1===h.length?"0"+h:h}}else o.replace("#","0x");a+="&LEGEND_OPTIONS=fontName:"+s.css("font-family")+";fontSize:"+parseInt(s.css("font-size"))+";fontColor:"+o+";fontAntiAliasing:true";e.data(t.img,a)}r(e,a)}}}}();TC.control=TC.control||{};TC.control.MapContents||TC.syncLoadJS(TC.apiLocation+"TC/control/MapContents.js");TC.control.TOC=function(){var e=this;TC.control.MapContents.apply(e,arguments)};TC.inherit(TC.control.TOC,TC.control.MapContents);!function(){var e=TC.control.TOC.prototype;e.CLASS="tc-ctl-toc";e.template={};if(TC.isDebug){e.template[e.CLASS]=TC.apiLocation+"TC/templates/TOC.html";e.template[e.CLASS+"-branch"]=TC.apiLocation+"TC/templates/TOCBranch.html";e.template[e.CLASS+"-node"]=TC.apiLocation+"TC/templates/TOCNode.html"}else{e.template[e.CLASS]=function(){function t(e,t){return e.w("<h2>").h("i18n",t,{},{$key:"worklayers"}).w('</h2><div class="tc-ctl-toc-tree"><form><div class="tc-ctl-toc-empty">').h("i18n",t,{},{$key:"noData"}).w('</div><ul class="tc-ctl-toc-branch tc-ctl-toc-wl">').s(t.get(["workLayers"],!1),t,{block:n},{}).w("</ul></form></div>")}function n(e,t){return e.p("tc-ctl-toc-wlbranch",t,t.rebase(t.getPath(!0,[])),{})}dust.register(e.CLASS,t);t.__dustBody=!0;n.__dustBody=!0;return t};e.template[e.CLASS+"-branch"]=function(){function t(e,t){return e.w("<li ").x(t.get(["children"],!1),t,{"else":n,block:r},{}).w(' data-tc-layer-name="').f(t.get(["name"],!1),t,"h").w('" data-tc-layer-uid="').f(t.get(["uid"],!1),t,"h").w('"><input type="checkbox" class="tc-ctl-toc-branch-cb" name="toc" value="').f(t.get(["name"],!1),t,"h").w('"').x(t.get(["isVisible"],!1),t,{block:i},{}).w(" /><span>").f(t.get(["title"],!1),t,"h").w('</span><ul class="tc-ctl-toc-branch">').s(t.get(["children"],!1),t,{block:a},{}).w("</ul></li>")}function n(e,t){return e.w('class="tc-ctl-toc-node tc-ctl-toc-leaf"')}function r(e,t){return e.w('class="tc-ctl-toc-node"')}function i(e,t){return e.w(" checked")}function a(e,t){return e.p("tc-ctl-toc-node",t,t.rebase(t.getPath(!0,[])),{})}dust.register(e.CLASS+"-branch",t);t.__dustBody=!0;n.__dustBody=!0;r.__dustBody=!0;i.__dustBody=!0;a.__dustBody=!0;return t};e.template[e.CLASS+"-node"]=function(){function t(e,t){return e.w("<li ").x(t.get(["children"],!1),t,{"else":n,block:r},{}).w(' data-tc-layer-name="').f(t.get(["name"],!1),t,"h").w('" data-tc-layer-uid="').f(t.get(["uid"],!1),t,"h").w('"><input type="checkbox" name="toc" value="').f(t.get(["name"],!1),t,"h").w('"').x(t.get(["isVisible"],!1),t,{block:i},{}).w(" /><span>").f(t.get(["title"],!1),t,"h").w('</span><ul class="tc-ctl-toc-branch">').s(t.get(["children"],!1),t,{block:a},{}).w("</ul></li>")}function n(e,t){return e.w('class="tc-ctl-toc-node tc-ctl-toc-leaf"')}function r(e,t){return e.w('class="tc-ctl-toc-node"')}function i(e,t){return e.w(" checked")}function a(e,t){return e.p("tc-ctl-toc-node",t,t.rebase(t.getPath(!0,[])),{})}dust.register(e.CLASS+"-node",t);t.__dustBody=!0;n.__dustBody=!0;r.__dustBody=!0;i.__dustBody=!0;a.__dustBody=!0;return t}}var t={layer:"tcLayer",layerUid:"tcLayerUid"};e.register=function(e){var n=this;TC.control.MapContents.prototype.register.call(n,e);n.$events.on(TC.Consts.event.CONTROLRENDER,function(){var t=n.options.controls||[];if(t.length>0){var r=t[0],i=$("<div/>");n._$div.append(i);e.addControl(r.name,$.extend({div:i},r.options))}});n._$div.on(TC.Consts.event.CLICK,"input[type=checkbox]",function(e){var r=$(e.target),i=r.closest("ul."+n.CLASS+"-wl").children("li").has(r).data(t.layer),a=r.parents("li").first().data(t.layerUid),s=r.prop("checked");i.setNodeVisibility(a,s);e.stopPropagation()}).on("mouseup.tc","li",function(e){var t=$(e.target);if(!t.hasClass(n.CLASS+"-leaf")){t.toggleClass(TC.Consts.classes.COLLAPSED);t.find("ul").first().toggleClass(TC.Consts.classes.COLLAPSED);e.stopPropagation()}});e.on(TC.Consts.event.EXTERNALSERVICEADDED,function(t){if(t&&t.layer){t.layer.map=e;e.addLayer(t.layer);n.updateLayerTree(t.layer)}})};e.update=function(){var e=this,n=function(e){return e.children("input[type=checkbox]")},r=e._$div.find("ul."+e.CLASS+"-wl").first();r.children("li").each(function(e,r){var i=$(r),a=i.data(t.layer);if(a){var s=a.getVisibility();n(i).prop("checked",s);a.tree=null;i.find("li").each(function(e,r){var i=$(r),s=n(i),o=i.data(t.layerUid);switch(a.getNodeVisibility(o)){case TC.Consts.visibility.VISIBLE:s.prop("checked",!0);s.prop("indeterminate",!1);break;case TC.Consts.visibility.NOT_VISIBLE_AT_RESOLUTION:s.prop("checked",!0);s.prop("indeterminate",!1);break;case TC.Consts.visibility.HAS_VISIBLE:s.prop("checked",!1);s.prop("indeterminate",!0);break;default:s.prop("checked",!1);s.prop("indeterminate",!1)}})}});e.updateScale()};e.updateScale=function(){var e=this;e._$div.find("ul."+e.CLASS+"-wl").children("li").each(function(n,r){var i=$(r),a=i.data(t.layer);i.find("li").each(function(n,r){var i=$(r);i.toggleClass(e.CLASS+"-node-notvisible",!a.isVisibleByScale(i.data(t.layerUid)))})})};e.updateLayerTree=function(e){var n=this;if(!e.isBase&&!e.options.stealth){TC.control.MapContents.prototype.updateLayerTree.call(n,e);n._$div.find("."+n.CLASS+"-empty").addClass(TC.Consts.classes.HIDDEN);var r=n.CLASS+"-branch";TC.loadJSInOrder(!window.dust,TC.url.templating,function(){dust.render(r,n.layerTrees[e.id],function(r,i){var a=$(i);Modernizr.canvas||a.find("li:last-child").addClass(TC.Consts.classes.LASTCHILD);var s=a.data(t.layerUid),o=n._$div.find("."+n.CLASS+"-wl"),l=o.find('li[data-tc-layer-uid="'+s+'"]');if(1===l.length){l.html(a.html());l.data(t.layer)||l.data(t.layer,e)}else{a.data(t.layer,e);o.prepend(a)}r&&TC.error(r)});var i="ul."+n.CLASS+"-wl",a="ul."+n.CLASS+"-branch",s="li."+n.CLASS+"-node",o="li."+n.CLASS+"-leaf";n._$div.find(i+" "+a+" "+a+","+i+" "+a+" "+s).not(o).addClass(TC.Consts.classes.COLLAPSED);n.update()})}};e.removeLayer=function(e){if(!e.isBase){var n=this,r=function(){return n._$div.find("."+n.CLASS+"-wl").children("li")},i=r();i.each(function(n,a){var s=$(a);if(s.data(t.layer)===e){s.remove();i=r();return!1}});0===i.length&&n._$div.find("."+n.CLASS+"-empty").removeClass(TC.Consts.classes.HIDDEN)}};e.updateLayerVisibility=function(e){var n=this;n._$div.find("."+n.CLASS+"-wl").children("li").each(function(r,i){var a=$(i);if(a.data(t.layer)===e){var s=!e.getVisibility(),o=a.find("input[type=checkbox]"),l=o.filter("."+n.CLASS+"-branch-cb");l.prop("checked",!s);o.not(l).prop("disabled",s);return!1}})}}();TC.control=TC.control||{};TC.control.TOC||TC.syncLoadJS(TC.apiLocation+"TC/control/TOC.js");TC.control.ListTOC=function(){var e=this;TC.control.TOC.apply(e,arguments);e.layers=[]};TC.inherit(TC.control.ListTOC,TC.control.TOC);!function(){var e=TC.control.ListTOC.prototype;e.CLASS="tc-ctl-ltoc";e.CLICKEVENT="click.tc";TC.Consts.classes.DRAG=TC.Consts.classes.DRAG||"tc-drag";TC.Consts.classes.DRAGEND=TC.Consts.classes.DRAGEND||"tc-dragend";e.template={};if(TC.isDebug){e.template[e.CLASS]=TC.apiLocation+"TC/templates/ListTOC.html";e.template[e.CLASS+"-elm"]=TC.apiLocation+"TC/templates/ListTOCElement.html";e.template[e.CLASS+"-type-sgl"]=TC.apiLocation+"TC/templates/ListTOCTooltipSingle.html";e.template[e.CLASS+"-type-grp"]=TC.apiLocation+"TC/templates/ListTOCTooltipGroup.html";e.template[e.CLASS+"-type-grp-node"]=TC.apiLocation+"TC/templates/ListTOCTooltipGroupNode.html"}else{e.template[e.CLASS]=function(){function t(e,t){return e.w("<h2>").h("i18n",t,{},{$key:"loadedLayers"}).w('<span class="tc-ctl-ltoc-n"></span><button class="tc-ctl-ltoc-del-all tc-hidden" title="').h("i18n",t,{},{$key:"removeAllLayersFromMap"}).w('"></button></h2><div class="tc-ctl-ltoc-empty">').h("i18n",t,{},{$key:"noData"}).w('</div><div class="tc-ctl-ltoc-content"><form><ul>').s(t.get(["workLayers"],!1),t,{block:n},{}).w("</ul></form></div>")}function n(e,t){return e.p("tc-ctl-ltoc-elm",t,t.rebase(t.getPath(!0,[])),{})}dust.register(e.CLASS,t);t.__dustBody=!0;n.__dustBody=!0;return t};e.template[e.CLASS+"-elm"]=function(){function t(e,t){return e.w('<li class="tc-ctl-ltoc-elm"><div class="tc-ctl-ltoc-lyr">').f(t.get(["title"],!1),t,"h").w('</div><div class="tc-ctl-ltoc-type"></div><div class="tc-ctl-ltoc-path">').s(t.get(["path"],!1),t,{block:n},{}).w('</div><div><div class="tc-ctl-ltoc-btn-info" title="').h("i18n",t,{},{$key:"infoFromThisLayer"}).w('"></div><input type="range" value="').f(t.get(["opacity"],!1),t,"h").w('" title="').h("i18n",t,{},{$key:"transparencyOfThisLayer"}).w('" /><input type="checkbox" ').nx(t.get(["hide"],!1),t,{block:i},{}).w(' title="').h("i18n",t,{},{$key:"visibilityOfThisLayer"}).w('" /></div><div class="tc-ctl-ltoc-info tc-hidden">').x(t.get(["abstract"],!1),t,{block:a},{}).x(t.get(["legend"],!1),t,{block:s},{}).x(t.get(["metadata"],!1),t,{block:l},{}).w('</div><div class="tc-ctl-ltoc-dd ').x(t.get(["hide"],!1),t,{block:u},{}).w('" title="').h("i18n",t,{},{$key:"dragToReorder"}).w('"></div><div class="tc-ctl-ltoc-del ').nx(t.get(["hide"],!1),t,{block:h},{}).w('" title="').h("i18n",t,{},{$key:"removeLayerFromMap"}).w('"></div></li>')}function n(e,t){return e.f(t.getPath(!0,[]),t,"h").h("sep",t,{block:r},{})}function r(e,t){return e.w(" &bull; ")}function i(e,t){return e.w('checked="checked"')}function a(e,t){return e.w('<div class="tc-ctl-ltoc-abstract"><h4>').h("i18n",t,{},{$key:"abstract"}).w("</h4><div>").f(t.get(["abstract"],!1),t,"h").w("</div></div>")}function s(e,t){return e.w('<div class="tc-ctl-ltoc-legend" data-tc-layer-name="').f(t.get(["layerNames"],!1),t,"h").w('"><h4>').h("i18n",t,{},{$key:"content"}).w("</h4>").s(t.get(["legend"],!1),t,{block:o},{}).w(" </div>")}function o(e,t){return e.w("<div><p>").f(t.get(["title"],!1),t,"h").w('</p><img data-tc-img="').f(t.get(["src"],!1),t,"h").w('" /></div>');

}function l(e,t){return e.w('<div class="tc-ctl-ltoc-metadata"><h4>').h("i18n",t,{},{$key:"metadata"}).w("</h4><ul>").s(t.get(["metadata"],!1),t,{block:c},{}).w("</ul></div>")}function c(e,t){return e.w('<li><a href="').f(t.get(["url"],!1),t,"h").w('" target="_blank">').f(t.get(["formatDescription"],!1),t,"h").w("</a></li>")}function u(e,t){return e.w("tc-hidden")}function h(e,t){return e.w("tc-hidden")}dust.register(e.CLASS+"-elm",t);t.__dustBody=!0;n.__dustBody=!0;r.__dustBody=!0;i.__dustBody=!0;a.__dustBody=!0;s.__dustBody=!0;o.__dustBody=!0;l.__dustBody=!0;c.__dustBody=!0;u.__dustBody=!0;h.__dustBody=!0;return t};e.template[e.CLASS+"-type-sgl"]=function(){function t(e,t){return e.h("i18n",t,{},{$key:"singleLayer"})}dust.register(e.CLASS+"-type-sgl",t);t.__dustBody=!0;return t};e.template[e.CLASS+"-type-grp"]=function(){function t(e,t){return e.w("<div>").h("i18n",t,{},{$key:"groupLayerThatContains"}).w(":</div><ul>").s(t.get(["Layer"],!1),t,{block:n},{}).w("</ul>")}function n(e,t){return e.p("tc-ctl-ltoc-type-grp-node",t,t.rebase(t.getPath(!0,[])),{})}dust.register(e.CLASS+"-type-grp",t);t.__dustBody=!0;n.__dustBody=!0;return t};e.template[e.CLASS+"-type-grp-node"]=function(){function t(e,t){return e.w('<li class="tc-ctl-ltoc-tip-grp-elm"><span>').f(t.get(["Title"],!1),t,"h").w("</span><ul>").s(t.get(["Layer"],!1),t,{block:n},{}).w("</ul></li>")}function n(e,t){return e.p("tc-ctl-ltoc-type-grp-node",t,t.rebase(t.getPath(!0,[])),{})}dust.register(e.CLASS+"-type-grp-node",t);t.__dustBody=!0;n.__dustBody=!0;return t}}var t={layer:"tcLayer"},n=function(e,n){var r;e._$div.find("li."+e.CLASS+"-elm").each(function(e,i){var a=$(i);if(a.data(t.layer)===n){r=a;return!1}});return r},r=function(e){return $.grep(e.map.workLayers,function(e){return!e.stealth}).length};e.register=function(e){var r=this;TC.control.TOC.prototype.register.call(r,e);e.$events.off(TC.Consts.event.EXTERNALSERVICEADDED);r._$div.off(TC.Consts.event.CLICK,"input[type=checkbox]").on(r.CLICKEVENT,"input[type=checkbox]",function(e){var n=$(e.target),i=n.parents("li."+r.CLASS+"-elm").first(),a=i.data(t.layer),s=n.prop("checked");a.setVisibility(s);e.stopPropagation()}).on("change input","input[type=range]",function(e){var n=$(e.target),r=n.parents("li").first().data(t.layer);r.setOpacity(n.val()/100)}).on(r.CLICKEVENT,"."+r.CLASS+"-del",function(n){var r=$(n.target).parents("li").first(),i=r.data(t.layer);e.removeLayer(i)}).on(r.CLICKEVENT,"."+r.CLASS+"-del-all",function(n){TC.confirm(r.getLocaleString("layersRemove.confirm"),function(){var n=r._$div.find("li."+r.CLASS+"-elm"),i=new Array(n.length);n.each(function(e,n){i[e]=$(n).data(t.layer)});for(var a=0,s=i.length;s>a;a++)e.removeLayer(i[a])})}).on(r.CLICKEVENT,"."+r.CLASS+"-btn-info",function(e){var n=$(e.target),i=n.parents("li").first(),a=i.find("."+r.CLASS+"-info");a.find("."+r.CLASS+"-legend img").each(function(e,n){var a=i.data(t.layer);r.styleLegendImage($(n),a)});a.toggleClass(TC.Consts.classes.HIDDEN);i.find('input[type="checkbox"]').is(":checked")&&i.find("."+r.CLASS+"-dd").toggleClass(TC.Consts.classes.HIDDEN,!a.hasClass(TC.Consts.classes.HIDDEN));n.toggleClass(TC.Consts.classes.CHECKED)});e.on(TC.Consts.event.LAYEROPACITY,function(e){var t=n(r,e.layer);t&&t.find("input[type=range]").val(Math.round(100*e.opacity))}).on(TC.Consts.event.LAYERORDER,function(n){if(n.oldIndex>=0&&n.oldIndex!==n.newIndex)for(var i,a,s=r._$div.find("ul").first(),o=s.children("li."+r.CLASS+"-elm"),l=e.workLayers.length-1;l>=0;l--){var c=e.workLayers[l];a=i;o.each(function(e,n){var r=$(n);if(r.data(t.layer)===c){i=r;return!1}});if(c===n.layer){a?a.after(i):s.prepend(i);break}}})};e.updateLayerVisibility=function(e){var t=this,r=n(t,e);if(r){var i=e.getVisibility();r.find("."+t.CLASS+"-del").toggleClass(TC.Consts.classes.HIDDEN,i);r.find("."+t.CLASS+"-info").hasClass(TC.Consts.classes.HIDDEN)&&r.find("."+t.CLASS+"-dd").toggleClass(TC.Consts.classes.HIDDEN,!i)}};e.updateLayerTree=function(e){var n=this,i=function(e,r,i){if(e!==r){for(var a=e.data(t.layer),s=r.data(t.layer),o=-1,l=0;l<n.map.layers.length;l++)if(s===n.map.layers[l]){o=l;break}o>=1&&o<n.map.layers.length&&n.map.insertLayer(a,o,i)}},a=function(e){var t=$.Deferred();e&&e.options.method&&"POST"===e.options.method?e.getLegendGraphicImage().done(function(e){t.resolve(e)}).fail(function(e){TC.error(e)}):t.resolve();return t.promise()};if(!e.isBase&&!e.options.stealth){TC.control.MapContents.prototype.updateLayerTree.call(n,e);for(var s=!1,o=0,l=n.layers.length;l>o;o++)if(e===n.layers[o]){s=!0;break}if(!s){var c=n.CLASS+"-elm";n.layers.push(e);TC.loadJSInOrder(!window.dust,TC.url.templating,function(){TC.loadJS(!$.fn.drag||!$.fn.drop,[TC.apiLocation+"lib/jQuery/jquery.event.drag.js",TC.apiLocation+"lib/jQuery/jquery.event.drop.js"],function(){$.drop({mode:"middle"});var r=e.title?e.title:e.capabilities.Service.Title,s={title:e.options.hideTitle?"":r,hide:e.renderOptions&&e.renderOptions.hide?!0:!1,opacity:e.renderOptions&&e.renderOptions.opacity?100*e.renderOptions.opacity:100},o=e.isRaster();if(o){s.layerNames=e.layerNames;var l=e.getPath();l.shift();s.path=l;var u=e.names[0],h=e.wrap.getInfo(u);s.legend=h.legend;s["abstract"]=h["abstract"];var p,d=h.hasOwnProperty("abstract")||h.hasOwnProperty("legend")||h.hasOwnProperty("metadata");if(e.tree&&e.tree.children&&e.tree.children.length&&e.tree.children[0].children&&e.tree.children[0].children.length)p=null;else{p=h.metadata;if(p)for(var f=0,m=p.length;m>f;f++){var y=p[f];y.formatDescription=n.getLocaleString(TC.Util.getSimpleMimeType(y.format))||n.getLocaleString("viewMetadata")}}s.metadata=p}a(e).done(function(r){r&&(legend.src=r);dust.render(c,s,function(r,a){var s,l=$(a),c=!1;if(o){c=e.names.length>1;if(!c)for(var h=e.wrap.getAllLayerNodes(),p=0;p<h.length;p++){var f=h[p];if(e.wrap.getName(f)===u){s=f;e.wrap.getLayerNodes(f).length>0&&(c=!0);break}}}var m=l.find("."+n.CLASS+"-type"),y=c?n.CLASS+"-type-grp":n.CLASS+"-type-sgl";m.addClass(y);d||l.find("."+n.CLASS+"-btn-info").addClass(TC.Consts.classes.HIDDEN);if(s){e.wrap.normalizeLayerNode(s);dust.render(y,s,function(e,t){var r;m.on("mouseover",function(e){var i=m.offset(),a=$(n.map.div).offset();r=$("<div>").addClass(n.CLASS+"-tip").html(t).css({top:i.top-a.top+"px",right:$(n.map.div).width()-(i.left-a.left)+"px"}).appendTo(n.map.div)}).on("mouseout",function(e){r.remove()})})}var g=n._$div.find("ul").first();l.data(t.layer,e);l.drag("start",function(e,t){var n=$(this);n.css("zIndex",100).addClass(TC.Consts.classes.DRAG);var r=n.position(),i=g.position();t.limit={top:-r.top+i.top,bottom:g.height()+i.top-r.top-n.height()}}).drag("end",function(e,t){var n=$(this);if(t.drop.length){n.addClass(TC.Consts.classes.DRAGEND);for(var r=0;r<t.drop.length;r++)$(t.drop[r]).removeClass(TC.Consts.classes.DROP);var a=$(t.drop[0]),s=n.css("transform");s=parseInt(s.substr(s.lastIndexOf(",")+1));var o=n.position().top-s,l=a.position().top;s=l-o;n.css("transform","translateY("+s+"px)");var c="transitionend.tc";n.on(c,function(e){if("transform"===e.originalEvent.propertyName){n.off(c);i(n,a,function(){n.removeClass(TC.Consts.classes.DRAGEND).removeClass(TC.Consts.classes.DRAG).css("zIndex","").css("transform","")})}})}else n.css({transform:"",zIndex:""}).removeClass(TC.Consts.classes.DRAG)}).drag(function(e,t){$(this).css("transform","translateY("+Math.min(Math.max(t.limit.top,Math.round(t.deltaY)),t.limit.bottom)+"px)")},{handle:"."+n.CLASS+"-dd"}).drop("init",function(e,t){return!(this==t.drag)}).drop("start",function(){$(this).addClass(TC.Consts.classes.DROP)}).drop("end",function(){$(this).removeClass(TC.Consts.classes.DROP)});g.prepend(l);n.updateScale()})})})});var u=r(n);$("."+n.CLASS+"-n").text(u).toggleClass(TC.Consts.classes.VISIBLE,u>0);n._$div.find("."+n.CLASS+"-empty").toggleClass(TC.Consts.classes.HIDDEN,u>0);n._$div.find("."+n.CLASS+"-del-all").toggleClass(TC.Consts.classes.HIDDEN,!1)}}};e.updateScale=function(){var e=this;e._$div.find("ul").find("li."+e.CLASS+"-elm").each(function(n,r){var i=$(r),a=i.data(t.layer);if(a.names){for(var s=!1,o=0;o<a.names.length;o++)if(a.isVisibleByScale(a.names[o])){s=!0;break}i.toggleClass(e.CLASS+"-elm-notvisible",!s)}})};e.removeLayer=function(e){var n=this,i=n.layers.indexOf(e);i>=0&&n.layers.splice(i,1);var a=n._$div.find("ul").first();a.find("li."+n.CLASS+"-elm").each(function(n,r){var i=$(r);if(i.data(t.layer)===e){i.remove();return!1}});var s=r(n);n._$div.find("."+n.CLASS+"-del-all").toggleClass(TC.Consts.classes.HIDDEN,0===s);n._$div.find("."+n.CLASS+"-empty").toggleClass(TC.Consts.classes.HIDDEN,s>0);$("."+n.CLASS+"-n").text(s).toggleClass(TC.Consts.classes.VISIBLE,s>0)}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control.js");TC.control.Click=function(){var e=this;TC.Control.apply(e,arguments);e.callback=e.options&&e.options.callback||function(e,t){console.log("[Click]["+e[0]+", "+e[1]+"]["+t[0]+", "+t[1]+"]")};e.wrap=new TC.wrap.control.Click(e)};TC.inherit(TC.control.Click,TC.Control);!function(){var e=TC.control.Click.prototype;e.CLASS="tc-ctl-click";e.register=function(e){var t=this;t.wrap.register(e);TC.Control.prototype.register.call(t,e)};e.activate=function(){var e=this;TC.Control.prototype.activate.call(e);e.wrap.activate()};e.deactivate=function(){var e=this;e.wrap.deactivate();TC.Control.prototype.deactivate.call(e)}}();TC.control=TC.control||{};TC.control.Click||TC.syncLoadJS(TC.apiLocation+"TC/control/Click.js");TC.control.FeatureInfoCommons=function(){var e=this;TC.control.Click.apply(e,arguments);e._$dialogDiv=$(TC.Util.getDiv(e.options.dialogDiv));e.options.dialogDiv||e._$dialogDiv.appendTo("body")};!function(){var e="ul.tc-ctl-finfo-features li",t=function(e){e.popup.$popupDiv.find("ul."+e.CLASS+"-services li").removeClass(TC.Consts.classes.CHECKED).removeClass(TC.Consts.classes.DISABLED).removeClass(TC.Consts.classes.FROMLEFT).removeClass(TC.Consts.classes.FROMRIGHT)},n=function(n,r){if(!n._zooming){var i,a,s,o;if(this instanceof TC.Feature){i=this;n.popup.$popupDiv.find(e).each(function(e,t){var r=$(t),l=r.parents("li").first(),c=l.parents("li").first(),u=n.getFeature(n.info,c.index(),l.index(),r.index());if(u===i){a=r;s=l;o=c}})}else a=$(this);s=s||a.parents("li").first();o=o||s.parents("li").first();t(n);a.addClass(TC.Consts.classes.CHECKED);s.addClass(TC.Consts.classes.CHECKED);o.addClass(TC.Consts.classes.CHECKED);if(r>0){a.addClass(TC.Consts.classes.FROMLEFT);s.addClass(TC.Consts.classes.FROMLEFT);o.addClass(TC.Consts.classes.FROMLEFT)}else if(0>r){a.addClass(TC.Consts.classes.FROMRIGHT);s.addClass(TC.Consts.classes.FROMRIGHT);o.addClass(TC.Consts.classes.FROMRIGHT)}i=i||n.getFeature(n.info,o.index(),s.index(),a.index());for(var l=n.layer.features.slice(),c=0;c<l.length;c++){var u=l[c];u!==n.marker&&n.layer.removeFeature(u)}i&&i.geometry?n.layer.addFeature(i):a.addClass(TC.Consts.classes.DISABLED)}},r=function(e,t){var n=e.popup.$popupDiv.find("ul."+e.CLASS+"-features > li"),r=n.length,i=n.filter("."+TC.Consts.classes.CHECKED),a=n.index(i.get(0));return n.get((a+t+r)%r)};TC.inherit(TC.control.FeatureInfoCommons,TC.control.Click);var i=TC.control.FeatureInfoCommons.prototype;i.CLASS="tc-ctl-abstract-finfo";i.render=function(e){var t=this;t.getRenderedHtml(t.CLASS+"-dialog",null,function(e){t._$dialogDiv.html(e).on(TC.Consts.event.CLICK,"button[data-format]",function(e){TC.Util.closeModal();var n=t.layer.features[t.layer.features.length-1];t.map.exportFeatures([n],{fileName:n.id,format:$(e.target).data("format")})})})};i.markerStyle={cssClass:TC.Consts.classes.POINT,anchor:[.5,.5],width:15,height:15};i.onShowPopUp=function(i){var a=this,s=a.map;if(i.control===a.popup){var o=a.popup.$popupDiv,l="ficHandlers",c=o.data(l);if(!c){var u,h="click";o.on(h,e,function(e){n.call(this,a)});h="mouseover";var p;o.on(h,e,function(e){var t=this;clearTimeout(p);p=setTimeout(function(){n.call(t,a)},50)});h="mouseout";o.on(h,e,function(e){clearTimeout(p)});h=TC.Consts.event.CLICK;u="."+a.CLASS+"-btn-next";o.on(h,u,function(e){n.call(r(a,1),a,1);return!1});u="."+a.CLASS+"-btn-prev";o.on(h,u,function(e){n.call(r(a,-1),a,-1);return!1});u="ul."+a.CLASS+"-layers h4";o.on(h,u,function(r){var i=$(r.target).parent();if(i.hasClass(TC.Consts.classes.CHECKED))"none"===o.find(".tc-ctl-finfo-btn-next").css("display")&&t(a);else{n.call(i.find(e).first()[0],a);a.popup.fitToView(!0)}});u="."+a.CLASS+"-tools-btn";o.on(h,u,function(e){TC.Util.showModal(a._$dialogDiv.find("."+a.CLASS+"-dialog"),{openCallback:function(){a.onShowModal()}})});o.data(l,!0)}a.info&&(a.info.defaultFeature?n.call(a.info.defaultFeature,a):n.call(o.find(e).first()[0],a));a.fitSize();o.find("table").on("click",function(e){if(!$(this).parent().hasClass(TC.Consts.classes.DISABLED)){if(a.layer.features[1]){var t=function n(){a._zooming=!1;s.off(TC.Consts.event.ZOOM,n)};s.on(TC.Consts.event.ZOOM,t);a.zooming=!0;s.zoomToFeatures([a.layer.features[1]],{animate:!0})}e.stopPropagation()}});o.find("table a").on("click",function(e){e.stopPropagation()})}};i.onShowModal=function(){};i.highlightFeature=function(e){n.call(e,this)};i.fitSize=function(){var e=this,t=e.popup.$popupDiv,n=0;t.find(".tc-ctl-finfo-features li").each(function(e,t){n=Math.max(n,$(t).position().left+$(t).width())});n&&t.width(n+50)};i.countFeatures=function(e){for(var t=0,n=0;n<e.services.length;n++)e.services[n].layers.forEach(function(e){t+=e.features.length});return t};i.getFeature=function(e,t,n,r){var i;if(e){i=e.services[t];if(i){i=i.layers[n];i&&(i=i.features[r])}}return i};i.getFeatureIdx=function(e,t,n,r){var i=-1;if(e)for(var a=0;t>a;a++)for(var s=e.services[a],o=a===t-1?n:s.layers.length,l=0;o>l;l++)for(var c=s.layers[l],u=l===n-1?r:c.features.length,h=0;u>h;h++)i+=1;return i};i.beforeGetFeatureInfo=function(e){var t=this;t.popup&&t.popup.isVisible()&&t.popup.hide();if(e.control===t&&t.map&&t.layer){t.lastFeatureCount=null;var n=t.getLocaleString("featureInfo");t.layer.clearFeatures();t.info=null;$.when(t.layer.addMarker(t.map.getCoordinateFromPixel(e.xy),$.extend({},t.map.options.styles.marker,t.markerStyle,{title:n,set:n}))).then(function(e){if(null===t.lastFeatureCount){t.map.putLayerOnTop(t.layer);t.marker=e}else t.layer.clearFeatures()})}else t.popup&&t.popup.hide()}}();TC.control=TC.control||{};TC.Consts=TC.Consts||{};TC.Consts.SCREEN_SIZE_KEY="TC.Map.screenSize";TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control.js");TC.control.Scale=function(){TC.Control.apply(this,arguments)};TC.inherit(TC.control.Scale,TC.Control);!function(){var e=TC.control.Scale.prototype;e.CLASS="tc-ctl-scl";e.template=TC.isDebug?TC.apiLocation+"TC/templates/Scale.html":function(){function t(e,t){return e.w('<div class="ol-scale-line ol-unselectable"><span>1:').h("math",t,{},{key:n,method:"round"}).w('</span> <input type="button" value="').f(t.get(["screenSize"],!1),t,"h").w("''\" title=\"").h("i18n",t,{},{$key:"estimatedMapSize"}).w('" /></div>')}function n(e,t){return e.f(t.get(["scale"],!1),t,"h")}dust.register(e.CLASS,t);t.__dustBody=!0;n.__dustBody=!0;return t};e.render=function(e){var t=this;$("input[type=button]",t._$div).off();t.renderData({scale:t.getScale(),screenSize:TC.Cfg.screenSize},function(){var n=t._$div.find("span");n.text("1:"+t.format(n.text().substr(2)));t._$div.find('input[type="button"]').on(TC.Consts.event.CLICK,function(){t.setScreenSize.call(t)});$.isFunction(e)&&e()})};e.register=function(e){var t=this;TC.Control.prototype.register.call(t,e);var n=TC.Util.storage.getLocalValue(TC.Consts.SCREEN_SIZE_KEY);n&&(TC.Cfg.screenSize=n);t.render(function(){e.on(TC.Consts.event.ZOOM,function(){delete t.metersPerDegree;t.update()})})};e.update=function(){this.render()};e.setScreenSize=function(){var e=this;TC.prompt(e.getLocaleString("selectScreenSize"),TC.Cfg.screenSize,function(t){if(t){TC.Cfg.screenSize=parseFloat(t);TC.Util.storage.setLocalValue(TC.Consts.SCREEN_SIZE_KEY,TC.Cfg.screenSize);e.update()}})};e.getScale=function(e){var t=this,n=0,r=!e&&t.map?t.map.wrap.getResolution():e;if(r){n=r*t.getDpi(TC.Cfg.screenSize)/.0254;window.devicePixelRatio&&(n*=window.devicePixelRatio)}if(t.map&&t.map.wrap.isGeo()){if(!t.metersPerDegree){var i=t.map.getExtent();i&&(t.metersPerDegree=TC.Util.getMetersPerDegree(i))}t.metersPerDegree&&(n*=t.metersPerDegree)}return n};e.getDpi=function(e){var t=this;t.dpi=Math.sqrt(screen.width*screen.width+screen.height*screen.height)/e;return t.dpi};e.format=function(e){for(var t=new Number(e).toFixed(0),n=[];t.length>3;){var r=t.length-3;n.unshift(t.substr(r));t=t.substr(0,r)}t&&n.unshift(t);return n.join(".")}}();TC.control=TC.control||{};TC.control.MapContents||TC.syncLoadJS(TC.apiLocation+"TC/Control.js");!function(){TC.control.SWCacheClient=function(){var e=this;e.serviceWorkerEnabled=!1;e._serviceWorkerDeferred=$.Deferred()};TC.inherit(TC.control.SWCacheClient,TC.Control);var e=TC.control.SWCacheClient.prototype;e.CLASS="tc-ctl-swcc";e.register=function(e){var t=this;TC.Control.prototype.register.call(t,e);navigator.serviceWorker&&navigator.serviceWorker.register("tc-cb-service-worker.js",{scope:"./"}).then(function(e){t.serviceWorkerEnabled=!0;e.installing?t._serviceWorkerDeferred.resolve(e.installing):e.waiting?t._serviceWorkerDeferred.resolve(e.waiting):e.active&&t._serviceWorkerDeferred.resolve(e.active);console.log(e.scope,"register")},function(e){t.serviceWorkerEnabled=!1;t._serviceWorkerDeferred.reject();console.error("Could not register service worker: "+e)})};e.getServiceWorker=function(){return this._serviceWorkerDeferred.promise()};var t=function(e,t,n,r){var i="message",a=function s(a){if(a.data.name===t){a.data.action===n&&a.data.event===r?e.resolve(t):"error"===a.data.event&&e.reject();navigator.serviceWorker.removeEventListener(i,s)}};navigator.serviceWorker.addEventListener(i,a)};e.createCache=function(e,n){var r=this,i=$.Deferred();r.getServiceWorker().then(function(r){var a="create",s=n||{};t(i,e,a,"cached");r.postMessage({action:a,name:e,list:s.urlList||[],silent:s.silent})},function(){i.resolve(!1)});return i.promise()};e.deleteCache=function(e,n){var r=this,i=$.Deferred();r.getServiceWorker().then(function(r){var a="delete",s=n||{};t(i,e,a,"deleted");r.postMessage({action:a,name:e,silent:s.silent})},function(){i.resolve(!1)});return i.promise()}}();window.OpenLayers||TC.syncLoadJS(TC.url.ol);!function(){OpenLayers._getScriptLocation=function(){var e=OpenLayers._getScriptLocation();e||(e=TC.url.ol.substr(0,TC.url.ol.lastIndexOf("/")+1));return function(){return e}}();OpenLayers.CustomTheme=TC.apiLocation+"OpenLayers/theme/tcsa/style.css";OpenLayers.Util.extend(OpenLayers.Feature.Vector.style["default"],{fillColor:TC.Cfg.styles.polygon.fillColor,fillOpacity:TC.Cfg.styles.polygon.fillOpacity,strokeColor:TC.Cfg.styles.line.strokeColor,strokeWidth:TC.Cfg.styles.line.strokeWidth});OpenLayers.Format.XML.prototype._write=OpenLayers.Format.XML.prototype.write;OpenLayers.Format.XML.prototype.write=function(){var e=OpenLayers.Format.XML.prototype._write.apply(this,arguments);e=e.replace(new RegExp('xmlns:NS\\d+="" NS\\d+:',"g"),"");return e};OpenLayers.Control.PanZoom.prototype.onButtonClick=function(e){var t=e.buttonElement;switch(t.action){case"panup":this.map.pan(0,-this.getSlideFactor("h"));break;case"pandown":this.map.pan(0,this.getSlideFactor("h"));break;case"panleft":this.map.pan(-this.getSlideFactor("w"),0);break;case"panright":this.map.pan(this.getSlideFactor("w"),0);break;case"zoomin":this.map.zoomIn();break;case"zoomout":this.map.zoomOut();break;case"zoomworld":this.map.zoomToExtent(this.map.options.extent)}};OpenLayers.Control.OverviewMap.prototype._updateOverview=OpenLayers.Control.OverviewMap.prototype.updateOverview;OpenLayers.Control.OverviewMap.prototype.updateOverview=function(){var e=this;(e.active||null===e.active)&&e._updateOverview()};OpenLayers.Format.WMSGetFeatureInfo=OpenLayers.Class(OpenLayers.Format.XML,{layerIdentifier:"_layer",featureIdentifier:"_feature",regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},gmlFormat:null,read:function(e){var t;"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));var n=e.documentElement;if(n){var r=this["read_"+n.nodeName];t=r?r.call(this,n):new OpenLayers.Format.GML(this.options?this.options:{}).read(e)}else t=e;return t},read_msGMLOutput:function(e){var t=[],n=this.getSiblingNodesByTagCriteria(e,this.layerIdentifier);if(n)for(var r=0,i=n.length;i>r;++r){var a=n[r],s=a.nodeName;a.prefix&&(s=s.split(":")[1]);var s=s.replace(this.layerIdentifier,""),o=this.getSiblingNodesByTagCriteria(a,this.featureIdentifier);if(o)for(var l=0;l<o.length;l++){var c=o[l],u=this.parseGeometry(c),h=this.parseAttributes(c),p=new OpenLayers.Feature.Vector(u.geometry,h,null);p.bounds=u.bounds;p.type=s;t.push(p)}}return t},read_FeatureInfoResponse:function(e){for(var t=[],n=this.getElementsByTagNameNS(e,"*","FIELDS"),r=0,i=n.length;i>r;r++){var a,s=n[r],o=null,l={},c=s.attributes.length;if(c>0)for(a=0;c>a;a++){var u=s.attributes[a];l[u.nodeName]=u.nodeValue}else{var h=s.childNodes;for(a=0,c=h.length;c>a;++a){var p=h[a];3!=p.nodeType&&(l[p.getAttribute("name")]=p.getAttribute("value"))}}t.push(new OpenLayers.Feature.Vector(o,l,null))}return t},getSiblingNodesByTagCriteria:function(e,t){var n,r,i,a,s,o=[];if(e&&e.hasChildNodes()){n=e.childNodes;i=n.length;for(var l=0;i>l;l++){s=n[l];for(;s&&1!=s.nodeType;){s=s.nextSibling;l++}r=s?s.nodeName:"";if(r.length>0&&r.indexOf(t)>-1)o.push(s);else{a=this.getSiblingNodesByTagCriteria(s,t);a.length>0&&(0==o.length?o=a:o.push(a))}}}return o},parseAttributes:function(e){var t={};if(1==e.nodeType)for(var n=e.childNodes,r=n.length,i=0;r>i;++i){var a=n[i];if(1==a.nodeType){var s=a.childNodes,o=a.prefix?a.nodeName.split(":")[1]:a.nodeName;if(0==s.length)t[o]=null;else if(1==s.length){var l=s[0];if(3==l.nodeType||4==l.nodeType){var c=l.nodeValue.replace(this.regExes.trimSpace,"");t[o]=c}}}}return t},parseGeometry:function(e){this.gmlFormat||(this.gmlFormat=new OpenLayers.Format.GML);var t,n=this.gmlFormat.parseFeature(e),r=null;if(n){t=n.geometry&&n.geometry.clone();r=n.bounds&&n.bounds.clone();n.destroy()}return{geometry:t,bounds:r}},CLASS_NAME:"OpenLayers.Format.WMSGetFeatureInfo"});OpenLayers.Format.GML.prototype._oldParseFeature=OpenLayers.Format.GML.prototype.parseFeature;OpenLayers.Format.GML.prototype.parseFeature=function(e){this.externalProjection=null;for(var t,n,r=["MultiPolygon","Polygon","MultiLineString","LineString","MultiPoint","Point","Envelope"],i=0;i<r.length;++i){t=r[i];n=this.getElementsByTagNameNS(e,this.gmlns,t);if(n.length>0){var a=n[0].getAttribute("srsName");if(a){TC.loadProjDef(a,!0);this.externalProjection=new OpenLayers.Projection("EPSG:"+a.substr(a.lastIndexOf("#")+1))}break}}return this._oldParseFeature(e)};OpenLayers.Control.WMSGetFeatureInfo=OpenLayers.Class(OpenLayers.Control,{hover:!1,drillDown:!1,maxFeatures:10,clickCallback:"click",output:"features",layers:null,queryVisible:!1,url:null,layerUrls:null,infoFormat:"text/html",vendorParams:{},format:null,formatOptions:null,handler:null,hoverRequest:null,initialize:function(e){e=e||{};e.handlerOptions=e.handlerOptions||{};OpenLayers.Control.prototype.initialize.apply(this,[e]);this.format||(this.format=new OpenLayers.Format.WMSGetFeatureInfo(e.formatOptions));this.drillDown===!0&&(this.hover=!1);if(this.hover)this.handler=new OpenLayers.Handler.Hover(this,{move:this.cancelHover,pause:this.getInfoForHover},OpenLayers.Util.extend(this.handlerOptions.hover||{},{delay:250}));else{var t={};t[this.clickCallback]=this.getInfoForClick;this.handler=new OpenLayers.Handler.Click(this,t,this.handlerOptions.click||{})}},getInfoForClick:function(e){this.events.triggerEvent("beforegetfeatureinfo",{xy:e.xy});OpenLayers.Element.addClass(this.map.viewPortDiv,"olCursorWait");this.request(e.xy,{})},getInfoForHover:function(e){this.events.triggerEvent("beforegetfeatureinfo",{xy:e.xy});this.request(e.xy,{hover:!0})},cancelHover:function(){if(this.hoverRequest){this.hoverRequest.abort();this.hoverRequest=null}},findLayers:function(){for(var e,t,n=this.layers||this.map.layers,r=[],i=n.length-1;i>=0;--i){e=n[i];if(e instanceof OpenLayers.Layer.WMS&&(!this.queryVisible||e.getVisibility())){t=OpenLayers.Util.isArray(e.url)?e.url[0]:e.url;this.drillDown!==!1||this.url||(this.url=t);(this.drillDown===!0||this.urlMatches(t))&&r.push(e)}}return r},urlMatches:function(e){var t=OpenLayers.Util.isEquivalentUrl(this.url,e);if(!t&&this.layerUrls)for(var n=0,r=this.layerUrls.length;r>n;++n)if(OpenLayers.Util.isEquivalentUrl(this.layerUrls[n],e)){t=!0;break}return t},buildWMSOptions:function(e,t,n,r){for(var i=[],a=[],s=0,o=t.length;o>s;s++)if(null!=t[s].params.LAYERS){i=i.concat(t[s].params.LAYERS);a=a.concat(this.getStyleNames(t[s]))}var l=t[0],c=this.map.getProjection(),u=l.projection;u&&u.equals(this.map.getProjectionObject())&&(c=u.getCode());var h=OpenLayers.Util.extend({service:"WMS",version:l.params.VERSION,request:"GetFeatureInfo",exceptions:l.params.EXCEPTIONS,bbox:this.map.getExtent().toBBOX(null,l.reverseAxisOrder()),feature_count:this.maxFeatures,height:this.map.getSize().h,width:this.map.getSize().w,format:r,info_format:l.params.INFO_FORMAT||this.infoFormat},parseFloat(l.params.VERSION)>=1.3?{crs:c,i:parseInt(n.x),j:parseInt(n.y)}:{srs:c,x:parseInt(n.x),y:parseInt(n.y)});0!=i.length&&(h=OpenLayers.Util.extend({layers:i,query_layers:i,styles:a},h));OpenLayers.Util.applyDefaults(h,this.vendorParams);return{url:e,params:OpenLayers.Util.upperCaseObject(h),callback:function(t){this.handleResponse(n,t,e)},scope:this}},getStyleNames:function(e){var t;t=e.params.STYLES?e.params.STYLES:OpenLayers.Util.isArray(e.params.LAYERS)?new Array(e.params.LAYERS.length):e.params.LAYERS.replace(/[^,]/g,"");return t},request:function(e,t){var n=this.findLayers();if(0!=n.length){t=t||{};if(this.drillDown===!1){var r=this.buildWMSOptions(this.url,n,e,n[0].params.FORMAT),i=OpenLayers.Request.GET(r);t.hover===!0&&(this.hoverRequest=i)}else{this._requestCount=0;this._numRequests=0;this.features=[];for(var a,s={},o=0,l=n.length;l>o;o++){var c=n[o];a=OpenLayers.Util.isArray(c.url)?c.url[0]:c.url;if(a in s)s[a].push(c);else{this._numRequests++;s[a]=[c]}}var n;for(var a in s){n=s[a];var r=this.buildWMSOptions(a,n,e,n[0].params.FORMAT);OpenLayers.Request.GET(r)}}}else{this.events.triggerEvent("nogetfeatureinfo");OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait")}},triggerGetFeatureInfo:function(e,t,n){this.events.triggerEvent("getfeatureinfo",{text:e.responseText,features:n,request:e,xy:t});OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait")},handleResponse:function(e,t,n){var r=t.responseXML;r&&r.documentElement||(r=t.responseText);var i=this.format.read(r);if(this.drillDown===!1)this.triggerGetFeatureInfo(t,e,i);else{this._requestCount++;this._features=(this._features||[]).concat("object"===this.output?{url:n,features:i}:i);if(this._requestCount===this._numRequests){this.triggerGetFeatureInfo(t,e,this._features.concat());delete this._features;delete this._requestCount;delete this._numRequests}}},CLASS_NAME:"OpenLayers.Control.WMSGetFeatureInfo"});OpenLayers.Format.WMSGetFeatureInfo.prototype._defaultRead_FeatureInfoResponse=OpenLayers.Format.WMSGetFeatureInfo.prototype.read_FeatureInfoResponse;OpenLayers.Format.WMSGetFeatureInfo.prototype["read_esri_wms:FeatureInfoResponse"]=function(e){for(var t=[],n=this.getElementsByTagNameNS(e,"http://www.esri.com/wms","FeatureInfoCollection"),r=0;r<n.length;r++)for(var i=n[r],a=this.getElementsByTagNameNS(i,"http://www.esri.com/wms","FeatureInfo"),s=0;s<a.length;s++){for(var o=a[s],l=null,c=this.getElementsByTagNameNS(o,"http://www.esri.com/wms","FieldName"),u=this.getElementsByTagNameNS(o,"http://www.esri.com/wms","FieldValue"),h={},p=0;p<c.length;p++){var d=c[p],f=u[p],m=void 0===d.textContent?"text":"textContent";h[d[m]]=f[m]}var y=new OpenLayers.Feature.Vector(l,h,null);y.type=i.getAttribute("layername");t.push(y)}return t};OpenLayers.Format.WMSGetFeatureInfo.prototype.read_FeatureInfoResponse=function(e){return"http://www.esri.com/wms"===e.namespaceURI?OpenLayers.Format.WMSGetFeatureInfo.prototype["read_esri_wms:FeatureInfoResponse"].call(this,e):OpenLayers.Format.WMSGetFeatureInfo.prototype._defaultRead_FeatureInfoResponse.call(this,e)};!function(){function e(e){OpenLayers.Request.XMLHttpRequest.onreadystatechange&&OpenLayers.Request.XMLHttpRequest.onreadystatechange.apply(e);e.dispatchEvent({type:"readystatechange",bubbles:!1,cancelable:!1,timeStamp:new Date+0})}function t(e){try{e.responseText=e._object.responseText}catch(t){}try{e.responseXML=fGetDocument(e._object)}catch(t){}try{e.status=e._object.status}catch(t){}try{e.statusText=e._object.statusText}catch(t){}}function n(e){e._object.onreadystatechange=new window.Function}{var r=!!window.controllers,i=window.document.all&&!window.opera;i&&window.navigator.userAgent.match(/MSIE 7.0/)}OpenLayers.Request.XMLHttpRequest.prototype.open=function(a,s,o,l,c){function u(e){var t=0!==e.indexOf("http")&&0!==e.indexOf("//"),n=!t&&e.match(this.URL_SPLIT_REGEX);if(n){var r=window.location;t=n[1]==r.protocol&&n[3]==r.hostname;var i=n[4],a=r.port;(80!=i&&""!=i||"80"!=a&&""!=a)&&(t=t&&i==a)}return t}u(s)||"withCredentials"in this._object||!window.XDomainRequest||(this._object=new window.XDomainRequest);delete this._headers;arguments.length<3&&(o=!0);this._async=o;var h,p=this,d=this.readyState;if(i&&o){h=function(){if(d!=OpenLayers.Request.XMLHttpRequest.DONE){n(p);p.abort()}};window.attachEvent("onunload",h)}OpenLayers.Request.XMLHttpRequest.onopen&&OpenLayers.Request.XMLHttpRequest.onopen.apply(this,arguments);arguments.length>4?this._object.open(a,s,o,l,c):arguments.length>3?this._object.open(a,s,o,l):this._object.open(a,s,o);this.readyState=OpenLayers.Request.XMLHttpRequest.OPENED;e(this);"withCredentials"in this._object||"onreadystatechange"in this._object?this._object.onreadystatechange=function(){if(!r||o){p.readyState=p._object.readyState;t(p);if(p._aborted)p.readyState=OpenLayers.Request.XMLHttpRequest.UNSENT;else{if(p.readyState==OpenLayers.Request.XMLHttpRequest.DONE){delete p._data;n(p);i&&o&&window.detachEvent("onunload",h)}d!=p.readyState&&e(p);d=p.readyState}}}:this._object.onload=function(){if(!r||o){p.readyState=OpenLayers.Request.XMLHttpRequest.DONE;p._object.status=200;p._object.statusText="OK";t(p);delete p._data;i&&o&&window.detachEvent("onunload",h);p.onreadystatechange()}}};OpenLayers.Request.XMLHttpRequest.prototype.setRequestHeader=function(e,t){this._headers||(this._headers={});this._headers[e]=t;return"setRequestHeader"in this._object?this._object.setRequestHeader(e,t):("contentType"in this._object&&"Content-Type"==e,void 0)}}();OpenLayers.Format.KML.prototype._getNodeText=function(e){var t="";void 0!==e.textContent?t=e.textContent:void 0!==e.innerHTML?t=e.innerHTML:void 0!==e.text&&(t=e.text);return t};OpenLayers.Format.KML.prototype._getFolderHierarchy=function(e){var t=[],n=e;if(n.parentNode)do{n=n.parentNode;if("folder"==n.nodeName.toLowerCase()){var r;n.childNodes&&n.childNodes.length&&n.childNodes.length>0&&("name"==n.childNodes[0].nodeName?r=this._getNodeText(n.childNodes[0]):n.childNodes.length>1&&(r=this._getNodeText(n.childNodes[1])));r&&t.push(r)}}while(null!==n.parentNode&&"document"!==n.parentNode.nodeName.toLowerCase());t.reverse();this._folderTree||(this._folderTree={children:[]});TC.Util.addArrayToTree(t,this._folderTree);return t};OpenLayers.Format.KML.prototype.parserTimeout=0;OpenLayers.Format.KML.prototype.parseFeatures=function(e,t){for(var n,r,i=[],a=new Date,s=0,o=e.length;o>s;s++){if(this.parserTimeout>0&&s%10===0&&s>0){n=new Date;r=parseInt(n.getTime()-a.getTime());if(r>this.parserTimeout)throw"El archivo KML es demasiado complejo para este navegador."+r+"ms, "+s+" features"}var l=e[s],c=this.parseFeature.apply(this,[l]);if(!c)throw"Bad Placemark: "+s;this.extractStyles&&c.attributes&&c.attributes.styleUrl&&(c.style=this.getStyle(c.attributes.styleUrl,t));if(this.extractStyles){var u=this.getElementsByTagNameNS(l,"*","Style")[0];if(u){var h=this.parseStyle(u);h&&(c.style=OpenLayers.Util.extend(c.style,h));

}}this.parseFolders&&(c._folders=this._getFolderHierarchy(l));if(this.extractTracks){var p=this.getElementsByTagNameNS(l,this.namespaces.gx,"Track");if(p&&p.length>0){var d=p[0],f={features:[],feature:c};this.readNode(d,f);f.features.length>0&&i.push.apply(i,f.features)}}else i.push(c)}this.features=this.features.concat(i)};OpenLayers.Format.KML.prototype._read=OpenLayers.Format.KML.prototype.read;OpenLayers.Format.KML.prototype.read=function(e){var t=this.getChildEl(e.documentElement,"Document");if(t){var n=this.getChildEl(t,"name");n&&(this._documentName=this._getNodeText(n))}return this._read.call(this,e)};OpenLayers.Popup.Anchored.prototype.calculateRelativePosition=function(){return"tr"};OpenLayers.Control.PanZoomBar.prototype._draw=OpenLayers.Control.PanZoomBar.prototype.draw;OpenLayers.Control.PanZoomBar.prototype.draw=function(e){var t=this,n=OpenLayers.Control.PanZoomBar.prototype._draw.call(t,e);$(t.div).removeAttr("style").addClass("tc-ctl-nav");var r=$(t.buttons[0]),i=r.height();r.removeAttr("style").addClass("tc-ctl-nav-btn tc-ctl-nav-btn-zoomin");var a=(r.height()-i,$(t.zoombarDiv)),i=a.css("height");a.removeAttr("style").addClass("tc-ctl-nav-bar").css("height",i);var s=$(t.slider);i=s.css("height");s.removeAttr("style").addClass("tc-ctl-nav-slider").css("height",i);$(t.buttons[1]).removeAttr("style").addClass("tc-ctl-nav-btn tc-ctl-nav-btn-zoomout");$(t.buttons[2]).removeAttr("style").addClass("tc-ctl-nav-btn tc-ctl-nav-btn-home");return n};TC.wrap.Map.prototype.setMap=function(){var e=this,t=e.parent.options;t.proxy&&(OpenLayers.ProxyHost=t.proxy);e.map=new OpenLayers.Map(e.parent.div,{projection:t.crs,extent:t.initialExtent,maxExtent:t.maxExtent,restrictedExtent:t.maxExtent,controls:[new OpenLayers.Control.Navigation({dragPanOptions:{enableKinetic:!0},pinchZoomOptions:{autoActivate:!0},zoomWheelEnabled:t.mouseWheelZoom})],theme:OpenLayers.CustomTheme});e.map.events.register("zoomstart",e.parent,function(){e.parent.$events.trigger($.Event(TC.Consts.event.BEFOREZOOM))});e.map.events.register("zoomend",e.parent,function(){e.parent.$events.trigger($.Event(TC.Consts.event.ZOOM))});e.map.events.register("featureclick",e.parent,function(t){t.feature&&t.feature._wrap&&e.parent.$events.trigger($.Event(TC.Consts.event.FEATURECLICK,{feature:t.feature._wrap.parent}))});e.map.events.register("nofeatureclick",e.parent,function(t){for(var n=0;n<e.parent.workLayers.length;n++){var r=e.parent.workLayers[n];r.wrap.layer===t.layer&&e.parent.$events.trigger($.Event(TC.Consts.event.NOFEATURECLICK,{layer:r}))}});var n;$(e.parent.div).on("resize",function(){clearTimeout(n);n=setTimeout(function(){e.map.updateSize()},200)});e.mapDeferred.resolve(e.map)};TC.wrap.Map.prototype.insertLayer=function(e,t){for(var n=this,r=!1,i=0;i<n.map.layers.length;i++)if(n.map.layers[i]===e){r=!0;break}r||n.map.addLayer(e);n.map.setLayerIndex(e,t)};TC.wrap.Map.prototype.removeLayer=function(e){this.map.removeLayer(e)};TC.wrap.Map.prototype.getLayerCount=function(){return this.map.getNumLayers()};TC.wrap.Map.prototype.indexOfFirstVector=function(){for(var e=this,t=-1,n=0,r=e.map.layers.length;r>n;n++)if(e.map.layers[n]instanceof OpenLayers.Layer.Vector){t=n;break}return t};TC.wrap.Map.prototype.getLayerIndex=function(e){return this.map.getLayerIndex(e)};TC.wrap.Map.prototype.setLayerIndex=function(e,t){this.map.setLayerIndex(e,t)};TC.wrap.Map.prototype.setBaseLayer=function(e){var t=this,n=new $.Deferred;t.map.addLayer(e);t.map.setBaseLayer(e);t.parent.baseLayer&&t.map.removeLayer(t.parent.baseLayer.wrap.getLayer());n.resolve();return n};TC.wrap.Map.prototype.setExtent=function(e){this.map.updateSize();this.map.zoomToExtent(e)};TC.wrap.Map.prototype.getExtent=function(){var e=null,t=this.map.getExtent();t&&(e=[t.left,t.bottom,t.right,t.top]);return e};TC.wrap.Map.prototype.setCenter=function(e){this.map.panTo(e)};TC.wrap.Map.prototype.getResolution=function(){return this.map.getResolution()};TC.wrap.Map.prototype.setResolution=function(e){$.when(this.getMap()).then(function(t){t.zoomTo(t.getZoomForResolution(e))})};TC.wrap.Map.prototype.getResolutions=function(){var e=[],t=this;if(t.map.resolutions)e=t.map.resolutions;else{t.map.baseLayer&&(e=t.map.baseLayer.resolutions);if(!e)for(var n=0;n<t.map.layers.length&&!e;n++)e=t.map.layers[n].resolutions}return e};TC.wrap.Map.prototype.getCoordinateFromPixel=function(e){var t=this.map.getLonLatFromPixel({x:e[0],y:e[1]});return[t.lon,t.lat]};TC.wrap.Map.prototype.getPixelFromCoordinate=function(e){var t=this.map.getPixelFromLonLat({lon:e[0],lat:e[1]});return[t.x,t.y]};TC.wrap.Map.prototype.getViewport=function(){var e=new $.Deferred;$.when(this.getMap()).then(function(t){e.resolve(t.getViewport())});return e};TC.wrap.Map.prototype.isNative=function(e){return e instanceof OpenLayers.Map};TC.wrap.Map.prototype.isGeo=function(){var e=this,t=e.map.getProjectionObject();null===t&&(t=new OpenLayers.Projection(e.map.projection));var n=t.getUnits();return"degrees"===n||!n};TC.wrap.Map.prototype.addPopup=function(e){e.$popupDiv=$("<div>")};TC.wrap.Map.prototype.hidePopup=function(e){var t=this,n=t.parent;e&&$.when(n.wrap.getMap()).then(function(t){if(e.wrap.popup&&n.popup===e){t.removePopup(e.wrap.popup);e.wrap.popup.destroy();delete e.wrap.popup;n.popup=null}})};TC.wrap.Map.prototype.exportFeatures=function(e,t){TC.error("TC.wrap.Map.prototype.exportFeatures no implementado en OpenLayers 2")};TC.wrap.Map.prototype.enableDragAndDrop=function(e){TC.error("TC.wrap.Map.prototype.enableDragAndDrop no implementado en OpenLayers 2")};TC.wrap.Map.prototype.loadFiles=function(e){TC.error("TC.wrap.Map.prototype.loadFiles no implementado en OpenLayers 2")};TC.wrap.Layer.prototype.getVisibility=function(){var e=this,t=!1;e.layer&&(t=e.layer.getVisibility());return t};TC.wrap.Layer.prototype.setVisibility=function(e){var t=this;$.when(t.getLayer()).then(function(t){t.setVisibility(e)})};TC.wrap.Layer.prototype.isNative=function(e){return e instanceof OpenLayers.Layer};TC.wrap.Layer.prototype.WmsParser=OpenLayers.Format.WMSCapabilities;TC.wrap.Layer.prototype.WmtsParser=OpenLayers.Format.WMTSCapabilities;TC.wrap.Layer.prototype.addCommonEvents=function(e){var t=this;e.events.register("loadstart",t.parent.map,function(){t.parent.state=TC.Layer.state.LOADING;t.parent.map&&t.parent.map.$events.trigger($.Event(TC.Consts.event.BEFORELAYERUPDATE,{layer:t.parent}))});e.events.register("loadend",t.parent.map,function(){t.parent.state=TC.Layer.state.IDLE;t.parent.map&&t.parent.map.$events.trigger($.Event(TC.Consts.event.LAYERUPDATE,{layer:t.parent}))});e.events.register("visibilitychanged",t.parent.map,function(){t.parent.map&&t.parent.map.$events.trigger($.Event(TC.Consts.event.LAYERVISIBILITY,{layer:t.parent}))})};TC.wrap.layer.Raster.prototype.getGetMapUrl=function(){var e=null,t=this;switch(t.getServiceType()){case TC.Consts.layerType.WMS:e=t.parent.capabilities.capability.request.getmap.href;break;case TC.Consts.layerType.WMTS:e=t.parent.capabilities.operationsMetadata.GetTile.dcp.http.get[0].url}return e};TC.wrap.layer.Raster.prototype.getInfoFormats=function(){var e=null,t=this.parent.capabilities;t.capability&&t.capability.request.getfeatureinfo&&(e=t.capability.request.getfeatureinfo.formats);return e};TC.wrap.layer.Raster.infoFormatPreference=["application/vnd.ogc.gml","application/json","application/vnd.esri.wms_featureinfo_xml","application/vnd.esri.wms_raw_xml","application/vnd.ogc.wms_xml","text/xml","text/html","text/plain"];TC.wrap.layer.Raster.prototype.getWMTSLayer=function(){var e=null,t=this,n=t.parent.capabilities;if(n&&n.contents)for(var r=0;r<n.contents.layers.length;r++)for(var i=n.contents.layers[r],a=0;a<i.tileMatrixSetLinks.length;a++)if(t.parent.options.matrixSet===i.tileMatrixSetLinks[a].tileMatrixSet){e=i;break}return e};TC.wrap.layer.Raster.prototype.getTileMatrix=function(e){var t=null,n=this,r=n.parent.capabilities;r&&r.contents&&r.contents.tileMatrixSets[e]&&(t=_layer.capabilities.contents.tileMatrixSets[_layer.options.matrixSet].matrixIds);return t};TC.wrap.layer.Raster.prototype.getScaleDenominators=function(e){var t=[],n=this;e.scaleDenominator?t=[e.scaleDenominator,e.scaleDenominator]:(e.minScale||e.maxScale)&&(t=[e.minScale,e.maxScale]);if(!t.length&&!n.getName(e)){for(var r=n.getLayerNodes(e),i=-(1/0),a=1/0,s=0,o=r.length;o>s;s++){var l=n.getScaleDenominators(r[s]);l[0]>i&&(i=l[0]);l[1]<a&&(a=l[1])}i>-(1/0)&&1/0>a&&(t=[i,a])}return t};TC.wrap.layer.Raster.prototype.getAttribution=function(e){var t=null;e&&(t=e.serviceIdentification?e.serviceIdentification.title:e.service.title);return t};TC.wrap.layer.Raster.prototype.getInfo=function(e){var t={},n=this.parent.capabilities;if(n&&n.capability)for(var r=function(e,t){var n=e.prefix.length&&0!==t.indexOf(e.prefix)?e.prefix+":"+t:t;return e.name===n},i=0;i<n.capability.layers.length;i++){var a=n.capability.layers[i];if(r(a,e)){a.title&&(t.title=a.title);a["abstract"]&&(t["abstract"]=a["abstract"]);a.styles.length&&(t.legend=a.styles[0].legend.href);if(a.metadataURLs.length){t.metadata=[];for(var s=0;s<a.metadataURLs.length;s++){var o=a.metadataURLs[s];t.metadata.push({format:o.format,type:o.type,url:o.href})}}t.queryable=a.queryable;break}}return t};TC.wrap.layer.Raster.prototype.getServiceType=function(){var e=null,t=this.parent.capabilities;t.capability&&t.capability.request&&t.capability.request.getmap?e=TC.Consts.layerType.WMS:t.operationsMetadata&&t.operationsMetadata.GetTile&&(e=TC.Consts.layerType.WMTS);return e};TC.wrap.layer.Raster.prototype.getServiceTitle=function(){var e=null,t=this.parent.capabilities;t.capability&&t.service?e=t.service.title:t.serviceIdentification&&(e=t.serviceIdentification.title);return e};TC.wrap.layer.Raster.prototype.getRootLayerNode=function(){var e,t=this;t.getServiceType()===TC.Consts.layerType.WMS&&(e=t.parent.capabilities.capability.nestedLayers[0]);return e};TC.wrap.layer.Raster.prototype.getName=function(e,t){var n=e.name;if(n&&t){var r=n.indexOf(":");r>=0&&(n=n.substr(r+1))}return n};TC.wrap.layer.Raster.prototype.getIdentifier=function(e){return e.identifier};TC.wrap.layer.Raster.prototype.getLayerNodes=function(e){var t=e.nestedLayers;$.isArray(t)||(t=[]);return t};TC.wrap.layer.Raster.prototype.normalizeLayerNode=function(e){e.Layer=e.nestedLayers;if(e.Layer)for(var t=0;t<e.Layer.length;t++)TC.wrap.layer.Raster.prototype.normalizeLayerNode(e.Layer[t]);e.Title=e.title;e.Abstract=e["abstract"];return e};TC.wrap.layer.Raster.prototype.normalizeCapabilities=function(e){return{Capability:{Exception:cap.capability.exception,Layer:cap.capability.nestedLayers[0]},Service:cap.service,version:cap.version}};TC.wrap.layer.Raster.prototype.getAllLayerNodes=function(){var e=this.parent.capabilities;switch(self.getServiceType()){case TC.Consts.layerType.WMS:return e.capability.layers;case TC.Consts.layerType.WMTS:return e.contents.layers;default:return[]}};TC.wrap.layer.Raster.prototype.getLegend=function(e){var t={},n=e.styles;if(n&&n.length){var r=n[0].legend||{};t.src=r.href}return t};TC.wrap.layer.Raster.prototype.isCompatible=function(e){var t=this,n=!1,r=t.parent;switch(t.getServiceType()){case TC.Consts.layerType.WMS:if(r.capabilities&&r.capabilities.capability&&r.capabilities.capability.layers)if(0===r.names.length)n=!0;else for(var i=r.names.slice(0),a=0;a<r.capabilities.capability.layers.length;a++){var s=r.capabilities.capability.layers[a],o=$.inArray(t.getName(s),i);if(o>=0){i.splice(o,1);n=s.srs[e];if(!n||!i.length)break}}break;case TC.Consts.layerType.WMTS:var l=r.capabilities&&r.capabilities.contents&&r.capabilities.contents.tileMatrixSets[r.options.matrixSet]&&r.capabilities.contents.tileMatrixSets[r.options.matrixSet].supportedCRS,c=new RegExp("^urn:ogc:def:crs:"+e.replace(":",":.*:")+"$","g");n=l&&(c.test(l)||l===e)}return n};TC.wrap.layer.Raster.prototype.getCompatibleLayers=function(e){var t=this,n=[],r=t.parent;switch(t.getServiceType()){case TC.Consts.layerType.WMS:if(r.capabilities&&r.capabilities.capability&&r.capabilities.capability.layers)for(var i=0;i<r.capabilities.capability.layers.length;i++){var a=r.capabilities.capability.layers[i],s=t.getName(a);a.srs[e]&&s&&(n[n.length]=s)}break;case TC.Consts.layerType.WMTS:var o=r.capabilities&&r.capabilities.contents&&r.capabilities.contents.tileMatrixSets;if(o){var l=new RegExp("^urn:ogc:def:crs:"+e.replace(":",":.*:")+"$","g");for(var c in o){var u=o[c].supportedCRS;u&&(l.test(u)||u===e)&&(n[n.length]=c)}}}return n};TC.wrap.layer.Raster.prototype.createWmsLayer=function(e,t,n){var r=this,i=new OpenLayers.Layer.WMS(n&&n.id?n.id:t.LAYERS,e,t,{isBaseLayer:1==(n&&n.isBase),singleTile:!0,transitionEffect:"resize",projection:r.parent.crs,units:"m",ratio:TC.Cfg.imageRatio});i._wrap=r;t.LAYERS.length||i.setVisibility(!1);r.addCommonEvents(i);i._originalGetURL=i.getURL;i._noGetURL=function(){return TC.Consts.BLANK_IMAGE};i.getURL=i.params.LAYERS.length>0?i._originalGetURL:i._noGetURL;return i};TC.wrap.layer.Raster.prototype.createWmtsLayer=function(e,t,n){var r=(new OpenLayers.Format.WMTSCapabilities).createLayer(this.parent.capabilities,{isBaseLayer:1==(n&&n.isBase),name:n&&n.id?n.id:TC.Consts.layerType.WMTS,matrixSet:e,layer:t,requestEncoding:n.encoding===TC.Consts.WMTSEncoding.RESTFUL?"REST":"KVP"});r._wrap=self;this.addCommonEvents(r);return r};TC.wrap.layer.Raster.prototype.getParams=function(){return this.layer.params};TC.wrap.layer.Raster.prototype.setParams=function(e){var t=this;t.layer.getURL=e.LAYERS.length>0?t.layer._originalGetURL:t.layer._noGetURL;t.layer.mergeNewParams(e)};TC.wrap.layer.Raster.prototype.getResolutions=function(){return[]};TC.wrap.layer.Raster.prototype.setWMTSUrl=function(){};TC.wrap.Geometry={getNearest:function(e,t){var n=new OpenLayers.Geometry.LineString($.map(t,function(e){return new OpenLayers.Geometry.Point(e[0],e[1])})),r=n.distanceTo(new OpenLayers.Geometry.Point(e[0],e[1]),{details:!0});return[r.x0,r.y0]}};TC.wrap.layer.Vector.prototype.createVectorLayer=function(){var e=this,t=null,n=$.extend({},TC.Cfg,e.parent.options),r=OpenLayers.Feature.Vector.style["default"],i=function(e,t){var i=OpenLayers.Style.prototype.getSymbolizerPrefix(t.geometry).toLowerCase();return n.styles[i]&&n.styles[i][e]||r[e]},a={strokeColor:"${getStrokeColor}",strokeWidth:"${getStrokeWidth}",strokeOpacity:"${getStrokeOpacity}",fillColor:"${getFillColor}",fillOpacity:"${getFillOpacity}",strokeLinecap:"${getStrokeLinecap}",strokeDashstyle:"${getStrokeDashstyle}"},s={getStrokeColor:function(e){return i("strokeColor",e)},getStrokeWidth:function(e){return i("strokeWidth",e)},getStrokeOpacity:function(e){return i("strokeOpacity",e)},getStrokeLinecap:function(e){return i("strokeLinecap",e)},getStrokeDashstyle:function(e){return i("strokeDashstyle",e)},getFillColor:function(e){return i("fillColor",e)},getFillOpacity:function(e){return i("fillOpacity",e)}},o=function(e){var t=e;if($.isFunction(e)){var n="f"+TC.getUID();s[n]=e;t="${"+n+"}"}return t};if(n.styles.point){a.pointRadius=o(n.styles.point.radius);a.graphic=n.styles.point.graphic;a.label=o(n.styles.point.label);a.fontColor=o(n.styles.point.fontColor);a.fontSize=o(n.styles.point.fontSize);a.fontWeight=o(n.styles.point.fontWeight);a.angle=o(n.styles.point.angle)}var l=new OpenLayers.StyleMap({"default":new OpenLayers.Style($.extend({},r,a),{context:s})}),c={styleMap:l,projection:TC.Cfg.crs};n.isLabeling&&(c.renderers=[OpenLayers.Class(OpenLayers.Renderer.SVG,{drawText:function(e,t,n){var r=!!t.labelOutlineWidth;if(r){var i=OpenLayers.Util.extend({},t);i.fontColor=o(i.labelOutlineColor);i.fontStrokeColor=o(i.labelOutlineColor);i.fontStrokeWidth=o(t.labelOutlineWidth);t.labelOutlineOpacity&&(i.fontOpacity=o(t.labelOutlineOpacity));delete i.labelOutlineWidth;this.drawText(e,i,n)}var a=this.getResolution(),s=(n.x-this.featureDx)/a+this.left,l=n.y/a-this.top,c=r?this.LABEL_OUTLINE_SUFFIX:this.LABEL_ID_SUFFIX,u=this.nodeFactory(e+c,"text");u.setAttributeNS(null,"x",s);u.setAttributeNS(null,"y",-l);if(t.angle||0==t.angle){var h="rotate(-"+t.angle+","+s+","+-l+")";u.setAttributeNS(null,"transform",h)}t.fontColor&&u.setAttributeNS(null,"fill",t.fontColor);t.fontStrokeColor&&u.setAttributeNS(null,"stroke",t.fontStrokeColor);t.fontStrokeWidth&&u.setAttributeNS(null,"stroke-width",t.fontStrokeWidth);t.fontOpacity&&u.setAttributeNS(null,"opacity",t.fontOpacity);t.fontFamily&&u.setAttributeNS(null,"font-family",t.fontFamily);t.fontSize&&u.setAttributeNS(null,"font-size",t.fontSize);t.fontWeight&&u.setAttributeNS(null,"font-weight",t.fontWeight);t.fontStyle&&u.setAttributeNS(null,"font-style",t.fontStyle);if(t.labelSelect===!0){u.setAttributeNS(null,"pointer-events","visible");u._featureId=e}else u.setAttributeNS(null,"pointer-events","none");var p=t.labelAlign||OpenLayers.Renderer.defaultSymbolizer.labelAlign;u.setAttributeNS(null,"text-anchor",OpenLayers.Renderer.SVG.LABEL_ALIGN[p[0]]||"middle");OpenLayers.IS_GECKO===!0&&u.setAttributeNS(null,"dominant-baseline",OpenLayers.Renderer.SVG.LABEL_ALIGN[p[1]]||"central");for(var d=t.label.split("\n"),f=d.length;u.childNodes.length>f;)u.removeChild(u.lastChild);for(var m=0;f>m;m++){var y=this.nodeFactory(e+c+"_tspan_"+m,"tspan");if(t.labelSelect===!0){y._featureId=e;y._geometry=n;y._geometryClass=n.CLASS_NAME}OpenLayers.IS_GECKO===!1&&y.setAttributeNS(null,"baseline-shift",OpenLayers.Renderer.SVG.LABEL_VSHIFT[p[1]]||"-35%");y.setAttribute("x",s);if(0==m){var g=OpenLayers.Renderer.SVG.LABEL_VFACTOR[p[1]];null==g&&(g=-.5);y.setAttribute("dy",g*(f-1)+"em")}else y.setAttribute("dy","1em");y.textContent=""===d[m]?" ":d[m];y.parentNode||u.appendChild(y)}u.parentNode||this.textRoot.appendChild(u)},CLASS_NAME:"OpenLayers.Control.CustomSVG"})]);var u=new OpenLayers.Strategy.Fixed;if(e.parent.type===TC.Consts.layerType.KML){c.strategies=[u];c.protocol=new OpenLayers.Protocol.HTTP({url:TC.proxify(n.url),format:new OpenLayers.Format.KML({extractStyles:!0,extractAttributes:!0,parseFolders:!0,internalProjection:new OpenLayers.Projection(TC.Cfg.crs),externalProjection:new OpenLayers.Projection("EPSG:4326")})})}else if(n.type===TC.Consts.layerType.WFS){var h=function(e){var t,n=[];for(var r in e){var i,a,s,o=e[r];if(o.type){i=o.type;a=o.value;var l=new OpenLayers.Filter.Comparison({type:i,property:r,value:a});if(o.ignoreHyphens){l=[l,new OpenLayers.Filter.Comparison({type:i,property:r,value:a.replace(/-/g,"")})];s=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.OR,filters:l})}else s=l}else{i=OpenLayers.Filter.Comparison.EQUAL_TO;a=o;s=new OpenLayers.Filter.Comparison({type:i,property:r,value:a})}n.push(s)}switch(n.length){case 0:t=null;break;case 1:t=n[0];break;default:t=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:n})}return t},p={};if(n.properties)for(var d=0;d<n.properties.length;d++){var f=n.properties[d];f.name&&f.type?p[f.name]={value:f.value||"",type:f.type,ignoreHyphens:f.ignoreHyphens}:p[f]=""}c.strategies=[u];c.protocol=new OpenLayers.Protocol.WFS({url:n.url,version:n.version,featureType:n.featureType,geometryName:n.geometryName,featurePrefix:n.namespace,outputFormat:n.outputFormat,srsName:TC.Cfg.crs});c.filter=h(p)}if(n.cluster){$.isArray(c.strategies)||(c.strategies=[]);c.strategies.push(new OpenLayers.Strategy.Cluster({distance:n.cluster.distance}))}t=new OpenLayers.Layer.Vector("Vectors",c);t._wrap=e;this.addCommonEvents(t);t.events.register("beforefeaturesadded",null,function(){e.parent.map.$events.trigger($.Event(TC.Consts.event.BEFOREFEATURESADD,{layer:e.parent}))});t.events.register("featuresadded",null,function(t){for(var n=[],r=[],i=[],a=0;a<t.features.length;a++){var s=t.features[a];s._wrap||(s.geometry instanceof OpenLayers.Geometry.Point?n[n.length]=s:s.geometry instanceof OpenLayers.Geometry.LineString||s.geometry instanceof OpenLayers.Geometry.MultiLineString?r[r.length]=s:(s.geometry instanceof OpenLayers.Geometry.Polygon||s.geometry instanceof OpenLayers.Geometry.MultiPolygon)&&(i[i.length]=s))}var o=[];n.length>0&&o.push(e.parent.addMarkers(n));r.length>0&&o.push(e.parent.addPolylines(r));i.length>0&&o.push(e.parent.addPolygons(i));$.when.apply(e,o).then(function(){var t=[];if(arguments.length)for(var n=0;n<arguments[0].length;n++){var r=t[n]=arguments[0][n];$.isArray(r.wrap.feature.cluster)&&(r.features=$.map(r.wrap.feature.cluster,function(e){return new r.constructor(e)}))}e.parent.map.$events.trigger($.Event(TC.Consts.event.FEATURESADD,{layer:e.parent,features:t}))})});t.events.register("featureremoved",null,function(t){var n=t.feature;if(n._wrap){var r=$.inArray(n._wrap.parent,e.parent.features);if(r>-1){e.parent.features.splice(r,1);e.parent.map.$events.trigger($.Event(TC.Consts.event.FEATUREREMOVE,{layer:e.parent,feature:n._wrap.parent}))}}});$(e.parent.map);t.events.register("featuresadded",null,function(){e.parent.map.$events.trigger($.Event(TC.Consts.event.VECTORUPDATE,{layer:e.parent}))});t.events.register("featuresremoved",null,function(){e.parent.map.$events.trigger($.Event(TC.Consts.event.VECTORUPDATE,{layer:e.parent}))});if(e.parent.type===TC.Consts.layerType.KML){t.events.register("added",null,function(){u.activate()});if(!e.parent.options.title){var m=function y(){t.protocol.format._documentName&&(e.parent.title=t.protocol.format._documentName);t.events.unregister("loadend",null,y)};t.events.register("loadend",null,m)}}return t};TC.wrap.layer.Vector.prototype.getGetFeatureUrl=function(){return null};TC.wrap.layer.Vector.prototype["import"]=function(e){TC.error("TC.wrap.layer.Vector.prototype.import no est\xe1 soportada con OpenLayers 2")};TC.wrap.layer.Vector.prototype.addFeatures=function(e){$.when(this.getLayer()).then(function(t){t.addFeatures(e)})};TC.wrap.layer.Vector.prototype.getFeatures=function(){var e=this.getLayer();if(e instanceof OpenLayers.Layer){if(e.strategies)for(var t=0;t<e.strategies.length;t++){var n=e.strategies[t];n instanceof OpenLayers.Strategy.Filter&&n.setFilter(n.filter)}return e.features}return[]};TC.wrap.layer.Vector.prototype.getFeatureById=function(e){var t=this.getLayer();if(t instanceof OpenLayers.Layer){if(t.strategies)for(var n=0;n<t.strategies.length;n++){var r=t.strategies[n];r instanceof OpenLayers.Strategy.Filter&&r.setFilter(r.filter)}return t.getFeatureById(e)}return null};TC.wrap.layer.Vector.prototype.removeFeature=function(e){$.when(this.getLayer()).then(function(t){t.removeFeatures([e.wrap.feature])})};TC.wrap.layer.Vector.prototype.clearFeatures=function(){$.when(this.getLayer()).then(function(e){e.removeAllFeatures()})};TC.wrap.layer.Vector.prototype.setFeatureVisibility=function(e,t){var n=this,r=$.inArray(e,n.parent.features);if(r>=0){t?delete e.wrap.feature.style.display:e.wrap.feature.style.display="none";n._redrawTimeout&&clearTimeout(n._redrawTimeout);n._redrawTimeout=setTimeout(function(){$.when(n.getLayer()).then(function(e){e.redraw();n.parent.map.$events.trigger($.Event(TC.Consts.event.VECTORUPDATE,{layer:n.parent}))});delete n._redrawTimeout},100)}};TC.wrap.layer.Vector.prototype.getRGBA=function(e,t){var n=[0,0,0,1];if("string"==typeof e){var r=4===e.length?1:2;n[0]=parseInt(e.substr(1,r),16);n[1]=parseInt(e.substr(1+r,r),16);n[2]=parseInt(e.substr(1+2*r,r),16);if(1===r){n[0]=17*n[0];n[1]=17*n[1];n[2]=17*n[2]}void 0!==t&&(n[3]=t)}return n};TC.wrap.layer.Vector.prototype.findFeature=function(e){var t=this;$.when(t.getLayer()).then(function(t){var n=t.filter;if(n){if(n.filters&&n.filters.length<=e.length)for(var r=0;r<n.filters.length;r++){var i=n.filters[r];if(i.type===OpenLayers.Filter.Logical.OR){i.filters[0].value=e[r];i.filters[1].value=e[r].replace("-","")}else i.value=e[r]}else n.value=e[0];t.removeAllFeatures();t.setVisibility(!0);t.strategies[0].active||t.strategies[0].activate();t.refresh()}})};TC.wrap.layer.Vector.prototype.sendTransaction=function(e,t,n){var r=$.Deferred();TC.error('"sendTransaction" no est\xe1 soportado por la versi\xf3n OpenLayers 2 de la API SITNA');r.reject();return r};TC.wrap.layer.Vector.prototype.setDraggable=function(e,t,n){var r=this;$.when(r.parent.map.wrap.getMap(),r.getLayer()).then(function(i,a){if(e){if(!r._ctl){var s={};$.isFunction(t)&&(s.onComplete=function(e,n){t.call(this,e._wrap.parent,[n.x,n.y])});$.isFunction(n)&&(s.onStart=function(e,t){n.call(this,e._wrap.parent,[t.x,t.y])});r._ctl=new OpenLayers.Control.DragFeature(a,s);i.addControl(r._ctl)}r._ctl.activate()}else r._ctl&&r._ctl.deactivate()})};TC.wrap.control.Click.prototype.register=function(e){var t=this;t._ctl=new OpenLayers.Control;$.when(e.wrap.getMap()).then(function(n){var r=function(e){var r=n.getLonLatFromPixel(e.xy);t.parent.callback([r.lon,r.lat],[e.xy.x,e.xy.y])};t._ctl.handler=new OpenLayers.Handler.Click(this,{click:r},{single:!0,"double":!1,pixelTolerance:e.options.pixelTolerance,stopSingle:!1,stopDouble:!1});n.addControl(t._ctl)})};TC.wrap.control.Click.prototype.activate=function(){var e=this;e._ctl.activate()};TC.wrap.control.Click.prototype.deactivate=function(){var e=this;e._ctl.deactivate()};TC.wrap.control.ScaleBar.prototype.render=function(){var e=this;e.ctl?e.ctl.draw():e.ctl=new OpenLayers.Control.ScaleLine({div:e.parent.div,bottomInUnits:"",bottomOutUnits:""})};TC.wrap.control.NavBar.prototype.register=function(e){var t=this;$.when(e.wrap.getMap()).then(function(e){t.zsCtl=new OpenLayers.Control.PanZoomBar({panIcons:!1,zoomWorldIcon:!0});e.addControl(t.zsCtl);e.events.register("changebaselayer",null,function(){t.zsCtl.moveZoomBar()})})};TC.wrap.control.NavBar.prototype.refresh=function(){};TC.wrap.control.Coordinates.prototype.register=function(e){var t=this,n=new $.Deferred;$.when(e.wrap.getMap()).then(function(r){var i=r.getProjectionObject();null===i&&(i=new OpenLayers.Projection(r.projection));t.parent.crs=i.getCode();t.parent.units=i.getUnits();t.parent.isGeo=e.wrap.isGeo();var a=function(e){var n=r.getLonLatFromPixel(r.events.getMousePosition(e));if(n){t.parent.isGeo?t.parent.latLon=[n.lat,n.lon]:t.parent.xy=[n.lon,n.lat];t.parent.update.apply(t.parent,arguments)}};r.events.register("mousemove",t.parent,a);r.events.register("mouseover",t.parent,a);r.events.register("mouseout",t.parent,function(){t.parent.clear.apply(t.parent,arguments)});n.resolve()});return n};TC.wrap.Parser=function(){};TC.wrap.Parser.prototype.read=function(e){var t=[],n=this;if(n.parser){TC.Feature||TC.syncLoadJS(TC.apiLocation+"TC/Feature.js");t=$.map(n.parser.read(e),function(e){return new TC.Feature(null,{id:e.fid,data:e.data})})}return t};TC.wrap.parser={WFS:function(e){this.parser=new OpenLayers.Format.GML(e)},JSON:function(e){this.parser=new OpenLayers.Format.GeoJSON(e)}};TC.inherit(TC.wrap.parser.WFS,TC.wrap.Parser);TC.inherit(TC.wrap.parser.JSON,TC.wrap.Parser);TC.wrap.control.Search.prototype.addEvents=function(){var e=this;$.when(e.parent.layer.wrap.getLayer()).then(function(t){var n=e.parent.layer.map,r=n.wrap.isGeo()?n.options.pointBoundsRadius/TC.Util.getMetersPerDegree(n.getExtent()):n.options.pointBoundsRadius;t.events.register("featuresadded",t,function(t){for(var n=t.features[0].geometry.getBounds(),i=1;i<t.features.length;i++)n.extend(t.features[i].geometry.getBounds());if(n.left===n.right){n.left-=r;n.right+=r}if(n.top===n.bottom){n.bottom-=r;n.top+=r}e.parent.layer.map.setExtent(n)})})};TC.wrap.control.OverviewMap.prototype.register=function(e){var t=this,n=function(){var e=new OpenLayers.Size(t.parent._$div.width(),t.parent._$div.height());0===e.w&&(e.w=100);0===e.h&&(e.h=100);return e},r=n();$.when(t.parent.layer.wrap.getLayer()).then(function(i){t.ovMap=new OpenLayers.Control.OverviewMap({div:t.parent.div,size:r,layers:[i],minRatio:24,maxRatio:48,autoPan:!0,theme:OpenLayers.CustomTheme,mapOptions:{projection:e.crs,displayProjection:e.crs,baseLayer:i,maxExtent:e.options.maxExtent,minRatio:24,maxRatio:48,minRectSize:30,theme:OpenLayers.CustomTheme},maximized:!0});var a=$(t.parent.div).find("."+t.parent.CLASS+"-load");i.events.register("loadstart",t.parent.layer,function(){a.removeClass(TC.Consts.classes.HIDDEN).addClass(TC.Consts.classes.VISIBLE)});i.events.register("loadend",t.parent.layer,function(){a.removeClass(TC.Consts.classes.VISIBLE).addClass(TC.Consts.classes.HIDDEN)});$.when(e.wrap.getMap()).then(function(e){e.addControl(t.ovMap);t.parent.isLoaded=!0;t.parent.$events.trigger($.Event(TC.Consts.event.MAPLOAD));e.events.register("updatesize",t.parent,function(){n();if(t.ovMap.ovmap){$ovmap=$(t.ovMap.ovmap.div);$ovmap.css("width",t.parent._$div.css("width")).css("height",t.parent._$div.css("height"));t.ovMap.ovmap.updateSize();t.ovMap.updateRectToMap()}})})})};TC.wrap.control.OverviewMap.prototype.enable=function(){var e=this;e.ovMap.activate();e.ovMap.update()};TC.wrap.control.OverviewMap.prototype.disable=function(){this.ovMap.deactivate()};TC.wrap.control.FeatureInfo.prototype.register=function(e){var t=this;t._map=e;$.when(e.wrap.getMap()).then(function(n){TC.wrap.control.Click.prototype.register.call(t,e);for(var r=[],i=function(e){var t=!1;e instanceof TC.layer.Raster&&!e.isBase&&e.wrap.getInfoFormats()&&(t=!0);return t},a=0;a<e.workLayers.length;a++){var s=e.workLayers[a];i(s)&&r.push(s.wrap.layer)}t._gfi=new OpenLayers.Control.WMSGetFeatureInfo({layers:r,autoActivate:!1,drillDown:!0,maxFeatures:1e3,queryVisible:!0,output:"object",formatOptions:{internalProjection:n.projection}});e.options.pixelTolerance&&(t._gfi.vendorParams={radius:e.options.pixelTolerance,buffer:e.options.pixelTolerance});n.addControl(t._gfi);e.on(TC.Consts.event.LAYERADD,function(e){i(e.layer)&&t._gfi.layers.push(e.layer.wrap.layer)}).on(TC.Consts.event.LAYERREMOVE,function(e){var n=$.inArray(e.layer.wrap.layer,t._gfi.layers);n>=0&&t._gfi.layers.splice(n,1)});var o={};t._gfi.events.register("beforegetfeatureinfo",t.parent,function(n){for(var r=0;r<n.object.layers.length;r++)for(var i=0;i<e.workLayers.length;i++)e.workLayers[i].wrap.layer===n.object.layers[r]&&(o[n.object.layers[r].url]=e.workLayers[i]);e.$events.trigger($.Event(TC.Consts.event.BEFOREFEATUREINFO,{xy:[n.xy.x,n.xy.y],control:t.parent}))});t._gfi.events.register("getfeatureinfo",t.parent,function(n){for(var r,i=0,a=[],s=[],l=[],c=0;c<n.features.length;c++){var u=n.features[c];r={layers:[],text:n.text};var h=o[u.url];if(h){r.mapLayer=h;delete o[u.url]}for(var p=0;p<u.features.length;p++){for(var d=u.features[p],f=d.fid?d.fid.substr(0,d.fid.lastIndexOf(".")):d.type||"",m=r.mapLayer?r.mapLayer.wrap.getInfo(f).title||f:"[Sin t\xedtulo]",y=null,g=0;g<r.layers.length;g++)if(r.layers[g].name===f){y=r.layers[g];break}if(!y){y={name:f,title:m,features:[]};r.layers.push(y)}a.push(TC.wrap.Feature.createFeature(d));s.push(y.features);i+=1}if(!u.features.length){contentType=n.request.getResponseHeader("Content-Type");if(0===contentType.indexOf("text/")){y={name:f,title:m,features:[]};r.layers.push(y);y.features.push({rawUrl:n.request._object.responseURL,rawContent:n.text});i+=1}}l.push(r)}$.when.apply(this,a).then(function(){if(arguments.length)for(var r=0;r<arguments.length;r++){var a=arguments[r];a.attributes=[];for(var o in a.data)a.attributes.push({name:o,value:a.data[o]});s[r].push(a)}e.$events.trigger($.Event(TC.Consts.event.FEATUREINFO,{xy:[n.xy.x,n.xy.y],services:l,featureCount:i,control:t.parent}))})});t._gfi.events.register("exception",t.parent,function(n){e.$events.trigger($.Event(TC.Consts.event.FEATUREINFOERROR,{xy:[n.xy.x,n.xy.y],control:t.parent,layer:n.layer._wrap.parent}))})})};TC.wrap.control.FeatureInfo.prototype.getFeatureInfo=function(e){var t=this;t._map&&t._gfi.layers.length>0&&t._gfi.getInfoForClick({xy:{x:e[0],y:e[1]}})};TC.wrap.control.Popup.prototype=function(){this.popup=null};TC.wrap.control.Popup.prototype.fitToView=function(){var e=this;setTimeout(function(){e.popup.updateSize()},100)};TC.wrap.control.Popup.prototype.setDragged=function(e){};TC.wrap.Feature.prototype.getLegend=function(){var e=this,t={},n=e.feature.style;if(n.externalGraphic){t.src=n.externalGraphic;t.width=n.graphicWidth;t.height=n.graphicHeight}else{n.strokeColor&&(t.strokeColor=n.strokeColor);n.strokeWidth&&(t.strokeWidth=n.strokeWidth);n.fillColor&&(t.fillColor=n.fillColor);n.pointRadius&&(t.height=t.width=2*n.pointRadius)}return t};TC.wrap.Feature.prototype.createPoint=function(e,t){
var n=this;if($.isArray(e)){var r={pointRadius:t.radius||(t.height+t.width)/4};if(t.fillColor){r.fillColor=t.fillColor;r.fillOpacity=t.fillOpacity}else r.fill=!1;if(t.strokeColor){r.strokeColor=t.strokeColor;r.strokeWidth=t.strokeWidth}else r.stroke=!1;n.feature=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(e[0],e[1]),null,r)}else if(n.isNative(e)){n.feature=e;n.parent.geometry=[e.geometry.x,e.geometry.y];if(e.style){n.parent.options.radius=e.style.pointRadius;n.parent.options.fillColor=e.style.fillColor;n.parent.options.fillOpacity=e.style.fillOpacity;n.parent.options.strokeColor=e.style.strokeColor}}t&&t.id&&(n.feature.id=t.id);n.feature._wrap=n};TC.wrap.Feature.prototype.createMarker=function(e,t){var n=this,r=TC.Util.getPointIconUrl(t);if(r){if($.isArray(e)){var i={externalGraphic:TC.Util.getPointIconUrl(t),graphicWidth:t.width,graphicHeight:t.height,graphicXOffset:-Math.round(t.anchor[0]*t.width),graphicYOffset:-Math.round(t.anchor[1]*t.height)};n.feature=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(e[0],e[1]),null,i)}else if(n.isNative(e)){n.feature=e;n.parent.geometry=[e.geometry.x,e.geometry.y];if(e.style){n.parent.options.url=e.style.externalGraphic;n.parent.options.width=e.style.graphicWidth;n.parent.options.height=e.style.graphicHeight;n.parent.options.anchor=[-e.style.graphicXOffset/e.style.graphicWidth,-e.style.graphicYOffset/e.style.graphicHeight]}}t&&t.id&&(n.feature.id=t.id);n.feature._wrap=n}else n.createPoint(e,t)};TC.wrap.Feature.prototype.createPolyline=function(e,t){var n=this;if($.isArray(e)){var r=$.map(e,function(e){return new OpenLayers.Geometry.Point(e[0],e[1])});n.feature=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString(r),null,{stroke:!0,strokeColor:t.strokeColor,strokeWidth:t.strokeWidth})}else if(n.isNative(e)){n.feature=e;for(var i=n.parent.geometry=e.geometry.getVertices(),a=0;a<i.length;a++)i[a]=[i[a].x,i[a].y];if(e.style){n.parent.options.strokeColor=e.style.strokeColor;n.parent.options.strokeWidth=e.style.strokeWidth}}n.feature._wrap=n};TC.wrap.Feature.prototype.createPolygon=function(e,t){var n=this;if($.isArray(e)){var r,i=function(e){return new OpenLayers.Geometry.LinearRing($.map(e,function(e){return new OpenLayers.Geometry.Point(e[0],e[1])}))};if(e.length>0&&$.isArray(e[0])&&e[0].length>0&&$.isArray(e[0][0])){r=new Array(e.length);for(var a=0,s=e.length;s>a;a++)r[a]=i(e[a])}else r=[i(e)];n.feature=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon(r),null,{stroke:!0,strokeColor:t.strokeColor,strokeWidth:t.strokeWidth,fillColor:t.fillColor,fillOpacity:t.fillOpacity})}else if(n.isNative(e)){n.feature=e;if(e.geometry)for(var o=n.parent.geometry=e.geometry.getVertices(),a=0;a<o.length;a++)o[a]=[o[a].x,o[a].y];if(e.style){n.parent.options.strokeColor=e.style.strokeColor;n.parent.options.strokeWidth=e.style.strokeWidth;n.parent.options.fillColor=e.style.fillColor;n.parent.options.fillOpacity=e.style.fillOpacity}}n.feature._wrap=n};TC.wrap.Feature.prototype.createCircle=function(e,t){};TC.wrap.Feature.createFeature=function(e){var t=new $.Deferred,n={id:e.fid,data:e.attributes};e.geometry instanceof OpenLayers.Geometry.Point?TC.loadJS(!TC.feature||TC.feature&&!TC.feature.Point,[TC.apiLocation+"TC/feature/Point.js"],function(){t.resolve(new TC.feature.Point(e,n))}):e.geometry instanceof OpenLayers.Geometry.LineString?TC.loadJS(!TC.feature||TC.feature&&!TC.feature.Polyline,[TC.apiLocation+"TC/feature/Polyline.js"],function(){t.resolve(new TC.feature.Polyline(e,n))}):e.geometry instanceof OpenLayers.Geometry.MultiLineString?TC.loadJS(!TC.feature||TC.feature&&!TC.feature.MultiPolyline,[TC.apiLocation+"TC/feature/MultiPolyline.js"],function(){t.resolve(new TC.feature.MultiPolyline(e,n))}):e.geometry instanceof OpenLayers.Geometry.Polygon?TC.loadJS(!TC.feature||TC.feature&&!TC.feature.Polygon,[TC.apiLocation+"TC/feature/Polygon.js"],function(){t.resolve(new TC.feature.Polygon(e,n))}):e.geometry instanceof OpenLayers.Geometry.MultiPolygon?TC.loadJS(!TC.feature||TC.feature&&!TC.feature.MultiPolygon,[TC.apiLocation+"TC/feature/MultiPolygon.js"],function(){t.resolve(new TC.feature.MultiPolygon(e,n))}):TC.loadJS(!TC.Feature,[TC.apiLocation+"TC/Feature.js"],function(){t.resolve(new TC.Feature(e,n))});return t};TC.wrap.Feature.prototype.getGeometry=function(){var e,t=this;if(t.feature&&t.feature.geometry){var n=function(e){return[e.x,e.y]},r=function(e){for(var t=e.getVertices(),r=0,i=t.length;i>r;r++)t[r]=n(t[r]);return t},i=function(e){for(var t=new Array(e.components.length),n=0,i=e.components.length;i>n;n++)t[n]=r(e.components[n]);return t},a=t.feature.geometry;a instanceof OpenLayers.Geometry.Point?e=n(a):a instanceof OpenLayers.Geometry.LineString?e=r(a):a instanceof OpenLayers.Geometry.MultiLineString?e=r(a.components[0]):a instanceof OpenLayers.Geometry.Polygon?e=i(a):a instanceof OpenLayers.Geometry.MultiPolygon&&(e=i(a.components[0]))}return e};TC.wrap.Feature.prototype.setGeometry=function(e){var t=!1,n=this;if(n.feature&&n.feature.geometry){var r=n.feature.geometry;if(r instanceof OpenLayers.Geometry.Point&&$.isArray(e)&&"number"==typeof e[0]&&"number"==typeof e[1]){r.move(e[0]-r.x,e[1]-r.y);t=!0}}return t};TC.wrap.Feature.prototype.getId=function(){var e,t=this;t.feature&&(e=t.feature.fid);return e};TC.wrap.Feature.prototype.setId=function(e){var t=this;t.feature&&(t.feature.fid=e)};TC.wrap.Feature.prototype.setStyle=function(e){var t=this,n=t.feature.style||new OpenLayers.Style;e instanceof OpenLayers.Style||(e=new OpenLayers.Style(e));var e=e.createLiterals(OpenLayers.Util.extend({},e.defaultStyle),t.feature);if(t.feature.geometry instanceof OpenLayers.Geometry.Point){n.externalGraphic=e.url;n.graphicWidth=e.width;n.graphicHeight=e.height;e.anchor&&e.width&&(n.graphicXOffset=-Math.round(e.anchor[0]*e.width));e.anchor&&e.height&&(n.graphicYOffset=-Math.round(e.anchor[1]*e.height));n.graphic=e.graphic;e.label&&(n.label=e.label.toCamelCase());e.angle&&(n.angle=e.angle);n.fontColor=e.fontColor;n.labelOutlineColor=e.labelOutlineColor;n.labelOutlineWidth=e.labelOutlineWidth}else if(t.feature.geometry.components&&t.feature.geometry.components instanceof Array&&t.feature.geometry.components[0].CLASS_NAME==(new OpenLayers.Geometry.LineString).CLASS_NAME||!t.feature.geometry.components&&t.feature.geometry instanceof new OpenLayers.Geometry.LineString){n.stroke=!0;n.strokeColor=e.strokeColor;n.strokeWidth=e.strokeWidth}else if(t.feature.geometry.components&&t.feature.geometry.components instanceof Array&&t.feature.geometry.components[0].CLASS_NAME==(new OpenLayers.Geometry.Polygon).CLASS_NAME||!t.feature.geometry.components&&t.feature.geometry instanceof new OpenLayers.Geometry.Polygon){n.stroke=!0;n.strokeColor=e.strokeColor;n.strokeWidth=e.strokeWidth;n.fillColor=e.fillColor;n.fillOpacity=e.fillOpacity}t.feature.layer&&t.feature.layer.drawFeature(t.feature,n)};TC.wrap.Feature.prototype.getInnerPoint=function(e){var t=this.feature,n=t.geometry.getCentroid(!0);if(!result.intersects(t.geometry)){var r=t.geometry.distanceTo(result,{details:!0});n=new OpenLayers.Geometry.Point(r.x0,r.y0)}return[n.x,n.y]};TC.wrap.Feature.prototype.showPopup=function(e){{var t=this;t.feature}Modernizr.canvas&&-1===OpenLayers.Popup.Anchored.prototype.displayClass.indexOf(TC.control.Popup.prototype.CLASS)&&(OpenLayers.Popup.Anchored.prototype.displayClass=OpenLayers.Popup.Anchored.prototype.displayClass+" "+TC.control.Popup.prototype.CLASS+" "+TC.Consts.classes.VISIBLE);var n=Modernizr.canvas?OpenLayers.Popup.Anchored:OpenLayers.Popup.FramedCloud;t._innerCentroid||(t._innerCentroid=t.getInnerPoint());e.currentFeature=t.parent;var r=e.map;r&&$.when(r.wrap.getMap()).then(function(i){if(r.popup){i.removePopup(r.popup.wrap.popup);r.popup.wrap.popup.destroy();delete r.popup.wrap.popup;r.popup=null}var a=t.parent.getInfo();if(a){var s=t.parent.options,o=null;Modernizr.canvas&&s.anchor&&s.height&&(o={size:new OpenLayers.Size(0,s.height),offset:new OpenLayers.Pixel(0,-s.height*s.anchor[1])});var l=new n(null,new OpenLayers.LonLat(t._innerCentroid[0],t._innerCentroid[1]),null,a,o,e.options.closeButton,function(t){this.hide();OpenLayers.Event.stop(t);r.$events.trigger($.Event(TC.Consts.event.POPUPHIDE,{control:e}))});l.autoSize=!0;l.panMapIfOutOfView=!0;l.keepInMap=!0;l.maxSize=new OpenLayers.Size(i.size.w/2,i.size.h/2);e.$popupDiv=$(l.div);e.wrap.popup=l;r.popup=e;i.addPopup(l);if(Modernizr.canvas){e.$popupDiv.css("overflow","").css("border","").css("width","").css("height","");var c=$(l.contentDiv).css("position","");l.updateSize();c.css("width","");var u=$(l.groupDiv).find(".olPopupCloseBox").attr("style","").addClass(e.CLASS+"-close").attr("title",e.getLocaleString("close"));u.length&&c.css("margin-right",u.width())}}})};TC.wrap.Feature.prototype.isNative=function(e){return e instanceof OpenLayers.Feature};TC.wrap.Feature.prototype.getPath=function(){var e=[],t=this;t.feature&&t.feature._folders&&(e=t.feature._folders);return e};TC.wrap.Feature.prototype.getBounds=function(){var e=null,t=this;if(t.feature&&t.feature.geometry){var n=t.feature.geometry.getBounds();e=[n.left,n.bottom,n.right,n.top]}return e};TC.wrap.Feature.prototype.getTemplate=function(){var e=null,t=this;if(t.feature.style){e=t.feature.style.balloonStyle;e&&(e=e.replace(/\$\{(\w+)\}/g,"$$[$1]"))}return e};TC.wrap.Feature.prototype.getData=function(){var e=$.extend({},this.feature.attributes);for(var t in e)e[t].value&&(e[t]=e[t].value);return e};TC.wrap.control.Draw.prototype.activate=function(e){var t=this,n=e===TC.Consts.geom.POLYGON?OpenLayers.Handler.Polygon:OpenLayers.Handler.Path;t.parent.map&&$.when(t.parent.map.wrap.getMap()).then(function(r){if(t.control){t.control.deactivate();r.removeControl(t.control)}if(e){var i=function(e){var n="measurepartial"===e.type?TC.Consts.event.MEASUREPARTIAL:TC.Consts.event.MEASURE,r={units:e.units};if(1===e.order)r.length=e.measure;else if(2===e.order){r.area=e.measure;r.perimeter=t.control.getLength(e.geometry,e.units)}t.parent.$events.trigger(t.parent.measure?$.Event(n,r):$.Event(TC.Consts.event.DRAWEND,{geometry:new TC.feature.Polygon(e.geometry.components)}))};t.control=new OpenLayers.Control.Measure(n,{geodesic:!0,persist:!0,immediate:!0});t.control.handler.callbacks.point=function(e){t.parent.$events.trigger($.Event(TC.Consts.event.POINT,{point:[e.x,e.y]}))};t.control.events.on(t.parent.measure?{measure:i,measurepartial:i}:{measure:i});r.addControl(t.control);t.control.activate()}})};TC.wrap.control.Draw.prototype.deactivate=function(){var e=this;e.control&&e.control.deactivate()};TC.wrap.control.Draw.prototype.undo=function(){var e=this,t=!1;e.control&&e.control.handler&&(t=e.control.handler.undo());return t};TC.wrap.control.Draw.prototype.redo=function(){var e=this,t=!1;e.control&&e.control.handler&&(t=e.control.handler.redo());return t};TC.wrap.control.Draw.prototype.end=function(){var e=this;if(e.control&&e.control.handler){e.control.handler.finishGeometry();e.control.handler.layer&&e.control.handler.layer.redraw()}};TC.wrap.control.CacheBuilder.prototype.getRequestSchema=function(e){return{}};TC.wrap.control.CacheBuilder.prototype.getGetTilePattern=function(e){return""}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control.js");TC.control.Attribution=function(){var e=this;TC.Control.apply(e,arguments);e.apiAttribution="";e.mainDataAttribution="";e.dataAttributions=[]};TC.inherit(TC.control.Attribution,TC.Control);!function(){var e=TC.control.Attribution.prototype;e.CLASS="tc-ctl-attrib";e.template=TC.isDebug?TC.apiLocation+"TC/templates/Attribution.html":function(){function t(e,t){return e.w("<div><span>&copy; ").f(t.get(["api"],!1),t,"h",["s"]).w("</span> - ").h("i18n",t,{},{$key:"data"}).w(": <span>").f(t.get(["mainData"],!1),t,"h",["s"]).w("</span>").x(t.get(["otherData"],!1),t,{block:n},{}).w('<div class="tc-ctl-attrib-other tc-collapsed">').s(t.get(["otherData"],!1),t,{block:r},{}).w("</div></div>")}function n(e,t){return e.w(' - <span class="tc-ctl-attrib-cmd">').h("i18n",t,{},{$key:"others"}).w("...</span>")}function r(e,t){return e.w("<span>").f(t.getPath(!1,["otherData",t.get(["$idx"],!1)]),t,"h",["s"]).w("</span>").h("sep",t,{block:i},{})}function i(e,t){return e.w(", ")}dust.register(e.CLASS,t);t.__dustBody=!0;n.__dustBody=!0;r.__dustBody=!0;i.__dustBody=!0;return t};e.register=function(e){var t=this;TC.Control.prototype.register.call(t,e);t.apiAttribution=t.map.options.attribution||t.apiAttribution;var n=function(e){if(e){var n=$("<div/>").html($.trim(e.wrap.getAttribution(TC.capabilities[e.url]))).text();if(n)if(/IDENA/.test(n))t.mainDataAttribution='<a href="http://idena.navarra.es/" target="_blank">IDENA</a>';else{for(var r=!1,i=0;i<t.dataAttributions.length;i++)if(n===t.dataAttributions[i]){r=!0;break}r||t.dataAttributions.push(n)}}},r=function(e){if(e){var n=function(){if(e.map.workLayers.length>0){for(var t=e.map.workLayers.reverse(),n=0;n<t.length;n++)if(t[n].url==e.url&&t[n].getVisibility())return!1;return!0}return!0};if(n()){var r=$("<div/>").html($.trim(e.wrap.getAttribution(TC.capabilities[e.url]))).text();if(r){var i=t.dataAttributions.indexOf(r);i>-1&&t.dataAttributions.splice(i,1)}}}};t.render();e.on(TC.Consts.event.LAYERADD,function(e){if(e.layer.wrap.getAttribution){n(e.layer);t.render()}});e.on(TC.Consts.event.LAYERREMOVE,function(e){if(e.layer.wrap.getAttribution){r(e.layer);t.render()}});e.on(TC.Consts.event.LAYERVISIBILITY,function(e){if(e.layer.wrap.getAttribution){e.layer.getVisibility()?n(e.layer):r(e.layer);t.render()}})};e.render=function(e){var t=this;t.renderData({api:t.apiAttribution,mainData:t.mainDataAttribution,otherData:t.dataAttributions},function(){t._$div.find("."+t.CLASS+"-cmd").on(TC.Consts.event.CLICK,function(){t._$div.find("."+t.CLASS+"-other").toggleClass(TC.Consts.classes.COLLAPSED)});$.isFunction(e)&&e()})}}();TC.control=TC.control||{};TC.control.MapContents||TC.syncLoadJS(TC.apiLocation+"TC/control/MapContents.js");TC.control.BasemapSelector=function(){var e=this;TC.control.MapContents.apply(e,arguments)};TC.inherit(TC.control.BasemapSelector,TC.control.MapContents);!function(){var e=TC.control.BasemapSelector.prototype;e.CLASS="tc-ctl-bms";e.template={};if(TC.isDebug){e.template[e.CLASS]=TC.apiLocation+"TC/templates/BasemapSelector.html";e.template[e.CLASS+"-node"]=TC.apiLocation+"TC/templates/BasemapSelectorNode.html"}else{e.template[e.CLASS]=function(){function t(e,t){return e.w("<h2>").h("i18n",t,{},{$key:"backgroundMaps"}).w('</h2><div class="tc-ctl-bms-tree"><form><ul class="tc-ctl-bms-branch">').s(t.get(["baseLayers"],!1),t,{block:n},{}).w("</ul></form></div>")}function n(e,t){return e.p("tc-ctl-bms-node",t,t.rebase(t.getPath(!0,[])),{})}dust.register(e.CLASS,t);t.__dustBody=!0;n.__dustBody=!0;return t};e.template[e.CLASS+"-node"]=function(){function t(e,t){return e.w('<li class="tc-ctl-bms-node" data-tc-layer-name="').f(t.get(["name"],!1),t,"h").w('" data-tc-layer-uid="').f(t.get(["uid"],!1),t,"h").w('"><label').x(t.get(["legend"],!1),t,{block:n},{}).w('><input type="radio" name="bms" value="').f(t.get(["name"],!1),t,"h").w('" /><span>').f(t.get(["title"],!1),t,"h").w("</span></label></li>")}function n(e,t){return e.w(' style="background-size: 100% 100%; background-image: url(').f(t.getPath(!1,["legend","src"]),t,"h").w(')"')}dust.register(e.CLASS+"-node",t);t.__dustBody=!0;n.__dustBody=!0;return t}}e.register=function(e){var t=this;TC.control.MapContents.prototype.register.call(t,e);e.on(TC.Consts.event.BASELAYERCHANGE,function(){t.update()});t._$div.on("change","input[type=radio]",function(e){var n=$(e.target);if(!Modernizr.canvas){t._$div.find("label > span").removeClass(TC.Consts.classes.CHECKED);n.next().addClass(TC.Consts.classes.CHECKED)}var r=n.closest("li").data("layer");r!=r.map.getBaseLayer()&&r.map.setBaseLayer(r);e.stopPropagation()})};e.update=function(){var e=this;e._$div.find("ul."+e.CLASS+"-branch").children("li").each(function(t,n){var r=$(n),i=r.data("layer"),a=r.find("input[type=radio]").first(),s=e.map.baseLayer===i;a.prop("checked",s);Modernizr.canvas||a.next().toggleClass(TC.Consts.classes.CHECKED,s)});e.updateScale()};e.updateLayerTree=function(e){var t=this;if(e.isBase&&!e.options.stealth){TC.control.MapContents.prototype.updateLayerTree.call(t,e);var n=t.CLASS+"-node";TC.loadJSInOrder(!window.dust,TC.url.templating,function(){dust.render(n,t.layerTrees[e.id],function(n,r){var i=$(r),a=i.data("tcLayerUid"),s=t._$div.find("."+t.CLASS+"-branch"),o=s.find('li[data-tc-layer-uid="'+a+'"]');if(1===o.length)o.html(i.html());else{i.data("layer",e);s.append(i)}n&&TC.error(n)});t.update()})}};e.removeLayer=function(e){var t=this;if(e.isBase){var n=t._$div.find("."+t.CLASS+"-branch").children("li");n.each(function(t,n){var r=$(n);if(r.data("layer")===e){r.remove();return!1}})}}}();TC.control=TC.control||{};TC.control.SWCacheClient||TC.syncLoadJS(TC.apiLocation+"TC/control/SWCacheClient.js");!function(){TC.Consts.classes.CONNECTION_OFFLINE=TC.Consts.classes.CONNECTION_OFFLINE||"tc-conn-offline";TC.Consts.classes.CONNECTION_WIFI=TC.Consts.classes.CONNECTION_WIFI||"tc-conn-wifi";TC.Consts.classes.CONNECTION_MOBILE=TC.Consts.classes.CONNECTION_MOBILE||"tc-conn-mobile";TC.Consts.classes.OFFLINE=TC.Consts.classes.OFFLINE||"tc-offline";var e="already_exists",t=window.applicationCache;TC._appCacheBuilders||(TC._appCacheBuilders=[]);TC._appCacheUpdater||(TC._appCacheUpdater=function(t,n){for(var r=(TC.Util.getQueryStringParams(n),0),i=TC._appCacheBuilders.length;i>r;r++){var a=TC._appCacheBuilders[r];switch(t.type){case"cached":a.$events.trigger($.Event(TC.Consts.event.MAPCACHEDOWNLOAD,{url:n}));break;case"obsolete":a.$events.trigger($.Event(TC.Consts.event.MAPCACHEDELETE,{url:n}));break;case"checking":break;case"progress":a.$events.trigger($.Event(TC.Consts.event.MAPCACHEPROGRESS,{url:n,loaded:t.loaded,total:t.total}));break;case"error":a.$events.trigger($.Event(TC.Consts.event.MAPCACHEERROR,{url:n,reason:t.reason,status:t.status}));break;case"noupdate":case"updateready":a.$events.trigger($.Event(TC.Consts.event.MAPCACHEERROR,{url:n,reason:e,status:t.status}))}}});var n,r=function(){var e=window.parent!==window&&document.referrer&&TC.Util.isSameOrigin(document.referrer)&&parent.TC&&parent.TC._appCacheUpdater;return function(t){e&&parent.TC._appCacheUpdater(t,location.href)}}(),i=function(){var e=$.Deferred();if(n&&n.length)e.resolve(n);else{var t=$("html").attr("manifest");t?$.ajax({url:t,type:"GET",dataType:"text"}).done(function(t){var n=t.indexOf("NETWORK:");n>=0&&(t=t.substr(0,n));n=t.indexOf("FALLBACK:");n>=0&&(t=t.substr(0,n));n=t.indexOf("SETTINGS:");n>=0&&(t=t.substr(0,n));var r=$.grep(t.split(/[\n\r]/),function(e){return e.length>0&&0!==e.indexOf("#")&&"CACHE:"!==e});r.shift();e.resolve(r)}).fail(function(){e.reject()}):e.reject()}return e};t.addEventListener("cached",r,!1);t.addEventListener("error",r,!1);t.addEventListener("noupdate",r,!1);t.addEventListener("obsolete",r,!1);t.addEventListener("progress",r,!1);t.addEventListener("updateready",r,!1);TC.control.CacheBuilder=function(){var e=this;TC.control.SWCacheClient.apply(this,arguments);var t=e._classSelector="."+e.CLASS;e._selectors={DRAW:t+"-draw",DRAWING:t+"-drawing",PROGRESS:t+"-progress",NEW:t+"-new",LIST:t+"-list",LISTITEM:t+"-list > li",DELBTN:t+"-btn-del",OKBTN:t+"-btn-ok",NEWBTN:t+"-btn-new",SAVEBTN:".tc-btn-save",CANCELBTN:".tc-btn-cancel",EDITBTN:".tc-btn-edit",VIEWBTN:".tc-btn-view",DELETEBTN:".tc-btn-delete",TILECOUNT:t+"-tile-count",NAMETB:t+"-txt-name",TEXTBOX:"input.tc-textbox",EXIT:t+"-link-exit",OFFPANEL:t+"-off-panel",BLLIST:t+"-bl-list",BLLISTITEM:t+"-bl-list > li",BLLISTTEXT:t+"-bl-panel-txt",RNGMAXRES:t+"-rng-maxres",SEARCH:t+"-map-available-srch",EMPTYLIST:t+"-map-available-empty",OFFLINEHIDDEN:"[data-no-cb]"};e.storedMaps=[];TC._appCacheBuilders.push(e);try{if(window.localStorage){for(var n=0,r=localStorage.length;r>n;n++){var i=localStorage.key(n);if(0===i.indexOf(e.LOCAL_STORAGE_KEY_PREFIX)){var a=localStorage.getItem(i).split(" "),o=s(a.shift()),l=a.join(" "),c={name:l,extent:o,url:decodeURIComponent(i.substr(e.LOCAL_STORAGE_KEY_PREFIX.length))};e.storedMaps.push(c)}}e.storedMaps.sort(function(e,t){return e.name>t.name?1:e.name<t.name?-1:0})}}catch(u){TC.error(e.getLocaleString("couldNotAccessLocalStorage"))}var h=$.extend({},r>1?arguments[1]:arguments[0]);e._$dialogDiv=$(TC.Util.getDiv(h.dialogDiv));h.dialogDiv||e._$dialogDiv.appendTo("body");e.mapIsOffline=location.pathname.indexOf("/"+e.CACHE_REQUEST_PATH)===location.pathname.length-e.CACHE_REQUEST_PATH.length-1;e.mapIsOffline&&$(e._selectors.OFFLINEHIDDEN).addClass(TC.Consts.classes.HIDDEN);TC.Control.apply(e,arguments);e.wrap=new TC.wrap.control.CacheBuilder(e);e.isDownloading=!1;e.baseLayers=[];e.options.avgTileSize=e.options.avgTileSize||TC.Cfg.avgTileSize;e.requestSchemas=[];e.minResolution=0;e.currentMap=null;e._loadedCount=0;var p=history.pushState;history.pushState=function(t){var n;n=p.apply(history,arguments);if(e._$offlinePanelDiv){var r=location.pathname.replace("/"+e.CACHE_REQUEST_PATH,"/"),i=TC.Util.getQueryStringParams();delete i[e.MAP_DEFINITION_PARAM_NAME];delete i[e.MAP_EXTENT_PARAM_NAME];delete i[e.SERVICE_WORKER_FLAG];var a=$.param(i);a.length&&(a="?"+a);var s=r+a+location.hash;e._$offlinePanelDiv.find(e._selectors.EXIT).attr("href",s)}return n};var d=navigator.connection||navigator.mozConnection||navigator.webkitConnection||{},f=function(){if(e._$offlinePanelDiv){var t=e._$offlinePanelDiv.find(e._selectors.OFFPANEL);t.removeClass(TC.Consts.classes.CONNECTION_OFFLINE).removeClass(TC.Consts.classes.CONNECTION_MOBILE).removeClass(TC.Consts.classes.CONNECTION_WIFI);var n=d.type;switch(n){case 1:case 2:case void 0:t.addClass(TC.Consts.classes.CONNECTION_WIFI);break;default:t.addClass(TC.Consts.classes.CONNECTION_MOBILE)}}};d.addEventListener&&d.addEventListener("typechange",f);window.addEventListener("online",f);window.addEventListener("offline",function(){e._$offlinePanelDiv&&e._$offlinePanelDiv.find(e._selectors.OFFPANEL).addClass(TC.Consts.classes.CONNECTION_OFFLINE).removeClass(TC.Consts.classes.CONNECTION_MOBILE).removeClass(TC.Consts.classes.CONNECTION_WIFI)})};TC.inherit(TC.control.CacheBuilder,TC.control.SWCacheClient);var a=TC.control.CacheBuilder.prototype;a.CLASS="tc-ctl-cbuild";a.MAP_DEFINITION_PARAM_NAME="map-def";a.MAP_EXTENT_PARAM_NAME="map-extent";a.LOCAL_STORAGE_KEY_PREFIX="TC.offline.map.";a.COOKIE_KEY_PREFIX="TC.offline.map.";a.CACHE_REQUEST_PATH="offline";a.SERVICE_WORKER_FLAG="sw";a._states={READY:"ready",EDIT:"editing",DOWNLOADING:"downloading",DELETING:"deleting"};a._actions={CREATE:"create",DELETE:"delete"};a.offlineControls=["attribution","basemapSelector","cacheBuilder","click","coordinates","draw","edit","geolocation","loadingIndicator","measure","navBar","popup","print","scale","scaleBar","scaleSelector","state","fullScreen"];TC.Consts.event.MAPCACHEDOWNLOAD=TC.Consts.event.MAPCACHEDOWNLOAD||"mapcachedownload.tc";TC.Consts.event.MAPCACHEDELETE=TC.Consts.event.MAPCACHEDELETE||"mapcachedelete.tc";TC.Consts.event.MAPCACHEPROGRESS=TC.Consts.event.MAPCACHEPROGRESS||"mapcacheprogress.tc";TC.Consts.event.MAPCACHEERROR=TC.Consts.event.MAPCACHEERROR||"mapcacheerror.tc";a.template={};if(TC.isDebug){a.template[a.CLASS]=TC.apiLocation+"TC/templates/CacheBuilder.html";a.template[a.CLASS+"-map-node"]=TC.apiLocation+"TC/templates/CacheBuilderMapNode.html";a.template[a.CLASS+"-bl-node"]=TC.apiLocation+"TC/templates/CacheBuilderBaseLayerNode.html";a.template[a.CLASS+"-dialog"]=TC.apiLocation+"TC/templates/CacheBuilderDialog.html";a.template[a.CLASS+"-off-panel"]=TC.apiLocation+"TC/templates/CacheBuilderOfflinePanel.html"}else{a.template[a.CLASS]=function(){function e(e,a){return e.w("<h2>").h("i18n",a,{},{$key:"offlineMaps"}).w(' <span class="tc-beta">').h("i18n",a,{},{$key:"beta"}).w('</span></h2><div class="tc-ctl-cbuild-content"><i class="tc-ctl-cbuild-map-search-icon"></i><input type="search" list="').f(a.get(["listId"],!1),a,"h").w('" class="tc-ctl-cbuild-map-available-srch tc-textbox" placeholder="').h("i18n",a,{},{$key:"cb.filter.plhr"}).w('"').x(a.get(["storedMaps"],!1),a,{"else":t,block:n},{}).w(' maxlength="200" /> <ul id="').f(a.get(["listId"],!1),a,"h").w('" class="tc-ctl-cbuild-list"><li class="tc-ctl-cbuild-map-available-empty"').x(a.get(["storedMaps"],!1),a,{block:r},{}).w("><span>").h("i18n",a,{},{$key:"cb.noMaps"}).w('</span></li><li class="tc-ctl-cbuild-map-not" hidden><span>').h("i18n",a,{},{$key:"noMatches"}).w("</span></li>").s(a.get(["storedMaps"],!1),a,{block:i},{}).w('</ul><div class="tc-ctl-cbuild-new"><button class="tc-button tc-icon-button tc-ctl-cbuild-btn-new" disabled title="').h("i18n",a,{},{$key:"newofflinemap"}).w('">').h("i18n",a,{},{$key:"newOfflineMap"}).w('</button></div><div class="tc-ctl-cbuild-drawing tc-hidden"><div class="tc-ctl-cbuild-tile-cmd"><button class="tc-button tc-icon-button tc-ctl-cbuild-btn-cancel-draw" title="').h("i18n",a,{},{$key:"cancel"}).w('">').h("i18n",a,{},{$key:"cancel"}).w('</button></div></div><div class="tc-ctl-cbuild-progress tc-hidden"><p>').h("i18n",a,{},{$key:"cb.DownloadingMap|s"}).w(': <span class="tc-ctl-cbuild-progress-count"></span></p><div class="tc-ctl-cbuild-progress-bar"><div class="tc-ctl-cbuild-progress-ratio" style="width:0"></div></div><button class="tc-button tc-icon-button tc-ctl-cbuild-btn-cancel-dl" title="').h("i18n",a,{},{$key:"cancel"}).w('">').h("i18n",a,{},{$key:"cancel"}).w("</button></div></div>")}function t(e,t){return e.w(" disabled")}function n(e,t){return e}function r(e,t){return e.w(" hidden")}function i(e,t){return e.p("tc-ctl-cbuild-map-node",t,t.rebase(t.getPath(!0,[])),{})}dust.register(a.CLASS,e);e.__dustBody=!0;t.__dustBody=!0;n.__dustBody=!0;r.__dustBody=!0;i.__dustBody=!0;return e};a.template[a.CLASS+"-map-node"]=function(){function e(e,t){return e.w('<li data-extent="').f(t.get(["extent"],!1),t,"h").w('"><span><a href="').f(t.get(["url"],!1),t,"h").w('" title="').f(t.get(["name"],!1),t,"h").w('">').f(t.get(["name"],!1),t,"h").w('</a></span><input class="tc-textbox tc-hidden" type="text" value="').f(t.get(["name"],!1),t,"h").w('" /><button class="tc-btn-save tc-hidden" title="').h("i18n",t,{},{$key:"save"}).w('"></button><button class="tc-btn-cancel tc-hidden" title="').h("i18n",t,{},{$key:"cancel"}).w('"></button><button class="tc-btn-edit" title="').h("i18n",t,{},{$key:"editMapName"}).w('">').h("i18n",t,{},{$key:"editMapName"}).w('</button><button class="tc-btn-view" title="').h("i18n",t,{},{$key:"viewMapExtent"}).w('">').h("i18n",t,{},{$key:"viewMapExtent"}).w('</button><button class="tc-btn-delete" title="').h("i18n",t,{},{$key:"deleteMap"}).w('">').h("i18n",t,{},{$key:"deleteMap"}).w("</button></li>")}dust.register(a.CLASS+"-map-node",e);e.__dustBody=!0;return e};a.template[a.CLASS+"-bl-node"]=function(){function e(e,t){return e.w('<li class="tc-ctl-cbuild-bl-node" data-tc-layer-uid="').f(t.get(["id"],!1),t,"h").w('"><label style="background-size: 100% 100%; background-image: url(').f(t.get(["thumbnail"],!1),t,"h").w(')"><input type="checkbox" name="cbbl" value="').f(t.get(["id"],!1),t,"h").w('" disabled><span>').f(t.get(["title"],!1),t,"h").w("</span></label></li>")}dust.register(a.CLASS+"-bl-node",e);e.__dustBody=!0;return e};a.template[a.CLASS+"-dialog"]=function(){function e(e,t){return e.w('<div class="tc-ctl-cbuild-dialog tc-modal"><div class="tc-modal-background tc-modal-close"></div><div class="tc-modal-window"><div class="tc-modal-header"><h3>').h("i18n",t,{},{$key:"newOfflineMap"}).w('</h3><div class="tc-ctl-popup-close tc-modal-close"></div></div><div class="tc-modal-body"><input type="text" class="tc-ctl-cbuild-txt-name" placeholder="').h("i18n",t,{},{$key:"nameRequired"}).w('" required /><div class="tc-ctl-cbuild-bl-panel"><h4>').h("i18n",t,{},{$key:"availableOfflineMaps"}).w("</h4><p>").h("i18n",t,{},{$key:"selectAtLeastOne"}).w(':</p><ul class="tc-ctl-cbuild-bl-list"></ul></div><div class="tc-ctl-cbuild-res-panel"><h4>').h("i18n",t,{},{$key:"maxRes"}).w('</h4><div class="tc-ctl-cbuild-res"></div><input type="range" class="tc-ctl-cbuild-rng-maxres" disabled value="0" title="').h("i18n",t,{},{$key:"maxRes"}).w('"></div><div class="tc-ctl-cbuild-tile-count"></div></div><div class="tc-modal-footer"><button class="tc-button tc-modal-close tc-ctl-cbuild-btn-ok" disabled>').h("i18n",t,{},{$key:"ok"}).w('</button><button type="button" class="tc-button tc-modal-close tc-ctl-cbuild-btn-cancel">').h("i18n",t,{},{$key:"cancel"}).w("</button></div></div></div>")}dust.register(a.CLASS+"-dialog",e);e.__dustBody=!0;return e};a.template[a.CLASS+"-off-panel"]=function(){function e(e,t){return e.w('<div class="tc-ctl-cbuild-off-panel tc-conn-wifi"><span>').h("i18n",t,{},{$key:"offlineMap"}).w('</span> <a href="" class="tc-ctl-cbuild-link-exit" title="').h("i18n",t,{},{$key:"returnToOnlineMaps"}).w('"><span>').h("i18n",t,{},{$key:"returnToOnlineMaps"}).w("</span></a></div>")}dust.register(a.CLASS+"-off-panel",e);e.__dustBody=!0;return e}}var s=function(e){return $.map(decodeURIComponent(e).split(","),function(e){return parseFloat(e)})},o=function(e){e._state=e._states.READY;e.showDownloadProgress(0,1);e._$div.find(e._selectors.DRAWING).addClass(TC.Consts.classes.HIDDEN);e._$div.find(e._selectors.PROGRESS).addClass(TC.Consts.classes.HIDDEN);e._$div.find(e._selectors.NEW).removeClass(TC.Consts.classes.HIDDEN);e._$div.find(e._selectors.LISTITEM).removeClass(TC.Consts.classes.DISABLED);e._$div.find(e._selectors.DELBTN).prop("disabled",!1);e._$dialogDiv.find(e._selectors.OKBTN).prop("disabled",!0);e._$div.find(e._selectors.NEWBTN).prop("disabled",!1);e._$dialogDiv.find(e._selectors.TILECOUNT).html("");e.extent=null;e._loadedCount=0;e.boxDraw&&e.boxDraw.cancel()},l=function(e){e._state=e._states.EDITING;e.showDownloadProgress(0,1);e._$div.find(e._selectors.NEW).addClass(TC.Consts.classes.HIDDEN);e._$div.find(e._selectors.PROGRESS).addClass(TC.Consts.classes.HIDDEN);e._$div.find(e._selectors.DRAWING).removeClass(TC.Consts.classes.HIDDEN);e.map.toast(e.getLocaleString("clickOnDownloadAreaFirstCorner"),{type:TC.Consts.msgType.INFO});e._$dialogDiv.find(e._selectors.OKBTN).prop("disabled",!0);e._$div.find(e._selectors.NEWBTN).prop("disabled",!0);e._$dialogDiv.find(e._selectors.NAMETB).val("");e.boxDraw.activate()},c=function(e){e._state=e._states.DOWNLOADING;TC.Util.closeModal();e.showDownloadProgress(0,1);e._$div.find(e._selectors.NEW).addClass(TC.Consts.classes.HIDDEN);e._$div.find(e._selectors.DRAWING).addClass(TC.Consts.classes.HIDDEN);e._$div.find(e._selectors.PROGRESS).removeClass(TC.Consts.classes.HIDDEN);e._$dialogDiv.find(e._selectors.OKBTN).prop("disabled",!0);e._$div.find(e._selectors.NEWBTN).prop("disabled",!0);e.layer.clearFeatures();e.boxDraw.cancel()},u=function(e){e._state=e._states.DELETING;e.showDownloadProgress(0,1);e._$div.find(e._selectors.DRAWING).addClass(TC.Consts.classes.HIDDEN);e._$div.find(e._selectors.PROGRESS).addClass(TC.Consts.classes.HIDDEN);e._$div.find(e._selectors.NEW).removeClass(TC.Consts.classes.HIDDEN);e._$div.find(e._selectors.LISTITEM).addClass(TC.Consts.classes.DISABLED);e._$div.find(e._selectors.DELBTN).prop("disabled",!0);e._$dialogDiv.find(e._selectors.OKBTN).prop("disabled",!0);e._$div.find(e._selectors.NEWBTN).prop("disabled",!1);e._$dialogDiv.find(e._selectors.TILECOUNT).html("");e.boxDraw.cancel()},h=function(e,t){t.find("span").first().addClass(TC.Consts.classes.HIDDEN);t.find(e._selectors.TEXTBOX).removeClass(TC.Consts.classes.HIDDEN).val(t.find("span a").html()).focus();t.find(e._selectors.SAVEBTN).removeClass(TC.Consts.classes.HIDDEN);t.find(e._selectors.CANCELBTN).removeClass(TC.Consts.classes.HIDDEN);t.find(e._selectors.EDITBTN).addClass(TC.Consts.classes.HIDDEN);t.find(e._selectors.VIEWBTN).addClass(TC.Consts.classes.HIDDEN);t.find(e._selectors.DELETEBTN).addClass(TC.Consts.classes.HIDDEN)},p=function(e,t){t.find("span").first().removeClass(TC.Consts.classes.HIDDEN);t.find(e._selectors.TEXTBOX).addClass(TC.Consts.classes.HIDDEN);t.find(e._selectors.SAVEBTN).addClass(TC.Consts.classes.HIDDEN);t.find(e._selectors.CANCELBTN).addClass(TC.Consts.classes.HIDDEN);

t.find(e._selectors.EDITBTN).removeClass(TC.Consts.classes.HIDDEN);t.find(e._selectors.VIEWBTN).removeClass(TC.Consts.classes.HIDDEN);t.find(e._selectors.DELETEBTN).removeClass(TC.Consts.classes.HIDDEN)},d=function(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".")},f=function(e,t){var n,r,i,a=t||{},s=e._$dialogDiv.find(e._classSelector+"-res"),o=e._$dialogDiv.find(e._selectors.RNGMAXRES),l=e.getResolutions();if(l.length){if(e.minResolution){if(void 0===a.rangeValue)for(var c=0,u=l.length;u>c;c++)if(e.minResolution>=l[c]){o.val(c);break}}else void 0===a.rangeValue&&o.val(Math.floor(l.length/2));r=parseInt(o.attr("max",l.length-1).val());var h=Math.floor(1e3*new Number(l[r]))/1e3;n=e.getLocaleString("metersPerPixel",{value:h.toLocaleString((e.map?e.map.options.locale:TC.Cfg.locale).replace("_","-"))});i=100*(r+1)/(l.length+1)+"%";o.prop("disabled",!1);e.minResolution=l[o.val()]}else{r=0;n="";o.val(0);i="0";e.minResolution=0;o.prop("disabled",!0)}s.css("left",i).html(n)},y=function(e,t){for(var n=null,r=0,i=e.tileMatrixLimits.length;i>r;r++){n=e.tileMatrixLimits[r];if(n.res<=t)break}return n},g=function(e){var t=e._$dialogDiv.find(e._classSelector+"-bl-node input[type=checkbox]");t.each(function(t,n){var r=$(n);if(r.prop("checked")){var i=e.requestSchemas.filter(function(e){return e.layerId===r.val()})[0];if(i){var a=y(i,e.minResolution);if(a){var s="{TileMatrix}",o="{TileRow}",l="{TileCol}",c=i.url;if(c.indexOf(s)<0){var u=c.indexOf("?");u>=0&&(c=c.substr(0,u));for(var h=0,p=e.baseLayers.length;p>h;h++){var d=e.baseLayers[h];if(d.id===i.layerId){c=c+"?layer="+d.layerNames+"&style=default&tilematrixset="+d.matrixSet+"&Service=WMTS&Request=GetTile&Version=1.0.0&Format="+d.format+"&TileMatrix="+s+"&TileRow="+o+"&TileCol="+l;break}}}r.parent("label").css("background-size","auto").css("background-position","left bottom").css("background-image","url("+c.replace("{TileMatrix}",a.mId).replace(o,a.rt).replace(l,a.cl)+")")}}}})},v=function(e,t){var n;n=1>t?e.getLocaleString("lessThan1Mb"):e.getLocaleString("approxXMb",{quantity:d(t)});return n},C=function(e){var t="";e.tileCount=0;for(var n=0,r=e.requestSchemas.length;r>n;n++)for(var i=e.requestSchemas[n],a=0,s=i.tileMatrixLimits.length;s>a;a++){var o=i.tileMatrixLimits[a];e.tileCount+=(o.cr-o.cl+1)*(o.rb-o.rt+1);if(o.res<e.minResolution)break}if(e.tileCount){e.estimatedMapSize=Math.round(e.tileCount*e.options.avgTileSize/1048576);t=e.getLocaleString("xTiles",{quantity:d(e.tileCount)})+" ("+v(e,e.estimatedMapSize)+")"}e._$dialogDiv.find(e._selectors.TILECOUNT).html(t)},L=function(e,t){return e._$div.find(e._selectors.LISTITEM).filter(function(e,n){return $(n).find("a").first().html()===t})},T=function(e,t){var n=t.indexOf("#");n>=0&&(t=t.substr(0,n));return e._$div.find(e._selectors.LISTITEM).filter(function(e,n){return $(n).find("a").first().attr("href")===t})},w=function(e,t){$("<iframe>").css("display","none").attr("src",t).appendTo(e._$div)},b=function(e,t){var n=e._$div.find('iframe[src="'+t+'"]');n.remove()},S=function(e,t){var n=!1;if(window.localStorage){localStorage.setItem(e.LOCAL_STORAGE_KEY_PREFIX+encodeURIComponent(t.url),t.extent+" "+t.name);n=!0}return n},E=function(e,t){var n=!1;if(window.localStorage){localStorage.removeItem(e.LOCAL_STORAGE_KEY_PREFIX+encodeURIComponent(t));n=!0}return n},O=function(e){var t=e.currentMap;if(S(e,t)){e.getRenderedHtml(e.CLASS+"-map-node",{name:t.name,url:t.url},function(t){e._$div.find(e._selectors.LIST).append(t);e._$div.find(e._selectors.EMPTYLIST).attr("hidden","hidden");e._$div.find(e._selectors.SEARCH).prop("disabled",!1)});e.storedMaps.push(t)}},A=function(e,t){var n=e.findStoredMap({url:t});if(n){E(e,t)&&L(e,n.name).remove();var r=$.inArray(n,e.storedMaps);e.storedMaps.splice(r,1);if(!e.storedMaps.length){e._$div.find(e._selectors.SEARCH).prop("disabled",!0);e._$div.find(e._selectors.EMPTYLIST).removeAttr("hidden")}return n.name}return null},x=function(e){e._$dialogDiv.find(e._selectors.OKBTN).prop("disabled",!e.extent||0===e._$dialogDiv.find(e._selectors.NAMETB).val().length||e._$dialogDiv.find(e._selectors.RNGMAXRES).prop("disabled"))};a.render=function(e){var t=this,n={storedMaps:t.storedMaps,listId:t.CLASS+"-list-"+TC.getUID()};t.getRenderedHtml(t.CLASS+"-dialog",null,function(e){t._$dialogDiv.html(e);t._$dialogDiv.find(t._selectors.NAMETB).on(TC.Consts.event.CLICK,function(e){e.preventDefault();this.selectionStart=0;this.selectionEnd=this.value.length;this.focus()})}).then(function(){t.renderData(n,function(){t._$dialogDiv.find(t._selectors.OKBTN).on(TC.Consts.event.CLICK,function(){var e={mapName:t._$dialogDiv.find(t._selectors.NAMETB).val()};if(t.findStoredMap({name:e.mapName}))TC.alert(t.getLocaleString("cb.mapNameAlreadyExists.error",e));else{var n=function(){t._$div.find(t._classSelector+"-name").html(e.mapName);t.map.toast(t.getLocaleString("downloadingMap",{mapName:e.mapName}));c(t);t.requestCache(e)},r=navigator.temporaryStorage||navigator.webkitTemporaryStorage||{};if(r.queryUsageAndQuota)r.queryUsageAndQuota(function(r,i){var a=(i-r)/1048576;t.estimatedMapSize<a?n():TC.confirm(t.getLocaleString("cb.mapCreation.warning.reasonSize",{mapName:e.mapName,mapSize:v(t,t.estimatedMapSize),availableStorage:v(t,Math.round(a))}),n)},function(e){TC.error(e)});else{var a=TC.Util.detectIE();if(a){var s=12>a?1e3:2e3,o=0,l=function(){var r=t.tileCount+o;r>s?TC.confirm(t.getLocaleString("cb.mapCreation.warning.reasonCount",{mapName:e.mapName,resourceCount:d(r),maxResourceCount:d(s)}),n):n()};i().done(function(e){o=e.length;l()}).fail(l)}else n()}}});t._$dialogDiv.find(t._selectors.NAMETB).on("input",function(){x(t)});t._$div.find(t._selectors.NEWBTN).on(TC.Consts.event.CLICK,function(){l(t)});t._$div.find(t._classSelector+"-btn-cancel-draw").on(TC.Consts.event.CLICK,function(){o(t)});t._$div.find(t._classSelector+"-btn-cancel-dl").on(TC.Consts.event.CLICK,function(){t.cancelCacheRequest()});t._$div.find(t._selectors.LIST).on(TC.Consts.event.CLICK,t._selectors.DELETEBTN,function(e){if(navigator.onLine){$btn=$(e.target);var n=$btn.parent().find("a").html();if(n){var r=t.getLocaleString("cb.delete.confirm",{mapName:n});t.serviceWorkerEnabled||(r=r+" "+t.getLocaleString("cb.delete.confirm.connect.warning"));if(confirm(r))if(navigator.onLine){u(t);t.deleteMap(n)}else TC.alert(t.getLocaleString("cb.delete.conn.alert"))}}else TC.alert(t.getLocaleString("cb.delete.conn.alert"))}).on(TC.Consts.event.CLICK,t._selectors.EDITBTN,function(e){h(t,$(e.target).parent())}).on(TC.Consts.event.CLICK,t._selectors.CANCELBTN,function(e){var n=$(e.target).parent();n.find(t._selectors.TEXTBOX).val(n.find("a").html());p(t,$(e.target).parent())}).on(TC.Consts.event.CLICK,t._selectors.SAVEBTN,function(e){var n=$(e.target).parent();p(t,n);var r=n.find("a"),i=(r.html(),n.find(t._selectors.TEXTBOX).val()),a=t.findStoredMap({url:r.attr("href")});if(a){a.name=i;r.html(i);r.attr("title",i);S(t,a)}}).on(TC.Consts.event.CLICK,t._selectors.VIEWBTN,function(e){$btn=$(e.target);var n=!$btn.hasClass(TC.Consts.classes.ACTIVE);t._$div.find(t._selectors.VIEWBTN).removeClass(TC.Consts.classes.ACTIVE).parent().removeClass(TC.Consts.classes.ACTIVE);var r=$btn.parent().find("a").html();if(r){var i=t.findStoredMap({name:r});if(i){var a=s(i.extent);t.layer.clearFeatures();if(n){t.layer.addPolygon([[[a[0],a[1]],[a[0],a[3]],[a[2],a[3]],[a[2],a[1]]]],{showsPopup:!1}).then(function(){t.layer.map.zoomToFeatures(t.layer.features)});$btn.addClass(TC.Consts.classes.ACTIVE);$btn.parent().addClass(TC.Consts.classes.ACTIVE);$btn.attr("title",t.getLocaleString("removeMapExtent"))}}}});var n=function(e){e=e.toLowerCase();var n=t._$div.find(t._selectors.LISTITEM).hide(),r=n.filter("li:not([class]),li."+TC.Consts.classes.ACTIVE);if(0===e.length){r.show();t._$div.find(t._classSelector+"-map-search-icon").css("visibility","visible")}else{t._$div.find(t._classSelector+"-map-search-icon").css("visibility","hidden");var i=new RegExp(e,"i");r.each(function(){var e=$(this);e.toggle(i.test(e.find("a").text()))});0===r.filter(":visible").length&&n.filter('[class^="tc-ctl-cbuild-map-not"]').show()}},r=t._$div.find(t._selectors.SEARCH);r.on("keyup search",function(){n($(this).val().toLowerCase().trim())});try{if(r.has($("::-ms-clear"))){var a;r.on("mouseup",function(e){a=r.val();""!==a&&setTimeout(function(){var e=r.val();""===e&&n(e)},1)})}}catch(m){}t._$dialogDiv.find(t._selectors.BLLIST).on("change","input[type=checkbox]",function(e){t.baseLayers.length=0;t._$dialogDiv.find(t._selectors.BLLIST+" input[type=checkbox]").each(function(e,n){var r=$(n);if(r.prop("checked"))for(var i=r.val(),a=0,s=t.map.baseLayers.length;s>a;a++){var o=t.map.baseLayers[a];if(o.id===i&&o.type===TC.Consts.layerType.WMTS){t.baseLayers[t.baseLayers.length]=o;break}}});t.updateRequestSchemas();f(t);g(t);x(t);C(t)});t._$dialogDiv.find(t._selectors.RNGMAXRES).on("input change",function(e){f(t,{rangeValue:$(e.target).val()});g(t);C(t)});TC.Util.getQueryStringParams();T(t,location.href).addClass(TC.Consts.classes.ACTIVE);$.isFunction(e)&&e()})});window.addEventListener("beforeunload",function(e){if(t.isDownloading){var n=t.getLocaleString("cb.mapDownloading.warning");e.returnValue=n;return n}},!0)};a.register=function(n){var r=this;TC.control.SWCacheClient.prototype.register.call(r,n);if(navigator.serviceWorker){navigator.serviceWorker.addEventListener("message",function(e){switch(e.data.event){case"progress":r.$events.trigger($.Event(TC.Consts.event.MAPCACHEPROGRESS,{url:e.data.name,loaded:e.data.count,total:e.data.total}));break;case"cached":r.$events.trigger($.Event(TC.Consts.event.MAPCACHEDOWNLOAD,{url:e.data.name}));break;case"deleted":r.$events.trigger($.Event(TC.Consts.event.MAPCACHEDELETE,{url:e.data.name}));break;case"error":e.data.action===r._actions.CREATE&&TC.error(r.getLocaleString("cb.resourceDownload.error",{url:e.data.url}))}});var a=function(){i().then(function(e){r.cacheUrlList(e,{silent:!0})})},l=function(){r.deleteCache(r.LOCAL_STORAGE_KEY_PREFIX,{silent:!0})};if(t.status===t.CACHED||t.status===t.UPDATEREADY||t.status===t.UNCACHED)a();else{t.addEventListener("cached",a,!1);t.addEventListener("updateready",a,!1);t.addEventListener("downloading",l,!1);t.addEventListener("obsolete",l,!1)}}if(r.mapIsOffline){n._$div.addClass(TC.Consts.classes.OFFLINE);r._$offlinePanelDiv=$(TC.Util.getDiv(r.options.offlinePanelDiv));r.options.offlinePanelDiv||r._$offlinePanelDiv.appendTo(n._$div);r.getRenderedHtml(r.CLASS+"-off-panel",null,function(e){r._$offlinePanelDiv.html(e);navigator.onLine||r._$offlinePanelDiv.find(r._selectors.OFFPANEL).addClass(TC.Consts.classes.CONNECTION_OFFLINE).removeClass(TC.Consts.classes.CONNECTION_MOBILE).removeClass(TC.Consts.classes.CONNECTION_WIFI);r._$offlinePanelDiv.find(r._selectors.EXIT).on(TC.Consts.event.CLICK,function(e){TC.confirm(r.getLocaleString("offlineMapExit.confirm"),null,function(){e.preventDefault()})})})}r.layer=null;n.addLayer({id:TC.getUID(),type:TC.Consts.layerType.VECTOR,stealth:!0}).then(function(e){r.layer=e;TC.loadJS(!TC.control.Draw,TC.apiLocation+"TC/control/Draw.js",function(){r.boxDraw=new TC.control.Draw({div:r._$div.find(r._selectors.DRAW),mode:TC.Consts.geom.RECTANGLE,layer:r.layer});r.boxDraw.$events.on(TC.Consts.event.DRAWSTART,function(e){r.map.toast(r.getLocaleString("clickOnDownloadAreaOppositeCorner"),{type:TC.Consts.msgType.INFO})}).on(TC.Consts.event.DRAWEND,function(e){var t=e.geometry.geometry[0],n=t[0],i=t[2],a=Math.min(n[0],i[0]),s=Math.max(n[0],i[0]),o=Math.min(n[1],i[1]),l=Math.max(n[1],i[1]);r.setExtent([a,o,s,l]);var c=r._$dialogDiv.find("input[type=checkbox]");c.each(function(e,t){for(var n=0,i=r.map.baseLayers.length;i>n;n++){var a=r.map.baseLayers[n];if(t.value===a.id){var s=$(t),o=s.parents("li").first(),l=a.getResolutions(),c=r.wrap.getRequestSchemas({extent:r.extent,layers:[a]})[0].tileMatrixLimits;if(c.length&&l[l.length-1]==c[c.length-1].res)o.removeClass(TC.Consts.classes.HIDDEN);else{s.prop("checked",!1);o.addClass(TC.Consts.classes.HIDDEN)}break}}});var u;u=r._$dialogDiv.find(r._selectors.BLLISTITEM).filter(":not(."+TC.Consts.classes.HIDDEN+")").length?"selectAtLeastOne":"cb.noMapsAtSelectedExtent";r._$dialogDiv.find(r._selectors.BLLISTTEXT).html(r.getLocaleString(u));g(r);C(r);TC.Util.showModal(r._$dialogDiv.find(r._classSelector+"-dialog"),{openCallback:function(){c.prop("disabled",!1);var e;if(Date.prototype.toLocaleString){var t={};t.year=t.month=t.day=t.hour=t.minute=t.second="numeric";e=(new Date).toLocaleString(r.map.options.locale.replace("_","-"),t)}else e=(new Date).toString();r._$dialogDiv.find(r._selectors.NAMETB).val(e)[0];x(r)},closeCallback:function(){c.prop("disabled",!0);r.layer.clearFeatures()}})});n.on(TC.Consts.event.CONTROLDEACTIVATE,function(e){r.boxDraw===e.control&&r._state===r._states.EDITING&&o(r)});n.addControl(r.boxDraw)})});var c=function(e){var t=!1,n=r._$dialogDiv.find(r._selectors.BLLIST),i=function(){return n.find('li[data-tc-layer-uid="'+e.id+'"]').length>0},a=e.type===TC.Consts.layerType.WMTS;TC.Util.detectSafari()&&TC.Util.detectIOS()&&(a=a&&TC.Util.isSameOrigin(e.url));if(a&&!i()){t=!0;r.getRenderedHtml(r.CLASS+"-bl-node",e,function(e){i()||n.append(e)})}return t};n.on(TC.Consts.event.LAYERADD,function(e){c(e.layer)}).on(TC.Consts.event.LAYERREMOVE,function(e){e.layer.type===TC.Consts.layerType.WMTS&&r._$dialogDiv.find(r._selectors.BLLIST).find('li[data-tc-layer-uid="'+e.layer.id+'"]').remove()});var u=TC.Util.getQueryStringParams(),h=u[r.MAP_DEFINITION_PARAM_NAME],p=u[r.MAP_EXTENT_PARAM_NAME];n.ready(function(){if(r.mapIsOffline){for(var e=[],t=0,i=r.offlineControls.length;i>t;t++){var a=r.offlineControls[t];a=a.substr(0,1).toUpperCase()+a.substr(1);e=e.concat(n.getControlsByClass("TC.control."+a))}for(var t=0,i=n.controls.length;i>t;t++){var s=n.controls[t];e.indexOf(s)<0&&s.disable()}$(r._selectors.OFFLINEHIDDEN).addClass(TC.Consts.classes.HIDDEN)}});n.loaded(function(){n.putLayerOnTop(r.layer);r._firstRender.then(function(){r._$div.find(r._selectors.NEWBTN).prop("disabled",!1);for(var e=0,t=n.baseLayers.length;t>e;e++)c(n.baseLayers[e])});if(r.mapIsOffline){var e=JSON.parse(window.atob(decodeURIComponent(h))),t=[],i=$.grep(n.baseLayers,function(n){var r=!1;if(n.type===TC.Consts.layerType.WMTS)for(var i=0,a=e.layers.length;a>i;i++){var s=e.layers[i],o=0===n.url.indexOf("//")?location.protocol+n.url:n.url;if(o===e.url[s.urlIdx]&&n.layerNames===s.id&&n.matrixSet===e.tms[s.tmsIdx]){r=!0;break}}r||n.type!==TC.Consts.layerType.VECTOR&&(t[t.length]=n);return r})[0];i&&n.setBaseLayer(i);for(var a=0,o=t.length;o>a;a++)n.removeLayer(t[a]);n.setExtent(s(p))}});r.$events.on(TC.Consts.event.MAPCACHEDOWNLOAD,function(e){r.isDownloading=!1;var t=function(e){var t=e.indexOf("#");return t>=0?e.substr(0,t):e},i=t(e.url),a=T(r,i);if(a.length&&!r.serviceWorkerEnabled){a.removeClass(TC.Consts.classes.DISABLED);a.find(r._selectors.DELBTN).prop("disabled",!1);TC.alert(r.getLocaleString("cb.delete.error"))}else if(r.currentMap&&i===r.currentMap.url){O(r);n.toast(r.getLocaleString("mapDownloaded",{mapName:r.currentMap.name}))}r.currentMap=null;b(r,e.url);o(r)}).on(TC.Consts.event.MAPCACHEDELETE,function(e){r.isDownloading=!1;var t=A(r,e.url)||r.currentMap&&r.currentMap.name;b(r,e.url);r.currentMap=null;if(t){document.cookie=r.COOKIE_KEY_PREFIX+"delete=; expires=Thu, 01 Jan 1970 00:00:01 GMT;";n.toast(r.getLocaleString("mapDeleted",{mapName:t}))}o(r)}).on(TC.Consts.event.MAPCACHEPROGRESS,function(e){var t=e.total;!t&&r.requestSchemas&&(t=r.requestSchemas[0].tileCount);var n=e.loaded;if(n)r._loadedCount=n;else{r._loadedCount+=1;n=r._loadedCount}r.showDownloadProgress(n,t)}).on(TC.Consts.event.MAPCACHEERROR,function(t){r.isDownloading=!1;b(r,t.url);o(r);var n=r.getLocaleString("cb.mapCreation.error"),i=!0;switch(t.reason){case"quota":n+=". "+r.getLocaleString("cb.mapCreation.error.reasonQuota");break;case"resource":n+=". "+r.getLocaleString("cb.mapCreation.error.reasonResource");break;case"manifest":"410"==t.status&&A(r,t.url);i=!1;break;case e:n+=". "+r.getLocaleString("cb.mapCreation.error.reasonAlreadyExists")}if(i)if(TC.Util.detectIE()){TC.error(n);TC.alert(r.getLocaleString("cb.mapCreation.error.reasonIE"))}else TC.alert(n);r.currentMap=null})};a.setExtent=function(e){var t=this;if($.isArray(e)&&e.length>=4){t.extent=e;t.updateRequestSchemas()}};a.cacheUrlList=function(e,t){var n=this,r=t||{};n.createCache(r.name||n.LOCAL_STORAGE_KEY_PREFIX+"common",{urlList:e,silent:r.silent})};a.requestCache=function(e){var t=this,n=e||{};if(t.map){var r=n.extent||t.extent||t.map.getExtent();t.updateRequestSchemas({extent:r});if(t.requestSchemas){for(var i=function(e,n,r){var i=e.res>=t.minResolution;!i&&n>0&&(i=r[n-1].res>t.minResolution);return i},a=function(e){return{mId:e.mId,cl:e.cl,cr:e.cr,rt:e.rt,rb:e.rb}},s=t.requestSchemas.map(function(e){return{layerId:e.layerId,tileMatrixLimits:e.tileMatrixLimits.filter(i)}}),o=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],l=0,c=s.length;c>l;l++){var u=s[l],h=u.tileMatrixLimits[u.tileMatrixLimits.length-1],p=h.res*h.tSize;o[0]=Math.min(o[0],h.origin[0]+p*h.cl);o[1]=Math.min(o[1],h.origin[1]-p*(h.rb+1));o[2]=Math.max(o[2],h.origin[0]+p*(h.cr+1));o[3]=Math.max(o[3],h.origin[1]-p*h.rt);u.tileMatrixLimits=u.tileMatrixLimits.map(a)}var d=Math.pow(10,t.map.wrap.isGeo()?TC.Consts.DEGREE_PRECISION:TC.Consts.METER_PRECISION);o=o.map(function(e,t){var n=3>t?Math.ceil:Math.floor;return n(e*d)/d});for(var f={bBox:o,res:Math.floor(1e3*t.minResolution)/1e3,url:[],tms:[],format:[],layers:new Array(t.baseLayers.length)},l=0,c=t.baseLayers.length;c>l;l++){var y=t.baseLayers[l],g=0===y.url.indexOf("//")?location.protocol+y.url:y.url,v=$.inArray(g,f.url);0>v&&(v=f.url.push(g)-1);var C=$.inArray(y.matrixSet,f.tms);0>C&&(C=f.tms.push(y.matrixSet)-1);var L=y.format.substr(y.format.indexOf("/")+1),T=$.inArray(L,f.format);0>T&&(T=f.format.push(L)-1);f.layers[l]={urlIdx:v,id:y.layerNames,tmsIdx:C,formatIdx:T}}var b=TC.Util.getQueryStringParams(),S=b[t.MAP_EXTENT_PARAM_NAME]=o.toString();b[t.MAP_DEFINITION_PARAM_NAME]=btoa(JSON.stringify(f));t.serviceWorkerEnabled&&(b[t.SERVICE_WORKER_FLAG]=1);var E=location.origin+location.pathname.substr(0,location.pathname.lastIndexOf("/")+1)+t.CACHE_REQUEST_PATH+"?"+$.param(b);t.currentMap={name:n.mapName,extent:S,url:E};t.isDownloading=!0;if(t.serviceWorkerEnabled)for(var l=0,c=s.length;c>l;l++){for(var O=s[l],A=null,x=0,P=t.baseLayers.length;P>x;x++){var _=t.baseLayers[x];if(_.id===O.layerId){A=t.wrap.getGetTilePattern(_);break}}if(A){urlList=[];var N=0;for(k=0,lenk=O.tileMatrixLimits.length;k<lenk;k++){var h=O.tileMatrixLimits[k];for(_=h.cl;_<=h.cr;_++)for(m=h.rt;m<=h.rb;m++)urlList[N++]=A.replace("{TileMatrix}",h.mId).replace("{TileCol}",_).replace("{TileRow}",m)}urlList.push(E);t.cacheUrlList(urlList,{name:E})}}else w(t,E)}}};a.cancelCacheRequest=function(){var e=this;if(e.currentMap){b(e,e.currentMap.url);e.deleteCache(e.currentMap.url).then(function(t){t||(e.currentMap=null)})}e.isDownloading=!1;o(e)};a.deleteMap=function(e){var t=this,n=t.findStoredMap({name:e});if(n){var r=TC.Util.getQueryStringParams(n.url);t.deleteCache(n.url).then(function(e){if(!e){document.cookie=t.COOKIE_KEY_PREFIX+"delete="+atob(decodeURIComponent(r[t.MAP_DEFINITION_PARAM_NAME]));w(t,n.url)}})}};a.findStoredMap=function(e){var t=this;return $.grep(t.storedMaps,function(t){var n=!0;e.name&&e.name!==t.name&&(n=!1);n&&e.url&&e.url!==t.url&&(n=!1);return n})[0]};a.showDownloadProgress=function(e,t){var n=this,r=n._classSelector,i=n._$div.find(r+"-progress-count");if(t){var a=Math.min(Math.round(100*e/t),100),s=a+"%";n._$div.find(r+"-progress-ratio").css("width",s);i.html(s)}else{n._$div.find(r+"-progress-bar").addClass(TC.Consts.classes.HIDDEN);i.html(n.getLocaleString("xFiles",{quantity:e}))}};a.updateRequestSchemas=function(e){var t=this,n=e||{};n.extent=n.extent||t.extent;n.layers=n.layers||t.baseLayers;t.requestSchemas=t.wrap.getRequestSchemas(n);return t.requestSchemas};a.getResolutions=function(){for(var e=this,t=[],n=function(e){return e.res},r=e.requestSchemas.map(function(e){return e.tileMatrixLimits.map(n)}),i=Number.POSITIVE_INFINITY,a=0,s=0,o=r.length;o>s;s++){var l=r[s];i=Math.min(i,l[0]);a=Math.max(a,l[l.length-1])}for(var s=0,o=r.length;o>s;s++)t=t.concat(r[s].filter(function(e){return i>=e&&e>=a&&t.indexOf(e)<0}));t.sort(function(e,t){return t-e});return t}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control.js");TC.control.Coordinates=function(){var e=this;e.crs="";e.xy=[0,0];e.latLon=[0,0];e.units="m";e.isGeo=!1;TC.Control.apply(e,arguments);e.geoCrs=e.options.geoCrs||TC.Cfg.geoCrs};TC.inherit(TC.control.Coordinates,TC.Control);!function(){var e=TC.control.Coordinates.prototype;e.CLASS="tc-ctl-coords";e.template=TC.isDebug?TC.apiLocation+"TC/templates/Coordinates.html":function(){function t(e,t){return e.w('<div>CRS: <span class="tc-ctl-coords-crs">').f(t.get(["crs"],!1),t,"h").w('</span></div><div class="tc-ctl-coords-xy">').x(t.get(["isGeo"],!1),t,{"else":n,block:r},{}).w("</div>").x(t.get(["showGeo"],!1),t,{block:i},{})}function n(e,t){return e.w('X: <span class="tc-ctl-coords-x">').f(t.get(["x"],!1),t,"h").w('</span> Y: <span class="tc-ctl-coords-y">').f(t.get(["y"],!1),t,"h").w("</span>")}function r(e,t){return e.h("i18n",t,{},{$key:"lat"}).w(': <span class="tc-ctl-coords-lat">').f(t.get(["lat"],!1),t,"h").w("</span> ").h("i18n",t,{},{$key:"lon"}).w(': <span class="tc-ctl-coords-lon">').f(t.get(["lon"],!1),t,"h").w("</span>")}function i(e,t){return e.w('<div class="tc-ctl-coords-alt">CRS: <span class="tc-ctl-coords-geocrs">').f(t.get(["geoCrs"],!1),t,"h").w('</span></div><div class="tc-ctl-coords-xy">').h("i18n",t,{},{$key:"lat"}).w(': <span class="tc-ctl-coords-lat">').f(t.get(["lat"],!1),t,"h").w("</span> ").h("i18n",t,{},{$key:"lon"}).w(': <span class="tc-ctl-coords-lon">').f(t.get(["lon"],!1),t,"h").w("</span></div>")}dust.register(e.CLASS,t);t.__dustBody=!0;n.__dustBody=!0;r.__dustBody=!0;i.__dustBody=!0;return t};e.register=function(e){var t=this;TC.Control.prototype.register.call(t,e);t.crs=t.map.crs;t.wrap||(t.wrap=new TC.wrap.control.Coordinates(t));t.clear();e.loaded(function(){t.wrap.register(e).then(function(){t.render(function(){t.update();t.clear()})});if(TC.Util.detectMobile()){$.when(e.addLayer({id:TC.getUID(),type:TC.Consts.layerType.VECTOR,stealth:!0,title:"Coordenadas"})).then(function(e){t.layer=e});t.activateCoords()}})};e.render=function(e){var t=this;t.renderData({x:t.xy[0],y:t.xy[1],lat:t.latLon[0],lon:t.latLon[1],crs:t.crs,geoCrs:t.geoCrs,isGeo:t.isGeo,showGeo:t.options.showGeo},function(){t.$crs=t._$div.find("."+t.CLASS+"-crs");t.$geoCrs=t._$div.find("."+t.CLASS+"-geocrs");t.$x=t._$div.find("."+t.CLASS+"-x");t.$y=t._$div.find("."+t.CLASS+"-y");t.$lat=t._$div.find("."+t.CLASS+"-lat");t.$lon=t._$div.find("."+t.CLASS+"-lon");$.isFunction(e)&&e()})};e.formatCoord=function(e,t){var n;n=e.toFixed(t);3>=t&&(n=n.replace(/\B(?=(\d{3})+(?!\d))/g,"|"));n=n.replace(".",",").replace(/\|/g,".");return n};e.update=function(){var e=this;e.renderPromise().then(function(){if(e.$crs){!e.isGeo&&e.options.showGeo&&(e.latLon=TC.Util.reproject(e.xy,e.crs,e.geoCrs).reverse());e.$crs.text(e.crs);e.$geoCrs.text(e.geoCrs);if(!e.isGeo){e.$x.text(e.formatCoord(e.xy[0],TC.Consts.METER_PRECISION));e.$y.text(e.formatCoord(e.xy[1],TC.Consts.METER_PRECISION))}if(e.isGeo||e.options.showGeo){e.$lat.text(e.formatCoord(e.latLon[0],TC.Consts.DEGREE_PRECISION));e.$lon.text(e.formatCoord(e.latLon[1],TC.Consts.DEGREE_PRECISION))}TC.Util.detectMobile()||e._$div.removeClass(TC.Consts.classes.HIDDEN)}})};e.clear=function(){var e=this;TC.Util.detectMobile()||e._$div.addClass(TC.Consts.classes.HIDDEN)};e.deactivateCoords=function(){var e=this;e._$div.toggleClass(TC.Consts.classes.HIDDEN,!0);e.clear();e.wrap.coordsDeactivate();e.cleanCoordsPointer()};e.cleanCoordsPointer=function(){var e=this;delete e.currentCoordsMarker;$.when(e.getLayer()).then(function(e){e&&e.clearFeatures()})};e.activateCoords=function(){var e=this;e.wrap.coordsActivate()};e.getCoords=function(){var e=this,t=e.map.getControlsByClass(TC.control.Popup);if(t&&t.length>0&&t[0].isVisible())e.coordsToPopup(t[0]);else{e.updateCoordsCtrl([(e.map.getExtent()[0]+e.map.getExtent()[2])/2,(e.map.getExtent()[1]+e.map.getExtent()[3])/2]);e.coordsToClick.call(e,{coordinate:e.xy})}};e.coordsToPopup=function(e){var t=this;e&&t.updateCoordsCtrl(e.wrap.popup.getPosition())};e.updateCoordsCtrl=function(e){var t=this;if(e){t.x=e[0];t.y=e[1];t.xy=[t.x,t.y];t.update()}};var t,n;e.coordsToClick=function(e){var r=this;if(!$(r.map._$div).hasClass("tc-ctl-sv-active tc-collapsed")){$(r._$div).stop(!0,!0);t&&clearTimeout(t);if(0==r._$div.find("span.close").length){n=r._$div.append('<span class="close"></span>');$(n).click(function(){r._$div.toggleClass(TC.Consts.classes.HIDDEN,!0);r.clear();r.cleanCoordsPointer()})}r.updateCoordsCtrl(e.coordinate);r.coordsMarkerAdd(e.coordinate);r._$div.removeClass(TC.Consts.classes.HIDDEN);t=setTimeout(function(){$(r._$div).animate({opacity:0},3e3,"linear",function(){$(r._$div).css({opacity:.7});r._$div.toggleClass(TC.Consts.classes.HIDDEN,!0);r.clear();r.cleanCoordsPointer()})},5e3)}};e.coordsMarkerAdd=function(e){var t=this;t.currentCoordsMarker?t.currentCoordsMarker.setCoords(e):$.when(t.getLayer()).then(function(n){n&&$.when(n.addMarker(e,{title:"Coord",showsPopup:!1,cssClass:TC.Consts.classes.POINT,anchor:[.5,.5]})).then(function(e){t.currentCoordsMarker=e})})};e.getLayer=function(){var e=this,t=new $.Deferred;void 0==e.layer?$.when(e.map.addLayer({id:TC.getUID(),type:TC.Consts.layerType.VECTOR,stealth:!0,title:"Coordenadas"})).then(function(n){e.layer=n;e.layer.map.putLayerOnTop(e.layer);t.resolve(e.layer)}):t.resolve(e.layer);return t}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control.js");TC.control.Download=function(e){var t=this;t._classSelector="."+t.CLASS;TC.Control.apply(t,arguments);var n=e||{};t._$dialogDiv=$(TC.Util.getDiv(n.dialogDiv));n.dialogDiv||t._$dialogDiv.appendTo("body")};TC.inherit(TC.control.Download,TC.Control);!function(){var e=TC.control.Download.prototype;e.CLASS="tc-ctl-download";e.template={};if(TC.isDebug){e.template[e.CLASS]=TC.apiLocation+"TC/templates/Download.html";e.template[e.CLASS+"-dialog"]=TC.apiLocation+"TC/templates/DownloadDialog.html"}else{e.template[e.CLASS]=function(){function t(e,t){return e.w("<h2>").h("i18n",t,{},{$key:"download"}).w('</h2><div><div class="tc-ctl-download-div"><div class="tc-ctl-download"><div class="tc-group tc-ctl-download-cnt"><label>').h("i18n",t,{},{$key:"format"}).w(':</label><select id="download-format" class="tc-combo"><option value="GML32">GML</option><option value="application/json">GeoJSON</option><option value="application/vnd.google-earth.kml+xml">KML (Google Earth)</option><option value="shape-zip">Shape (ESRI)</option></select></div></div><form class="tc-ctl-download-form" method="post" enctype="text/plain"><!--HACK: El servicio WFS espera que en el payload del POST llegue la consulta WFS (en este caso GetFeature). El problema es que debe llegar solo la consulta,no en formato clave=valor. Por tanto, lo \xfanico que se me ha ocurrido es buscar el primer signo \u2018=\u2019 de la consulta, y poner lo que hay a la izquerda en el namedel input Y lo de la derecha en el value (se inserta desde al archivo Download.js)--><input type="hidden" name="<wfs:GetFeature xmlns:xsi" class="tc-ctl-download-query" /></form><div class="tc-group tc-ctl-download-cnt"><i class="tc-ctl-download-help icon-question-sign" data-toggle="tooltip" data-placement="top" title="').h("i18n",t,{},{$key:"showDownloadHelp"}).w('"></i><button class="tc-ctl-download-btn tc-button tc-icon-button" title="').h("i18n",t,{},{$key:"downloadLayersFromCurrentExtent"}).w('">').h("i18n",t,{},{$key:"download"}).w('</button></div><div class="tc-alert alert-warning tc-hidden"><p id="zoom-msg"><strong>').h("i18n",t,{},{$key:"tooManyFeatures"}).w(": </strong>").h("i18n",t,{},{$key:"tooManyFeatures.instructions"}).w('</p><p id="layers-msg"><strong>').h("i18n",t,{},{$key:"noLayersLoaded"}).w(": </strong>").h("i18n",t,{},{$key:"noLayersLoaded.instructions"}).w('</p><p id="url-msg"><strong>').h("i18n",t,{},{$key:"tooManySelectedLayers"}).w(": </strong>").h("i18n",t,{},{$key:"tooManySelectedLayers.instructions"}).w('</p><p id="noFeatures-msg"><strong>').h("i18n",t,{},{$key:"noData"}).w(": </strong>").h("i18n",t,{},{$key:"noData.instructions"}).w("</p></div></div></div>")}dust.register(e.CLASS,t);t.__dustBody=!0;return t};e.template[e.CLASS+"-dialog"]=function(){function t(e,t){return e.w(' <div class="tc-ctl-download-help-dialog tc-modal"><div class="tc-modal-background tc-modal-close"></div><div class="tc-modal-window"><div class="tc-modal-header"><h3>').h("i18n",t,{},{$key:"downloadData"}).w('</h3><div class="tc-ctl-popup-close tc-modal-close"></div></div><div class="tc-modal-body"><p>').h("i18n",t,{},{$key:"dl.instructions.1|s"}).w("</p><ul><li>").h("i18n",t,{},{$key:"dl.instructions.2|s"}).w("</li><li>").h("i18n",t,{},{$key:"dl.instructions.3|s"}).w("</li><li>").h("i18n",t,{},{$key:"dl.instructions.4|s"}).w("<ul><li>").h("i18n",t,{},{$key:"dl.instructions.5|s"}).w("</li><li>").h("i18n",t,{},{$key:"dl.instructions.6|s"}).w('</li></ul></li></ul></div><div class="tc-modal-footer"><button type="button" class="tc-button tc-modal-close">').h("i18n",t,{},{$key:"close"}).w("</button></div></div></div>")}dust.register(e.CLASS+"-dialog",t);t.__dustBody=!0;return t}}e.render=function(e){var t=this;t.getRenderedHtml(t.CLASS+"-dialog",null,function(e){t._$dialogDiv.html(e)}).then(function(){TC.Control.prototype.render.call(t,e)})};e.register=function(e){var t=this;TC.Control.prototype.register.call(t,e);var n=[],r=0,i=function(){t.options.serviceUrl?$.get(t.options.serviceUrl+"?request=getcapabilities").done(function(e){var t=TC.Util.getElementByNodeName(e,"ows:Operation");if(t&&t.length>0){for(var n,i=0;i<t.length;i++)"GetFeature"==t[i].attributes.name.value&&(n=t[i]);if(n)for(var a=TC.Util.getElementByNodeName(n,"ows:Constraint"),i=0;i<a.length;i++)"CountDefault"==a[i].attributes.name.value&&(r=parseInt(TC.Util.getElementByNodeName(a[i],"ows:DefaultValue")[0].textContent))}}).fail(function(e){console.error(e)}):TC.error("No se ha encontrado el par\xe1metro serviceUrl en el control de descarga")},a=function(e){n.push(e.name)},s=function(e,t){if(e instanceof Array)for(var n=0;n<e.length;n++)s(e[n],t);else e.hasOwnProperty("children")&&e.children.length>0&&s(e.children,t);e.hasOwnProperty("children")&&0==e.children.length&&t.apply(this,[e])},o=function(){var e=t._$div.find("select").val(),i=l();if(i.length>0){n=[];for(var o=0;o<i.length;o++)i[o].url.indexOf(t.options.downloadServiceUrl)>=0&&s(i[o].getTree(),a);var u=0,h=t.map.getExtent(),p='"http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.1.0/wfs.xsd" xmlns:gml="http://www.opengis.net/gml" xmlns:wfs="http://www.opengis.net/wfs" xmlns:ogc="http://www.opengis.net/ogc" service="WFS" version="1.1.0" {resultType} outputFormat="{format}">';query="<wfs:GetFeature xmlns:xsi="+p.format({resultType:'resultType="hits"',format:"application/json"});var d='<wfs:Query typeName="{typeName}"><ogc:Filter xmlns="http://www.opengis.net/ogc"><ogc:BBOX><gml:Envelope><gml:lowerCorner>{lowerCorner}</gml:lowerCorner><gml:upperCorner>{upperCorner}</gml:upperCorner></gml:Envelope></ogc:BBOX></ogc:Filter></wfs:Query>',f="";$.each(n,function(e,t){f+=d.format({typeName:t,lowerCorner:h[0]+" "+h[1],upperCorner:h[2]+" "+h[3]})});query+=f+"</wfs:GetFeature>";$.ajax({url:t.options.serviceUrl,async:!1,data:query,contentType:"application/xml",type:"POST",success:function(n){if(n.childNodes[0].attributes.numberOfFeatures){u=parseInt(n.childNodes[0].attributes.numberOfFeatures.value);query=p.format({resultType:"",format:e})+f+"</wfs:GetFeature>";if(r>u){var i=$("form.tc-ctl-download-form");$(".tc-ctl-download-query").val(query);i.attr("action",t.options.serviceUrl+"?download=zip");

i.submit()}else c({zoom:!0})}else c({noFeatures:!0})}})}else c({layers:!0})},l=function(){for(var e=[],n=0;n<t.map.workLayers.length;n++){var r=t.map.workLayers[n];r.type===TC.Consts.layerType.WMS&&r.getVisibility()&&r.names.length>0&&e.push(r)}return e},c=function(e){var n,r=t._$div.find(".alert-warning");e.zoom?n=r.find("#zoom-msg").html():e.layers?n=r.find("#layers-msg").html():e.url?n=r.find("#url-msg").html():e.noFeatures&&(n=r.find("#noFeatures-msg").html());t.map.toast(n,{type:TC.Consts.msgType.WARNING})},u=function(e){e.stopPropagation();TC.Util.showModal(t._$dialogDiv.find(t._classSelector+"-help-dialog"))};i();t._$div.on(TC.Consts.event.CLICK,".tc-ctl-download-btn",o);t._$div.on(TC.Consts.event.CLICK,".tc-ctl-download-help",u)}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control.js");TC.Feature&&TC.feature.Point||TC.syncLoadJS(TC.apiLocation+"TC/feature/Point.js");TC.Feature&&TC.feature.Polyline||TC.syncLoadJS(TC.apiLocation+"TC/feature/Polyline.js");TC.Feature&&TC.feature.Polygon||TC.syncLoadJS(TC.apiLocation+"TC/feature/Polygon.js");TC.Consts.event.DRAWSTART="drawstart.tc";TC.Consts.event.DRAWEND="drawend.tc";TC.Consts.event.DRAWCANCEL="drawcancel.tc";TC.Consts.event.MEASURE="measure.tc";TC.Consts.event.MEASUREPARTIAL="measurepartial.tc";!function(){TC.control.Draw=function(){var e=this;TC.Control.apply(e,arguments);e._classSelector="."+e.CLASS;e._pointClass=e.CLASS+"-point";e._lineClass=e.CLASS+"-line";e._polygonClass=e.CLASS+"-polygon";e.history=[];e.historyIndex=0;this.renderPromise().then(function(){e.reset=!0;e.callBack=null;e.measure=!1;e._cancelClick=!1;e.mode=e.options.mode||TC.Consts.geom.POLYLINE;e.options.measure&&(e.measure=e.options.measure);$.isFunction(e.options.callback)&&(e.callBack=e.options.callback);e.wrap=new TC.wrap.control.Draw(e);e._$newBtn=e._$div.find(e._classSelector+"-btn-new").on(TC.Consts.event.CLICK,function(){e["new"]()});e._$cancelBtn=e._$div.find(e._classSelector+"-btn-cancel").on(TC.Consts.event.CLICK,function(){e.cancel()});e._$endBtn=e._$div.find(e._classSelector+"-btn-end").on(TC.Consts.event.CLICK,function(){e.end()});e._$undoBtn=e._$div.find(e._classSelector+"-btn-undo").on(TC.Consts.event.CLICK,function(){e.undo()});e._$redoBtn=e._$div.find(e._classSelector+"-btn-redo").on(TC.Consts.event.CLICK,function(){e.redo()});e.$events.on(TC.Consts.event.MEASURE,function(t){e.resetValues()});e.$events.on(TC.Consts.event.POINT,function(n){if(e.layer&&e.layer.features&&e.layer.features.length>0){e.layer.clearFeatures();e.resetValues()}e.history.length=e.historyIndex;e.history[e.historyIndex++]=n.point;t(e)});e.$events.on(TC.Consts.event.DRAWEND,function(t){n(e);e.callBack&&e.callBack(t.geometry)})})};TC.inherit(TC.control.Draw,TC.Control);var e=TC.control.Draw.prototype;e.CLASS="tc-ctl-draw";var t=function(e){e._$endBtn.prop("disabled",0===e.historyIndex||e.mode===TC.Consts.geom.POLYGON&&e.historyIndex<3||e.mode===TC.Consts.geom.POLYLINE&&e.historyIndex<2);e._$redoBtn.prop("disabled",e.history.length===e.historyIndex);e._$undoBtn.prop("disabled",0===e.historyIndex)},n=function(e){e.resetValues();e._$endBtn.prop("disabled",!0);e._$cancelBtn.prop("disabled",!1)};e.template=TC.isDebug?TC.apiLocation+"TC/templates/Draw.html":function(){function t(e,t){return e.w(' <button class="tc-ctl-btn tc-ctl-draw-btn-new" title="').f(t.get(["tooltip"],!1),t,"h").w('">').h("i18n",t,{},{$key:"new"}).w('</button><button class="tc-ctl-btn tc-ctl-draw-btn-undo" disabled title="').h("i18n",t,{},{$key:"undo"}).w('">').h("i18n",t,{},{$key:"undo"}).w('</button><button class="tc-ctl-btn tc-ctl-draw-btn-redo" disabled title="').h("i18n",t,{},{$key:"redo"}).w('">').h("i18n",t,{},{$key:"redo"}).w('</button><button class="tc-ctl-btn tc-ctl-draw-btn-end" title="').h("i18n",t,{},{$key:"end"}).w('">').h("i18n",t,{},{$key:"end"}).w('</button><button class="tc-ctl-btn tc-ctl-draw-btn-cancel" title="').h("i18n",t,{},{$key:"cancel"}).w('">').h("i18n",t,{},{$key:"cancel"}).w("</button> ")}dust.register(e.CLASS,t);t.__dustBody=!0;return t};e.render=function(e){var t,n=this;switch(n.options.mode){case TC.Consts.geom.POLYLINE:case TC.Consts.geom.MULTIPOLYLINE:t=n.getLocaleString("drawLine");n._$div.addClass(n._lineClass);break;case TC.Consts.geom.POLYGON:case TC.Consts.geom.MULTIPOLYGON:t=n.getLocaleString("drawPolygon");n._$div.addClass(n._polygonClass);break;case TC.Consts.geom.POINT:case TC.Consts.geom.MULTIPOINT:t=n.getLocaleString("draw");n._$div.addClass(n._pointClass);break;default:t=n.getLocaleString("draw")}n.renderData({tooltip:t},function(){$.isFunction(e)&&e()})};e.register=function(e){var t=this;TC.Control.prototype.register.call(t,e);e.loaded(function(){t.options.layer?t.setLayer(t.options.layer):"boolean"!=typeof t.options.layer&&e.loaded(function(){t.layerPromise=e.addLayer({id:TC.getUID(),title:"DrawControl",stealth:!0,type:TC.Consts.layerType.VECTOR,styles:{point:$.extend({},e.options.styles.point,{fillOpacity:0}),line:e.options.styles.line,polygon:e.options.styles.polygon}});$.when(t.layerPromise).then(function(n){t.layer=n;e.putLayerOnTop(t.layer)})})})};e["new"]=function(){var e=this;e.layer&&e.layer.clearFeatures();e.setMode(e.mode,!0)};e.undo=function(){var e=this,n=e.wrap.undo();if(n){e.historyIndex--;t(e);e.historyIndex<=0&&e.resetValues()}return n};e.redo=function(){var e=this,n=this.wrap.redo();if(n){e.historyIndex++;t(e)}return n};e.cancel=function(){var e=this;e._cancelClick=!0;this.setMode(null,!1);e.resetValues();n(e);e.$events.trigger($.Event(TC.Consts.event.DRAWCANCEL,{ctrl:e}))};e.activate=function(){var e=this;e._$newBtn.addClass(TC.Consts.classes.ACTIVE);TC.Control.prototype.activate.call(e);e.wrap.activate(e.mode);e._$div.removeClass(e._pointClass).removeClass(e._lineClass).removeClass(e._polygonClass);switch(e.mode){case TC.Consts.geom.POINT:e._$div.addClass(e._pointClass);break;case TC.Consts.geom.POLYLINE:e._$div.addClass(e._lineClass);break;case TC.Consts.geom.POLYGON:e._$div.addClass(e._polygonClass)}};e.deactivate=function(){var e=this;e._$newBtn&&e._$newBtn.removeClass(TC.Consts.classes.ACTIVE);TC.Control.prototype.deactivate.call(e,!e._cancelClick);e.wrap&&e.wrap.deactivate();e.resetValues();e._cancelClick=!1};e.isExclusive=function(){return!0};e.end=function(){var e=this;e.wrap.end();e.resetValues()};e.setMode=function(e,t){var n=this;e&&(n.mode=e);if(t&&e){n.layer&&n.layer.map.putLayerOnTop(n.layer);n.activate()}else n.deactivate();var r=t?TC.Consts.event.CONTROLACTIVATE:TC.Consts.event.CONTROLDEACTIVATE;n.map&&n.map.$events.trigger($.Event(r,{control:n}))};e.getLayer=function(){var e=this;return e.options&&"boolean"==typeof e.options.layer&&!e.options.layer?null:e.layer?e.layer:e.layerPromise};e.setLayer=function(e){var t=this;t.map&&(t.layer="string"==typeof e?t.map.getLayer(e):e)};e.resetValues=function(){var e=this;e.history.length=0;e.historyIndex=0;t(e)}}();TC.control=TC.control||{};TC.control.SWCacheClient||TC.syncLoadJS(TC.apiLocation+"TC/control/SWCacheClient.js");TC.Consts.editMode={SELECT:"select",ADDPOINT:"addpoint",ADDLINE:"addline",ADDPOLYGON:"addpolygon"};TC.Consts.editStyles={NEW:"temporary",SELECTED:"select",DEFAULT:"default"};TC.Consts.event.POINT="point.tc";TC.Consts.event.BEFOREFEATUREMODIFY="beforefeaturemodify.tc";TC.Consts.event.FEATUREMODIFY="featuremodify.tc";TC.Consts.event.FEATURESSELECT="featureselect.tc";TC.Consts.event.FEATURESUNSELECT="featureunselect.tc";!function(){var e=0,t=function(){return"NewFeature."+e++},n=function(e,t){var n=$.Deferred();TC.loadJS(!window.localforage,[TC.Consts.url.LOCALFORAGE],function(){var r,i;switch(!0){case t instanceof TC.feature.Polygon:i=TC.Consts.geom.POLYGON;break;case t instanceof TC.feature.Polyline:i=TC.Consts.geom.POLYLINE;break;case t instanceof TC.feature.Point:i=TC.Consts.geom.POINT;break;case t instanceof TC.feature.MultiPolygon:i=TC.Consts.geom.MULTIPOLYGON;break;case t instanceof TC.feature.MultiPolyline:i=TC.Consts.geom.MULTIPOLYLINE}r={id:t.id||t.provId,attributes:t.data,type:i,geometry:t.geometry};localforage.setItem(e,r).then(function(){n.resolve({feature:t})})["catch"](function(e){n.reject({feature:t,error:e})})});return n.promise()},r=function(e){var t=$.Deferred();TC.loadJS(!window.localforage,[TC.Consts.url.LOCALFORAGE],function(){localforage.removeItem(e).then(function(){t.resolve(e)})["catch"](function(e){t.reject(e)})});return t.promise()},i=function(e){var t=$.Deferred();TC.loadJS(!window.localforage,[TC.Consts.url.LOCALFORAGE],function(){localforage.getItem(e).then(function(n){t.resolve({key:e,feature:n})})["catch"](function(e){t.reject(e)})});return t.promise()},a=function(e,t){return e.LOCAL_STORAGE_KEY_PREFIX+(t||e.layer.id)},s=function(e,t){return a(e,t)+e.LOCAL_STORAGE_ADDED_KEY_PREFIX},o=function(e,t){return a(e,t)+e.LOCAL_STORAGE_MODIFIED_KEY_PREFIX},l=function(e,t){return a(e,t)+e.LOCAL_STORAGE_REMOVED_KEY_PREFIX},c=function(e){e._$deleteBtn.prop("disabled",!0);e._$joinBtn.prop("disabled",!0);e._$splitBtn.prop("disabled",!0)},u=function(e){var t=!1;(TC.feature.MultiPolygon&&e instanceof TC.feature.MultiPolygon||TC.feature.MultiPolyline&&e instanceof TC.feature.MultiPolyline)&&e.geometry.length>1&&(t=!0);return t},h=function(e,t){e._$deleteBtn.prop("disabled",0===t.length);e._$joinBtn.prop("disabled",t.length<2);e._$splitBtn.prop("disabled",0===t.filter(u).length)},p=function(e,t){e._$saveBtn.prop("disabled",t);e._$discardBtn.prop("disabled",t);self.checkedOut=!t},d=function(e,t){"undefined"!=typeof t?p(e,!t):TC.loadJS(!window.localforage,[TC.Consts.url.LOCALFORAGE],function(){var t=a(e);localforage.keys().then(function(n){if(n){for(var r=!0,i=0,a=n.length;a>i;i++)if(0===n[i].indexOf(t)){r=!1;break}p(e,r)}})})},f=function(e,t){var n=$.Deferred(),r=e._changesLayers[t.id];if(r)n.resolve(r);else{r=e._changesLayers[t.id]=new TC.layer.Vector({id:TC.getUID(),title:t.title+" - cambios pendientes",stealth:!0,styles:e.getChangesLayerStyle(t)});var i=e.map.layers.indexOf(t);e.map.insertLayer(r,i+1,function(){n.resolve(r)})}return n.promise()};TC.control.Edit=function(){var e=this;TC.control.SWCacheClient.apply(this,arguments);e._classSelector="."+e.CLASS;e.$events=$(e);e.wrap=new TC.wrap.control.Edit(e);e._layerDeferred=$.Deferred();e.layer=null;e.checkedOut=!1;e.callback=arguments[2]&&$.isFunction(arguments[2])?arguments[2]:e.options.callback?e.options.callback:null;e.multi=e.options.multi?e.options.multi:!1;e.eraseActionConfirmTxt=e.options.eraseText?e.options.eraseText:"\xbfEst\xe1 seguro de eliminar esta(s) geometr\xeda(s)?";e.cancelActionConfirmTxt=e.options.cancelText?e.options.eraseText:"Si continua todos los cambios se perder\xe1n. \xbfDesea continuar?";e.styles=e.options.styles;e.features={};e.attributeEditor=null;e.pointDraw=null;e.lineDraw=null;e.polygonDraw=null;e.snapping="boolean"==typeof e.options.snapping?e.options.snapping:!0;e._changesLayers={};e._showsChanges="boolean"==typeof e.options.showChanges?e.options.showChanges:!0;$.isFunction(e.options.getChangesLayerStyleFunction)&&(e.getChangesLayerStyleFunction=e.getChangesLayerStyle);e.$events.on(TC.Consts.event.FEATUREADD,function(r){var i=r.feature;i.provId=t();var a=e._changesLayers[e.layer.id];e.features[e.layer.id].added.push(i);a.addFeature(i);n(s(e)+i.provId,i).then(function(){d(e,!0);TC.toast("Adici\xf3n guardada")},function(){TC.error("Fallo al guardar adici\xf3n")})}).on(TC.Consts.event.FEATUREREMOVE,function(t){var i=t.feature,a=i.provId||i.id,c=function(){d(e);TC.toast("Eliminaci\xf3n guardada")},u=function(){TC.error("Fallo al guardar eliminaci\xf3n")},h=e._changesLayers[e.layer.id],p=e.features[e.layer.id],f=p.added.indexOf(i);if(0>f){var m=l(e);f=p.modified.indexOf(i);if(0>f){f=p.removed.indexOf(i);if(0>f){p.removed.push(i);h.addFeature(i);n(m+i.id,i).then(c,u)}}else{p.modified.splice(f,1);p.removed.push(i);r(o(e)+i.id).then(function(){c();n(m+i.id,i).then(c,u)},u)}}else{h.removeFeature(i);p.added.splice(f,1);r(s(e)+a).then(c,u)}}).on(TC.Consts.event.FEATUREMODIFY,function(t){var r=t.feature,i=r.provId||r.id,a=function(){d(e,!0);TC.toast("Modificaci\xf3n guardada")},l=function(){TC.error("Fallo al guardar modificaci\xf3n")},c=e._changesLayers[e.layer.id],u=e.features[e.layer.id],h=u.added.indexOf(r);if(0>h){h=u.modified.indexOf(r);if(0>h){c.addFeature(r);u.modified.push(r)}n(o(e)+i,r).then(a,l)}else n(s(e)+i,r).then(a,l)}).on(TC.Consts.event.FEATUREADD+" "+TC.Consts.event.FEATUREREMOVE+" "+TC.Consts.event.FEATUREMODIFY,function(t){if(e.serviceWorkerEnabled&&navigator.onLine){var n=e.layer.wrap.getGetFeatureUrl(),r=e.layer.wrap.getDescribeFeatureTypeUrl();n&&r&&e.createCache(e.LOCAL_STORAGE_KEY_PREFIX+e.layer.id,{urlList:[n,r]})}}).on(TC.Consts.event.CONTROLDEACTIVATE,function(e){}).on(TC.Consts.event.FEATURESSELECT,function(t){var n=e.getSelectedFeatures();h(e,n);n.length&&n[0].showPopup(e.attributeEditor)}).on(TC.Consts.event.FEATURESUNSELECT,function(t){h(e,e.getSelectedFeatures())})};TC.inherit(TC.control.Edit,TC.control.SWCacheClient);var m=TC.control.Edit.prototype;m.CLASS="tc-ctl-edit";m.LOCAL_STORAGE_KEY_PREFIX="TC.offline.edit.";m.LOCAL_STORAGE_ADDED_KEY_PREFIX=".added.";m.LOCAL_STORAGE_MODIFIED_KEY_PREFIX=".modified.";m.LOCAL_STORAGE_REMOVED_KEY_PREFIX=".removed.";m.template={};if(TC.isDebug){m.template[m.CLASS]=TC.apiLocation+"TC/templates/Edit.html";m.template[m.CLASS+"-attr"]=TC.apiLocation+"TC/templates/EditAttributes.html"}else{m.template[m.CLASS]=function(){function e(e,r){return e.w("<h2>").h("i18n",r,{},{$key:"featureEdit"}).w(' <span class="tc-beta">').h("i18n",r,{},{$key:"beta"}).w('</span></h2><div class="tc-ctl-edit-layer"><select class="tc-combo tc-ctl-edit-layer-sel"><option value="">').h("i18n",r,{},{$key:"selectLayerToEdit"}).w("</option>").s(r.get(["layers"],!1),r,{block:t},{}).w('</select><input type="checkbox" id="tc-ctl-edit-view-changes-cb"').x(r.get(["showChanges"],!1),r,{block:n},{}).w(' /><label class="tc-ctl-edit-view-changes" for="tc-ctl-edit-view-changes-cb">').h("i18n",r,{},{$key:"highlightUnsyncedChanges"}).w('</label></div><div class="tc-ctl-edit-mode"><form><label class="tc-ctl-edit-btn-select" title="').h("i18n",r,{},{$key:"select"}).w('"><input type="radio" name="mode" value="select" /><span>').h("i18n",r,{},{$key:"select"}).w('</span></label><label class="tc-ctl-edit-btn-point" title="').h("i18n",r,{},{$key:"newPoint"}).w('"><input type="radio" name="mode" value="addpoint" /><span>').h("i18n",r,{},{$key:"newPoint"}).w('</span></label><label class="tc-ctl-edit-btn-line" title="').h("i18n",r,{},{$key:"newLine"}).w('"><input type="radio" name="mode" value="addline" /><span>').h("i18n",r,{},{$key:"newLine"}).w('</span></label><label class="tc-ctl-edit-btn-polygon" title="').h("i18n",r,{},{$key:"newPolygon"}).w('"><input type="radio" name="mode" value="addpolygon" /><span>').h("i18n",r,{},{$key:"newPolygon"}).w('</span></label></form></div><div class="tc-ctl-edit-select tc-hidden"><button class="tc-ctl-btn tc-ctl-edit-btn-delete" disabled title="').h("i18n",r,{},{$key:"delete"}).w('">').h("i18n",r,{},{$key:"delete"}).w('</button><button class="tc-ctl-btn tc-ctl-edit-btn-join" disabled title="').h("i18n",r,{},{$key:"joinGeometries.tooltip"}).w('">').h("i18n",r,{},{$key:"joinGeometries"}).w('</button><button class="tc-ctl-btn tc-ctl-edit-btn-split" disabled title="').h("i18n",r,{},{$key:"splitGeometry"}).w('">').h("i18n",r,{},{$key:"splitGeometry"}).w('</button><button class="tc-ctl-btn tc-ctl-edit-btn-cancel" disabled title="').h("i18n",r,{},{$key:"cancel"}).w('">').h("i18n",r,{},{$key:"cancel"}).w('</button></div><div class="tc-ctl-edit-point tc-hidden"></div><div class="tc-ctl-edit-line tc-hidden"></div><div class="tc-ctl-edit-polygon tc-hidden"></div><div class="tc-ctl-edit-save"><button class="tc-button tc-icon-button tc-ctl-edit-btn-save" disabled title="').h("i18n",r,{},{$key:"syncChanges"}).w('">').h("i18n",r,{},{$key:"syncChanges"}).w('</button><button class="tc-button tc-icon-button tc-ctl-edit-btn-discard" disabled title="').h("i18n",r,{},{$key:"discardChanges"}).w('">').h("i18n",r,{},{$key:"discardChanges"}).w("</button></div>")}function t(e,t){return e.w('<option value="').f(t.get(["id"],!1),t,"h").w('">').f(t.get(["title"],!1),t,"h").w("</option>")}function n(e,t){return e.w(" checked")}dust.register(m.CLASS,e);e.__dustBody=!0;t.__dustBody=!0;n.__dustBody=!0;return e};m.template[m.CLASS+"-attr"]=function(){function e(e,n){n=n.shiftBlocks(D);return e.w('<div class="tc-ctl-edit-attr"><h3>').h("i18n",n,{},{$key:"attributeEdit"}).w('</h3><div class="tc-ctl-edit-attr-body"><table><tbody>').s(n.get(["data"],!1),n,{block:t},{}).w('</tbody></table></div><div class="tc-ctl-edit-attr-footer"><button class="tc-button tc-ctl-edit-btn-attr-ok">').h("i18n",n,{},{$key:"ok"}).w('</button><button class="tc-button tc-ctl-edit-btn-attr-cancel">').h("i18n",n,{},{$key:"cancel"}).w("</button></div></div>")}function t(e,t){t=t.shiftBlocks(D);return e.w("<tr><th>").f(t.get(["name"],!1),t,"h").w("</th><td>").x(t.get(["readOnly"],!1),t,{"else":n,block:R},{}).w("</td></tr>")}function n(e,t){t=t.shiftBlocks(D);return e.x(t.get(["availableValues"],!1),t,{block:r},{}).h("select",t,{block:a},{key:t.get(["type"],!1)})}function r(e,t){t=t.shiftBlocks(D);return e.w('<select class="tc-combo" name="').f(t.get(["name"],!1),t,"h").w('"><option value=""></option>').s(t.get(["availableValues"],!1),t,{block:i},{}).w("</select>")}function i(e,t){t=t.shiftBlocks(D);return e.w('<option value="').f(t.getPath(!0,[]),t,"h").w('">').f(t.getPath(!0,[]),t,"h").w("</option>")}function a(e,t){t=t.shiftBlocks(D);return e.h("none",t,{block:s},{}).h("eq",t,{block:o},{value:"int"}).h("eq",t,{block:l},{value:"integer"}).h("eq",t,{block:c},{value:"double"}).h("eq",t,{block:u},{value:"boolean"}).h("eq",t,{block:h},{value:"date"}).h("eq",t,{block:p},{value:"time"}).h("eq",t,{block:d},{value:"dateTime"}).h("eq",t,{block:f},{value:"byte"}).h("eq",t,{block:y},{value:"long"}).h("eq",t,{block:g},{value:"negativeInteger"}).h("eq",t,{block:v},{value:"nonNegativeInteger"}).h("eq",t,{block:C},{value:"nonPositiveInteger"}).h("eq",t,{block:L},{value:"positiveInteger"}).h("eq",t,{block:T},{value:"short"}).h("eq",t,{block:w},{value:"unsignedLong"}).h("eq",t,{block:b},{value:"unsignedInt"}).h("eq",t,{block:S},{value:"unsignedShort"}).h("eq",t,{block:E},{value:"unsignedByte"}).h("eq",t,{block:O},{value:"float"}).h("eq",t,{block:A},{value:"decimal"})}function s(e,t){t=t.shiftBlocks(D);return e.b(t.getBlock("inputText"),t,{},{})}function o(e,t){t=t.shiftBlocks(D);return e.b(t.getBlock("inputNumber"),t,{},{})}function l(e,t){t=t.shiftBlocks(D);return e.b(t.getBlock("inputNumber"),t,{},{})}function c(e,t){t=t.shiftBlocks(D);return e.b(t.getBlock("inputNumber"),t,{},{})}function u(e,t){t=t.shiftBlocks(D);return e.b(t.getBlock("inputCheckbox"),t,{},{})}function h(e,t){t=t.shiftBlocks(D);return e.b(t.getBlock("inputDate"),t,{},{})}function p(e,t){t=t.shiftBlocks(D);return e.b(t.getBlock("inputTime"),t,{},{})}function d(e,t){t=t.shiftBlocks(D);return e.b(t.getBlock("inputDatetime"),t,{},{})}function f(e,t){t=t.shiftBlocks(D);return e.b(t.getBlock("inputNumber"),t,{},{})}function y(e,t){t=t.shiftBlocks(D);return e.b(t.getBlock("inputNumber"),t,{},{})}function g(e,t){t=t.shiftBlocks(D);return e.b(t.getBlock("inputNumber"),t,{},{})}function v(e,t){t=t.shiftBlocks(D);return e.b(t.getBlock("inputNumber"),t,{},{})}function C(e,t){t=t.shiftBlocks(D);return e.b(t.getBlock("inputNumber"),t,{},{})}function L(e,t){t=t.shiftBlocks(D);return e.b(t.getBlock("inputNumber"),t,{},{})}function T(e,t){t=t.shiftBlocks(D);return e.b(t.getBlock("inputNumber"),t,{},{})}function w(e,t){t=t.shiftBlocks(D);return e.b(t.getBlock("inputNumber"),t,{},{})}function b(e,t){t=t.shiftBlocks(D);return e.b(t.getBlock("inputNumber"),t,{},{})}function S(e,t){t=t.shiftBlocks(D);return e.b(t.getBlock("inputNumber"),t,{},{})}function E(e,t){t=t.shiftBlocks(D);return e.b(t.getBlock("inputNumber"),t,{},{})}function O(e,t){t=t.shiftBlocks(D);return e.b(t.getBlock("inputNumber"),t,{},{})}function A(e,t){t=t.shiftBlocks(D);return e.b(t.getBlock("inputNumber"),t,{},{})}function x(e,t){t=t.shiftBlocks(D);return e.w('<input type="text" class="tc-textbox" name="').f(t.get(["name"],!1),t,"h").w('" value="').f(t.get(["value"],!1),t,"h").w('" />')}function P(e,t){t=t.shiftBlocks(D);return e.w('<input type="number" class="tc-textbox" name="').f(t.get(["name"],!1),t,"h").w('" value="').f(t.get(["value"],!1),t,"h").w('" />')}function _(e,t){t=t.shiftBlocks(D);return e.w('<input type="checkbox" name="').f(t.get(["name"],!1),t,"h").w('"').x(t.get(["value"],!1),t,{block:N},{}).w("/>")}function N(e,t){t=t.shiftBlocks(D);return e.w(" checked")}function M(e,t){t=t.shiftBlocks(D);return e.w('<input type="date" class="tc-textbox" name="').f(t.get(["name"],!1),t,"h").w('" value="').f(t.get(["value"],!1),t,"h").w('" />')}function k(e,t){t=t.shiftBlocks(D);return e.w('<input type="time" class="tc-textbox" name="').f(t.get(["name"],!1),t,"h").w('" value="').f(t.get(["value"],!1),t,"h").w('" />')}function I(e,t){t=t.shiftBlocks(D);return e.w('<input type="datetime" class="tc-textbox" name="').f(t.get(["name"],!1),t,"h").w('" value="').f(t.get(["value"],!1),t,"h").w('" />')}function R(e,t){t=t.shiftBlocks(D);return e.f(t.get(["value"],!1),t,"h")}dust.register(m.CLASS+"-attr",e);var D={inputText:x,inputNumber:P,inputCheckbox:_,inputDate:M,inputTime:k,inputDatetime:I};e.__dustBody=!0;t.__dustBody=!0;n.__dustBody=!0;r.__dustBody=!0;i.__dustBody=!0;a.__dustBody=!0;s.__dustBody=!0;o.__dustBody=!0;l.__dustBody=!0;c.__dustBody=!0;u.__dustBody=!0;h.__dustBody=!0;p.__dustBody=!0;d.__dustBody=!0;f.__dustBody=!0;y.__dustBody=!0;g.__dustBody=!0;v.__dustBody=!0;C.__dustBody=!0;L.__dustBody=!0;T.__dustBody=!0;w.__dustBody=!0;b.__dustBody=!0;S.__dustBody=!0;E.__dustBody=!0;O.__dustBody=!0;A.__dustBody=!0;x.__dustBody=!0;P.__dustBody=!0;_.__dustBody=!0;N.__dustBody=!0;M.__dustBody=!0;k.__dustBody=!0;I.__dustBody=!0;R.__dustBody=!0;return e}}m.register=function(t){var n=this;TC.control.SWCacheClient.prototype.register.call(n,t);t.addControl("popup",{closeButton:!0}).then(function(e){n.attributeEditor=e});t.on(TC.Consts.event.LAYERUPDATE,function(t){if(t.layer.type===TC.Consts.layerType.WFS&&!t.layer.options.stealth){var r=t.layer,c=n.features[t.layer.id]=n.features[t.layer.id]||{added:[],modified:[],removed:[]};f(n,r).then(function(t){n.layer!==r&&t.setVisibility(!1);var u=a(n,r.id),h=s(n,r.id),p=o(n,r.id),d=l(n,r.id);TC.loadJS(!window.localforage,[TC.Consts.url.LOCALFORAGE],function(){TC.getUID();localforage.keys().then(function(n){if(n)for(var a=0,s=n.length;s>a;a++){var o=n[a];0===o.indexOf(u)&&i(o).then(function(n){var i,a=n.key;if(0===a.indexOf(d)){i=a.substr(d.length);var s=r.getFeatureById(i);r.removeFeature(s);t.addFeature(s);c.removed.push(s)}else if(0===a.indexOf(p)){i=a.substr(p.length);var s=r.getFeatureById(i);if(s){t.addFeature(s);c.modified.push(s);s.wrap.setGeometry(n.feature.geometry);s.setData(n.feature.attributes)}}else if(0===a.indexOf(h)){i=a.substr(h.length);var o=parseInt(i.substr(i.lastIndexOf(".")+1));e=Math.max(e,o+1);var l;switch(n.feature.type){case TC.Consts.geom.POINT:l=r.addPoint(n.feature.geometry);break;case TC.Consts.geom.POLYLINE:l=r.addPolyline(n.feature.geometry);break;case TC.Consts.geom.POLYGON:l=r.addPolygon(n.feature.geometry);break;case TC.Consts.geom.MULTIPOLYLINE:l=r.addMultiPolyline(n.feature.geometry);break;case TC.Consts.geom.MULTIPOLYGON:l=r.addMultiPolygon(n.feature.geometry)}l.then(function(e){t.addFeature(e);c.added.push(e);e.provId=i;e.setData(n.feature.attributes)})}})}})})})}}).on(TC.Consts.event.LAYERADD,function(e){if(e.layer.type===TC.Consts.layerType.WFS&&!e.layer.options.stealth){n.features[e.layer.id]=n.features[e.layer.id]||{added:[],modified:[],removed:[]};$("<option>").attr("value",e.layer.id).html(e.layer.title||e.layer.id).appendTo(n._$layerSelect)}}).on(TC.Consts.event.LAYERREMOVE,function(e){if(e.layer.type===TC.Consts.layerType.WFS&&!e.layer.options.stealth){var t=n._$layerSelect.find("option[value="+e.layer.id+"]");t.filter(":selected").length>0&&n.setLayer(null);t.remove()}}).on(TC.Consts.event.POPUP,function(e){if(e.control===n.attributeEditor){for(var t=e.control.currentFeature,r=n.attributes.slice(),i={},a=n._joinedFeatureAttributes||[],s=0,o=r.length;o>s;s++){var l=t.getData()||{},c=r[s];c.value=l[c.name];"id"===c.name&&(c.readOnly=!0);c.availableValues=[];for(var u=0,h=a.length;h>u;u++){var p=a[u][c.name];void 0!==p&&""!==p&&(c.availableValues[c.availableValues.length]=p)}i[c.name]=c.type}r.sort(function(e,t){return(e.readOnly?!t.readOnly:t.readOnly)?!e.readOnly-!t.readOnly:e.name>t.name?1:e.name<t.name?-1:0});n.getRenderedHtml(n.CLASS+"-attr",{data:r},function(e){var r=n.attributeEditor.$contentDiv;r.html(e);var a=r.find("input"),s=r.find("select");a.on("input",function(e){var t=$(e.target),n=s.filter("[name="+t.attr("name")+"]");n.val()!==t.val()&&n.val("")});s.on("change",function(e){var t=$(e.target);a.filter("[name="+t.attr("name")+"]").val(t.val())});r.find("."+n.CLASS+"-btn-attr-ok").on("click",function(){var e={};a.each(function(t,n){a=$(n);var r=a.attr("name"),s=a.val();switch(i[r]){case"int":case"integer":case"byte":case"long":case"negativeInteger":case"nonNegativeInteger":case"nonPositiveInteger":case"positiveInteger":case"short":case"unsignedLong":case"unsignedInt":case"unsignedShort":case"unsignedByte":s=parseInt(s);Number.isNaN(s)||(e[r]=s);break;case"double":case"float":case"decimal":s=parseFloat(s);Number.isNaN(s)||(e[r]=s);break;case"date":case"time":case"dateTime":e[r]=new Date(s);break;case"boolean":e[r]=!!s;break;case void 0:break;default:e[r]=s}});t.setData(e);n.$events.trigger($.Event(TC.Consts.event.FEATUREMODIFY,{feature:t,layer:n.layer}));n.attributeEditor.hide()});r.find("."+n.CLASS+"-btn-attr-cancel").on("click",function(){n.attributeEditor.hide()})})}});t.loaded(function(){if(n.options.layer)n.setLayer(n.options.layer);else{var e=t.workLayers.filter(function(e){return e.type===TC.Consts.layerType.WFS&&!e.options.stealth});n.setLayer(1===e.length?e[0].id:null)}n.showChanges(n._showsChanges);n.renderPromise().then(function(){var e="draw";$.when.apply(n,[t.addControl(e,{div:n._$div.find("."+n.CLASS+"-point"),mode:TC.Consts.geom.POINT,layer:!1}),t.addControl(e,{div:n._$div.find("."+n.CLASS+"-line"),mode:TC.Consts.geom.POLYLINE,layer:!1}),t.addControl(e,{div:n._$div.find("."+n.CLASS+"-polygon"),mode:TC.Consts.geom.POLYGON,layer:!1})]).then(function(e,t,r){n.pointDraw=e;n.lineDraw=t;n.polygonDraw=r;var i=function(e){var t,r=e.geometry;switch(n.geometryType){case TC.Consts.geom.POINT:t=TC.feature.Point;break;case TC.Consts.geom.POLYLINE:t=TC.feature.Polyline;break;case TC.Consts.geom.POLYGON:t=TC.feature.Polygon;break;case TC.Consts.geom.MULTIPOLYLINE:t=TC.feature.MultiPolyline;break;case TC.Consts.geom.MULTIPOLYGON:t=TC.feature.MultiPolygon}t&&(r=new t(r.geometry,{geometryName:n.layer.options.geometryName}));n.layer.addFeature(r);n.$events.trigger($.Event(TC.Consts.event.FEATUREADD,{feature:r}))},a=function(){n.cancel()};e.on(TC.Consts.event.DRAWEND,i).on(TC.Consts.event.DRAWCANCEL,a);t.on(TC.Consts.event.DRAWEND,i).on(TC.Consts.event.DRAWCANCEL,a);r.on(TC.Consts.event.DRAWEND,i).on(TC.Consts.event.DRAWCANCEL,a);n.options.modes&&$.isArray(n.options.modes)&&1==n.options.modes.length&&n.setMode(n.options.modes[0],null)})})})};m.render=function(e){var t=this,n=[];if(t.map)for(var r=0,i=t.map.workLayers.length;i>r;r++){var a=t.map.workLayers[r];a.type!==TC.Consts.layerType.WFS||a.options.stealth||n.push({id:a.id,title:a.title||a.id})}TC.Control.prototype.renderData.call(t,{layers:n,showChanges:t.showChanges},function(){t._$layerDiv=t._$div.find(t._classSelector+"-layer");t._$layerSelect=t._$layerDiv.find(t._classSelector+"-layer-sel").on("change",function(e){t.setLayer(t._$layerSelect.val())});t._$layerDiv.find("#"+t.CLASS+"-view-changes-cb").on("change",function(e){t.showChanges($(e.target).prop("checked"))});t._$cancelBtn=t._$div.find(t._classSelector+"-btn-cancel").on("click",function(){t.cancel()});t._$deleteBtn=t._$div.find(t._classSelector+"-btn-delete").on("click",function(){TC.confirm(t.eraseActionConfirmTxt,function(){t.deleteFeatures(t.getSelectedFeatures())})});t._$joinBtn=t._$div.find(t._classSelector+"-btn-join").on("click",function(){t.joinFeatures(t.getSelectedFeatures())});t._$splitBtn=t._$div.find(t._classSelector+"-btn-split").on("click",function(){t.splitFeatures(t.getSelectedFeatures())});t._$saveBtn=t._$div.find(t._classSelector+"-btn-save").on("click",function(){t.applyEdits()});t._$discardBtn=t._$div.find(t._classSelector+"-btn-discard").on("click",function(){t.discardEdits()});if(t.options.modes&&$.isArray(t.options.modes)&&t.options.modes.length>0){for(var n in TC.Consts.editMode)if("string"==typeof n&&t.options.modes.indexOf(TC.Consts.editMode[n])<0){$("label"+t._classSelector+"-btn-"+TC.Consts.editMode[n],t._$div).remove();$("div"+t._classSelector+"-"+TC.Consts.editMode[n],t._$div).remove()}if(1==t.options.modes.length){var r=t.options.modes[0];$("label"+t._classSelector+"-btn-"+r,t._$div).css("display","none")}}t._$div.find("input[type=radio][name=mode]").on("change",function(){var e=$(this),n=e.val(),r=t.mode===n?void 0:n;t.setMode(r)});$.isFunction(e)&&e()})};m.setLayer=function(e){var t=this;t.layer=map.getLayer(e);t.setMode(null);var n="input[type=radio][name=mode]";if(t.layer){f(t,t.layer).then(function(e){for(var n in t._changesLayers){var r=t._changesLayers[n];r.setVisibility(t._showsChanges&&r===e)}});t.layer.describeFeatureType().then(function(e){t.attributes=e.filter(function(e){switch(e.type){case"gml:LinearRingPropertyType":case"gml:PolygonPropertyType":t.geometryType=TC.Consts.geom.POLYGON;return!1;case"gml:MultiPolygonPropertyType":case"gml:MultiSurfacePropertyType":t.geometryType=TC.Consts.geom.MULTIPOLYGON;return!1;case"gml:LineStringPropertyType":t.geometryType=TC.Consts.geom.POLYLINE;return!1;case"gml:MultiLineStringPropertyType":t.geometryType=TC.Consts.geom.MULTIPOLYLINE;return!1;case"gml:PointPropertyType":case"gml:MultiPointPropertyType":t.geometryType=TC.Consts.geom.POINT;return!1;case"gml:BoxPropertyType":t.geometryType=TC.Consts.geom.RECTANGLE;return!1;case"gml:GeometryCollectionPropertyType":case"gml:GeometryAssociationType":return!1;default:return!0}});for(var r=0,i=t.attributes.length;i>r;r++){var a=t.attributes[r];a.type=a.type.substr(a.type.indexOf(":")+1)}t.renderPromise().then(function(){d(t);t._$div.find(t._classSelector+"-layer-sel").val(t.layer.id);$rb=t._$div.find(n);var e;switch(t.geometryType){case TC.Consts.geom.POINT:e="[value=select],[value="+TC.Consts.editMode.ADDPOINT+"]";break;case TC.Consts.geom.POLYLINE:case TC.Consts.geom.MULTIPOLYLINE:e="[value=select],[value="+TC.Consts.editMode.ADDLINE+"]";break;case TC.Consts.geom.POLYGON:case TC.Consts.geom.MULTIPOLYGON:e="[value=select],[value="+TC.Consts.editMode.ADDPOLYGON+"]";break;default:e="[value]"}var r=$rb.filter(e).attr("disabled",!1);$rb.not(r).attr("disabled",!0)})});t._layerDeferred.resolve(t.layer)}else{t.renderPromise().then(function(){d(t,!1);$rb=t._$div.find(n).attr("disabled",!0);$rb.each(function(e,t){$(t).prop("checked",!1)})});t._layerDeferred.resolve(null)}};m.setMode=function(e){var t=this;t.mode=e;c(t);var n,r,i=function(e){if(e){t.snapping&&(e.snapping=t.layer);e.activate()}};switch(e){case TC.Consts.editMode.SELECT:n=t._$div.find(t._classSelector+"-select");r=t._$div.find(t._classSelector+"-point,"+t._classSelector+"-line,"+t._classSelector+"-polygon");t.activate();break;case TC.Consts.editMode.ADDPOINT:n=t._$div.find(t._classSelector+"-point");r=t._$div.find(t._classSelector+"-select,"+t._classSelector+"-line,"+t._classSelector+"-polygon");i(t.pointDraw);break;case TC.Consts.editMode.ADDLINE:n=t._$div.find(t._classSelector+"-line");r=t._$div.find(t._classSelector+"-select,"+t._classSelector+"-point,"+t._classSelector+"-polygon");i(t.lineDraw);break;case TC.Consts.editMode.ADDPOLYGON:n=t._$div.find(t._classSelector+"-polygon");r=t._$div.find(t._classSelector+"-select,"+t._classSelector+"-point,"+t._classSelector+"-line");i(t.polygonDraw);

break;default:n=$();r=t._$div.find(t._classSelector+"-select,"+t._classSelector+"-point,"+t._classSelector+"-line,"+t._classSelector+"-polygon");t.isActive&&t.deactivate();t.pointDraw&&t.pointDraw.isActive&&t.pointDraw.deactivate();t.lineDraw&&t.lineDraw.isActive&&t.lineDraw.deactivate();t.polygonDraw&&t.polygonDraw.isActive&&t.polygonDraw.deactivate()}var a;if(e){a=t._$div.find("input[type=radio][name=mode][value="+e+"]").prop("checked",!0).addClass(TC.Consts.classes.CHECKED);a.next().addClass(TC.Consts.classes.CHECKED)}else{a=t._$div.find("input[type=radio][name=mode]").prop("checked",!1).removeClass(TC.Consts.classes.CHECKED);a.next().removeClass(TC.Consts.classes.CHECKED)}n.removeClass(TC.Consts.classes.HIDDEN);r.addClass(TC.Consts.classes.HIDDEN)};m.showChanges=function(e){var t=this;t._showsChanges=e;for(var n in t._changesLayers){var r=t._changesLayers[n];r.setVisibility(e&&t.layer&&n===t.layer.id)}};m.cancel=function(){var e=this;e.options.modes&&$.isArray(e.options.modes)&&1==e.options.modes.length?e.setMode(e.options.modes[0],null):e.setMode(null,!1);e.wrap.cancel(!0,e.cancelActionConfirmTxt)};m.onFeatureClick=function(e){self.activeControl&&self.activeControl.isExclusive()||e.feature.show()};m.activate=function(e){var t=this;TC.Control.prototype.activate.call(t);var n=e||{};t._$cancelBtn.prop("disabled",!1);$.when(t.getLayer()).then(function(){t.wrap.activate(n.mode?n.mode:t.mode);TC.Control.prototype.activate.call(t)})};m.deactivate=function(){var e=this;TC.Control.prototype.deactivate.call(e);e.wrap.cancel(!0);e._$cancelBtn.prop("disabled",!0);e.wrap.deactivate()};m.isExclusive=function(){return!0};m.joinFeatures=function(e){var t=this;if(t.geometryType===TC.Consts.geom.MULTIPOLYLINE||t.geometryType===TC.Consts.geom.MULTIPOLYGON||t.geometryType===TC.Consts.geom.MULTIPOINT){t._joinedFeatureAttributes=[];if(e.length>1){for(var n=e.map(function(e){t._joinedFeatureAttributes[t._joinedFeatureAttributes.length]=e.getData();return e.geometry}),r=n.reduce(function(e,t){return e.concat(t)}),i=new e[0].constructor(r),a=0,s=e.length;s>a;a++){var o=e[a];t.layer.removeFeature(o);t.$events.trigger($.Event(TC.Consts.event.FEATUREREMOVE,{feature:o}))}t.layer.addFeature(i).then(function(e){t.setSelectedFeatures([i]);t.$events.trigger($.Event(TC.Consts.event.FEATUREADD,{feature:e}));e.showPopup(t.attributeEditor)})}h(t,[i])}};m.splitFeatures=function(e){for(var t=this,n=e.filter(u),r=n.map(function(e){return e.geometry}),i=[],a=0,s=n.length;s>a;a++)for(var o=n[a],l=o.getData(),c=r[a],p=0,d=c.length;d>p;p++)i[i.length]=new o.constructor([c[p]],{data:l});for(var a=0,f=n.length;f>a;a++){var o=n[a];t.layer.removeFeature(o);t.$events.trigger($.Event(TC.Consts.event.FEATUREREMOVE,{feature:o}))}for(var m=new Array(i.length),a=0,f=i.length;f>a;a++){var y=m[a]=t.layer.addFeature(i[a]);y.then(function(e){t.$events.trigger($.Event(TC.Consts.event.FEATUREADD,{feature:e}))})}$.when.apply(this,m).then(function(){t.setSelectedFeatures(i)});h(t,i)};m.deleteFeatures=function(e){var t=this;t.wrap.deleteFeatures(e);0===t.layer.features.length&&t._$deleteBtn.prop("disabled",!0)};m.applyEdits=function(){var e=this;if(e.layer){var t=e.features[e.layer.id];e.layer.applyEdits(t.added,t.modified,t.removed).then(function(){e.discardEdits();e.map.toast("Cambios sincronizados con \xe9xito con el servidor")},function(e){TC.error("Error ["+e.code+"] al guardar cambios: "+e.reason)})}};m.discardEdits=function(){var e=this;e._joinedFeatureAttributes=[];var t=a(e);TC.loadJS(!window.localforage,[TC.Consts.url.LOCALFORAGE],function(){localforage.keys().then(function(n){if(n){for(var r=0,i=n.length;i>r;r++){var a=n[r];0===a.indexOf(t)&&localforage.removeItem(a)}if(e.layer){var s=e.features[e.layer.id];s.added.length=0;s.modified.length=0;s.removed.length=0;e.setSelectedFeatures([]);e.attributeEditor.hide();var o=e._changesLayers[e.layer.id];o.clearFeatures();e.deleteCache(t).then(function(){e.layer.refresh()})}d(e,!1)}})})};m.getSelectedFeatures=function(){return this.wrap.getSelectedFeatures()};m.setSelectedFeatures=function(e){return this.wrap.setSelectedFeatures(e)};m.getLayer=function(){var e=this;return e.layer||e._layerDeferred};m.getChangesLayerStyle=function(e){var t=function(t){for(var n,r=e.wrap.getRGBA(t),i=0;3>i;i++)r[i]=255-r[i];n=(65536*r[0]+256*r[1]+r[2]).toString(16);4===n.length?n="00"+n:5===n.length&&(n="0"+n);return"#"+n},n=[1,3],r=$.extend(!0,{},e.options.styles);if(r.point){r.point.strokeColor=t(r.point.strokeColor);r.point.lineDash=n}if(r.line){r.line.strokeColor=t(r.line.strokeColor);r.line.lineDash=n}if(r.polygon){r.polygon.strokeColor=t(r.polygon.strokeColor);r.polygon.lineDash=n}return r}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control.js");TC.control.ExternalWMS=function(e){if(TC.isLegacy)console.warn("El control ExternalWMS no soporta modo legacy");else{var t=this;this.count=0;this._addedUrls=[];TC.Control.apply(t,arguments)}};TC.inherit(TC.control.ExternalWMS,TC.Control);!function(){var e=TC.control.ExternalWMS.prototype;e.CLASS="tc-ctl-xwms";e.markServicesAsSelected=function(e){if(e.length>0){var t=$(e[0]);t.attr("disabled","true");t.addClass("tc-ctl-xwms-option-selected")}};e.register=function(e){if(TC.isLegacy)console.warn("El control ExternalWMS no soporta modo legacy");else{var t=this;TC.Control.prototype.register.call(t,e);t._$div.on("change","select",function(e){if(""!=this.value){var n=this.value;0===n.indexOf("//")&&(n=location.protocol+n);t._$div.find("input").val(n);$(this).val("")}});var n=function(e){for(var t=["version","service","request"],n=0;n<t.length;n++)e=TC.Util.removeURLParameter(e,t[n]);e.match(/\?$/)&&(e=e.substr(0,e.length-1));return e};t._$div.on("click","button[name='agregar']",function(e){var r=t._$div.find("input").val();if(r)if(/^((https?|ftp):)?(\/\/)?(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(r))if(t._addedUrls.indexOf(r)>-1)TC.alert(t.getLocaleString("serviceAlreadyAdded"));else{r=n(r);var i=t.map.getControlsByClass("TC.control.LoadingIndicator")[0];i.show();var a=t._$div.find("button");a.attr("disabled","true");var s={id:"xwms"+ ++t.count,type:"WMS",url:r,hideTree:!1},o=new TC.layer.Raster(s);o.getCapabilitiesPromise().then(function(e){if("undefined"!=typeof e.Capability){var n=e.Capability.Layer;if(n.CRS&&-1==n.CRS.indexOf(t.map.crs)){TC.alert(t.getLocaleString("serviceSrsNotCompatible"));i.hide();a.removeAttr("disabled")}else{t.map.$events.trigger($.Event(TC.Consts.event.EXTERNALSERVICEADDED,{layer:o}));t._$div.find("input").val("");var s=t._$div.find("select option[value='"+r+"']");t.markServicesAsSelected(s);t._addedUrls.push(r);i.hide();a.removeAttr("disabled")}}else{TC.alert(t.getLocaleString("noLayersFoundInService"));i.hide();a.removeAttr("disabled")}},function(e){TC.alert(t.getLocaleString("serviceCouldNotBeLoaded")+":\n"+e);i.hide();a.removeAttr("disabled")})}else TC.alert(t.getLocaleString("typeAValidAddress"));else TC.alert(t.getLocaleString("typeAnAddress"))});e.on(TC.Consts.event.LAYERADD,function(e){var n=e.layer.url,r=t._$div.find("select option").filter(function(e,t){return TC.Util.addProtocol(t.value)===TC.Util.addProtocol(n)});t.markServicesAsSelected(r);t._addedUrls.push(n)})}};e.template={};e.template[e.CLASS]=TC.isDebug?TC.apiLocation+"TC/templates/ExternalWMS.html":function(){function t(e,t){return e.x(t.get(["title"],!1),t,{block:n},{}).w('<div><div class="tc-group tc-ctl-xwms-cnt"> <select id="add-wms-select" class="tc-combo" title="WMS (Web Map Service)"><option value="">WMS</option>').s(t.get(["suggestions"],!1),t,{block:r},{}).w('</select><input type="text" class="tc-textbox" placeholder="').h("i18n",t,{},{$key:"writeAddressOrSelect"}).w('" /></div><div class="tc-group tc-group tc-ctl-xwms-cnt" style="text-align:right;"><button type="button" class="tc-button tc-icon-button" title="').h("i18n",t,{},{$key:"addService.title"}).w('" name="agregar">').h("i18n",t,{},{$key:"addService"}).w("</button></div></div>")}function n(e,t){return e.w("<h2>").h("i18n",t,{},{$key:"addMaps"}).w("</h2>")}function r(e,t){return e.w('<optgroup label="').f(t.get(["group"],!1),t,"h").w('">').s(t.get(["items"],!1),t,{block:i},{}).w("</optgroup>")}function i(e,t){return e.w('<option value="').f(t.get(["url"],!1),t,"h").w('">').f(t.get(["name"],!1),t,"h").w("</option>")}dust.register(e.CLASS,t);t.__dustBody=!0;n.__dustBody=!0;r.__dustBody=!0;i.__dustBody=!0;return t};e.render=function(e){var t=this;t.renderData(t.options)}}();TC.control=TC.control||{};TC.control.FeatureInfoCommons||TC.syncLoadJS(TC.apiLocation+"TC/control/FeatureInfoCommons.js");!function(){TC.control.FeatureInfo=function(){var e=this;TC.control.FeatureInfoCommons.apply(this,arguments);e.wrap=new TC.wrap.control.FeatureInfo(e);TC.Consts.classes.FROMLEFT="tc-fromleft";TC.Consts.classes.FROMRIGHT="tc-fromright";e.callback=function(t,n){for(var r=!1,i=0;i<e.map.workLayers.length;i++){var a=e.map.workLayers[i];if(a.type===TC.Consts.layerType.WMS&&a.getVisibility()&&a.names.length>0){r=!0;break}}r?e.wrap.getFeatureInfo(n):e.map.$events.trigger($.Event(TC.Consts.event.NOFEATUREINFO,{xy:n,control:e}))};e.layer=null;e.marker=null;e.info=null;e.popup=null;e.lastFeatureCount=null};TC.inherit(TC.control.FeatureInfo,TC.control.FeatureInfoCommons);var e=TC.control.FeatureInfo.prototype;e.CLASS="tc-ctl-finfo";e.FEATURE_PARAM="showfeature";var t=TC.apiLocation+"lib/jshash/md5-min.js";e.template={};if(TC.isDebug){e.template[e.CLASS]=TC.apiLocation+"TC/templates/FeatureInfo.html";e.template[e.CLASS+"-dialog"]=TC.apiLocation+"TC/templates/FeatureInfoDialog.html";e.template[e.CLASS+"-del-btn"]=TC.apiLocation+"TC/templates/FeatureInfoDeleteButton.html"}else{e.template[e.CLASS]=function(){function t(e,t){return e.w('<ul class="tc-ctl-finfo-services">').s(t.get(["services"],!1),t,{"else":n,block:r},{}).w("</ul>").x(t.get(["featureCount"],!1),t,{block:O},{})}function n(e,t){return e.w('<li class="tc-ctl-finfo-empty">').h("i18n",t,{},{$key:"noData"}).w("</li>")}function r(e,t){return e.w("<li><h3>").x(t.getPath(!1,["mapLayer","title"]),t,{"else":i,block:a},{}).w('</h3><div class="tc-ctl-finfo-service-content">').s(t.get(["hasLimits"],!1),t,{"else":s,block:E},{}).w("</div></li>")}function i(e,t){return e.f(t.getPath(!1,["mapLayer","id"]),t,"h")}function a(e,t){return e.f(t.getPath(!1,["mapLayer","title"]),t,"h")}function s(e,t){return e.w('<ul class="tc-ctl-finfo-layers">').s(t.get(["layers"],!1),t,{"else":o,block:l},{}).w("</ul>")}function o(e,t){return e.w('<li class="tc-ctl-finfo-empty">').h("i18n",t,{},{$key:"noDataAtThisService"}).w("</li>")}function l(e,t){return e.w("<li><h4>").s(t.get(["path"],!1),t,{block:c},{}).w(' <span class="tc-ctl-finfo-layer-n">').f(t.getPath(!1,["features","length"]),t,"h").w('</span> </h4> <div class="tc-ctl-finfo-layer-content"><ul class="tc-ctl-finfo-features">').s(t.get(["features"],!1),t,{"else":h,block:p},{}).w("</ul></div></li>")}function c(e,t){return e.f(t.getPath(!0,[]),t,"h").h("sep",t,{block:u},{})}function u(e,t){return e.w(" &bull; ")}function h(e,t){return e.w('<li class="tc-ctl-finfo-empty">').h("i18n",t,{},{$key:"noDataInThisLayer"}).w("</li>")}function p(e,t){return e.w("<li>").x(t.get(["rawContent"],!1),t,{"else":d,block:C},{}).w("</li>")}function d(e,t){return e.x(t.get(["error"],!1),t,{"else":f,block:v},{})}function f(e,t){return e.w("<h5>").f(t.get(["id"],!1),t,"h").w("</h5><table").x(t.get(["geometry"],!1),t,{block:m},{}).w("><tbody>").s(t.get(["attributes"],!1),t,{block:y},{}).w("</tbody></table>").x(t.get(["geometry"],!1),t,{block:g},{})}function m(e,t){return e.w(' title="').h("i18n",t,{},{$key:"clickToCenter"}).w('"')}function y(e,t){return e.w('<tr><th class="tc-ctl-finfo-attr">').f(t.get(["name"],!1),t,"h").w('</th><td class="tc-ctl-finfo-val">').f(t.get(["value"],!1),t,"h").w("</td></tr>")}function g(e,t){return e.w('<div class="tc-ctl-finfo-tools"><button class="tc-ctl-finfo-tools-btn" title="').h("i18n",t,{},{$key:"tools"}).w('">').h("i18n",t,{},{$key:"tools"}).w("</button></div>")}function v(e,t){return e.w('<span class="tc-ctl-finfo-errors">').h("i18n",t,{},{$key:"fi.error"}).w('<span class="tc-ctl-finfo-error-text">').f(t.get(["error"],!1),t,"h").w("</span></span>")}function C(e,t){return e.w("<h5>").h("i18n",t,{},{$key:"feature"}).w("</h5>").h("eq",t,{"else":L,block:T},{key:t.get(["rawFormat"],!1),value:"text/html"})}function L(e,t){return e.w("<pre>").f(t.get(["rawContent"],!1),t,"h").w("</pre>")}function T(e,t){return e.w(" ").x(t.get(["expandUrl"],!1),t,{block:w},{})}function w(e,t){return e.h("ne",t,{"else":b,block:S},{key:t.get(["expandUrl"],!1),value:""})}function b(e,t){return e.w('<iframe src="').f(t.get(["rawUrl"],!1),t,"h").w('" />')}function S(e,t){return e.w('<div class="tc-ctl-finfo-features-iframe-cnt"><iframe src="').f(t.get(["rawUrl"],!1),t,"h").w('" /><a class="tc-ctl-finfo-open" onclick="window.open(\'').f(t.get(["expandUrl"],!1),t,"h").w("', '_blank')\" title=\"").h("i18n",t,{},{$key:"expand"}).w('"></a></div>')}function E(e,t){return e.w('<span class="tc-ctl-finfo-errors">').f(t.get(["hasLimits"],!1),t,"h").w("</span>")}function O(e,t){return e.h("gt",t,{block:A},{key:t.get(["featureCount"],!1),value:"1",type:"number"})}function A(e,t){return e.w('<a class="tc-ctl-btn tc-ctl-finfo-btn-prev">').h("i18n",t,{},{$key:"previous"}).w('</a><div class="tc-ctl-finfo-counter"><span class="tc-ctl-finfo-idx"></span>/').f(t.get(["featureCount"],!1),t,"h").w('</div><a class="tc-ctl-btn tc-ctl-finfo-btn-next">').h("i18n",t,{},{$key:"next"}).w("</a>")}dust.register(e.CLASS,t);t.__dustBody=!0;n.__dustBody=!0;r.__dustBody=!0;i.__dustBody=!0;a.__dustBody=!0;s.__dustBody=!0;o.__dustBody=!0;l.__dustBody=!0;c.__dustBody=!0;u.__dustBody=!0;h.__dustBody=!0;p.__dustBody=!0;d.__dustBody=!0;f.__dustBody=!0;m.__dustBody=!0;y.__dustBody=!0;g.__dustBody=!0;v.__dustBody=!0;C.__dustBody=!0;L.__dustBody=!0;T.__dustBody=!0;w.__dustBody=!0;b.__dustBody=!0;S.__dustBody=!0;E.__dustBody=!0;O.__dustBody=!0;A.__dustBody=!0;return t};e.template[e.CLASS+"-dialog"]=function(){function t(e,t){return e.w('<div class="tc-ctl-finfo-dialog tc-modal"><div class="tc-modal-background tc-modal-close"></div><div class="tc-modal-window"><div class="tc-modal-header"><h3>').h("i18n",t,{},{$key:"feature"}).w('</h3><div class="tc-ctl-popup-close tc-modal-close"></div></div><div class="tc-modal-body"><div class="tc-ctl-finfo-dialog-dl"><h2>').h("i18n",t,{},{$key:"download"}).w('</h2><div><button class="tc-button tc-ctl-finfo-dl-btn-kml" data-format="KML" title="KML">KML</button><button class="tc-button tc-ctl-finfo-dl-btn-gml" data-format="GML" title="GML">GML</button><button class="tc-button tc-ctl-finfo-dl-btn-geojson" data-format="GeoJSON" title="GeoJSON">GeoJSON</button><button class="tc-button tc-ctl-finfo-dl-btn-wkt" data-format="WKT" title="WKT">WKT</button></div></div><div class="tc-ctl-finfo-dialog-share"></div></div></div></div>')}dust.register(e.CLASS+"-dialog",t);t.__dustBody=!0;return t};e.template[e.CLASS+"-del-btn"]=function(){function t(e,t){return e.w('<button class="tc-ctl-finfo-del-btn" title="').h("i18n",t,{},{$key:"deleteFeature"}).w('">').h("i18n",t,{},{$key:"deleteFeature"}).w("</button>")}dust.register(e.CLASS+"-del-btn",t);t.__dustBody=!0;return t}}var n=function(e,n){e.sharedFeatureInfo=n;TC.loadJS(!window.hex_md5,[t],function(){var t=e.map.options.pixelTolerance||TC.Cfg.pixelTolerance,r=2*t+1,i=[t,t],a=r*n.r/2,s=[n.xy[0]-a,n.xy[1]-a,n.xy[0]+a,n.xy[1]+a];e.beforeGetFeatureInfo({xy:i,control:e});e.wrap.getFeatureInfo(i,{serviceUrl:n.s,layerName:n.l,featureId:n.f,mapSize:[r,r],boundingBox:s})})};e.register=function(e){var t=this;TC.control.Click.prototype.register.call(t,e);t._$div.appendTo("<div>");_layer=t.options.layer?t.options.layer:{id:TC.getUID(),type:TC.Consts.layerType.VECTOR,stealth:!0};e.loaded(function(){$.when(e.addLayer(_layer)).then(function(e){t.layer=e;var r=TC.Util.getParameterByName(t.FEATURE_PARAM);if(r){var i;try{i=JSON.parse(decodeURIComponent(escape(window.atob(r))))}catch(a){}i&&n(t,i)}})});$.when(e.addControl("popup",{closeButton:!0,draggable:t.options.draggable})).then(function(n){t.popup=n;e.on(TC.Consts.event.POPUP,function(e){t.onShowPopUp(e);t.popup.$popupDiv.on(TC.Consts.event.CLICK,"."+t.CLASS+"-tools-btn",function(e){t._shareCtl||t.map.addControl("share",{div:t._$dialogDiv.find(".tc-modal-body .tc-ctl-finfo-dialog-share")}).then(function(e){t._shareCtl=e})})});e.on(TC.Consts.event.POPUPHIDE,function(e){e.control===n&&t.popup.$popupDiv.css("width","auto")})});e.on(TC.Consts.event.BEFOREFEATUREINFO,function(e){t.beforeGetFeatureInfo(e)});e.on(TC.Consts.event.FEATUREINFO,function(e){if(t.isActive){t.lastFeatureCount=t.countFeatures(e);t.responseCallback(e)}});e.$events.on(TC.Consts.event.NOFEATUREINFO,function(e){t.lastFeatureCount=0;t.popup&&t.popup.hide()});TC.loadJS(!TC.Consts.event.POPUPHIDE,[TC.apiLocation+"TC/control/Popup.js"],function(){e.$events.on(TC.Consts.event.POPUPHIDE,function(e){t.popup===e.control&&t.layer&&t.layer.clearFeatures()})})};e.onShowModal=function(){var e=this,n=e.popup.$popupDiv.find("ul."+e.CLASS+"-features li."+TC.Consts.classes.CHECKED),r=e._shareCtl;r.extraParams=null;var i=n.parents("li").first(),a=i.parents("li").first(),s=e.info.services[a.index()];if(s){var o=s.layers[i.index()];if(o){var l=o.features[n.index()];TC.loadJS(!window.hex_md5,[t],function(){var t=hex_md5(JSON.stringify({data:l.getData(),geometry:l.geometry}));r.extraParams={};r.extraParams[e.FEATURE_PARAM]=window.btoa(unescape(encodeURIComponent(JSON.stringify({xy:l.wrap.getInnerPoint(),r:e.map.getResolution(),s:s.mapLayer.url,l:o.name,f:l.id,h:t}))));var n=r._$div;n.find(".tc-url input[type=text]").val(r.generateLink());n.find(".tc-iframe input[type=text]").val(r.generateIframe())})}}};e.responseCallback=function(e){var t=this;if(t.marker){var n=e.services;t.info={services:n,defaultFeature:e.defaultFeature};for(var r=0;r<n.length;r++){for(var i=n[r],a=0;a<i.layers.length;a++)if(!i.layers[a].features.length){i.layers.splice(a,1);a-=1}if(!i.layers.length){n.splice(r,1);r-=1}}n.length?t.renderData(e,function(){t._$div.find("td."+t.CLASS+"-val").each(function(e,n){var r=$(n),i=r.text();TC.Util.isURL(i)&&r.html('<a href="'+i+'" target="_blank" title="'+t.getLocaleString("linkInNewWindow")+'">'+i+"</a>")});if(t.sharedFeatureInfo){t._$div.find("ul."+t.CLASS+"-services li").addClass(TC.Consts.classes.CHECKED);for(var e,n=t.sharedFeatureInfo,r=0,i=t.info.services.length;i>r;r++){var a=t.info.services[r];if(a.mapLayer.url===n.s){for(var s=0,o=a.layers.length;o>s;s++){var l=a.layers[s];if(l.name===n.l){for(var c=0,u=l.features.length;u>c;c++){var h=l.features[c];if(h.id===n.f){e=h;var p=hex_md5(JSON.stringify({data:h.getData(),geometry:h.geometry}));n.h!==p&&TC.alert(t.getLocaleString("finfo.featureChanged.warning"));break}}break}}break}}e&&t.map.addControl(new TC.control.Popup({div:TC.Util.getDiv(),closeButton:!0})).then(function(n){e.data=t._$div.html();n.$popupDiv.addClass(t.CLASS+"-lite");t.getLocaleString("deleteFeature");t.getRenderedHtml(t.CLASS+"-del-btn",null,function(e){n.$popupDiv.append(e);n.$popupDiv.find("."+t.CLASS+"-del-btn").on(TC.Consts.event.CLICK,function(e){TC.confirm(t.getLocaleString("deleteFeature.confirm"),function(){t.map.removeLayer(t.sharedFeatureLayer);delete t.sharedFeatureLayer})})});e.showsPopup=!0;e.popup=n;t.map.addLayer({id:TC.getUID(),type:TC.Consts.layerType.VECTOR,title:t.getLocaleString("foi")}).then(function(n){t.sharedFeatureLayer=n;t.layer.clearFeatures();n.addFeature(e);t.map.zoomToFeatures([e])})});delete t.sharedFeatureInfo}else if(t.popup){t.marker.data=$("<div>").append(t._$div.clone()).html();t.marker.showPopup(t.popup)}}):t.layer.clearFeatures()}}}();TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control.js");TC.control.FileImport=function(){var e=this;TC.Control.apply(e,arguments);e.formats=$.isArray(e.options.formats)?e.options.formats:[TC.Consts.format.KML,TC.Consts.format.GML,TC.Consts.format.GML2,TC.Consts.format.GEOJSON,TC.Consts.format.WKT,TC.Consts.format.GPX];e.apiAttribution="";e.mainDataAttribution="";e.dataAttributions=[]};TC.inherit(TC.control.FileImport,TC.Control);!function(){var e=TC.control.FileImport.prototype;e.CLASS="tc-ctl-file";e.template=TC.isDebug?TC.apiLocation+"TC/templates/FileImport.html":function(){function t(e,t){return e.w("<h2>").h("i18n",t,{},{$key:"openFile"}).w("</h2><div><p>").h("i18n",t,{},{$key:"fileImport.instructions"}).w('</p><div class="tc-ctl-file-open"><label class="tc-button tc-ctl-file-open-label tc-icon-button"><input type="file" class="tc-ctl-file-open-ipt tc-button" accept="').s(t.get(["formats"],!1),t,{block:n},{}).w('" />').h("i18n",t,{},{$key:"openFile"}).w("</label></div></div>")}function n(e,t){return e.w(".").f(t.getPath(!0,[]),t,"h").h("sep",t,{block:r},{})}function r(e,t){return e.w(",")}dust.register(e.CLASS,t);t.__dustBody=!0;n.__dustBody=!0;r.__dustBody=!0;return t};e.register=function(e){var t=this;TC.Control.prototype.register.call(t,e);t.options.enableDragAndDrop&&e.wrap.enableDragAndDrop(t.options);e.on(TC.Consts.event.FEATURESIMPORT,function(t){var n="."+TC.Consts.format.GPX.toLowerCase();t.fileName.toLowerCase().indexOf(n)!==t.fileName.length-n.length&&e.addLayer({id:TC.getUID(),title:t.fileName,type:TC.Consts.layerType.VECTOR}).then(function(n){for(var r=0,i=t.features.length;i>r;r++)n.addFeature(t.features[r]);setTimeout(function(){e.zoomToFeatures(n.features)},100)})})};e.render=function(){var e=this;e.renderData({formats:e.formats},function(){e._$div.find("input[type=file]").on("change",function(t){e.map&&e.map.wrap.loadFiles(t.target.files)})})}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control.js");TC.control.FullScreen=function(){var e=this;TC.Control.apply(e,arguments);e.fullScreenElement=document.documentElement};TC.inherit(TC.control.FullScreen,TC.Control);!function(){var e=TC.control.FullScreen.prototype;e.CLASS="tc-ctl-fscreen";e.template=TC.isDebug?TC.apiLocation+"TC/templates/FullScreen.html":function(){function t(e,t){return e.w('<button class="tc-ctl-fscreen-btn" title="').h("i18n",t,{},{$key:"fscreen.tip"}).w('"></button>')}dust.register(e.CLASS,t);t.__dustBody=!0;return t};e.register=function(e){var t=this;TC.Control.prototype.register.call(t,e);t.renderPromise().then(function(){var e=t._$div.find("."+t.CLASS+"-btn");if(t.enabledFullScreen()){e.on("click",function(){t.toggleFullScreen()});$(document).on("fullscreenchange mozfullscreenchange webkitfullscreenchange MSFullscreenChange",function(){e.toggleClass(TC.Consts.classes.ACTIVE,t.isFullScreen());e.attr("title",t.getLocaleString(t.isFullScreen()?"fscreen.tip.return":"fscreen.tip"))})}else e.addClass(TC.Consts.classes.HIDDEN)})};e.requestFullScreen=function(){var e=this,t=e.fullScreenElement;document.documentElement.requestFullScreen?t.requestFullScreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullScreen?t.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT):t.msRequestFullscreen&&t.msRequestFullscreen()};e.cancelFullScreen=function(){document.cancelFullScreen?document.cancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen()};e.isFullScreen=function(){return document.fullScreenElement||document.mozFullScreen||document.webkitIsFullScreen||document.msFullscreenElement};e.toggleFullScreen=function(){var e=this;e.isFullScreen()?e.cancelFullScreen():e.requestFullScreen()};e.enabledFullScreen=function(){var e=this,t=e.fullScreenElement,n=document.documentElement.requestFullScreen||t.mozRequestFullScreen||t.webkitRequestFullScreen||t.msRequestFullscreen;return n&&"function"==typeof n}}();!function(){Math.hypot=Math.hypot||function(){for(var e=0,t=arguments.length,n=0;t>n;n++){if(arguments[n]===1/0||arguments[n]===-(1/0))return 1/0;e+=arguments[n]*arguments[n]}return Math.sqrt(e)}}();!function(){for(var e=0,t=["ms","moz","webkit","o"],n=!(!window.performance||!window.performance.now),r=0,i=t.length;i>r&&!window.requestAnimationFrame;r+=1){window.requestAnimationFrame=window[t[r]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[t[r]+"CancelAnimationFrame"]||window[t[r]+"CancelRequestAnimationFrame"]}window.requestAnimationFrame||(window.requestAnimationFrame=function(t,n){var r=(new Date).getTime(),i=Math.max(0,16-(r-e)),a=window.setTimeout(function(){t(r+i)},i);e=r+i;return a});window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)});if(!n){var a=window.requestAnimationFrame,s=+new Date;window.requestAnimationFrame=function(e,t){var n=function(t){var n=1e12>t?t:t-s;return e(n)};a(n,t)}}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control.js");TC.control.Geolocation=function(e){var t=this;t.$events=$(t);t._classSelector="."+t.CLASS;t.Const={Classes:{ACTIVE:"tc-ctl-geolocation-active",CLOSED:"closed",SELECTEDTRACK:"selectedTrack",DRAWACTIVATED:"draw-activated",SIMULATIONACTIVATED:"simulation-activated"},Selector:{SIMULATE:".tc-btn-simulate",DRAW:".tc-draw",EDIT:".tc-btn-edit",DELETE:".tc-btn-delete",SAVE:".tc-btn-save",CANCEL:".tc-btn-cancel",EXPORT_GPX:".tc-btn-export-gpx",EXPORT_KML:".tc-btn-export-kml",STOP:".tc-btn-stop",PAUSE:".tc-btn-pause",BACKWARD:".tc-btn-backward",FORWARD:".tc-btn-forward",SPEED:".tc-spn-speed"},LocalStorageKey:{TRACKING:"trk",TRACKINGTEMP:"trktemp",TRACKINGSHOWADVERTISEMENT:"trkAdvertisement",GPSSHOWADVERTISEMENT:"gpsAdvertisement",TEST:"test"},Message:{VALIDATENAME:""},Event:{POSITIONCHANGE:"positionchange.tc.geolocation",GPSPOSITIONCHANGE:"gpspositionchange.tc.geolocation",GPSPOSITIONERROR:"positionerror.tc.geolocation",STATEUPDATED:"stateupdated.tc.geolocation",GPSADD:"gpsadd.tc.geolocation",TRACKSNAPPING:"tracksnapping.tc.geolocation",DRAWTRACK:"drawtrack.tc.geolocation",CLEARTRACK:"cleartrack.tc.geolocation",IMPORTEDTRACK:"importedtrack.tc.geolocation"},MimeMap:{KML:"application/vnd.google-earth.kml+xml",GPX:"application/gpx+xml"},Tabs:{GPS:"gps"},Layers:{GPS:"gps",TRACK:"track",TRACKING:"tracking"}};TC.Control.apply(t,arguments);var n=e||{};t._$dialogDiv=$(TC.Util.getDiv(n.dialogDiv));n.dialogDiv||t._$dialogDiv.appendTo("body");t.delta=500;t.walkingSpeed=5e3;t.gapHill=t.options.gapHill||20};TC.inherit(TC.control.Geolocation,TC.Control);!function(){var e=TC.control.Geolocation.prototype;e.CLASS="tc-ctl-geolocation";TC.Consts.event.TOOLSCLOSE=TC.Consts.event.TOOLSCLOSE||"toolsclose.tc";TC.Consts.event.TOOLSOPEN=TC.Consts.event.TOOLSOPEN||"toolsopen.tc";e.template={};if(TC.isDebug){e.template[e.CLASS]=TC.apiLocation+"TC/templates/Geolocation.html";e.template[e.CLASS+"-track-node"]=TC.apiLocation+"TC/templates/GeolocationTrackNode.html";e.template[e.CLASS+"-track-snapping-node"]=TC.apiLocation+"TC/templates/GeolocationTrackSnappingNode.html";e.template[e.CLASS+"-dialog"]=TC.apiLocation+"TC/templates/GeolocationDialog.html";e.template[e.CLASS+"-tracking-toast"]=TC.apiLocation+"TC/templates/GeolocationTrackingToast.html"}else{e.template[e.CLASS]=function(){function t(e,t){return e.w("<h2>").h("i18n",t,{},{$key:"geo"}).w(' <span class="tc-beta">').h("i18n",t,{},{$key:"beta"}).w('</span></h2><div class="tc-ctl-geolocation-content"> <div class="tc-ctl-geolocation-track"><div class="tc-ctl-geolocation-track-snap-info"></div><div class="tc-ctl-geolocation-info-tracking tc-hidden"><div class="tc-ctl-p-results"><div class="prpanel-group prsidebar-body "><div class="prpanel prpanel-default"><div class="prpanel-heading"><h4 class="prpanel-title"><label>').h("i18n",t,{},{$key:"geo.mylocation"}).w('</label> <span id="trackingInfoClose" class="prcollapsed-pull-right prcollapsed-slide-submenu prcollapsed-slide-submenu-close" title="').h("i18n",t,{},{$key:"close"}).w('"><i class="fa fa-times"></i></span><span id="trackingInfoMin" class="prcollapsed-pull-right prcollapsed-slide-submenu prcollapsed-slide-submenu-min" title="').h("i18n",t,{},{$key:"hide"}).w('"><i class="fa fa-chevron-left"></i></span> </h4></div><div id="results" class="prpanel-collapse"><div class="prpanel-body list-group"> </div> </div></div></div><div id="trackingInfoMax" class="prcollapsed prcollapsed-max prcollapsed-pull-left" style="display: none;" title="').h("i18n",t,{},{$key:"geo.trk.panel.3"}).w('"><i class="fa fa-list-alt"></i></div></div></div><!-- img se insertan en el div del mapa--> <div id="tc-ctl-geolocation-track-elevation-marker" class="tc-ctl-geolocation-trackMarker elevation" style="display: none;" /> <div class="tc-ctl-geolocation-track-panel-block"><input id="tc-ctl-geolocation-track-panel-opened" type="checkbox" checked/><label for="tc-ctl-geolocation-track-panel-opened" title="').h("i18n",t,{},{$key:"geo.trk.panel.help.1"}).w('">').h("i18n",t,{},{$key:"geo.trk.panel.help.2"}).w('</label><i class="tc-ctl-geolocation-track-panel-help icon-question-sign" title="').h("i18n",t,{},{$key:"geo.trk.panel.help.3"}).w('"></i></div><div class="tc-ctl-geolocation-track-mng"><div class="tc-ctl-geolocation-select"><form> <label class="tc-ctl-geolocation-btn-track" title="').h("i18n",t,{},{$key:"geo.track.title"}).w('"><input type="radio" name="mode" value="tracks" /><span>').h("i18n",t,{},{$key:"geo.gps"}).w('</span></label><label class="tc-ctl-geolocation-btn-tracks" title="').h("i18n",t,{},{$key:"geo.tracks.title"}).w('"><input type="radio" name="mode" value="track-available" /><span>').h("i18n",t,{},{$key:"geo.tracks"}).w('</span></label> </form></div> <div class="tc-ctl-geolocation-track-available tc-ctl-geolocation-track-cnt tc-ctl-geolocation-panel tc-hidden"><i class="tc-ctl-geolocation-track-search-icon"></i><input id="tc-ctl-geolocation-track-available-srch" type="search" list="tc-ctl-geolocation-track-available-lst" class="tc-ctl-geolocation-track-available-srch tc-textbox" placeholder="').h("i18n",t,{},{$key:"geo.filter.plhr"}).w('" maxlength="200" /> <ol id="tc-ctl-geolocation-track-available-lst" class="tc-ctl-geolocation-track-available-lst"><li class="tc-ctl-geolocation-track-available-empty"><span>').h("i18n",t,{},{$key:"geo.noTracks"}).w('</span></li><li class="tc-ctl-geolocation-track-not" hidden><span>').h("i18n",t,{},{$key:"noMatches"}).w('</span></li></ol><div class="tc-ctl-geolocation-track-cnt"><input name="uploaded-file" id="uploaded-file" type="file" class="tc-ctl-geolocation-track-import tc-button" accept=".gpx,.kml" disabled /><label class="tc-button tc-icon-button" for="uploaded-file" title="').h("i18n",t,{},{$key:"geo.trk.import.upload"}).w('">').h("i18n",t,{},{$key:"geo.trk.import.lbl"}).w('</label></div></div><div class="tc-ctl-geolocation-tracks tc-ctl-geolocation-panel tc-hidden"> <div class="tc-alert alert-warning tc-hidden"><p id="panel-msg">').h("i18n",t,{},{$key:"geo.trk.panel.1"}).w(" <ul><li>").h("i18n",t,{},{$key:"geo.trk.panel.2"}).w("</li><li>").h("i18n",t,{},{$key:"geo.trk.panel.3"}).w("</li><li>").h("i18n",t,{},{$key:"geo.trk.panel.4"
}).w("</li><li>").h("i18n",t,{},{$key:"geo.trk.panel.5"}).w('</li></ul></p></div> <div class="tc-ctl-geolocation-track-ui"> <div class="tc-ctl-geolocation-track-render"><input id="tc-ctl-geolocation-track-render" type="checkbox" hidden checked /><label for="tc-ctl-geolocation-track-render" class="tc-ctl-geolocation-track-render" title="').h("i18n",t,{},{$key:"geo.trk.render"}).w('">').h("i18n",t,{},{$key:"geo.trk.render"}).w('</label></div><button class="tc-button tc-icon-button tc-ctl-geolocation-track-ui-activate" title="').h("i18n",t,{},{$key:"geo.track.activate.title"}).w('">').h("i18n",t,{},{$key:"geo.track.activate"}).w('</button><button class="tc-button tc-icon-button tc-ctl-geolocation-track-ui-deactivate tc-hidden" title="').h("i18n",t,{},{$key:"geo.track.deactivate.title"}).w('">').h("i18n",t,{},{$key:"geo.track.deactivate"}).w('</button></div><div class="tc-ctl-geolocation-track-current tc-ctl-geolocation-track-cnt"><input type="text" class="tc-ctl-geolocation-track-title tc-textbox" disabled placeholder="').h("i18n",t,{},{$key:"geo.trk.name.plhr"}).w('" maxlength="200" /><button class="tc-button tc-icon-button tc-ctl-geolocation-track-save" disabled title="').h("i18n",t,{},{$key:"geo.trk.name.save"}).w('"></button><input type="text" class="tc-ctl-geolocation-track-waypoint tc-textbox" disabled placeholder="').h("i18n",t,{},{$key:"geo.trk.wyp.plhr"}).w('" maxlength="200" /><button class="tc-button tc-icon-button tc-ctl-geolocation-track-add-wpt" disabled title="').h("i18n",t,{},{$key:"geo.trk.wyp.save"}).w('"></button></div></div></div></div></div><!--se inserta en el div del mapa--><div class="tc-ctl-geolocation-track-center tc-hidden"> <button class="tc-ctl-btn tc-button tc-icon-button" title="').h("i18n",t,{},{$key:"geo.trk.center"}).w('"></button></div>')}dust.register(e.CLASS,t);t.__dustBody=!0;return t};e.template[e.CLASS+"-track-node"]=function(){function t(e,t){return e.w('<li data-id="').f(t.get(["id"],!1),t,"h").w('" data-uid="').f(t.get(["uid"],!1),t,"h").w('"><span class="tc-draw tc-selectable" title="').f(t.get(["name"],!1),t,"h").w('">').f(t.get(["name"],!1),t,"h").w('</span><input class="tc-textbox tc-hidden" type="text" value="').f(t.get(["name"],!1),t,"h").w('" /> <button class="tc-btn-simulate" title="').h("i18n",t,{},{$key:"tr.lst.simulate"}).w('"></button><button hidden class="tc-btn-stop" title="').h("i18n",t,{},{$key:"tr.lst.stop"}).w('"></button><button class="tc-btn-edit" title="').h("i18n",t,{},{$key:"tr.lst.edit"}).w('"></button><button hidden class="tc-btn-pause" title="').h("i18n",t,{},{$key:"tr.lst.pause"}).w('"></button> <button hidden class="tc-btn-backward" title="').h("i18n",t,{},{$key:"tr.lst.backward"}).w('"></button><label hidden class="tc-spn-speed" title="').h("i18n",t,{},{$key:"tr.lst.velocity"}).w('"></label><button hidden class="tc-btn-forward" title="').h("i18n",t,{},{$key:"tr.lst.forward"}).w('"></button> <button class="tc-btn-save tc-hidden" title="').h("i18n",t,{},{$key:"save"}).w('"></button><button class="tc-btn-cancel tc-hidden" title="').h("i18n",t,{},{$key:"tr.lst.cancel"}).w('"></button><button class="tc-btn-delete" title="').h("i18n",t,{},{$key:"tr.lst.delete"}).w('"></button><button class="tc-btn-export-gpx" title="').h("i18n",t,{},{$key:"tr.lst.exportGPX"}).w('"></button><button class="tc-btn-export-kml" title="').h("i18n",t,{},{$key:"tr.lst.exportKML"}).w('"></button> </li>')}dust.register(e.CLASS+"-track-node",t);t.__dustBody=!0;return t};e.template[e.CLASS+"-track-snapping-node"]=function(){function t(e,t){return e.w("<ul>").x(t.get(["n"],!1),t,{block:n},{}).w("<li> <span>X:</span> ").f(t.get(["x"],!1),t,"h").w(" </li><li> <span>Y:</span> ").f(t.get(["y"],!1),t,"h").w(" </li>").x(t.get(["z"],!1),t,{block:r},{}).x(t.get(["m"],!1),t,{block:a},{}).w("</ul>")}function n(e,t){return e.w("<li> <span>").h("i18n",t,{},{$key:"geo.trk.snapping.name"}).w(":</span> ").f(t.get(["n"],!1),t,"h").w(" </li>")}function r(e,t){return e.h("ne",t,{block:i},{key:t.get(["z"],!1),value:0}).w(" ")}function i(e,t){return e.w("<li> <span>Z:</span> ").f(t.get(["z"],!1),t,"h").w(" </li>")}function a(e,t){return e.w("<li> ").f(t.get(["m"],!1),t,"h").w(" </li>")}dust.register(e.CLASS+"-track-snapping-node",t);t.__dustBody=!0;n.__dustBody=!0;r.__dustBody=!0;i.__dustBody=!0;a.__dustBody=!0;return t};e.template[e.CLASS+"-dialog"]=function(){function t(e,t){return e.w('<div class="tc-ctl-geolocation-continue-track-dialog tc-modal"><div class="tc-modal-background tc-modal-close"></div><div class="tc-modal-window"><div class="tc-modal-header"><h3>').h("i18n",t,{},{$key:"geo.gps"}).w('</h3><div class="tc-ctl-popup-close tc-modal-close"></div></div><div class="tc-modal-body"><button class="tc-button tc-ctl-geolocation-track-continue"> ').h("i18n",t,{},{$key:"geo.trk.dialog.cnt"}).w(' </button><button class="tc-button tc-ctl-geolocation-track-new"> ').h("i18n",t,{},{$key:"geo.trk.dialog.new"}).w(' </button> <button class="tc-button tc-modal-close"> ').h("i18n",t,{},{$key:"geo.trk.dialog.cancel"}).w(' </button></div></div></div><div class="tc-ctl-geolocation-track-advert-dialog tc-modal"><div class="tc-modal-background tc-modal-close"></div><div class="tc-modal-window"><div class="tc-modal-header"><h3>').h("i18n",t,{},{$key:"geo.track.activate.title"}).w('</h3><div class="tc-ctl-popup-close tc-modal-close"></div></div><div class="tc-modal-body"><p id="pageBlurMsg">').h("i18n",t,{},{$key:"geo.trk.page.blur"}).w('</p><p class="tc-ctl-geolocation-track-advertisement p"> <label> <input type="checkbox" name="checkbox" id="advertisement"> ').h("i18n",t,{},{$key:"geo.trk.dialog.advertisement"}).w(' </label> </p></div><div class="tc-modal-footer"><button class="tc-button tc-ctl-geolocation-track-advert-ok"> ').h("i18n",t,{},{$key:"ok"}).w(" </button></div></div></div>")}dust.register(e.CLASS+"-dialog",t);t.__dustBody=!0;return t};e.template[e.CLASS+"-tracking-toast"]=function(){function t(e,t){return e.w("<ul><li><span>X:</span> ").f(t.get(["x"],!1),t,"h").w("<br /><span>Y:</span> ").f(t.get(["y"],!1),t,"h").w("<br />").x(t.get(["z"],!1),t,{block:n},{}).w("</li><li>").x(t.get(["accuracy"],!1),t,{block:r},{}).x(t.get(["speed"],!1),t,{block:i},{}).w("</li></ul>")}function n(e,t){return e.w("<span>Z:</span> ").f(t.get(["z"],!1),t,"h").w(" m<br />")}function r(e,t){return e.w("<span>").h("i18n",t,{},{$key:"geo.trk.accuracy"}).w(":</span> ").f(t.get(["accuracy"],!1),t,"h").w(" m<br />")}function i(e,t){return e.w("<span>").h("i18n",t,{},{$key:"geo.trk.speed"}).w(":</span> ").f(t.get(["speed"],!1),t,"h").w(" km/h<br />")}dust.register(e.CLASS+"-tracking-toast",t);t.__dustBody=!0;n.__dustBody=!0;r.__dustBody=!0;i.__dustBody=!0;return t}}e.register=function(e){var t=this;TC.Control.prototype.register.call(t,e);t.wrap=new TC.wrap.control.Geolocation(t);t.wrap.register(e);e.loaded(function(){$.when(e.addLayer({id:TC.getUID(),type:TC.Consts.layerType.VECTOR,stealth:!0,title:"Posicionar.GPS"})).then(function(e){t.layerGPS=e});$.when(e.addLayer({id:TC.getUID(),type:TC.Consts.layerType.VECTOR,stealth:!0,title:"Posicionar.Tracking"})).then(function(e){t.layerTracking=e});e.on(TC.Consts.event.FEATURESIMPORT,function(e){var t=this;if(e.fileName&&e.features&&e.features.length>0){var n=/.kml/g.test(e.fileName.toLowerCase())&&t.importedByMe||!1;if(/.gpx/g.test(e.fileName.toLowerCase())||n){if(t.layerTrack){t.map.removeLayer(t.layerTrack);t.layerTrack=void 0}if(n){for(var r=0;r<t.map.workLayers.slice().reverse().length;r++){var i=t.map.workLayers.slice().reverse()[r];if(i.title&&i.title.toLowerCase().trim()===e.fileName.toLowerCase().trim()){t.map.removeLayer(i);break}}t.importedByMe=!1}t.getLayer(t.Const.Layers.TRACK).then(function(n){var r=t.getLoadingIndicator().addWait();t.importedFileName=e.fileName;for(var i=0,a=e.features.length;a>i;i++)t.layerTrack.addFeature(e.features[i]);t.wrap.processImportedFeatures(r);if(t.layerTrack){if(t.map&&t.map.layout&&t.map.layout.accordion&&t._$div.hasClass(TC.Consts.classes.COLLAPSED))for(var i=0;i<t.map.controls.length;i++)t.map.controls[i]!==t&&t.map.controls[i]._$div.addClass(TC.Consts.classes.COLLAPSED);t._$div.removeClass(TC.Consts.classes.COLLAPSED);$("."+t.CLASS+"-btn-tracks > span").click();t.map.$events.trigger($.Event(TC.Consts.event.TOOLSOPEN),{})}})}}}.bind(t));e.on(TC.Consts.event.LAYERVISIBILITY+" "+TC.Consts.event.LAYEROPACITY+" "+TC.Consts.event.LAYERREMOVE,function(e){var t=this;if(e.layer==t.layerTrack)switch(!0){case e.type+"."+e.namespace===TC.Consts.event.LAYERREMOVE:t.wrap.deactivateSnapping();var n=t.getSelectedTrack();n&&t.clearSelectedTrack();t.resultsPanelChart&&t.resultsPanelChart.close();t.layerTrack=void 0;break;case e.opacity>0&&e.opacity<1:return;case 0==e.layer.getVisibility():t.resultsPanelChart&&t.resultsPanelChart.minimize();case 0==e.opacity:t.wrap.deactivateSnapping();break;case 1==e.layer.getVisibility():t.resultsPanelChart&&t.resultsPanelChart.maximize();case 1==e.opacity:t.wrap.activateSnapping()}}.bind(t))})};e.render=function(e){var t=this;t.getRenderedHtml(t.CLASS+"-dialog",null,function(e){t._$dialogDiv.html(e)}).then(function(){TC.Control.prototype.render.call(t,e)})};var t=!0;e.renderData=function(s,o){var l=this,c=function(e,t){return(t.match(/(moveTop.*)/g)||[]).join(" ")};l.trackingActive={isTrackingActive:!1,get:function(){return this.isTrackingActive},set:function(e){this.isTrackingActive=e;l.$geoInfoResult||(l.$geoInfoResult=$("."+l.CLASS+"-info-tracking div.tc-ctl-p-results"));switch(this.isTrackingActive){case!0:if(l.elevationActiveCollapsed.get()){l.$geoInfoResult.removeClass(c).addClass("moveTop57");l.$geoInfoResult.find(".prcollapsed").removeClass("prcollapsed-samehw");l.$geoInfoResult.find(".prpanel-heading").removeClass("prpanel-heading-samehw")}else if(l.elevationActive.get()){l.$geoInfoResult.removeClass(c).addClass("moveTop159");l.$geoInfoResult.find(".prcollapsed").addClass("prcollapsed-samehw");l.$geoInfoResult.find(".prpanel-heading").addClass("prpanel-heading-samehw")}else{l.$geoInfoResult.removeClass(c).addClass("moveTop33");l.$geoInfoResult.find(".prcollapsed").removeClass("prcollapsed-samehw");l.$geoInfoResult.find(".prpanel-heading").removeClass("prpanel-heading-samehw")}break;case!1:}}};l.elevationActive={isElevationActive:!1,get:function(){return this.isElevationActive},set:function(e){this.isElevationActive=e;l.$geoInfoResult||(l.$geoInfoResult=$("."+l.CLASS+"-info-tracking div.tc-ctl-p-results"));switch(this.isElevationActive){case!0:if(l.trackingActive.get()){l.$geoInfoResult.removeClass(c).addClass("moveTop159");l.$geoInfoResult.find(".prcollapsed").addClass("prcollapsed-samehw");l.$geoInfoResult.find(".prpanel-heading").addClass("prpanel-heading-samehw")}break;case!1:if(l.trackingActive.get()){l.$geoInfoResult.removeClass(c).addClass("moveTop33");l.$geoInfoResult.find(".prcollapsed").removeClass("prcollapsed-samehw");l.$geoInfoResult.find(".prpanel-heading").removeClass("prpanel-heading-samehw")}}}};l.elevationActiveCollapsed={isElevationActiveCollapsed:!1,get:function(){return this.isElevationActiveCollapsed},set:function(e){this.isElevationActiveCollapsed=e;l.$geoInfoResult||(l.$geoInfoResult=$("."+l.CLASS+"-info-tracking div.tc-ctl-p-results"));switch(this.isElevationActiveCollapsed){case!0:if(l.trackingActive.get()){l.$geoInfoResult.removeClass(c).addClass("moveTop57");l.$geoInfoResult.find(".prcollapsed").removeClass("prcollapsed-samehw");l.$geoInfoResult.find(".prpanel-heading").removeClass("prpanel-heading-samehw")}break;case!1:if(l.trackingActive.get()){l.$geoInfoResult.removeClass(c).addClass("moveTop159");l.$geoInfoResult.find(".prcollapsed").addClass("prcollapsed-samehw");l.$geoInfoResult.find(".prpanel-heading").addClass("prpanel-heading-samehw")}}}};var h=l.Const.Selector;TC.Control.prototype.renderData.call(l,s,function(){var s=l._$div.find(l._classSelector+"-panel");l._$div.find(".tc-ctl-geolocation-select span").on(TC.Consts.event.CLICK,function(e){var t=$(this).closest("label").find("input[type=radio][name=mode]"),n=t.val();s.removeClass(TC.Consts.classes.HIDDEN);s.not(".tc-ctl-geolocation-"+n).addClass(TC.Consts.classes.HIDDEN)});l.gps={};l.gps.$activateButton=l._$div.find(l._classSelector+"-locate-show");l.gps.$deactivateButton=l._$div.find(l._classSelector+"-locate-hide");l.track={};l.track.$activateButton=l._$div.find(l._classSelector+"-track-ui-activate");l.track.$deactivateButton=l._$div.find(l._classSelector+"-track-ui-deactivate");l.track.$info=l._$div.find(l._classSelector+"-info-tracking").appendTo(l.map._$div);$(document).on("click","#trackingInfoMin",function(){var e=$(this).closest("div.tc-ctl-p-results");e.find(".prsidebar-body").toggle("slide",function(){e.find(".prcollapsed-max").fadeIn()})});$(document).on("click","#trackingInfoMax",function(){var e=$(this).closest("div.tc-ctl-p-results");e.find(".prsidebar-body").toggle("slide");e.find(".prcollapsed-max").hide()});$(document).on("click","#trackingInfoClose",function(){$(this).closest("div.tc-ctl-p-results").find(".prsidebar-body").fadeOut("slide")});l.track.$trackSearch=l._$div.find(l._classSelector+"-track-available-srch");l.track.$trackList=l._$div.find(l._classSelector+"-track-available-lst");l.track.$trackToolPanelOpened=l._$div.find("#tc-ctl-geolocation-track-panel-opened");l._$div.find("."+e.CLASS+"-track-panel-help").click(function(){a.call(l)});l.track.$trackName=l._$div.find(l._classSelector+"-track-title");l.track.$trackSave=l._$div.find(l._classSelector+"-track-save");l.track.$trackWPT=l._$div.find(l._classSelector+"-track-waypoint");l.track.$trackAdd=l._$div.find(l._classSelector+"-track-add-wpt");l.track.$trackContinue=l._$dialogDiv.find(".tc-ctl-geolocation-track-continue");l.track.$trackRenew=l._$dialogDiv.find(".tc-ctl-geolocation-track-new");l.track.$trackClose=l._$dialogDiv.find(".tc-ctl-geolocation-continue-track-dialog button.tc-modal-close");l.track.$trackAddSegment=l._$div.find("#tc-ctl-geolocation-track-segment");l.track.$trackAdvertisementOK=l._$dialogDiv.find(".tc-ctl-geolocation-track-advert-ok");l.track.$trackImportFile=l._$div.find(l._classSelector+"-track-import");TC.Util.detectMobile()&&Modernizr.mq("screen and (max-height: 50em) and (max-width: 50em)")&&l.track.$trackToolPanelOpened.prop("checked",!1);if(window.File&&window.FileReader&&window.FileList&&window.Blob){l.track.$trackImportFile.removeAttr("disabled");l.track.$trackImportFile.on("change",function(e){if(!l._cleaning){l.clear(l.Const.Layers.TRACK);if(l.map){l.map.on(TC.Consts.event.LAYERERROR,n);l.importedByMe=!0;l.map.wrap.loadFiles(e.target.files)}}})}else console.log("no es posible la importaci\xf3n");l.gps.$activateButton.on("click",function(){l.activateGPS()});l.gps.$deactivateButton.on("click",function(){l.deactivateGPS()});l.track.$activateButton.on("click",function(){l.activateTracking();r.call(l)});l.track.$deactivateButton.on("click",function(){l.deactivateTracking();i.call(l)});var o=function(e){e=e.toLowerCase();var t=l.track.$trackList.find("li").hide(),n=t.filter("li:not([class]),li."+l.Const.Classes.SELECTEDTRACK);if(0===e.length){n.show();l._$div.find(l._classSelector+"-track-search-icon").css("visibility","visible")}else{l._$div.find(l._classSelector+"-track-search-icon").css("visibility","hidden");var r=new RegExp(e,"i");n.each(function(){var e=$(this);e.toggle(r.test(e.children("span").text()))});0===n.filter(":visible").length&&t.filter('[class^="tc-ctl-geolocation-track-not"]').show()}};l.track.$trackSearch.on("keyup search",function(){o($(this).val().toLowerCase().trim())});try{if(l.track.$trackSearch.has($("::-ms-clear"))){var c;l.track.$trackSearch.on("mouseup",function(e){c=l.track.$trackSearch.val();""!==c&&setTimeout(function(){var e=l.track.$trackSearch.val();""===e&&o(e)},1)})}}catch(p){}l.track.$trackSave.on("click",$.proxy(l.saveTrack,l));l.track.$trackAdd.on("click",$.proxy(l.addWaypoint,l));var d=function(e,t){t.is("li")||(t=t.parent());if(e){t.find("input").first().removeClass(TC.Consts.classes.HIDDEN);t.find("span").first().addClass(TC.Consts.classes.HIDDEN);t.find("input").first().focus().val(t.find("span").first().text());t.find(h.SIMULATE).first().addClass(TC.Consts.classes.HIDDEN);t.find(h.EDIT).first().addClass(TC.Consts.classes.HIDDEN);t.find(h.DELETE).first().addClass(TC.Consts.classes.HIDDEN);t.find(h.DRAW).first().addClass(TC.Consts.classes.HIDDEN);t.find(h.EXPORT_GPX).first().addClass(TC.Consts.classes.HIDDEN);t.find(h.EXPORT_KML).first().addClass(TC.Consts.classes.HIDDEN);t.find(h.SAVE).first().removeClass(TC.Consts.classes.HIDDEN);t.find(h.CANCEL).first().removeClass(TC.Consts.classes.HIDDEN)}else{t.find("input").first().addClass(TC.Consts.classes.HIDDEN);t.find("span").first().removeClass(TC.Consts.classes.HIDDEN);t.find(h.SIMULATE).first().removeClass(TC.Consts.classes.HIDDEN);t.find(h.EDIT).first().removeClass(TC.Consts.classes.HIDDEN);t.find(h.DELETE).first().removeClass(TC.Consts.classes.HIDDEN);t.find(h.DRAW).first().removeClass(TC.Consts.classes.HIDDEN);t.find(h.EXPORT_GPX).first().removeClass(TC.Consts.classes.HIDDEN);t.find(h.EXPORT_KML).first().removeClass(TC.Consts.classes.HIDDEN);t.find(h.SAVE).first().addClass(TC.Consts.classes.HIDDEN);t.find(h.CANCEL).first().addClass(TC.Consts.classes.HIDDEN)}};l.uiSimulate=function(e,t){var n=[h.SIMULATE,h.EDIT,h.DELETE,h.EXPORT_GPX,h.EXPORT_KML],r=[h.STOP,h.PAUSE,h.BACKWARD,h.FORWARD,h.SPEED],i=t.is("li")?t:t.parent();if(e){for(var a=0;a<n.length;a++)$(i).find(n[a]).first().attr("hidden","hidden");for(var a=0;a<r.length;a++)$(i).find(r[a]).first().removeAttr("hidden")}else{for(var a=0;a<r.length;a++)$(i).find(r[a]).first().attr("hidden","hidden");for(var a=0;a<n.length;a++)$(i).find(n[a]).first().removeAttr("hidden")}};$(document).on("click",h.SIMULATE,function(){var e=l.getLoadingIndicator().addWait();$(this).parent().find(h.SPEED).text("x 1");$.when(y(l,this)).then(function(){l.getLoadingIndicator().removeWait(e)})});$(document).on("click",h.DRAW,function(){var e=l.getLoadingIndicator().addWait();$.when(m(l,this)).then(function(){l.getLoadingIndicator().removeWait(e)})});l.$events.on(l.Const.Event.IMPORTEDTRACK,function(e,t){var n=l.track.$trackList.find('li[data-id="'+t+'"]');m(l,n.find(h.DRAW));l.track.$trackList.animate({scrollTop:t*n.outerHeight()},"slow")});var f=function(e,t){for(var n=e.track.$trackList.find("li[data-id]"),r=0;r<n.length;r++){var i=$(n[r]);if(i&&i.attr("data-id")!==t){var a=i.find(h.SIMULATE),s=i.find(h.PAUSE);a.toggleClass(e.Const.Classes.SIMULATIONACTIVATED,!1);a.attr("title",e.getLocaleString("tr.lst.simulate"));s.toggleClass("play",!1);s.attr("title",e.getLocaleString("tr.lst.pause"));e.uiSimulate(!1,i);d(!1,i)}}e.clear(e.Const.Layers.TRACK)},m=function(e,t){var n=$.Deferred(),r=$(t).parent();setTimeout(function(){if(r.hasClass(e.Const.Classes.SELECTEDTRACK)){e.uiSimulate(!1,$(t));e.clear(e.Const.Layers.TRACK);$(t).attr("title",$(t).text());e.elevationActive.set(!1);if(void 0!==e.layerTrack){e.map.removeLayer(e.layerTrack);e.layerTrack=void 0}}else if(e.getSelectedTrack().length>0){f(e,r.attr("data-id"));e.drawTrack(r)}else e.drawTrack(r);n.resolve()},0);return n.promise()},y=function(e,t){var n=$.Deferred();setTimeout(function(){var r=$(t).parent();e.getLayer(e.Const.Layers.TRACK).then(function(i){f(e,r.attr("data-id"));e.uiSimulate(!1,e.getSelectedTrack());$(this).parent().addClass(e.Const.Classes.SELECTEDTRACK);e.uiSimulate(!0,$(t));e.simulate_paused=!1;e.simulateTrack($(t).parent());n.resolve()})},0);return n.promise()};$(document).on("click",l._classSelector+" "+h.EDIT,function(){d(!0,$(this))});$(document).on("click",l._classSelector+" "+h.DELETE,function(){f(l);l.removeTrack($(this).parent())});$(document).on("click",l._classSelector+" "+h.SAVE,function(){var e=$(this).parent().find("input").first().val();if(0==e.trim().length)TC.alert(l.getLocaleString("geo.trk.edit.alert"));else{l.editTrackName($(this).parent().attr("data-id"),$(this).parent().find("input").first().val());d(!1,$(this))}});$(document).on("click",l._classSelector+" "+h.CANCEL,function(){d(!1,$(this))});$(document).on("click",l._classSelector+" "+h.EXPORT_GPX+","+l._classSelector+" "+h.EXPORT_KML,function(){var e=this,t="tc-btn-export-",n=$.grep($(this).attr("class").split(" "),function(e){return 0===e.indexOf(t)})[0],r=n.replace(t,"").toUpperCase();l["export"](r,$(this).parent()).then(function(t){t?TC.Util.downloadFile($(e).parent().find("span").first().text()+"."+r.toLowerCase(),l.Const.MimeMap[r],t):TC.alert(l.getLocaleString("geo.error.export"))})});$(document).on("click",l._classSelector+" "+h.STOP,function(){l.uiSimulate(!1,$(this));l.wrap.simulateTrackEnd();var e=$(this).parent().find(h.PAUSE);e.toggleClass("play",!1);e.attr("title",l.getLocaleString("tr.lst.pause"));$(this).parent().find(h.SPEED).text("x 1");l.simulate_speed=1});$(document).on("click",l._classSelector+" "+h.PAUSE,function(){l.simulate_paused=!$(this).hasClass("play");l.simulate_paused&&(l.simulate_pausedElapse=-1);$(this).attr("title",l.getLocaleString(l.simulate_paused?"tr.lst.play":"tr.lst.pause"));$(this).toggleClass("play",l.simulate_paused)});var g=.5;$(document).on("click",l._classSelector+" "+h.BACKWARD,function(){l.simulate_speed=1==l.simulate_speed?g:l.simulate_speed/2;$(l._classSelector+" "+h.FORWARD).removeAttr("disabled");$(this).parent().find(h.SPEED).text(l.simulate_speed<1?"/ "+1/l.simulate_speed:"x "+l.simulate_speed);.000244140625==l.simulate_speed&&$(this).attr("disabled","disabled")});$(document).on("click",l._classSelector+" "+h.FORWARD,function(){l.simulate_speed=l.simulate_speed/g;$(this).parent().find(h.SPEED).text(l.simulate_speed<1?"/ "+1/l.simulate_speed:"x "+l.simulate_speed);$(l._classSelector+" "+h.BACKWARD).removeAttr("disabled");4096==l.simulate_speed&&$(this).attr("disabled","disabled")});l.track.$trackContinue.on("click",function(){TC.Util.closeModal();u.call(l)});l.track.$trackRenew.on("click",function(){delete l.sessionTracking;TC.Util.storage.setSessionLocalValue(l.Const.LocalStorageKey.TRACKINGTEMP,void 0);localforage.removeItem(l.Const.LocalStorageKey.TRACKINGTEMP);TC.Util.closeModal();u.call(l)});l.track.$trackClose.on("click",function(){i.call(l)});l.track.$trackAddSegment.on("click",function(){TC.alert("pendiente");TC.Util.closeModal()});l.track.$trackAdvertisementOK.on("click",function(){var e=$(body).find('input[name*="Advertisement"]:checked');if(e.length>0){var t=new $.Deferred;window.localforage?t.resolve():TC.loadJS(!window.localforage,[TC.Consts.url.LOCALFORAGE],function(){t.resolve()});t.then(function(){localforage.setItem(e.first().attr("name"),!1)})}TC.Util.closeModal()});l.track.renderTrack=$("#tc-ctl-geolocation-track-render").change(function(){l.track.$activateButton.hasClass(TC.Consts.classes.HIDDEN)&&l.wrap.setTrackOnMapVisibility(this.checked);t=this.checked});window.localforage?l.bindTracks():TC.loadJS(!window.localforage,[TC.Consts.url.LOCALFORAGE],function(){l.bindTracks()})});$.isFunction(o)&&o()};var n=function(){var e=this;e.map.off(TC.Consts.event.LAYERERROR,n);e.clearFileInput(e.track.$trackImportFile);TC.alert(e.getLocaleString("geo.trk.upload.error3"))},r=function(){var e=this;e.track.$activateButton.toggleClass(TC.Consts.classes.HIDDEN,!0);e.track.$deactivateButton.toggleClass(TC.Consts.classes.HIDDEN,!1)},i=function(){var e=this;e.track.$activateButton.toggleClass(TC.Consts.classes.HIDDEN,!1);e.track.$deactivateButton.toggleClass(TC.Consts.classes.HIDDEN,!0)},a=function(){var e=this;e.map.toast(e._$div.find(".alert-warning").html(),{duration:1e4})};e.getLayer=function(e){var t=this,n=!0,r="";switch(!0){case e==t.Const.Layers.TRACKING:n=void 0!==t.layerTracking;r="layerTracking";break;case e==t.Const.Layers.TRACK:n=void 0!==t.layerTrack;r="layerTrack";break;case e==t.Const.Layers.GPS:n=void 0!==t.layerGPS;r="layerGPS"}if(this[r]){var i=new $.Deferred;i.resolve(this[r]);return i}if(t.layerPromise&&"resolved"!==t.layerPromise.state())return t.layerPromise;t.layerPromise=new $.Deferred;$.when(t.map.addLayer({id:TC.getUID(),type:TC.Consts.layerType.VECTOR,title:t.getLocaleString("geo")+" - "+e,stealth:!0})).then(function(e){this[r]=e;this[r].map.putLayerOnTop(e);t.layerPromise.resolve(this[r])}.bind(t));return t.layerPromise};e.activateGPS=function(){var e=this;e.deactivateTracking();T.call(e,e.Const.LocalStorageKey.GPSSHOWADVERTISEMENT);h.apply(e);g.apply(e);e.gps.$activateButton.toggleClass(TC.Consts.classes.HIDDEN,!0);e.gps.$deactivateButton.toggleClass(TC.Consts.classes.HIDDEN,!1);e.track.$trackToolPanelOpened.prop("checked")||e.map.$events.trigger($.Event(TC.Consts.event.TOOLSCLOSE),{});$.when(e.getLayer(e.Const.Layers.GPS)).then(function(t){e.currentPositionWaiting=e.getLoadingIndicator().addWait();if(navigator.geolocation){var n={timeout:6e4},r=function(n){n=n.coords;e.geopositionGPS=!0;var r=TC.Util.reproject([n.longitude,n.latitude],"EPSG:4326",e.map.crs);e.getLoadingIndicator().removeWait(e.currentPositionWaiting);t&&t.clearFeatures();var i=function(t){var n=function(e,t){return e instanceof Array?t[0]>=e[0]&&t[0]<=e[2]&&t[1]>=e[1]&&t[1]<=e[3]:!0};return n(e.map.options.maxExtent,t)?!0:!1};i(r)?$.when(t.addCircle([r,n.accuracy]),t.addMarker(r,{title:"GPS",cssClass:TC.Consts.classes.POINT,anchor:[.5,.5]})).then(function(n,r){e.gps.accuracyCircle=n;e.gps.geoPosition=r;if(!e.wrap.pulsated){e.map.zoomToFeatures(t.features,{animate:!1});e.wrap.pulsate(n)}}):TC.alert(e.getLocaleString("geo.error.out"))};if(navigator.geolocation){navigator.geolocation.getCurrentPosition(function(t){e.data=t;r(t);e.currentPosition=navigator.geolocation.watchPosition(r,e.onGeolocateError.bind(e))},e.onGeolocateError.bind(e));setTimeout(function(){if(!e.data){e.getLoadingIndicator().removeWait(e.currentPositionWaiting);e.map.toast(e.getLocaleString("geo.error.permission_denied"),{type:TC.Consts.msgType.WARNING});e.gps.$activateButton.toggleClass(TC.Consts.classes.HIDDEN,!1);e.gps.$deactivateButton.toggleClass(TC.Consts.classes.HIDDEN,!0)}},n.timeout+1e3)}else alert("not supported")}else e.onGeolocateError()})};e.deactivateGPS=function(){var e=this;delete e.geopositionGPS;p();v();delete e.wrap.pulsated;navigator.geolocation&&e.currentPosition&&navigator.geolocation.clearWatch(e.currentPosition);$.when(e.getLayer(e.Const.Layers.GPS)).then(function(e){e&&e.clearFeatures()});e.gps.$activateButton.toggleClass(TC.Consts.classes.HIDDEN,!1);e.gps.$deactivateButton.toggleClass(TC.Consts.classes.HIDDEN,!0);e.currentPositionWaiting&&e.getLoadingIndicator().removeWait(e.currentPositionWaiting);return!0};var s,o,l,c=function(){var e=this;e.track.$trackToolPanelOpened.prop("checked")||e.map.$events.trigger($.Event(TC.Consts.event.TOOLSCLOSE),{})},u=function(){var e=this;r.call(e);c.call(e);e.track.$info.find(".prsidebar-body").show();e.$events.on(e.Const.Event.POSITIONCHANGE,function(t){e.currentPoint=t.pd;var n={},r=TC.Util.getMapLocale(e.map);n.x=Math.round(t.pd.position[0]).toLocaleString(r);n.y=Math.round(t.pd.position[1]).toLocaleString(r);n.z=Math.round(t.pd.altitude).toLocaleString(r);n.accuracy=Math.round(t.pd.accuracy).toLocaleString(r);n.speed=t.pd.speed.toLocaleString(r,{minimumFractionDigits:1,maximumFractionDigits:1});n&&e.getRenderedHtml(e.CLASS+"-tracking-toast",n,function(t){e.track.$info.find(".prpanel-body").html(t);e.track.$info.hasClass(TC.Consts.classes.HIDDEN)&&e.track.$info.removeClass(TC.Consts.classes.HIDDEN);e.trackingActive.set(!0)});e.track.$trackName.removeAttr("disabled");e.track.$trackSave.removeAttr("disabled");e.track.$trackWPT.removeAttr("disabled");e.track.$trackAdd.removeAttr("disabled");TC.Util.storage.setSessionLocalValue(e.Const.LocalStorageKey.TRACKINGTEMP,e.wrap.formattedToStorage(e.layerTracking))});e.$events.on(e.Const.Event.STATEUPDATED,function(e){});e.clear(e.Const.Layers.TRACKING);T.call(e,e.Const.LocalStorageKey.TRACKINGSHOWADVERTISEMENT);e.wrap.setTracking(!0)},h=function(){var e=this;if(!e.videoScreenOn){var t={WebM:"data:video/webm;base64,GkXfo0AgQoaBAUL3gQFC8oEEQvOBCEKCQAR3ZWJtQoeBAkKFgQIYU4BnQI0VSalmQCgq17FAAw9CQE2AQAZ3aGFtbXlXQUAGd2hhbW15RIlACECPQAAAAAAAFlSua0AxrkAu14EBY8WBAZyBACK1nEADdW5khkAFVl9WUDglhohAA1ZQOIOBAeBABrCBCLqBCB9DtnVAIueBAKNAHIEAAIAwAQCdASoIAAgAAUAmJaQAA3AA/vz0AAA=",MP4:"data:video/mp4;base64,AAAAHGZ0eXBpc29tAAACAGlzb21pc28ybXA0MQAAAAhmcmVlAAAAG21kYXQAAAGzABAHAAABthADAowdbb9/AAAC6W1vb3YAAABsbXZoZAAAAAB8JbCAfCWwgAAAA+gAAAAAAAEAAAEAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAIVdHJhawAAAFx0a2hkAAAAD3wlsIB8JbCAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAIAAAACAAAAAABsW1kaWEAAAAgbWRoZAAAAAB8JbCAfCWwgAAAA+gAAAAAVcQAAAAAAC1oZGxyAAAAAAAAAAB2aWRlAAAAAAAAAAAAAAAAVmlkZW9IYW5kbGVyAAAAAVxtaW5mAAAAFHZtaGQAAAABAAAAAAAAAAAAAAAkZGluZgAAABxkcmVmAAAAAAAAAAEAAAAMdXJsIAAAAAEAAAEcc3RibAAAALhzdHNkAAAAAAAAAAEAAACobXA0dgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAIAAgASAAAAEgAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABj//wAAAFJlc2RzAAAAAANEAAEABDwgEQAAAAADDUAAAAAABS0AAAGwAQAAAbWJEwAAAQAAAAEgAMSNiB9FAEQBFGMAAAGyTGF2YzUyLjg3LjQGAQIAAAAYc3R0cwAAAAAAAAABAAAAAQAAAAAAAAAcc3RzYwAAAAAAAAABAAAAAQAAAAEAAAABAAAAFHN0c3oAAAAAAAAAEwAAAAEAAAAUc3RjbwAAAAAAAAABAAAALAAAAGB1ZHRhAAAAWG1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAAK2lsc3QAAAAjqXRvbwAAABtkYXRhAAAAAQAAAABMYXZmNTIuNzguMw=="};e.videoScreenOn=document.createElement("video");e.videoScreenOn.setAttribute("loop","");e.videoScreenOn.setAttribute("muted","");e.videoScreenOn.setAttribute("webkit-playsinline","");e.videoScreenOn.setAttribute("playsinline","");e.videoScreenOn.setAttribute("style","transform: translateZ(0px);");var n=document.createElement("source");n.src=t.WebM;n.type="video/webm";e.videoScreenOn.appendChild(n);var r=document.createElement("source");r.src=t.MP4;r.type="video/mp4";e.videoScreenOn.appendChild(r)}e.videoScreenOn.play()},p=function(){var e=this;e.videoScreenOn&&e.videoScreenOn.pause()},d=function(){var e=this;console.log("onWindowBlurred");console.log("video is: "+e.videoScreenOn.paused);C.apply(e);return"Texto de aviso"},f=function(){var e=this;console.log("onWindowFocused");console.log("video is: "+e.videoScreenOn.paused);e.videoScreenOn.paused&&e.videoScreenOn.play();L.apply(e);console.log("video is: "+e.videoScreenOn.paused)},m=function(){var e=["webkit","moz","ms","o"];if("hidden"in document)return"hidden";for(var t=0;t<e.length;t++)if(e[t]+"Hidden"in document)return e[t]+"Hidden";return null},y=function(){var e=this,t=m();document[t]||f.apply(e);console.log("video is: "+e.videoScreenOn.paused)},g=function(){var e=this;l||(l=y.bind(e));s||(s=d.bind(e));o||(o=f.bind(e));window.addEventListener("visibilitychange",l,!1);if(TC.Util.detectSafari()&&Modernizr.touch&&!navigator.userAgent.match(/Android/i)&&!navigator.userAgent.match(/CriOS/i)){window.addEventListener("pagehide",s,!1);window.addEventListener("pageshow",o,!1)}else{window.addEventListener("blur",s,!1);window.addEventListener("focus",o,!1)}},v=function(){window.removeEventListener("visibilitychange",l,!1);if(TC.Util.detectSafari()&&Modernizr.touch&&!navigator.userAgent.match(/Android/i)&&!navigator.userAgent.match(/CriOS/i)){window.removeEventListener("pagehide",s,!1);window.removeEventListener("pageshow",o,!1)}else{window.removeEventListener("blur",s,!1);window.removeEventListener("focus",o,!1)}},C=function(){var e=this,t=TC.Util.storage.getSessionLocalValue(e.Const.LocalStorageKey.TRACKINGTEMP);t&&t.length>0&&localforage.setItem(e.Const.LocalStorageKey.TRACKINGTEMP,"string"==typeof t?t:JSON.stringify(t))},L=function(){var e=this;localforage.getItem(e.Const.LocalStorageKey.TRACKINGTEMP).then(function(t){null!==t&&"null"!==t&&t.length>0&&TC.Util.storage.setSessionLocalValue(e.Const.LocalStorageKey.TRACKINGTEMP,t)})},T=function(e){var t=this,n=new $.Deferred;window.localforage?n.resolve():TC.loadJS(!window.localforage,[TC.Consts.url.LOCALFORAGE],function(){n.resolve()});n.then(function(){localforage.getItem(e).then(function(n){if(null==n){var r=t._$dialogDiv.find(".tc-ctl-geolocation-track-advert-dialog");r.find('input[type="checkbox"]').first().attr("name",e).removeAttr("checked");$("#pageBlurMsg").text(TC.Util.detectMobile()?t.getLocaleString("geo.trk.page.blur"):t.getLocaleString("geo.trk.page.blur.desktop"));

r.find("h3").text(e==t.Const.LocalStorageKey.GPSSHOWADVERTISEMENT?t.getLocaleString("geo.track.activate")+" "+t.getLocaleString("geo.gps"):t.getLocaleString("geo.track.activate.title"));TC.Util.showModal(t._$dialogDiv.find(".tc-ctl-geolocation-track-advert-dialog"))}})});t.map.toast(t.getLocaleString(TC.Util.detectMobile()?"geo.trk.page.blur":"geo.trk.page.blur.desktop"),{type:TC.Consts.msgType.WARNING})};e.activateTracking=function(){var e=this,t=!0;e.clear(e.Const.Layers.TRACKING);try{TC.Util.storage.setSessionLocalValue(e.Const.LocalStorageKey.TEST,e.Const.LocalStorageKey.TEST)}catch(n){n.code===DOMException.QUOTA_EXCEEDED_ERR?TC.alert(e.getLocaleString("geo.error.trackinglocalstorage")):TC.error(n);t=!1}if(t){h.apply(e);g.apply(e);e.sessionTracking=TC.Util.storage.getSessionLocalValue(e.Const.LocalStorageKey.TRACKINGTEMP);e.sessionTracking?TC.Util.showModal(e._$dialogDiv.find(".tc-ctl-geolocation-continue-track-dialog"),{closeCallback:function(){i.call(e)}}):u.call(e)}else i.call(e)};e.deactivateTracking=function(){var e=this,n=function(){e.track.$info.addClass(TC.Consts.classes.HIDDEN);$("#trackingInfoMax").hide();C.apply(e);e.wrap.setTracking(!1);delete e.geopositionTracking;t||$(e._classSelector+"-track-render").find("label").click();p.apply(e);v.apply(e);e.$events.off(e.Const.Event.POSITIONCHANGE);e.$events.off(e.Const.Event.STATEUPDATED);i.call(e);e.trackingActive.set(!1);e.track.$trackName.val("");e.track.$trackName.attr("disabled","disabled");e.track.$trackSave.attr("disabled","disabled");e.track.$trackWPT.val("");e.track.$trackWPT.attr("disabled","disabled");e.track.$trackAdd.attr("disabled","disabled");e.clear(e.Const.Layers.TRACKING);e.clear(e.Const.Layers.GPS);return!0};if(e.wrap.hasCoordinates()){e.map.toast(e.getLocaleString("geo.trk.deactivate.alert"),{duration:1e4});return n()}return n()};e.getStoredTracks=function(){var e=this,t=new $.Deferred,n={};localforage.getItem(e.Const.LocalStorageKey.TRACKING).then(function(r){r&&r.length>0&&(n=JSON.parse(r));var i=w(n);e.availableTracks=i;t.resolve(i)});return t};var w=function(e){var t=[];for(var n in e)if(e[n]){t.push(e[n]);t.sort(function(e,t){return e.name.localeCompare(t.name)})}return t};e.setStoredTracks=function(e){var t=this,n=new $.Deferred;localforage.setItem(t.Const.LocalStorageKey.TRACKING,JSON.stringify(e)).then(function(){t.getStoredTracks().then(function(){t.bindTracks();n.resolve()})});return n};e.getAvailableTracks=function(){var e=this,t=new $.Deferred;e.availableTracks?t.resolve(e.availableTracks):e.getStoredTracks().then(function(e){t.resolve(e)});return t};e.bindTracks=function(){var e=this;e.track.$trackList.find('li:not([class^="tc-ctl-geolocation-track-available-empty"])').hide();e.track.$trackList.find('li[class^="tc-ctl-geolocation-track-available-empty"]').hide();e.getAvailableTracks().then(function(t){if(S(t)){e.track.$trackList.find('li[class^="tc-ctl-geolocation-track-available-empty"]').show();e.track.$trackSearch.attr("disabled","disabled")}else{var n=$(e.getSelectedTrack()[0]).attr("data-uid");e.track.$trackList.find("li[data-id]").remove();for(var r in t)e.getRenderedHtml(e.CLASS+"-track-node",{id:r,uid:t[r].uid,name:t[r].name?t[r].name.trim():""},function(t){e.track.$trackList.append(t)});e.setSelectedTrack(e.track.$trackList.find('li[data-uid="'+n+'"]'));e.track.$trackSearch.removeAttr("disabled")}})};e.simulateTrack=function(e){var t=this;t.simulate_speed=1;t.drawTrack(e,!1);t.wrap.simulateTrack()};e.drawTrack=function(e,t){var n=this;c.call(n);n.getLayer(n.Const.Layers.TRACK).then(function(t){n.setSelectedTrack(e);n.drawTrackingData(e);n.elevationTrack(e)})};var b;e.elevationTrack=function(e,t){var n=this;if(t){n.wrap.simulateTrackEnd();n.uiSimulate(!1,e)}if(!b){b=n.elevationTrack.bind(n,e,!0);window.addEventListener("resize",b,!1)}var r={},i={},a=0;n.chart={coordinates:[]};n.track.elevationChart&&(n.track.elevationChart=n.track.elevationChart.destroy());var s=function(e){var t,s,o=new $.Deferred;t=[];s=[];n.getTrackingData(e).then(function(e){if(e)for(var l=(new ol.format.GeoJSON).readFeatures(e),c=0;c<l.length;c++){var u=l[c].getGeometry(),h=function(){var e=u.getLength();return parseFloat((e/1e3).toFixed(2))},p=function(){if(u.getLayout()==ol.geom.GeometryLayout.XYZM){var e=u.getLastCoordinate()[3]-u.getFirstCoordinate()[3];return{s:Math.floor(e/1e3%60),m:Math.floor(e/6e4%60),h:Math.floor(e/36e5%24)}}return null},d=function(e){if(e&&e.length>0&&e[0].length>2){for(var t=0,r=0,i=0,a=0,s=0,o=!0,l=0;l<e.length;l++){var c=e[l],u=c[2];if(0==l){i=u;a=u;s=u}a=Math.min(a,u);s=Math.max(s,u);var h=u-i;if(h>n.gapHill||h>0&&l==e.length-1){if(o)t+=h;else{r-=a-i;t+=u-a;o=!0}i=u;a=u;s=u}else if(h<-n.gapHill||0>h&&l==e.length-1){if(o){t+=s-i;r-=u-s;o=!1}else r-=h;i=u;a=u;s=u}}return{upHill:Math.round(t),downHill:Math.round(r)}}return null};switch(u.getType().toLowerCase()){case"point":continue;case"linestring":i=p(u);a=h(u);r=d(u.getCoordinates());n.chart.coordinates=n.chart.coordinates.concat(u.getCoordinates());break;case"multilinestring":for(var f,m=u.getLineStrings(),c=0;c<m.length;c++){a+=h(m[c]);m[c].getLayout()==ol.geom.GeometryLayout.XYZM&&(f+=m[c].getLastCoordinate()[3]-m[c].getFirstCoordinate()[3]);n.chart.coordinates=n.chart.coordinates.concat(m[c].getCoordinates())}f&&(i=p(f));break;default:return null}if(n.chart.coordinates.length>0){var y=0;t.push(y);for(var c=1;c<=n.chart.coordinates.length-1;c++){var g=n.chart.coordinates[c],v=n.chart.coordinates[c-1];y+=Math.hypot(g[0]-v[0],g[1]-v[1]);t.push(parseFloat(y.toFixed(2)))}}for(var C,L,T=!0,c=0;c<n.chart.coordinates.length;c++){if(!(n.chart.coordinates[c].length>2))return o.resolve(null);var w=Math.round(10*n.chart.coordinates[c][2])/10;T&&w>0&&(T=!1);s.push(w);0==c&&(C=L=w);C=Math.min(C,w);L=Math.max(L,w)}}s instanceof Array&&0==s.length&&(T=!0);n.chartData=T?null:$.extend({},{time:i,ele:s,x:t,miny:C,maxy:L},r);return o.resolve(n.chartData)});return o};s(e).then(function(e){var t=TC.Util.getMapLocale(n.map);if(null!=e){e.time&&(e.time=("00000"+e.time.h).slice(-2)+":"+("00000"+e.time.m).slice(-2)+":"+("00000"+e.time.s).slice(-2));var r=(n.map.options.pointBoundsRadius,{height:Modernizr.mq("(min-width: 50em)")?128:70,width:Modernizr.mq("(min-width: 50em)")?445:Modernizr.mq("(min-width: 40em)")?310:215});e=$.extend({},e,{size:{height:r.height,width:r.width},data:{x:"x",columns:[["x"].concat(e.x),["ele"].concat(e.ele)],types:{ele:"area-spline"},colors:{ele:"url(#grad1)"}},point:{show:!1},axis:{x:{tick:{count:5,format:function(e){e/=1e3;var n,r;if(1>e){n=Math.round(1e3*e);r=" m"}else{n=Math.round(100*e)/100;r=" km"}n=n.toLocaleString(t);return n+r}}},y:{padding:{top:0,bottom:0},max:e.maxy,min:e.miny,tick:{count:2,format:function(e){return parseInt(e.toFixed(0)).toLocaleString(t)+"m"}}}}});n.hasElevation=!0;n.elevationActive.set(!0)}else{n.hasElevation=!1;e={msg:n.getLocaleString("geo.trk.chart.chpe.empty")};n.elevationActive.set(!1)}if(n.resultsPanelChart)n.map.$events.trigger($.Event(n.Const.Event.DRAWTRACK),{data:e});else{TC.control.ResultsPanel||TC.syncLoadJS(TC.apiLocation+"TC/control/ResultsPanel.js");window.c3||TC.syncLoadJS(TC.Consts.url.D3C3||TC.apiLocation+"lib/d3c3/d3c3.min.js");n.resultsPanelChart=new TC.control.ResultsPanel({div:"results-panel",content:"chart",titles:{max:n.getLocaleString("geo.trk.chart.chpe")},openOn:n.Const.Event.DRAWTRACK,closeOn:n.Const.Event.CLEARTRACK,chart:{ctx:n,onmouseout:TC.control.Geolocation.prototype.removeTooltip,tooltip:TC.control.Geolocation.prototype.getTooltip}});n.resultsPanelChart.register(n.map);n.resultsPanelChart.render(function(){n.track.htmlElevationMarker=document.getElementById("tc-ctl-geolocation-track-elevation-marker");n.map.on(TC.Consts.event.RESULTSPANELMIN,function(){$(n.wrap.miDiv).hide();n.elevationActiveCollapsed.set(!0)});n.map.on(TC.Consts.event.RESULTSPANELMAX,function(){$(n.wrap.miDiv).show();n.elevationActiveCollapsed.set(!1)});n.map.on(TC.Consts.event.RESULTSPANELCLOSE,function(){$(n.wrap.miDiv).hide();n.elevationActive.set(!1)});n.map.on(TC.Consts.event.DRAWCHART,function(e,t){function i(){if(d3.select(".c3-axis-x").length&&d3.select(".c3-axis-x").node()&&!d3.select(".c3-axis-x").node().getBBox().width)n.elevationChartLabelsRAF=requestAnimationFrame(i);else{window.cancelAnimationFrame(n.elevationChartLabelsRAF);n.elevationChartLabelsRAF=void 0;(d3.select(".c3-axis-x").node().getBBox().width>=r.width-d3.select(".c3-axis-y").node().getBBox().width||100*d3.select(".c3-axis-x").node().getBBox().width/(r.width-d3.select(".c3-axis-y").node().getBBox().width)>90)&&d()}}var a=t.svg.getElementsByTagName("defs")[0],s="http://www.w3.org/2000/svg",o=document.createElementNS(s,"linearGradient");o.setAttributeNS(null,"id","grad1");o.setAttributeNS(null,"x1","0%");o.setAttributeNS(null,"x2","0%");o.setAttributeNS(null,"y1","0%");o.setAttributeNS(null,"y2","100%");o.setAttributeNS(null,"gradientUnits","userSpaceOnUse");var l=document.createElementNS(s,"stop");l.setAttributeNS(null,"offset","0%");l.setAttributeNS(null,"stop-color","red");l.setAttributeNS(null,"stop-opacity","0.7");o.appendChild(l);var c=document.createElementNS(s,"stop");c.setAttributeNS(null,"offset","50%");c.setAttributeNS(null,"stop-color","orange");c.setAttributeNS(null,"stop-opacity","0.9");o.appendChild(c);var u=document.createElementNS(s,"stop");u.setAttributeNS(null,"offset","100%");u.setAttributeNS(null,"stop-color","green");u.setAttributeNS(null,"stop-opacity","1");o.appendChild(u);a.appendChild(o);$(d3.select(".c3-brush").node()).remove();d3.select(".c3-event-rects,.c3-event-rects-single").selectAll("rect").style("cursor","pointer").on("click",function(e){d3.event.stopPropagation();var t=this.chart.coordinates[e.index].slice(0,2);t&&TC.loadJS(!TC.feature||TC.feature&&!TC.feature.Point,[TC.apiLocation+"TC/feature/Point.js"],function(){this.map.zoomToFeatures([new TC.feature.Point(t)])}.bind(n))}.bind(n));var h=d3.select(".c3-axis.c3-axis-x").select("path").attr("d"),p=/^M\d\,(\d)V\dH\d{3}V(\d)$/i.exec(h);if(p){h=h.replace(/(M\d\,)\d/i,"$10").replace(/(H\d{3}V)(\d)/i,"$10");d3.select(".c3-axis.c3-axis-x").select("path").attr("d",h)}else{var p=/^M\s\d\s(\d)\sV\s\d\sH\s\d{3}\sV\s(\d)$/i.exec(h);if(p){h=h.replace(/(M\s\d\s)\d/i,"$10").replace(/(H\s\d{3}\sV\s)(\d)/i,"$10");d3.select(".c3-axis.c3-axis-x").select("path").attr("d",h)}}var d=function(){var e=d3.scale.ordinal().rangeRoundBands([0,r.width],.1,.3);d3.select(".c3-axis-x").selectAll("text:not(.c3-axis-x-label)").call(function(e,t){e.each(function(){e.each(function(e,t){if(0!=t){d3text=d3.select(this);if(!d3text.attr("edited")){d3text.attr("edited",!0);var n=d3text.select("tspan").node().cloneNode(),r=d3text.text().split(" ");d3text.select("tspan").text(r[0]);n.textContent=r[1];var i=n.getAttribute("dy");i=i?parseFloat(n.getAttribute("dy")):.71;i=i+.18+"em";n.setAttribute("dy",i);d3text.node().appendChild(n)}}})})},e.rangeBand())};if(d3.select(".c3-axis-x").node().getBBox().width)(d3.select(".c3-axis-x").node().getBBox().width>=r.width-d3.select(".c3-axis-y").node().getBBox().width||100*d3.select(".c3-axis-x").node().getBBox().width/(r.width-d3.select(".c3-axis-y").node().getBBox().width)>90)&&d();else{if(n.elevationChartLabelsRAF){window.cancelAnimationFrame(n.elevationChartLabelsRAF);n.elevationChartLabelsRAF=void 0}n.elevationChartLabelsRAF=requestAnimationFrame(i)}});n.map.$events.trigger($.Event(n.Const.Event.DRAWTRACK),{data:e})})}})};e.clear=function(e){var t=this;if(b){window.removeEventListener("resize",b,!1);b=void 0}if(e==t.Const.Layers.TRACK){t.resultsPanelChart&&t.resultsPanelChart.close();delete t.chartData;t.wrap.simulateTrackEnd();t.track.$trackList.find("li").removeClass(t.Const.Classes.SELECTEDTRACK);if(void 0!==t.layerTrack){t.map.removeLayer(t.layerTrack);t.layerTrack=void 0}t.map.$events.trigger($.Event(t.Const.Event.CLEARTRACK),{})}else t.getLayer(e).then(function(e){t.wrap.clear(e)})};e.saveTrack=function(){var e=this,t=new $.Deferred,n=arguments.length>0?arguments[0]:"",r=function(r){e.getLayer(r).then(function(r){var i;i=e.getLoadingIndicator().addWait();var a=e.importedFileName||e.track.$trackName.val().trim(),s=e.availableTracks;s||(s={});var o=TC.getUID();s.push({name:a,data:e.wrap.formattedToStorage(r,!0),uid:parseInt(o)});s=w(s);var l=function(t){e.track.$trackName.val("");e.track.$trackName.attr("disabled","disabled");e.track.$trackSave.attr("disabled","disabled");e.track.$trackWPT.val("");e.track.$trackWPT.attr("disabled","disabled");e.track.$trackAdd.attr("disabled","disabled");e.getLoadingIndicator().removeWait(t);c.call(e)};try{e.setStoredTracks(s).then(function(){e.map.toast(n||e.getLocaleString("geo.trk.save.alert"),{duration:3e3});l(i);for(var r,a=0;a<s.length;a++)if(parseInt(s[a].uid)===parseInt(o)){r=a;break}t.resolve(r)})}catch(u){TC.alert(e.getLocaleString("geo.error.savelocalstorage")+": "+u.message);l(i);t.reject()}})};if(e.importedFileName)r(e.Const.Layers.TRACK);else if(0==e.track.$trackName.val().trim().length){e.track.$trackName.val((new Date).toLocaleString());r(e.Const.Layers.TRACKING)}else r(e.Const.Layers.TRACKING);return t};e.addWaypoint=function(){var e=this,t=e.track.$trackWPT.val().trim();t||(t=(new Date).toLocaleString());var n=e.getLoadingIndicator().addWait();c.call(e);e.wrap.addWaypoint(e.currentPoint.position,{name:t,ele:e.currentPoint.heading,time:(new Date).getTime()});e.track.$trackWPT.val("");e.track.$trackWPT.attr("disabled","disabled");e.track.$trackAdd.attr("disabled","disabled");TC.Util.storage.setSessionLocalValue(e.Const.LocalStorageKey.TRACKINGTEMP,e.wrap.formattedToStorage(e.layerTracking));e.getLoadingIndicator().removeWait(n)};e.editTrackName=function(e,t){var n=this;n.getAvailableTracks().then(function(r){if(r&&r[e]){r[e].name=t;n.setStoredTracks(r)}})};e.removeTrack=function(e){var t=this;t.getAvailableTracks().then(function(n){if(n){var r=$(e).attr("data-id");n[r]&&TC.confirm(t.getLocaleString("geo.trk.delete.alert"),function(){delete n[r];t.getSelectedTrack().length>0&&$(t.getSelectedTrack()[0]).attr("data-id")==r&&t.clear(t.Const.Layers.TRACK);t.setStoredTracks(n)},function(){})}})};e.setSelectedTrack=function(e){var t=this;t.track.$trackList.find("li[data-id] > span").each(function(){$(this).attr("title",$(this).text())});t.track.$trackList.find("li").removeClass(t.Const.Classes.SELECTEDTRACK);e.addClass(t.Const.Classes.SELECTEDTRACK);$(e).find(t.Const.Selector.DRAW).attr("title",t.getLocaleString("tr.lst.clear"))};e.getSelectedTrack=function(){var e=this;return e.track.$trackList.find("li."+e.Const.Classes.SELECTEDTRACK)};e.clearSelectedTrack=function(e){var t=this,n=t.getSelectedTrack();if(n){n.removeClass(t.Const.Classes.SELECTEDTRACK);$(n).find(t.Const.Selector.DRAW).attr("title",$(n).text())}};e.drawTrackingData=function(e){var t=this;t.wrap.clear();t.getTrackingData(e).then(function(e){e&&t.wrap.drawTrackingData(e).then(function(){})})};e.getTrackingData=function(e){var t=this,n=e,r=new $.Deferred;t.getAvailableTracks().then(function(e){if(e){var t=$(n).attr("data-id");if(e[t])return r.resolve(e[t].data)}return r.resolve()});return r};e["export"]=function(e,t){var n=this;return n.wrap["export"](e,t)};e.getTooltip=function(e){var t=this;return t.wrap.getTooltip(e)};e.removeTooltip=function(){var e=this;$(e.track.htmlElevationMarker).hide()};e.clearFileInput=function(e){var t=$(e);t.wrap("<form>").closest("form").get(0).reset();t.unwrap()};e.getLoadingIndicator=function(){var e=this;if(!e.loading){e.loading=e.map.getControlsByClass(TC.control.LoadingIndicator);e.loading&&e.loading.length>0&&(e.loading=e.loading[0])}return e.loading};e.onGeolocateError=function(e){var t=this;if(navigator.geolocation){t.currentPosition&&navigator.geolocation.clearWatch(t.currentPosition);t.currentPositionTrk&&navigator.geolocation.clearWatch(t.currentPositionTrk)}t.currentPositionWaiting&&t.getLoadingIndicator().removeWait(t.currentPositionWaiting);var n;switch(e.code){case e.PERMISSION_DENIED:n=t.getLocaleString("geo.error.permission_denied");break;case e.POSITION_UNAVAILABLE:n=t.getLocaleString("geo.error.position_unavailable");break;case e.TIMEOUT:n=t.getLocaleString("geo.error.timeout");break;default:n=t.getLocaleString("geo.error.default")}t.map.toast(n,{type:TC.Consts.msgType.WARNING});if(!t.geopositionTracking&&t.track){t.track.$activateButton.toggleClass(TC.Consts.classes.HIDDEN,!1);t.track.$deactivateButton.toggleClass(TC.Consts.classes.HIDDEN,!0)}};var S=function(e){return!e||0===e.length}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control.js");TC.control.LayerCatalog=function(){var e=this;e.layers=[];e.searchInit=!1;TC.Control.apply(e,arguments);e._readyDeferred=$.Deferred();TC.Consts.classes.SELECTABLE||(TC.Consts.classes.SELECTABLE="tc-selectable");TC.Consts.classes.INCOMPATIBLE||(TC.Consts.classes.INCOMPATIBLE="tc-incompatible");TC.Consts.classes.ACTIVE||(TC.Consts.classes.ACTIVE="tc-active");e._$div.on("mouseup.tc","li",function(t){var n=$(t.target);if(!n.hasClass(e.CLASS+"-leaf")){n.toggleClass(TC.Consts.classes.COLLAPSED);n.find("ul").first().toggleClass(TC.Consts.classes.COLLAPSED);t.stopPropagation()}})};TC.inherit(TC.control.LayerCatalog,TC.Control);!function(){var e=TC.control.LayerCatalog.prototype;e.CLASS="tc-ctl-lcat";e.template={};if(TC.isDebug){e.template[e.CLASS]=TC.apiLocation+"TC/templates/LayerCatalog.html";e.template[e.CLASS+"-branch"]=TC.apiLocation+"TC/templates/LayerCatalogBranch.html";e.template[e.CLASS+"-node"]=TC.apiLocation+"TC/templates/LayerCatalogNode.html";e.template[e.CLASS+"-info"]=TC.apiLocation+"TC/templates/LayerCatalogInfo.html";e.template[e.CLASS+"-results"]=TC.apiLocation+"TC/templates/LayerCatalogResults.html"}else{e.template[e.CLASS]=function(){function t(e,t){return e.w("<h2>").h("i18n",t,{},{$key:"availableLayers"}).x(t.get(["enableSearch"],!1),t,{block:n},{}).w('</h2><div class="tc-ctl-lcat-search tc-hidden tc-collapsed"><div class="tc-group"><input type="search" class="tc-ctl-lcat-input tc-textbox" placeholder="').h("i18n",t,{},{$key:"textToSearchInLayers"}).w('" /></div><ul></ul></div><div class="tc-ctl-lcat-tree">').x(t.get(["layerTrees"],!1),t,{"else":i,block:a},{}).w('</div><div class="tc-ctl-lcat-info tc-hidden">').p("tc-ctl-lcat-info",t,t.rebase(t.getPath(!0,[])),{}).w("</div>")}function n(e,t){return e.x(t.get(["layerTrees"],!1),t,{block:r},{})}function r(e,t){return e.w('<button class="tc-ctl-lcat-btn-search" title="').h("i18n",t,{},{$key:"searchlayersbytext"}).w('"></button>')}function i(e,t){return e.w('<div class="tc-ctl tc-ctl-lcat-loading"><span>').h("i18n",t,{},{$key:"loadingLayerTree"}).w("...</span></div>")}function a(e,t){return e.w('<ul class="tc-ctl-lcat-branch">').s(t.get(["layerTrees"],!1),t,{block:s},{}).w("</ul>")}function s(e,t){return e.p("tc-ctl-lcat-branch",t,t.rebase(t.getPath(!0,[])),{})}dust.register(e.CLASS,t);t.__dustBody=!0;n.__dustBody=!0;r.__dustBody=!0;i.__dustBody=!0;a.__dustBody=!0;s.__dustBody=!0;return t};e.template[e.CLASS+"-branch"]=function(){function t(e,t){return e.w("<li ").x(t.get(["children"],!1),t,{"else":n,block:r},{}).w(' data-tc-layer-name="').f(t.get(["name"],!1),t,"h").w('" data-tc-layer-uid="').f(t.get(["uid"],!1),t,"h").w('"><span>').f(t.get(["title"],!1),t,"h").w('</span><ul class="tc-ctl-lcat-branch tc-collapsed">').s(t.get(["children"],!1),t,{block:i},{}).w("</ul></li>")}function n(e,t){return e.w('class="tc-ctl-lcat-node tc-ctl-lcat-leaf"')}function r(e,t){return e.w('class="tc-ctl-lcat-node tc-collapsed"')}function i(e,t){return e.p("tc-ctl-lcat-node",t,t.rebase(t.getPath(!0,[])),{})}dust.register(e.CLASS+"-branch",t);t.__dustBody=!0;n.__dustBody=!0;r.__dustBody=!0;i.__dustBody=!0;return t};e.template[e.CLASS+"-node"]=function(){function t(e,t){return e.x(t.get(["isVisible"],!1),t,{block:n},{})}function n(e,t){return e.w("<li ").x(t.get(["children"],!1),t,{"else":r,block:i},{}).w(' data-tc-layer-name="').f(t.get(["name"],!1),t,"h").w('" data-tc-layer-uid="').f(t.get(["uid"],!1),t,"h").w('"><span data-tooltip="').x(t.get(["name"],!1),t,{block:a},{}).w('">').f(t.get(["title"],!1),t,"h").w("</span>").x(t.get(["name"],!1),t,{block:s},{}).w('<ul class="tc-ctl-lcat-branch tc-collapsed">').s(t.get(["children"],!1),t,{block:o},{}).w("</ul></li>")}function r(e,t){return e.w('class="tc-ctl-lcat-node tc-ctl-lcat-leaf"')}function i(e,t){return e.w('class="tc-ctl-lcat-node tc-collapsed"')}function a(e,t){return e.h("i18n",t,{},{$key:"clickToAddToMap"})}function s(e,t){return e.w('<a class="tc-ctl-lcat-btn-info"/>')}function o(e,t){return e.p("tc-ctl-lcat-node",t,t.rebase(t.getPath(!0,[])),{})}dust.register(e.CLASS+"-node",t);t.__dustBody=!0;n.__dustBody=!0;r.__dustBody=!0;i.__dustBody=!0;a.__dustBody=!0;s.__dustBody=!0;o.__dustBody=!0;return t};e.template[e.CLASS+"-info"]=function(){function t(e,t){return e.w('<a class="tc-ctl-lcat-info-close"></a><h2>').h("i18n",t,{},{$key:"layerInfo"}).w('</h2><h3 class="tc-ctl-lcat-title">').f(t.get(["title"],!1),t,"h").w("</h3>").x(t.get(["abstract"],!1),t,{block:n},{}).x(t.get(["metadata"],!1),t,{block:r},{})}function n(e,t){return e.w('<div class="tc-ctl-lcat-abstract"><h4>').h("i18n",t,{},{$key:"abstract"}).w("</h4><div>").f(t.get(["abstract"],!1),t,"h").w("</div></div>")}function r(e,t){return e.w('<div class="tc-ctl-lcat-metadata"><h4>').h("i18n",t,{},{$key:"metadata"}).w("</h4><ul>").s(t.get(["metadata"],!1),t,{block:i},{}).w("</ul></div>")}function i(e,t){return e.w('<li><a href="').f(t.get(["url"],!1),t,"h").w('" target="_blank">').f(t.get(["formatDescription"],!1),t,"h").w("</a></li>")}dust.register(e.CLASS+"-info",t);t.__dustBody=!0;n.__dustBody=!0;r.__dustBody=!0;i.__dustBody=!0;return t};e.template[e.CLASS+"-results"]=function(){function t(e,t){return e.s(t.get(["results"],!1),t,{"else":n,block:r},{})}function n(e,t){return e.w('<li class="tc-ctl-lcat-no-results"><h5>').h("i18n",t,{},{$key:"geo.noFilteredTracks"}).w("</h5></li>")}function r(e,t){return e.w('<li data-tc-layer-name="').f(t.get(["Name"],!1),t,"h").w('" ').x(t.get(["alreadyAdded"],!1),t,{"else":i,block:a},{}).w('><h5 class="tc-selectable">').f(t.get(["Title"],!1),t,"h").w('</h5><button class="tc-ctl-lcat-search-btn-info" /><p>').f(t.get(["Abstract"],!1),t,"h").w("</p></li>")}function i(e,t){return e.w(' data-tooltip="').h("i18n",t,{},{$key:"clickToAddToMap"}).w('" ')}function a(e,t){return e.w(' data-tooltip="').h("i18n",t,{},{$key:"layerAlreadyAdded"}).w('" class="tc-checked" ')}dust.register(e.CLASS+"-results",t);t.__dustBody=!0;n.__dustBody=!0;r.__dustBody=!0;i.__dustBody=!0;a.__dustBody=!0;return t}}!function(){var t={LAYER:"tcLayer",LAYERNAME:"tcLayerName",LAYERINFO:"tcLayerInfo"},n=3,r="data-tooltip";e.register=function(e){var n=this;TC.Control.prototype.register.call(n,e);var i=function(){if($.isArray(n.options.layers)){for(var e=0;e<n.options.layers.length;e++){var t=n.options.layers[e];if(!t.type||t.type===TC.Consts.layerType.WMS){t.id||(t.id=TC.getUID());$.isPlainObject(t)&&(t=new TC.layer.Raster(t));n.layers.push(t)}}n.render(function(){n._readyDeferred.resolve()})}else n._readyDeferred.resolve()},a=function(t){if(t.layer===e.baseLayer){i();e.off(TC.Consts.event.LAYERUPDATE,a)}};e.loaded(function(){e.baseLayer.state&&e.baseLayer.state!==TC.Layer.state.IDLE?e.on(TC.Consts.event.LAYERUPDATE,a):i()});var s=function(e){var r=$();if(!e.isBase){var i=e.options.url;n._$roots&&n._$roots.each(function(n,a){var s=$(a),o=s.data(t.LAYER);o&&o.type===e.type&&o.options.url===i&&(r=r.add(s))})}return r},o=function(e,t){var n=$(),r=t||s(e);if(r.length)for(var i=0;i<e.names.length;i++){var a=r.find('li[data-tc-layer-name="'+e.names[i]+'"]');n=n.add(a);n=n.add(a.find("li"))}return n},l=function(e){var r=$();if(!e.isBase){var i=e.options.url;n.$list&&n.$list.find("li").each(function(n,a){var s=$(a),o=s.data(t.LAYER);if(o&&o.type===e.type&&o.options.url===i)for(var l=0;l<e.names.length;l++)s.is('li[data-tc-layer-name="'+e.names[l]+'"]')&&(r=r.add(s))})}return r},c=function(){if("createEvent"in document){var e=document.createEvent("HTMLEvents");e.initEvent("keyup",!1,!0);n.$text&&n.$text[0].dispatchEvent(e)}else n.$text&&n.$text[0].fireEvent("keyup")},u=function(e){var t=n.map.getControlsByClass(TC.control.ListTOC)[0];if(t)for(var i=t.layers,a=0;a<i.length;a++){var s=i[a];s!==e&&o(s).addClass(TC.Consts.classes.CHECKED).find("span").attr(r,h)}},h=n.getLocaleString("layerAlreadyAdded"),p=n.getLocaleString("clickToAddToMap");e.on(TC.Consts.event.BEFORELAYERADD+" "+TC.Consts.event.BEFOREUPDATEPARAMS,function(e){o(e.layer).hasClass(TC.Consts.classes.LOADING)||o(e.layer).addClass(TC.Consts.classes.LOADING).find("span").removeAttr(r)}).on(TC.Consts.event.LAYERADD+" "+TC.Consts.event.UPDATEPARAMS,function(e){var t=e.layer;t.isBase||t.type!==TC.Consts.layerType.WMS||n._readyDeferred.then(function(){var e=s(t),i=function(){o(t,e).removeClass(TC.Consts.classes.LOADING).addClass(TC.Consts.classes.CHECKED).find("span").attr(r,h);c()};if(e.length)i();else{for(var a=!1,l=0,u=n.layers.length;u>l;l++){var p=n.layers[l];if(p.type===t.type&&p.options.url===t.options.url){a=!0;break}}a||n.addLayer(new TC.layer.Raster({url:t.options.url,type:t.type,layerNames:[],title:t.title||t.wrap.getServiceTitle(),hideTitle:!0,hideTree:!1})).then(function(){e=s(t);i()})}})}).on(TC.Consts.event.LAYERERROR,function(e){e.reason&&TC.alert(n.getLocaleString(e.reason,{url:e.layer.url}));o(e.layer).removeClass(TC.Consts.classes.LOADING)}).on(TC.Consts.event.LAYERREMOVE,function(e){o(e.layer).removeClass(TC.Consts.classes.CHECKED).find("span").attr(r,p);l(e.layer).removeClass(TC.Consts.classes.CHECKED).attr(r,p);u(e.layer);c()}).on(TC.Consts.event.EXTERNALSERVICEADDED,function(e){if(e&&e.layer){n.addLayer(e.layer);n._$div.removeClass("tc-collapsed")}});n._$div.on(TC.Consts.event.CLICK,"span",function(i){var a=$(i.target),s=a.parent();if(!s.hasClass(TC.Consts.classes.LOADING)&&!s.hasClass(TC.Consts.classes.CHECKED)){i.preventDefault;var o=s.data(t.LAYERNAME);o=void 0!==o?o.toString():"";var l=n._$roots.has(s).data(t.LAYER);l||(l=s.data(t.LAYER));if(l&&o){var c=1;/iPad/i.test(navigator.userAgent)?c=10:TC.Util.detectFirefox()&&(c=250);l.title||(l.title=l.getTree().title);s.addClass(TC.Consts.classes.LOADING).find("span").attr(r,"");var u=function(e){var t=new $.Deferred;setTimeout(function(){e[0].offsetHeight=e[0].offsetHeight;e[0].offsetWidth=e[0].offsetWidth;t.resolve()},c);return t.promise()};u(s).then(function(){e.addLayer({id:TC.getUID(),url:l.options.url,hideTitle:l.options.hideTitle,title:l.title,layerNames:[o]});i.stopPropagation()})}}})};e.render=function(e){var i=this,a=$.map(i.layers,function(e){return e.wrap.getLayer()});$.when.apply(i,a).then(function(){var a=$.map(i.layers,function(e){var t=e.getTree(),n=function r(t){for(var n=!1,i=0;i<t.children.length;i++)r(t.children[i])&&(n=!0);t.hasOwnProperty("isVisible")&&(t.isVisible=!e.names||!e.names.length||n||t.isVisible);return t.isVisible};n(t);return t});i.renderData({layerTrees:a,enableSearch:i.options.enableSearch},function(){var a=i.getLocaleString("layerAlreadyAdded");i._$roots=i._$div.find("div."+i.CLASS+"-tree > ul."+i.CLASS+"-branch > li."+i.CLASS+"-node");i._$roots.each(function(e,n){var s=i.layers[e],o=$(n).data(t.LAYER,s),l=o.find("a."+i.CLASS+"-btn-info"),c={};l.each(function(e,n){var o=$(n),l=o.parent().find("span").first(),u=o.parent().data(t.LAYERNAME).toString();if(u){l.addClass(TC.Consts.classes.SELECTABLE);var h=s.wrap.getInfo(u);if(h.hasOwnProperty("abstract")||h.hasOwnProperty("legend")||h.hasOwnProperty("metadata")){if(h.metadata)for(var p=0,d=h.metadata.length;d>p;p++){var f=h.metadata[p];f.formatDescription=c[f.format]=c[f.format]||i.getLocaleString(TC.Util.getSimpleMimeType(f.format))||i.getLocaleString("viewMetadata")}o.data(t.LAYERINFO,h);o.on(TC.Consts.event.CLICK,function(){if($(this).hasClass(TC.Consts.classes.CHECKED)){$(this).removeClass(TC.Consts.classes.CHECKED);i.hideLayerInfo()}else{i.showLayerInfo(s,u);$(this).addClass(TC.Consts.classes.CHECKED)}})}else o.remove();s.compatibleLayers&&s.compatibleLayers.indexOf(u)<0&&l.parent().append('<span class="'+TC.Consts.classes.INCOMPATIBLE+'" title="'+i.getLocaleString("srsNotCompatible")+'"></span>');if(i.map)for(var p=0,d=i.map.workLayers.length;d>p;p++){var m=i.map.workLayers[p];if(m.type===TC.Consts.layerType.WMS&&m.url===s.url&&1===m.names.length&&m.names[0]===u){l.parent().addClass(TC.Consts.classes.CHECKED);l.attr(r,a)}}}else{l.attr(r,"");o.remove()}})});i.$text=i._$div.find("."+i.CLASS+"-input");i.$list=i._$div.find("."+i.CLASS+"-search ul");i.$text.on("mouseup",function(e){var t=i.$text.val();""!==t&&setTimeout(function(){var e=i.$text.val();""===e&&i.$list.empty()},1)});var s=[];TC._search=TC._search||{};TC._search.retryTimeout=null;TC.loadJS(!i.$text.autocomplete,[TC.apiLocation+"lib/jQuery/autocomplete.js"],function(){i.$text.autocomplete({link:"#",target:i.$list,minLength:0,source:function(e,r){s=[];i._$roots.find("li."+TC.Consts.classes.CHECKED).each(function(e,n){s.push($(n).data(t.LAYERNAME).toString())});e=e.trim();if(e.length<n)i.$list.html("");else if(e.length>=n){TC._search.retryTimeout&&clearTimeout(TC._search.retryTimeout);TC._search.retryTimeout=setTimeout(function(){var t=i.layers[0].searchSubLayers(e);r(t)},TC._search.interval)}},callback:function(e){i.$text.val(e.target.text||e.target.innerText);TC._search.lastPattern=i.$text.val();i.goToResult(unescape(e.target.hash).substring(1));i.$text.autocomplete("clear")},buildHTML:function(e){if(e.results.length>0)for(var t=i.map.getLayerTree().workLayers,n=0;n<e.results.length;n++){delete e.results[n].alreadyAdded;for(var r=0;r<t.length;r++)if(s.indexOf(e.results[n].Name)>=0){e.results[n].alreadyAdded=!0;break}if(!e.results[n].Name){e.results.splice(n,1);n--}}var a="";dust.render(i.CLASS+"-results",e,function(e,t){a=t});return a}})});if(!i.searchInit){i._$div.on("click","h2 button",function(){var e=i._$div.hasClass("tc-collapsed");i._$div.removeClass("tc-collapsed");var t=i._$div.find("."+i.CLASS+"-search"),n=i._$div.find("."+i.CLASS+"-tree"),r=i._$div.find("."+i.CLASS+"-info");if(t.hasClass(TC.Consts.classes.HIDDEN)||e){t.removeClass(TC.Consts.classes.HIDDEN);n.addClass(TC.Consts.classes.HIDDEN);r.addClass(TC.Consts.classes.HIDDEN);i.$text[0].focus();$(this).addClass(i.CLASS+"-btn-tree");$(this).attr("title",i.getLocaleString("viewAvailableLayersTree"));$(this).removeClass(i.CLASS+"-btn-search")}else{t.addClass(TC.Consts.classes.HIDDEN);n.removeClass(TC.Consts.classes.HIDDEN);$(this).addClass(i.CLASS+"-btn-search");$(this).attr("title",i.getLocaleString("searchLayersByText"));$(this).removeClass(i.CLASS+"-btn-tree")}});i._$div.on("click",".tc-ctl-lcat-search button",function(e){e.stopPropagation();var t=$(this).parents("li:first");if(t.hasClass(TC.Consts.classes.ACTIVE))t.removeClass(TC.Consts.classes.ACTIVE);else{$(this).parents("ul:first").find("li."+TC.Consts.classes.ACTIVE).removeClass(TC.Consts.classes.ACTIVE);t.addClass(TC.Consts.classes.ACTIVE)}});i._$div.on("click",".tc-ctl-lcat-search li",function(e){e.stopPropagation();var n=$(this),s=n.data(t.LAYERNAME);s=void 0!==s?s.toString():"";if(!$(this).hasClass(TC.Consts.classes.CHECKED)){var o=i.layers[0].options.url,l=i.layers[0].title;i.map.addLayer({id:TC.getUID(),url:o,title:l,hideTitle:!0,layerNames:[s]},function(e){n.data(t.LAYER,e)});$(this).addClass(TC.Consts.classes.CHECKED);$(this).attr(r,a)}});i.searchInit=!0}$.isFunction(e)&&e()})})};e.showLayerInfo=function(e,n){var r=this,i=null,a=r._$div.find("."+r.CLASS+"-info"),s=function(e,n){var i=!1,s=a.data(t.LAYERNAME);if(void 0!==s&&s.toString()===e){a.data(t.LAYERNAME,"");a.removeClass(TC.Consts.classes.HIDDEN)}else if(n){i=!0;a.data(t.LAYERNAME,e);a.removeClass(TC.Consts.classes.HIDDEN);dust.render(r.CLASS+"-info",n,function(e,t){a.html(t);e&&TC.error(e);a.find("."+r.CLASS+"-info-close").on(TC.Consts.event.CLICK,function(){r.hideLayerInfo()})})}return i};r._$roots.find("a."+r.CLASS+"-btn-info").removeClass(TC.Consts.classes.CHECKED);r._$roots.each(function(a,o){var l=$(o);if(l.data(t.LAYER)===e){var c=l.find("a."+r.CLASS+"-btn-info");c.each(function(e,r){var a=$(r),o=a.parent().data(t.LAYERNAME).toString();

if(o===n){var l=a.data(t.LAYERINFO);a.toggleClass(TC.Consts.classes.CHECKED,s(o,l));i=l;return!1}});return!1}});return i}}();e.hideLayerInfo=function(){var e=this;e._$roots.find("a."+e.CLASS+"-btn-info").removeClass(TC.Consts.classes.CHECKED);e._$div.find("."+e.CLASS+"-info").addClass(TC.Consts.classes.HIDDEN)};e.addLayer=function(e){var t=$.Deferred(),n=this,r=[];n.options.layers&&n.options.layers.length&&(r=$.grep(n.options.layers,function(t){var n=TC.Util.reqGetMapOnCapabilities(t.url);return n&&n.replace(TC.Util.regex.PROTOCOL)==e.url.replace(TC.Util.regex.PROTOCOL)}));0==r.length&&(r=$.grep(n.layers,function(t){return t.url.replace(TC.Util.regex.PROTOCOL)==e.url.replace(TC.Util.regex.PROTOCOL)}));if(0==r.length){n.layers.push(e);e.getCapabilitiesPromise().then(function(){e.compatibleLayers=e.wrap.getCompatibleLayers(n.map.crs);e.title=e.title||e.wrap.getServiceTitle();n.render(function(){t.resolve()})})}else t.resolve();return t}}();TC.control=TC.control||{};TC.control.MapContents||TC.syncLoadJS(TC.apiLocation+"TC/control/MapContents.js");TC.control.Legend=function(){TC.control.MapContents.apply(this,arguments)};TC.inherit(TC.control.Legend,TC.control.MapContents);!function(){var e=TC.control.Legend.prototype;e.CLASS="tc-ctl-legend";e.template={};if(TC.isDebug){e.template[e.CLASS]=TC.apiLocation+"TC/templates/Legend.html";e.template[e.CLASS+"-node"]=TC.apiLocation+"TC/templates/LegendNode.html"}else{e.template[e.CLASS]=function(){function t(e,t){return e.w("<h2>").h("i18n",t,{},{$key:"legend"}).w('</h2><div class="tc-ctl-legend-tree"><ul class="tc-ctl-legend-branch">').s(t.get(["workLayers"],!1),t,{"else":n,block:r},{}).w("</ul></div>")}function n(e,t){return e.w('<li class="tc-ctl-legend-empty">').h("i18n",t,{},{$key:"noData"}).w("</li>")}function r(e,t){return e.p("tc-ctl-legend-node",t,t.rebase(t.getPath(!0,[])),{})}dust.register(e.CLASS,t);t.__dustBody=!0;n.__dustBody=!0;r.__dustBody=!0;return t};e.template[e.CLASS+"-node"]=function(){function t(e,t){return e.w("<li ").x(t.get(["children"],!1),t,{"else":n,block:r},{}).w(' data-tc-layer-name="').f(t.get(["name"],!1),t,"h").w('" data-tc-layer-uid="').f(t.get(["uid"],!1),t,"h").w('"><div class="tc-ctl-legend-title">').f(t.get(["title"],!1),t,"h").w("</div>").x(t.get(["legend"],!1),t,{block:i},{}).w('<ul class="tc-ctl-legend-branch">').s(t.get(["children"],!1),t,{block:c},{}).w("</ul></li>")}function n(e,t){return e.w('class="tc-ctl-legend-node tc-ctl-legend-leaf" ')}function r(e,t){return e.w('class="tc-ctl-legend-node" ')}function i(e,t){return e.w('<div class="tc-ctl-legend-watch">').x(t.getPath(!1,["legend","src"]),t,{"else":a,block:o},{}).w('</div><div class="tc-ctl-legend-nvr">').h("i18n",t,{},{$key:"notVisibleAtCurrentResolution"}).w("</div>")}function a(e,t){return e.w('<div class="tc-ctl-legend-img" style="border:solid ').f(t.getPath(!1,["legend","strokeWidth"]),t,"h").w("px ").f(t.getPath(!1,["legend","strokeColor"]),t,"h").w(";background-color:").f(t.getPath(!1,["legend","fillColor"]),t,"h").x(t.getPath(!1,["legend","width"]),t,{block:s},{}).w('"></div>')}function s(e,t){return e.w(";width:").f(t.getPath(!1,["legend","width"]),t,"h").w("px;height:").f(t.getPath(!1,["legend","height"]),t,"h").w("px;border-radius:50%")}function o(e,t){return e.w('<img src="" data-tc-img="').f(t.getPath(!1,["legend","src"]),t,"h").w('" ').x(t.getPath(!1,["legend","width"]),t,{block:l},{}).w(" />")}function l(e,t){return e.w('style="width:').f(t.getPath(!1,["legend","width"]),t,"h").w("px;height:").f(t.getPath(!1,["legend","height"]),t,"h").w('px;"')}function c(e,t){return e.p("tc-ctl-legend-node",t,t.rebase(t.getPath(!0,[])),{})}dust.register(e.CLASS+"-node",t);t.__dustBody=!0;n.__dustBody=!0;r.__dustBody=!0;i.__dustBody=!0;a.__dustBody=!0;s.__dustBody=!0;o.__dustBody=!0;l.__dustBody=!0;c.__dustBody=!0;return t}}var t={layer:"tcLayer",layerUid:"tcLayerUid"};e.register=function(e){var t=this;TC.control.MapContents.prototype.register.call(t,e)};e.updateScale=function(){var e=this,n=e.CLASS+"-node-inscale",r=e.CLASS+"-node-outofscale";e._$div.find("ul."+e.CLASS+"-branch").first().children("li").not("."+e.CLASS+"-empty").each(function(i,a){var s=$(a),o=s.data(t.layer),l=!1;s.find("li").each(function(i,a){var s=$(a);if(s.hasClass(e.CLASS+"-node-visible")){var c=s.data(t.layerUid);if(o.isVisibleByScale(c)){l=!0;s.removeClass(r).addClass(n);var u=s.find("img").first();u.length>0&&e.styleLegendImage(u,o)}else s.addClass(r).removeClass(n)}});s.toggleClass(n,l);s.toggleClass(r,!l)})};e.update=function(){var e=this;e._$div.find("ul."+e.CLASS+"-branch").first().children("li").each(function(n,r){var i=$(r),a=i.data(t.layer);if(a){a.getTree();i.find("li").each(function(n,r){var i=$(r),s=i.data(t.layerUid),o=e.CLASS+"-node-visible",l=e.CLASS+"-node-notvisible",c=e.CLASS+"-node-hasvisible";switch(a._cache.visibilityStates[s]){case TC.Consts.visibility.NOT_VISIBLE:i.removeClass(o+" "+c).addClass(l);break;case TC.Consts.visibility.HAS_VISIBLE:i.removeClass(o+" "+l).addClass(c);break;default:i.removeClass(l+" "+c).addClass(o)}});e.updateLayerVisibility(a)}});e.updateScale()};e.updateLayerTree=function(e){var n=this;if(!e.isBase&&!e.options.stealth){TC.control.MapContents.prototype.updateLayerTree.call(n,e);n._$div.find("."+n.CLASS+"-empty").addClass(TC.Consts.classes.HIDDEN);TC.loadJSInOrder(!window.dust,TC.url.templating,function(){dust.render(n.CLASS+"-node",n.layerTrees[e.id],function(r,i){var a=$(i),s=a.data(t.layerUid),o=n._$div.find("ul."+n.CLASS+"-branch").first(),l=o.find('li[data-tc-layer-uid="'+s+'"]');if(1===l.length)l.html(a.html());else{a.data(t.layer,e);o.prepend(a)}r&&TC.error(r)});n.update()})}};e.removeLayer=function(e){var n=this,r=function(){return n._$div.find("."+n.CLASS+"-branch").first().children("li").not("."+n.CLASS+"-empty")};if(!e.isBase){var i=r();i.each(function(n,a){var s=$(a);if(s.data(t.layer)===e){s.remove();i=r();return!1}});0===i.length&&n._$div.find("."+n.CLASS+"-empty").removeClass(TC.Consts.classes.HIDDEN)}};e.updateLayerVisibility=function(e){var n=this;n._$div.find("."+n.CLASS+"-branch").first().children("li").each(function(r,i){var a=$(i);if(a.data(t.layer)===e){a.toggleClass(n.CLASS+"-node-notvisible",!e.getVisibility());return!1}})}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control.js");TC.control.LoadingIndicator=function(){var e=this;TC.Control.apply(e,arguments);window.addEventListener("error",function(){e.reset();return!1},!1)};TC.inherit(TC.control.LoadingIndicator,TC.Control);!function(){var e=TC.control.LoadingIndicator.prototype;e.CLASS="tc-ctl-load";e.template=TC.isDebug?TC.apiLocation+"TC/templates/LoadingIndicator.html":function(){function t(e,t){return e.w('<div class="tc-ctl-load-bar"><div class="tc-ctl-load-dots tc-ctl-load-dot1"> </div><div class="tc-ctl-load-dots tc-ctl-load-dot2"> </div><div class="tc-ctl-load-dots tc-ctl-load-dot3"> </div><div class="tc-ctl-load-dots tc-ctl-load-dot4"> </div><div class="tc-ctl-load-dots tc-ctl-load-dot5"> </div><div class="tc-ctl-load-dots tc-ctl-load-dot6"> </div><div class="tc-ctl-load-dots tc-ctl-load-dot7"> </div><div class="tc-ctl-load-dots tc-ctl-load-dot8"> </div></div>')}dust.register(e.CLASS,t);t.__dustBody=!0;return t};e.waits={};e.startWait=function(t){var n=this;void 0===e.waits[t.layer.id]&&(e.waits[t.layer.id]=0);e.waits[t.layer.id]=e.waits[t.layer.id]+1;n.show();n.map.$events.trigger($.Event(TC.Consts.event.STARTLOADING))};e.stopWait=function(t){var n=this,r=e.waits[t.layer.id];r>0&&(r=e.waits[t.layer.id]=r-1);r||delete e.waits[t.layer.id];var i=0;for(var a in e.waits)i++;if(!i){n.map?n.map.isLoaded&&n.hide():n.hide();n.map.$events.trigger($.Event(TC.Consts.event.STOPLOADING))}};e.reset=function(t){var n=this;e.waits={};n.hide();n.map.$events.trigger($.Event(TC.Consts.event.STOPLOADING))};e.register=function(e){var t=this;TC.Control.prototype.register.call(t,e);e.on(TC.Consts.event.BEFORELAYERADD+" "+TC.Consts.event.BEFORELAYERUPDATE+" "+TC.Consts.event.BEFOREFEATURESADD,function(e){t.startWait(e)}).on(TC.Consts.event.LAYERADD+" "+TC.Consts.event.LAYERERROR+" "+TC.Consts.event.LAYERUPDATE+" "+TC.Consts.event.FEATURESADD,function(e){t.stopWait(e)}).on(TC.Consts.event.BEFOREFEATUREINFO,function(e){t.addWait(TC.Consts.event.FEATUREINFO)}).on(TC.Consts.event.FEATUREINFO+" "+TC.Consts.event.NOFEATUREINFO,function(e){t.removeWait(TC.Consts.event.FEATUREINFO)});if(!TC.isDebug){window.addEventListener("error",function(e,n,r,i,a){t.reset();return!1});$(document).ajaxError(function(e,n,r){t.reset()})}};e.addWait=function(e){var t,n=this,t=e||TC.getUID();n.startWait({layer:{id:t}});return t};e.removeWait=function(e){this.stopWait({layer:{id:e}})}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control.js");TC.Consts.event.POINT="point.tc";TC.control.Measure=function(){var e=this;TC.Control.apply(e,arguments);this.renderPromise().then(function(){e.measureMode=e.options.mode;e.history=[];e.historyIndex=0;e.reset=!0;e.wrap=new TC.wrap.control.Measure(e);e._$len=e._$div.find(".tc-ctl-meas-val-len");e._$area=e._$div.find(".tc-ctl-meas-val-area");e._$peri=e._$div.find(".tc-ctl-meas-val-peri");e.setMode(e.options.mode)})};TC.inherit(TC.control.Measure,TC.Control);!function(){var e=TC.control.Measure.prototype;e.CLASS="tc-ctl-meas";e.template=TC.isDebug?TC.apiLocation+"TC/templates/Measure.html":function(){function t(e,t){return e.w("<h2>").h("i18n",t,{},{$key:"measure"}).w('</h2><div class="tc-ctl-meas-select"><form><label class="tc-ctl-meas-btn-len"><input type="radio" name="mode" value="polyline" /><span>').h("i18n",t,{},{$key:"length"}).w('</span></label><label class="tc-ctl-meas-btn-area"><input type="radio" name="mode" value="polygon" /><span>').h("i18n",t,{},{$key:"areaAndPerimeter"}).w('</span></label></form></div><div class="tc-ctl-meas-len tc-hidden"><div class="tc-ctl-meas-lines"></div><div class="tc-ctl-meas-txt">').h("i18n",t,{},{$key:"length"}).w(': <span class="tc-ctl-meas-val-len"></span></div></div><div class="tc-ctl-meas-area tc-hidden"><div class="tc-ctl-meas-polygon"></div><div class="tc-ctl-meas-txt">').h("i18n",t,{},{$key:"area"}).w(': <span class="tc-ctl-meas-val-area"></span>, ').h("i18n",t,{},{$key:"perimeter"}).w(': <span class="tc-ctl-meas-val-peri"></span></div></div>')}dust.register(e.CLASS,t);t.__dustBody=!0;return t};e.render=function(e){var t=this;TC.Control.prototype.render.call(t,function(){TC.loadJS(!TC.control.Draw,TC.apiLocation+"TC/control/Draw.js",function(){t.options.mode&&t._$div.find(".tc-ctl-meas-select").addClass(TC.Consts.classes.HIDDEN);t._$div.find("span").on(TC.Consts.event.CLICK,function(e){var n=$(this).closest("label").find("input[type=radio][name=mode]"),r=n.val();n.prop("checked",!0);t.setMode(r,!0)});$.isFunction(e)&&e()})})};e.register=function(e){var t=this;TC.Control.prototype.register.call(t,e);t.renderPromise().then(function(){e.loaded(function(){t.layerPromise=e.addLayer({id:TC.getUID(),title:"Medici\xf3n",stealth:!0,type:TC.Consts.layerType.VECTOR,styles:{point:$.extend({},e.options.styles.point,{fillOpacity:0}),line:e.options.styles.line,polygon:e.options.styles.polygon}});$.when(t.layerPromise).then(function(n){t.layer=n;t.layer.map.putLayerOnTop(t.layer);TC.loadJS(!TC.control.Draw,TC.apiLocation+"TC/control/Draw.js",function(){t.drawLines=new TC.control.Draw({div:t._$div.find(".tc-ctl-meas-lines"),mode:TC.Consts.geom.POLYLINE,measure:!0,layer:t.layer});t.drawPolygons=new TC.control.Draw({div:t._$div.find(".tc-ctl-meas-polygon"),mode:TC.Consts.geom.POLYGON,measure:!0,layer:t.layer});$.when(e.addControl(t.drawLines),e.addControl(t.drawPolygons)).then(function(){var e=function(e){var n="m"===e.units?0:3;e.area?t._$area.html(e.area.toFixed(n).replace(".",",")+" "+e.units+"&sup2;"):0===e.area&&t.resetValues();e.perimeter?t._$peri.html(e.perimeter.toFixed(n).replace(".",",")+" "+e.units):0===e.perimeter&&t.resetValues();e.length?t._$len.html(e.length.toFixed(n).replace(".",",")+" "+e.units):0===e.length&&t.resetValues()};t.drawLines.$events.on(TC.Consts.event.MEASURE+" "+TC.Consts.event.MEASUREPARTIAL,function(t){e(t)}).on(TC.Consts.event.DRAWCANCEL,function(){t.cancel()});t.drawPolygons.$events.on(TC.Consts.event.MEASURE+" "+TC.Consts.event.MEASUREPARTIAL,function(t){e(t)}).on(TC.Consts.event.DRAWCANCEL,function(){t.cancel()})});t.setMode(t.options.mode)})})})})};e.activate=function(){var e=this;TC.Control.prototype.activate.call(e)};e.deactivate=function(){var e=this;TC.Control.prototype.deactivate.call(e)};e.setMode=function(e,t){var n=this;n.mode=e;var r,i,a;switch(e){case TC.Consts.geom.POLYLINE:n.drawLines.activate();r=n._$div.find(".tc-ctl-meas-len");i=n._$div.find(".tc-ctl-meas-area");a=TC.Consts.event.CONTROLACTIVATE;break;case TC.Consts.geom.POLYGON:n.drawPolygons.activate();r=n._$div.find(".tc-ctl-meas-area");i=n._$div.find(".tc-ctl-meas-len");a=TC.Consts.event.CONTROLACTIVATE;break;case null:case void 0:n.drawLines&&n.drawLines.isActive&&n.drawLines.cancel();n.drawPolygons&&n.drawPolygons.isActive&&n.drawPolygons.cancel();r=$();i=n._$div.find(".tc-ctl-meas-area,.tc-ctl-meas-len");a=TC.Consts.event.CONTROLDEACTIVATE;break;default:n.drawLines.activate();r=n._$div.find(".tc-ctl-meas-area,.tc-ctl-meas-len");i=$();a=TC.Consts.event.CONTROLACTIVATE}n.resetValues();var s;if(e){s=n._$div.find("input[type=radio][name=mode][value="+e+"]").prop("checked",!0).addClass(TC.Consts.classes.CHECKED);s.next().addClass(TC.Consts.classes.CHECKED)}else{s=n._$div.find("input[type=radio][name=mode]").prop("checked",!1).removeClass(TC.Consts.classes.CHECKED);s.next().removeClass(TC.Consts.classes.CHECKED)}r.removeClass(TC.Consts.classes.HIDDEN);i.addClass(TC.Consts.classes.HIDDEN);a&&n.map&&n.map.$events.trigger($.Event(a,{control:n}));window.meas=n};e.cancel=function(){this.setMode(null,!1)};e.resetValues=function(){var e=this;e.NOMEASURE="-";if(e._$len){e._$len.text(e.NOMEASURE);e._$area.text(e.NOMEASURE);e._$peri.text(e.NOMEASURE)}}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control.js");!function(){TC.control.MultiFeatureInfo=function(){var e=this;e.bgColor=null;e.jackColor=null;e.lineColor=null;TC.Control.apply(e,arguments);e.fInfoCtrl=null;e.polygonFInfoCtrl=null;e._switch=null;e.lastCtrlActive=null;e.listTOCCtrl=null;e.popup=null};TC.inherit(TC.control.MultiFeatureInfo,TC.Control);var e=TC.control.MultiFeatureInfo.prototype;e.CLASS="tc-ctl-multiFinfo";e.template=TC.isDebug?TC.apiLocation+"TC/templates/MultiFeatureInfo.html":function(){function t(e,t){return e.w('<div class="tc-ctl-ltoc-switch"><span class="tc-ctl-ltoc-switch-text tc-ctl-ltoc-switch-text-izda">').h("i18n",t,{},{$key:"selectionByPoint"}).w('</span><input class="tc-ctl-ltoc-switch-radio" type="checkbox" /><span class="tc-ctl-ltoc-switch-text tc-ctl-ltoc-switch-text-dcha">').h("i18n",t,{},{$key:"selectionByPrecinct"}).w("</span></div>")}dust.register(e.CLASS,t);t.__dustBody=!0;return t};e.register=function(e){var t=this;TC.Control.prototype.register.call(t,e);e.loaded(function(){var n=$.Deferred(),r=$.Deferred();$.when(n,r).then(function(){t.fInfoCtrl.activate();t.lastCtrlActive=t.fInfoCtrl;t.lastCtrlActive.popup=t.popup});$.when(e.addControl("FeatureInfo")).then(function(e){t.fInfoCtrl=e;n.resolve()});$.when(e.addControl("PolygonFeatureInfo",{lineColor:t.lineColor})).then(function(e){t.polygonFInfoCtrl=e;r.resolve()})});$.when(e.addControl("popup",{closeButton:!0,draggable:t.options.draggable})).then(function(e){t.popup=e})};e.render=function(e){var t=this;t.bgColor=t.options.bgColor?t.options.bgColor:"#666";t.jackColor=t.options.jackColor?t.options.jackColor:"#c00";t.lineColor=t.options.lineColor?t.options.lineColor:"#c00";t.options["native"]||function(){function e(t){var n=e.modules[t];if(!n)throw new Error('failed to require "'+t+'"');if(!("exports"in n)&&"function"==typeof n.definition){n.client=n.component=!0;n.definition.call(this,n.exports={},n);delete n.definition}return n.exports}e.loader="component";e.helper={};e.helper.semVerSort=function(e,t){for(var n=e.version.split("."),r=t.version.split("."),i=0;i<n.length;++i){var a=parseInt(n[i],10),s=parseInt(r[i],10);if(a!==s)return a>s?1:-1;var o=n[i].substr((""+a).length),l=r[i].substr((""+s).length);if(""===o&&""!==l)return 1;if(""!==o&&""===l)return-1;if(""!==o&&""!==l)return o>l?1:-1}return 0};e.latest=function(t,n){function r(e){throw new Error('failed to find latest module of "'+e+'"')}var i=/(.*)~(.*)@v?(\d+\.\d+\.\d+[^\/]*)$/,a=/(.*)~(.*)/;a.test(t)||r(t);for(var s=Object.keys(e.modules),o=[],l=[],c=0;c<s.length;c++){var u=s[c];if(new RegExp(t+"@").test(u)){var h=u.substr(t.length+1),p=i.exec(u);null!=p?o.push({version:h,name:u}):l.push({version:h,name:u})}}0===o.concat(l).length&&r(t);if(o.length>0){var d=o.sort(e.helper.semVerSort).pop().name;return n===!0?d:e(d)}var d=l.sort(function(e,t){return e.name>t.name})[0].name;return n===!0?d:e(d)};e.modules={};e.register=function(t,n){e.modules[t]={definition:n}};e.define=function(t,n){e.modules[t]={exports:n}};e.register("abpetkov~transitionize@0.0.3",function(e,t){function n(e,t){if(!(this instanceof n))return new n(e,t);this.element=e;this.props=t||{};this.init()}t.exports=n;n.prototype.isSafari=function(){return/Safari/.test(navigator.userAgent)&&/Apple Computer/.test(navigator.vendor)};n.prototype.init=function(){var e=[];for(var t in this.props)e.push(t+" "+this.props[t]);this.element.style.transition=e.join(", ");this.isSafari()&&(this.element.style.webkitTransition=e.join(", "))}});e.register("ftlabs~fastclick@v0.6.11",function(e,t){function n(e){"use strict";var t,r=this;this.trackingClick=!1;this.trackingClickStart=0;this.targetElement=null;this.touchStartX=0;this.touchStartY=0;this.lastTouchIdentifier=0;this.touchBoundary=10;this.layer=e;if(!e||!e.nodeType)throw new TypeError("Layer must be a document node");this.onClick=function(){return n.prototype.onClick.apply(r,arguments)};this.onMouse=function(){return n.prototype.onMouse.apply(r,arguments)};this.onTouchStart=function(){return n.prototype.onTouchStart.apply(r,arguments)};this.onTouchMove=function(){return n.prototype.onTouchMove.apply(r,arguments)};this.onTouchEnd=function(){return n.prototype.onTouchEnd.apply(r,arguments)};this.onTouchCancel=function(){return n.prototype.onTouchCancel.apply(r,arguments)};if(!n.notNeeded(e)){if(this.deviceIsAndroid){e.addEventListener("mouseover",this.onMouse,!0);e.addEventListener("mousedown",this.onMouse,!0);e.addEventListener("mouseup",this.onMouse,!0)}e.addEventListener("click",this.onClick,!0);e.addEventListener("touchstart",this.onTouchStart,!1);e.addEventListener("touchmove",this.onTouchMove,!1);e.addEventListener("touchend",this.onTouchEnd,!1);e.addEventListener("touchcancel",this.onTouchCancel,!1);if(!Event.prototype.stopImmediatePropagation){e.removeEventListener=function(t,n,r){var i=Node.prototype.removeEventListener;"click"===t?i.call(e,t,n.hijacked||n,r):i.call(e,t,n,r)};e.addEventListener=function(t,n,r){var i=Node.prototype.addEventListener;"click"===t?i.call(e,t,n.hijacked||(n.hijacked=function(e){e.propagationStopped||n(e)}),r):i.call(e,t,n,r)}}if("function"==typeof e.onclick){t=e.onclick;e.addEventListener("click",function(e){t(e)},!1);e.onclick=null}}}n.prototype.deviceIsAndroid=navigator.userAgent.indexOf("Android")>0;n.prototype.deviceIsIOS=/iP(ad|hone|od)/.test(navigator.userAgent);n.prototype.deviceIsIOS4=n.prototype.deviceIsIOS&&/OS 4_\d(_\d)?/.test(navigator.userAgent);n.prototype.deviceIsIOSWithBadTarget=n.prototype.deviceIsIOS&&/OS ([6-9]|\d{2})_\d/.test(navigator.userAgent);n.prototype.needsClick=function(e){"use strict";switch(e.nodeName.toLowerCase()){case"button":case"select":case"textarea":if(e.disabled)return!0;break;case"input":if(this.deviceIsIOS&&"file"===e.type||e.disabled)return!0;break;case"label":case"video":return!0}return/\bneedsclick\b/.test(e.className)};n.prototype.needsFocus=function(e){"use strict";switch(e.nodeName.toLowerCase()){case"textarea":return!0;case"select":return!this.deviceIsAndroid;case"input":switch(e.type){case"button":case"checkbox":case"file":case"image":case"radio":case"submit":return!1}return!e.disabled&&!e.readOnly;default:return/\bneedsfocus\b/.test(e.className)}};n.prototype.sendClick=function(e,t){"use strict";var n,r;document.activeElement&&document.activeElement!==e&&document.activeElement.blur();r=t.changedTouches[0];n=document.createEvent("MouseEvents");n.initMouseEvent(this.determineEventType(e),!0,!0,window,1,r.screenX,r.screenY,r.clientX,r.clientY,!1,!1,!1,!1,0,null);n.forwardedTouchEvent=!0;e.dispatchEvent(n)};n.prototype.determineEventType=function(e){"use strict";return this.deviceIsAndroid&&"select"===e.tagName.toLowerCase()?"mousedown":"click"};n.prototype.focus=function(e){"use strict";var t;if(this.deviceIsIOS&&e.setSelectionRange&&0!==e.type.indexOf("date")&&"time"!==e.type){t=e.value.length;e.setSelectionRange(t,t)}else e.focus()};n.prototype.updateScrollParent=function(e){"use strict";var t,n;t=e.fastClickScrollParent;if(!t||!t.contains(e)){n=e;do{if(n.scrollHeight>n.offsetHeight){t=n;e.fastClickScrollParent=n;break}n=n.parentElement}while(n)}t&&(t.fastClickLastScrollTop=t.scrollTop)};n.prototype.getTargetElementFromEventTarget=function(e){"use strict";return e.nodeType===Node.TEXT_NODE?e.parentNode:e};n.prototype.onTouchStart=function(e){"use strict";var t,n,r;if(e.targetTouches.length>1)return!0;t=this.getTargetElementFromEventTarget(e.target);n=e.targetTouches[0];if(this.deviceIsIOS){r=window.getSelection();if(r.rangeCount&&!r.isCollapsed)return!0;if(!this.deviceIsIOS4){if(n.identifier===this.lastTouchIdentifier){e.preventDefault();return!1}this.lastTouchIdentifier=n.identifier;this.updateScrollParent(t)}}this.trackingClick=!0;this.trackingClickStart=e.timeStamp;this.targetElement=t;this.touchStartX=n.pageX;this.touchStartY=n.pageY;e.timeStamp-this.lastClickTime<200&&e.preventDefault();return!0};n.prototype.touchHasMoved=function(e){"use strict";var t=e.changedTouches[0],n=this.touchBoundary;return Math.abs(t.pageX-this.touchStartX)>n||Math.abs(t.pageY-this.touchStartY)>n?!0:!1};n.prototype.onTouchMove=function(e){"use strict";if(!this.trackingClick)return!0;if(this.targetElement!==this.getTargetElementFromEventTarget(e.target)||this.touchHasMoved(e)){this.trackingClick=!1;this.targetElement=null}return!0};n.prototype.findControl=function(e){"use strict";return void 0!==e.control?e.control:e.htmlFor?document.getElementById(e.htmlFor):e.querySelector("button, input:not([type=hidden]), keygen, meter, output, progress, select, textarea")};n.prototype.onTouchEnd=function(e){"use strict";var t,n,r,i,a,s=this.targetElement;if(!this.trackingClick)return!0;if(e.timeStamp-this.lastClickTime<200){this.cancelNextClick=!0;return!0}this.cancelNextClick=!1;this.lastClickTime=e.timeStamp;n=this.trackingClickStart;this.trackingClick=!1;this.trackingClickStart=0;if(this.deviceIsIOSWithBadTarget){a=e.changedTouches[0];s=document.elementFromPoint(a.pageX-window.pageXOffset,a.pageY-window.pageYOffset)||s;s.fastClickScrollParent=this.targetElement.fastClickScrollParent}r=s.tagName.toLowerCase();if("label"===r){t=this.findControl(s);if(t){this.focus(s);if(this.deviceIsAndroid)return!1;s=t}}else if(this.needsFocus(s)){if(e.timeStamp-n>100||this.deviceIsIOS&&window.top!==window&&"input"===r){this.targetElement=null;return!1}this.focus(s);if(!this.deviceIsIOS4||"select"!==r){this.targetElement=null;e.preventDefault()}return!1}if(this.deviceIsIOS&&!this.deviceIsIOS4){i=s.fastClickScrollParent;if(i&&i.fastClickLastScrollTop!==i.scrollTop)return!0}if(!this.needsClick(s)){e.preventDefault();this.sendClick(s,e)}return!1};n.prototype.onTouchCancel=function(){"use strict";this.trackingClick=!1;this.targetElement=null};n.prototype.onMouse=function(e){"use strict";if(!this.targetElement)return!0;if(e.forwardedTouchEvent)return!0;if(!e.cancelable)return!0;if(!this.needsClick(this.targetElement)||this.cancelNextClick){e.stopImmediatePropagation?e.stopImmediatePropagation():e.propagationStopped=!0;e.stopPropagation();e.preventDefault();return!1}return!0};n.prototype.onClick=function(e){"use strict";var t;if(this.trackingClick){this.targetElement=null;this.trackingClick=!1;return!0}if("submit"===e.target.type&&0===e.detail)return!0;t=this.onMouse(e);t||(this.targetElement=null);return t};n.prototype.destroy=function(){"use strict";var e=this.layer;if(this.deviceIsAndroid){e.removeEventListener("mouseover",this.onMouse,!0);e.removeEventListener("mousedown",this.onMouse,!0);e.removeEventListener("mouseup",this.onMouse,!0)}e.removeEventListener("click",this.onClick,!0);e.removeEventListener("touchstart",this.onTouchStart,!1);e.removeEventListener("touchmove",this.onTouchMove,!1);e.removeEventListener("touchend",this.onTouchEnd,!1);e.removeEventListener("touchcancel",this.onTouchCancel,!1)};n.notNeeded=function(e){"use strict";var t,r;if("undefined"==typeof window.ontouchstart)return!0;r=+(/Chrome\/([0-9]+)/.exec(navigator.userAgent)||[,0])[1];if(r){if(!n.prototype.deviceIsAndroid)return!0;t=document.querySelector("meta[name=viewport]");if(t){if(-1!==t.content.indexOf("user-scalable=no"))return!0;if(r>31&&window.innerWidth<=window.screen.width)return!0}}return"none"===e.style.msTouchAction?!0:!1};n.attach=function(e){"use strict";return new n(e)};if("undefined"!=typeof define&&define.amd)define(function(){"use strict";return n});else if("undefined"!=typeof t&&t.exports){t.exports=n.attach;t.exports.FastClick=n}else window.FastClick=n});e.register("component~indexof@0.0.3",function(e,t){t.exports=function(e,t){if(e.indexOf)return e.indexOf(t);for(var n=0;n<e.length;++n)if(e[n]===t)return n;return-1}});e.register("component~classes@1.2.1",function(t,n){function r(e){if(!e)throw new Error("A DOM element reference is required");this.el=e;this.list=e.classList}var i=e("component~indexof@0.0.3"),a=/\s+/,s=Object.prototype.toString;n.exports=function(e){return new r(e)};r.prototype.add=function(e){if(this.list){this.list.add(e);return this}var t=this.array(),n=i(t,e);~n||t.push(e);this.el.className=t.join(" ");return this};r.prototype.remove=function(e){if("[object RegExp]"==s.call(e))return this.removeMatching(e);if(this.list){this.list.remove(e);return this}var t=this.array(),n=i(t,e);~n&&t.splice(n,1);this.el.className=t.join(" ");return this};r.prototype.removeMatching=function(e){for(var t=this.array(),n=0;n<t.length;n++)e.test(t[n])&&this.remove(t[n]);return this};r.prototype.toggle=function(e,t){if(this.list){"undefined"!=typeof t?t!==this.list.toggle(e,t)&&this.list.toggle(e):this.list.toggle(e);return this}"undefined"!=typeof t?t?this.add(e):this.remove(e):this.has(e)?this.remove(e):this.add(e);return this};r.prototype.array=function(){var e=this.el.className.replace(/^\s+|\s+$/g,""),t=e.split(a);""===t[0]&&t.shift();return t};r.prototype.has=r.prototype.contains=function(e){return this.list?this.list.contains(e):!!~i(this.array(),e)}});e.register("component~event@0.1.4",function(e,t){var n=window.addEventListener?"addEventListener":"attachEvent",r=window.removeEventListener?"removeEventListener":"detachEvent",i="addEventListener"!==n?"on":"";e.bind=function(e,t,r,a){e[n](i+t,r,a||!1);return r};e.unbind=function(e,t,n,a){e[r](i+t,n,a||!1);return n}});e.register("component~query@0.0.3",function(e,t){function n(e,t){return t.querySelector(e)}e=t.exports=function(e,t){t=t||document;return n(e,t)};e.all=function(e,t){t=t||document;return t.querySelectorAll(e)};e.engine=function(t){if(!t.one)throw new Error(".one callback required");if(!t.all)throw new Error(".all callback required");n=t.one;e.all=t.all;return e}});e.register("component~matches-selector@0.1.5",function(t,n){function r(e,t){if(!e||1!==e.nodeType)return!1;if(s)return s.call(e,t);for(var n=i.all(t,e.parentNode),r=0;r<n.length;++r)if(n[r]==e)return!0;return!1}var i=e("component~query@0.0.3"),a=Element.prototype,s=a.matches||a.webkitMatchesSelector||a.mozMatchesSelector||a.msMatchesSelector||a.oMatchesSelector;n.exports=r});e.register("component~closest@0.1.4",function(t,n){var r=e("component~matches-selector@0.1.5");n.exports=function(e,t,n,i){e=n?{parentNode:e}:e;i=i||document;for(;(e=e.parentNode)&&e!==document;){if(r(e,t))return e;if(e===i)return}}});e.register("component~delegate@0.2.3",function(t,n){var r=e("component~closest@0.1.4"),i=e("component~event@0.1.4");t.bind=function(e,t,n,a,s){return i.bind(e,n,function(n){var i=n.target||n.srcElement;n.delegateTarget=r(i,t,!0,e);n.delegateTarget&&a.call(e,n)},s)};t.unbind=function(e,t,n,r){i.unbind(e,t,n,r)}});e.register("component~events@1.0.9",function(t,n){function r(e,t){if(!(this instanceof r))return new r(e,t);if(!e)throw new Error("element required");if(!t)throw new Error("object required");this.el=e;this.obj=t;this._events={}}function i(e){var t=e.split(/ +/);return{name:t.shift(),selector:t.join(" ")}}var a=e("component~event@0.1.4"),s=e("component~delegate@0.2.3");n.exports=r;r.prototype.sub=function(e,t,n){this._events[e]=this._events[e]||{};this._events[e][t]=n};r.prototype.bind=function(e,t){function n(){var e=[].slice.call(arguments).concat(u);l[t].apply(l,e)}var r=i(e),o=this.el,l=this.obj,c=r.name,t=t||"on"+c,u=[].slice.call(arguments,2);r.selector?n=s.bind(o,r.selector,c,n):a.bind(o,c,n);this.sub(c,t,n);return n};r.prototype.unbind=function(e,t){if(0==arguments.length)return this.unbindAll();if(1==arguments.length)return this.unbindAllOf(e);var n=this._events[e];if(n){var r=n[t];r&&a.unbind(this.el,e,r)}};r.prototype.unbindAll=function(){for(var e in this._events)this.unbindAllOf(e)};r.prototype.unbindAllOf=function(e){var t=this._events[e];if(t)for(var n in t)this.unbind(e,n)}});e.register("switchery",function(t,n){function r(e,t){if(!(this instanceof r))return new r(e,t);this.element=e;this.options=t||{};for(var n in l)null==this.options[n]&&(this.options[n]=l[n]);null!=this.element&&"checkbox"==this.element.type&&this.init();this.isDisabled()===!0&&this.disable()}var i=e("abpetkov~transitionize@0.0.3"),a=e("ftlabs~fastclick@v0.6.11"),s=e("component~classes@1.2.1"),o=e("component~events@1.0.9");n.exports=r;var l={color:"#64bd63",secondaryColor:"#dfdfdf",jackColor:"#fff",jackSecondaryColor:null,className:"switchery",disabled:!1,disabledOpacity:.5,speed:"0.4s",size:"default"};r.prototype.hide=function(){this.element.style.display="none"};r.prototype.show=function(){var e=this.create();this.insertAfter(this.element,e)};r.prototype.create=function(){this.switcher=document.createElement("span");this.jack=document.createElement("small");this.switcher.appendChild(this.jack);this.switcher.className=this.options.className;this.events=o(this.switcher,this);return this.switcher};r.prototype.insertAfter=function(e,t){e.parentNode.insertBefore(t,e.nextSibling)};r.prototype.setPosition=function(e){var t=this.isChecked(),n=this.switcher,r=this.jack;e&&t?t=!1:e&&!t&&(t=!0);if(t===!0){this.element.checked=!0;r.style.left=window.getComputedStyle?parseInt(window.getComputedStyle(n).width)-parseInt(window.getComputedStyle(r).width)+"px":parseInt(n.currentStyle.width)-parseInt(r.currentStyle.width)+"px";this.options.color&&this.colorize();this.setSpeed()}else{r.style.left=0;this.element.checked=!1;this.switcher.style.boxShadow="inset 0 0 0 0 "+this.options.secondaryColor;this.switcher.style.borderColor=this.options.secondaryColor;this.switcher.style.backgroundColor=this.options.secondaryColor!==l.secondaryColor?this.options.secondaryColor:"#fff";this.jack.style.backgroundColor=this.options.jackSecondaryColor!==this.options.jackColor?this.options.jackSecondaryColor:this.options.jackColor;this.setSpeed()}};r.prototype.setSpeed=function(){var e={},t={"background-color":this.options.speed,left:this.options.speed.replace(/[a-z]/,"")/2+"s"};e=this.isChecked()?{border:this.options.speed,"box-shadow":this.options.speed,"background-color":3*this.options.speed.replace(/[a-z]/,"")+"s"}:{border:this.options.speed,"box-shadow":this.options.speed};i(this.switcher,e);i(this.jack,t)};r.prototype.setSize=function(){var e="switchery-small",t="switchery-default",n="switchery-large";switch(this.options.size){case"small":
s(this.switcher).add(e);break;case"large":s(this.switcher).add(n);break;default:s(this.switcher).add(t)}};r.prototype.colorize=function(){var e=this.switcher.offsetHeight/2;this.switcher.style.backgroundColor=this.options.color;this.switcher.style.borderColor=this.options.color;this.switcher.style.boxShadow="inset 0 0 0 "+e+"px "+this.options.color;this.jack.style.backgroundColor=this.options.jackColor};r.prototype.handleOnchange=function(e){if(document.dispatchEvent){var t=document.createEvent("HTMLEvents");t.initEvent("change",!0,!0);this.element.dispatchEvent(t)}else this.element.fireEvent("onchange")};r.prototype.handleChange=function(){var e=this,t=this.element;t.addEventListener?t.addEventListener("change",function(){e.setPosition()}):t.attachEvent("onchange",function(){e.setPosition()})};r.prototype.handleClick=function(){var e=this.switcher;a(e);this.events.bind("click","bindClick")};r.prototype.bindClick=function(){var e=this.element.parentNode.tagName.toLowerCase(),t="label"===e?!1:!0;this.setPosition(t);this.handleOnchange(this.element.checked)};r.prototype.markAsSwitched=function(){this.element.setAttribute("data-switchery",!0)};r.prototype.markedAsSwitched=function(){return this.element.getAttribute("data-switchery")};r.prototype.init=function(){this.hide();this.show();this.setSize();this.setPosition();this.markAsSwitched();this.handleChange();this.handleClick()};r.prototype.isChecked=function(){return this.element.checked};r.prototype.isDisabled=function(){return this.options.disabled||this.element.disabled||this.element.readOnly};r.prototype.destroy=function(){this.events.unbind()};r.prototype.enable=function(){this.options.disabled&&(this.options.disabled=!1);this.element.disabled&&(this.element.disabled=!1);this.element.readOnly&&(this.element.readOnly=!1);this.switcher.style.opacity=1;this.events.bind("click","bindClick")};r.prototype.disable=function(){this.options.disabled&&(this.options.disabled=!0);this.element.disabled&&(this.element.disabled=!0);this.element.readOnly&&(this.element.readOnly=!0);this.switcher.style.opacity=this.options.disabledOpacity;this.destroy()}});"object"==typeof exports?module.exports=e("switchery"):"function"==typeof define&&define.amd?define("Switchery",[],function(){return e("switchery")}):(this||window).Switchery=e("switchery")}();TC.Control.prototype.render.call(t,function(){var n=function(){r.toggleClass("disabled");i.toggleClass("disabled");if(this.checked){console.log("seleccion por pol\xedgono");t.map.activeControl===t.fInfoCtrl&&t.polygonFInfoCtrl.activate();t.lastCtrlActive=t.polygonFInfoCtrl}else{console.log("seleccion por punto");t.map.activeControl===t.polygonFInfoCtrl&&t.fInfoCtrl.activate();t.lastCtrlActive=t.fInfoCtrl}},r=$(".tc-ctl-ltoc-switch-text-dcha",t._$div),i=$(".tc-ctl-ltoc-switch-text-izda",t._$div);r.toggleClass("disabled");if("undefined"!=typeof Switchery){t._switch=new Switchery($(".tc-ctl-ltoc-switch-radio",t._$div)[0],{size:"small",color:t.bgColor,jackColor:t.jackColor,jackSecondaryColor:t.jackColor});t._switch.element.onchange=n}else{t._switch=$(".tc-ctl-ltoc-switch-radio",t._$div)[0];t._switch.onclick=n}$.isFunction(e)&&e()})};e.activate=function(){var e=this;e.lastCtrlActive&&e.lastCtrlActive.activate()};e.deactivate=function(){var e=this;e.lastCtrlActive.deactivate(!1)};TC.Map.prototype.getDefaultControl=function(){var e=this.getControlsByClass("TC.control.MultiFeatureInfo");if(e&&e.length)return e[0].lastCtrlActive;e=this.getControlsByClass("TC.control.FeatureInfo");return e&&e.length?e[0]:null}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control.js");TC.control.NavBar=function(){TC.Control.apply(this,arguments)};TC.inherit(TC.control.NavBar,TC.Control);!function(){var e=TC.control.NavBar.prototype;e.CLASS="tc-ctl-nav";e.render=function(){var e=this;e.wrap||(e.wrap=new TC.wrap.control.NavBar(e))};e.register=function(e){var t=this;TC.Control.prototype.register.call(t,e);t.wrap.register(e);e.loaded(function(){t.wrap.refresh()})}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control.js");TC.control.OverviewMap=function(){var e=this;TC.Control.apply(e,arguments);e.$events=$(e);e.isLoaded=!1;e.layer=null;e.wrap=new TC.wrap.control.OverviewMap(e)};TC.inherit(TC.control.OverviewMap,TC.Control);!function(){var e=TC.control.OverviewMap.prototype;e.CLASS="tc-ctl-ovmap";e.template=TC.isDebug?TC.apiLocation+"TC/templates/OverviewMap.html":function(){function t(e,t){return e.w('<div class="tc-ctl-ovmap-load tc-hidden"></div>')}dust.register(e.CLASS,t);t.__dustBody=!0;return t};e.register=function(e){var t=this,n=t.options.layer;TC.Control.prototype.register.call(t,e);e.loaded(function(){var r;if("string"==typeof n){var i=function(e,t){for(var n=null,r=0;r<t.length;r++){var i=t[r],a=i.id||i;if(a===e){n=i;break}}return n},a=i(n,TC.Cfg.availableBaseLayers);$.isPlainObject(a)||(a=i(n,e.options.baseLayers));$.isPlainObject(a)&&(r=new TC.layer.Raster(a))}else r=n instanceof TC.Layer?n:n.type===TC.Consts.layerType.VECTOR||n.type===TC.Consts.layerType.KML||n.type===TC.Consts.layerType.WFS?new TC.layer.Vector(n):new TC.layer.Raster(n);t.layer=r;t.wrap.register(e)})};e.loaded=function(e){var t=this;$.isFunction(e)&&(t.isLoaded&&t.map&&t.map.isLoaded?e():t.$events.on(TC.Consts.event.MAPLOAD,e))};e.activate=function(){this.enable()};e.deactivate=function(){this.disable()};e.enable=function(){var e=this;TC.Control.prototype.enable.call(e);e.wrap.enable()};e.disable=function(){var e=this;TC.Control.prototype.disable.call(e);e.wrap.disable()}}();TC.control=TC.control||{};TC.control.FeatureInfoCommons||TC.syncLoadJS(TC.apiLocation+"TC/control/FeatureInfoCommons.js");!function(){TC.control.PolygonFeatureInfo=function(){var e=this;TC.control.FeatureInfoCommons.apply(this,arguments);e.wrap=new TC.wrap.control.PolygonFeatureInfo(e);e.lineColor=e.options.lineColor?e.options.lineColor:"#c00";e.callback=function(t,n){if(!e._drawToken){e.popup.hide();e.layerDraw.clearFeatures();for(var r=!1,i=0;i<e.map.workLayers.length;i++){var a=e.map.workLayers[i];if(a.type===TC.Consts.layerType.WMS&&a.getVisibility()&&a.names.length>0){r=!0;break}}if(r){e.popup.hide();e.wrap.beginDraw(t,e.layerDraw,function(t){e.wrap.getFeaturesByPolygon(t)})}}};e.layer=null;e.marker=null;e.info=null;e.popup=null;e.lastFeatureCount=null;e._isDrawing=!1;e._isSearching=!1;e._drawToken=!1};TC.inherit(TC.control.PolygonFeatureInfo,TC.control.FeatureInfoCommons);var e=TC.control.PolygonFeatureInfo.prototype;e.CLASS="tc-ctl-finfo";e.template={};if(TC.isDebug){e.template[e.CLASS]=TC.apiLocation+"TC/templates/FeatureInfo.html";e.template[e.CLASS+"-dialog"]=TC.apiLocation+"TC/templates/FeatureInfoDialog.html"}else{e.template[e.CLASS]=function(){function t(e,t){return e.w('<ul class="tc-ctl-finfo-services">').s(t.get(["services"],!1),t,{"else":n,block:r},{}).w("</ul>").x(t.get(["featureCount"],!1),t,{block:O},{})}function n(e,t){return e.w('<li class="tc-ctl-finfo-empty">').h("i18n",t,{},{$key:"noData"}).w("</li>")}function r(e,t){return e.w("<li><h3>").x(t.getPath(!1,["mapLayer","title"]),t,{"else":i,block:a},{}).w('</h3><div class="tc-ctl-finfo-service-content">').s(t.get(["hasLimits"],!1),t,{"else":s,block:E},{}).w("</div></li>")}function i(e,t){return e.f(t.getPath(!1,["mapLayer","id"]),t,"h")}function a(e,t){return e.f(t.getPath(!1,["mapLayer","title"]),t,"h")}function s(e,t){return e.w('<ul class="tc-ctl-finfo-layers">').s(t.get(["layers"],!1),t,{"else":o,block:l},{}).w("</ul>")}function o(e,t){return e.w('<li class="tc-ctl-finfo-empty">').h("i18n",t,{},{$key:"noDataAtThisService"}).w("</li>")}function l(e,t){return e.w("<li><h4>").s(t.get(["path"],!1),t,{block:c},{}).w(' <span class="tc-ctl-finfo-layer-n">').f(t.getPath(!1,["features","length"]),t,"h").w('</span> </h4> <div class="tc-ctl-finfo-layer-content"><ul class="tc-ctl-finfo-features">').s(t.get(["features"],!1),t,{"else":h,block:p},{}).w("</ul></div></li>")}function c(e,t){return e.f(t.getPath(!0,[]),t,"h").h("sep",t,{block:u},{})}function u(e,t){return e.w(" &bull; ")}function h(e,t){return e.w('<li class="tc-ctl-finfo-empty">').h("i18n",t,{},{$key:"noDataInThisLayer"}).w("</li>")}function p(e,t){return e.w("<li>").x(t.get(["rawContent"],!1),t,{"else":d,block:C},{}).w("</li>")}function d(e,t){return e.x(t.get(["error"],!1),t,{"else":f,block:v},{})}function f(e,t){return e.w("<h5>").f(t.get(["id"],!1),t,"h").w("</h5><table").x(t.get(["geometry"],!1),t,{block:m},{}).w("><tbody>").s(t.get(["attributes"],!1),t,{block:y},{}).w("</tbody></table>").x(t.get(["geometry"],!1),t,{block:g},{})}function m(e,t){return e.w(' title="').h("i18n",t,{},{$key:"clickToCenter"}).w('"')}function y(e,t){return e.w('<tr><th class="tc-ctl-finfo-attr">').f(t.get(["name"],!1),t,"h").w('</th><td class="tc-ctl-finfo-val">').f(t.get(["value"],!1),t,"h").w("</td></tr>")}function g(e,t){return e.w('<div class="tc-ctl-finfo-tools"><button class="tc-ctl-finfo-tools-btn" title="').h("i18n",t,{},{$key:"download"}).w("/").h("i18n",t,{},{$key:"share"}).w('">').h("i18n",t,{},{$key:"download"}).w("/").h("i18n",t,{},{$key:"share"}).w("</button></div>")}function v(e,t){return e.w('<span class="tc-ctl-finfo-errors">').h("i18n",t,{},{$key:"fi.error"}).w('<span class="tc-ctl-finfo-error-text">').f(t.get(["error"],!1),t,"h").w("</span></span>")}function C(e,t){return e.w("<h5>").h("i18n",t,{},{$key:"feature"}).w("</h5>").h("eq",t,{"else":L,block:T},{key:t.get(["rawFormat"],!1),value:"text/html"})}function L(e,t){return e.w("<pre>").f(t.get(["rawContent"],!1),t,"h").w("</pre>")}function T(e,t){return e.w(" ").x(t.get(["expandUrl"],!1),t,{block:w},{})}function w(e,t){return e.h("ne",t,{"else":b,block:S},{key:t.get(["expandUrl"],!1),value:""})}function b(e,t){return e.w('<iframe src="').f(t.get(["rawUrl"],!1),t,"h").w('" />')}function S(e,t){return e.w('<div class="tc-ctl-finfo-features-iframe-cnt"><iframe src="').f(t.get(["rawUrl"],!1),t,"h").w('" /><a class="tc-ctl-finfo-open" onclick="window.open(\'').f(t.get(["expandUrl"],!1),t,"h").w("', '_blank')\" title=\"").h("i18n",t,{},{$key:"expand"}).w('"></a></div>')}function E(e,t){return e.w('<span class="tc-ctl-finfo-errors">').f(t.get(["hasLimits"],!1),t,"h").w("</span>")}function O(e,t){return e.h("gt",t,{block:A},{key:t.get(["featureCount"],!1),value:"1",type:"number"})}function A(e,t){return e.w('<a class="tc-ctl-btn tc-ctl-finfo-btn-prev">').h("i18n",t,{},{$key:"previous"}).w('</a><div class="tc-ctl-finfo-counter"><span class="tc-ctl-finfo-idx"></span>/').f(t.get(["featureCount"],!1),t,"h").w('</div><a class="tc-ctl-btn tc-ctl-finfo-btn-next">').h("i18n",t,{},{$key:"next"}).w("</a>")}dust.register(e.CLASS,t);t.__dustBody=!0;n.__dustBody=!0;r.__dustBody=!0;i.__dustBody=!0;a.__dustBody=!0;s.__dustBody=!0;o.__dustBody=!0;l.__dustBody=!0;c.__dustBody=!0;u.__dustBody=!0;h.__dustBody=!0;p.__dustBody=!0;d.__dustBody=!0;f.__dustBody=!0;m.__dustBody=!0;y.__dustBody=!0;g.__dustBody=!0;v.__dustBody=!0;C.__dustBody=!0;L.__dustBody=!0;T.__dustBody=!0;w.__dustBody=!0;b.__dustBody=!0;S.__dustBody=!0;E.__dustBody=!0;O.__dustBody=!0;A.__dustBody=!0;return t};e.template[e.CLASS+"-dialog"]=function(){function t(e,t){return e.w('<div class="tc-ctl-finfo-dialog tc-modal"><div class="tc-modal-background tc-modal-close"></div><div class="tc-modal-window"><div class="tc-modal-header"><h3>').h("i18n",t,{},{$key:"feature"}).w('</h3><div class="tc-ctl-popup-close tc-modal-close"></div></div><div class="tc-modal-body"><div class="tc-ctl-finfo-dialog-dl"><h2>').h("i18n",t,{},{$key:"download"}).w('</h2><div><button class="tc-button tc-ctl-finfo-dl-btn-kml" data-format="KML" title="KML">KML</button><button class="tc-button tc-ctl-finfo-dl-btn-gml" data-format="GML" title="GML">GML</button><button class="tc-button tc-ctl-finfo-dl-btn-geojson" data-format="GeoJSON" title="GeoJSON">GeoJSON</button><button class="tc-button tc-ctl-finfo-dl-btn-wkt" data-format="WKT" title="WKT">WKT</button></div></div><div class="tc-ctl-finfo-dialog-share"></div></div><div class="tc-modal-footer"><button type="button" class="tc-button tc-modal-close">').h("i18n",t,{},{$key:"close"}).w("</button></div></div></div>")}dust.register(e.CLASS+"-dialog",t);t.__dustBody=!0;return t}}e.register=function(e){var t=this;TC.control.Click.prototype.register.call(t,e);e.loaded(function(){var n=t.map.addLayer({id:TC.getUID(),title:"PolygonFeatureInfo",stealth:!0,type:TC.Consts.layerType.VECTOR,styles:{point:{fillColor:t.lineColor,fillOpacity:0,strokeColor:t.lineColor,strokeWidth:2,radius:6},line:{strokeColor:t.lineColor,strokeWidth:2},polygon:{strokeColor:t.lineColor,strokeWidth:2,fillColor:"#000",fillOpacity:.3}}});$.when(e.addLayer({id:TC.getUID(),type:TC.Consts.layerType.VECTOR,stealth:!0})).then(function(e){t.layer=e});$.when(n).then(function(e){t.layerDraw=e});var r=t.map.addLayer({id:TC.getUID(),title:"FeatureInfo",stealth:!0,type:TC.Consts.layerType.VECTOR,styles:{point:{fillColor:"#D8ED6C",fillOpacity:0,strokeColor:"#D8ED6C",strokeWidth:2,radius:6},line:{strokeColor:"#D8ED6C",strokeWidth:2},polygon:{strokeColor:"#D8ED6C",strokeWidth:2,fillColor:"#000",fillOpacity:.3}}});$.when(r).then(function(e){t.layerDraw=e});$.when(e.addControl("popup",{closeButton:!0,draggable:t.options.draggable})).then(function(n){t.popup=n;e.on(TC.Consts.event.POPUP,function(e){t.onShowPopUp(e)});e.on(TC.Consts.event.POPUPHIDE,function(e){e.control===n&&t.popup.$popupDiv.css("width","auto")})})});e.$events.on(TC.Consts.event.POPUPHIDE,function(e){t.popup===e.control&&t.layerDraw.clearFeatures()});e.on(TC.Consts.event.BEFOREFEATUREINFO,function(e){t.beforeGetFeatureInfo(e)});e.on(TC.Consts.event.FEATUREINFO,function(e){if(t.isActive){t.lastFeatureCount=t.countFeatures(e);t.responseCallback(e)}});e.$events.on(TC.Consts.event.NOFEATUREINFO,function(e){t.lastFeatureCount=0;t.popup&&t.popup.hide()});TC.loadJS(!TC.Consts.event.POPUPHIDE,[TC.apiLocation+"TC/control/Popup.js"],function(){e.$events.on(TC.Consts.event.POPUPHIDE,function(e){t.popup===e.control&&t.layer.clearFeatures()})});t.$events.on(TC.Consts.event.CONTROLDEACTIVATE,function(e){t.wrap.cancelDraw()})};e.responseCallback=function(e){var t=this;if(t.marker){var n=e.services;t.info={services:n};for(var r=0;r<n.length;r++){var i=n[r];if(i.hasLimits)delete i.layers;else{for(var a=0;a<i.layers.length;a++)if(!i.layers[a].features.length){i.layers.splice(a,1);a-=1}if(!i.layers.length){n.splice(r,1);r-=1}}}n.length?t.renderData(e,function(){t._$div.find("td."+t.CLASS+"-val").each(function(e,t){var n=$(t),r=n.text();TC.Util.isURL(r)&&n.html('<a href="'+r+'" target="_blank">'+r+"</a>")});t.marker.data=$("<div>").append(t._$div.clone()).html();t.popup&&t.marker.showPopup(t.popup)}):t.layer.clearFeatures()}}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control.js");TC.Consts.event.POPUP="popup.tc";TC.Consts.event.POPUPHIDE="popuphide.tc";TC.Consts.classes.DRAG=TC.Consts.classes.DRAG||"tc-drag";TC.Consts.classes.DRAGGED=TC.Consts.classes.DRAGGED||"tc-dragged";TC.Consts.classes.DRAGGABLE=TC.Consts.classes.DRAGGABLE||"tc-draggable";TC.control.Popup=function(){var e=this;TC.Control.apply(e,arguments);e.currentFeature=null;e.wrap=new TC.wrap.control.Popup(e)};TC.inherit(TC.control.Popup,TC.Control);!function(){var e=TC.control.Popup.prototype;e.CLASS="tc-ctl-popup";e.render=function(){};e.register=function(e){var t=this;TC.Control.prototype.register.call(t,e);$.when(e.wrap.addPopup(t)).then(function(){e.on(TC.Consts.event.LAYERVISIBILITY,function(e){t.currentFeature&&t.currentFeature.layer===e.layer&&!e.layer.getVisibility()&&t.hide()});e.on(TC.Consts.event.LAYERREMOVE,function(e){t.currentFeature&&t.currentFeature.layer===e.layer&&t.hide()});e.on(TC.Consts.event.UPDATE,function(){t.currentFeature&&t.currentFeature._visibilityState!==TC.Consts.visibility.NOT_VISIBLE||t.hide()});e.on(TC.Consts.event.FEATUREREMOVE,function(e){t.currentFeature===e.feature&&t.hide()})})};e.fitToView=function(e){var t=this;e?setTimeout(function(){t.wrap.fitToView()},1e3):t.wrap.fitToView()};e.hide=function(){var e=this;if(e.map){e.map.wrap.hidePopup(e);e.setDragged(!1);e.map.$events.trigger($.Event(TC.Consts.event.POPUPHIDE,{control:e}))}};e.setDragged=function(e){var t=this;t.dragged=e;t.$popupDiv&&t.$popupDiv.toggleClass(TC.Consts.classes.DRAGGED,e);t.wrap.setDragged(e)};e.setDragging=function(e){var t=this;e&&t.setDragged(!0);t.$popupDiv.toggleClass(TC.Consts.classes.DRAG,e)};e.isVisible=function(){var e=this;return e.$popupDiv&&e.$popupDiv.hasClass(TC.Consts.classes.VISIBLE)}}();TC.control=TC.control||{};TC.Consts.classes.PRINTABLE="tc-printable";TC.control.Print=function(e){var t=this,n=e||{};t.ready=!1;t.title=n.title||"P\xe1gina de impresi\xf3n";t.cssUrl=n.cssUrl||TC.apiLocation+"TC/css/print.css";if(n.target){for(var r in t.template)dust.cache[r]||t.template[r]();var i=$(n.target);i.addClass(TC.Consts.classes.PRINTABLE);var a=function(e){var n=open(null,t.CLASS),r=i.html();dust.render(t.CLASS+"-page",{title:t.title,content:r,cssUrl:t.cssUrl},function(e,t){n.document.write(t);n.document.close();n.focus();e&&TC.error(e)})};dust.render(t.CLASS,null,function(e,n){i.append(n);i.find("."+t.CLASS+"-btn").on("click",a)})}};!function(){var e=TC.control.Print.prototype;e.CLASS="tc-ctl-print";e.template={};e.template[e.CLASS]=function(){function t(e,t){return e.w('<a class="tc-ctl-print-btn" title="').h("i18n",t,{},{$key:"printThisWindow"}).w('">').h("i18n",t,{},{$key:"print"}).w("</a>")}dust.register(e.CLASS,t);t.__dustBody=!0;return t};e.template[e.CLASS+"-page"]=function(){function t(e,t){return e.w('<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head><title>').f(t.get(["title"],!1),t,"h").w('</title><link rel="stylesheet" href="').f(t.get(["cssUrl"],!1),t,"h").w('" /></head><body onload="print()" class="tc-ctl-print-page"><h1>').f(t.get(["title"],!1),t,"h").w("</h1>").f(t.get(["content"],!1),t,"h",["s"]).w("</body></html>")}dust.register(e.CLASS+"-page",t);t.__dustBody=!0;return t}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control.js");TC.control.PrintMap=function(){var e=this;TC.Control.apply(e,arguments)};TC.inherit(TC.control.PrintMap,TC.Control);!function(){var e=TC.control.PrintMap.prototype;e.CLASS="tc-ctl-printMap";e.template={};e.template[e.CLASS]=TC.isDebug?TC.apiLocation+"TC/templates/PrintMap.html":function(){function t(e,t){return e.w("<h2>").h("i18n",t,{},{$key:"print"}).w('</h2><div><div class="tc-ctl-printMap-div"><div class="tc-group tc-ctl-printMap-cnt"><label>').h("i18n",t,{},{$key:"title"}).w(':</label><input type="text" class="tc-ctl-printMap-title tc-textbox" maxlength="30" placeholder="').h("i18n",t,{},{$key:"mapTitle"}).w('" /></div><div class="tc-group tc-ctl-printMap-cnt"><label>').h("i18n",t,{},{$key:"layout"}).w(':</label><select id="print-design" class="tc-combo"><option value="landscape">').h("i18n",t,{},{$key:"landscape"}).w('</option><option value="portrait">').h("i18n",t,{},{$key:"portrait"}).w('</option></select></div><div class="tc-group tc-ctl-printMap-cnt"><label>').h("i18n",t,{},{$key:"size"}).w(':</label><select id="print-size" class="tc-combo"><option value="a4">A4</option><option value="a3">A3</option></select></div><div class="tc-group tc-ctl-printMap-cnt"><button class="tc-ctl-printMap-btn tc-button tc-icon-button" title="').h("i18n",t,{},{$key:"printMap"}).w('">').h("i18n",t,{},{$key:"print"}).w("</button></div></div></div>")}dust.register(e.CLASS,t);t.__dustBody=!0;return t};e.register=function(e){var t=this;TC.Control.prototype.register.call(t,e);var n=function(){var e="?";$.isEmptyObject(TC.Util.getQueryStringParams(window.location.href))||(e="&");e+="layout=print&orientation="+$("#print-design").val()+"&title="+$("input.tc-ctl-printMap-title").val()+"&size="+$("#print-size").val();var n;n=window.location.hash?window.location.href.replace(window.location.hash,e+window.location.hash):window.location.href+e;t.printWindow&&void 0!==t.printWindow&&t.printWindow.close();t.printWindow=window.open(n,"print");t.printWindow.onbeforeunload=function(){delete this.printWindow}.bind(this)};t._$div.on("click",".tc-ctl-printMap-btn",n)}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control.js");TC.control.PrintPdf=function(){var e=this;TC.Control.apply(e,arguments)};TC.inherit(TC.control.PrintPdf,TC.Control);!function(){var e=TC.control.PrintPdf.prototype;e.CLASS="tc-ctl-print-pdf";var t={marginTop:20,marginLeft:55,a4:{width:596,height:842},a3:{width:842,height:1191},qrCode:{sideLength:85},headerHeight:20},n={PORTRAIT:"portrait",LANDSCAPE:"landscape"},r={A4:"a4",A3:"a3"},i=TC.Util.getParameterByName("orientation"),a=TC.Util.getParameterByName("size"),s=function(e,r){return e===n.PORTRAIT?t[r].width:t[r].height},o=function(e,r){return e===n.PORTRAIT?t[r].height:t[r].width};e.template=TC.isDebug?TC.apiLocation+"TC/templates/PrintPdf.html":function(){function t(e,t){return e.w('<button disabled class="disabled tc-button tc-ctl-printMap-btn" title="').h("i18n",t,{},{$key:"printPdf"}).w('"></button>')}dust.register(e.CLASS,t);t.__dustBody=!0;return t};var l=function(){var e=window.location.href,t=e.indexOf("?"),n=e.indexOf("#");t>0&&(e=n>t?e.replace(e.substring(t,n),""):e.replace(e.substring(t,e.length-1),""));return e},c=function(e){var n=$.Deferred(),r=150;e?TC.loadJS("undefined"==typeof QRCode,[TC.apiLocation+"lib/qrcode/qrcode.min.js"],function(){e.length>r&&(e=TC.Util.shortenUrl(e));var i=$("#qrcode");i.empty();new QRCode(i.get(0),{text:e,width:t.qrCode.sideLength,height:t.qrCode.sideLength});setTimeout(function(){var e=i.find("img").attr("src");n.resolve(e)},100)}):n.resolve(imgBase64);return n.promise()};e.register=function(e){var t=this;TC.Control.prototype.register.call(t,e);t.pdfLibPromise=function(){var e=$.Deferred();window.pdfMake?e.resolve():TC.loadJS(!window.pdfMake,[TC.Consts.url.PDFMAKE],function(){e.resolve()});return e.promise()}();var n=!0;e._$div.on("mouseover",function(){if(n){e.toast(t.getLocaleString("print.advice.title")+": "+t.getLocaleString("print.advice.desc"),{type:TC.Consts.msgType.INFO,duration:7e3});n=!1}});var r=".tc-ctl-printMap-btn";t.map.$events.on(TC.Consts.event.STARTLOADING,function(){var e=t._$div.find(r);e.addClass("disabled");e.attr("disabled","disabled")});t.map.$events.on(TC.Consts.event.STOPLOADING,function(){var e=t._$div.find(r);e.removeClass("disabled");e.removeAttr("disabled")});t.getLayersFromOpener();t.options.qrCode&&c(l());t._$div.on("click",".tc-ctl-printMap-btn",function(){t.createPdf()})};var u=function(){var e=$.Deferred(),s={pageOrientation:i||n.LANDSCAPE,pageSize:a||r.A4,pageMargins:[t.marginLeft,t.marginTop]};e.resolve(s);return e.promise()};e.createPdf=function(){var e=this,n=s(i,a),r=o(i,a);e.canvas=$(".tc-map .ol-viewport canvas")[0];e.mapSize=TC.Util.calculateAspectRatioFit(e.canvas.width,e.canvas.height,n-2*t.marginLeft,r-2*t.marginTop-t.headerHeight);var h=function(n){n.content=n.content||[];var r=$.Deferred(),i=e.map.getControlsByClass(TC.control.ScaleBar)[0];if(i)var a=$(".tc-ctl-sb .ol-scale-line-inner"),s=e.canvas.width/e.mapSize.width,o=a.width()/s;var l=function(e){var t;e&&(t=[[e]]);t[0].push({text:TC.Util.getParameterByName("title"),alignment:"center",fontSize:11});i&&t[0].push({table:{widths:[o],body:[[{text:i.getText(),fontSize:10,alignment:"center"}]]},layout:{hLineWidth:function(e,t){return 0===e?0:1},paddingLeft:function(e,t){return 0},paddingRight:function(e,t){return 0},paddingTop:function(e,t){return 0},paddingBottom:function(e,t){return 0}}});n.content.push({table:{widths:[o,"*",o]},layout:"noBorders"});n.content[0].table.body=t;r.resolve(n)};e.options.logo?$.when(TC.Util.imgToDataUrl(e.options.logo,"image/png")).then(function(e,n){var r=(t.headerHeight,n.width*t.headerHeight/n.height,TC.Util.calculateAspectRatioFit(n.width,n.height,o,t.headerHeight));l({image:e,height:r.height,width:r.width})}):l();return r.promise()},p=function(n){var r=$.Deferred();n.content=n.content||[];var i=function(t){n.content.push({table:{widths:["*"],body:[[{image:TC.Util.toDataUrl(t),width:e.mapSize.width}]]},layout:{paddingLeft:function(e,t){return 0},paddingRight:function(e,t){return 0},paddingTop:function(e,t){return.1},paddingBottom:function(e,t){return 0}}});r.resolve(n)};e.options.qrCode?$.when(c(l())).then(function(n){if(n)$.when(TC.Util.addToCanvas(e.canvas,n,{x:e.canvas.width-t.qrCode.sideLength,y:e.canvas.height-t.qrCode.sideLength})).then(function(e){i(e)});else{TC.error(e.getLocaleString("print.qr.error"));i(e.canvas)}}):i(e.canvas);return r.promise()},d=function(t){var n=$.Deferred(),r=function(e,t,n){if(t.isVisibleByScale(e.name)){var r,i;t.options&&t.options.params&&t.options.params.base64LegendSrc?i=t.options.params.base64LegendSrc:e.legend&&(r=e.legend.src);result.push({src:r,title:e.title,level:n,srcBase64:i})}},a=function(e,t,n,r){if(Array.isArray(e))for(var i=0;i<e.length;i++)a(e[i],t,n,r);else if(e&&e.hasOwnProperty("children")&&e.children.length>0){e.title&&e.name&&result.push({header:e.title,level:r});a(e.children,t,n,++r)}if(e&&e.hasOwnProperty("children")&&0==e.children.length){t.apply(this,[e,n,r]);r--}},s=function(){for(var e=[],t=0;t<c.length;t++)for(var n=c[t].layers,r=0;r<n.length;r++)!function(t,n){var r=c[t].layers[n],i=r.src||r.srcBase64;if(i){var a=TC.Util.imgToDataUrl(i,"image/png");e.push(a);a.then(function(e,t){r.image={base64:e,canvas:t}})}}(t,r);return e};if(e.options.legend&&e.options.legend.visible){var o=e.options.legend.orientation||i,l=e.map.workLayers,c=[],u=7;t.content=t.content||{};if(l.length>0){for(var h=0;h<l.length;h++){var p=l[h];if(p.type===TC.Consts.layerType.WMS&&p.getVisibility()){result=[];a(p.getTree(),r,p,0);result.length>0&&c.push({title:p.title,layers:result})}}$.when.apply($,s()).then(function(){c.length>0&&t.content.push({text:" ",pageBreak:"before",pageOrientation:o});for(var e=0;e<c.length;e++){var r=c[e],i=10;t.content.push({text:r.title,fontSize:11,margin:[0,0,0,5]});for(var a=0;a<r.layers.length;a++){var s=r.layers[a];i=u*s.level;if(s.header)t.content.push({text:s.header,fontSize:10,margin:[i,0,0,3]});else{var l=s.image.canvas.width/2,h=l*s.image.canvas.height/s.image.canvas.width;t.content.push({text:s.title,fontSize:9,margin:[i,0,0,2]});t.content.push({image:s.image.base64,width:l,height:h,margin:[i,0,0,2]})}}}n.resolve(t)})}else n.resolve(t)}else n.resolve(t);return n.promise()},f=function(e){var t=window.location.host+"_",n=TC.Util.getParameterByName("title");if(n)t+=n;else{var r=TC.Util.getFormattedDate((new Date).toString());t+=r}pdfMake.createPdf(e).download(t.replace(/[\\\/:*?"<>\|]/g,"")+".pdf")},m=e.map.getControlsByClass(TC.control.LoadingIndicator)[0],y=m.addWait();$.when(e.pdfLibPromise).then(u).then(h).then(p).then(d).then(f).then(function(){m.removeWait(y)})};e.getLayersFromOpener=function(e){var t=this,n=window.opener;if(n){var e=t.options.openerMap;if(e){for(var r=e.split("."),i=n,a=0;a<r.length;a++)i=i[r[a]];var s=i}s?t.map.loaded(function(){0===n.location.hash.length&&t.map.setExtent(s.options.initialExtent);for(var e=0;e<t.map.baseLayers.length;e++)t.map.removeLayer(t.map.baseLayers[e]);var r=s.getBaseLayer();t.map.addLayer({id:r.id,title:r.title,type:r.type,url:r.url,encoding:r.encoding,layerNames:r.layerNames,matrixSet:r.matrixSet,format:r.format,minResolution:r.minResolution,maxZoom:r.maxZoom,isBase:!0});for(var i=s.workLayers,e=0;e<i.length;e++){var a=i[e];if((a.type===TC.Consts.layerType.VECTOR||a.type===TC.Consts.layerType.WFS)&&a.getVisibility()&&a.features.length>0){var o=a.features;t.map.addLayer(a,function(e){for(var t=0;t<o.length;t++)e.addFeature(o[t])})}else a.type===TC.Consts.layerType.WMS&&a.options.stateless&&t.map.addLayer({id:a.id,title:a.title,type:a.type,method:a.method,url:a.url,format:a.format,stateless:a.stateless,params:a.params,layerNames:a.layerNames})}}):TC.error("No se ha definido una variable con el contenido de TC.Map en el visor original")}}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control.js");TC.Consts.event.RESULTTOOLTIP="resulttooltip.tc";TC.Consts.event.RESULTTOOLTIPEND="resulttooltipend.tc";TC.Consts.event.DRAWCHART="drawchart.tc";TC.Consts.event.RESULTSPANELMIN="resultspanelmin.tc";TC.Consts.event.RESULTSPANELMAX="resultspanelmax.tc";TC.Consts.event.RESULTSPANELCLOSE="resultspanelclose.tc";TC.control.ResultsPanel=function(){var e=this;TC.Control.apply(e,arguments);e.data={};e.classes={FA:"fa"};e.contentType={TABLE:{fnOpen:TC.control.ResultsPanel.prototype.openTable,collapsedClass:".fa-list-alt"},CHART:{fnOpen:TC.control.ResultsPanel.prototype.openChart,collapsedClass:".fa-area-chart"}};e.content=e.contentType.TABLE;if(e.options){e.options.content&&(e.content=e.contentType[e.options.content.toUpperCase()]);e.options.chart&&(e.chart=e.options.chart);e.options.table&&(e.table=e.options.table)}};TC.inherit(TC.control.ResultsPanel,TC.Control);TC.control.ResultsPanel.prototype.CLASS="tc-ctl-p-results";TC.control.ResultsPanel.prototype.template={};if(TC.isDebug){TC.control.ResultsPanel.prototype.template[TC.control.ResultsPanel.prototype.CLASS]=TC.apiLocation+"TC/templates/ResultsPanel.html";TC.control.ResultsPanel.prototype.template[TC.control.ResultsPanel.prototype.CLASS+"-table"]=TC.apiLocation+"TC/templates/ResultsPanelTable.html";TC.control.ResultsPanel.prototype.template[TC.control.ResultsPanel.prototype.CLASS+"-chart"]=TC.apiLocation+"TC/templates/ResultsPanelChart.html"}else{TC.control.ResultsPanel.prototype.template[TC.control.ResultsPanel.prototype.CLASS]=function(){function e(e,t){return e.w('<div class="prpanel-group prsidebar-body " style="display: none" data-no-cb data-no-3d><div class="prpanel prpanel-default"><div class="prpanel-heading"><h4 class="prpanel-title"><label>').h("i18n",t,{},{$key:"geo.trk.chart.chpe"}).w('</label> <span class="prcollapsed-pull-right prcollapsed-slide-submenu prcollapsed-slide-submenu-close" title="').h("i18n",t,{},{$key:"close"}).w('"><i class="fa fa-times"></i></span><span class="prcollapsed-pull-right prcollapsed-slide-submenu prcollapsed-slide-submenu-min" title="').h("i18n",t,{},{$key:"hide"}).w('"><i class="fa fa-chevron-left"></i></span><span class="prcollapsed-pull-right prcollapsed-slide-submenu prcollapsed-slide-submenu-csv" hidden title="Exportar a Excel"><i class="fa fa-file-excel-o"></i></span></h4></div><div id="results" class="prpanel-collapse collapse in"><div class="prpanel-body list-group tc-ctl-p-results-table">').p("tc-ctl-p-results-table",t,t.rebase(t.getPath(!0,[])),{}).w('</div><div class="prpanel-body list-group tc-ctl-p-results-chart"></div></div></div></div><div class="prcollapsed prcollapsed-max prcollapsed-pull-left" style="display: none;" title="').h("i18n",t,{},{$key:"expand"}).w('" data-no-cb data-no-3d><i class="fa-list-alt" hidden></i><i class="fa-area-chart" hidden></i></div>')}dust.register(TC.control.ResultsPanel.prototype.CLASS,e);e.__dustBody=!0;return e};TC.control.ResultsPanel.prototype.template[TC.control.ResultsPanel.prototype.CLASS+"-table"]=function(){function e(e,r){return e.w('<table class="table" style="display:none;"><thead>').s(r.get(["columns"],!1),r,{block:t},{}).w("</thead><tbody>").s(r.get(["results"],!1),r,{block:n},{}).w("</tbody></table>")}function t(e,t){return e.w("<th>").f(t.getPath(!0,[]),t,"h").w("</th>")}function n(e,t){return e.w("<tr>").h("iterate",t,{block:r},{on:t.getPath(!0,[])}).w("</tr>")}function r(e,t){return e.w("<td>").f(t.get(["value"],!1),t,"h").w("</td>")}dust.register(TC.control.ResultsPanel.prototype.CLASS+"-table",e);e.__dustBody=!0;t.__dustBody=!0;n.__dustBody=!0;r.__dustBody=!0;return e};TC.control.ResultsPanel.prototype.template[TC.control.ResultsPanel.prototype.CLASS+"-chart"]=function(){function e(e,r){return e.w('<div id="track-chart">').x(r.get(["msg"],!1),r,{"else":t,block:n},{}).w("</div>")}function t(e,t){return e.w('<span id="elevationGain" >').h("i18n",t,{},{$key:"geo.trk.chart.elevationGain"}).w(": +").f(t.get(["upHill"],!1),t,"h").w("m, -").f(t.get(["downHill"],!1),t,"h").w('m</span><div id="chart"></div>')}function n(e,t){return e.f(t.get(["msg"],!1),t,"h");

}dust.register(TC.control.ResultsPanel.prototype.CLASS+"-chart",e);e.__dustBody=!0;t.__dustBody=!0;n.__dustBody=!0;return e}}TC.control.ResultsPanel.prototype.render=function(e){var t=this;TC.Control.prototype.render.call(t,function(){t.$minimize=t._$div.find(".prcollapsed-slide-submenu-min");t.$minimize.on("click",function(){t.minimize()});t.$close=t._$div.find(".prcollapsed-slide-submenu-close");t.$close.on("click",function(){t.close()});t.$maximize=t._$div.find(".prcollapsed-max");t.$maximize.on("click",function(){t.maximize()});if(t.content){t.content=t.content;t.options.titles&&t.options.titles.max&&t.$maximize.attr("title",t.options.titles.max)}t._$div.find(t.content.collapsedClass).removeAttr("hidden").addClass(t.classes.FA);e&&"function"==typeof e&&e.call()})};TC.control.ResultsPanel.prototype.minimize=function(){var e=this;if(0==e._$div.find(e.content.collapsedClass+":visible").length){e._$div.find(e.content.collapsedClass).hasClass(e.classes.FA)||e._$div.find(e.content.collapsedClass).addClass(e.classes.FA);e._$div.find(e.content.collapsedClass).removeAttr("hidden");e._$div.find(".prsidebar-body").toggle("slide",function(){e._$div.find(".prcollapsed-max").fadeIn()});e.map.$events.trigger($.Event(TC.Consts.event.RESULTSPANELMIN),{})}};TC.control.ResultsPanel.prototype.maximize=function(){var e=this;if(0==e._$div.find(e.content.collapsedClass+":hidden").length){e._$div.find(e.content.collapsedClass).attr("hidden","hidden");e._$div.find(".prsidebar-body").toggle("slide");e._$div.find(".prcollapsed-max").hide();e.map.$events.trigger($.Event(TC.Consts.event.RESULTSPANELMAX),{})}};TC.control.ResultsPanel.prototype.close=function(){var e=this;e._$div.find(".prsidebar-body").fadeOut("slide");e._$div.find(".prcollapsed-max").hide();e._$div.find(e.content.collapsedClass).attr("hidden","hidden").removeClass(e.classes.FA);e.map.$events.trigger($.Event(TC.Consts.event.RESULTSPANELCLOSE),{})};TC.control.ResultsPanel.prototype.openChart=function(){var self=this,data=arguments.data||arguments[0].data;if(data)if(data.msg)self.map.toast(data.msg);else{var locale=TC.Util.getMapLocale(self.map);self.getRenderedHtml(TC.control.ResultsPanel.prototype.CLASS+"-chart",{upHill:data.upHill.toLocaleString(locale),downHill:data.downHill.toLocaleString(locale)},function(out){console.log(self._$div.find("."+TC.control.ResultsPanel.prototype.CLASS+"-chart").length);self._$div.find("."+TC.control.ResultsPanel.prototype.CLASS+"-chart").html(out);var chartOptions={bindto:"#chart",padding:{top:0,right:15,bottom:0,left:45},legend:{show:!1}};self.chart.tooltip&&(chartOptions.tooltip={contents:function(d){var fn=self.chart.tooltip;"function"!=typeof fn&&(fn=TC.Util.getFNFromString(self.chart.tooltip));return fn.call(eval(self.chart.ctx),d)}});self.chart&&self.chart.onmouseout&&(chartOptions.onmouseout=function(){var fn=self.chart.onmouseout;"function"!=typeof fn&&(fn=TC.Util.getFNFromString(self.chart.onmouseout));fn.call(eval(self.chart.ctx))});chartOptions=$.extend({},chartOptions,data);chartOptions.onrendered=function(){self.map.$events.trigger($.Event(TC.Consts.event.DRAWCHART),{svg:this.svg[0][0]});self._$div.find(".prsidebar-body").fadeIn("slide")};if(window.c3){window.c3.chart.internal.fn.generateDrawLine=function(e,t){var n=this,r=n.config,i=n.d3.svg.line(),a=n.generateGetLinePoints(e,t),s=t?n.getSubYScale:n.getYScale,o=function(e){return(t?n.subxx:n.xx).call(n,e)},l=function(e,t){return r.data_groups.length>0?a(e,t)[0][1]:s.call(n,e.id)(e.value)};i=r.axis_rotated?i.x(l).y(o):i.x(o).y(l);r.line_connectNull||(i=i.defined(function(e){return null!=e.value}));return function(e){var a,o=r.line_connectNull?n.filterRemoveNull(e.values):e.values,l=t?n.x:n.subX,c=s.call(n,e.id),u=0,h=0;if(n.isLineType(e))if(r.data_regions[e.id])a=n.lineWithRegions(o,l,c,r.data_regions[e.id]);else{n.isStepType(e)&&(o=n.convertValuesToStep(o));a=i.interpolate("linear")(o)}else{if(o[0]){u=l(o[0].x);h=c(o[0].value)}a=r.axis_rotated?"M "+h+" "+u:"M "+u+" "+h}return a?a:"M 0 0"}};window.c3.chart.internal.fn.generateDrawArea=function(e,t){var n=this,r=n.config,i=n.d3.svg.area(),a=n.generateGetAreaPoints(e,t),s=t?n.getSubYScale:n.getYScale,o=function(e){return(t?n.subxx:n.xx).call(n,e)},l=function(e,t){return r.data_groups.length>0?a(e,t)[0][1]:s.call(n,e.id)(0)},c=function(e,t){return r.data_groups.length>0?a(e,t)[1][1]:s.call(n,e.id)(e.value)};i=r.axis_rotated?i.x0(l).x1(c).y(o):i.x(o).y0(l).y1(c);r.line_connectNull||(i=i.defined(function(e){return null!==e.value}));return function(e){var t,a=r.line_connectNull?n.filterRemoveNull(e.values):e.values,s=0,o=0;if(n.isAreaType(e)){n.isStepType(e)&&(a=n.convertValuesToStep(a));t=i.interpolate("linear")(a)}else{if(a[0]){s=n.x(a[0].x);o=n.getYScale(e.id)(a[0].value)}t=r.axis_rotated?"M "+o+" "+s:"M "+s+" "+o}return t?t:"M 0 0"}};c3.generate(chartOptions)}})}else self.map.toast(data.msg);self.map.getLoadingIndicator().hide()};TC.control.ResultsPanel.prototype.openTable=function(){var e=this,t=arguments[0].columns,n=arguments[0].data,r=function(){for(var e=0;e<n.length;e++)for(var r in n[e])t.indexOf(r)<0&&delete n[e][r]};if(n&&n.length>0){if(!t){t=[];for(var i in n[0])t.push(i)}r();e.tableData={columns:t,results:n};e.getRenderedHtml(e.CLASS+"-table",e.tableData,function(t){e._$div.find("."+e.CLASS+"-table").html(t)});e._$div.find(".prsidebar-body").fadeIn("slide")}e.map.getLoadingIndicator().hide()};TC.control.ResultsPanel.prototype.open=function(e,t){var n=this,r=function(){for(var n=0;n<e.length;n++)for(var r in e[n])t.indexOf(r)<0&&delete e[n][r]};if(e&&e.length>0){if(!t){t=[];for(var i in e[0])t.push(i)}r();n.tableData={columns:t,results:e};n.getRenderedHtml(n.CLASS+"-table",n.tableData,function(e){n._$div.find("."+n.CLASS+"-table").html(e)});n._$div.find(".prsidebar-body").fadeIn("slide")}else TC.alert("No se han encontrado resultados");n.map.getLoadingIndicator().hide()};TC.control.ResultsPanel.prototype.register=function(e){var t=this;TC.Control.prototype.register.call(t,e);t.openOn&&t.map.$events.one(t.openOn,function(e,n){t.content.fnOpen.call(t,n)});t.closeOn&&t.map.$events.one(t.closeOn,function(e,n){t.close()});t.options.openOn&&t.map.$events.on(t.options.openOn,function(e,n){t.content.fnOpen.call(t,n)});t.options.closeOn&&t.map.$events.on(t.options.closeOn,function(e,n){t.close()})};TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control.js");TC.control.ScaleBar=function(){TC.Control.apply(this,arguments)};TC.inherit(TC.control.ScaleBar,TC.Control);!function(){var e=TC.control.ScaleBar.prototype;e.CLASS="tc-ctl-sb";e.render=function(){var e=this;e.wrap||(e.wrap=new TC.wrap.control.ScaleBar(e));e.wrap.render()};e.register=function(e){var t=this;TC.Control.prototype.register.call(t,e);e.wrap.getMap().addControl(t.wrap.ctl)};e.getText=function(){var e=this;return e.wrap.getText()}}();TC.control=TC.control||{};TC.control.Scale||TC.syncLoadJS(TC.apiLocation+"TC/control/Scale.js");TC.control.ScaleSelector=function(){var e=this;TC.control.Scale.apply(e,arguments);e.scales=null};TC.inherit(TC.control.ScaleSelector,TC.control.Scale);!function(){var e=TC.control.ScaleSelector.prototype;e.CLASS="tc-ctl-ss";e.template=TC.isDebug?TC.apiLocation+"TC/templates/ScaleSelector.html":function(){function t(e,t){return e.w('<div class="ol-scale-line ol-unselectable"><nobr><select>').s(t.get(["scales"],!1),t,{block:n},{}).w('</select> <input type="button" value="').f(t.get(["screenSize"],!1),t,"h").w("''\" title=\"").h("i18n",t,{},{$key:"estimatedMapSize"}).w('" /></nobr></div>')}function n(e,t){return e.w('<option value="').f(t.getPath(!0,[]),t,"h").w('"').h("eq",t,{block:r},{key:i,value:a}).w(">1:").h("math",t,{},{key:s,method:"round"}).w("</option>\n")}function r(e,t){return e.w(' selected="true"')}function i(e,t){return e.f(t.getPath(!0,[]),t,"h")}function a(e,t){return e.f(t.get(["scale"],!1),t,"h")}function s(e,t){return e.f(t.getPath(!0,[]),t,"h")}dust.register(e.CLASS,t);t.__dustBody=!0;n.__dustBody=!0;r.__dustBody=!0;i.__dustBody=!0;a.__dustBody=!0;s.__dustBody=!0;return t};e.render=function(e){var t=this;if(t.map){!t.scales&&t.map.options.resolutions&&(t.scales=t.map.options.resolutions.map(t.getScale,t));var n=function(){t.scales=t.map.wrap.getResolutions().map(t.getScale,t);$("input[type=button]",t._$div).off();$("select",t._$div).off();t.renderData({scale:t.getScale(),screenSize:TC.Cfg.screenSize,scales:t.scales},function(){t._$div.find("option").each(function(e,n){$elm=$(n);$elm.text("1:"+t.format($elm.text().substr(2)))});t._$div.find('input[type="button"]').on(TC.Consts.event.CLICK,function(){t.setScreenSize.call(t)});$("select",t._$div).on("change",function(){t.setScale($(this).val())});$.isFunction(e)&&e()})};t.scales?n():$.when(t.map.wrap.getMap()).then(n)}};e.setScale=function(e){var t=this,n=.0254*e/t.getDpi(TC.Cfg.screenSize);window.devicePixelRatio&&(n/=window.devicePixelRatio);t.metersPerDegree&&(n/=t.metersPerDegree);t.map.wrap.setResolution(n);return n}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control.js");TC.control.Search=function(){var e=this;TC.Control.apply(e,arguments);TC.Consts.event.TOOLSCLOSE=TC.Consts.event.TOOLSCLOSE||"toolsclose.tc";e.url="//idena.navarra.es/ogc/wfs";e.version="1.1.0";e.featurePrefix="IDENA";e._LIKE_PATTERN="*";e.UTMX="X";e.UTMY="Y";e.LON="Lon";e.LAT="Lat";e.UTMX_LABEL="X: ";e.UTMY_LABEL="Y: ";e.LON_LABEL="Lon: ";e.LAT_LABEL="Lat: ";e.MUN="M";e.POL="P";e.PAR="Par";e.MUN_LABEL="Mun: ";e.POL_LABEL="Pol: ";e.PAR_LABEL="Par: ";e.availableSearchTypes={};e.availableSearchTypes[TC.Consts.searchType.CADASTRAL]={suggestionRoot:null,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:e.featurePrefix||"IDENA",geometryName:"the_geom",featureType:["CATAST_Pol_ParcelaRusti","CATAST_Pol_ParcelaUrba","CATAST_Pol_ParcelaMixta"],municipality:{featureType:"CATAST_Pol_Municipio",outputProperties:["CMUNICIPIO","MUNICIPIO"]},queryProperties:{municipality:"CMUNICIPIO",polygon:"POLIGONO",parcel:"PARCELA"},suggestionListHead:function(){return{label:e.getLocaleString("search.list.cadastral"),color:{"#e5475f":e.getLocaleString("search.list.cadastral.mixed"),"#0c8b3d":e.getLocaleString("search.list.cadastral.rustic"),"#136278":e.getLocaleString("search.list.cadastral.urban")}}},styles:{CATAST_Pol_ParcelaUrba:{polygon:{fillColor:"#000000",fillOpacity:.1,strokeColor:"#136278",strokeWidth:2,strokeOpacity:1}},CATAST_Pol_ParcelaRusti:{polygon:{fillColor:"#000000",fillOpacity:.1,strokeColor:"#0c8b3d",strokeWidth:2,strokeOpacity:1}},CATAST_Pol_ParcelaMixta:{polygon:{fillColor:"#000000",fillOpacity:.1,strokeColor:"#e5475f",strokeWidth:2,strokeOpacity:1}}},parser:e.getCadastralRef,goTo:e.goToCadastralRef,goToIdFormat:"M{0}P{1}Par{2}",idPropertiesIdentifier:"#"};e.availableSearchTypes[TC.Consts.searchType.COORDINATES]={parser:e.getCoordinates,goTo:e.goToCoordinates,label:null,suggestionListHead:function(t){return{label:e.availableSearchTypes[TC.Consts.searchType.COORDINATES].label||e.getLocaleString("search.list.coordinates")}}};e.availableSearchTypes[TC.Consts.searchType.MUNICIPALITY]={root:null,limit:!1,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:e.featurePrefix||"IDENA",geometryName:"the_geom",featureType:"CATAST_Pol_Municipio",dataIdProperty:["CMUNICIPIO"],queryProperties:{tProperty:["MUNINOAC","MUNICIPIO"]},suggestionListHead:function(){return{label:e.getLocaleString("search.list.municipality"),color:{"#fe06a5":e.getLocaleString("search.list.municipality")}}},outputProperties:["MUNICIPIO"],outputFormatLabel:"{0}",searchWeight:2,styles:{CATAST_Pol_Municipio:{polygon:{fillColor:"#000000",fillOpacity:.1,strokeColor:"#fe06a5",strokeWidth:2,strokeOpacity:1}}},parser:e.getAddress,goTo:e.goToAddress};e.availableSearchTypes[TC.Consts.searchType.LOCALITY]={root:null,limit:!1,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:e.featurePrefix||"IDENA",geometryName:"the_geom",featureType:["CATAST_Pol_Municipio","ESTADI_Pol_EntidadPob"],renderFeatureType:["CATAST_Pol_Municipio"],dataIdProperty:{CATAST_Pol_Municipio:["CMUNICIPIO"],ESTADI_Pol_EntidadPob:["CMUNICIPIO","CENTIDAD"]},queryProperties:{tProperty:{CATAST_Pol_Municipio:["MUNINOAC","MUNICIPIO"],ESTADI_Pol_EntidadPob:["ENTINOAC","ENTIDAD"]}},suggestionListHead:function(){return{label:e.getLocaleString("search.list.locality"),color:{"#feba1e":e.getLocaleString("search.list.locality")}}},outputProperties:{CATAST_Pol_Municipio:["MUNICIPIO"],ESTADI_Pol_EntidadPob:["MUNICIPIO","ENTIDAD"]},outputFormatLabel:{CATAST_Pol_Municipio:"{0}",ESTADI_Pol_EntidadPob:"{1} ({0})"},searchWeight:2,styles:{CATAST_Pol_Municipio:{polygon:{fillColor:"#000000",fillOpacity:0,strokeColor:"#ffffff",strokeWidth:5,strokeOpacity:1}},ESTADI_Pol_EntidadPob:{polygon:{fillColor:"#000000",fillOpacity:.1,strokeColor:"#feba1e",strokeWidth:2,strokeOpacity:1}}},parser:e.getAddress,goTo:e.goToAddress};e.availableSearchTypes[TC.Consts.searchType.COUNCIL]={root:null,limit:!1,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:e.featurePrefix||"IDENA",geometryName:"the_geom",featureType:"CATAST_Pol_Concejo",renderFeatureType:"",dataIdProperty:["CMUNICIPIO","CCONCEJO"],queryProperties:{tProperty:["CONCEJO"]},outputProperties:["MUNICIPIO","CONCEJO"],outputFormatLabel:"{1} ({0})",searchWeight:2,parser:e.getAddress,goTo:e.goToAddress,idPropertiesIdentifier:"#",suggestionListHead:function(){return{label:e.getLocaleString("search.list.council"),color:{"#49006a":e.getLocaleString("search.list.council")}}},styles:{CATAST_Pol_Concejo:{polygon:{fillColor:"#000000",fillOpacity:.1,strokeColor:"#49006a",strokeWidth:2,strokeOpacity:1}}}};e.availableSearchTypes[TC.Consts.searchType.STREET]={root:null,limit:null,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:e.featurePrefix||"IDENA",geometryName:"the_geom",featureType:"CATAST_Lin_CalleEje",renderFeatureType:"CATAST_Txt_Calle",dataIdProperty:["CVIA"],queryProperties:{tProperty:["ENTINOAC","ENTIDADC"],sProperty:["VIA","VIANOAC"]},suggestionListHead:function(){return{label:e.getLocaleString("search.list.street"),color:{"#CB0000":e.getLocaleString("search.list.street")}}},outputProperties:["ENTIDADC","VIA"],outputFormatLabel:"{1}, {0}",styles:{CATAST_Lin_CalleEje:{line:{strokeColor:"#CB0000",strokeOpacity:1,strokeWidth:2,strokeLinecap:"round",strokeDashstyle:"solid"}},CATAST_Txt_Calle:{point:{label:"VIA",angle:"CADANGLE",fontColor:"#000000",fontSize:7,fontWeight:"bold",labelOutlineColor:"#ffffff",labelOutlineWidth:2}}},parser:e.getAddress,goTo:e.goToAddress};e.availableSearchTypes[TC.Consts.searchType.NUMBER]={root:null,limit:null,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:e.featurePrefix||"IDENA",geometryName:"the_geom",featureType:"CATAST_Txt_Portal",renderFeatureType:"",dataIdProperty:["CMUNICIPIO","CENTIDADC","CVIA","PORTAL"],queryProperties:{tProperty:["ENTIDADC","ENTINOAC"],sProperty:["VIA","VIANOAC"],pProperty:["PORTAL"]},suggestionListHead:function(){return{label:e.getLocaleString("search.list.number"),color:{"#CB0000":e.getLocaleString("search.list.number")}}},outputProperties:["ENTIDADC","VIA","PORTAL"],outputFormatLabel:"{1} {2}, {0}",styles:{CATAST_Txt_Portal:{point:{radius:0,label:"PORTAL",angle:"CADANGLE",fontColor:"#CB0000",fontSize:14,fontWeight:"bold",labelOutlineColor:"#FFFFFF",labelOutlineWidth:4}}},parser:e.getAddress,goTo:e.goToAddress};e.availableSearchTypes[TC.Consts.searchType.URBAN]={root:null,limit:!1,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:e.featurePrefix||"IDENA",geometryName:"the_geom",featureType:"ESTADI_Pol_EntidadPob",renderFeatureType:"",dataIdProperty:["CMUNICIPIO","CENTIDAD"],idPropertiesIdentifier:"#",queryProperties:{tProperty:["ENTINOAC","ENTIDAD"]},suggestionListHead:function(){return{label:e.getLocaleString("search.list.urban"),color:{"#feba1e":e.getLocaleString("search.list.urban")}}},outputProperties:["MUNICIPIO","ENTIDAD"],outputFormatLabel:"{1} ({0})",searchWeight:2,styles:{ESTADI_Pol_EntidadPob:{polygon:{fillColor:"#000000",fillOpacity:.1,strokeColor:"#feba1e",strokeWidth:2,strokeOpacity:1}}},parser:e.getAddress,goTo:e.goToAddress};e.availableSearchTypes[TC.Consts.searchType.COMMONWEALTH]={root:null,limit:!1,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:e.featurePrefix||"IDENA",geometryName:"the_geom",featureType:["POLUCI_Pol_MancoRSUg"],renderFeatureType:"",dataIdProperty:["CMANCOMUNI"],queryProperties:{tProperty:["MANCOMUNID"]},outputProperties:["MANCOMUNID"],outputFormatLabel:"{0}",searchWeight:1,styles:{POLUCI_Pol_MancoRSUg:{polygon:{fillColor:"#000000",fillOpacity:.1,strokeColor:"#fc4e2a",strokeWidth:2,strokeOpacity:1}}}};e.allowedSearchTypes=e.options.allowedSearchTypes||{};if(e.options.allowedSearchTypes)for(var t in e.options.allowedSearchTypes)if(e.availableSearchTypes[t]&&!$.isEmptyObject(e.options.allowedSearchTypes[t])){$.extend(e.availableSearchTypes[t],e.options.allowedSearchTypes[t]);if(t!=TC.Consts.searchType.MUNICIPALITY&&e.options.allowedSearchTypes[t].root){e.availableSearchTypes[TC.Consts.searchType.MUNICIPALITY].root=e.options.allowedSearchTypes[t].root;e.availableSearchTypes[TC.Consts.searchType.MUNICIPALITY].limit=e.options.allowedSearchTypes[t].limit||!0;e.availableSearchTypes[TC.Consts.searchType.STREET].queryProperties.tProperty=e.availableSearchTypes[TC.Consts.searchType.NUMBER].queryProperties.tProperty=e.availableSearchTypes[TC.Consts.searchType.MUNICIPALITY].dataIdProperty}}e.queryableFeatures=e.options.queryableFeatures||!1;e.UTMX_LEN=6;e.UTMY_LEN=7;e.CADASTRAL=TC.Consts.searchType.CADASTRAL;e.COORDINATES=TC.Consts.searchType.COORDINATES;e.MUNICIPALITY=TC.Consts.searchType.MUNICIPALITY;e.LOCALITY=TC.Consts.searchType.LOCALITY;e.COUNCIL=TC.Consts.searchType.COUNCIL;e.STREET=TC.Consts.searchType.STREET;e.NUMBER=TC.Consts.searchType.NUMBER;e.COMMONWEALTH=TC.Consts.searchType.COMMONWEALTH;e.URBAN=TC.Consts.searchType.URBAN;e.wrap=new TC.wrap.control.Search(e);e.interval=500;e.rootLabel="";e.searchTypes={CADASTRAL_SEARCH:{parser:e.getCadastralRef,goTo:e.goToCadastralRef},COORDINATES_SEARCH:{parser:e.getCoordinates,goTo:e.goToCoordinates},ADDRESS_SEARCH:{types:[TC.Consts.searchType.MUNICIPALITY,TC.Consts.searchType.LOCALITY,TC.Consts.searchType.COUNCIL,TC.Consts.searchType.URBAN,TC.Consts.searchType.STREET,TC.Consts.searchType.NUMBER],parser:e.getAddress,goTo:e.goToAddress}};e.NORMAL_PATTERNS={ROMAN_NUMBER:/M{0,4}(CM|CD|D?C{0,3})(XC|XL|L?X{0,3})(IX|IV|V?I{0,3}){1,}?\S?\./g,ABSOLUTE_NOT_DOT:/[`~!@#$%^&*_|+\=?;:'"\{\}\[\]\\]/g,ABSOLUTE:/[`~!@#$%^&*_|+\=?;:'.\{\}\[\]\\]/g}};TC.inherit(TC.control.Search,TC.Control);!function(){var e=TC.control.Search.prototype;e.CLASS="tc-ctl-search";TC.Consts.event.SEARCHQUERYEMPTY=TC.Consts.event.SEARCHQUERYEMPTY||"searchqueryempty.tc";e.template=TC.isDebug?TC.apiLocation+"TC/templates/Search.html":function(){function t(e,t){return e.w("<h2>").h("i18n",t,{},{$key:"search.1"}).w('</h2><div class="tc-ctl-search-content"><input type="search" class="tc-ctl-search-txt" placeholder="').h("i18n",t,{},{$key:"search.placeholder"}).w('" title="').h("i18n",t,{},{$key:"search.instructions"}).w('" /><a title="').h("i18n",t,{},{$key:"search.instructions"}).w('" class="tc-ctl-btn tc-ctl-search-btn">').h("i18n",t,{},{$key:"search.2"}).w('</a><ul class="tc-ctl-search-list"></ul></div>')}dust.register(e.CLASS,t);t.__dustBody=!0;return t};e.register=function(e){var t=this;TC.Control.prototype.register.call(t,e);t._search={data:[]};var n=function(){function e(e){return e.indexOf(".")>-1?e.split(".")[0]:e}function n(e,n,r){for(var i in t.allowedSearchTypes)if(t.availableSearchTypes[i].hasOwnProperty("featureType")&&(t.availableSearchTypes[i].featureType.indexOf(r)>-1||t.availableSearchTypes[i].renderFeatureType&&t.availableSearchTypes[i].renderFeatureType.indexOf(r)>-1)&&t.availableSearchTypes[i].styles[r].hasOwnProperty(n))return t.availableSearchTypes[i].styles[r][n][e];console.log("No hay estilo definido");return TC.Cfg.styles[n][e]}return function(t,r,i,a){var s=this;a instanceof TC.Feature||s.map.$events.trigger($.Event(TC.Consts.event.FEATURESADD,{layer:s.layer,geom:a.geom}));var o=n(r,t,e(a.id));return i?a.getData().hasOwnProperty(o)?a.getData()[o]:"":o}}();e.loaded(function(){t.layerPromise=e.addLayer({id:TC.getUID(),title:"B\xfasquedas",stealth:!0,type:TC.Consts.layerType.VECTOR,styles:{polygon:{fillColor:n.bind(t,"polygon","fillColor",!1),fillOpacity:n.bind(t,"polygon","fillOpacity",!1),strokeColor:n.bind(t,"polygon","strokeColor",!1),strokeOpacity:n.bind(t,"polygon","strokeOpacity",!1),strokeWidth:n.bind(t,"polygon","strokeWidth",!1)},line:{strokeColor:n.bind(t,"line","strokeColor",!1),strokeOpacity:n.bind(t,"line","strokeOpacity",!1),strokeWidth:n.bind(t,"line","strokeWidth",!1)},point:{radius:n.bind(t,"point","radius",!1),height:n.bind(t,"point","height",!1),width:n.bind(t,"point","width",!1),fillColor:n.bind(t,"point","fillColor",!1),fillOpacity:n.bind(t,"point","fillOpacity",!1),strokeColor:n.bind(t,"point","strokeColor",!1),strokeWidth:n.bind(t,"point","strokeWidth",!1),fontSize:n.bind(t,"point","fontSize",!1),fontColor:n.bind(t,"point","fontColor",!1),labelOutlineColor:n.bind(t,"point","labelOutlineColor",!1),labelOutlineWidth:n.bind(t,"point","labelOutlineWidth",!1),label:n.bind(t,"point","label",!0),angle:n.bind(t,"point","angle",!0)}}});$.when(t.layerPromise).then(function(e){t.layer=e})});t.EMPTY_RESULTS_LABEL=t.getLocaleString("noResults");t.EMPTY_RESULTS_TITLE=t.getLocaleString("checkCriterion");t.OUTBBX_LABEL=t.getLocaleString("outsideOfLimits");t.WFS_TYPE_ATTRS=["url","version","geometryName","featurePrefix","featureType","properties","outputFormat"]};e.renderData=function(e,t){var n=this;n._search=n._search||{};var r=function(){n.search(n.$text.val(),function(e){if(1===e.length){n.$text.val(e[0].label);n.goToResult(e[0].id);n.$list.hide("fast")}else 0===e.length&&n.$list.hide("fast")})};TC.Control.prototype.renderData.call(n,e,function(){var e=function(){n.$text.val(n.$list[0].label||n.$list.find("li:not([header]) > a > span").text());n.lastPattern=n.$text.val();n.goToResult(n.$list[0].id||unescape(n.$list.find("li:not([header]) > a").attr("href")).substring(1));n.$list.hide("fast")};n.$text=n._$div.find("input.tc-ctl-search-txt");n.$list=n._$div.find(".tc-ctl-search-list");n.$button=n._$div.find(".tc-ctl-search-btn");n.$button.on(TC.Consts.event.CLICK,function(){n.getLayer().then(function(t){n.$list.find("li > a:not(.tc-ctl-search-li-loading,.tc-ctl-search-li-empty)").length>1||(t.features.length>0?t.map.zoomToFeatures(t.features):1===n.$list.find("li > a:not(.tc-ctl-search-li-loading,.tc-ctl-search-li-empty)").length?e():n.$text.trigger("keyup.autocomplete"))})});n.$list.on(TC.Consts.event.CLICK,"a.tc-ctl-search-li-empty",function(){n.$list.hide("fast");n.$text.focus()});try{if(n.$text.has($("::-ms-clear"))){var t;n.$text.on("mouseup",function(e){t=n.$text.val();""!==t&&setTimeout(function(){var e=n.$text.val();if(""===e){n.$list.hide("fast");r()}},1)})}}catch(i){}n.$text.on("keypress",function(t){if(13==t.which){t.preventDefault();t.stopPropagation();1===n.$list.find("li > a:not(.tc-ctl-search-li-loading,.tc-ctl-search-li-empty)").length&&e();return!1}}).on("search",function(){if(0===n.$text.val().length){n.$list.hide("fast");r()}}).on("input",function(){if(0===n.$text.val().length){n.$list.hide("fast");r()}}).on("targetCleared.autocomplete",function(){n.$list.hide("fast")}).on("targetUpdated.autocomplete",function(){n.$list.find("li").length>0&&n.$list.show("fast")});n.lastPattern="";n.retryTimeout=null;TC.loadJS(!n.$text.autocomplete,[TC.apiLocation+"lib/jQuery/autocomplete.js"],function(){n.$text=n._$div.find("input.tc-ctl-search-txt");n.$text.autocomplete({link:"#",target:n.$list,minLength:2,ctx:n,source:function(e,t){if(e!=n.lastPattern){n.$list.hide("fast");n.lastPattern=e;n.retryTimeout&&clearTimeout(n.retryTimeout);n.retryTimeout=setTimeout(function(){n.search(e,t)},n.interval)}},callback:function(e){var t=$(e.target);$(e.target).is("a")||(t=$(e.target).closest("a"));n.$text.val($(t).find("span[hidden]").text());n.lastPattern=n.$text.val();n.goToResult(unescape($(t).attr("href")).substring(1),$(t).parent().attr("dataRole"));n.$text.autocomplete("clear")},buildHTML:function(e){for(var t=[],r=[],i=e.results.sort(function(e,t){return e.dataRole>t.dataRole?1:e.dataRole<t.dataRole?-1:0}),a=0;a<i.length;a++){var s=i[a];if(-1==r.indexOf(s.dataRole)){var o=this.ctx.availableSearchTypes[s.dataRole].suggestionListHead(),l='<li header><span class="header">'+o.label+"</span>";for(var c in o.color)l+='<span class="header-color" title="'+o.color[c]+'" style="color: '+c+';"></span>';t[t.length]=l+"</li>";r.push(s.dataRole)}var u=s.label,h=[],p=this.ctx.lastPattern;p=n.NORMAL_PATTERNS.ROMAN_NUMBER.test(p)?p.replace(n.NORMAL_PATTERNS.ABSOLUTE_NOT_DOT,""):p.replace(n.NORMAL_PATTERNS.ABSOLUTE,"");var d=p.trim().split(",");if(s.label.indexOf(this.ctx.LAT_LABEL)>-1&&s.label.indexOf(this.ctx.LON_LABEL)>-1||s.label.indexOf(this.ctx.UTMX_LABEL)>-1&&s.label.indexOf(this.ctx.UTMY_LABEL)>-1){d=this.ctx.lastPattern.split(" ");for(var f=0;f<d.length;f++)","==d[f].trim().slice(-1)&&(d[f]=d[f].slice(0,-1))}for(var m=0;m<d.length;m++){h.push("("+d[m].trim().replace(/\(/gi,"\\(").replace(/\)/gi,"\\)")+")");var y=/((\<)|(\>)|(\<\>))/gi.exec(d[m].trim());if(y)for(var g=d[m].trim().replace(/((\<)|(\>)|(\<\>))/gi,"").split(" "),v=0;v<g.length;v++)g[v].trim().length>0&&h.push("("+g[v].trim().replace(/\(/gi,"\\(").replace(/\)/gi,"\\)")+")")}var C="("+h.join("|")+")";C=C.replace(/a/gi,"[a|\xe1]");C=C.replace(/e/gi,"[e|\xe9]");C=C.replace(/i/gi,"[i|\xed]");C=C.replace(/o/gi,"[o|\xf3]");C=C.replace(/u/gi,"[u|\xfa|\xfc]");var L=new RegExp(C,"gi");u=s.label.replace(L,"<b>$1</b>");t[t.length]='<li dataRole="'+s.dataRole+'"><a href="#'+encodeURIComponent(s.id)+'"><span hidden>'+s.label+"</span>"+u+"</a></li>"}return t.join("")}});n.$text.add(n.$list).keydown(function(e){if(!e.ctrlKey&&!e.altKey&&!e.shiftKey)if(40===e.keyCode){n.$text[0]==document.activeElement?n.$list.find("li:not([header]):first a").focus():n.$list.find("li:not([header]):last a").is(":focus")?n.$text.focus():n.$list.find("li:not([header])").find("a:focus").parent("li:not([header])").nextAll("li:not([header]):first").find("a").focus();e.preventDefault();e.stopPropagation()}else if(38===e.keyCode){n.$text[0]==document.activeElement?n.$list.find("li:not([header]):last a").focus():document.activeElement==n.$list.find("li:not([header]):first a").get(0)?n.$list.find("li:not([header]):last a").focus():n.$list.find("li:not([header])").find("a:focus").parent("li:not([header])").prevAll("li:not([header]):first").find("a").focus();e.preventDefault();e.stopPropagation()}e.stopPropagation()})})});$.isFunction(t)&&t()};e.getLayer=function(){var e=this;e.layerPromise=e.layerPromise||new $.Deferred;if(e.layer){var t=new $.Deferred;t.resolve(e.layer);return t}return e.layerPromise};e.getFeatures=function(){var e=this;return e.layer.features};e.cleanMap=function(){var e=this;e.getLayer().then(function(t){t.clearFeatures();for(var n=0;n<e.WFS_TYPE_ATTRS.length;n++)t.hasOwnProperty(e.WFS_TYPE_ATTRS[n])&&delete t[e.WFS_TYPE_ATTRS[n]]})};e.getMunicipalities=function(){var e=this;TC.cache.search=TC.cache.search||{};if(!TC.cache.search.municipalities){e._municipalitiesDeferred=new $.Deferred;var t={REQUEST:"GetFeature",SERVICE:"WFS",TYPENAME:e.availableSearchTypes[TC.Consts.searchType.CADASTRAL].municipality.featureType,VERSION:e.availableSearchTypes[TC.Consts.searchType.CADASTRAL].version,PROPERTYNAME:e.availableSearchTypes[TC.Consts.searchType.CADASTRAL].municipality.outputProperties.join(","),OUTPUTFORMAT:e.availableSearchTypes[TC.Consts.searchType.CADASTRAL].outputFormat};e.availableSearchTypes[TC.Consts.searchType.CADASTRAL].featurePrefix&&(t.TYPENAME=e.availableSearchTypes[TC.Consts.searchType.CADASTRAL].featurePrefix+":"+t.TYPENAME);var n=e.availableSearchTypes[TC.Consts.searchType.CADASTRAL].url+"?"+$.param(t);$.ajax({url:n,type:"GET",dataType:"text"}).done(function(t){var n;n=e.availableSearchTypes[TC.Consts.searchType.CADASTRAL].outputFormat===TC.Consts.format.JSON?new TC.wrap.parser.JSON:new TC.wrap.parser.WFS({featureNS:e.availableSearchTypes[TC.Consts.searchType.CADASTRAL].municipality.featurePrefix,featureType:e.availableSearchTypes[TC.Consts.searchType.CADASTRAL].municipality.featureType});var r=n.read(t);TC.cache.search.municipalities=[];for(var i=0;i<r.length;i++){var a=r[i];TC.cache.search.municipalities.push({label:a.data[e.availableSearchTypes[TC.Consts.searchType.CADASTRAL].municipality.outputProperties[1]],id:a.data[e.availableSearchTypes[TC.Consts.searchType.CADASTRAL].municipality.outputProperties[0]]})}TC.cache.search.municipalities.sort(function(e,t){var n;n=e.label<t.label?-1:e.label>t.label?1:0;return n});e._municipalitiesDeferred.resolve(TC.cache.search.municipalities)})}return TC.cache.search.municipalities||e._municipalitiesDeferred.promise()};e.getCoordinates=function(e){var t=this,n=new $.Deferred,r=e.match(new RegExp("^"+$.trim(t.UTMX_LABEL.toLowerCase())+"*\\s*([0-9]{"+t.UTMX_LEN+"}(?:[.,]\\d+)?)\\s*\\,?\\s*"+$.trim(t.UTMY_LABEL.toLowerCase())+"*\\s*([0-9]{"+t.UTMY_LEN+"}(?:[.,]\\d+)?)$"));r&&(e=r[1]+" "+r[2]);r=e.match(new RegExp("^"+$.trim(t.LAT_LABEL.toLowerCase())+"*\\s*([-+]?\\d{1,3}([.,]\\d+)?)\\,?\\s*"+$.trim(t.LON_LABEL.toLowerCase())+"*\\s*([-+]?\\d{1,2}([.,]\\d+)?)$"));r&&(e=r[1]+" "+r[3]);if(/\d/.test(e)&&(new RegExp("^([0-9]{"+t.UTMX_LEN+"}(?:[.,]\\d+)?)\\s*\\,?\\s*([0-9]{"+t.UTMY_LEN+"}(?:[.,]\\d+)?)$").test(e)||/^([-+]?\d{1,3}([.,]\d+)?)\,?\s*([-+]?\d{1,2}([.,]\d+)?)$/.test(e))){r=/^([-+]?\d{1,3}([.,]\d+)?)\,?\s*([-+]?\d{1,2}([.,]\d+)?)$/.exec(e);if(r&&(r[1].indexOf(",")>-1||r[3].indexOf(",")>-1)){r[1]=r[1].replace(",",".");r[3]=r[3].replace(",",".");e=r[1]+" "+r[3]}if(!r||r&&(r[1].indexOf(",")>-1?r[1].replace(",","."):r[1])<=180&&(r[3].indexOf(",")>-1?r[3].replace(",","."):r[3])<=90){r=new RegExp("^([0-9]{"+t.UTMX_LEN+"}(?:[.,]\\d+)?)\\s*\\,?\\s*([0-9]{"+t.UTMY_LEN+"}(?:[.,]\\d+)?)$").exec(e);if(r&&(r[1].indexOf(",")>-1||r[2].indexOf(",")>-1)){r[1]=r[1].replace(",",".");r[2]=r[2].replace(",",".");e=r[1]+" "+r[2]}e=e.replace(t.UTMX_LABEL,"").replace(t.UTMY_LABEL,"").replace(t.LON_LABEL,"").replace(t.LAT_LABEL,"");var i=TC.Util.parseCoords(e);if(i){var a=i[0].value,s=i[1].value,o=i[0].type===TC.Consts.UTM?t.UTMX:t.LAT,l=i[1].type===TC.Consts.UTM?t.UTMY:t.LON,c=o+a+l+s,u=t.getPoint(c);if(u&&!t.insideLimit(u)){a=i[1].value;s=i[0].value;o=i[1].type===TC.Consts.UTM?t.UTMX:t.LAT;l=i[0].type===TC.Consts.UTM?t.UTMY:t.LON;c=o+a+l+s;u=t.getPoint(c)}if(u){t.availableSearchTypes[TC.Consts.searchType.COORDINATES].label=/^X(\d+(?:\.\d+)?)Y(\d+(?:\.\d+)?)$/.test(c)?t.getLocaleString("search.list.coordinates.utm")+t.map.crs:t.getLocaleString("search.list.coordinates.geo");n.resolve([{id:c,label:t.getLabel(c),dataRole:TC.Consts.searchType.COORDINATES}])}else n.resolve([])}}else n.resolve([])}else n.resolve([]);return n.promise()};e.getCadastralRef=function(e){var t=this,n=new $.Deferred,r=e.match(new RegExp($.trim(t.MUN_LABEL.toLowerCase())+"?\\s(.*)\\,\\s?"+$.trim(t.POL_LABEL.toLowerCase())+"?\\s(\\d{1,2})\\,\\s?"+$.trim(t.PAR_LABEL.toLowerCase())+"?\\s(\\d{1,4})"));r&&(e=r[1]+", "+r[2]+", "+r[3]);var i=e;!/^(.*)\,(\s*\d{1,2}\s*)\,(\s*\d{1,4}\s*)$/.test(e)&&t.availableSearchTypes[TC.Consts.searchType.CADASTRAL].suggestionRoot&&(i=t.availableSearchTypes[TC.Consts.searchType.CADASTRAL].suggestionRoot+", "+e);/^(.*)\,(\s*\d{1,2}\s*)\,(\s*\d{1,4}\s*)$/.test(i)&&!new RegExp("^([0-9]{"+t.UTMX_LEN+"})\\s*\\,\\s*([0-9]{"+t.UTMY_LEN+"})$").test(e)?$.when(t.getMunicipalities()).then(function(e){var r=/^(.*)\,(\s*\d{1,2}\s*)\,(\s*\d{1,4}\s*)$/.exec(i);

if(r){var a=new RegExp($.trim(r[1]).replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),"i"),s=$.grep(e,function(e){e=e.label||e.id||e;return a.test(e)||a.test(t.removePunctuation(e))}),o=function(e,n,r,i){return{id:t.MUN+e+t.POL+r+t.PAR+i,label:t.getLabel(t.MUN+n+t.POL+r+t.PAR+i),dataRole:TC.Consts.searchType.CADASTRAL}};if(s.length>0)for(var l=0;l<s.length;l++)s[l]=o(s[l].id,s[l].label,$.trim(r[2]),$.trim(r[3]));/^[0-9]*$/g.test(r[1])&&s.push(o($.trim(r[1]),$.trim(r[1]),$.trim(r[2]),$.trim(r[3])));n.resolve(s)}}):n.resolve([]);return n.promise()};e.getAddress=function(e){var t=this,n=new $.Deferred,r=[],i=function(e){var n=[];for(var r in t.allowedSearchTypes)switch(!0){case r==TC.Consts.searchType.MUNICIPALITY:case r==TC.Consts.searchType.LOCALITY:case r==TC.Consts.searchType.COUNCIL:case r==TC.Consts.searchType.URBAN:case r==TC.Consts.searchType.STREET:case r==TC.Consts.searchType.NUMBER:t.availableSearchTypes[r]&&t.availableSearchTypes[r].hasOwnProperty("queryProperties")&&Object.keys(t.availableSearchTypes[r].queryProperties).length===Object.keys(e).length&&n.push(r)}n=n.sort(function(e,n){return(t.availableSearchTypes[e].searchWeight||0)>=(t.availableSearchTypes[n].searchWeight||0)?1:0}).filter(function(e){for(var r=0;r<n.length;r++)if((t.availableSearchTypes[n[r]].searchWeight||0)>(t.availableSearchTypes[e].searchWeight||0))return!1;return!0});return n},a=function(e,n){var r;r=t.availableSearchTypes[n].outputFormat===TC.Consts.format.JSON?new TC.wrap.parser.JSON:new TC.wrap.parser.WFS({featureNS:t.availableSearchTypes[n].featurePrefix,featureType:t.availableSearchTypes[n].featureType});return r.read(e)},s=function(e){var n="";e=t.removePunctuation(e);var r,i=/(.*)\s<>\s.*/;if(e.indexOf("(")>-1||e.indexOf(")")>-1){i=/(.*)(\s<>\s.*\(.*\))/;if(e.indexOf("<>")>-1&&i.test(e)){r=e.match(i);if(null!==r){n=e.replace(r[2],"");n=n.splitRemoveWhiteSpaces(",").join(",")}}else{i=/\(.*\)/;if(!i.test(e)){i=/\(.*/;if(!i.test(e)){i=/.*\)/;i.test(e)||(i=/\(.*\)/)}}n=e.replace(i,"");n=n.splitRemoveWhiteSpaces(",").join(",")}e=n}e=t.NORMAL_PATTERNS.ROMAN_NUMBER.test(e)?e.replace(t.NORMAL_PATTERNS.ABSOLUTE_NOT_DOT,""):e.replace(t.NORMAL_PATTERNS.ABSOLUTE,"");return e.toLowerCase()},o=function(e){for(var n=function(e){return/^(\d{1,3})\s?\-?\s?([a-z]{0,4})\s?\-?\s?([a-z]{0,4})$/i.test(e)},r=function(e){var n=[],r=/^(\d{1,3})\s?\-?\s?([a-z]{0,4})\s?\-?\s?([a-z]{0,4})$/i.exec(e);if(r){for(var i=1;i<r.length;i++)r[i].trim().length>0&&n.push(r[i].trim());return n.join(t._LIKE_PATTERN)}return e},i=function(e){return/^([a-z]{1,4})\s?\-?\s?(\d{1,3})$/i.test(e)},a=function(e){var n=[],r=/^([a-z]{1,4})\s?\-?\s?(\d{1,3})$/i.exec(e);if(r){for(var i=1;i<r.length;i++)r[i].trim().length>0&&n.push(r[i].trim());return n.join(t._LIKE_PATTERN)}return e},s=function(e){return/^(sn|S\/N|s\/n|s\-n)$/i.test(e)},o=function(e){var t=/^(sn|S\/N|s\/n|s\-n)$/i.exec(e);return t?"s*n":e},l=function(e){return/^([a-z]{1,4}\s?\+\s?[a-z]{1,4})$/i.test(e)},c=function(e){var t=/^([a-z]{1,4}\s?\+\s?[a-z]{1,4})$/i.exec(e);return t?e:e},u=[n,i,s,l],h=[r,a,o,c],p=0;p<h.length&&!u[p].call(t,e);)p++;return p<h.length?h[p].call(t,e):e},l=function(e,n,r){var i=new $.Deferred;e=e.trim();","==e.charAt(e.length-1)&&(e=e.substring(0,e.length-1));var a=[],s=function(e){if(n)for(var t=0;t<e.length;t++)r?e[t].t&&(e[t].t=n):e.push($.extend({},e[t],{t:n}))},l=function(e,t){var n=/^([^0-9\,]+)(?:\s*\,\s*)(?:([^\,][a-z\u00f1\u00e1\u00e9\u00ed\u00f3\u00fa\u00fc\s*\-\.\(\)\/0-9]+))(?:\s*\,\s*)(?:(\d{1,3}\s?\-?\s?[a-z]{0,4}\s?\-?\s?[a-z]{0,4})|([a-z]{1,4}\s?\-?\s?\d{1,3})|(sn|S\/N|s\/n|s\-n)|([a-z]{1,4}\s?\+\s?[a-z]{1,4}))$/i.exec(e);if(n){var r=function(){return o((n[3]||n[4]||n[5]||n[6]).trim())};if(/^([^0-9]+)$/i.test(n[1].trim())&&/^([^0-9]+)$/i.test(n[2].trim())){t.push({t:n[1].trim(),s:n[2].trim(),p:r()});t.push({t:n[2].trim(),s:n[1].trim(),p:r()})}else t.push(/^([^0-9]+)$/i.test(n[1].trim())?{t:n[1].trim(),s:n[2].trim(),p:r()}:{s:n[1].trim(),t:n[2].trim(),p:r()});s(t);return!0}return!1},c=function(e,t){var n=/^(?:([^\,][a-z\u00f1\u00e1\u00e9\u00ed\u00f3\u00fa\u00fc\s*\-\.\(\)\/0-9]+))(?:\s*\,\s*)([^0-9\,]+)(?:\s*\,\s*)(?:(\d{1,3}\s?\-?\s?[a-z]{0,4}\s?\-?\s?[a-z]{0,4})|([a-z]{1,4}\s?\-?\s?\d{1,3})|(sn|S\/N|s\/n|s\-n)|([a-z]{1,4}\s?\+\s?[a-z]{1,4}))$/i.exec(e);if(n){t.push({t:n[2].trim(),s:n[1].trim(),p:o((n[3]||n[4]||n[5]||n[6]).trim())});s(t);return!0}return!1},u=function(e,n){var r=/^([^0-9\,]+)(?:\s*\,\s*)(?:([^\,][a-z\u00f1\u00e1\u00e9\u00ed\u00f3\u00fa\u00fc\s*\-\.\(\)\/0-9]+))$/i.exec(e);if(r){if(/^([^0-9]+)$/i.test(r[1].trim())&&/^([^0-9]+)$/i.test(r[2].trim())){n.push({t:r[1].trim(),s:r[2].trim()});n.push({s:r[1].trim(),t:r[2].trim()})}else{var i=function(e){for(var n=e.split(" ").reverse(),r=[],i=0;i<n.length;i++)if(1==n[i].length){r.push(n[i]);n[i]=""}return r.length>0?n.reverse().join(" ").trim()+t._LIKE_PATTERN+r.reverse().join(t._LIKE_PATTERN):n.reverse().join(" ").trim()};n.push(/^([^0-9]+)$/i.test(r[1].trim())?{t:r[1].trim(),s:i(r[2].trim())}:{s:i(r[1].trim()),t:r[2].trim()})}s(n);return!0}return!1},h=function(e,n){var r=/^(?:([^\,][a-z\u00f1\u00e1\u00e9\u00ed\u00f3\u00fa\u00fc\s*\-\.\(\)\/0-9]+))(?:\s*\,\s*)([^0-9\,]+)$/i.exec(e);if(r){for(var i={},a=e.split(",").reverse(),l=0;l<a.length;l++)if(/^([^0-9\,]+)$/i.test(a[l].trim()))i.t=a[l].trim();else if(/(\s*\d+)/i.test(a[l].trim()))if(-1==a[l].trim().indexOf(" "))i.s=a[l].trim();else{for(var c=a[l].trim().split(" ").reverse(),u=function(e){var t=/^(?:(\d{1,3}\s?\-?\s?[a-z]{0,4}\s?\-?\s?[a-z]{0,4})|([a-z]{1,4}\s?\-?\s?\d{1,3})|(sn|S\/N|s\/n|s\-n)|([a-z]{1,4}\s?\+\s?[a-z]{1,4}))$/i.exec(e.trim());if(t){i.p=o(e.trim());return!0}return!1},h=0,p=c[h].trim();h<c.length&&!u(p);){h++;h<c.length&&(p+=c[h])}if(i.p){for(var d=c,f=0;f<d.length;f++){for(var m=!1,y=0;y<d[f].split("").length;y++)i.p.indexOf(d[f][y])>-1&&(m=!0);if(m){{d[f]}d[f]="";if(i.p==o(p))break}}if(/^([^\,][a-z\u00f1\u00e1\u00e9\u00ed\u00f3\u00fa\u00fc\s*\-\.\(\)\/0-9]+)$/i.test(c.reverse().join(" ").trim())){for(var g=[],v=c.reverse(),C=0;C<v.length;C++)if(1==v[C].trim().length){g.push(v[C].trim());v[C]=""}i.s=g.length>0?v.reverse().join(" ").trim()+t._LIKE_PATTERN+g.reverse().join(t._LIKE_PATTERN):v.reverse().join(" ").trim()}n.push({t:i.t,s:i.s+" "+i.p})}else i.s=a[l].trim()}n.push(i);s(n);return!0}return!1},p=function(e,t){var r=/^([^\,][a-z\u00f1\u00e1\u00e9\u00ed\u00f3\u00fa\u00fc\s*\-\.\(\)\/0-9\<\>]+)$/i.exec(e);if(r){t.push(n?{t:n,s:r[1].trim()}:{t:r[1].trim()});return!0}return!1},d=function(e,t){var r=/^([^\,][a-z\u00f1\u00e1\u00e9\u00ed\u00f3\u00fa\u00fc\s*\-\.\(\)\/]+)\s*\,?\s*(\d{1,3}\s?\-?\s?[a-z]{0,4}\s?\-?\s?[a-z]{0,4})|([a-z]{1,4}\s?\-?\s?\d{1,3})|(sn|S\/N|s\/n|s\-n)|([a-z]{1,4}\s?\+\s?[a-z]{1,4})$/i.exec(e);if(r&&e.indexOf(",")>-1&&e.split(",").length<3){t.push(n?{t:n,s:r[1].trim(),p:o(r[2].trim())}:{t:r[1].trim(),s:r[2].trim()});return!0}return!1},f=function(e,t){var r=/^([^\,][0-9\s*\-\.\(\)\/]+)\s*\,?\s*(\d{1,3}\s?\-?\s?[a-z]{0,4}\s?\-?\s?[a-z]{0,4})|([a-z]{1,4}\s?\-?\s?\d{1,3})|(sn|S\/N|s\/n|s\-n)|([a-z]{1,4}\s?\+\s?[a-z]{1,4})$/i.exec(e);if(r&&n){t.push({t:n,s:r[1].trim(),p:o(r[2].trim())});return!0}return!1},m=function(){for(var n=[function(e){return e.length>=3},function(e){return/^\d+$/.test(e)?!1:/^\d+\,\s*\d+$/.test(e)?!1:!0}],r=0;r<n.length;r++)if(!n[r].call(t,e))return!1;return!0};if(m(e)){var y=[l,c,u,h];y=n&&e.split(",").length<3?[d,f,p].concat(y):y.concat([d,f,p]);for(var g=0;g<y.length&&!y[g].call(t,e,a);)g++}if(a.length>0&&n){var v=new $.Deferred;t.rootLabel?v.resolve(t.rootLabel):$.when(t.getMunicipalities()).then(function(e){for(var r=0;r<e.length;r++)if(e[r].id==n){t.rootLabel=t.removePunctuation(e[r].label).toLowerCase();break}v.resolve(t.rootLabel)});$.when(v).then(function(e){if(e)for(var r=a.length;r--;){var s=a[r];if(e.indexOf(t.removePunctuation(s.s).toLowerCase())>-1&&s.t==n){a.splice(r,1);break}}i.resolve(a)})}else i.resolve(a);return i.promise()},c=function(e,n){return t.availableSearchTypes[e].queryProperties[n+"Property"]},u=function(e,n){return t.availableSearchTypes[e][n]},h=function(e,n){var r=/([\-\"\.\\xba\(\)\/])/g;r.test(n)&&(n=n.replace(r,"\\$1"));return n.toString().indexOf(t._LIKE_PATTERN)>-1?'<Or><PropertyIsLike escape="\\" singleChar="_" wildCard="*" matchCase="false"><PropertyName>'+e+"</PropertyName><Literal>"+n.toLowerCase().replace(/\</gi,"&lt;").replace(/\>/gi,"&gt;")+'</Literal></PropertyIsLike><PropertyIsLike escape="\\" singleChar="_" wildCard="*" matchCase="false"><PropertyName>'+e+"</PropertyName><Literal>"+n.toUpperCase().replace(/\</gi,"&lt;").replace(/\>/gi,"&gt;")+"</Literal></PropertyIsLike></Or>":"<PropertyIsEqualTo><PropertyName>"+e+"</PropertyName><Literal>"+n.replace(/\</gi,"&lt;").replace(/\>/gi,"&gt;")+"</Literal></PropertyIsEqualTo>"},p=function(e,t){var n;if(e instanceof Array||"string"==typeof e){if(e instanceof Array&&e.length>1){n="<ogc:Or>";for(var r=0;r<e.length;r++)n+=h($.trim(e[r]),t);return n+="</ogc:Or>"}return h($.trim(e instanceof Array&&1===e.length?e[0]:e),t)}var i=[];for(var a in e)if(e[a]instanceof Array&&e[a].length>1){n="<Or>";for(var r=0;r<e[a].length;r++)n+=h($.trim(e[a][r]),t);n+="</Or>";i.push('(<Filter xmlns="http://www.opengis.net/ogc">'+n+"</Filter>)")}else{var s=e[a];e[a]instanceof Array&&1==e[a].length&&(s=e[a][0]);i.push('(<Filter xmlns="http://www.opengis.net/ogc"><Or>'+h($.trim(s),t)+"</Or></Filter>)")}return i.join("")},d=function(e,n){var r={};r.multiL=!1;r.f="";var i;switch(n){case t.NUMBER:i=[];if(t.availableSearchTypes[TC.Consts.searchType.MUNICIPALITY].root||!/(\<|\>|\<\>)/gi.exec(e.t)&&!/(\<|\>|\<\>)/gi.exec(e.s)){i.push(p(c(n,"t"),t.availableSearchTypes[TC.Consts.searchType.MUNICIPALITY].root?e.t:t._LIKE_PATTERN+e.t+t._LIKE_PATTERN));i.push(p(c(n,"s"),t._LIKE_PATTERN+e.s+t._LIKE_PATTERN))}else{var a=/(\<|\>|\<\>)/gi.exec(e.t);i.push(a?p(c(n,"t"),t._LIKE_PATTERN+e.t.substring(0,e.t.indexOf(a[0])).trim()+t._LIKE_PATTERN):p(c(n,"t"),t.availableSearchTypes[TC.Consts.searchType.MUNICIPALITY].root?e.t:t._LIKE_PATTERN+e.t+t._LIKE_PATTERN));a=/(\<|\>|\<\>)/gi.exec(e.s);i.push(a?p(c(n,"s"),t._LIKE_PATTERN+e.s.substring(0,e.s.indexOf(a[0])).trim()+t._LIKE_PATTERN):p(c(n,"s"),t._LIKE_PATTERN+e.s+t._LIKE_PATTERN))}i.push(p(c(n,"p"),e.p+"*"));r.f='<ogc:Filter xmlns:ogc="http://www.opengis.net/ogc"><ogc:And>'+i.join("")+"</ogc:And></ogc:Filter>";break;case t.STREET:i=[];if(t.availableSearchTypes[TC.Consts.searchType.MUNICIPALITY].root||!/(\<|\>|\<\>)/gi.exec(e.t)&&!/(\<|\>|\<\>)/gi.exec(e.s)){i.push(p(c(n,"t"),t.availableSearchTypes[TC.Consts.searchType.MUNICIPALITY].root?e.t:t._LIKE_PATTERN+e.t+t._LIKE_PATTERN));i.push(p(c(n,"s"),t._LIKE_PATTERN+e.s+t._LIKE_PATTERN))}else{var a=/(\<|\>|\<\>)/gi.exec(e.t);i.push(a?p(c(n,"t"),t._LIKE_PATTERN+e.t.substring(0,e.t.indexOf(a[0])).trim()+t._LIKE_PATTERN):p(c(n,"t"),t.availableSearchTypes[TC.Consts.searchType.MUNICIPALITY].root?e.t:t._LIKE_PATTERN+e.t+t._LIKE_PATTERN));a=/(\<|\>|\<\>)/gi.exec(e.s);i.push(a?p(c(n,"s"),t._LIKE_PATTERN+e.s.substring(0,e.s.indexOf(a[0])).trim()+t._LIKE_PATTERN):p(c(n,"s"),t._LIKE_PATTERN+e.s+t._LIKE_PATTERN))}r.f='<ogc:Filter xmlns:ogc="http://www.opengis.net/ogc"><ogc:And>'+i.join("")+"</ogc:And></ogc:Filter>";break;case t.COUNCIL:r.f='<ogc:Filter xmlns:ogc="http://www.opengis.net/ogc">'+p(c(n,"t"),t._LIKE_PATTERN+e.t+t._LIKE_PATTERN)+"</ogc:Filter>";break;case t.URBAN:r.f='<ogc:Filter xmlns:ogc="http://www.opengis.net/ogc">'+p(c(n,"t"),t._LIKE_PATTERN+e.t+t._LIKE_PATTERN)+"</ogc:Filter>";break;case t.LOCALITY:r.f=p(c(n,"t"),t._LIKE_PATTERN+e.t+t._LIKE_PATTERN);r.multiL=!0;break;case t.MUNICIPALITY:r.f='<ogc:Filter xmlns:ogc="http://www.opengis.net/ogc">'+p(c(n,"t"),t._LIKE_PATTERN+e.t+t._LIKE_PATTERN)+"</ogc:Filter>"}return r},f=function(e,n,r,i){var a=d(e,n),s={REQUEST:"GetFeature",SERVICE:"WFS",MAXFEATURES:20,VERSION:t.availableSearchTypes[n].version,OUTPUTFORMAT:t.availableSearchTypes[n].outputFormat},o=u(n,"featureType");if(o instanceof Array){for(var l=[],c=0;c<o.length;c++)l.push(t.availableSearchTypes[n].featurePrefix?t.availableSearchTypes[n].featurePrefix+":"+$.trim(o[c]):$.trim(o[c]));s.TYPENAME=l.join(",")}else s.TYPENAME=t.availableSearchTypes[n].featurePrefix?t.availableSearchTypes[n].featurePrefix+":"+$.trim(o):$.trim(o);var h=function(e){if(""!==(e||"")){if(e instanceof Array)return e.join(",");var t=[];if(e instanceof Object)for(var n in e){var r=e[n][0];e[n].length>1&&(r=e[n].join(","));t.push(r)}return t}},p=h(r),f=h(i);if(p instanceof Array&&f instanceof Array){s.PROPERTYNAME="";for(var c=0;c<p.length;c++)s.PROPERTYNAME+="("+p[c]+","+f[c]+")"}else s.PROPERTYNAME=p+","+f;s.FILTER=a.f;return $.param(s)},m=function(e,t,n,i){for(var a=0;a<e.length;a++){var s=[],o=[],l="",c=n,h=i,p=u(t,"outputFormatLabel"),d=e[a].id.split(".").slice(0,1).shift();if(!(n instanceof Array)){c=n[d];h=i[d];p=p[d]}for(var f=0;f<c.length;f++)s.push(e[a].data[c[f]]);for(var f=0;f<h.length;f++)o.push(e[a].data[h[f]]);var m=function(e){for(var t=[],n=0;n<e.length;n++)-1==jQuery.inArray(e[n],t)&&t.push(e[n]);return t};s instanceof Array&&p&&m(s).length>1?l=p.tcFormat(s):s instanceof Array&&1==m(s).length&&(l=s[0]);var y=l.toCamelCase(),g=function(e,t){for(var n=0;n<r.length;n++)if(r[n].dataRole==e&&r[n].text.toLowerCase().trim()==t.toLowerCase().trim())return!0;return!1};g(t,y)||r.push({text:y,label:y,id:o.join("#"),dataRole:t,dataLayer:d})}};e=s(e);$.when(l(e,t.availableSearchTypes[TC.Consts.searchType.MUNICIPALITY].root||"",t.availableSearchTypes[TC.Consts.searchType.MUNICIPALITY].limit||!1)).then(function(e){function s(e,n){var r=u(n,"outputProperties"),i=u(n,"dataIdProperty");return $.ajax({url:t.availableSearchTypes[n].url,type:"POST",contentType:"application/x-www-form-urlencoded;charset=UTF-8",dataType:"text",data:f(e,n,r,i),beforeSend:function(){t.$list.html('<li><a class="tc-ctl-search-li-loading" href="#">'+t.getLocaleString("searching")+'<span class="tc-ctl-search-loading-spinner tc-ctl-search-loading"></span></a></li>');t.$text.trigger("targetUpdated.autocomplete")}}).done(function(e){var t=a(e,n);m(t,n,r,i)}).fail(function(e){"abort"!==e.statusText&&alert("error")})}if(e){t._search.data=r;if(t.request){for(var o=0;o<t.request.length;o++)t.request[o].abort();t.request=[]}else t.request=[];$.map(e,function(e,n){for(var r=i(e),n=0;n<r.length;n++){var a=r[n];a&&t.allowedSearchTypes[a]&&t.request.push(s(e,a))}});$.when.apply($,t.request).then(function(){t.request=null;n.resolve(r)})}else n.resolve(r)});return n.promise()};e.search=function(e,t){var n=this,r=[];e=$.trim(e);if(e.length>0){e=e.toLowerCase();var i=[],a=function(t){var a=new $.Deferred;i.push(a);$.when(t.call(n,e)).then(function(e){r=r.concat(e);a.resolve(r)})},s=!1;for(var o in n.allowedSearchTypes)switch(o){case TC.Consts.searchType.CADASTRAL:a(n.availableSearchTypes[TC.Consts.searchType.CADASTRAL].parser);break;case TC.Consts.searchType.COORDINATES:a(n.availableSearchTypes[TC.Consts.searchType.COORDINATES].parser);break;case TC.Consts.searchType.MUNICIPALITY:case TC.Consts.searchType.LOCALITY:case TC.Consts.searchType.COUNCIL:case TC.Consts.searchType.URBAN:case TC.Consts.searchType.STREET:case TC.Consts.searchType.NUMBER:if(!s){a(n.availableSearchTypes[o].parser);s=!0}break;default:n.allowedSearchTypes[o].parser?a(n.allowedSearchTypes[o].parser):console.log("Falta implementaci\xf3n del m\xe9todo parser")}$.when.apply(n,i).then(function(){r&&(n._search.data=r=r.sort(function(e,t){var n,r=/(\d+)/,i="";if(r.test(e.label)&&r.test(t.label)){n=e.label.match(r)[1];i=t.label.match(r)[1]}else{n=e.label;i=t.label}return n>i?1:i>n?-1:0}));t&&t(r);if(0===r.length){n.cleanMap();if(!n.layer||n.layer&&0===n.layer.features.length){n.$list.html('<li><a title="'+n.EMPTY_RESULTS_TITLE+'" class="tc-ctl-search-li-empty">'+n.EMPTY_RESULTS_LABEL+"</a></li>");n.$text.trigger("targetUpdated.autocomplete")}}})}else n.cleanMap()};var t=function(e){var t=this;if(e&&e.length>0)for(var n=0;n<e.length;n++)e[n].showsPopup!=t.queryableFeatures&&(e[n].showsPopup=t.queryableFeatures)};e.goToResult=function(e,n){var i=this,a=null;i.loading||(i.loading=i.map.getControlsByClass("TC.control.LoadingIndicator")[0]);var s;s=i.loading.addWait();if(Modernizr.mq("(max-width: 30em)")){i.$text.blur();i.map.$events.trigger($.Event(TC.Consts.event.TOOLSCLOSE),{})}i.cleanMap();var o=!1,l=!0;for(var c in i.allowedSearchTypes)if(l)switch(c){case TC.Consts.searchType.CADASTRAL:a=i.availableSearchTypes[TC.Consts.searchType.CADASTRAL].goTo.call(i,e);null!==a&&(l=!1);break;case TC.Consts.searchType.COORDINATES:a=i.availableSearchTypes[TC.Consts.searchType.COORDINATES].goTo.call(i,e);null!==a&&(l=!1);break;case TC.Consts.searchType.MUNICIPALITY:case TC.Consts.searchType.LOCALITY:case TC.Consts.searchType.COUNCIL:case TC.Consts.searchType.URBAN:case TC.Consts.searchType.STREET:case TC.Consts.searchType.NUMBER:var u=n||r.call(i,e).dataRole;if(u){a=i.availableSearchTypes[u].goTo.call(i,e,u);null!==a&&(l=!1)}break;default:if(i.allowedSearchTypes[c].goTo){o=!0;a=i.allowedSearchTypes[c].goTo.call(i,e);null!==a&&(l=!1)}else console.log("Falta implementaci\xf3n del m\xe9todo goTo")}i.loading.removeWait(s);if(a){s=i.loading.addWait();i.getLayer().then(function(n){switch(!0){case a.params.type==TC.Consts.layerType.VECTOR:for(var r=0;r<i.WFS_TYPE_ATTRS.length;r++)n.hasOwnProperty(i.WFS_TYPE_ATTRS[r])&&delete n[i.WFS_TYPE_ATTRS[r]];break;case a.params.type==TC.Consts.layerType.WFS:for(var r=0;r<i.WFS_TYPE_ATTRS.length;r++)n[i.WFS_TYPE_ATTRS[r]]=a.params[i.WFS_TYPE_ATTRS[r]]}n.type=a.params.type;n.refresh().then(function(){i.map.one(TC.Consts.event.LAYERUPDATE,function(e){if(e.layer==n){i.map.one(TC.Consts.event.FEATURESADD,function(e){if(e.layer==n){if(!e.layer.features||0==e.layer.features.length&&e.layer.wrap.layer.getSource().getFeatures()){i.$list.hide("fast");e.layer.map.setExtent(e.layer.wrap.layer.getSource().getExtent())}else if(e.layer.features&&e.layer.features.length>0){i.$list.hide("fast");t.call(i,e.layer.features);i.layer.map.zoomToFeatures(e.layer.features)}else if(e.layer.features&&0==e.layer.features.length&&a.params.type==TC.Consts.layerType.WFS){i.$list.html(a.emptyResultHTML);i.$text.trigger("targetUpdated.autocomplete");i.map.$events.trigger($.Event(TC.Consts.event.SEARCHQUERYEMPTY))}i.loading.removeWait(s)}});a.params.type!=TC.Consts.layerType.WFS&&i.map.one(TC.Consts.event.FEATURESADD,function(e){if(e.layer.features&&0==e.layer.features.length){i.$list.html(a.emptyResultHTML);i.$text.trigger("targetUpdated.autocomplete");i.map.$events.trigger($.Event(TC.Consts.event.SEARCHQUERYEMPTY))}});if(e.layer.features&&e.layer.features.length>0){i.$list.hide("fast");t.call(i,e.layer.features);i.layer.map.zoomToFeatures(i.layer.features);i.loading.removeWait(s)}else if(e.layer.features&&0==e.layer.features.length&&a.params.type==TC.Consts.layerType.WFS){i.$list.html(a.emptyResultHTML);i.$text.trigger("targetUpdated.autocomplete");i.map.$events.trigger($.Event(TC.Consts.event.SEARCHQUERYEMPTY));i.loading.removeWait(s)}}});0==n.features.length&&i.map.$events.trigger($.Event(TC.Consts.event.LAYERUPDATE,{layer:n,id:e}))})})}else o||i.map.$events.trigger($.Event(TC.Consts.event.SEARCHQUERYEMPTY))};var n=function(e){var t=this;if(e&&e.layer==t.layer){var n,r,i,a=e.id,s=t.getPoint(a);if(s&&t.insideLimit(s)){r=t.getLabel(a);i=t.layer.addMarker(s,$.extend({},t.map.options.styles.point,{title:r,group:r}));n=t.map.options.pointBoundsRadius;t.map.setExtent([s[0]-n,s[1]-n,s[0]+n,s[1]+n])}else{var o=/^Lat((?:[+-]?)\d+(?:\.\d+)?)Lon((?:[+-]?)\d+(?:\.\d+)?)$/.exec(a);a=t.LAT+o[2]+t.LON+o[1];s=t.getPoint(a);if(s&&t.insideLimit(s)){r=t.getLabel(a);i=t.layer.addMarker(s,$.extend({},t.map.options.styles.point,{title:r,group:r}));n=t.map.options.pointBoundsRadius;t.map.setExtent([s[0]-n,s[1]-n,s[0]+n,s[1]+n]);t.$text.val(r)}}$.when(i).then(function(e){t.map.$events.trigger($.Event(TC.Consts.event.FEATURESADD,{layer:t.layer,features:[e]}))})}};e.goToCoordinates=function(e){var t=this,r={};if(/^X(\d+(?:[\.\,]\d+)?)Y(\d+(?:[\.\,]\d+)?)$/.test(e)||/^Lat((?:[+-]?)\d+(?:[.,]\d+)?)Lon((?:[+-]?)\d+(?:[.,]\d+)?)$/.test(e)){r.params={type:TC.Consts.layerType.VECTOR,styles:{point:{}}};r.emptyResultHTML='<li><a class="tc-ctl-search-li-empty">'+t.OUTBBX_LABEL+"</a></li>";var i=n.bind(t);t.map.one(TC.Consts.event.LAYERUPDATE,i);return r}return null};e.goToCadastralRef=function(e){var t=this,n={};if(/^\M(\d+)\P(\d{1,2})Par{1}(\d{1,4})/g.test(e)){var r=/^\M(\d+)\P(\d{1,2})Par{1}(\d{1,4})/g.exec(e);n.params={type:TC.Consts.layerType.WFS,url:t.availableSearchTypes[TC.Consts.searchType.CADASTRAL].url,version:t.availableSearchTypes[TC.Consts.searchType.CADASTRAL].version,geometryName:t.availableSearchTypes[TC.Consts.searchType.CADASTRAL].geometryName,featurePrefix:t.availableSearchTypes[TC.Consts.searchType.CADASTRAL].featurePrefix,featureType:t.availableSearchTypes[TC.Consts.searchType.CADASTRAL].featureType,properties:[{name:t.availableSearchTypes[TC.Consts.searchType.CADASTRAL].queryProperties.municipality,value:$.trim(r[1]),type:TC.Consts.comparison.EQUAL_TO},{name:t.availableSearchTypes[TC.Consts.searchType.CADASTRAL].queryProperties.polygon,value:$.trim(r[2]),type:TC.Consts.comparison.EQUAL_TO},{name:t.availableSearchTypes[TC.Consts.searchType.CADASTRAL].queryProperties.parcel,value:$.trim(r[3]),type:TC.Consts.comparison.EQUAL_TO}],outputFormat:t.availableSearchTypes[TC.Consts.searchType.CADASTRAL].outputFormat,styles:t.availableSearchTypes[TC.Consts.searchType.CADASTRAL].styles};n.emptyResultHTML='<li><a title="'+t.EMPTY_RESULTS_TITLE+'" class="tc-ctl-search-li-empty">'+t.EMPTY_RESULTS_LABEL+"</a></li>";return n}return null};var r=function(e,t){for(var n=this,r=0;r<n._search.data.length;r++)if(n._search.data[r].id==e&&(!t||t&&n._search.data[r].dataRole===t))return n._search.data[r]};e.goToAddress=function(e,t){var n,i=this,a={},s=function(t,n){var r=[],i=e.split("#");if(e.indexOf("#")>-1&&n instanceof Array){r={};for(var a=0;a<n.length;a++){r[n[a]]=[];for(var s=0;s<t[n[a]].length;s++)r[n[a]].push({name:t[n[a]][s],value:i[s],type:TC.Consts.comparison.EQUAL_TO})}}else if(-1==e.indexOf("#")&&n instanceof Array){var o=t;r={};for(var a=0;a<n.length;a++)if(!r.hasOwnProperty(n[a])){r[n[a]]=[];o instanceof Object&&t.hasOwnProperty(n[a])&&(o=t[n[a]]);for(var s=0;s<o.length;s++)s<i.length&&r[n[a]].push({name:o[s],value:i[s],type:TC.Consts.comparison.EQUAL_TO})}}else{t instanceof Object&&t.hasOwnProperty(n)&&(t=t[n]);for(var a=0;a<t.length;a++)r.push({name:t[a],value:i[a],type:TC.Consts.comparison.EQUAL_TO})}return r};n=r.call(i,e,t);if(n&&n.dataRole){var o=i.availableSearchTypes[n.dataRole],l=n.dataLayer;if(o.renderFeatureType){n.dataLayer instanceof Array||(l=[n.dataLayer]);l=l.concat(o.renderFeatureType instanceof Array?o.renderFeatureType:[o.renderFeatureType])}a.params={type:TC.Consts.layerType.WFS,url:o.url,version:o.version,geometryName:o.geometryName,featurePrefix:o.featurePrefix,featureType:l,properties:s(o.dataIdProperty,l),outputFormat:o.outputFormat,styles:o.styles};return a}return null};e.getPoint=function(e){var t,n=this,r=n.map.wrap.isGeo(),i=/^X(\d+(?:\.\d+)?)Y(\d+(?:\.\d+)?)$/.exec(e);if(i&&3===i.length){t=[parseFloat(i[1]),parseFloat(i[2])];r&&(t=TC.Util.reproject(t,n.map.options.utmCrs,n.map.crs))}else{i=/^Lat((?:[+-]?)\d+(?:[.,]\d+)?)Lon((?:[+-]?)\d+(?:[.,]\d+)?)$/.exec(e);if(i&&3===i.length){t=[parseFloat(i[2]),parseFloat(i[1])];if(!r)return TC.Util.reproject(t,n.map.options.geoCrs,n.map.crs)}i=/^Lon((?:[+-]?)\d+(?:[.,]\d+)?)Lat((?:[+-]?)\d+(?:[.,]\d+)?)$/.exec(e);if(i&&3===i.length){t=[parseFloat(i[2]),parseFloat(i[1])];if(!r)return TC.Util.reproject(t,n.map.options.geoCrs,n.map.crs)}}return t};e.insideLimit=function(e){var t=this,n=function(e,t){return e instanceof Array?t[0]>=e[0]&&t[0]<=e[2]&&t[1]>=e[1]&&t[1]<=e[3]:!0};return n(t.map.options.maxExtent,e)?!0:!1};e.getPattern=function(){var e=this;return e.$text.val()};e.getLabel=function(e){var t=this,n=e,r=TC.Util.getMapLocale(t.map);if(e.match(new RegExp("^(?:"+t.LAT+"[-\\d])|(?:"+t.UTMX+"[\\d])"))){n=n.replace(t.LAT,t.LAT_LABEL).replace(t.LON," "+t.LON_LABEL).replace(t.UTMX,t.UTMX_LABEL).replace(t.UTMY," "+t.UTMY_LABEL);var i=n.match(new RegExp("^"+$.trim(t.LAT_LABEL)+"*\\s*([-+]?\\d{1,3}([.,]\\d+)?)\\,?\\s*"+$.trim(t.LON_LABEL)+"*\\s*([-+]?\\d{1,2}([.,]\\d+)?)$"));if(i){n=n.replace(i[1],parseFloat(i[1]).toLocaleString(r));n=n.replace(i[3],parseFloat(i[3]).toLocaleString(r))}var a=1.1.toLocaleString(r).substring(1,2),i=n.match(new RegExp("^"+$.trim(t.UTMX_LABEL)+"*\\s*([0-9]{"+t.UTMX_LEN+"}(?:[.,]\\d+)?)\\s*\\,?\\s*"+$.trim(t.UTMY_LABEL)+"*\\s*([0-9]{"+t.UTMY_LEN+"}(?:[.,]\\d+)?)$"));if(i){Number.isInteger(parseFloat(i[1]))||(n=n.replace(i[1],i[1].replace(".",a)));Number.isInteger(parseFloat(i[2]))||(n=n.replace(i[2],i[2].replace(".",a)))}}else if(e.match(new RegExp("^(?:"+t.LON+"[-\\d])"))){n=n.replace(t.LON,t.LON_LABEL).replace(t.LAT," "+t.LAT_LABEL);var i=n.match(new RegExp("^"+$.trim(t.LON_LABEL)+"*\\s*([-+]?\\d{1,3}([.,]\\d+)?)\\,?\\s*"+$.trim(t.LAT_LABEL)+"*\\s*([-+]?\\d{1,2}([.,]\\d+)?)$"));if(i){n=n.replace(i[1],parseFloat(i[1]).toLocaleString(r));n=n.replace(i[3],parseFloat(i[3]).toLocaleString(r))}}else if(e.match(new RegExp("^(?:(\\"+t.MUN+"{1})(.*)(\\"+t.POL+"{1})(\\d{1,2})(\\"+t.PAR+"{1})(\\d{1,4}))"))){var i=e.match(new RegExp("^(?:(\\"+t.MUN+"{1})(.*)(\\"+t.POL+"{1})(\\d{1,2})(\\"+t.PAR+"{1})(\\d{1,4}))"));n=t.MUN_LABEL+i[2]+", "+t.POL_LABEL+i[4]+", "+t.PAR_LABEL+i[6]}return n};e.removePunctuation=function(e){e=e||"";for(var t=new Array(e.length),n={"\xe1":"a","\xc1":"A","\xe9":"e","\xc9":"E","\xed":"i","\xcd":"I","\xf3":"o","\xd3":"O","\xfa":"u","\xfc":"u","\xda":"U","\xdc":"U"},r=0,i=e.length;i>r;r++)t[r]=n[e.charAt(r)]||e.charAt(r);return t.join("")};e.decodeEntities=function(e){return $("<div/>").html(e).text()}}();String.prototype.tcFormat||(String.prototype.tcFormat=function(){var e=(arguments||[""])[0];return this.replace(/{(\d+)}/g,function(t,n){return"undefined"!=typeof e[n]?e[n]:t})});String.prototype.splitRemoveWhiteSpaces||(String.prototype.splitRemoveWhiteSpaces=function(e){for(var t=[],n=this.split(e),r=0;r<n.length;r++)$.trim(n[r]).length>0&&t.push($.trim(n[r]));return t});String.prototype.toCamelCase||(String.prototype.toCamelCase=function(){var e=this.toLowerCase(),t=this.toLowerCase().match(/\W+(.)/g);if(t)for(var n=0;n<t.length;n++)/[;:.<>\{\}\[\]\/\s()]/g.test(t[n])&&(e=e.replace(t[n],t[n].toUpperCase()));return e.charAt(0).toUpperCase()+e.substring(1)});Array.prototype.hasOwnProperty("findByProperty")||Object.defineProperty(Array.prototype,"findByProperty",{enumerable:!1,writable:!0,value:function(e,t){for(var n=0;n<this.length;n++)if(this[n][e]==t)return this[n]}});TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control.js");TC.control.SelectContainer=function(){var e=this;TC.Control.apply(e,arguments);var t=e._classSelector="."+e.CLASS;e._selectors={TAB:t+"-tab",RADIOBUTTON:"input[type=radio][name=sctnr-sel]",ELEMENT:t+"-elm"};e.controlOptions=e.options.controls||[];var n=e.controlOptions.length;e._ctlDeferreds=new Array(n);for(var r=0;n>r;r++)e._ctlDeferreds[r]=$.Deferred()};TC.inherit(TC.control.SelectContainer,TC.Control);!function(){var e=TC.control.SelectContainer.prototype;e.CLASS="tc-ctl-sctnr";e.template=TC.isDebug?TC.apiLocation+"TC/templates/SelectContainer.html":function(){function t(e,t){return e.w("<h2>").f(t.get(["title"],!1),t,"h").w('</h2><div class="tc-ctl-sctnr-select"><form>').s(t.get(["controls"],!1),t,{block:n},{}).w("</form></div>").s(t.get(["controls"],!1),t,{block:r},{})}function n(e,t){return e.w('<label class="tc-ctl-sctnr-tab tc-ctl-sctnr-tab-').f(t.get(["$idx"],!1),t,"h").w('" style="width:calc(100%/').f(t.get(["$len"],!1),t,"h").w(' - 1px)"><input type="radio" name="sctnr-sel" value="').f(t.get(["$idx"],!1),t,"h").w('" /><span>').f(t.get(["title"],!1),t,"h").w("</span></label>")}function r(e,t){return e.w('<div class="tc-ctl-sctnr-elm tc-ctl-sctnr-elm-').f(t.get(["$idx"],!1),t,"h").w(' tc-hidden"></div>')}dust.register(e.CLASS,t);t.__dustBody=!0;n.__dustBody=!0;r.__dustBody=!0;return t};e.register=function(e){var t=this;TC.Control.prototype.register.call(t,e);t.renderPromise().then(function(){t.title=t.getLocaleString(t.options.title||"moreControls");t._$div.find("h2").first().html(t.title);for(var n=new Array(t.controlOptions.length),r=0,i=t.controlOptions.length;i>r;r++){var a=t.controlOptions[r];n[r]=e.addControl(a.name,$.extend({div:t._$div.find("."+t.CLASS+"-elm-"+r)},a.options))}var s=function(e,n){e.renderPromise().then(function(){var r=t.getLocaleString(t.controlOptions[n].title)||e._$div.find("h2").first().html();e._$div.parents(t._classSelector).first().find(t._selectors.TAB+"-"+n+" span").html(r)})};$.when.apply(t,n).then(function(){for(var e=0,n=arguments.length;n>e;e++){var r=arguments[e];s(r,e);t._ctlDeferreds[e].resolve(r)}})})};e.render=function(e){var t=this;t.renderData({title:t.title,controls:t.controlOptions},function(){var e=function(e){var n=$(this).closest(t._selectors.TAB).find(t._selectors.RADIOBUTTON),r=n.val(),i=t._$div.find(t._selectors.ELEMENT);if(t._oldValue===r&&t.options.deselectable){setTimeout(function(){n.prop("checked",!1)},0);t._oldValue=null;$active=$();$hidden=i}else{$active=i.filter(t._selectors.ELEMENT+"-"+r);$hidden=i.not($active);t._oldValue=r}$active.removeClass(TC.Consts.classes.HIDDEN);$hidden.addClass(TC.Consts.classes.HIDDEN);n.prop("checked",!0)};t._$div.find("span").on(TC.Consts.event.CLICK,e);for(var n=0,r=t._ctlDeferreds.length;r>n;n++)t.getControl(n).then(function(e){e.render()});"number"==typeof t.options.defaultSelection&&e.call(t._$div.find(t._selectors.RADIOBUTTON).get(t.options.defaultSelection))})};e.getControl=function(e){var t=this._ctlDeferreds[e];if(!t){t=$.Deferred();t.reject()}return t.promise()}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control.js");TC.control.Share=function(e){var t=this;t._classSelector="."+t.CLASS;TC.Control.apply(t,arguments);var n=e||{};t._$dialogDiv=$(TC.Util.getDiv(n.dialogDiv));n.dialogDiv||t._$dialogDiv.appendTo("body");t.render()};TC.inherit(TC.control.Share,TC.Control);!function(){var e=TC.control.Share.prototype;e.CLASS="tc-ctl-share";e.QR_MAX_LENGTH=150;e.IFRAME_WIDTH="600px";e.IFRAME_HEIGHT="450px";e.MOBILEFAV="Siga las instrucciones del navegador del dispositivo m\xf3vil para a\xf1adir como favorito. Se guardar\xe1 el estado actual del mapa.";e.NAVALERT=" +D para guardar en marcadores.";e.render=function(e){var t=this;t.getRenderedHtml(t.CLASS+"-dialog",null,function(e){t._$dialogDiv.html(e)}).then(function(){TC.Control.prototype.render.call(t,function(){if(TC.Util.detectChrome()||TC.Util.detectIE()>=10||TC.Util.detectFirefox()>=41){t._$div.find("button").removeClass("hide");var n=t._$div.find("input[type=text]");n.removeAttr("data-original-title")}TC.Util.detectMobile()||t._$div.find(".share-whatsapp").addClass(TC.Consts.classes.HIDDEN);var r=t._$div.find("."+t.CLASS+"-url-box");t._$div.find("span").on(TC.Consts.event.CLICK,function(e){var t=$(this).closest("label").find("input[type=radio][name=format]"),n=t.val();r.removeClass(TC.Consts.classes.HIDDEN);r.not(".tc-"+n).addClass(TC.Consts.classes.HIDDEN)});$.isFunction(e)&&e()})})};e.getLocation=function(){var e=window.location.href;window.location.hash&&(e=e.substr(0,e.indexOf(window.location.hash)));return e};e.generateLink=function(){var e=this,t=window.location.href,n=t.indexOf("#");n>0&&(t=t.substring(0,n));if(e.extraParams){var r=TC.Util.getQueryStringParams(t);$.extend(r,e.extraParams);var i=t.indexOf("?");i>=0&&(t=t.substring(0,i));t=t.concat("?",$.param(r))}TC.Util.getParameterByName("lang").length>0&&(t=t.indexOf("&")>-1?t.replace("lang="+TC.Util.getParameterByName("lang")+"&",""):t.replace("?lang="+TC.Util.getParameterByName("lang"),""));var a=e.map.getMapState(),s=t.concat("#",a);if(!(s.length>TC.Consts.URL_MAX_LENGTH)){e.enableButtons(s);return s}e.disableButtons()};e.generateIframe=function(e){var t=this,n=e||this.generateLink();return n?'<iframe style="width:'+t.IFRAME_WIDTH+";height:"+t.IFRAME_HEIGHT+';" src="'+n+'"></iframe>':void 0};

e.register=function(t){var n=this;TC.Control.prototype.register.call(n,t);n.MOBILEFAV=n.getLocaleString("mobileBookmarks.instructions");n.NAVALERT=n.getLocaleString("bookmarks.instructions");var r=function(e){var t=$(e).parent().find("input[type=text]");t.val(t.hasClass("tc-url")?n.generateLink():n.generateIframe());t.select()},i=function(){document.getSelection().removeAllRanges();document.getSelection().addRange(document.createRange())};n._$div.on("click","h2",function(e){n._$div.find(".tc-url input[type=text]").val(n.generateLink());n._$div.find(".tc-iframe input[type=text]").val(n.generateIframe())});n._$div.on("click",".tc-ctl-share-url-box button",function(e){r(e.target);document.execCommand("copy");var t=$(this);t.text(n.getLocaleString("copied"));t.addClass("btn-default");t.removeClass("btn-red");setTimeout(function(){t.text(n.getLocaleString("copy"));t.removeClass("btn-default");t.addClass("btn-red");i()},1e3)});n._$div.on("click","input[type=text]",function(e){r(e.target)});n._$div.on("click",".ga-share-icon.disabled",function(e){e.stopImmediatePropagation();e.preventDefault();return!1});n._$div.on("click","a.share-email",function(e){e.preventDefault();var t=n.generateLink();t&&(window.location.href="mailto:?body="+encodeURIComponent(t))});n._$div.on("click","a.qr-generator",function(e){e.preventDefault();var t=n.generateLink();t&&TC.loadJS("undefined"==typeof QRCode,[TC.apiLocation+"lib/qrcode/qrcode.min.js"],function(){t.length>n.QR_MAX_LENGTH&&(t=TC.Util.shortenUrl(t));TC.Util.showModal(n._$dialogDiv.find(n._classSelector+"-qr-dialog"));var e=n._$dialogDiv.find(".qrcode");e.empty();new QRCode(e[0],t)})});n._$div.on("click","a.share-fb",function(e){e.preventDefault();var t=n.generateLink();if(t){window.open("https://www.facebook.com/sharer/sharer.php?u="+encodeURIComponent(t));return!1}});n._$div.on("click","a.share-twitter",function(e){e.preventDefault();var t=n.generateLink();if(t){var r=TC.Util.shortenUrl(t);if(void 0!==r){window.open("https://twitter.com/intent/tweet?text=Visor%20IDENA&amp;url="+encodeURIComponent(r));return!1}TC.error("La URL "+t+" no ha podido ser acortada por ser no v\xe1lida")}});TC.Util.detectMobile()&&n._$div.on("click","a.share-whatsapp",function(e){e.preventDefault();var t=n.generateLink();if(t){var r=TC.Util.shortenUrl(t),i="whatsapp://send?text=";location.href=void 0!==r?i+encodeURIComponent(r):i+encodeURIComponent(t);return!1}});n._$div.on("click","a.share-star",function(t){t.preventDefault();var r=n.generateLink(),i=document.title;if(TC.Util.detectMobile())alert(e.MOBILEFAV);else if(window.sidebar&&window.sidebar.addPanel)window.sidebar.addPanel(i,r,"");else if(window.sidebar&&/Firefox/i.test(navigator.userAgent)||window.opera&&window.print){window.location.href=r;alert((/Mac/i.test(navigator.userAgent)?"Cmd":"Ctrl")+e.NAVALERT)}else if(window.external&&"AddFavorite"in window.external)window.external.AddFavorite(r,i);else{window.location.href=r;alert((/Mac/i.test(navigator.userAgent)?"Cmd":"Ctrl")+e.NAVALERT)}return!1})};e.enableButtons=function(e){var t=this;TC.Control.prototype.enable.call(t);var n=t._$div.find("."+t.CLASS+"-alert"),r=t._$div.find(".tc-button"),i=t._$div.find(".ga-share-icon"),a=t._$div.find(".tc-textbox");n.toggleClass(TC.Consts.classes.HIDDEN,!0);r.toggleClass("disabled",!1);r.removeAttr("disabled");$.each(i,function(e,t){$(t).toggleClass("disabled",!1)});a.filter(".tc-url").val(e);a.filter(".tc-iframe").val(t.generateIframe(e))};e.disableButtons=function(){var e=this;TC.Control.prototype.disable.call(e);var t=e._$div.find("."+e.CLASS+"-alert"),n=e._$div.find(".tc-button"),r=e._$div.find(".ga-share-icon"),i=e._$div.find(".tc-textbox");t.toggleClass(TC.Consts.classes.HIDDEN,!1);n.toggleClass("disabled",!0);n.attr("disabled","disabled");$.each(r,function(e,t){$(t).toggleClass("disabled",!0)});i.val()};e.template={};if(TC.isDebug){e.template[e.CLASS]=TC.apiLocation+"TC/templates/Share.html";e.template[e.CLASS+"-dialog"]=TC.apiLocation+"TC/templates/ShareDialog.html"}else{e.template[e.CLASS]=function(){function t(e,t){return e.w("<h2>").h("i18n",t,{},{$key:"share"}).w('</h2><div><div class="ga-share-icons"><a class="ga-share-icon share-email" target="_blank" data-toggle="tooltip" data-placement="top" title="').h("i18n",t,{},{$key:"sendMapByEmail"}).w('"href="#"><i class="icon-envelope-alt"></i></a><a class="ga-share-icon qr-generator" target="_blank" data-toggle="tooltip" data-placement="top" title="').h("i18n",t,{},{$key:"createQrCode"}).w('"href="#"><i class="icon-qrcode"></i></a><a class="ga-share-icon share-fb" target="_blank" data-toggle="tooltip" data-placement="top" title="').h("i18n",t,{},{$key:"shareMapToFacebook"}).w('"href="#"><i class="icon-facebook"></i></a><a class="ga-share-icon share-twitter" target="_blank" data-toggle="tooltip" data-placement="top" title="').h("i18n",t,{},{$key:"shareMapToTwitter"}).w('"href="#"><i class="icon-twitter"></i></a><a class="ga-share-icon share-whatsapp" target="_blank" data-toggle="tooltip" data-placement="top" title="').h("i18n",t,{},{$key:"shareMapToWhatsapp"}).w('"href="#"><i class="icon-whatsapp"></i></a><a class="ga-share-icon share-star" target="_blank" data-toggle="tooltip" data-placement="top" title="').h("i18n",t,{},{$key:"addToBookmarks"}).w('"href="#"><i class="icon-star"></i></a></div><div class="tc-ctl-share-select"><form><label class="tc-ctl-share-btn-url"><input type="radio" checked="checked" name="format" value="url" /><span>').h("i18n",t,{},{$key:"shareLink"}).w('</span></label><label class="tc-ctl-share-btn-iframe"><input type="radio" name="format" value="iframe" /><span>').h("i18n",t,{},{$key:"embedMap"}).w('</span></label></form></div><div class="tc-ctl-share-url-box tc-group tc-url"><input type="text" class="tc-textbox tc-url" readonly data-toggle="tooltip" data-placement="top" title="').h("i18n",t,{},{$key:"shareLink.tip.1"}).w('" /><button class="tc-button hide" title="').h("i18n",t,{},{$key:"shareLink.tip.2"}).w('">').h("i18n",t,{},{$key:"copy"}).w('</button></div><div class="tc-ctl-share-url-box tc-group tc-iframe tc-hidden"><input type="text" class="tc-textbox tc-iframe" readonly data-toggle="tooltip" data-placement="top" title="').h("i18n",t,{},{$key:"embedMap.tip.1"}).w('" /><button class="tc-button hide" title="').h("i18n",t,{},{$key:"embedMap.tip.2"}).w('">').h("i18n",t,{},{$key:"copy"}).w('</button></div><div class="tc-ctl-share-alert tc-alert alert-warning tc-hidden"><p>').h("i18n",t,{},{$key:"tooManyLayersLoaded|s"}).w("</p> </div></div>")}dust.register(e.CLASS,t);t.__dustBody=!0;return t};e.template[e.CLASS+"-dialog"]=function(){function t(e,t){return e.w('<div class="tc-ctl-share-qr-dialog tc-modal"><div class="tc-modal-background tc-modal-close"></div><div class="tc-modal-window"><div class="tc-modal-header"><h3>').h("i18n",t,{},{$key:"qrCode"}).w('</h3><div class="tc-ctl-popup-close tc-modal-close"></div></div><div class="tc-modal-body"><div class="qrcode"></div></div><div class="tc-modal-footer"><button type="button" class="tc-button tc-modal-close">').h("i18n",t,{},{$key:"close"}).w("</button></div></div></div>")}dust.register(e.CLASS+"-dialog",t);t.__dustBody=!0;return t}}}();TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control.js");!function(){TC.Consts.url.GOOGLEMAPS="//maps.googleapis.com/maps/api/js?v=3";var e=TC.Consts.url.GOOGLEMAPS;TC.Cfg.proxyExceptions=TC.Cfg.proxyExceptions||[];TC.Cfg.proxyExceptions.push(TC.Consts.url.GOOGLEMAPS);TC.control.StreetView=function(){var t=this;this._templatePromise=$.Deferred();t._sv=null;t._mapActiveControl=null;TC.Control.apply(t,arguments);t.options.googleMapsKey&&(e+="&key="+t.options.googleMapsKey);t.viewDiv=null;t._$viewDiv=null;t._startLonLat=null};TC.inherit(TC.control.StreetView,TC.Control);var t=TC.control.StreetView.prototype;t.CLASS="tc-ctl-sv";t.template={};if(TC.isDebug){t.template[t.CLASS]=TC.apiLocation+"TC/templates/StreetView.html";t.template[t.CLASS+"-view"]=TC.apiLocation+"TC/templates/StreetViewView.html"}else{t.template[t.CLASS]=function(){function e(e,t){return e.w('<div class="tc-ctl-sv-btn" title="').h("i18n",t,{},{$key:"sv.tip"}).w('"><div class="tc-ctl-sv-drag"></div></div>')}dust.register(t.CLASS,e);e.__dustBody=!0;return e};t.template[t.CLASS+"-view"]=function(){function e(e,t){return e.w('<div class="tc-ctl-sv-btn-close" title="').h("i18n",t,{},{$key:"closeStreetView"}).w('"></div>')}dust.register(t.CLASS+"-view",e);e.__dustBody=!0;return e}}var n=function(e){e._$div.find("."+e.CLASS+"-btn").addClass(TC.Consts.classes.CHECKED);$(e.map.div).addClass(e.CLASS+"-active")},r=function(e){e.layer.clearFeatures();e._$div.find("."+e.CLASS+"-btn").removeClass(TC.Consts.classes.CHECKED);e._$div.find("."+e.CLASS+"-drag").removeClass(TC.Consts.classes.HIDDEN);$(e.map.div).removeClass(e.CLASS+"-active");e._startLonLat=null},i=function(e){var t=!1,n=e._$div.find("."+e.CLASS+"-btn"),i=e._$div.find("."+e.CLASS+"-drag"),a=n[0].getBoundingClientRect(),s=i[0].getBoundingClientRect();i.addClass(TC.Consts.classes.HIDDEN);if(s.top<a.top||s.top>a.bottom||s.left<a.left||s.left>a.right){t=!0;for(var o=e.map.getExtent(),l=[o[2],o[3]],c=(new Array(16),0);16>c;c++)e.layer.addMarker(l,{cssClass:"tc-marker-sv-"+c,width:48,height:48,anchor:[0,1]});var u=e.map.div.getBoundingClientRect(),h=(s.left+s.right)/2-u.left,p=s.bottom-u.top,d=e.map.wrap.getCoordinateFromPixel([h,p]);e.callback(d)}else r(e);return t};t.register=function(e){var t=this;if(!t._$viewDiv){t.viewDiv=TC.Util.getDiv(t.options.viewDiv);t._$viewDiv=$(t.viewDiv).addClass(t.CLASS+"-view "+TC.Consts.classes.HIDDEN);t.options.viewDiv||t._$viewDiv.insertBefore(e.div)}TC.Control.prototype.register.call(t,e);t.layer=null;for(var a=t.CLASS+"-layer",s=0;s<e.workLayers.length;s++){var o=e.workLayers[s];if(o.type===TC.Consts.layerType.VECTOR&&o.id===a){t.layer=o;break}}t.layer||e.loaded(function(){$.when(e.addLayer({id:a,stealth:!0,type:TC.Consts.layerType.VECTOR})).then(function(e){t.layer=e})});t._templatePromise.then(function(){TC.loadJS(!$.fn.drag,[TC.apiLocation+"lib/jquery/jquery.event.drag.js",TC.apiLocation+"lib/jquery/jquery.event.drop.js"],function(){var e=t._$div.find("."+t.CLASS+"-drag");e.drag(function(t,n){e.css({transform:"translate("+n.deltaX+"px, "+n.deltaY+"px)"})}).drag("start",function(e,r){n(t);e.preventDefault();e.stopPropagation()}).drag("end",function(n,r){i(t);e.css({transform:"none"})})});var e=t._$viewDiv;e.find("."+t.CLASS+"-btn-close").on("mouseup",function(n){$(t.map.div).removeClass(TC.Consts.classes.COLLAPSED).trigger("resize");e.addClass(TC.Consts.classes.HIDDEN).removeClass(TC.Consts.classes.VISIBLE);t._$div.find("."+t.CLASS+"-drag").removeClass(TC.Consts.classes.HIDDEN);t.layer.wrap.setDraggable(!1);r(t);t._sv.setVisible(!1);n.stopPropagation();t._previousActiveControl&&t._previousActiveControl.activate()})},function(e,t,n){TC.error("Error de renderizado Streetview")})};t.render=function(){var e=this;TC.Control.prototype.render.call(e,function(){dust.cache[e.CLASS+"-view"]?dust.render(e.CLASS+"-view",null,function(t,n){setTimeout(function(){e._$viewDiv.html(n);t&&TC.error(t);e._templatePromise.resolve()},300)}):TC.error("No hay dust.cache para StreetView")})};var a=0;t.callback=function(t){var n=this,i="EPSG:4326",s=function(e){if(n._sv){var t=e.getBounds();lonLat=TC.Util.reproject([(t[0]+t[2])/2,(t[1]+t[3])/2],n.map.crs,i);n._sv.setPosition({lng:lonLat[0],lat:lonLat[1]})}},o=function(e){if(n._sv){var t=e.getBounds();n._startLonLat=[(t[0]+t[2])/2,(t[1]+t[3])/2]}},l=n.map.getLoadingIndicator();l&&(a=l.addWait(a));var c=$(n.map.div),u=function(e,r){n.layer.clearFeatures();var a,l;if(e){var u=e.getPosition();a=TC.Util.reproject([u.lng(),u.lat()],i,n.map.crs);l=e.getPov().heading}else{a=t;l=0}n.map.addMarker(a,{cssClass:"tc-marker-sv-"+(Math.round(16*l/360)+16)%16,width:48,height:48,anchor:[.4791666666666667,.7083333333333333],layer:n.layer,showsPopup:!1});$.when.apply(this,n.map._markerDeferreds).then(function(e){n.layer.wrap.setDraggable(!0,s,o)});if(r){var h=function(){n.map.setCenter(a)};c.hasClass(TC.Consts.classes.COLLAPSED)?h():setTimeout(h,1200)}};TC.loadJS(!window.google||!google.maps,e,function(){if(window.google){u();var e=n._$viewDiv,s=TC.Util.reproject(t,n.map.crs,i),o=e.hasClass(TC.Consts.classes.VISIBLE),h="transitionend.tc";e.off(h).on(h,function(e){if(("width"===e.originalEvent.propertyName||"height"===e.originalEvent.propertyName)&&!o){o=!0;google.maps.event.trigger(n._sv,"resize");c.addClass(TC.Consts.classes.COLLAPSED).trigger("resize")}});var p={position:new google.maps.LatLng(s[1],s[0]),pov:{heading:0,pitch:0},zoom:1,zoomControlOptions:{position:google.maps.ControlPosition.LEFT_TOP},panControlOptions:{position:google.maps.ControlPosition.LEFT_TOP}};if(n._sv)n._sv.setOptions(p);else{n._sv=new google.maps.StreetViewPanorama(e[0],p);google.maps.event.addListener(n._sv,"position_changed",function(){u(n._sv,e.hasClass(TC.Consts.classes.VISIBLE))});google.maps.event.addListener(n._sv,"pov_changed",function(){if(n.layer.features&&n.layer.features.length>0){var e=n.layer.features[0];delete e.options.url;e.options.cssClass="tc-marker-sv-"+(Math.round(16*n._sv.getPov().heading/360)+16)%16;e.setStyle(e.options);n.layer.refresh()}});google.maps.event.addListener(n._sv,"status_changed",function(){var t=n._sv.getStatus();l&&l.removeWait(a);if(t===google.maps.StreetViewStatus.OK){if(!e.hasClass(TC.Consts.classes.VISIBLE)){n._sv.setVisible(!0);u(n._sv,!0);if(n.map.activeControl){n._previousActiveControl=n.map.activeControl;n.map.activeControl.deactivate(!0)}setTimeout(function(){e.css("left","").css("top","");e.removeClass(TC.Consts.classes.HIDDEN).addClass(TC.Consts.classes.VISIBLE)},200)}}else{TC.alert(n.getLocaleString(t===google.maps.StreetViewStatus.ZERO_RESULTS?"noStreetView":"streetViewUnknownError"));if(n._startLonLat)n.callback(n._startLonLat);else{n.layer.wrap.setDraggable(!1);r(n)}}})}u(n._sv)}else r(n)})}}();TC.control=TC.control||{};TC.control.MapContents||TC.syncLoadJS(TC.apiLocation+"TC/Control.js");!function(){for(var e=0,t=["ms","moz","webkit","o"],n=!(!window.performance||!window.performance.now),r=0,i=t.length;i>r&&!window.requestAnimationFrame;r+=1){window.requestAnimationFrame=window[t[r]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[t[r]+"CancelAnimationFrame"]||window[t[r]+"CancelRequestAnimationFrame"]}window.requestAnimationFrame||(window.requestAnimationFrame=function(t,n){var r=(new Date).getTime(),i=Math.max(0,16-(r-e)),a=window.setTimeout(function(){t(r+i)},i);e=r+i;return a});window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)});if(!n){var a=window.requestAnimationFrame,s=+new Date;window.requestAnimationFrame=function(e,t){var n=function(t){var n=1e12>t?t:t-s;return e(n)};a(n,t)}}}();!function(){TC.Consts.classes.THREED=TC.Consts.classes.THREED||"tc-threed";TC.control.ThreeD=function(){var e=this;TC.Control.apply(e,arguments);e.crs="EPSG:4326";e.crsPattern=/(EPSG\:?4326)/i;e.currentMapCfg={baseMap:"",baseMaps:[],baseVector:""};e.workLayers=[];e.selectors={divThreedMap:e.options.divMap};e.Consts={BLANK_BASE:"blank",DEFAULT_TILE_SIZE:256}};TC.inherit(TC.control.ThreeD,TC.Control);var e=TC.control.ThreeD.prototype;e.CLASS="tc-ctl-threed";e.classes={MAPTHREED:"tc-map-threed",LOADING:"tc-loading",BTNACTIVE:"active",CAMERACTRARROWDISABLED:"disabled-arrow",BETA:"tc-beta-button",FOCUS:"focus",HIGHLIGHTED:"highlighted",DISABLED:"disabled",OUTFOCUS:"outfocus"};e.direction={TO_TWO_D:"two_d",TO_THREE_D:"three_d"};e.threeDControls=["attribution","basemapSelector","listTOC","selectContainer","externalWMS","layerCatalog","click","fullScreen","loadingIndicator","navBar","state","fullScreen","threeD"];e.template={};if(TC.isDebug){e.template[e.CLASS]=TC.apiLocation+"TC/templates/ThreeD.html";e.template[e.CLASS+"-overlay"]=TC.apiLocation+"TC/templates/ThreeDOverlay.html";e.template[e.CLASS+"-cm-ctls"]=TC.apiLocation+"TC/templates/ThreeDCameraControls.html"}else{e.template[e.CLASS]=function(){function t(e,t){return e.w('<button class="tc-ctl-threed-btn" title="').h("i18n",t,{},{$key:"threed.tip"}).w('"></button>')}dust.register(e.CLASS,t);t.__dustBody=!0;return t};e.template[e.CLASS+"-overlay"]=function(){function t(e,t){return e.w('<div class="tc-ctl-threed-overlay" hidden><svg class="tc-ctl-threed-overlay-svg"><defs><filter id="fGaussian" x="0" y="0"><feGaussianBlur in="SourceGraphic" stdDeviation="3" /></filter></defs><rect width="100%" height="100%" fill="white" fill-opacity="0.5" filter="url(#fGaussian)" /> </svg> </div>')}dust.register(e.CLASS,t);t.__dustBody=!0;return t};e.template[e.CLASS+"-cm-ctls"]=function(){function t(e,t){return e.w('<div><div class="tc-ctl-threed-cm-tilt"> <button class="tc-ctl-threed-cm-up-arrow" title="').h("i18n",t,{},{$key:"threed.tilt.left"}).w('"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACwAAAARCAYAAAHRZ37kAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAbKSURBVHjaYvz//z8DEDABsQgDBEgD8XmWq1evRsXHxy9lQAI7duyoZgDq4AJiNyBmAWKVv3//hgNpYYAAAkmAMA8QS75588YepIDF3NwcqOAvE7IxDPv27UsFaQFi5j179nQCaV2AAGIEEuxAOc179+4FrV+/PvrkyZMiv3//ZgKC/2pqap/Pnj0rvGvXrjigmk0gxe4mJiY7QKZZW1u/9PPzOyMqKvryw4cP+kVFRcYgcTY2tr9ycnKvAQII5jAQZgNiIZADgVgCiJW2bNkSD3UKWA0LUKMYENsAJVI2bdpk9uLFC05WVtZ/wsLCP8+dOyf85cuXI+Hh4SBnPGDMycm5f/z4cQUGPMDLy+tpU1OTL3NGRkb86dOnJYWEhH4kJydfA4bubqDkdV5eXh5gaAuAFP/8+ZPp5s2bYLdo3L17Nw1Iq0NDnBmIOWbMmFENdFIJkO0AxPIgOYAAYjQ2NmY4c+YMI8jTQMwJxALQCBX5+vWrKChWgDQXOzv7Px4enl8/fvz4x8XFxQ2MB8tJkyY5FxcXr7O3t18FVH8RiN8C8S+Qa0DBrPLv3z8jYCQFHThwwPbChQuC7969Y//z5w8TA5EAFA1hYWF38/LyeoBxeRQo9IjxxIkTRcDA6wFawIiugZGR8T8wxP8Dkw0DCwsojf1nBFrICHQIIy5LZGRkPsbExLSDXKz069cvt9jY2FZgVHECE8Zdb2/vHUAFF4DqngPxRyD+AcT/gJgLiLULCwvrgA5SFBER+aGhofFJRUXlpb6+/hUgfY2Dg+M2MMhuAARgpPxdEgjDOK7dDYZ0Kih6ij9ADlNp0EiQKBqlxRYn6Q9oaFRocWoQnJsUoX/AodUlCgdHpeBQI9QQFC008xTS+j7xChIGHXw57rh73u/7Pp/vswoRSc3w34R0kJEBJTKZIStxnc/nz3A/JGPse/VqLR4YU/MIPOJ/CzJAJrg3Y9t6HIWGEoos0BHM9Xr9HOcoFgqF82az+ZxKpbJ4vicgoQ+2s5/mCYwCB4pt1+v1IAjelWXZ2u12NXjHL5mjcwaXM1EUp6DCQpENh8O9RCKRs9vtN/isBo2gORXe73Q6R6DiBCNBarVaWhTh1jXzr0uSpGEymSwEAgEaMY/QKwcXV7lc7rRYLLoGg4GGYfbvonQBT02pVPIi+UaXy9WjhnN4uGw0GuY1qKk4jiPcFnRnUrGpqPq9uKIoPHIgIaIOhK7MZzKZa3B3QW4Z7Aun0/nu8/lGHo+nCQcvKDgDkhsoasJ8sqXTae9kMuGXRWnAUUhsNtsEfRGq1arAY5jdxePxvWw2GwmFQv1oNFrGirdarfYJ//RZpz+ZQwtmRQTudgwGAzVR8fv9Q5iowYDsdrsfEHdqYIOaZ0Z3PcDnIBaLyXjZhjosGJT7OfTFCusqlUoQo/cYmI5pN4IgtJmBN2jMjEy/BWi2fFqUCqMw7s2541hDVjIqEkw6i3CRxGUEIQkhaBe5aN8nkDZ9Dbe6ch1+gXZC4OAQs2nRP9x4J5X80+Cg0wjXa/Y7doTbDC3aRBcO773ie+/znvM8zzmGJ2fe3BnaXfyEHNlUk7oYpv7H79nnUyBL5fRS33FNdIKVJqvV6hNoO+UgTZgkmRkQfeGBAnM0S5fAbSiwNTgBsaWWIB/YVjGGqNUt6haeTCZhrDdCmq8T27AzwLqJm25K3cWfCB8lQqvzH8Fg0EGsLqwORCIRs91uh1qt1h66M8noo2w2O8rlcu8o6yGH+KiVGBFT4ZoCXx98JeiwxyHCkCoG3W93Op0kTpCAPPFut3tDxD0cDrewfBPw/kv9V0m3Su/vTF+KIiRoFS7g5+j8qncffuhC7AnAjznAQSqVOlLn6Sslztc0MsjMA9u27/V6vftIxqLL3RFwRNCrgH9xibQR1QxX+5bP598ymBxQGaFMT/k8NZrN5otSqfSSLMa1nIbvP7gQnZNOp8fE+0wm84YKHEG5Y4PMPmcoelav13NwK0Sp/whYSs6JZQJw4agLP11mjzn3C6EBz4tfjFj12ytw2y+9QVa4bzLTBcXH/hY83D6xLOt1oVB4JRze57e7NKGH5XL5KVPezpqfeNRcACUSie/JZPIMQ/zK/Rc8bRCNRgdk4VSF4XjFAcgNHDxAtW5K2+V9e5VKxarVarsXJxX4uxAO862F9HvGOod7lw4xYB2yf8jaBvQnZoHPwtG2+BwP/WKx+CEejz9GbLt44ZhS2IymNsOF7fHEqYpAhoy5xsJjZSKu1axGRUKs0UajsY9Odui0Aczb4eCzWCx2BrgxIPuAGVG1ExIwZj1V3z1Xi5vpKs+zn3aM2cxE/zCKAAAAAElFTkSuQmCC" /></button><div><svg width="95" height="95" viewBox="0 0 145 145" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><pattern id=\'video\' width="100%" height="100%" viewBox="25 27 100 100"><image x="40" y="40" height="65" width="65" xlink:href=\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEEAAABBCAYAAAH58PnTAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAA7NSURBVHjaYvj//z8DGk4CYlUgFgfiEiBmZGGAAgMDA4YLFy4EmpiYzGVAAmfOnJFlgnEuXrwIoq7A+MzMzDDmPpCiyUDdQFP/c5mamt6Cyfz9+xfG1ANZJwViARV+ZcAODJgYiACkKQL6ogSHmn+MQAfLABk8QHwDiPWBOARJwX8g7gYIIPSAFAbiMiBmAuI0IFZBCUgWFpY3UGs9gT51QHHL5cuXQQr+Qbl74I4FBR6QLgAGmO6fP3+YoOHUguIboEA/kJqEzSuMxsbG/6Hx8g9oChPO8JCWlv6KN8DWrVuXjNUKoF9BEvNAbCAuhQYcDFwCCCD0gGJgZGQEY1Cg7d279zzIjSBsYWHxByjmOWfOnOswMUtLy79AMUMWdGvV1NRgTJ+ysjIDGOf379/Md+7cqZs+fboGTOzXr18gbxSAnKoOZIQD8QEgPqatrf3n6tWrIMOdgbgCpPjnz59M7OzsoMh4DMSyUAMY2djYQCEZBzJkLTDMg5BS0gIgdQgoNo+YJAhUvxbDO0DNCTw8PNEMxANGrAn++/fvzCQYgj3XnDx58iAphrBAMwqDoKDgj927d4Myy04glgfiO0SasQ8ggEABi88CIyD2BOIL0CzyC4jNgNgFiM+DxDAClYmJieHfv3+gVOkHDOC1SDEwFUidRY4xoFg/hgF6enogirOiomIyWmxlA/FLZDFgAVeIEZg/fvwA5z5gOSqILnf37l1+ZD7I+xgG3L59G0R93bFjRzeyeGJi4i1gQC9EFsvIyLgBCsQYIFsIiFcA8StoRgMVsRlAbAt0CQ+wQPoCyipA/AGIRYF+5wV65zOQvRBeYkybNu2smZlZPJB5E5j+p1tZWaUQikNQ6Q/3QlZWlrGLi8tZINN9wYIF9sQkAlDNgBIGHz58YAeWC1soStLAohNUvv6nKE+AApIiAyjOlUBvMJJtgL6+/ls8GQy/Ac3NzZfmzp3rSpYXgKlriaenpzuotZCWlraUGM3AwhZcC3sA2VxAvAOIv0Hl+KHlgBa0wsEGPgHxNoAAxFc9SEJRGH2CkiSlQ04tIUpgNGSUlCASuBgIPTSIwMJcBKUGoRYNg3CNaAlCkRqkoB+s3PtxaQzM/pagLKXBIiiK6nzxFEnTJB99cOD93Hfvud+795zvMiXKnZJGVGBIQqAZYIEVj8dzg2X/xrLsQzQaPcazGaCHc/sWYBg7fNPlct2h3avFYnkgQ8PzaUALNAoqJV2pVOavYVykQeT14+hwBOJV8hupVPqMgSJ436LVag0/jSGXy59isdhExfUok8nyQEiATqPROPQTAYpsNiuGebbBovXlJpnJZKi/vook0DAP0k7gyul0npddZZB4uPgTxKZsO273XtDvqMNFAyDmNPCRG+xrquiMSSQSXx9g9vQ7moBeYMxsNhtSqVR94WwhuqcOh4Pc7oBrOwjB0ufKtdzgbrc7abPZlnC7QSRGTSbTQjqdptR8YItsc4J9CNyCxAuRQDvqUI9/OOX1eruYGkQkEtnFmpsjEqtQfev3NEGzrwOBwAputzj/7ggGg/MwhFamhoFJL1OKisoVSi+8rRnkJuGqcTxaBPoLU1rDkAgrtSBCIDNgt9vPRCIRw0f8embhcFhZjZnxQoLPqIaE4N9JhEKhI5w5BP9CQqfTpbCNZtVqdZSvTAg5dSzaEfF4fA8HJaqg96nSJJ1QKBQsDxwyJFZm1MBTfr+/GzJ6CV9Yw4sd4IT8XqVSvaOgJskmaW+nE7vP57Mmk0npX0bWaDT3qP6paFn/FIBd8wtpMozCuBtim7mlRa4IshpFdSHiVRcyUAutGAhjGE0I3EV3pXaVCIGDUIoJXkQ3gezOv9CNFxFNoTAczSAlFuJgTk1ii4a4Sls9jx3HNtg+1LVRJByY395v7/nenfOe33neqXbCTwkBqoUdEWA5K9V1CTbHJgD2meAroHNMxp2W+4IirixsjdsF0JTAqmF3p6am3hBkEDObbW1ty7g2QoARkCHQXIA5RkdHZy0WS6Smpmajo6NjBdcGYddgxxVXgOU4LqPEYkVs1GHXGxoa2kOhkCa11qB6frDb7Q/kSS8DZm4lqEPxcSh+s6i+93dKU4coD7S0tDgRBwfTOQy0e2UwGHzNzc2W1KYscdzk5OSgYkqiiY+b9GHV6SaXVSoAP7LPPLWwsHAg0zjwaK1isUJtSKpukUikQukev9+vW11dLVJa3XA4vE/RgbW1taSWDg59lWDM1DjGysrKNrKyK0aj0biRU4uLi98r3YMADYrCk/EP3XFI0YHFxcWCYDC4ZZLfnt7e3pl0LSSDq7u7m6LGs87OzneZIBYxMKwWgGVTT52SzJ5EJYQULjdSSSWby1JdXd1TOPE29UN1Ot3G9PQ09TC26vPYI9w2m82f6izGffN4PCNUWpiGtdzvZdeaFwmGghnX/KdGo6H2oRIt8KRINaZtQY0im8/n01ZWViaqjp+k1hyVurM1DmmsJeLLGD7AUCFSyo46YGNaNDU1Bbq6ulx4gxTtYz2I/e5cuConYFaz2dwOdN+/10qESlvlcrmWVVar9QvyVb/9Rnl5eXR8fHwILwdhXlhInv4qlvRxIBAoyVY5bGxsDKhTGRC9hBbReQNfzR38e0ligxvP6WxOvi1dpRVJgOz1ExMTdMIslcyQbSDgPBnTEGlS1d/ffxsvr8hK5B7PECjGgYGBiymKeG4hFW3b+bxSMjNxfX1dnTcHEo4A/r2O6b8Df48DpaWlm3lzIOGAMT8OAJ9f/skmVUlsYq/4XEAkdw4Qr9xuN5tVKmo8BK7I2VdgMpk+YnIeDT+CvZbGcynbk/N3A2q9Xp/E7319fTNOp/MhNSvhNp42UZqfoxqaTQdaW1u9hNJ7INd2cL96bGzsBa4Pi6K6Qpbk6RSIePsXB/Ver/dmT0/Pub3oSMiqHw6Hw2M0Gp/QARIxP7BIenvCaBiWmvfUoA+LHnBGXhfuYv7vorxwHt8vAdq3tlhIzzA8YzFda+kahxk7NYzj9IjVdu0Su+KicyN6IcoVjUPSSiSUhPRCREhwIxHitpS4cSGVaCR70RKJktZmmaXjMLUOsY4rdOws0/cZ799MdFjmpzW1X/KH+TP/N9/3fO/heZ/v+x0RKI4t349J5UAKiu1bXIPIGU2w7JCBgYEYouvq8fFxb1A0ou0vCJl5ooSPZTIZRAwj299zNoU97hr9eTEQYGtqWsWwoaGhj6iYUlB/XjS2A+pvW61WPyO7BsGes+lvVejvQkEgAFx4sN5cp2D1PjQajfdra2vfpQLJF88fHYNQ/xIYL8j2DQkJCQPsEwYevIXBBF+O6e/vT2psbAyjovzGSfOJjIzcKCkpmY6Njf2Z+4MlLIgG4bhSFQdcWJrypyuUrjiqBj7Lzc29S4W/7LS/K/RfXV39G9XeP/Fq4uEg8suEwsLCOJy6OKMvWtBfSkoKNi6GRYMQFBRk9z6VU4L/YvU/pWonvaysLOak3bLXWRwFLkNRUZFVMOjt7ZVXVlZ+4Oj4AW5+fv7TvLy870WzI19fX7sXBzm4wW1aqfco1Ec4CoBQJnR1dWkALibe1NQUKmYB8SzlPrhoqKtYEI6IakcTL2QG2d7enufOzo7o7SGUKuRKrktLS5a1tbXr55QiZaItAcKevYvTG/bnt4juLERFRW2K/S2FQrFLwW03MDDwZURExPpZTl/YcwdPT0+Qk3XRIBwnvXMqg9Y3S9cYEYsBf3//XUcGjmfc3Nz26+vrnxBpwTGj5ZaWlgm5XG5yFADwUIopw/RxAoFRyqZr+9fqhhyFhb92HZBWRULm+Y8swfxAxpok8vj7dN1tbm5+iH1LeycQj2vJyckLdXV1g6xLPuOxYIMktqqqKrGnp0d12smjpaenGylIowLAjvITKW+ue3EQu8kBzcIa5hYTim3+/IqF1L8bTgpgy4n8XjgtIJAjAACp8RZrX2rO6xBi5BQjrlGgC6Aor1xcXPQgf7dugbu7u+/7+fn9SdxgLSsra1GlUsGizMwRFng8Eh7zbe7TVa/Xe3R0dCipxPHd2tpyt+1PqVTuxsfHP8/Ozl6ioG1mnRbXU4EnJIOG0kBi29rakqgzOfmeSafTGZOSkvDFKaay80w1heMSAMRiCwL1dc1m9TFxDVKk2WyO6uvri5mcnLxpxx0s4OVk7tbUQd914Q0gqYOmbqF0aoGWD7e07Q/34+LiNhMTE+dYooXUPg0Qvi0uLv5qcHBQeXT3CQ1np8gX9T4+Pr/yQ7/zioDbQ5k2k6/vr6ysSI+QozvEDVJLS0vj4WZi+ch5K6g0n11yzR+Ilf4IEL4js0udmpryfl1gInJhIJPSs29OMHtbYbfZZxPF6n88OjqaXlBQcF9yiZtWq90i67ceR7lxmgwAHyOCEknmlEagfUPuA737S5ab73BBBPKBnd93yDcDJJe8seX7O0SWYDWpqan3yJfjqRYwEPUckeDw92FKhEUFwDclztFcXUQiKW1tbQ2nsjezpqYmj259ITnc/VJJnKidi7IKd+nu7tZQPr+3vr7+tsTJ2rnKy9vb2+5U2mqvNAiwCIPBcGtjY8OVsonlSoIgkBUxhc3/AgRnbG9AeAPCBYEAEROFymWqFf5VECCGEleY9/Ly2ufzS85BGc+zMktLS5utqKgwCunySoFAtHm1sbHxMdXws1xNqp0pJriKWfnMzMyZ4uJiFE7DrPzssZgi5ZLaaUA4k90GBwdv19XVjWs0Gkwer5VPsuoExcmTpTA1a5fO0EwAYfWk1/as59hcXA5ycnKm8fqmjaAC01+WHGp+wttJL/nedEZGxi9dXV1BqCcuY3zAvPAuMP07B2Xp60ePHn1OAe0hFGBhwPgSNjAbGhr0CoXCVlqD2itIa5j0AVIiC6zCrhNKaRRSn1Cs0HV2doad5f3Ii24eHh7m8vLyCZ1O10MfRwACVCGNyWSKbG9vfzA2NhZCk1+lSD+qUqmmeMX/kBzKaMKqvxLcKDw8XDIzM2PNBgwEdppw+hYltZKDZMjIyEi0Xq8PJ8Cu/1eTp9/ejI6O1mu1Wry7MMfzWv4LmdcMOPELkX0AAAAASUVORK5CYII=\'></image></pattern></defs><g class="tc-ctl-threed-cm-tilt-outer tc-ctl-threed-cm-tilt-outer-circle"> <title>').h("i18n",t,{},{$key:"threed.rotate.drag"}).w('</title> <path d=" M 72.5,20.21875 c -28.867432,0 -52.28125,23.407738 -52.28125,52.28125 0,28.87351 23.413818,52.3125 52.28125,52.3125 28.86743,0 52.28125,-23.43899 52.28125,-52.3125 0,-28.873512 -23.41382,-52.28125 -52.28125,-52.28125 z M 72.5,39.40625 c 18.297686,0 33.125,14.791695 33.125,33.09375 0,18.302054 -14.827314,33.125 -33.125,33.125 -18.297687,0 -33.09375,-14.822946 -33.09375,-33.125 0,-18.302056 14.796063,-33.09375 33.09375,-33.09375 z "></path></g> <g class="tc-ctl-threed-cm-tilt-outer tc-ctl-threed-cm-tilt-outer-shell-circle"><title>').h("i18n",t,{},{$key:"threed.rotate.drag"}).w('</title><path d="M 72.5,20.21875 c -28.867432,0 -52.28125,23.407738 -52.28125,52.28125 0,28.87351 23.413818,52.3125 52.28125,52.3125 28.86743,0 52.28125,-23.43899 52.28125,-52.3125 0,-28.873512 -23.41382,-52.28125 -52.28125,-52.28125 z m 0,1.75 c 13.842515,0 26.368948,5.558092 35.5,14.5625 l -11.03125,11 0.625,0.625 11.03125,-11 c 8.9199,9.108762 14.4375,21.579143 14.4375,35.34375 0,13.764606 -5.5176,26.22729 -14.4375,35.34375 l -11.03125,-11 -0.625,0.625 11.03125,11 c -9.130866,9.01087 -21.658601,14.59375 -35.5,14.59375 -13.801622,0 -26.321058,-5.53481 -35.4375,-14.5 l 11.125,-11.09375 c 6.277989,6.12179 14.857796,9.90625 24.3125,9.90625 19.241896,0 34.875,-15.629154 34.875,-34.875 0,-19.245847 -15.633104,-34.84375 -34.875,-34.84375 -9.454704,0 -18.034511,3.760884 -24.3125,9.875 L 37.0625,36.4375 C 46.179178,27.478444 58.696991,21.96875 72.5,21.96875 z m -0.875,0.84375 0,13.9375 1.75,0 0,-13.9375 -1.75,0 z M 36.46875,37.0625 47.5625,48.15625 C 41.429794,54.436565 37.65625,63.027539 37.65625,72.5 c 0,9.472461 3.773544,18.055746 9.90625,24.34375 L 36.46875,107.9375 c -8.96721,-9.1247 -14.5,-21.624886 -14.5,-35.4375 0,-13.812615 5.53279,-26.320526 14.5,-35.4375 z M 72.5,39.40625 c 18.297686,0 33.125,14.791695 33.125,33.09375 0,18.302054 -14.827314,33.125 -33.125,33.125 -18.297687,0 -33.09375,-14.822946 -33.09375,-33.125 0,-18.302056 14.796063,-33.09375 33.09375,-33.09375 z M 22.84375,71.625 l 0,1.75 13.96875,0 0,-1.75 -13.96875,0 z m 85.5625,0 0,1.75 14,0 0,-1.75 -14,0 z M 71.75,108.25 l 0,13.9375 1.71875,0 0,-13.9375 -1.71875,0 z"></path>	</g><g class="tc-ctl-threed-cm-tilt-indicator" hidden><path d="M 36.46875,37.0625 47.5625,48.15625 C 41.429794,54.436565 37.65625,63.027539 37.65625,72.5 c 0,9.472461 3.773544,18.055746 9.90625,24.34375 L 36.46875,107.9375 c -8.96721,-9.1247 -14.5,-21.624886 -14.5,-35.4375 0,-13.812615 5.53279,-26.320526 14.5,-35.4375 z"></path></g><g class="tc-ctl-threed-cm-tilt-inner"><title>').h("i18n",t,{},{$key:"threed.tilt.reset"}).w('</title><path d="M 72.5,39.40625 c 18.297686,0 33.125,14.791695 33.125,33.09375 0,18.302054 -14.827314,33.125 -33.125,33.125 -18.297687,0 -33.09375,-14.822946 -33.09375,-33.125 0,-18.302056 14.796063,-33.09375 33.09375,-33.09375 z"></path></g></svg> </div> <button class="tc-ctl-threed-cm-down-arrow" title="').h("i18n",t,{},{$key:"threed.tilt.right"}).w('"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACwAAAARCAYAAAHRZ37kAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAbKSURBVHjaYvj//z8XELsBMQsQq/z9+zccSAuzXL16NSA+Pn4pAxLYsWNHNSNQFsRmAmIRqLg0EJ8HCCCGffv2pYK0AjHznj17OoG0LqOZmRnQyL9MyMYwgIwAYh4glnzz5o09yHKAAAKZ625iYrIDpMDa2vqln5/fGVFR0ZcfPnzQLyoqMgaJs7Gx/ZWTk3sNUswO5Gveu3cvaP369dEnT54U+f37NxMQ/FdTU/t89uxZ4V27dsUB1WwCCCCQVRp3795NA9LqUP8yAzHHjBkzql+8eFECZDsAsTxIjmX+/PnLpk6daigkJPQjKirqlqam5iWgBOunT5/Mvb29FUDOADrhi4GBwTzGnJyc+8ePH1dgwAO8vLyeNjU1+YLcLAbk22zZsiVl06ZNZkCrOVlZWf8JCwv/PHfunHBpaemR8PBwkJsfwIIIhNmAWAgUVEAsAcRKQAPioQENVgMQQCCTlX79+uUWGxvb+uXLF05g0N0FunWHjIzMBaBpz4H4IxD/AOJ/QMwFxNqFhYV1J06cUBQREfmhoaHxSUVF5aW+vv4VIH2Ng4PjNg8Pzw1GoIIioB97gBYwovuLkZHxP9D5/4Gxy8DCAko8/xn//PnD+O/fP0ZcYQF00MeYmJh2kItVgAqNgOkk6MCBA7YXLlwQfPfuHTvQACYGIgEoMYSFhd3Ny8vrAcb7UaDQI0ZjY2OGM2fOgFzABsScQCwATakiX79+FQUlOyDNxc7O/g/oxV8/fvz4x8XFxQ1MvJaTJk1yLi4uXmdvb78KqP4iEL8F4l8gywACMFI9LwmEQZR1PRjWalDpKqYkYunNLgq2x4hAPPkHeOwQBCEYgnj0P/CgefMUeOjYKQiCjoLBokk/lEBRZM22FnLpjX2ChAcXHst+zDc78+bNo4ptaNVfrVYPEomEjLM28M64paAJSZtiAUutVgtBhceQ9Njj8XQEQaD4PjAExsAnzcRIMq5UKufFYvEIfPfj8fgDurg1m80tdoECf1hiO6o+LBQKZ1arVRNF8SsYDCqBQKCBn8her7eObhqIe+J6vV4WZF8MBgMT40t3u90fCB75/f5XqorneQ3KMaC7TSyaM5/P76mqapxxTPtEPDudThWqeEkmkykOttCq1+s7CxQxvYCk+vwxqYJplVswRD0ajd6n0+mUEdp7VBRlq91ur/73C3DPAfwyyqDdzWQyNxjkJc2Jx3TfJEnqwE+E4XBohgKMlJBxutTj8/mUXC53FQ6HS/ikxRpQWwKT1zY2b7fZbIawy/uyLDu63a4JZ1MuNU0z0JKgMhraNwqyky1GIpEe9r7kcrmuEUaDG5GSZjqmy2R0a8A6sImENvBpxebRUA0wPdq4CdQwAfdiLBY7xd3nbDZbxPfd1Ez+FKTPe+8MHDP+FcACbDCTERlsgIOcvFwun+AtkdeweG4+168AvZZPbxJRFMWhMFC0lCIRCDGpUBMXRlImJSw0hpU7Iybu/VZ8BcOCBRt3JC4ajenGhUFh42AAS7HSSGVSGIq/q/clpNWFC33JzXsTmHn33znnykNCPBQ9IA136vX6w263u02bjYvFogMtO+DfWQHBBJsqMc3VDIiWpnsUyTEsRdr2Go3Gk8FgcIs0zmhLN51On0KhY4jskPSOwMcxYBuznyjQppoBV3d5dsXhPQ63qdWDarX6GA25bqQKEM2j0eg8m81+z+Vyp1z0mfOneDw+TKVSQy440Q/OFJyS3iV1DlKaMCWJS+b43g5gtWu12vZFbgNPC8zjroWwMEHMOHuoy5D9iPeP2D8S1HsY+oO/3+8/Q9SeNpvN+51OJ6Yd/NslOKThhOM8mMSLRCKeBMR5IeXiefGrG36y9prrugFpUtmROgtZjggx+P5y4eyxbdsvKpXK8yDl30Ksdnu93qaODX9cIhtcGEAFxMK+f7io3iyfz4+xd7TmS9jwACLq+lGDe47j3CXTu+1222YIuikwxiKrtPg/Fiy6hK9cKOJLuVx+UyqV9qmoaEJfMTQxoDP0kCCDabJ3AwbNkf0sjmfI/pYEgR6sQ3wWgQQujWTaMoYhVsC3FFoXQzI9aGYO+K5c6GOPDH6DxruQ4z4T04HSzqECfWoUUhxe0+kxoMhe15HkKrahwcRw8hqClKAXEwxKSfpyE9ugV8PsISoVEu2QtsF89DVUOD+nr2c46ZGpcDKZtFqtVow5bwfetADvGQ6OcPQtHPmaXm2pjI+UjdxVMEtwQX041x/OlFL8K0HIfyyQGhLLZDIh0BrS4Cz9T0DfMYA1FGcuCmoCogSXgyof4dyEOeNVoVCQkg81m1+VwgzrXALVD/k+37CYqFN0AAAAAElFTkSuQmCC" /></button> </div><div class="tc-ctl-threed-cm-rotate"><div class="tc-ctl-threed-cm-rotate-buttons"><button class="tc-ctl-threed-cm-left-arrow" title="').h("i18n",t,{},{$key:"threed.rotate.left"}).w('"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACwAAAARCAYAAAHRZ37kAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAbKSURBVHjaYvz//z8DEDABsQgDBEgD8XmWq1evRsXHxy9lQAI7duyoZgDq4AJiNyBmAWKVv3//hgNpYYAAAkmAMA8QS75588YepIDF3NwcqOAvE7IxDPv27UsFaQFi5j179nQCaV2AAGIEEuxAOc179+4FrV+/PvrkyZMiv3//ZgKC/2pqap/Pnj0rvGvXrjigmk0gxe4mJiY7QKZZW1u/9PPzOyMqKvryw4cP+kVFRcYgcTY2tr9ycnKvAQII5jAQZgNiIZADgVgCiJW2bNkSD3UKWA0LUKMYENsAJVI2bdpk9uLFC05WVtZ/wsLCP8+dOyf85cuXI+Hh4SBnPGDMycm5f/z4cQUGPMDLy+tpU1OTL3NGRkb86dOnJYWEhH4kJydfA4bubqDkdV5eXh5gaAuAFP/8+ZPp5s2bYLdo3L17Nw1Iq0NDnBmIOWbMmFENdFIJkO0AxPIgOYAAYjQ2NmY4c+YMI8jTQMwJxALQCBX5+vWrKChWgDQXOzv7Px4enl8/fvz4x8XFxQ2MB8tJkyY5FxcXr7O3t18FVH8RiN8C8S+Qa0DBrPLv3z8jYCQFHThwwPbChQuC7969Y//z5w8TA5EAFA1hYWF38/LyeoBxeRQo9IjxxIkTRcDA6wFawIiugZGR8T8wxP8Dkw0DCwsojf1nBFrICHQIIy5LZGRkPsbExLSDXKz069cvt9jY2FZgVHECE8Zdb2/vHUAFF4DqngPxRyD+AcT/gJgLiLULCwvrgA5SFBER+aGhofFJRUXlpb6+/hUgfY2Dg+M2MMhuAARgpPxdEgjDOK7dDYZ0Kih6ij9ADlNp0EiQKBqlxRYn6Q9oaFRocWoQnJsUoX/AodUlCgdHpeBQI9QQFC008xTS+j7xChIGHXw57rh73u/7Pp/vswoRSc3w34R0kJEBJTKZIStxnc/nz3A/JGPse/VqLR4YU/MIPOJ/CzJAJrg3Y9t6HIWGEoos0BHM9Xr9HOcoFgqF82az+ZxKpbJ4vicgoQ+2s5/mCYwCB4pt1+v1IAjelWXZ2u12NXjHL5mjcwaXM1EUp6DCQpENh8O9RCKRs9vtN/isBo2gORXe73Q6R6DiBCNBarVaWhTh1jXzr0uSpGEymSwEAgEaMY/QKwcXV7lc7rRYLLoGg4GGYfbvonQBT02pVPIi+UaXy9WjhnN4uGw0GuY1qKk4jiPcFnRnUrGpqPq9uKIoPHIgIaIOhK7MZzKZa3B3QW4Z7Aun0/nu8/lGHo+nCQcvKDgDkhsoasJ8sqXTae9kMuGXRWnAUUhsNtsEfRGq1arAY5jdxePxvWw2GwmFQv1oNFrGirdarfYJ//RZpz+ZQwtmRQTudgwGAzVR8fv9Q5iowYDsdrsfEHdqYIOaZ0Z3PcDnIBaLyXjZhjosGJT7OfTFCusqlUoQo/cYmI5pN4IgtJmBN2jMjEy/BWi2fFqUCqMw7s2541hDVjIqEkw6i3CRxGUEIQkhaBe5aN8nkDZ9Dbe6ch1+gXZC4OAQs2nRP9x4J5X80+Cg0wjXa/Y7doTbDC3aRBcO773ie+/znvM8zzmGJ2fe3BnaXfyEHNlUk7oYpv7H79nnUyBL5fRS33FNdIKVJqvV6hNoO+UgTZgkmRkQfeGBAnM0S5fAbSiwNTgBsaWWIB/YVjGGqNUt6haeTCZhrDdCmq8T27AzwLqJm25K3cWfCB8lQqvzH8Fg0EGsLqwORCIRs91uh1qt1h66M8noo2w2O8rlcu8o6yGH+KiVGBFT4ZoCXx98JeiwxyHCkCoG3W93Op0kTpCAPPFut3tDxD0cDrewfBPw/kv9V0m3Su/vTF+KIiRoFS7g5+j8qncffuhC7AnAjznAQSqVOlLn6Sslztc0MsjMA9u27/V6vftIxqLL3RFwRNCrgH9xibQR1QxX+5bP598ymBxQGaFMT/k8NZrN5otSqfSSLMa1nIbvP7gQnZNOp8fE+0wm84YKHEG5Y4PMPmcoelav13NwK0Sp/whYSs6JZQJw4agLP11mjzn3C6EBz4tfjFj12ytw2y+9QVa4bzLTBcXH/hY83D6xLOt1oVB4JRze57e7NKGH5XL5KVPezpqfeNRcACUSie/JZPIMQ/zK/Rc8bRCNRgdk4VSF4XjFAcgNHDxAtW5K2+V9e5VKxarVarsXJxX4uxAO862F9HvGOod7lw4xYB2yf8jaBvQnZoHPwtG2+BwP/WKx+CEejz9GbLt44ZhS2IymNsOF7fHEqYpAhoy5xsJjZSKu1axGRUKs0UajsY9Odui0Aczb4eCzWCx2BrgxIPuAGVG1ExIwZj1V3z1Xi5vpKs+zn3aM2cxE/zCKAAAAAElFTkSuQmCC" /></button><button class="tc-ctl-threed-cm-right-arrow" title="').h("i18n",t,{},{
$key:"threed.rotate.right"}).w('"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACwAAAARCAYAAAHRZ37kAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAbKSURBVHjaYvj//z8XELsBMQsQq/z9+zccSAuzXL16NSA+Pn4pAxLYsWNHNSNQFsRmAmIRqLg0EJ8HCCCGffv2pYK0AjHznj17OoG0LqOZmRnQyL9MyMYwgIwAYh4glnzz5o09yHKAAAKZ625iYrIDpMDa2vqln5/fGVFR0ZcfPnzQLyoqMgaJs7Gx/ZWTk3sNUswO5Gveu3cvaP369dEnT54U+f37NxMQ/FdTU/t89uxZ4V27dsUB1WwCCCCQVRp3795NA9LqUP8yAzHHjBkzql+8eFECZDsAsTxIjmX+/PnLpk6daigkJPQjKirqlqam5iWgBOunT5/Mvb29FUDOADrhi4GBwTzGnJyc+8ePH1dgwAO8vLyeNjU1+YLcLAbk22zZsiVl06ZNZkCrOVlZWf8JCwv/PHfunHBpaemR8PBwkJsfwIIIhNmAWAgUVEAsAcRKQAPioQENVgMQQCCTlX79+uUWGxvb+uXLF05g0N0FunWHjIzMBaBpz4H4IxD/AOJ/QMwFxNqFhYV1J06cUBQREfmhoaHxSUVF5aW+vv4VIH2Ng4PjNg8Pzw1GoIIioB97gBYwovuLkZHxP9D5/4Gxy8DCAko8/xn//PnD+O/fP0ZcYQF00MeYmJh2kItVgAqNgOkk6MCBA7YXLlwQfPfuHTvQACYGIgEoMYSFhd3Ny8vrAcb7UaDQI0ZjY2OGM2fOgFzABsScQCwATakiX79+FQUlOyDNxc7O/g/oxV8/fvz4x8XFxQ1MvJaTJk1yLi4uXmdvb78KqP4iEL8F4l8gywACMFI9LwmEQZR1PRjWalDpKqYkYunNLgq2x4hAPPkHeOwQBCEYgnj0P/CgefMUeOjYKQiCjoLBokk/lEBRZM22FnLpjX2ChAcXHst+zDc78+bNo4ptaNVfrVYPEomEjLM28M64paAJSZtiAUutVgtBhceQ9Njj8XQEQaD4PjAExsAnzcRIMq5UKufFYvEIfPfj8fgDurg1m80tdoECf1hiO6o+LBQKZ1arVRNF8SsYDCqBQKCBn8her7eObhqIe+J6vV4WZF8MBgMT40t3u90fCB75/f5XqorneQ3KMaC7TSyaM5/P76mqapxxTPtEPDudThWqeEkmkykOttCq1+s7CxQxvYCk+vwxqYJplVswRD0ajd6n0+mUEdp7VBRlq91ur/73C3DPAfwyyqDdzWQyNxjkJc2Jx3TfJEnqwE+E4XBohgKMlJBxutTj8/mUXC53FQ6HS/ikxRpQWwKT1zY2b7fZbIawy/uyLDu63a4JZ1MuNU0z0JKgMhraNwqyky1GIpEe9r7kcrmuEUaDG5GSZjqmy2R0a8A6sImENvBpxebRUA0wPdq4CdQwAfdiLBY7xd3nbDZbxPfd1Ez+FKTPe+8MHDP+FcACbDCTERlsgIOcvFwun+AtkdeweG4+168AvZZPbxJRFMWhMFC0lCIRCDGpUBMXRlImJSw0hpU7Iybu/VZ8BcOCBRt3JC4ajenGhUFh42AAS7HSSGVSGIq/q/clpNWFC33JzXsTmHn33znnykNCPBQ9IA136vX6w263u02bjYvFogMtO+DfWQHBBJsqMc3VDIiWpnsUyTEsRdr2Go3Gk8FgcIs0zmhLN51On0KhY4jskPSOwMcxYBuznyjQppoBV3d5dsXhPQ63qdWDarX6GA25bqQKEM2j0eg8m81+z+Vyp1z0mfOneDw+TKVSQy440Q/OFJyS3iV1DlKaMCWJS+b43g5gtWu12vZFbgNPC8zjroWwMEHMOHuoy5D9iPeP2D8S1HsY+oO/3+8/Q9SeNpvN+51OJ6Yd/NslOKThhOM8mMSLRCKeBMR5IeXiefGrG36y9prrugFpUtmROgtZjggx+P5y4eyxbdsvKpXK8yDl30Ksdnu93qaODX9cIhtcGEAFxMK+f7io3iyfz4+xd7TmS9jwACLq+lGDe47j3CXTu+1222YIuikwxiKrtPg/Fiy6hK9cKOJLuVx+UyqV9qmoaEJfMTQxoDP0kCCDabJ3AwbNkf0sjmfI/pYEgR6sQ3wWgQQujWTaMoYhVsC3FFoXQzI9aGYO+K5c6GOPDH6DxruQ4z4T04HSzqECfWoUUhxe0+kxoMhe15HkKrahwcRw8hqClKAXEwxKSfpyE9ugV8PsISoVEu2QtsF89DVUOD+nr2c46ZGpcDKZtFqtVow5bwfetADvGQ6OcPQtHPmaXm2pjI+UjdxVMEtwQX041x/OlFL8K0HIfyyQGhLLZDIh0BrS4Cz9T0DfMYA1FGcuCmoCogSXgyof4dyEOeNVoVCQkg81m1+VwgzrXALVD/k+37CYqFN0AAAAAElFTkSuQmCC" /></button></div> <div><svg width="95" height="95" viewBox="0 0 145 145" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><pattern id=\'arrow\' width="100%" height="100%" viewBox="22 30 100 100"><image x="40" y="40" height="65" width="65" xlink:href=\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEEAAABBCAYAAAH58PnTAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAABHpSURBVHjaYvj//z8DGlZEF4MzjI2NQTQLkAZS/1mRFTExoILWpKSku0C6H0UUSQcjyJSurq77UNMYsZkUM23atHNI/BQYA67IxMRkkZmZmSsSfxa6IktxcfHvQPoHmhsdQATYXqCu/zDRPXv2HHFxcbGB8c+cOcMIc7Q+EDOjhQ+IbwDyAEAAgU1CAuxQ+ieG96EBuQiI10HZYIxsAhPQTX+h9rMAqb8o3gaC/NOnTx+AsiuxWQEKVVEQDWWjhK6nn5/fYyD9FcnEILgJUB3SQKwNMwFmCsgx2tCgfiImJvYdFLovX77khJpiCPKFDJABCvK3aEEuDMQ8AAGEnuLA4QHDQL4Z1CobJDEMjJ7gGJDiSwPotJNQJx4G8vVwqWXCYYCMvb39JRA7PDz8AYg2NTW9ABRXIsoQoEKRvLy8s1+/fmUFsgOQ4oYRaOB5IFOckCG8mzZt2n/s2DExoAERQP5uZMm7d+/yAXPGUSBTAJch7J8+fdrW1NSkAzQgFxgOK7E5fd68ecq3bt3aAWRywcRgiRAUz4uAGiOBBoDS2e1Zs2Y5ArEKnoDfDKRCgPgXLJriQFHp6+v75efPn3uB/AIgNgdiESBmh9IgfgFQfjcwSX6BRn06KKwAAgg9Q6EDUZBrgfgVThW4Ehq09Jry7du3uSCX4EpoLHhs1wKGTTbU3zOA1GlSEhgzkEpDEsqG5nLiDAACeXNz80ykQi8eSKkQmzpBgRb19+9fRmjUwkA8VI6gCySAybgUyr4ME3RycioCUtLEGOAHSsKrVq06AWSfhQkCUywbkAomZIBAR0cHuMRTUlJqgxY0cFBUVFQBpETwGeC0Zs0a+bS0tDtA9iF02w4dOiQBpNxwGcB17tw5sO1AA9qAIf8RW6ivW7euGpSLsRlgBtRooqur+w7I3oordbW1tWkBKWt0A0ABBA75+fPndwKpd6DCBkirYTPk3bt3NbCKCGaANtDJXmxsbP+AbDlg+t/j5eX1CCjWjM0ANzc3kAsMYOUBKNmCU92vX7+YYOkfBNLT028zMTExTJ8+XRWLOflAHMeAXB8tW7bsOigHAnEgECsDMRcUg9gBQDx55cqV15BqHklQeQCqZUA2fAHi5+hxjwWA1EsCMT8Q3wIIQHv1hCgZxFFbWzu0lRlFRUFLC9seKiLqIGaYCB36o1JeVoS6bEYFm9q2HoJOIVYIFhFBKSjZIcRuedFTt8A8yHbISFe36OBGFxdKek9+wod8pWvuwI8Zhvlm3jcz7/3e9BIUEknzF77sQBx2Op33cbRzaH8gAKVvkLGaXmVEM1gxIM4Gg8EXlUrlINxVQqiyXY20QweBRZhqTkcikflsNrubfcVi0RAIBEiGcwJw7UAAwBg9Wz6f9ycSiXYmpvtgncvldqHPh6YN47asCQhMzBx5olQqzfv9/jYnrFbrEmTvW2cMducAdoc7YhHAwwOBCcnkY+DenMfjOc4+yEgjFAp97L7YuCeH6vU6lcIowP8fBCai/BxB+I1G48m2Fuv1K5CiR2i+UfsGOd0IlQmSXApPPDAIqhCF8Rqod6YtiDrdb1j2B2i+Ek1QLWazmYBnSWPE6KAgtCK2VwBgutMJo/YYVRzxBdHqoTF0hNflR9avFgT79yEuwZPOKI7mOapniHIvAAogbrEhE/JjfYGg2NDfu00m02zn4gHAa1RPEAuY+NdqKIjxV1Fdpq1RW3NEBQBT9EWXy3Wz2WxqBcBbVA/pSLoA9K2ONpvtBqppcTHrui+esjDpnkfau10ulzezA4b9HS2zPKqOAhATz17EJLzWVLVa7YuGjUZjg8PhuJVOpznPS8RXWlmlN2fZynwQjUbvxOPx/eyAN39fKBQ2xWKxcVBuVDOEYrFYlsLh8F1aGsR3JQiam1PwcPfwip9S+5ja4PV6P9nt9kWtVruArs9CUf7ZRknN461WazKTyeyBeZiAZVHVCD7EJNfwtbJMEDwfQzKZvIDttbrd7p9wID9kkUVZiA/QZVlwpfOk/ocp1wkwvRzxTjlCMm5bKpUaq9VqRZ/P95Tvjj8C0Ga9L01GUbi5BXMrLcMMS9l0w2olOdNNTWdZ0D+wb6EImiJICOIXMRSF/FIgqCCiIP4Dgh/0Q0ZqIIY/6oNE1KdtCM3UmRD+mNl53s4dL2ub7zvnhRfkePfee897znOe59wT+USUoZFU8D9Sgr9/8aP6ZToFqRUNxs07Ozt2ouGpdrsdJPgLzd2LMPdMyAxOXtTS0vK6s7MTFL4EAR0PkdGp/QELLQBYFQgMm5/Ss8rxcnCmTIoG8OIupVWJMJAniplnp6p9WVIcpwd9qyB6bRL2+fl5tCRQIbOiSdFEeQCU/Nb4+HhZBM0Dj9zh7DgTCpfEOV3S19eXJ9VzrfZYptqyWXRlMh4k3AM4fR4FXrkwNDY2fpNPmJiYKGNuYEjoBji90DVxkgS1C3ttbe26fF5PTw/6e6XwFHssYR4AtucSMX0YDAal3xD4/Iw0cXl5uYKZll4RpCqAYg0XnGdESl/SJozslfeMlJXyyQaD4XBubu4VumT0eE6CZyUekGCXitVjsbjZbN6FMKVnN3wySjjNe8L0TJ+ITwBwsdP3LhKGoaEhCFn02Lci/aCurg6gVMh8Q3Na6o70cpGCktqWer3+KC0t7S06mtFg1+/3J3Or3nQa2h6C3d7e3lBJJOGC8vaRcT/q921ubi5keL4U7wZE0alA70kYrVbrPH//mI2MhYWFq+yFrFheiLUBBNzt0dHRUmFob29fw7u5g3qiZujq6nLCg/K+lhrRggJTMjg4GGpVEcvF6cELfyvJ8cnJSZz+AaexVs0GAKV5KysroaLD91Mf6FmPxQvDBxFVJ8OzUY1ikmCX2HCBMDY1NcH1a9zMUjy6u7ttXKSuKVFL5xg8LB6P5xGBj/R/p9O5waf3qZVrLHgFPCcrkWugWffr6+vvCWN/fz96v5+Y+aoera2tuNVxME3XxNqABLsQM5ubmxKMWiwWLPqO5fph2GYVkdCDgwNtIBCojATP/zWsAbskVh2ye5fPTDghWHBLlIJrJ25u5ir1gtvtBpQXsYc1kVjxeYbdSiFUqbIF6cF9Bb77TQ7O6yy/HT6fL1npBiBWob6IRSGWUMr3wzeARfM7OjqKhWFgYGCVF3NjYar1ZoLirMXFxXSWdaoGxZWdPFrASIrAPtbJPIGTlU9NTUk3E6QRj41G41F1dXWVKESnHawjXIym24gpEQNgsjaS6SG+R2pXQ7HgjLQ4NudwODZIyi+NjIwsUZr6YVOyiba2tlJubqUIRpTEwfSccrw1lsZvaGjwUFbgQuQ7sx1xdXuFi46F4sdCG8uemZnJjMa2KIjRAkIz7Ku4MLg4PT0dupqiQPnjcrl+1NTU+Gw2GyD4GzetvFyItpkN7ck4IwrO5ZycnAwq38gStH+t5MHcsbGxrNnZ2QzBJ4eHh/MpHkB0tPAAcj+XoPYNucdvMpn2eSHk/TovuMUghBIcDG/ph7FnHSNeCqecyBxkWLbX600m9nyDWNULcd+g48npXIT2uSEhThiMR/fLwErH4HOBKZqe34uDBf4KUL3VxjR1heG2Fkpbe1uhorIhkwRGdFBo14pg+Y6L/NVEUaNmJsTEGL/iognRaFzMEqOJMSHhl/KDkPBn/jFkMewjGWEidoJsoFvmJoFogfFtaS3sfclz9fZaoZ/oTnKjmGvLec573vd5nvOeSA2KRf2DJRwUHSa88PBy7Nq16zdBEMYkRsd0qDUnlAOVeB24hD0glnSozFyly5uamr6icGior6//mh1G7FAW4PpwJOb/AgTskSSEO7MDJ/3bl1evXl3oLWlpaSkljc1dPOVsAgAoXagq84MHAQBoAQBnvc1EuypPnjxpkTkdmzo6Osogs3PAjpcFCNUyRUAKAHAMDQ1Vkua0kaBVB1FWBffu3eNoYFbNjgwLHW28gVDFGYBEZGOuU7bJycltJDcKxsfHE4P9H+Y8J06csFCB5YhwADjmtZpIPNH3CgJ+4QTQXhbtTMzKDx06lO92uxdllrOzsytqa2sLRkdHK+A6ZCKSEuMFRLwiQQoAq54yIiE2WuEA6cz+DxrxAgYJCw0BYSGuWAUgNoBwxAUIVRyiIAEcYD1KXjmJ3yLa66sDTAm93tfY2OgifhCUDzx9+tSwY8cOh8/nq5QAsQqiSfnBggAT3QDXh02TknPnzhV2dnYGAKBUKuevXbvWrdVq52iS75wQUcuVR44csUNm5ANYoyKCI5BlAQEArIRZw2Ro6/Xr17fcuXPnY/m7ly9f7rFarZOhfO6DBw9SiMuzlGYHIg/qRAj31CLuIEjosAhAMZGfzRTumUE8nZ6qqqohxWLNjLLR1ta2jgC1A4hcRJohVkCoYwCAlA4z2ytubm4uu3LlylvHxcePH+/bvn27C1awEn7kJ6F8DwNKlUN1+vRpLwQVu3kDEFn+9wmCCmwwFeRmS3t7uzMYAJTk/t63b98vsBBGUPbWh/NlfKCXnp5etHv3bg/8dBGMaUWITSGxBkGuBzaTaC+R02Ee1dXVA2fPnuUWip9gCs9D/Ie9ggyw2Wz20ZbyAgj+jCEYzXPLCYIIgBmszk7kpvTYsWMW0bEQR0lJyfOLFy9yBPzInhJygSEaj6Curu6ztLQ0z8aNG0UQ+HkOs2NuORKjSIdTwObsL1682LZz504He4fSF/Py8kZJKfJpzA+whv+BQRqNSaJgoA8ePGh/+PBhJSzjbERkkiKM7qBIQRABSEZCs/r9/orDhw9b0O/8etBKzdTX17sQAVIAfNEAIHUeSWfk0QIwvf4c5mAytpkyXiCIesCIhMZ6oIwEkY2kccBBPyWv6ZaWlvsajYbvO3Bj+F/w57yKGA4GnhRpASnSKonOSMZCKeMBglpCh5m9lZ45c8bW29u7SvqSwWDw8pEsAcCnovdRDhcAeJcxGc3gazscifRXjgirhF6HDIQqTADSoQdKqQoU3717N036EjemEwC/pqam8ulMJ/xoLoeeeAAgDjbj9+7dWwggOEIzELEJsQJBpMM8Ye5x2UrJrhC3DQLGpUuXerKzszkHcDJkf3w43gCIo7+/30gLI+oMCxbMEEoFXAoEkQ6ngQ4X3bx5s6ipqWmD/EUSRK6KiorvQYb6UApfEgBzimUavDBEy7laOKU6Yykg1CEAsA50uKi1tbX4xo0bb13eOHXqVJ/T6eTJMyH6HTV7RgQA0leFh8uYHtG1MtZA3L59O91kMhUdPXrUi0rkB3eYQmkOGQSRDq+B6ckAlBFJyZW/eODAgT9ramo6sAX4eGgCezEF/YtaPHo8ZiSvPOiNmI9bt25lUmL219bWSoEYAL32hwLCW3S4p6fHef78+U3yF4m6DhLizzBxAwD7FBFkhLvEJSvZ6/Wupn0ruFwu4dGjR0JfX59AmV3HN7ziAURDQ0MWlWoPCTYRiFeKN329AVtUfgIlAvBaEA0MDHyxZ88eu9wdZj1AdPgP8WeizWqaGB+aGInJmYg76Nkmi/aEK9rBN5QdDgdXK25m6RW3qhQIKQhKsC3x0lah2+2uptJjowkmyUshd1APDw8nMXOLWIEplXzg/YoBjuZzFs3sK1bME3Ptslqt39GPP0ty1kuFrHddSocXDkimpqaq+UAcrV4R/wJr166dobI5mZubO06JcoK7PAjEEVDoGYSpGltIoG2TwtcQu7q6hO7ubuOTJ08Mg4ODOrFHJpLBLW2NjY2dmZmZrahe/aheLMnnpZdrDSgpC1xg//79NUu1I/BKkqz1ZGVlTVoslnF6JkjZTeh0Or4h4AZT/BcTnoABMo3Je7BX55CIExCJOknlEJBbkvGYKWrW0LYz8cUCylVGzjOhRCRfzWpubv5WEIQ2aBk+cudDYJ8IggZf9tHIyEguJbu6x48fZ3GG5ZXMycmZsNlsY/n5+VMZGRljtMLSCY5hkuMoQ9KJinf9RQPkFSY9F4xAyUqpGk8i8lSSDCADQDJJgaKIMVM+MlEUGSiajASYkSOJ76YQEMMXLlz4xm63c4fMM8zBI40E8cg8BZVhleJNW5UPE5vCn9OSCc4GmaQ/FkrxHZVLBQ4jBUkDkLSYhx4g6RVvbnt5sFBuMFlxO3r/A5xDGD4oV+nPAAAAAElFTkSuQmCC\'></image></pattern></defs><g class="tc-ctl-threed-cm-rotate-outer tc-ctl-threed-cm-rotate-outer-circle"><title>').h("i18n",t,{},{$key:"threed.rotate.drag"}).w('</title><path d=" M 72.5,20.21875 c -28.867432,0 -52.28125,23.407738 -52.28125,52.28125 0,28.87351 23.413818,52.3125 52.28125,52.3125 28.86743,0 52.28125,-23.43899 52.28125,-52.3125 0,-28.873512 -23.41382,-52.28125 -52.28125,-52.28125 z M 72.5,39.40625 c 18.297686,0 33.125,14.791695 33.125,33.09375 0,18.302054 -14.827314,33.125 -33.125,33.125 -18.297687,0 -33.09375,-14.822946 -33.09375,-33.125 0,-18.302056 14.796063,-33.09375 33.09375,-33.09375 z "></path></g> <g class="tc-ctl-threed-cm-rotate-outer tc-ctl-threed-cm-rotate-outer-shell-circle"><title>').h("i18n",t,{},{$key:"threed.rotate.drag"}).w('</title><path d="M 72.5,20.21875 c -28.867432,0 -52.28125,23.407738 -52.28125,52.28125 0,28.87351 23.413818,52.3125 52.28125,52.3125 28.86743,0 52.28125,-23.43899 52.28125,-52.3125 0,-28.873512 -23.41382,-52.28125 -52.28125,-52.28125 z m 0,1.75 c 13.842515,0 26.368948,5.558092 35.5,14.5625 l -11.03125,11 0.625,0.625 11.03125,-11 c 8.9199,9.108762 14.4375,21.579143 14.4375,35.34375 0,13.764606 -5.5176,26.22729 -14.4375,35.34375 l -11.03125,-11 -0.625,0.625 11.03125,11 c -9.130866,9.01087 -21.658601,14.59375 -35.5,14.59375 -13.801622,0 -26.321058,-5.53481 -35.4375,-14.5 l 11.125,-11.09375 c 6.277989,6.12179 14.857796,9.90625 24.3125,9.90625 19.241896,0 34.875,-15.629154 34.875,-34.875 0,-19.245847 -15.633104,-34.84375 -34.875,-34.84375 -9.454704,0 -18.034511,3.760884 -24.3125,9.875 L 37.0625,36.4375 C 46.179178,27.478444 58.696991,21.96875 72.5,21.96875 z m -0.875,0.84375 0,13.9375 1.75,0 0,-13.9375 -1.75,0 z M 36.46875,37.0625 47.5625,48.15625 C 41.429794,54.436565 37.65625,63.027539 37.65625,72.5 c 0,9.472461 3.773544,18.055746 9.90625,24.34375 L 36.46875,107.9375 c -8.96721,-9.1247 -14.5,-21.624886 -14.5,-35.4375 0,-13.812615 5.53279,-26.320526 14.5,-35.4375 z M 72.5,39.40625 c 18.297686,0 33.125,14.791695 33.125,33.09375 0,18.302054 -14.827314,33.125 -33.125,33.125 -18.297687,0 -33.09375,-14.822946 -33.09375,-33.125 0,-18.302056 14.796063,-33.09375 33.09375,-33.09375 z M 22.84375,71.625 l 0,1.75 13.96875,0 0,-1.75 -13.96875,0 z m 85.5625,0 0,1.75 14,0 0,-1.75 -14,0 z M 71.75,108.25 l 0,13.9375 1.71875,0 0,-13.9375 -1.71875,0 z"></path>	</g><g class="tc-ctl-threed-cm-rotate-inner"><title>').h("i18n",t,{},{$key:"threed.rotate.reset"}).w('</title><path d="M 72.5,39.40625 c 18.297686,0 33.125,14.791695 33.125,33.09375 0,18.302054 -14.827314,33.125 -33.125,33.125 -18.297687,0 -33.09375,-14.822946 -33.09375,-33.125 0,-18.302056 14.796063,-33.09375 33.09375,-33.09375 z"></path></g></svg> </div> </div><div class="tc-ctl-threed-cm-help"></div></div>')}dust.register(e.CLASS,t);t.__dustBody=!0;return t}}e.viewer;e.mapView;e.terrainProvider;e.register=function(e){var t=this;TC.Control.prototype.register.call(t,e);t.mapView=new MapView(e,t)};e.renderData=function(e,t){var n=this;TC.Control.prototype.renderData.call(n,e,function(){n.getRenderedHtml(n.CLASS+"-overlay",{},function(e){n.overlay=$(e)});n.beforeBaseLayerChanged=n.BaseMap.Events.beforeBaseLayerChanged.bind(n);n.baseLayerChanged=n.BaseMap.Events.baseLayerChanged.bind(n);n.layerAdded=n.Layer.Events.layerAdded.bind(n);n.layerRemoved=n.Layer.Events.layerRemoved.bind(n);n.layerVisibility=n.Layer.Events.layerVisibility.bind(n);n.layerOpacity=n.Layer.Events.layerOpacity.bind(n);n.layerOrder=n.Layer.Events.layerOrder.bind(n);n.initialExtent=n.OverrideControls.Events.initialExtent.bind(n);n.zoomin=n.OverrideControls.Events.zoomin.bind(n);n.zoomout=n.OverrideControls.Events.zoomout.bind(n);n.$button=n._$div.find("."+n.CLASS+"-btn");n.$button.on(TC.Consts.event.CLICK,function(){n.$button.attr("disabled","disabled");n.waitting||(n.waitting=n.map.getLoadingIndicator().addWait());for(var e=[],t=0,r=n.threeDControls.length;r>t;t++){var i=n.threeDControls[t];i=i.substr(0,1).toUpperCase()+i.substr(1);e=e.concat(n.map.getControlsByClass("TC.control."+i))}n.ctrlsToMng=e;if(n.mapIs3D)n.cameraControls.resetRotation({duration:1e3}).then(function(){var e=function(){n.mapIs3D=!1;n.map._$div.removeClass(TC.Consts.classes.THREED);n.$button.attr("title",n.getLocaleString("threed.tip"));n.Cesium.CustomRender.stop();n.map.off(TC.Consts.event.BEFOREBASELAYERCHANGE,n.beforeBaseLayerChanged);n.map.off(TC.Consts.event.BASELAYERCHANGE,n.baseLayerChanged);n.map.off(TC.Consts.event.LAYERADD,n.layerAdded);n.map.off(TC.Consts.event.LAYERREMOVE,n.layerRemoved);n.map.off(TC.Consts.event.LAYERVISIBILITY,n.layerVisibility);n.map.off(TC.Consts.event.LAYEROPACITY,n.layerOpacity);n.map.off(TC.Consts.event.LAYERORDER,n.layerOrder);$(".tc-ctl-nav-btn-home").off("click",n.initialExtent);$(".tc-ctl-nav-btn-zoomin").off("click",n.zoomin);$(".tc-ctl-nav-btn-zoomout").off("click",n.zoomout);n.OverrideControls.adapter.call(n,n.direction.TO_TWO_D);n.BaseMap.synchronizer.call(n,n.direction.TO_TWO_D);n.Util.reset3D.call(n);n.Cesium.setViewFromCameraView.call(n).then(function(){n.$divThreedMap.removeClass(n.classes.MAPTHREED);n.$divThreedMap.removeClass("tc-ctl-threed-divMap-fadeIn").addClass("tc-ctl-threed-divMap-fadeOut");$(n.mapView.viewHTML).removeClass("tc-ctl-threed-divMap-fadeOut").addClass("tc-ctl-threed-divMap-fadeIn");n.viewer.destroy();n.viewer=null;n.$button.removeAttr("disabled");n.$button.toggleClass(n.classes.BTNACTIVE);n.map.getLoadingIndicator().removeWait(n.waitting);delete n.waitting})},t=n.Cesium.Util.pickBottomPoint(n.viewer.scene),r=Cesium.Matrix4.fromTranslation(t),i=n.Cesium.Util.computeAngleToZenith(n.viewer.scene,t);n.Cesium.Util.rotateAroundAxis(n.viewer.scene.camera,-i,n.viewer.scene.camera.right,r,{duration:1500,callback:e})});else if(n.Util.browserSupportWebGL.call(n)||!n.Util.browserSupportWebGL.call(n)){n.mapIs3D=!0;n.overlay.removeAttr("hidden");n.overlay.appendTo(n.map._$div.parent());n.map._$div.addClass(TC.Consts.classes.THREED);n.$divThreedMap=$("#"+n.selectors.divThreedMap);n.$divThreedMap.addClass(n.classes.MAPTHREED);n.$divThreedMap.addClass(n.classes.LOADING);n.$button.attr("title",n.getLocaleString("threed.two.tip"));n.$button.removeClass(n.classes.BETA);n.Cesium.getViewer.call(n).then(function(e){n.$divThreedMap.removeClass("tc-ctl-threed-divMap-fadeOut").addClass("tc-ctl-threed-divMap-fadeIn");$(n.mapView.viewHTML).removeClass("tc-ctl-threed-divMap-fadeIn").addClass("tc-ctl-threed-divMap-fadeOut");n.$divThreedMap.removeClass(n.classes.LOADING);n.$button.toggleClass(n.classes.BTNACTIVE);n.OverrideControls.adapter.call(n,n.direction.TO_THREE_D);n.Cesium.setCameraFromMapView.call(n);n.BaseMap.synchronizer.call(n,n.direction.TO_THREE_D);n.Layer.synchronizer.call(n);$.when(n.viewer.readyPromise).then(function(){n.cameraControls?n.cameraControls.render.call(n.cameraControls):n.cameraControls=new CameraControls(n);var e=Cesium.Math.toRadians(50),t=n.Cesium.Util.pickBottomPoint(n.viewer.scene);t=Cesium.Matrix4.fromTranslation(t);var r=function(){n.$button.removeAttr("disabled");n.overlay.attr("hidden","hidden");n.map.getLoadingIndicator().removeWait(n.waitting);delete n.waitting};n.Cesium.Util.rotateAroundAxis(n.viewer.scene.camera,-e,n.viewer.scene.camera.right,t,{duration:2e3,callback:r})}.bind(n));n.map.on(TC.Consts.event.BEFOREBASELAYERCHANGE,n.beforeBaseLayerChanged);n.map.on(TC.Consts.event.BASELAYERCHANGE,n.baseLayerChanged);n.map.on(TC.Consts.event.LAYERADD,n.layerAdded);n.map.on(TC.Consts.event.LAYERREMOVE,n.layerRemoved);n.map.on(TC.Consts.event.LAYERVISIBILITY,n.layerVisibility);n.map.on(TC.Consts.event.LAYEROPACITY,n.layerOpacity);n.map.on(TC.Consts.event.LAYERORDER,n.layerOrder);$(".tc-ctl-nav-btn-home").on("click",n.initialExtent);$(".tc-ctl-nav-btn-zoomin").on("click",n.zoomin);$(".tc-ctl-nav-btn-zoomout").on("click",n.zoomout)})}})});$.isFunction(t)&&t()};e.activate=function(){var e=this;TC.Control.prototype.activate.call(e)};e.deactivate=function(){var e=this;TC.Control.prototype.deactivate.call(e)};MapView=function(e,t){this.map=e;this.parent=t;$.when(this.map.getViewHTML()).then(function(e){this.viewHTML=e}.bind(this));this.proj4Obj=proj4(this.map.crs);this.proj4Obj.oProj.METERS_PER_UNIT=1;this.maxResolution};MapView.prototype.getCenter=function(){return this.map.getCenter()};MapView.prototype.getExtent=function(){return this.map.getExtent()};MapView.prototype.getResolution=function(){return this.map.getResolution()};MapView.prototype.getRotation=function(){return this.map.getRotation()};MapView.prototype.getMaxResolution=function(){if(this.maxResolution)return this.maxResolution;if(null!==this.map.getResolutions())this.maxResolution=this.map.getResolutions()[0];else{var e=this.map.options.baselayerExtent;this.maxResolution=(e[2]-e[0])/this.parent.Consts.DEFAULT_TILE_SIZE}return this.maxResolution};MapView.prototype.setCenter=function(e){this.map.setCenter(e)};MapView.prototype.setExtent=function(e){this.map.setExtent(e)};MapView.prototype.setResolution=function(e){this.map.setResolution(e)};MapView.prototype.setRotation=function(e){this.map.setRotation(e)};CameraControls=function(e){var t=this;t.parent=e;var n=function(){var e=this;e.isFocusingCameraCtrls=!1},r=function(){var e=this;e.isFocusingCameraCtrls=!0;e.lastFocused=performance.now();if(e.$div.hasClass(e.parent.classes.OUTFOCUS)){e.$div.removeClass(e.parent.classes.OUTFOCUS);e.$tiltIndicatorOuterCircle.attr("class",e.$tiltIndicatorOuterCircle.attr("class").replace(e.parent.classes.OUTFOCUS,""));e.$tiltIndicatorOuterShellCircle.attr("class",e.$tiltIndicatorOuterShellCircle.attr("class").replace(e.parent.classes.OUTFOCUS,""));e.$rotateIndicatorOuterCircle.attr("class",e.$rotateIndicatorOuterCircle.attr("class").replace(e.parent.classes.OUTFOCUS,""));e.$rotateIndicatorOuterShellCircle.attr("class",e.$rotateIndicatorOuterShellCircle.attr("class").replace(e.parent.classes.OUTFOCUS,""));e.$imgs.css({opacity:"1"})}},i=function(){var e=this;e.moving=!0},a=function(){var e=this;e.moving=!1},s=function(){var e=this;e.parent.Cesium.arePendingTiles.call(e.parent)&&e.customCollisionDetection();if(e.moving){o(e.$tiltIndicator,e.getCamera().pitch);o(e.$rotateIndicator,-e.getCamera().heading);e.disableTilt(5)}},o=function(e,t){var n="rotate("+t+"rad)";e.css({"-ms-transform":n,"-webkit-transform":n,transform:n})};t.outControls=n.bind(t);t.inControls=r.bind(t);t.moveStart=i.bind(t);t.moveEnd=a.bind(t);t.postRender=s.bind(t);t.selectors={tilt:"-cm-tilt",rotate:"-cm-rotate",indicator:"-indicator",leftArrow:"-cm-left-arrow",rightArrow:"-cm-right-arrow",downArrow:"-cm-down-arrow",upArrow:"-cm-up-arrow"};t.render()};CameraControls.prototype.bind=function(){function e(){t.lastFocused||(t.lastFocused=performance.now());var n=performance.now()-t.lastFocused;if(n>5e3&&t.isFocusingCameraCtrls!==!0&&!t.$div.hasClass(t.parent.classes.OUTFOCUS)){t.$div.addClass(t.parent.classes.OUTFOCUS);t.$tiltIndicatorOuterCircle.attr("class",t.$tiltIndicatorOuterCircle.attr("class")+" "+t.parent.classes.OUTFOCUS);t.$tiltIndicatorOuterShellCircle.attr("class",t.$tiltIndicatorOuterShellCircle.attr("class")+" "+t.parent.classes.OUTFOCUS);t.$rotateIndicatorOuterCircle.attr("class",t.$rotateIndicatorOuterCircle.attr("class")+" "+t.parent.classes.OUTFOCUS);t.$rotateIndicatorOuterShellCircle.attr("class",t.$rotateIndicatorOuterShellCircle.attr("class")+" "+t.parent.classes.OUTFOCUS);t.$imgs.css({opacity:"0.2"})}t.rAFInOutControls=requestAnimationFrame(e)}var t=this;t.getCamera().moveStart.addEventListener(t.moveStart);t.getCamera().moveEnd.addEventListener(t.moveEnd);t.parent.viewer.scene.postRender.addEventListener(t.postRender);t.$div.on(TC.Util.detectMouse()?"mouseout":"touchleave, touchend",t.outControls);t.$div.on(TC.Util.detectMouse()?"mouseover":"touchmove, touchstart",t.inControls);t.rAFInOutControls=requestAnimationFrame(e)};CameraControls.prototype.unbind=function(){var e=this;e.$div.addClass(TC.Consts.classes.HIDDEN);e.getCamera().moveStart.removeEventListener(e.moveStart);e.getCamera().moveEnd.removeEventListener(e.moveEnd);e.parent.viewer.scene.postRender.removeEventListener(e.postRender);e.$div.off(TC.Util.detectMouse()?"mouseout":"touchleave, touchend",e.outControls);e.$div.off(TC.Util.detectMouse()?"mouseover":"touchmove, touchstart",e.inControls);window.cancelAnimationFrame(e.rAFInOutControls);e.lastFocused=void 0;e.rAFInOutControls=void 0};CameraControls.prototype.getCamera=function(){var e=this;return e.parent.Cesium.Camera.getCamera.call(e.parent)};CameraControls.prototype.render=function(){var e=this;if(e.$div){e.$div.removeClass(TC.Consts.classes.HIDDEN);e.bind()}else e.parent.getRenderedHtml(e.parent.CLASS+"-cm-ctls",{},function(t){e.$div=$('<div class="'+e.parent.CLASS+'-cm-ctls"></div>');e.$div.appendTo(e.parent.map._$div);$(t).appendTo(e.$div);e.$imgs=$.merge(e.$div.find("img"),e.$div.find("image"));var n=function(e){e.stopPropagation&&e.stopPropagation();e.preventDefault&&e.preventDefault();var t=new Cesium.Cartesian2,n=e.currentTarget,r=e.currentTarget.getBoundingClientRect(),i=r.width/2,a=new Cesium.Cartesian2((r.right-r.left)/2,(r.bottom-r.top)/2),s=new Cesium.Cartesian2(e.clientX-r.left,e.clientY-r.top),o=Cesium.Cartesian2.subtract(s,a,t),l=Cesium.Cartesian2.magnitude(o),c=l/i,u=145,h=50;return h/u>c?0:1>c?{element:n,vector:o}:!0};e.$tilt=$("."+e.parent.CLASS+e.selectors.tilt,e.$div);e.$tiltIndicator=e.$tilt.find("svg");e.$tiltIndicator.on("mousedown",function(e){var t=this,r=n.call(t,e);0==r?t.resetTilt.call(t):r.hasOwnProperty("element")&&t.draggingTilt.call(t,r.element,r.vector)}.bind(e));e.$tiltIndicatorInner=e.$tiltIndicator.find("."+e.parent.CLASS+e.selectors.tilt+"-inner");e.$tiltIndicatorInner.on(TC.Consts.event.CLICK,e.resetTilt.bind(e));e.$tiltIndicatorOuter=e.$tiltIndicator.find("."+e.parent.CLASS+e.selectors.tilt+"-outer");e.$tiltIndicatorOuterCircle=$("."+e.parent.CLASS+e.selectors.tilt+"-outer-circle");e.$tiltIndicatorOuterShellCircle=$("."+e.parent.CLASS+e.selectors.tilt+"-outer-shell-circle");e.$tiltUp=e.$tilt.find("."+e.parent.CLASS+e.selectors.upArrow);e.$tiltUp.on(TC.Util.detectMouse()?"mousedown":"touchstart",function(){e.$tiltUp.blur();var t=TC.Util.detectMouse()?"mouseup":"touchend";document.removeEventListener(t,e.tiltUpMouseUpFunction,!1);e.tiltUpMouseUpFunction=void 0;e.tilt.call(e,5);e.tiltUpInterval=setInterval(function(){e.isTiltUpDisabled?e.tiltUpMouseUpFunction():e.tilt.call(e,5)}.bind(e),101);e.tiltUpMouseUpFunction=function(){clearInterval(e.tiltUpInterval);e.tiltUpInterval=void 0;document.removeEventListener(t,e.tiltUpMouseUpFunction,!1);e.tiltUpMouseUpFunction=void 0};document.addEventListener(t,e.tiltUpMouseUpFunction,!1)}.bind(e));e.$tiltDown=e.$tilt.find("."+e.parent.CLASS+e.selectors.downArrow);e.$tiltDown.on(TC.Util.detectMouse()?"mousedown":"touchstart",function(){e.$tiltDown.blur();var t=TC.Util.detectMouse()?"mouseup":"touchend";document.removeEventListener(t,e.tiltDownMouseUpFunction,!1);e.tiltDownMouseUpFunction=void 0;e.tilt.call(e,-5);e.tiltDownInterval=setInterval(function(){e.isTiltDownDisabled?e.tiltDownMouseUpFunction():e.tilt.call(e,-5)}.bind(e),101);e.tiltDownMouseUpFunction=function(){clearInterval(e.tiltDownInterval);e.tiltDownInterval=void 0;document.removeEventListener(t,e.tiltDownMouseUpFunction,!1);e.tiltDownMouseUpFunction=void 0};document.addEventListener(t,e.tiltDownMouseUpFunction,!1)}.bind(e));e.$rotate=$("."+e.parent.CLASS+e.selectors.rotate,e.$div);e.$rotateIndicator=e.$rotate.find("svg");e.$rotateIndicatorInner=e.$rotateIndicator.find("."+e.parent.CLASS+e.selectors.rotate+"-inner");e.$rotateIndicator.on("mousedown",function(e){var t=this,r=n.call(t,e);0==r?t.resetRotation.call(t):1==r.hasOwnProperty("element")&&t.draggingRotate.call(t,r.element,r.vector)}.bind(e));e.$rotateIndicatorOuterCircle=$("."+e.parent.CLASS+e.selectors.rotate+"-outer-circle");e.$rotateIndicatorOuterShellCircle=$("."+e.parent.CLASS+e.selectors.rotate+"-outer-shell-circle");e.$rotateLeft=e.$rotate.find("."+e.parent.CLASS+e.selectors.leftArrow);e.$rotateLeft.on(TC.Util.detectMouse()?"mousedown":"touchstart",function(){e.$rotateLeft.blur();var t=TC.Util.detectMouse()?"mouseup":"touchend";document.removeEventListener(t,e.rotateLeftMouseUpFunction,!1);e.rotateLeftMouseUpFunction=void 0;e.rotate.call(e,-15);e.rotateLeftInterval=setInterval(function(){e.rotate.call(e,-15)}.bind(e),101);e.rotateLeftMouseUpFunction=function(){clearInterval(e.rotateLeftInterval);e.rotateLeftInterval=void 0;document.removeEventListener(t,e.rotateLeftMouseUpFunction,!1);e.rotateLeftMouseUpFunction=void 0};document.addEventListener(t,e.rotateLeftMouseUpFunction,!1)}.bind(e));e.$rotateRight=e.$rotate.find("."+e.parent.CLASS+e.selectors.rightArrow);e.$rotateRight.on(TC.Util.detectMouse()?"mousedown":"touchstart",function(){e.$rotateRight.blur();var t=TC.Util.detectMouse()?"mouseup":"touchend";document.removeEventListener(t,e.rotateRightMouseUpFunction,!1);e.rotateRightMouseUpFunction=void 0;e.rotate.call(e,15);e.rotateRightInterval=setInterval(function(){e.rotate.call(e,15)}.bind(e),101);e.rotateRightMouseUpFunction=function(){clearInterval(e.rotateRightInterval);e.rotateRightInterval=void 0;document.removeEventListener(t,e.rotateRightMouseUpFunction,!1);e.rotateRightMouseUpFunction=void 0};document.addEventListener(t,e.rotateRightMouseUpFunction,!1)}.bind(e));e.bind()}.bind(this))};CameraControls.prototype.disableTilt=function(e){var t=this,n=Cesium.Math.toRadians(Math.abs(e));t.isTiltUpDisabled=void 0==t.parent.Cesium.Util.pickBottomPoint(t.parent.viewer.scene)?!0:t.getCamera().pitch+n>=Cesium.Math.PI_OVER_TWO;t.isTiltDownDisabled=t.getCamera().pitch-n<=-Cesium.Math.PI_OVER_TWO;t.isTiltUpDisabled?t.$tiltUp.addClass(t.parent.classes.CAMERACTRARROWDISABLED):t.$tiltUp.removeClass(t.parent.classes.CAMERACTRARROWDISABLED);t.$tiltUp.attr("disabled",t.isTiltUpDisabled);t.isTiltDownDisabled?t.$tiltDown.addClass(t.parent.classes.CAMERACTRARROWDISABLED):t.$tiltDown.removeClass(t.parent.classes.CAMERACTRARROWDISABLED);t.$tiltDown.attr("disabled",t.isTiltDownDisabled)};CameraControls.prototype.tilt=function(e){var t=this;t.disableTilt(e);void 0==t.parent.Cesium.Util.pickBottomPoint(t.parent.viewer.scene)&&(e>0?t.getCamera().lookUp():t.getCamera().lookDown());if(!(e>=Cesium.Math.PI_OVER_TWO&&t.isTiltUpDisabled||e<=-Cesium.Math.PI_OVER_TWO&&t.isTiltDownDisabled)){var n=Cesium.Math.toRadians(e),r=t.parent.Cesium.Util.pickBottomPoint(t.parent.viewer.scene);if(r){var i=Cesium.Matrix4.fromTranslation(r);t.parent.Cesium.Util.rotateAroundAxis(t.getCamera(),-n,t.getCamera().right,i,{duration:100})}}};CameraControls.prototype.rotate=function(e){var t=this;e=Cesium.Math.toRadians(e);var n=t.parent.Cesium.Util.pickBottomPoint(t.parent.viewer.scene);n&&t.parent.Cesium.Util.setHeadingUsingBottomCenter(t.parent.viewer.scene,e,n,{duration:100})};CameraControls.prototype.draggingTilt=function(e,t){var n=this;n.$tiltIndicatorOuterCircle.attr("class",n.$tiltIndicatorOuterCircle.attr("class")+" "+n.parent.classes.HIGHLIGHTED);var r=new Cesium.Matrix4,i=new Cesium.Matrix4,a=new Cesium.Cartesian2;document.removeEventListener("mousemove",n.tiltMouseMoveFunction,!1);document.removeEventListener("mouseup",n.tiltMouseUpFunction,!1);n.tiltTickFunction&&n.parent.viewer.clock.onTick.removeEventListener(n.tiltTickFunction);n.tiltMouseMoveFunction=void 0;n.tiltMouseUpFunction=void 0;n.tiltTickFunction=void 0;n.isTilting=!0;n.tiltLastTimestamp=performance.now();var s=n.parent.viewer.scene,o=s.camera,l=n.parent.Cesium.Util.pickBottomPoint(s);if(l){n.tiltFrame=Cesium.Transforms.eastNorthUpToFixedFrame(l,Cesium.Ellipsoid.WGS84,i);n.tiltIsLook=!1}else{n.tiltFrame=Cesium.Transforms.eastNorthUpToFixedFrame(o.positionWC,Cesium.Ellipsoid.WGS84,i);n.tiltIsLook=!0}var c=Math.atan2(-t.y,t.x);n.tiltInitialCursorAngle=Cesium.Math.zeroToTwoPi(c-Cesium.Math.PI_OVER_TWO);n.tiltInitialCameraAngle=Math.atan2(o.position.y,o.position.x);n.tiltTickFunction=function(e){var t=this,n=performance.now(),i=(n-t.tiltLastTimestamp,t.parent.Cesium.Util.pickBottomPoint(s));i&&!t.tiltLastPivot&&(t.tiltLastPivot=i);if(!i&&t.tiltLastPivot)i=t.tiltLastPivot;else if(!t.tiltLastPivot)return;var a=t.tiltCursorAngle+Cesium.Math.PI_OVER_TWO,l=a-t.tiltInitialCursorAngle;s=t.parent.viewer.scene;o=s.camera;var c=Cesium.Matrix4.clone(o.transform,r);o.lookAtTransform(t.tiltFrame);var u=Cesium.Math.zeroToTwoPi(t.tiltInitialCameraAngle-l),h=Math.atan2(o.position.y,o.position.x),p=.02*Math.sin(u-h);t.tiltIsLook?o.look(o.right,-p):o.rotateUp(p);o.lookAtTransform(c);t.tiltLastTimestamp=n}.bind(n);n.tiltMouseMoveFunction=function(t){var n=this,r=e.getBoundingClientRect();center=new Cesium.Cartesian2((r.right-r.left)/2,(r.bottom-r.top)/2);var i=new Cesium.Cartesian2(t.clientX-r.left,t.clientY-r.top),s=Cesium.Cartesian2.subtract(i,center,a),o=Math.atan2(-s.y,s.x);n.tiltCursorAngle=Cesium.Math.zeroToTwoPi(o-Cesium.Math.PI_OVER_TWO)}.bind(n);n.tiltMouseUpFunction=function(e){n.$tiltIndicatorOuterCircle.attr("class",n.$tiltIndicatorOuterCircle.attr("class").replace(n.parent.classes.HIGHLIGHTED,""));n.isTilting=!1;document.removeEventListener("mousemove",n.tiltMouseMoveFunction,!1);document.removeEventListener("mouseup",n.tiltMouseUpFunction,!1);void 0!==n.tiltTickFunction&&n.parent.viewer.clock.onTick.removeEventListener(n.tiltTickFunction);n.tiltMouseMoveFunction=void 0;n.tiltMouseUpFunction=void 0;n.tiltTickFunction=void 0};document.addEventListener("mousemove",n.tiltMouseMoveFunction,!1);document.addEventListener("mouseup",n.tiltMouseUpFunction,!1);n._unsubscribeFromClockTick=n.parent.viewer.clock.onTick.addEventListener(n.tiltTickFunction);var c=Math.atan2(-t.y,t.x);n.tiltCursorAngle=Cesium.Math.zeroToTwoPi(c-Cesium.Math.PI_OVER_TWO)};CameraControls.prototype.draggingRotate=function(e,t){var n=this;n.$rotateInner=$(e).find("."+n.parent.CLASS+n.selectors.rotate+"-outer-circle");n.$rotateInner.attr("class",n.$rotateInner.attr("class")+" "+n.parent.classes.HIGHLIGHTED);var r=new Cesium.Matrix4,i=new Cesium.Matrix4,a=new Cesium.Cartesian2;document.removeEventListener("mousemove",n.rotateMouseMoveFunction,!1);document.removeEventListener("mouseup",n.rotateMouseUpFunction,!1);n.rotateMouseMoveFunction=void 0;n.rotateMouseUpFunction=void 0;n.isRotating=!0;n.rotateInitialCursorAngle=Math.atan2(-t.y,t.x);var s=n.parent.viewer.scene,o=s.camera,l=n.parent.Cesium.Util.pickCenterPoint(n.parent.viewer.scene);if(null==l||void 0==l){l=n.parent.Cesium.Util.pickBottomPoint(n.parent.viewer.scene);if(null==l||void 0==l){n.rotateFrame=Cesium.Transforms.eastNorthUpToFixedFrame(o.positionWC,Cesium.Ellipsoid.WGS84,i);n.rotateIsLook=!0}}else{n.rotateFrame=Cesium.Transforms.eastNorthUpToFixedFrame(l,Cesium.Ellipsoid.WGS84,i);n.rotateIsLook=!1}var c=Cesium.Matrix4.clone(o.transform,r);o.lookAtTransform(n.rotateFrame);n.rotateInitialCameraAngle=Math.atan2(o.position.y,o.position.x);n.rotateInitialCameraDistance=Cesium.Cartesian3.magnitude(new Cesium.Cartesian3(o.position.x,o.position.y,0));o.lookAtTransform(c);n.rotateMouseMoveFunction=function(t){
var i=e.getBoundingClientRect(),s=new Cesium.Cartesian2((i.right-i.left)/2,(i.bottom-i.top)/2),l=new Cesium.Cartesian2(t.clientX-i.left,t.clientY-i.top),u=Cesium.Cartesian2.subtract(l,s,a),h=Math.atan2(-u.y,u.x),p=h-n.rotateInitialCursorAngle,d=Cesium.Math.zeroToTwoPi(n.rotateInitialCameraAngle-p);o=n.parent.viewer.scene.camera;c=Cesium.Matrix4.clone(o.transform,r);o.lookAtTransform(n.rotateFrame);var f=Math.atan2(o.position.y,o.position.x);o.rotateRight(d-f);o.lookAtTransform(c)};n.rotateMouseUpFunction=function(e){n.isRotating=!1;n.$rotateInner.attr("class",n.$rotateInner.attr("class").replace(n.parent.classes.HIGHLIGHTED,""));document.removeEventListener("mousemove",n.rotateMouseMoveFunction,!1);document.removeEventListener("mouseup",n.rotateMouseUpFunction,!1);n.rotateMouseMoveFunction=void 0;n.rotateMouseUpFunction=void 0};document.addEventListener("mousemove",n.rotateMouseMoveFunction,!1);document.addEventListener("mouseup",n.rotateMouseUpFunction,!1)};CameraControls.prototype.resetTilt=function(){var e=this,t=-e.getCamera().pitch-Cesium.Math.toRadians(50);e.tilt(Cesium.Math.toDegrees(t))};CameraControls.prototype.resetRotation=function(e){var t,n=this,r=new $.Deferred;t=-n.getCamera().heading;for(;t<-Math.PI;)t+=2*Math.PI;for(;t>Math.PI;)t-=2*Math.PI;e?e.callback=function(){r.resolve()}:r.resolve();var i=n.parent.Cesium.Util.pickBottomPoint(n.parent.viewer.scene);i&&n.parent.Cesium.Util.setHeadingUsingBottomCenter(n.parent.viewer.scene,t,i,e);return r};CameraControls.prototype.customCollisionDetection=function(){{var e,t,n=this,r=new Cesium.Matrix4,i=new Cesium.Cartographic,a=n.parent.viewer.scene,s=n.parent.viewer.scene.camera,o=a.screenSpaceCameraController,l=(o.enableCollisionDetection,o.minimumCollisionTerrainHeight),c=o.minimumZoomDistance,u=a.globe,h=u.ellipsoid;a.mapProjection}if(!Cesium.Matrix4.equals(s.transform,Cesium.Matrix4.IDENTITY)){e=Cesium.Matrix4.clone(s.transform,r);t=Cesium.Cartesian3.magnitude(s.position);s._setTransform(Cesium.Matrix4.IDENTITY)}var p=i;h.cartesianToCartographic(s.position,p);var d=!1;if(p.height<l){var f=u.getHeight(p);if(void 0!==f&&null!==f){f+=c;if(p.height<f){p.height=f;h.cartographicToCartesian(p,s.position);d=!0}}}if(void 0!==e&&null!==e){s._setTransform(e);if(d){Cesium.Cartesian3.normalize(s.position,s.position);Cesium.Cartesian3.negate(s.position,s.direction);Cesium.Cartesian3.multiplyByScalar(s.position,Math.max(t,c),s.position);Cesium.Cartesian3.normalize(s.direction,s.direction);Cesium.Cartesian3.cross(s.direction,s.up,s.right);Cesium.Cartesian3.cross(s.right,s.direction,s.up)}}};CustomRenderLoop=function(e,t,n){this.map2D=e;this.listentTo=[TC.Consts.event.LAYERADD,TC.Consts.event.LAYERORDER,TC.Consts.event.LAYERREMOVE,TC.Consts.event.LAYEROPACITY,TC.Consts.event.LAYERVISIBILITY,TC.Consts.event.ZOOM,TC.Consts.event.BASELAYERCHANGE].join(" ");this.map3D=t;this.scene_=this.map3D.scene;this.verboseRendering=n;this._boundNotifyRepaintRequired=this.notifyRepaintRequired.bind(this);this.lastCameraViewMatrix_=new Cesium.Matrix4;this.lastCameraMoveTime_=0;this.stoppedRendering=!1;this._removePostRenderListener=this.scene_.postRender.addEventListener(this.postRender.bind(this));this._wheelEvent="";this._wheelEvent="onwheel"in this.scene_.canvas?"wheel":document.onmousewheel?"mousewheel":"DOMMouseScroll";this._originalLoadWithXhr=Cesium.loadWithXhr.load;this._originalScheduleTask=Cesium.TaskProcessor.prototype.scheduleTask;this._originalCameraSetView=Cesium.Camera.prototype.setView;this._originalCameraMove=Cesium.Camera.prototype.move;this._originalCameraRotate=Cesium.Camera.prototype.rotate;this._originalCameraLookAt=Cesium.Camera.prototype.lookAt;this._originalCameraFlyTo=Cesium.Camera.prototype.flyTo;this.enable()};CustomRenderLoop.prototype.repaintOn_=function(e,t){var n=this.scene_.canvas;n.addEventListener(e,this._boundNotifyRepaintRequired,t)};CustomRenderLoop.prototype.removeRepaintOn_=function(e,t){var n=this.scene_.canvas;n.removeEventListener(e,this._boundNotifyRepaintRequired,t)};CustomRenderLoop.prototype.enable=function(){this.repaintOn_("mousemove",!1);this.repaintOn_("mousedown",!1);this.repaintOn_("mouseup",!1);this.repaintOn_("touchstart",!1);this.repaintOn_("touchend",!1);this.repaintOn_("touchmove",!1);if(window.PointerEvent){this.repaintOn_("pointerdown",!1);this.repaintOn_("pointerup",!1);this.repaintOn_("pointermove",!1)}this.repaintOn_(this._wheelEvent,!1);window.addEventListener("resize",this._boundNotifyRepaintRequired,!1);var e=this;Cesium.loadWithXhr.load=function(t,n,r,i,a,s,o,l,c){s.promise.always(e._boundNotifyRepaintRequired);e._originalLoadWithXhr(t,n,r,i,a,s,o,l,c)};Cesium.TaskProcessor.prototype.scheduleTask=function(t,n){var r=e._originalScheduleTask.call(this,t,n),i=this;if(!i._originalWorkerMessageSinkRepaint){var a=i._worker;i._originalWorkerMessageSinkRepaint=a.onmessage;a.onmessage=function(t){i._originalWorkerMessageSinkRepaint(t);e.notifyRepaintRequired()}}return r};Cesium.Camera.prototype.setView=function(){e._originalCameraSetView.apply(this,arguments);e.notifyRepaintRequired()};Cesium.Camera.prototype.move=function(){e._originalCameraMove.apply(this,arguments);e.notifyRepaintRequired()};Cesium.Camera.prototype.rotate=function(){e._originalCameraRotate.apply(this,arguments);e.notifyRepaintRequired()};Cesium.Camera.prototype.lookAt=function(){e._originalCameraLookAt.apply(this,arguments);e.notifyRepaintRequired()};Cesium.Camera.prototype.flyTo=function(){e._originalCameraFlyTo.apply(this,arguments);e.notifyRepaintRequired()};this.map2D.on(this.listentTo,this._boundNotifyRepaintRequired)};CustomRenderLoop.prototype.disable=function(){if(this._removePostRenderListener){this._removePostRenderListener();this._removePostRenderListener=void 0}this.removeRepaintOn_("mousemove",!1);this.removeRepaintOn_("mousedown",!1);this.removeRepaintOn_("mouseup",!1);this.removeRepaintOn_("touchstart",!1);this.removeRepaintOn_("touchend",!1);this.removeRepaintOn_("touchmove",!1);if(window.PointerEvent){this.removeRepaintOn_("pointerdown",!1);this.removeRepaintOn_("pointerup",!1);this.removeRepaintOn_("pointermove",!1)}this.removeRepaintOn_(this._wheelEvent,!1);window.removeEventListener("resize",this._boundNotifyRepaintRequired,!1);Cesium.loadWithXhr.load=this._originalLoadWithXhr;Cesium.TaskProcessor.prototype.scheduleTask=this._originalScheduleTask;Cesium.Camera.prototype.setView=this._originalCameraSetView;Cesium.Camera.prototype.move=this._originalCameraMove;Cesium.Camera.prototype.rotate=this._originalCameraRotate;Cesium.Camera.prototype.lookAt=this._originalCameraLookAt;Cesium.Camera.prototype.flyTo=this._originalCameraFlyTo;this.map2D.off(this.listentTo,this._boundNotifyRepaintRequired)};CustomRenderLoop.prototype.postRender=function(e){var t=Date.now(),n=this.scene_,r=n.camera;Cesium.Matrix4.equalsEpsilon(this.lastCameraViewMatrix_,r.viewMatrix,1e-5)||(this.lastCameraMoveTime_=t);var i=t-this.lastCameraMoveTime_<3e3,a=n.globe._surface,s=!a._tileProvider.ready||a._tileLoadQueueHigh.length>0||a._tileLoadQueueMedium.length>0||a._tileLoadQueueLow.length>0||a._debug.tilesWaitingForChildren>0,o=n.tweens;if(!i&&!s&&0==o.length){this.verboseRendering&&console.log("stopping rendering @ "+Date.now());this.parent.setBlockRendering(!0);this.stoppedRendering=!0}Cesium.Matrix4.clone(r.viewMatrix,this.lastCameraViewMatrix_)};CustomRenderLoop.prototype.restartRenderLoop=function(){this.notifyRepaintRequired()};CustomRenderLoop.prototype.notifyRepaintRequired=function(){this.verboseRendering&&this.stoppedRendering&&console.log("starting rendering @ "+Date.now());this.lastCameraMoveTime_=Date.now();this.parent.setBlockRendering(!1);this.stoppedRendering=!1};CustomRenderLoop.prototype.setDebug=function(e){this.verboseRendering=e};idRequestAnimationFrame=null;e.Cesium={CustomRender:{_blockRendering:!1,_canvasClientWidth:0,_canvasClientHeight:0,_resolutionScale:1,_canvas:null,_clock:null,_handleResize:function(e){var t=this._canvas.clientWidth,n=this._canvas.clientHeight;if(!(0===t|0===n||t===this._canvasClientWidth&&n===this._canvasClientHeight)){var r=this._resolutionScale;this._canvasClientWidth=t;this._canvasClientHeight=n;t*=r;n*=r;this._canvas.width=t;this._canvas.height=n;e.scene.camera.frustum.aspectRatio=t/n}},_renderingAnimation:function(e){function t(){if(n._blockRendering)n._clock.tick();else{r.scene.initializeFrame();n._handleResize(r);var e=n._clock.tick()||Cesium.JulianDate.now();r.scene.render(e)}idRequestAnimationFrame=requestAnimationFrame(t)}var n=this,r=e;idRequestAnimationFrame=requestAnimationFrame(t)},start:function(e,t,n){this._canvas=t.scene.canvas;this._clock=t.clock||new Cesium.Clock;n&&(this._resolutionScale=.5);this.customRender=new CustomRenderLoop(e,t,!0);this.customRender.parent=this;this._renderingAnimation(t)},stop:function(){window.cancelAnimationFrame(idRequestAnimationFrame)},setBlockRendering:function(e){this._blockRendering=e}},arePendingTiles:function(){var e=this,t=e.viewer.scene.globe._surface;return!t._tileProvider.ready||t._tileLoadQueueHigh.length>0||t._tileLoadQueueMedium.length>0||t._tileLoadQueueLow.length>0||t._debug.tilesWaitingForChildren>0},getCesium:function(){var e=new $.Deferred;window.Cesium?e.resolve():TC.loadJS(!window.Cesium,[TC.Consts.url.CESIUM],function(){e.resolve()});return e},getTerrainProvider:function(){var e=this;e.terrainProvider||(e.terrainProvider=new Cesium.CesiumTerrainProvider({url:"https://pmpwvinet18.tcsa.local/customcesiumterrain/epsg3857/geodetic/_5m/5m",requestWaterMask:!0,requestVertexNormals:!0}));return e.terrainProvider},getViewer:function(){var e=this,t=new $.Deferred;e.viewer?t.resolve(e.viewer):e.Cesium.getCesium().then(function(){var n=new Cesium.Globe;n.baseColor=Cesium.Color.WHITE;n.enableLighting=!0;e.viewer=e.Cesium._viewer=new Cesium.Viewer(e.selectors.divThreedMap,{terrainProvider:e.Cesium.getTerrainProvider(),terrainExaggeration:1,terrainShadows:Cesium.ShadowMode.ENABLED,animation:!1,timeline:!1,fullscreenButton:!1,baseLayerPicker:!1,imageryProvider:!1,navigationInstructionsInitiallyVisible:!1,navigationHelpButton:!1,geocoder:!1,homeButton:!1,infoBox:!1,sceneModePicker:!1,selectionIndicator:!1,globe:n,useDefaultRenderLoop:!e.options.customRender});e.options.customRender&&e.Cesium.CustomRender.start(e.map,e.viewer,e.isSlower);e.viewer.readyPromise=new $.Deferred;e.viewer.scene.backgroundColor=Cesium.Color.WHITE;e.viewer.scene.screenSpaceCameraController.enableCollisionDetection=!0;e.viewer.scene.screenSpaceCameraController.maximumZoomDistance=5e5;e.viewer.scene.imageryLayers.removeAll();if(e.options&&e.options.showTileCoordinates){var r;e.$divThreedMap.append('<button class="tc-ctl-threed-show-tile-btn"></button>');e.$btnShowTileCoords=$(".tc-ctl-threed-show-tile-btn");e.$btnShowTileCoords.on(TC.Consts.event.CLICK,function(){if($(this).hasClass("showing")){e.viewer.scene.imageryLayers.raiseToTop(r);e.viewer.scene.imageryLayers.remove(r,!0)}else r=e.viewer.scene.imageryLayers.addImageryProvider(new Cesium.TileCoordinatesImageryProvider);$(this).toggleClass("showing")})}e.viewer.terrainProvider.errorEvent.addEventListener(e.Cesium.Events.tileProviderError.bind(e));e.viewer.scene.renderError.addEventListener(e.Cesium.Events.renderError.bind(e));e.Cesium.Util.tileLoadHelper=new Cesium.EventHelper;e.Cesium.Util.tileLoadHelper.add(e.viewer.scene.globe.tileLoadProgressEvent,function(t){e.waitting||(e.waitting=e.map.getLoadingIndicator().addWait());if(0===t){e.map.getLoadingIndicator().removeWait(e.waitting);delete e.waitting;e.viewer.readyPromise.resolve()}}.bind(e));e.Cesium.Util.zoomHandler.call(e);$(".cesium-viewer-bottom").remove();t.resolve(e.viewer)});return t},setCameraFromMapView:function(){var e=this,t=e.mapView.getCenter(),n=TC.Util.reproject(t,e.map.crs,e.crs);e.distance=e.Cesium.Util.calcDistanceForResolution.call(e,e.mapView.getResolution()||0,Cesium.Math.toRadians(n[0]));e.Cesium.Camera.updateCamera.call(e)},setViewFromCameraView:function(){var e=this;if(!e.setViewFromCameraViewInProgress||"resolved"==e.setViewFromCameraViewInProgress.state()){e.setViewFromCameraViewInProgress=new $.Deferred;{var t=Cesium.Ellipsoid.WGS84,n=e.viewer.scene;target_=e.Cesium.Util.pickCenterPoint(n)}if(!target_){var r=e.viewer.scene.globe,i=e.viewer.camera.positionCartographic.clone(),a=r.getHeight(i);i.height=a||0;target_=Cesium.Ellipsoid.WGS84.cartographicToCartesian(i)}e.distance=Cesium.Cartesian3.distance(target_,e.viewer.camera.position);var s=t.cartesianToCartographic(target_),o=TC.Util.reproject([Cesium.Math.toDegrees(s.longitude),Cesium.Math.toDegrees(s.latitude)],e.crs,e.map.crs);e.mapView.setCenter(o);e.mapView.setResolution(e.Cesium.Util.calcResolutionForDistance.call(e,e.distance,s?s.latitude:0));e.setViewFromCameraViewInProgress.resolve()}return e.setViewFromCameraViewInProgress},Events:{Zoom:{_toZoom:{direction:1,amount:0,endPosition:{}},zoom:function(e,t){var n=this,r=n.viewer.scene;if(!e||!e.endPosition){var i=r.canvas,a=new Cesium.Cartesian2(i.clientWidth/2,i.clientHeight/2);e={endPosition:a}}var s=r.camera.getPickRay(e.endPosition),o=r.globe.pick(s,r);if(o){var l=Cesium.Cartesian3.distance(s.origin,o);if(1>l)return;n.Cesium.Events.Zoom._toZoom.direction=t>0?1:0;n.Cesium.Events.Zoom._toZoom.amount+=5*l/100;n.Cesium.Events.Zoom._toZoom.endPosition=e.endPosition}var c=function(t){var n=this,r=n.viewer.scene,i=r.camera.getPickRay(e.endPosition||t.endPosition),a=r.globe.pick(i,r);if(a){var s=Cesium.Cartesian3.distance(i.origin,a);if(1>s)return;var o=r.camera.position,l=(r.camera.direction,toGo=new Cesium.Cartesian3);Cesium.Cartesian3.multiplyByScalar(i.direction,1==t.direction?t.amount:-t.amount,l);Cesium.Cartesian3.add(o,l,toGo);var c=new Cesium.Ray(toGo,i.direction),u=r.globe.pick(c,r);if(u){var h=function(){this.Cesium.Events.Zoom._toZoom={direction:1,amount:0,endPosition:{}}};Cesium.Cartesian3.distance(toGo,u)<1||Cesium.Ellipsoid.WGS84.cartesianToCartographic(toGo).height>r.screenSpaceCameraController.maximumZoomDistance||Math.abs(Cesium.Ellipsoid.WGS84.cartesianToCartographic(toGo).height)<r.screenSpaceCameraController.minimumZoomDistance?h.call(n):n.viewer.camera.flyTo({destination:toGo,orientation:{heading:r.camera.heading,pitch:r.camera.pitch,roll:r.camera.roll},duration:1,easingFunction:Cesium.EasingFunction.LINEAR_NONE,complete:function(e){this.Cesium.Events.Zoom._toZoom={direction:1,amount:0,endPosition:{}}}.bind(n,Cesium.Cartesian3.distance(toGo,u))})}}};setTimeout(function(){c.call(n,n.Cesium.Events.Zoom._toZoom)}.bind(n),50)},buttomsZoom:function(e,t){var n=this;n.Cesium.Events.Zoom.zoom.call(n,{endPosition:e},t)},wheelZoom:function(e){var t=this;t.Cesium.Events.Zoom.zoom.call(t,t.Cesium._mousePosition,e)}},renderError:function(e){var t=this;t.$divThreedMap.addClass(t.classes.LOADING);t.map.toast("Error",{type:TC.Consts.msgType.ERROR})},tileProviderError:function(e){switch(e.error.statusCode){case 403:case 404:}}},Camera:{limitCamera:function(){var e=this,t=e.viewer.camera.positionCartographic.clone();if(!(t.longitude>=e.initExtent.west&&t.longitude<=e.initExtent.east&&t.latitude>=e.initExtent.south&&t.latitude<=e.initExtent.north)){var n=e.viewer.scene.screenSpaceCameraController.maximumZoomDistance,r=.05*t.height/n;t.longitude=Math.max(e.initExtent.west-r,t.longitude);t.latitude=Math.max(e.initExtent.south-r,t.latitude);t.longitude=Math.min(e.initExtent.east+r,t.longitude);t.latitude=Math.min(e.initExtent.north+r,t.latitude);e.viewer.camera.setView({destination:Cesium.Ellipsoid.WGS84.cartographicToCartesian(t),orientation:{heading:e.viewer.camera.heading,pitch:e.viewer.camera.pitch}})}e.viewer.scene.screenSpaceCameraController.minimumZoomDistance=t.height>1800?400:200},updateCamera:function(){var e=this,t=e.mapView.getCenter();if(t){var n=TC.Util.reproject(t,e.map.crs,e.crs),r=new Cesium.Cartographic(Cesium.Math.toRadians(n[0]),Cesium.Math.toRadians(n[1]));e.viewer.scene.globe&&(r.height=e.viewer.scene.globe.getHeight(r)||0);var i=Cesium.Ellipsoid.WGS84.cartographicToCartesian(r),a={pitch:Cesium.Math.toRadians(-90),heading:-e.mapView.getRotation(),roll:0};e.viewer.camera.setView({destination:i,orientation:a});e.viewer.camera.moveBackward(e.distance)}},getCamera:function(){var e=this;return e.viewer.scene.camera},getHeight:function(){var e=this;return Cesium.Ellipsoid.WGS84.cartesianToCartographic(e.Cesium.Camera.getCamera.call(e).position).height}},Util:{calcDistanceForResolution:function(e,t){var n=this,r=n.viewer.camera.frustum.fovy,i=n.mapView.proj4Obj.oProj.METERS_PER_UNIT,a=e*n.mapView.viewHTML.getBoundingClientRect().height,s=Math.cos(Math.abs(t)),o=a*i*s;return o/2/Math.tan(r/2)},calcResolutionForDistance:function(e,t){var n=this,r=n.viewer.scene.canvas,i=n.viewer.camera.frustum.fovy,a=n.mapView.proj4Obj.oProj.METERS_PER_UNIT,s=2*e*Math.tan(i/2),o=Math.cos(Math.abs(t)),l=s/a/o,c=l/r.clientHeight,u=n.map.getResolutions();if(null==u){u=new Array(22);for(var h=0,p=u.length;p>h;++h)u[h]=n.mapView.getMaxResolution()/Math.pow(2,h)}for(var h=0;h<u.length;h++)if(u[h]<c){c=u[h];break}return c},rotateAroundAxis:function(e,t,n,r,i){function a(i){s||(s=i);var l=p(o((i-s)/u,0,1));e.transform.clone(m);var c=(l-f)*t;f=l;e.lookAtTransform(r);e.rotate(n,c);e.lookAtTransform(m);if(1>l)requestAnimationFrame(a);else{d&&d();y.resolve()}}var s,o=Cesium.Math.clamp,l=Cesium.defaultValue,c=i||{},u=l(c.duration,500),h=function(e){return e},p=l(c.easing,h),d=c.callback,f=0,m=new Cesium.Matrix4,y=new $.Deferred;requestAnimationFrame(a);return y},pickOnTerrainOrEllipsoid:function(e,t){var n=e.camera.getPickRay(t),r=e.globe.pick(n,e);return r||e.camera.pickEllipsoid(t)},pickCenterPoint:function(e){var t=this,n=e.canvas,r=new Cesium.Cartesian2(n.clientWidth/2,n.clientHeight/2);return t.pickOnTerrainOrEllipsoid(e,r)},pickBottomPoint:function(e){var t=this,n=e.canvas,r=new Cesium.Cartesian2(n.clientWidth/2,n.clientHeight);return t.pickOnTerrainOrEllipsoid(e,r)},bottomFovRay:function(e){var t=e.camera,n=t.frustum.fovy/2,r=t.direction,i=Cesium.Quaternion.fromAxisAngle(t.right,n),a=Cesium.Matrix3.fromQuaternion(i),s=new Cesium.Cartesian3;Cesium.Matrix3.multiplyByVector(a,r,s);return new Cesium.Ray(t.position,s)},setHeadingUsingBottomCenter:function(e,t,n,r){var i=this,a=e.camera,s=i.computeAngleToZenith(e,n),o=a.right,l=Cesium.Quaternion.fromAxisAngle(o,s),c=Cesium.Matrix3.fromQuaternion(l),u=new Cesium.Cartesian3;Cesium.Cartesian3.subtract(a.position,n,u);var h=new Cesium.Cartesian3;Cesium.Matrix3.multiplyByVector(c,u,h);Cesium.Cartesian3.add(h,n,h);var p=Cesium.Matrix4.fromTranslation(h);i.rotateAroundAxis(a,t,h,p,r)},signedAngleBetween:function(e,t,n){var r=new Cesium.Cartesian3,i=new Cesium.Cartesian3,a=new Cesium.Cartesian3;Cesium.Cartesian3.normalize(e,r);Cesium.Cartesian3.normalize(t,i);Cesium.Cartesian3.cross(r,i,a);var s=Cesium.Cartesian3.dot(r,i),o=Cesium.Cartesian3.magnitude(a),l=Cesium.Cartesian3.dot(n,a),c=Math.atan2(o,s);return l>=0?c:-c},computeAngleToZenith:function(e,t){var n=this,r=e.camera,i=r.frustum.fovy/2,a=n.bottomFovRay(e),s=Cesium.Cartesian3.clone(a.direction);Cesium.Cartesian3.negate(s,s);var o=new Cesium.Cartesian3;Cesium.Ellipsoid.WGS84.geocentricSurfaceNormal(t,o);var l=new Cesium.Cartesian3;Cesium.Cartesian3.negate(r.right,l);var c=n.signedAngleBetween(o,s,l);return c+i},computeSignedTiltAngleOnGlobe:function(e){var t=this,n=e.camera,r=new Cesium.Ray(n.position,n.direction),i=e.globe.pick(r,e);if(!i){var a=Cesium.Ellipsoid.WGS84,s=Cesium.IntersectionTests.rayEllipsoid(r,a);s&&(i=Cesium.Ray.getPoint(r,s.start))}if(!i)return void 0;var o=new Cesium.Cartesian3;Cesium.Ellipsoid.WGS84.geocentricSurfaceNormal(i,o);var l=t.signedAngleBetween,c=l(n.direction,o,n.right)-Math.PI;return Cesium.Math.convertLongitudeRange(c)},zoomHandler:function(){var e=this;if(!TC.Util.detectMobile()){e.viewer.scene.screenSpaceCameraController.enableZoom=!1;var t,n=e.viewer.scene.canvas;t="onwheel"in n?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll";n.addEventListener(t,function(t){var n;if(t.deltaY){var r=t.deltaMode;n=r===t.DOM_DELTA_PIXEL?-t.deltaY:r===t.DOM_DELTA_LINE?40*-t.deltaY:120*-t.deltaY}else n=t.detail>0?-120*t.detail:t.wheelDelta;e.Cesium.Events.Zoom.wheelZoom.call(e,n)},!1);var r=new Cesium.ScreenSpaceEventHandler(e.viewer.scene.canvas);r.setInputAction(function(t){e.Cesium._mousePosition=t},Cesium.ScreenSpaceEventType.MOUSE_MOVE);r.setInputAction(function(t){e.Cesium.Events.Zoom.wheelZoom.call(e,t)},Cesium.ScreenSpaceEventType.WHEEL);var i=new Cesium.Cartesian2,a=0;r.setInputAction(function(e){Cesium.Cartesian2.lerp(e.position1,e.position2,.5,i)},Cesium.ScreenSpaceEventType.PINCH_START);r.setInputAction(function(t){var n=t.distance.endPosition.y-t.distance.startPosition.y,r=n/e.viewer.scene.canvas.clientHeight;r=Math.min(r,e.viewer.scene.screenSpaceCameraController.maximumMovementRatio);a=r},Cesium.ScreenSpaceEventType.PINCH_MOVE);r.setInputAction(function(t){e.Cesium.Events.Zoom.zoom.call(e,{endPosition:i},a)},Cesium.ScreenSpaceEventType.PINCH_END)}}}};e.OverrideControls={adapter:function(e){for(var t=this,n=0,r=t.map.controls.length;r>n;n++){var i=t.map.controls[n];if(t.ctrlsToMng.indexOf(i)<0)switch(!0){case t.direction.TO_TWO_D==e:i.enable();break;case t.direction.TO_THREE_D==e:i.disable()}}switch(!0){case t.direction.TO_TWO_D==e:$("[data-no-3d]").removeClass(TC.Consts.classes.HIDDEN);break;case t.direction.TO_THREE_D==e:$("[data-no-3d]").addClass(TC.Consts.classes.HIDDEN)}},Cfg:{zoomAmount:200},Events:{initialExtent:function(e){var t=this;t.map.options.initialExtent&&4==t.map.options.initialExtent.length&&$.when(t.map.setExtent(t.map.options.initialExtent)).then(function(){var e=t.map.getExtent(),n=TC.Util.reproject(e.slice(0,2),t.map.crs,t.crs),r=TC.Util.reproject(e.slice(2),t.map.crs,t.crs);t.initExtent=Cesium.Rectangle.fromDegrees(n[0],n[1],r[0],r[1]);Cesium.Camera.DEFAULT_VIEW_RECTANGLE=t.initExtent;Cesium.Camera.DEFAULT_VIEW_FACTOR=0;t.viewer.camera.flyHome(4)}.bind(t))},zoomin:function(e){var t=this,n=new Cesium.Cartesian2(t.viewer.scene.canvas.clientWidth/2,t.viewer.scene.canvas.clientHeight/2);t.Cesium.Events.Zoom.buttomsZoom.call(t,n,t.OverrideControls.Cfg.zoomAmount)},zoomout:function(e){var t=this,n=new Cesium.Cartesian2(t.viewer.scene.canvas.clientWidth/2,t.viewer.scene.canvas.clientHeight/2);t.Cesium.Events.Zoom.buttomsZoom.call(t,n,-t.OverrideControls.Cfg.zoomAmount)}}};e.BaseMap={analogLayers:{layers:[],getProperties:function(e){var t=this;if(e.options&&e.options.hasOwnProperty("4326")){t.BaseMap.analogLayers.layers.push({id:e.id,opts:e.options[4326]});return t.BaseMap.analogLayers.layers[t.BaseMap.analogLayers.layers.length-1].opts}return null},findById:function(e){if(0==this.layers.length)return null;for(var t=0;t<this.layers.length;t++)if(this.layers[t].id.toLowerCase().trim()===e.toLowerCase().trim())return this.layers[t].opts;return null}},synchronizer:function(e){var t=this;switch(!0){case t.direction.TO_TWO_D==e:t.BaseMap.Util.addNoCompatibleBaseLayers.call(t);t.map.baseLayer=t.currentMapCfg.baseMap==t.Consts.BLANK_BASE?t.currentMapCfg.baseVector:t.currentMapCfg.baseMap;t.map.$events.trigger($.Event(TC.Consts.event.BASELAYERCHANGE,{layer:t.map.baseLayer}));break;case t.direction.TO_THREE_D==e:t.BaseMap.Util.checkCompatibleBaseMaps.call(t);t.BaseMap.Util.removeNoCompatibleBaseLayers.call(t);if(t.map.baseLayer instanceof TC.layer.Raster){var n=t.map.baseLayer;if(n.options.relatedWMTS){t.map.baseLayer=n=t.map.getLayer(n.options.relatedWMTS);t.map.$events.trigger($.Event(TC.Consts.event.BASELAYERCHANGE,{layer:t.map.baseLayer}))}else if(null!=(obj=t.BaseMap.analogLayers.findById(t.map.baseLayer.id))){$.extend(obj,{map:t.map});n=new TC.layer.Raster(obj);n.isBase=!0}t.Raster.synchronizer.call(t,n)}else t.baseLayer=t.Consts.BLANK_BASE}},Events:{beforeBaseLayerChanged:function(e){var t=this;t.waitting||(t.waitting=t.map.getLoadingIndicator().addWait())},baseLayerChanged:function(e){var t=this;if(t.baseLayer&&t.baseLayer!==t.Consts.BLANK_BASE){t.viewer.scene.imageryLayers.raiseToTop(t.baseLayer);t.viewer.scene.imageryLayers.remove(t.baseLayer,!0)}if(e.layer instanceof TC.layer.Vector)t.baseLayer=t.Consts.BLANK_BASE;else{var n=e.layer;if(null!=(obj=t.BaseMap.analogLayers.findById(e.layer.id))){$.extend(obj,{map:t.map});n=new TC.layer.Raster(obj);n.isBase=!0}t.Raster.synchronizer.call(t,n)}t.currentMapCfg.baseMap=t.map.baseLayer}},Util:{checkCompatibleBaseMaps:function(){var e=this,t=e.map.baseLayer instanceof TC.layer.Raster;t?null==(crs=e.Raster.isCompatible.call(e,e.map.baseLayer))&&null==e.BaseMap.analogLayers.getProperties.call(e,e.map.baseLayer)&&e.map.toast(e.getLocaleString("threed.baseLayerNoCompatible",{name:e.map.baseLayer.layerNames})):e.currentMapCfg.baseVector=e.map.baseLayer;if(0===e.currentMapCfg.baseMaps.length)for(var n=0;n<e.map.baseLayers.length;n++)e.map.baseLayers[n]instanceof TC.layer.Raster&&!e.Raster.isCompatible.call(e,e.map.baseLayers[n])&&null==e.BaseMap.analogLayers.getProperties.call(e,e.map.baseLayers[n])&&e.currentMapCfg.baseMaps.push({l:e.map.baseLayers[n],i:n});e.currentMapCfg.baseMap=t?e.map.baseLayer:e.Consts.BLANK_BASE},removeNoCompatibleBaseLayers:function(){var e=this,t=!1;if(e.currentMapCfg.baseMaps&&e.currentMapCfg.baseMaps.length){for(var n=0;n<e.currentMapCfg.baseMaps.length;n++)for(var r=0;r<e.map.baseLayers.length;r++)if(e.map.baseLayers[r]===e.currentMapCfg.baseMaps[n].l){e.currentMapCfg.baseMap==e.map.baseLayers[r]&&(t=!0);e.map.$events.trigger($.Event(TC.Consts.event.LAYERREMOVE,{layer:e.map.baseLayers[r]}));e.map.baseLayers.splice(r,1);break}if(t){e.map.baseLayer=e.map.baseLayers[0];e.map.$events.trigger($.Event(TC.Consts.event.BASELAYERCHANGE,{layer:e.map.baseLayer}))}}},addNoCompatibleBaseLayers:function(){var e=this;if(e.currentMapCfg.baseMaps&&e.currentMapCfg.baseMaps.length)for(var t=0;t<e.currentMapCfg.baseMaps.length;t++){e.map.$events.trigger($.Event(TC.Consts.event.LAYERADD,{layer:e.currentMapCfg.baseMaps[t].l}));e.map.baseLayers.splice(e.currentMapCfg.baseMaps[t].i,0,e.currentMapCfg.baseMaps[t].l)}}}};e.Layer={synchronizer:function(){for(var e=this,t=e.map.workLayers.slice().reverse(),n=0;n<t.length;n++){var r=t[n];r instanceof TC.layer.Raster&&e.Raster.synchronizer.call(e,r)}},Events:{layerAdded:function(e){var t=this;t.Raster.synchronizer.call(t,e.layer)},layerRemoved:function(e){for(var t=this,n=0;n<t.workLayers.length;n++)if(t.workLayers[n].imageryProvider.layers.join(",")===e.layer.names.join(",")){t.viewer.scene.imageryLayers.raiseToTop(t.workLayers[n]);t.viewer.scene.imageryLayers.remove(t.workLayers[n],!0);t.workLayers.splice(n,1);break}},layerVisibility:function(e){for(var t=this,n=0;n<t.workLayers.length;n++)if(t.workLayers[n].imageryProvider.layers.join(",")===e.layer.names.join(",")){t.workLayers[n].show=e.layer.getVisibility();break}},layerOpacity:function(e){for(var t=this,n=0;n<t.workLayers.length;n++)if(t.workLayers[n].imageryProvider.layers.join(",")===e.layer.names.join(",")){t.workLayers[n].alpha=e.layer.getOpacity();break}},layerOrder:function(e){for(var t=this,n=0;n<t.workLayers.length;n++)if(t.workLayers[n].imageryProvider&&t.workLayers[n].imageryProvider.layers.join(",")===e.layer.names.join(",")){if(e.oldIndex>e.newIndex)for(var r=e.oldIndex-e.newIndex,i=0;r>i;i++)t.viewer.scene.imageryLayers.lower(t.workLayers[n]);else for(var r=e.newIndex-e.oldIndex,i=0;r>i;i++)t.viewer.scene.imageryLayers.raise(t.workLayers[n]);t.workLayers.splice(e.newIndex,0,t.workLayers.splice(e.oldIndex,1)[0]);break}}}};e.Raster={isCompatible:function(e){var t=this,n=t.Util.getCRSByLayerOnCapabilities(e);return n&&n.length&&t.crsPattern.test(n.join(","))?n.join(",").match(t.crsPattern)[0]:null},getWMTSLayerSynchronizer:function(e,t){var n=this.Util.getTileMatrixSetLabelByLayerOnCapabilities(e,t);return new Cesium.WebMapTileServiceImageryProvider({url:e.options.urlPattern,layer:e.layerNames,style:"default",format:e.format||e.options.format,tileMatrixSetID:t,tileMatrixLabels:n,tilingScheme:new Cesium.GeographicTilingScheme})},getWMSLayerSynchronizer:function(e){return new Cesium.WebMapServiceImageryProvider({url:e.url,layers:e.layerNames,parameters:{transparent:!0,format:e.format||e.options.format}})},synchronizer:function(e){var t=this;if(e instanceof TC.layer.Raster){var n;switch(!0){case TC.Consts.layerType.WMTS==e.type:null!=(crs=t.Raster.isCompatible.call(t,e))?n=t.Raster.getWMTSLayerSynchronizer.call(t,e,crs):t.map.toast(t.getLocaleString("threed.crsNoCompatible",{name:e.layerNames}));break;case TC.Consts.layerType.WMS==e.type:null!=(crs=t.Raster.isCompatible.call(t,e))?n=t.Raster.getWMSLayerSynchronizer(e):t.map.toast(t.getLocaleString("threed.crsNoCompatible",{name:e.layerNames}))}if(n){var r=t.viewer.scene.imageryLayers.addImageryProvider(n);if(e.isBase){t.baseLayer=r;t.viewer.scene.imageryLayers.lowerToBottom(r)}else{r.show=e.getVisibility();r.alpha=e.getOpacity();t.workLayers.push(r)}}}}};e.Vector={getPosition:function(e){var t=this;return e?TC.Util.reproject(e,t.map.crs,t.crs):void 0},getIcon:function(e){return e.url&&e.width&&e.height?{image:e.url,width:e.width,height:e.height}:void 0},createEntity:function(e){var t,n=this;switch(!0){case e instanceof TC.feature.Marker:var r=this.getPosition.call(n,e.getCoords()),i=this.getIcon.call(n,e.options);t=new Cesium.Entity({position:Cesium.Cartesian3.fromDegrees(r[0],r[1])});i&&(t.billboard=i);case e instanceof TC.feature.Point:}t&&n.viewer.entities.add(t)},synchronizer:function(e){var t=this;if(e.features&&e.features.length)for(var n=0;n<e.features.length;n++)this.createEntity.call(t,e.features[n])}};e.Util={browserSupportWebGL:function(){var e=this,t=!1;if(window.WebGLRenderingContext){var n=document.createElement("canvas"),r={alpha:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};try{var i=n.getContext("webgl",r)||n.getContext("experimental-webgl",r)||n.getContext("webkit-3d",r)||n.getContext("moz-webgl",r);if(i)t=!0;else{r.failIfMajorPerformanceCaveat=!1;i=n.getContext("webgl",r)||n.getContext("experimental-webgl",r)||n.getContext("webkit-3d",r)||n.getContext("moz-webgl",r);if(i){t="slow";e.isSlower=!0}else t=!1}}catch(a){console.log(E)}if("slow"===t||!t){var s="slow"===t?"threed.slowSupport.supported":"threed.not.supported";e.map.toast(e.getLocaleString(s),{type:TC.Consts.msgType.WARNING,duration:1e4})}return t}t=!1},paths:{CRS:["Capability","Layer","CRS"],TILEMATRIXSET:["Contents","TileMatrixSet","Identifier"],TILEMATRIXSETLABELS:["Contents","TileMatrixSet"]},getOfPath:function(e,t,n){if(n<t.length-1)return e.hasOwnProperty(t[n])?this.getOfPath(e[t[n]],t,++n):null;if(e instanceof Array){for(var r=[],i=0;i<e.length;i++)e[i].hasOwnProperty(t[n])&&r.push(e[i][t[n]]);return r}return e[t[n]]},getCRSByLayerOnCapabilities:function(e){return(capsURL=TC.Util.isOnCapabilities(e.url))&&(caps=TC.capabilities[capsURL])?this.getOfPath(caps,this.paths.CRS,0)||this.getOfPath(caps,this.paths.TILEMATRIXSET,0):null},getTileMatrixSetLabelByLayerOnCapabilities:function(e,t){if((capsURL=TC.Util.isOnCapabilities(e.url))&&(caps=TC.capabilities[capsURL]))for(var n=this.getOfPath(caps,this.paths.TILEMATRIXSETLABELS,0),r=0;r<n.length;r++)if(n[r].Identifier===t)return this.getOfPath(n[r],["TileMatrix","Identifier"],0);return null},reset3D:function(){var e=this;e.currentMapCfg.baseMap="";e.workLayers=[];e.cameraControls.unbind();e.Cesium.Util.tileLoadHelper.removeAll();delete e.Cesium.Util.tileLoadHelper}}}();TC.layer=TC.layer||{};TC.Layer||TC.syncLoadJS(TC.apiLocation+"TC/Layer.js");TC.Consts.BLANK_IMAGE="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAQAIBRAA7";!function(){var e={},t=window.hasOwnProperty("Worker"),n=$.Deferred();if(t){var r=TC.apiLocation+"TC/workers/tc-caps-web-worker.js";TC.Util.isSameOrigin(TC.apiLocation)?n.resolve(r):$.ajax({url:r,type:"GET",dataType:"text"}).then(function(e){var t=new Blob([e],{type:"text/javascript"}),r=window.URL.createObjectURL(t);n.resolve(r)},function(e){n.reject()})}var i=function(n,r,i){var s=n.url,o=!1,c=e[s];if(c){n._capabilitiesPromise=c;o=!0}else n._capabilitiesPromise=c=e[s]=$.Deferred();c.then(function(e){if(e.error)a(n,e.error);else{n.capabilities=n.capabilities||e;

var t=n.getGetMapUrl();TC.capabilities[n.options.url]=TC.capabilities[n.options.url]||e;TC.capabilities[t]=TC.capabilities[t]||e;l(n)}});if(!o){TC.loadJS(!window.localforage,[TC.Consts.url.LOCALFORAGE],function(){localforage.getItem(n.CAPABILITIES_STORE_KEY_PREFIX+s).then(function(t){t&&e[n.url].resolve(t)})});var u,h={};if(n.type===TC.Consts.layerType.WMTS)if(n.options.encoding===TC.Consts.WMTSEncoding.RESTFUL){var p="/1.0.0/WMTSCapabilities.xml";if(s.indexOf(p)<s.length-p.length){"/"===s[s.length-1]&&(p=p.substr(1));u=s+p}else u=s}else{u=s;h.SERVICE="WMTS";h.VERSION="1.0.0";h.REQUEST="GetCapabilities"}else{u=s;h.SERVICE="WMS";h.VERSION="1.3.0";h.REQUEST="GetCapabilities"}u=u+"?"+$.param(h);TC._capabilitiesRequests=TC._capabilitiesRequests||{};var d=function(e,n){var r=TC._capabilitiesRequests[e]=!n&&TC._capabilitiesRequests[e]||$.ajax({url:n?TC.proxify(e):e,type:"GET",dataType:t?"text":"xml"});return r},f=function(e){r(n,e)};d(u).then(f,function(){d(u,!0).then(f,function(e,t,r){i(n,t+"]["+r)})})}},a=function(e,t){var n="No se pudo obtener el documento de capacidades de servicio "+e.url+": ["+t+"]";e._capabilitiesPromise.reject(n);TC.error(n);e.map&&e.map.$events.trigger($.Event(TC.Consts.event.LAYERERROR,{layer:e,reason:"couldNotGetCapabilities"}));e.wrap.setLayer(null)},s=function(e,t){TC.loadJS(!window.localforage,[TC.Consts.url.LOCALFORAGE],function(){var n=e.CAPABILITIES_STORE_KEY_PREFIX+e.options.url,r=function(){localforage.setItem(n,t)};e.map?e.map.loaded(r):r()})},o=function(r,i){var a;if(i.documentElement){if($(i).find("ServiceException").length>0)a={error:$(i).find("ServiceException").text()};else{var o=r.type===TC.Consts.layerType.WMTS?new r.wrap.WmtsParser:new r.wrap.WmsParser;a=o.read(i);r.type===TC.Consts.layerType.WMTS&&a.Contents&&a.Contents.Layer&&$("Layer",i).each(function(e,t){var n=TC.Util.getElementByNodeName(t,"ows:Identifier")[0],r=n.firstChild.data,i=$(t),s=a.Contents.Layer.filter(function(e){return e.Identifier==r});if(s.length){s=s[0];for(var o=0;o<s.TileMatrixSetLink.length;o++){var l=s.TileMatrixSetLink[o];matrixId=l.TileMatrixSet;xmlLink=i.find("TileMatrixSetLink").each(function(e,t){return $(t).find("TileMatrixSet:first").text()==matrixId});if(xmlLink.length){xmlLink=xmlLink[0];l.TileMatrixSetLimits=[];$(xmlLink).find("TileMatrixLimits").each(function(e,t){var n=$(t);l.TileMatrixSetLimits.push({TileMatrix:n.find("TileMatrix").text(),MinTileRow:parseInt(n.find("MinTileRow").text()),MinTileCol:parseInt(n.find("MinTileCol").text()),MaxTileRow:parseInt(n.find("MaxTileRow").text()),MaxTileCol:parseInt(n.find("MaxTileCol").text())})})}}}})}e[r.url].resolve(a);s(r,a)}else t&&"string"==typeof i&&n.then(function(t){var n=new Worker(t);n.onmessage=function(t){a="success"===t.data.state?t.data.capabilities:{error:"Web worker error"};e[r.url].resolve(a);n.terminate();s(r,a)};n.postMessage({type:r.type,text:i})})},l=function(e){var t;if(!e.wrap.layer){switch(e.type){case TC.Consts.layerType.GROUP:break;case TC.Consts.layerType.WMTS:t=u(e);break;default:t=c(e)}e.wrap.setLayer(t)}},c=function(e){var t=$.isArray(e.names)?e.names.join(","):e.names,n=e.options.format,r=e.options,i={LAYERS:t,FORMAT:n,TRANSPARENT:e.transparent,VERSION:e.capabilities.version||"1.3.0"};e.params&&$.extend(i,e.params);var a=e.getPreferredInfoFormat();null!==a&&(i.INFO_FORMAT=a);return e.wrap.createWmsLayer(e.url,i,r)},u=function(e){return e.wrap.createWmtsLayer(e.options.matrixSet,e.names[0],e.options)},h=function S(e,t){var n=$.inArray(t.name,e.availableNames);if(-1===n)for(var r=0,i=t.children.length;i>r;r++){n=S(e,t.children[r]);if(-1!==n)break}return n},p=function E(e,t){var n=function(t,n){return h(e,n)-h(e,t)};t.children.sort(n);for(var r=0,i=t.children.length;i>r;r++)E(e,t.children[r])},d=function O(e,t,n){var r=!1;n.count=n.count+1;if(e.name===t)r=!0;else for(var i=e.children.length-1;i>=0;i--)if(O(e.children[i],t,n)){r=!0;break}return r};TC.layer.Raster=function(){var e=this;this._capabilitiesPromise=null;TC.Layer.apply(e,arguments);e.wrap=new TC.wrap.layer.Raster(e);e.transparent=e.options.transparent===!1?!1:!0;e.url=e.options.url;e.params=e.options.params;if("string"==typeof e.options.layerNames)e.names=e.availableNames=e.options.layerNames.split(",");else{e.names=[];e.availableNames=[];if($.isArray(e.options.layerNames))for(var t=0;t<e.options.layerNames.length;t++){var n=e.options.layerNames[t];if("string"==typeof n){e.names.push(n);e.availableNames.push(n)}else if(n.hasOwnProperty("name")){e.availableNames.push(n.name);(void 0===n.isVisible||n.isVisible)&&e.names.push(n.name)}}else{var r=e.options.params?e.options.params.sld_body:null;if(r){var s=$.parseXML(r),l=TC.Util.getElementByNodeName(s,"sld:NamedLayer");if(l&&l.length>0){var c=TC.Util.getElementByNodeName(l[0],"sld:Name");if(c&&c.length>0){var n=$(c[0]).text();e.names.push(n);e.availableNames.push(n)}}}}}e.ignorePrefixes=void 0===e.options.ignorePrefixes?!0:e.options.ignorePrefixes;e._capabilitiesNodes={};i(e,o,a);e._disgregatedLayerNames=null;TC.Consts.layerType.WMTS==e.type&&e.wrap.setWMTSUrl()};TC.inherit(TC.layer.Raster,TC.Layer);TC.layer.Raster.prototype.CAPABILITIES_STORE_KEY_PREFIX="TC.capabilities.";TC.layer.Raster.prototype.setVisibility=function(e){var t=this;t.tree=null;t._cache.visibilityStates={};TC.Layer.prototype.setVisibility.call(t,e)};var f=function(e){var t=e.layerNames,n=e.matrixSet,r=e.capabilities,i=[],a=r.Contents.TileMatrixSet.filter(function(e){return e.Identifier==n});if(a.length){a=a[0];var s=r.Contents.Layer.filter(function(e){return e.Identifier==t})[0];if(s.TileMatrixSetLink&&s.TileMatrixSetLink.length&&s.TileMatrixSetLink[0].TileMatrixSetLimits){for(var o,l=s.TileMatrixSetLink[0].TileMatrixSetLimits,c=0;c<l.length;c++){o=l[c];var u=a.TileMatrix.filter(function(e){return e.Identifier==o.TileMatrix});if(u.length){var h=$.extend({matrixIndex:a.TileMatrix.indexOf(u[0])},u[0],o);i.push(h)}}return i}return a.TileMatrix}return null},m=function(e,t){if(e.type!==TC.Consts.layerType.WMS)return t;var n=t.slice();y(e,n,e.wrap.getRootLayerNode());return n},y=function A(e,t,n){var r=!1,i=e.wrap.getLayerNodes(n);if(i.length){for(var a=0,s=i.length;s>a;a++)A(e,t,i[a])&&(r=!0);var o,l,c=$.map(i,function(t){return e.wrap.getName(t)}).reverse(),u=!1;l=o=$.inArray(c[0],t);if(0>o)u=!0;else for(var a=1,s=c.length;s>a;a++)if(c[a]!=t[++o]){u=!0;break}if(!u){var h=e.wrap.getName(n);if(h&&c.length>1){t.splice(l,c.length,h);r=!0}}}return r},g=function(e,t){for(var n=[],r=t.slice(),i=e.wrap.getRootLayerNode(),a=0,s=r.length;s>a;a++)n=n.concat(v(e,r[a],i));return n},v=function x(e,t,n,r){for(var i=[],a=e.wrap.getName(n),s=e.compareNames(t,a),o=!1,l=e.wrap.getLayerNodes(n),c=0;c<l.length;c++){var u=x(e,t,l[c],r||s);u.length?i=i.concat(u):o=!0}(!l.length||o)&&(r||s)&&(i=[a]);return i},C=function(e){return $.extend({aggregate:!0,lazy:!1},e)},L=function(e,t,n){var r,i,a,s=[];r=e?e:[];i=t?t:[];a=n?n:[];for(var o=r.concat(i),l=0;l<o.length;l++)$.inArray(o[l],o)===l&&-1===$.inArray(o[l],a)&&(s[s.length]=o[l]);return s},T=function(e,t){var n="string"==typeof t?t.split(","):t;if(e.capabilities){var r=e.getTree();n.sort(function(e,t){var n={count:0},i={count:0};d(r,e,n);d(r,t,i);return n.count-i.count})}return n},w=function(e,t,n,r){return $.grep(n,function(n){return e.compareNames(t,n,r)}).length>0};TC.layer.Raster.prototype.getLimitedMatrixSet=function(){return f(this)};TC.layer.Raster.prototype.setLayerNames=function(e,t){var n=this,r=new $.Deferred;$.when(n.wrap.getLayer()).then(function(){var i=$.isArray(e)?e:e.split(",");n.names=i;var a=C(t);a.aggregate&&(i=m(n,i));n._disgregatedLayerNames=null;var s={LAYERS:i.join(","),TRANSPARENT:!0};i.length||n.setVisibility(!1);if(a.lazy){var o=n._newParams||n.wrap.getParams();n._newParams=$.extend(o,s)}else{n.map&&n.map.$events.trigger($.Event(TC.Consts.event.BEFOREUPDATEPARAMS,{layer:n}));n.tree=null;n._cache.visibilityStates={};n.wrap.setParams(s);(a.reset||!n.map)&&(n.availableNames=n.names);n.map&&n.map.$events.trigger($.Event(TC.Consts.event.UPDATEPARAMS,{layer:n}))}r.resolve(n.names)});return r};TC.layer.Raster.prototype.addLayerNames=function(e,t){var n=this,r=new $.Deferred;$.when(n.wrap.getLayer()).then(function(){var i=C(t),a=$.isArray(e)?e:e.split(","),s=n.wrap.getParams().LAYERS;if(i.aggregate){a=g(n,a);s=n.getDisgregatedLayerNames()}$.when(n.setLayerNames(T(n,L(s,a,null)),t)).then(function(e){r.resolve(e)})});return r};TC.layer.Raster.prototype.removeLayerNames=function(e,t){var n=this,r=new $.Deferred;$.when(n.wrap.getLayer()).then(function(){var i=C(t),a=$.isArray(e)?e:e.split(","),s=n.wrap.getParams().LAYERS;if(i.aggregate){a=g(n,a);s=n.getDisgregatedLayerNames()}$.when(n.setLayerNames(T(n,L(s,null,a)),t)).then(function(e){r.resolve(e)})});return r};TC.layer.Raster.prototype.toggleLayerNames=function(e,t){var n=this,r=new $.Deferred;$.when(n.wrap.getLayer()).then(function(){var i=C(t),a=$.isArray(e)?e:e.split(","),s=n.wrap.getParams().LAYERS;if(i.aggregate){a=g(n,a);s=n.getDisgregatedLayerNames()}for(var o=[],l=[],c=0;c<a.length;c++){var u=a[c];$.inArray(u,s)<0?o[o.length]=u:l[l.length]=u}var h=[];o.length>0&&h.push(n.addLayerNames(o,i));l.length>0&&h.push(n.removeLayerNames(l,i));$.when.apply(this,h).then(function(e,t){r.resolve(e?t?e.concat(t):e:[])})});return r};TC.layer.Raster.prototype.getDisgregatedLayerNames=function(){var e=this,t=e.wrap.getLayer();if(e.wrap.isNative(t)&&e.type===TC.Consts.layerType.WMS){if(!e._disgregatedLayerNames){var n=e.wrap.getParams().LAYERS;n=$.isArray(n)?n:n.split(",");e._disgregatedLayerNames=g(e,n)}}else e._disgregatedLayerNames=e.names;return e._disgregatedLayerNames.slice()};TC.layer.Raster.prototype.isValidFromNames=function(){for(var e=this,t=!0,n=0,r=e.names.length;r>n;n++)if(!e.getLayerNodeByName(e.names[n])){t=!1;break}return t};TC.layer.Raster.prototype.isCompatible=function(e){var t=this,n=!1;switch(t.type){case TC.Consts.layerType.WMTS:case TC.Consts.layerType.WMS:n=t.wrap.isCompatible(e)}return n};TC.layer.Raster.prototype.isVisibleByScale=function(e,t){var n,r,i,a=this,s=function(){return a.map.wrap.getResolution()/28e-5};switch(a.type){case TC.Consts.layerType.WMTS:n=!1;var o=a.wrap.getTileMatrix(a.options.matrixSet);if(o){r=s();for(i=0;i<o.length;i++){var l=a.wrap.getScaleDenominators(o[i]);if(l[0]===r){n=!0;break}}}break;case TC.Consts.layerType.WMS:n=!0;var c=a.wrap.getAllLayerNodes();if(c.length>0){r=s();var u;if("number"==typeof e)u=a._capabilitiesNodes[e];else for(i=0;i<c.length;i++){var h=c[i];if(a.compareNames(a.wrap.getName(h),e,t)){u=h;break}}if(u){var l=a.wrap.getScaleDenominators(u);n=!(parseFloat(l[1])>r||parseFloat(l[0])<r)}}break;default:n=!0}return n};TC.layer.Raster.prototype.isVisibleByName=function(e,t){var n=this,r=!1;switch(n.type){case TC.Consts.layerType.WMTS:if(n.wrap.getWMTSLayer()){r=!0;break}break;case TC.Consts.layerType.WMS:var i=function(e){return a(e,n.wrap.getRootLayerNode())},a=function l(e,r){var i=null,a=n.wrap.getName(r);if(n.compareNames(a,e,t))i=[a];else for(var s=n.wrap.getLayerNodes(r),o=0;o<s.length;o++){var c=s[o],u=l(e,c);if(u){TC.Util.fastUnshift(u,a);i=u;break}}return i},s=i(e);if(s)for(var o=0;o<s.length;o++)if(w(n,s[o],n.names)){r=!0;break}break;default:r=!0}return r};TC.layer.Raster.prototype.getTree=function(){var e=this,t=e.tree,n=function(t,n){e.options.inverseTree?TC.Util.fastUnshift(t.children,n):t.children[t.children.length]=n};if(!t){var r,i=function o(t,i,a){var s;for(var l in e._capabilitiesNodes)if(e._capabilitiesNodes[l]===t){s=l;break}if(!s){s=TC.getUID();e._capabilitiesNodes[s]=t}var c={name:e.wrap.getName(t),title:t.title||t.Title,uid:s,children:[]};a&&(r=c);w(e,c.name,e.availableNames)&&(i=!0);if(e.options.isBase){c.name=e.names.join(",");c.title=e.title||c.title;c.isBase=e.isDefault;e.options.thumbnail&&(c.legend={src:e.options.thumbnail})}else{c.isVisible=c===r?e.getVisibility():e.isVisibleByName(c.name);var u,h=e.wrap.getLayerNodes(t);for(u=0;u<h.length;u++){var p=o(h[u],i);p&&n(c,p)}var d=e.wrap.getLegend(t);d.src&&(c.legend=d);if(!i&&!a){r.children=r.children.concat(c.children);c=null}}return c};switch(e.type){case TC.Consts.layerType.WMTS:t=i(e.wrap.getWMTSLayer(),!e.options.hideTree,!0);break;case TC.Consts.layerType.WMS:if(e.capabilities){t=i(e.wrap.getRootLayerNode(),!e.options.hideTree,!0);var a=e._cache.visibilityStates,s=function l(e){var t=TC.Consts.visibility.NOT_VISIBLE;if(e){if(void 0!==a[e.uid])t=a[e.uid];else{if(e.children)for(var n=!1,r=!1,i=0,s=e.children.length;s>i;i++){var o=l(e.children[i]);switch(o){case TC.Consts.visibility.VISIBLE:n=!0;break;case TC.Consts.visibility.NOT_VISIBLE:r=!0;break;case TC.Consts.visibility.HAS_VISIBLE:n=!0;r=!0}n&&(t=r?TC.Consts.visibility.HAS_VISIBLE:TC.Consts.visibility.VISIBLE)}e.isVisible&&(t=TC.Consts.visibility.VISIBLE);a[e.uid]=t}e.visibilityState=t}return t};s(t);e.options.hideTree&&p(e,t)}}t||(t={name:e.name,title:e.title});t.title=e.title||t.title;e.tree=t}return t};TC.layer.Raster.prototype.setNodeVisibility=function(e,t){var n=this;n.tree||(n.tree=n.getTree());var r=function s(e){var t=[];if(e.name)t[0]=e.name;else for(var n=0;n<e.children.length;n++)t=t.concat(s(e.children[n]));return t},i=n.findNode(e,n.tree);if(i===n.tree)t&&0===n.names.length?n.addLayerNames(n.availableNames).then(function(){n.setVisibility(!0)}):n.setVisibility(t);else{var a=r(i);t?n.addLayerNames(a):n.removeLayerNames(a)}};TC.layer.Raster.prototype.getNodeVisibility=function(e){var t=this;t.tree||(t.tree=t.getTree());return t._cache.visibilityStates[e]};TC.layer.Raster.prototype.getNodePath=function(e,t){var n=this,r=[];if(n.type===TC.Consts.layerType.WMS&&n.capabilities){e=e||n.names[0];var i=function a(r){var i=[],s=n.wrap.getName(r);if(n.compareNames(s,e,t))i.push(r);else for(var o=n.wrap.getLayerNodes(r),l=0;l<o.length;l++){var c=a(o[l]);if(c.length){i=c;TC.Util.fastUnshift(i,r);break}}return i};r=i(n.wrap.getRootLayerNode())}return r};TC.layer.Raster.prototype.getPath=function(e,t){return $.map(this.getNodePath(e,t),function(e){return e.title||e.Title})};TC.layer.Raster.prototype.getLayerNodeByName=function(e){for(var t=null,n=this,r=n.wrap.getServiceType()===TC.Consts.layerType.WMTS?n.wrap.getIdentifier:n.wrap.getName,i=n.wrap.getAllLayerNodes(),a=0,s=i.length;s>a;a++)if(n.compareNames(r(i[a]),e)){t=i[a];break}return t};TC.layer.Raster.prototype.compareNames=function(e,t,n){var r=e===t,i=this,a=void 0!==n?n:i.ignorePrefixes;if(!r&&a&&e&&t){var s=e.indexOf(":"),o=t.indexOf(":");s>=0&&0>o?r=e.substr(s+1)===t:o>=0&&0>s&&(r=e===t.substr(o+1))}return r};TC.layer.Raster.prototype.getCapabilitiesPromise=function(){return this._capabilitiesPromise};TC.layer.Raster.prototype.getResolutions=function(){return this.wrap.getResolutions()};TC.layer.Raster.prototype.searchSubLayers=function(e){if(e&&e.length&&e.length>=3){var t=this,n=t.wrap.getAllLayerNodes(),r=e.trim().toLowerCase(),i=n.map(function(e,n){delete e.tcScore;e.tcPosition=n;t.wrap.normalizeLayerNode(e);var i=e.Title.toLowerCase().trim(),a=i.indexOf(r),s=-1;if(e.Abstract){var o=e.Abstract.toLowerCase().trim();s=o.indexOf(r)}i==r?e.tcScore=20:0==a?e.tcScore=15:a>-1?e.tcScore=10:0==s?e.tcScore=5:s>-1&&(e.tcScore=1);return e.tcScore?e:null}).filter(function(e){return null!=e}).sort(function(e,t){return t.tcScore-e.tcScore});return i}return[]};var b=function(e){var t=e;if(e){var n=e.match(/\??SERVICE=\w+&/i);n&&(t=t.replace(n[0],""))}return t};TC.layer.Raster.prototype.getGetMapUrl=function(){return b(this.wrap.getGetMapUrl())};TC.layer.Raster.prototype.getPreferredInfoFormat=function(){for(var e=this,t=null,n=e.wrap.getInfoFormats(),r=0;r<TC.wrap.layer.Raster.infoFormatPreference.length;r++){var i=TC.wrap.layer.Raster.infoFormatPreference[r];if($.inArray(i,n)>=0){t=i;break}}return t};TC.layer.Raster.prototype.getLegendGraphicImage=function(){var e=this,t=$.Deferred();if(e.options.params.base64LegendSrc)return t.resolve(e.options.params.base64LegendSrc);if(e.options.params.sld_body)if("function"==typeof window.btoa){for(var n=e.names[0],r=e.wrap.getInfo(n),i=new XMLHttpRequest,a=r.legend[0].src.split("?"),s=a[1].split("&"),o="sld_body="+e.options.params.sld_body,l=0;l<s.length;l++){var c=s[l].split("=");c&&c.length>1&&c[1]&&(o+="&"+s[l])}i.open("POST",a[0],!0);i.setRequestHeader("Content-Type","application/x-www-form-urlencoded");i.responseType="arraybuffer";i.onload=function(n){if(200===this.status){for(var r=new Uint8Array(this.response),a=r.length,s=new Array(a);a--;)s[a]=String.fromCharCode(r[a]);var o=s.join(""),l=i.getResponseHeader("content-type");if(0===l.indexOf("image")){var c;c="data:"+l+";base64,"+window.btoa(o);e.options.params.base64LegendSrc=c;t.resolve(c)}}};i.send(o)}else t.reject("Funci\xf3n window.btoa no soportada por el navegador");else t.reject("No se ha especificado par\xe1metro sld_body para la capa "+e.names[0]);return t.promise()}}();var esriParser={parse:function(e){var t=[],n=(new DOMParser).parseFromString(e,"text/xml");if("FeatureInfoResponse"===n.documentElement.tagName)for(var r=n.documentElement.getElementsByTagName("FeatureInfoCollection"),i=0,a=r.length;a>i;i++)for(var s=r[i],o=s.getAttribute("layername"),l=s.getElementsByTagName("FeatureInfo"),c=0,u=l.length;u>c;c++){for(var h=l[c].getElementsByTagName("Field"),p={},d=0,f=h.length;f>d;d++){var m=h[d];p[getElementText(m.getElementsByTagName("FieldName")[0])]=getElementText(m.getElementsByTagName("FieldValue")[0])}var y=new ol.Feature(p);y.setId(o+"."+TC.getUID());t[t.length]=y}return t}};TC.layer.Raster.prototype.getWFSCapabilitiesPromise=function(){"undefined"==typeof WFSCapabilities&&TC.syncLoadJS(TC.apiLocation+"TC/layer/WFSCapabilitiesParser.js");var e=this.options.url.substring(0,this.options.url.lastIndexOf("/wms")||this.options.url.lastIndexOf("/WMS")||this.options.url.lastIndexOf("/"))+"/wfs",t=$.Deferred(),n=e.substring(e.indexOf("://")<0?0:e.indexOf("://")+3);if(TC.WFScapabilities[n]){setTimeout(function(){t.resolve(TC.WFScapabilities[n])},100);return t}var r={};r.SERVICE="WFS";r.VERSION="2.0.0";r.REQUEST="GetCapabilities";$.ajax({url:TC.proxify(e)+"?"+$.param(r),type:"GET"}).then(function(){var e=WFSCapabilities.Parse(arguments[0]),r=e.Operations.GetCapabilities.DCP&&e.Operations.GetCapabilities.DCP.HTTP.Get["xlink:href"]||e.Operations.GetCapabilities.DCPType[0].HTTP.Get.onlineResource;TC.WFScapabilities[r]=e;TC.WFScapabilities[n]=e;t.resolve(WFSCapabilities.Parse(arguments[0]))});return t};TC.layer=TC.layer||{};TC.Layer||TC.syncLoadJS(TC.apiLocation+"TC/Layer.js");TC.layer.Vector=function(){var e=this;TC.Layer.apply(e,arguments);e.type=e.options.type||TC.Consts.layerType.VECTOR;e.features=[];e.selectedFeatures=[];var t=function(e){var t=e.indexOf("?");if(t>=0)e=e.substr(0,t);else{t=e.indexOf("#");t>=0&&(e=e.substr(0,t))}return".kml"===e.substr(e.length-4).toLowerCase()};if(e.url&&(t(e.url)||e.type===TC.Consts.layerType.KML)){e.type=TC.Consts.layerType.KML;var n=function(e){for(var t=e,n=new RegExp("([^/]+.kml)","i"),r=0;3>r;r++){e=decodeURIComponent(e);var i=n.exec(e);if(i.length>1){t=i[1];break}}return t};e.title=e.options.title||n(e.url)}e.wrap=new TC.wrap.layer.Vector(e);var r=e.wrap.createVectorLayer();e.wrap.setLayer(r)};TC.inherit(TC.layer.Vector,TC.Layer);!function(){var e=TC.layer.Vector.prototype;e.getTree=function(){var e=this,t=null;if(!e.options.stealth){t={};t.children=[];for(var n=0;n<e.features.length;n++){var r=e.features[n].getPath();if(r.length){var i=TC.Util.addArrayToTree(r,t);i&&(i.legend=e.features[n].getLegend())}}t.name=e.name||t.name;t.title=e.title||t.title;t.uid=e.id}return t};var t=function(e,t,n,r){var i=new $.Deferred;$.when(t.call(e,[n],r)).then(function(t){i.resolve(t[0]);e.map.$events.trigger($.Event(TC.Consts.event.FEATUREADD,{layer:e,feature:t[0]}))});return i},n=function(e,t,n,r,i){var a=new $.Deferred,s=e.options.styles&&e.options.styles[r]||TC.Cfg.styles[r],o=$.extend(!0,{},s,i);TC.loadJS(!TC.feature||TC.feature&&!TC.feature[n],[TC.apiLocation+"TC/feature/"+n+".js"],function(){for(var r=TC.feature[n],i=new Array(t.length),s=[],l=0,c=t.length;c>l;l++){var u,h=t[l];if(h instanceof r){u=h;u.layer=e}else{o.layer=e;u=new r(h,o)}i[l]=u;e.features[e.features.length]=u;u.wrap.isNative(h)||(s[s.length]=u.wrap.feature);u.options.showPopup&&u.showPopup()}s.length&&e.wrap.addFeatures(s);a.resolve(i)});return a};e.addPoint=function(e,n){return t(this,this.addPoints,e,n)};e.addPoints=function(e,t){return n(this,e,"Point",TC.Consts.geom.POINT,t)};e.addMarker=function(e,n){return t(this,this.addMarkers,e,n)};e.addMarkers=function(e,t){return n(this,e,"Marker","marker",t)};e.addPolyline=function(e,n){return t(this,this.addPolylines,e,n)};e.addPolylines=function(e,t){return n(this,e,"Polyline",TC.Consts.geom.POLYLINE,t)};e.addMultiPolyline=function(e,n){return t(this,this.addMultiPolylines,e,n)};e.addMultiPolylines=function(e,t){return n(this,e,"MultiPolyline",TC.Consts.geom.POLYLINE,t)};e.addPolygon=function(e,n){return t(this,this.addPolygons,e,n)};e.addPolygons=function(e,t){return n(this,e,"Polygon",TC.Consts.geom.POLYGON,t)};e.addMultiPolygon=function(e,n){return t(this,this.addMultiPolygons,e,n)};e.addMultiPolygons=function(e,t){return n(this,e,"MultiPolygon",TC.Consts.geom.POLYGON,t)};e.addCircle=function(e,n){return t(this,this.addCircles,e,n)};e.addCircles=function(e,t){return n(this,e,"Circle",TC.Consts.geom.POLYGON,t)};e.addFeature=function(e){var t,n=this;TC.feature&&(TC.feature.Point&&e instanceof TC.feature.Point?t=n.addPoint(e):TC.feature.Polyline&&e instanceof TC.feature.Polyline?t=n.addPolyline(e):TC.feature.Polygon&&e instanceof TC.feature.Polygon?t=n.addPolygon(e):TC.feature.MultiPolygon&&e instanceof TC.feature.MultiPolygon?t=n.addMultiPolygon(e):TC.feature.MultiPolyline&&e instanceof TC.feature.MultiPolyline?t=n.addMultiPolyline(e):TC.feature.Circle&&e instanceof TC.feature.Circle&&(t=n.addCircle(e)));return t};e.removeFeature=function(e){this.wrap.removeFeature(e)};e.getFeatureById=function(e){var t=null,n=this.wrap.getFeatureById(e);n&&(t=n._wrap.parent);return t};e.clearFeatures=function(){var e=this;if(e.features&&e.wrap){e.features.length=0;e.wrap.clearFeatures()}};e.describeFeatureType=function(e,t){var n=this,r=$.Deferred();$.ajax({url:n.wrap.getDescribeFeatureTypeUrl(),type:"GET",dataType:"xml"}).then(function(e){var t="http://www.w3.org/2001/XMLSchema",n=e.getElementsByTagNameNS(t,"complexType")[0];if(n){for(var i=n.getElementsByTagNameNS(t,"element"),a=new Array(i.length),s=0,o=i.length;o>s;s++){var l=i[s];a[s]={name:l.getAttribute("name"),type:l.getAttribute("type"),nillable:"true"===l.getAttribute("nillable")?!0:!1,minOccurs:parseInt(l.getAttribute("minOccurs")),maxOccurs:parseInt(l.getAttribute("maxOccurs"))}}r.resolve(a)}else{var c=e.getElementsByTagName("Exception")[0];c&&r.reject(c.getElementsByTagName("ExceptionText")[0].innerHTML)}},function(e,t,n){r.reject(n)});r.then(function(t){$.isFunction(e)&&e(t)},function(e){$.isFunction(t)&&t(e)});return r.promise()};e["import"]=function(e){this.wrap["import"](e)};e.setNodeVisibility=function(e,t){var n=this;n.state=TC.Layer.state.LOADING;n.map.$events.trigger($.Event(TC.Consts.event.BEFOREUPDATE));n.map.$events.trigger($.Event(TC.Consts.event.BEFORELAYERUPDATE,{layer:n}));n.tree||(n.tree=n.getTree());var r=n.findNode(e,n.tree);if(r===n.tree)n.setVisibility(t);else{var i=n._cache.visibilityStates;i[e]=t?TC.Consts.visibility.VISIBLE:TC.Consts.visibility.NOT_VISIBLE;var a,s,o=!1;for(a=0;a<n.features.length;a++){s=n.features[a];if(s.id==e){o=!0;s.setVisibility(t);break}}if(!o)for(a=0;a<n.features.length;a++){s=n.features[a];void 0===s._path&&(s._path="/"+s.getPath().join("/"));s._path===e&&s.setVisibility(t)}}n.state=TC.Layer.state.IDLE;n.map.$events.trigger($.Event(TC.Consts.event.LAYERUPDATE,{layer:n}));n.map.$events.trigger($.Event(TC.Consts.event.UPDATE))};e.getNodeVisibility=function(e){var t=this,n=TC.Layer.prototype.getNodeVisibility.call(t,e);t.tree||(t.tree=t.getTree());var r=t.findNode(e,t.tree);if(r===t.tree)n=t.getVisibility()?TC.Consts.visibility.VISIBLE:TC.Consts.visibility.NOT_VISIBLE;else{var i=t._cache.visibilityStates,a=i[e];void 0!==a&&(n=a)}return n};e.setModifiable=function(e){this.wrap.setModifiable(e)};e.applyEdits=function(e,t,n){return this.wrap.sendTransaction(e,t,n)};e.refresh=function(){return this.wrap.reloadSource()}}();var WFSCapabilities=function(){var e={V1_0_0:"1.0.0",V1_1_0:"1.1.0",V2_0_0:"2.0.0"},t=function(){var t,s=[],o=[],l=[],c=xml2json(arguments[0]);switch(c.version){case e.V1_0_0:t=e.V1_0_0;break;case e.V1_1_0:t=e.V1_1_0;break;case e.V2_0_0:t=e.V2_0_0}s=n(c,t),o=r(c,t),l=i(c,t);var u=a(c,t),h={Operations:s,FeatureTypes:o,Filters:l};return $.extend(h,u),h},n=function(t,n){switch(n){case e.V1_0_0:var r=t.Capability.Request;if(r.GetFeature){var i=[];for(var a in r.GetFeature.ResultFormat)i.push(a.toLowerCase());r.GetFeature.outputFormat=i,delete r.GetFeature.ResultFormat,r.GetFeature.Operations=t.FeatureTypeList.Operations}return r;case e.V1_1_0:return{};case e.V2_0_0:var s={};for(var a in t.OperationsMetadata){var o={};o[a]=t.OperationsMetadata[a];for(var l in o[a])o[a][l]&&o[a][l].hasOwnProperty("AllowedValues")&&(o[a][l]=o[a][l].AllowedValues.Value);$.extend(s,o)}return s}return null},r=function(t,n){switch(n){case e.V1_0_0:for(var r={},i=0;i<t.FeatureTypeList.FeatureType.length;i++){var a=t.FeatureTypeList.FeatureType[i].Name;r[a.substring(a.indexOf(":")+1)]=t.FeatureTypeList.FeatureType[i]}return r;case e.V1_1_0:return{};case e.V2_0_0:for(var r={},i=0;i<t.FeatureTypeList.FeatureType.length;i++){var a=t.FeatureTypeList.FeatureType[i].Name;r[a.substring(a.indexOf(":")+1)]=t.FeatureTypeList.FeatureType[i]}return r}return null},i=function(t,n){switch(n){case e.V1_0_0:return t.Filter_Capabilities;case e.V1_1_0:return{};case e.V2_0_0:var r=t.Filter_Capabilities;return r}return null},a=function(t,n){switch(n){case e.V1_0_0:var r={};for(var i in t)"string"==typeof t[i]&&(r[i]=t[i]);return r;case e.V1_1_0:return{};case e.V2_0_0:var r={};for(var i in t)"string"==typeof t[i]&&(r[i]=t[i]);return r}return{}},s=function(e){var e=e,t=$.Deferred(),n=e.substring(e.indexOf("://")<0?0:e.indexOf("://")+3);if(TC.capabilities[n])return t.resolve(TC.capabilities[n]),t;var r={};return r.SERVICE="WFS",r.VERSION="2.0.0",r.REQUEST="GetCapabilities",$.ajax({url:TC.proxify(e)+"?"+$.param(r),type:"GET"}).then(function(){var e=WFSCapabilities.Parse(arguments[0]),r=e.Operations.GetCapabilities.DCP&&e.Operations.GetCapabilities.DCP.HTTP.Get["xlink:href"]||e.Operations.GetCapabilities.DCPType[0].HTTP.Get.onlineResource;TC.capabilities[r]=e,TC.capabilities[n]=e,t.resolve(WFSCapabilities.Parse(arguments[0]))}),t};return{Promises:s,Parse:t}}(),TC=TC||{};TC.Geometry=TC.Geometry||{isPoint:function(e){return $.isArray(e)&&e.length>=2&&"number"==typeof e[0]&&"number"==typeof e[1]},isRing:function(e){return $.isArray(e)&&(0===e.length||TC.Geometry.isPoint(e[0]))},isRingCollection:function(e){return $.isArray(e)&&(0===e.length||TC.Geometry.isRing(e[0]))},isMultiRingCollection:function(e){return $.isArray(e)&&(0===e.length||TC.Geometry.isRingCollection(e[0]))},getNearest:function(e,t){return TC.wrap.Geometry.getNearest(e,t)},isInside:function t(e,n){var r=!1;if(TC.Geometry.isPoint(e))if(TC.Geometry.isPoint(n))r=e[0]===n[0]&&e[1]===n[1];else if(TC.Geometry.isRing(n))for(var i=0,a=n.length-1;i<n.length;a=i++){var s=n[i][0],o=n[i][1],l=n[a][0],c=n[a][1],u=o>e[1]!=c>e[1]&&e[0]<(l-s)*(e[1]-o)/(c-o)+s;u&&(r=!r)}else if(TC.Geometry.isRingCollection(n)&&n.length>0){if(t(e,n[0])){for(var h=!1,i=1;i<n.length;i++)if(t(e,n[i])){h=!0;break}h||(r=!0)}}else if(TC.Geometry.isMultiRingCollection(n)&&n.length>0)for(var i=0,p=n.length;p>i;i++)if(t(e,n[i])){r=!0;break}return r}};var SITNA=window.SITNA||{},TC=window.TC||{};SITNA.syncLoadJS=function(e){var t=new XMLHttpRequest;t.open("GET",e,!1);t.send(null);var n=document.getElementsByTagName("head")[0],r=document.createElement("script");r.type="text/javascript";r.text=t.responseText;n.appendChild(r)};!function(){if(!window.TC||!window.TC.Cfg){var e,t;if(document.currentScript)t=document.currentScript;else{var n=document.getElementsByTagName("script");t=n[n.length-1]}var e=t.getAttribute("src");TC.apiLocation=e.substr(0,e.lastIndexOf("/")+1);SITNA.syncLoadJS(TC.apiLocation+"tcmap.js")}}();SITNA.Map=function(e,t){var n,r,i=this,a=new TC.Map(e,t);i.addLayer=function(e,t){a.addLayer(e,t)};i.setBaseLayer=function(e,t){a.setBaseLayer(e,t)};i.addMarker=function(e,t){a.addMarker(e,t)};i.zoomToMarkers=function(e){a.zoomToMarkers(e)};i.loaded=function(e){a.loaded(e)};a.loaded(function(){n=new TC.control.Search;n.register(a);n.getLayer().then(function(e){r=e});if(!a.activeControl){var e=a.getControlsByClass("TC.control.FeatureInfo")[0];e&&e.activate()}});i.getQueryableData=function(e,t){var r=n.availableSearchTypes[e];if(r.queryableData)t&&t(r.queryableData);else{var i={request:"GetFeature",service:"WFS",typename:r.featurePrefix+":"+r.featureType,version:r.version,propertyname:(r.dataIdProperty instanceof Array?r.dataIdProperty:[r.dataIdProperty]).concat(r.outputProperties instanceof Array?r.outputProperties:[r.outputProperties]).join(","),outputformat:TC.Consts.format.JSON},a=r.url+"?"+$.param(i);$.ajax({url:a}).done(function(e){r.queryableData=[];if(e.features)for(var i=e.features,a=0;a<i.length;a++){var s=i[a],e={};e.id=[];r.dataIdProperty instanceof Array||(r.dataIdProperty=[r.dataIdProperty]);for(var o=0;o<r.dataIdProperty.length;o++)s.properties.hasOwnProperty(r.dataIdProperty[o])&&e.id.push(s.properties[r.dataIdProperty[o]]);e.id=e.id.join(r.idPropertiesIdentifier?r.idPropertiesIdentifier:"");e.label=[];r.outputProperties instanceof Array||(r.outputProperties=[r.outputProperties]);for(var l=0;l<r.outputProperties.length;l++)s.properties.hasOwnProperty(r.outputProperties[l])&&e.label.push(s.properties[r.outputProperties[l]]);var c=e.label instanceof Array&&e.label.join("").trim().length>0||!(e.label instanceof Array)&&e.label.trim().length>0;e.label=r.outputFormatLabel?r.outputFormatLabel.tcFormat(e.label):e.label.join("-");c&&r.queryableData.push(e)}r.queryableData=r.queryableData.sort(function(e,t){return(r.idPropertiesIdentifier?-1!=e.id.indexOf(r.idPropertiesIdentifier):1)?n.removePunctuation(e.label.split(" ")[0])<n.removePunctuation(t.label.split(" ")[0])?-1:n.removePunctuation(e.label.split(" ")[0])>n.removePunctuation(t.label.split(" ")[0])?1:0:n.removePunctuation(e.label)<n.removePunctuation(t.label)?-1:n.removePunctuation(e.label)>n.removePunctuation(t.label)?1:0});r.queryableData=r.queryableData.filter(function(e,t,n){return 1>t?!0:e.id!==n[t-1].id&&e.label!==n[t-1].label});t&&t(r.queryableData)})}};i.getMunicipalities=function(e){i.getQueryableData(SITNA.Consts.mapSearchType.MUNICIPALITY,e)};i.getUrbanAreas=function(e){i.getQueryableData(SITNA.Consts.mapSearchType.URBAN,e)};i.getCommonwealths=function(e){i.getQueryableData(SITNA.Consts.mapSearchType.COMMONWEALTH,e)};i.getCouncils=function(e){i.getQueryableData(SITNA.Consts.mapSearchType.COUNCIL,e)};i.searchCommonwealth=function(e,t){i.searchTyped(SITNA.Consts.mapSearchType.COMMONWEALTH,e,t)};i.searchCouncil=function(e,t){i.searchTyped(SITNA.Consts.mapSearchType.COUNCIL,e,t)};i.searchUrbanArea=function(e,t){i.searchTyped(SITNA.Consts.mapSearchType.URBAN,e,t)};i.searchMunicipality=function(e,t){i.searchTyped(SITNA.Consts.mapSearchType.MUNICIPALITY,e,t)};i.searchTyped=function(e,t,s){var o=TC.getUID(),l=n.availableSearchTypes[e];t instanceof Array&&l.goToIdFormat&&(t=l.goToIdFormat.tcFormat(t));n._search.data=n._search.data||[];n._search.data.push({dataLayer:l.featureType,dataRole:e,id:t,label:"",text:""});i.removeSearch();if(n.availableSearchTypes[e]&&!n.allowedSearchTypes[e]){n.allowedSearchTypes={};n.allowedSearchTypes[e]={};n.availableSearchTypes[e].hasOwnProperty("goTo")||(n.allowedSearchTypes[e]={goTo:function(){var r,s=function(e,t,n){return e[t][n]},c=function(e){var t=[];l.idPropertiesIdentifier&&(e=e.split(l.idPropertiesIdentifier));e instanceof Array||(e=[e]);for(var n=0;n<l.dataIdProperty.length;n++)t.push({name:l.dataIdProperty[n],value:e[n],type:TC.Consts.comparison.EQUAL_TO});return t;

},u={id:o,type:SITNA.Consts.layerType.WFS,url:l.url,version:l.version,stealth:!0,geometryName:"the_geom",featurePrefix:l.featurePrefix,featureType:l.featureType,properties:c(t),outputFormat:TC.Consts.format.JSON,styles:{polygon:{fillColor:s.bind(self,l.styles[l.featureType],"polygon","fillColor"),fillOpacity:s.bind(self,l.styles[l.featureType],"polygon","fillOpacity")},line:{strokeColor:s.bind(self,l.styles[l.featureType],"line","strokeColor"),strokeOpacity:s.bind(self,l.styles[l.featureType],"line","strokeOpacity"),strokeWidth:s.bind(self,l.styles[l.featureType],"line","strokeWidth")}}};a.addLayer(u).then(function(t){r=t;i.search={layer:t,type:e};delete n.allowedSearchTypes[e]});a.one(TC.Consts.event.FEATURESADD,function(e){if(e.layer==r&&e.layer.features&&e.layer.features.length>0){for(var t=0;t<e.layer.features.length;t++)e.layer.features[t].showsPopup!=n.queryableFeatures&&(e.layer.features[t].showsPopup=n.queryableFeatures);a.zoomToFeatures(e.layer.features)}})}})}a.one(TC.Consts.event.SEARCHQUERYEMPTY,function(e){a.toast(n.EMPTY_RESULTS_LABEL,{type:TC.Consts.msgType.INFO,duration:5e3});s&&s(null)});a.one(TC.Consts.event.FEATURESADD,function(t){t.layer==r&&t.layer.features&&t.layer.features.length>0&&a.zoomToFeatures(t.layer.features);i.search={layer:t.layer,type:e};s&&s(t.layer.id!==o?t.layer.id:o)});n.goToResult(t)};i.searchFeature=function(e,t,r,s){var o=TC.getUID(),l=n.featurePrefix;i.removeSearch();e=(e||"").trim();t=(t||"").trim();r=(r||"").trim();if(0==e.length||0==t.length||0==r.length){a.toast(n.EMPTY_RESULTS_LABEL,{type:TC.Consts.msgType.INFO,duration:5e3});s&&s(null)}else{if(e.indexOf(":")>-1){l=e.split(":")[0];e=e.split(":")[1]}var c,u={id:o,type:SITNA.Consts.layerType.WFS,url:n.url,version:n.version,stealth:!0,geometryName:"the_geom",featurePrefix:l,featureType:e,maxFeatures:1,properties:[{name:t,value:r,type:TC.Consts.comparison.EQUAL_TO}],outputFormat:TC.Consts.format.JSON};a.addLayer(u).then(function(e){c=e;i.search={layer:e,type:SITNA.Consts.mapSearchType.GENERIC}});a.on(TC.Consts.event.FEATURESADD,function(e){if(e.layer==c&&e.layer.features&&e.layer.features.length>0){for(var t=0;t<e.layer.features.length;t++)e.layer.features[t].showsPopup!=n.queryableFeatures&&(e.layer.features[t].showsPopup=n.queryableFeatures);a.zoomToFeatures(e.layer.features)}});a.on(TC.Consts.event.LAYERUPDATE,function(e){e.layer==c&&e.layer.features&&0==e.layer.features.length&&a.toast(n.EMPTY_RESULTS_LABEL,{type:TC.Consts.msgType.INFO,duration:5e3});s&&s(e.layer==c&&e.layer.features&&0==e.layer.features.length?null:o)})}};i.removeSearch=function(e){if(i.search)if(n.availableSearchTypes[i.search.type]&&n.availableSearchTypes[i.search.type].hasOwnProperty("goTo")){for(var t=0;t<i.search.layer.features.length;t++)i.search.layer.removeFeature(i.search.layer.features[t]);i.search=null}else a.removeLayer(i.search.layer).then(function(){i.search=null});e&&e()};i.search=null};SITNA.Consts=TC.Consts;SITNA.Cfg=TC.Cfg;SITNA.Cfg.layout=TC.apiLocation+"TC/layout/responsive";